{"version":3,"sources":["webpack://isnap/./src/FileSaver.min.js","webpack://isnap/./src/morphic.js","webpack://isnap/webpack/bootstrap","webpack://isnap/webpack/runtime/amd options","webpack://isnap/webpack/runtime/define property getters","webpack://isnap/webpack/runtime/harmony module decorator","webpack://isnap/webpack/runtime/hasOwnProperty shorthand","webpack://isnap/webpack/runtime/make namespace object","webpack://isnap/./src/ypr.js","webpack://isnap/./src/symbols.js","webpack://isnap/./src/threads.js","webpack://isnap/./src/lists.js","webpack://isnap/./src/maps.js","webpack://isnap/./src/objects.js","webpack://isnap/./src/blocks.js","webpack://isnap/./src/widgets.js","webpack://isnap/./src/byob.js","webpack://isnap/./src/tables.js","webpack://isnap/./src/runtime-blocks.js","webpack://isnap/./src/locale.js","webpack://isnap/./src/paint.js","webpack://isnap/./src/runtime-threads.js","webpack://isnap/./src/xml.js","webpack://isnap/./src/store.js","webpack://isnap/./src/cloud.js","webpack://isnap/./src/runtime-objects.js","webpack://isnap/./src/index.js","webpack://isnap/./src/gui.js"],"names":["saveAs","e","navigator","test","userAgent","t","document","n","URL","webkitURL","r","createElementNS","o","i","HTMLElement","safari","f","u","setImmediate","setTimeout","c","revokeObjectURL","remove","l","concat","length","call","a","p","type","Blob","String","fromCharCode","v","d","y","this","m","h","split","readyState","INIT","createObjectURL","href","download","MouseEvent","dispatchEvent","DONE","FileReader","onloadend","result","replace","open","location","undefined","readAsDataURL","S","w","prototype","msSaveOrOpenBlob","name","abort","WRITING","error","onwritestart","onprogress","onwrite","onabort","onerror","onwriteend","self","window","content","module","exports","define","morphicVersion","modules","useBlurredShadows","ZERO","Point","BLACK","Color","WHITE","CLEAR","Object","freeze","standardSettings","minimumFontHeight","getMinimumFontHeight","globalFontFamily","menuFontName","menuFontSize","bubbleHelpFontSize","prompterFontName","prompterFontSize","prompterSliderSize","handleSize","scrollBarSize","mouseScrollAmount","useSliderForInput","isTouchDevice","rasterizeSVGs","isFlat","grabThreshold","showHoles","touchScreenSettings","MorphicPreferences","nop","localize","string","isNil","thing","contains","list","element","indexOf","detect","predicate","size","sizeOf","object","key","hasOwnProperty","isString","target","isObject","radians","degrees","Math","PI","fontHeight","height","max","isWordChar","aCharacter","match","isURLChar","isURL","text","newCanvas","extentPoint","nonRetina","recycleMe","canvas","ext","width","ceil","dataset","morphicShare","isRetinaEnabled","x","getContext","clearRect","createElement","copyCanvas","aCanvas","drawImage","ctx","maxX","font","measureText","fillStyle","textBaseline","fillText","getImageData","data","getDocumentPositionOf","aDOMelement","rect","getBoundingClientRect","scrollLeft","pageXOffset","documentElement","scrollTop","pageYOffset","left","top","copy","value","property","keys","valueOf","constructor","create","HTMLCanvasElement","enableRetinaSupport","backingStorePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","originalDevicePixelRatio","devicePixelRatio","canvasProto","contextProto","CanvasRenderingContext2D","uber","getOwnPropertyDescriptor","shadowOffsetX","shadowOffsetY","shadowBlur","getPixelRatio","imageSource","some","any","prop","configurable","_isRetinaEnabled","_bak","defineProperty","get","set","enabled","prevPixelRatio","prevWidth","prevHeight","pixelRatio","scale","err","console","log","image","sx","sy","sWidth","sHeight","dx","dy","dWidth","dHeight","arguments","Error","sw","sh","offset","blur","isRetinaSupported","disableRetinaSupport","normalizeCanvas","getCopy","cpy","Animation","setter","getter","delta","duration","easing","onComplete","easings","sinusoidal","endTime","destination","isActive","start","g","b","Rectangle","right","bottom","init","Node","parent","childrenArray","Morph","ShadowMorph","HandleMorph","minX","minY","insetX","insetY","PenMorph","ColorPaletteMorph","sizePoint","GrayPaletteMorph","ColorPickerMorph","defaultColor","BlinkerMorph","rate","CursorMorph","aStringOrTextMorph","aTextarea","BoxMorph","edge","border","borderColor","SpeechBubbleMorph","contents","color","padding","isThought","noShadow","DialMorph","min","tick","radius","CircleBoxMorph","orientation","SliderButtonMorph","SliderMorph","stop","MouseSensorMorph","InspectorMorph","MenuMorph","title","environment","fontSize","StringMorph","fontStyle","bold","italic","isNumeric","shadowOffset","shadowColor","fontName","TextMorph","alignment","TriggerMorph","action","labelString","hint","labelColor","labelBold","labelItalic","doubleClickAction","MenuItemMorph","shortcut","shortcutString","FrameMorph","aScrollFrame","ScrollFrameMorph","scroller","sliderColor","ListMorph","elements","labelGetter","format","onDoubleClick","separator","toSource","toString","StringFieldMorph","defaultContents","minWidth","BouncerMorph","HandMorph","aWorld","WorldMorph","fillPage","linear","cos","quadratic","cubic","elastic","sin","sine_in","quad_in","cubic_in","elastic_in","sine_out","quad_out","elastic_out","Date","now","step","round","toRGBstring","fromString","aString","components","slice","eq","aColor","observeAlpha","isCloseTo","tolerance","thres","dist","diff","hsv","s","rr","gg","bb","set_hsv","q","floor","hsl","set_hsl","hue2rgb","mixed","proportion","otherColor","frac1","frac2","darker","percent","fract","lighter","dansDarker","vv","inverted","solid","aPoint","lt","gt","ge","le","abs","neg","mirror","add","other","subtract","multiplyBy","divideBy","floorDivideBy","sqrt","tan","theta","atan","crossProduct","distanceTo","rotate","direction","center","flip","distanceAngle","angle","deg","scaleBy","scalePoint","translateBy","deltaPoint","rotateBy","centerPoint","asArray","originPoint","cornerPoint","origin","corner","extent","rectangle","org","crn","setTo","setExtent","setWidth","setHeight","area","bottomCenter","bottomLeft","bottomRight","boundingBox","corners","topRight","leftCenter","rightCenter","topCenter","topLeft","position","aRect","newOrigin","newCorner","insetBy","expandBy","growBy","intersect","merge","mergeWith","spread","amountToTranslateWithin","regionsAround","regions","intersects","push","containsPoint","containsRectangle","ro","rc","isNearTo","threshold","asArray_xywh","children","addChild","aNode","addChildFirst","splice","removeChild","idx","root","depth","allChildren","forEach","child","forAllChildren","aFunction","anyChild","aPredicate","allLeafs","allParents","siblings","filter","parentThatIsA","apply","parentThatIsAnyOf","constructors","isMorph","cachedImage","isCachingImage","shouldRerender","bounds","holes","texture","cachedTexture","alpha","isVisible","isDraggable","isTemplate","acceptsDrops","isFreeForm","noDropShadow","fullShadowSource","fps","customContextMenu","lastTime","onNextStep","destroy","fullChanged","stepFrame","current","elapsed","nxt","nextSteps","arrayOfFunctions","lst","shift","fullBounds","fullBoundsNoShadow","visibleBounds","visible","moveBy","changed","setPosition","setLeft","setRight","setTop","setBottom","setCenter","setFullCenter","keepWithin","aMorph","leftOff","rightOff","topOff","bottomOff","scrollIntoView","sf","adjustScrollBars","fixLayout","rerender","setColor","getImage","img","render","aContext","getRenderColor","fillRect","renderCachedTexture","renderTexture","fixHolesLayout","url","Image","onload","src","bg","cols","lines","save","globalAlpha","beginPath","clip","restore","drawOn","pic","sl","st","clipped","pos","translate","hole","sect","fullDrawOn","hide","show","toggleVisibility","fullImage","fb","shadowImage","off","outline","sha","clr","globalCompositeOperation","shadowImageBlurred","shadow","addShadow","addBack","getShadow","shadows","reverse","removeShadow","penTrails","broken","childChanged","world","owner","topMorphAt","point","isTransparentAt","topMorphSuchThat","next","overlappedMorphs","getPixelColor","fullCopy","map","Map","copyRecordingReferences","updateReferences","reference","properties","rootForGrab","isCorrectingOutsideDrag","wantsDropOf","pickUp","wrrld","hand","grab","isPickedUp","situation","slideBackTo","msecs","onBeforeDrop","glideTo","justDropped","reactToDropOf","endPoint","horizontal","animations","fadeTo","endAlpha","oldAlpha","perish","resize","activeHandle","move","moveCenter","msg","popUpCenteredAtHand","inform","addItem","prompt","callback","floorNum","ceilingNum","isRounded","menu","entryField","slider","items","parseFloat","button","highlightColor","pressColor","num","edit","addLine","popUpAtHand","pickColor","colorPicker","getChoice","inspect","anotherObject","inspector","Function","inspectee","inspectKeyEvent","event","charCode","keyCode","shiftKey","altKey","ctrlKey","metaKey","contextMenu","isDevMode","developersMenu","hierarchyMenu","userMenu","parents","each","addMenu","setAlphaScaled","toDataURL","addToDemoMenu","aMorphOrMenuArray","customMorphs","newAlpha","unscaled","isNaN","attach","choices","toggleIsDraggable","colorSetters","numericalSetters","allEntryFields","isEditable","nextEntryField","fields","previousEntryField","tab","editField","nextTab","backTab","previousTab","escalateEvent","functionName","arg","handler","evaluateString","code","eval","isTouching","otherMorph","len","overlappingPixels","thisImg","thatImg","otherFb","oRect","minExtent","inset","isHighlighted","rotationCenter","renderCrosshairsOn","renderHandleOn","arc","fill","strokeStyle","lineWidth","stroke","moveTo","lineTo","p11","p22","isSquare","p1","p2","lineCap","closePath","mouseDownLeft","newPos","newExt","mouseButton","setPivot","mouseEnter","mouseLeave","isWarped","heading","isDown","penPoint","penBounds","facing","dest","setHeading","setRotation","dial","drawLine","context","from","to","lineJoin","turn","forward","steps","down","up","clear","startWarp","endWarp","warp","fun","warpOp","selector","argsArray","warpSierpinski","sierpinski","warpTree","level","tree","targetSetter","choice","mouseMove","updateTarget","setTarget","setTargetSetter","gradient","createLinearGradient","addColorStop","cpal","gpal","feedback","viewPadding","ls","keyDownEventUsed","originalContents","originalAlignment","slot","textarea","setAlignmentToLeft","style","gotoSlot","updateTextAreaPosition","syncTextareaSelectionWith","processKeyDown","keyName","singleLineText","receiver","preventDefault","doIt","inspectIt","showIt","cancel","accept","downFrom","setSelectionRange","upFrom","processKeyUp","selectionStart","selectionEnd","startMark","endMark","selectionDirection","processInput","filteredContent","caret","ch","points","charAt","filterText","worldCanvas","number2px","targetMorph","end","focus","slotPosition","isScrollable","scrollCursorIntoView","gotoPos","slotAt","updateSelection","clearSelection","stopEditing","undo","resetKeyboardHandler","outlinePath","setBorderWidth","setBorderColor","setCornerSize","newSize","isPointingRight","isClickable","hasShadow","popUp","destroyTemporaries","temporaries","contentsMorph","rad","circle","fillColor","setRadius","setValue","snapToTick","noUpdate","range","getValueOf","deltaX","deltaY","x1","y1","x2","y2","light","ticks","face","inner","outer","currentKey","autoOrient","autoOrientation","toggleOrientation","userState","is3D","hasMiddleDip","colorBak","renderEdges","mouseClickLeft","rangeSize","ratio","unitSize","bw","bh","posX","posY","updateValue","relPos","setStart","setStop","setSize","showValue","userSetStart","newStart","newStop","mousePos","newX","newY","isTouched","upStep","downStep","touch","unTouch","currentProperty","showing","markOwnProperties","hasUserEditedDetails","label","detail","work","buttonInspect","buttonClose","buttonSubset","buttonEdit","resizer","buildPanes","updateCurrentSelection","val","txt","cnts","sel","selected","currentTxt","keyboardFocus","enableSelecting","setReceiver","setContents","ctrl","ev","attribs","isBold","Array","sort","hBar","vBar","isTextLineWrapping","createLabel","listContents","addProperty","renameProperty","propertyName","removeProperty","lbl","active","activeIndex","activateIndex","isListContents","hasFocus","selection","submenu","verbatim","aMenu","indicator","addPair","backgroundColor","createItems","item","isLine","tuple","adjustWidths","maxWidth","scrollFrame","unselectAllItems","morph","popup","scroll","activeMenu","first","addContents","popUpCenteredInWorld","closeRootMenu","closeSubmenu","getFocus","selectFirst","leaveSubmenu","selectUp","enterSubmenu","selectDown","processKeyPress","select","triggers","popUpSubmenu","aMenuItem","measureCtx","isItalic","enableLinks","isPassword","isShowingBlanks","blanksColor","currentlySelecting","markedTextColor","markedBackgoundColor","password","letter","ans","getShadowRenderColor","justMe","textAlign","renderWithBlanks","startX","space","words","isFirst","word","charX","startOfLine","endOfLine","previousWordFrom","aSlot","index","nextWordFrom","rawHeight","setFontSize","disableSelecting","toggleShowBlanks","toggleWeight","toggleItalic","toggleIsPassword","setSerif","setSansSerif","setText","selectionStartSlot","deleteSelection","selectAll","cursor","shiftClick","clickedText","substring","mouseDoubleClick","selectWordAt","selectBetweenWordsAt","crs","already","newMark","lineSlots","maxLineWidth","parse","newline","paragraphs","oldline","shadowHeight","shadowWidth","layoutChanged","line","offx","offy","columnRow","row","col","xOffset","yOffset","colRow","columnLength","textWidth","above","below","selectAllAndEdit","setAlignmentToRight","setAlignmentToCenter","evaluationMenu","obj","schedule","trigger","triggerDoubleClick","bubbleHelp","popUpbubbleHelp","createLabelPart","cntr","source","part","icon","createLabelString","createIcon","isShowingSubmenu","isListItem","delaySubmenu","isSelectedListItem","submorphBounds","keepInScrollFrame","adjustBounds","subBounds","newBounds","growth","reactToGrabOf","keepAllSubmorphsWithin","autoScrollTrigger","enableAutoScrolling","isScrollingByDragging","hasVelocity","toolBar","hWidth","vHeight","adjustToolBar","scrollX","cl","cw","scrollY","ct","oldPos","grabPosition","startAutoScrolling","autoScroll","ft","mouseScroll","toggleTextLineWrapping","buildListContents","pair","lb","nb","createText","speed","isStopped","moveUp","moveDown","moveRight","moveLeft","mouseOverList","mouseOverBounds","morphToGrab","grabOrigin","touchHoldTimeout","contextMenuEnabled","cachedFullImage","cachedFullBounds","morphAtPointer","allMorphsAtPointer","dropTargetFor","oldParent","prepareToBeGrabbed","drop","morphToDrop","selectForEdit","processMouseDown","actualClick","posInDocument","pageX","pageY","clearInterval","processTouchStart","touches","setInterval","processMouseUp","processMouseMove","processTouchMove","processTouchEnd","expectedClick","processDoubleClick","mouseOverNew","mouseOverBoundsNew","topMorph","reactToTemplateCopy","old","mouseLeaveBounds","newMorph","mouseEnterBounds","mouseLeaveDragging","mouseEnterDragging","processMouseScroll","wheelDeltaY","wheelDelta","wheelDeltaX","processDrop","file","suffix","files","FileList","dataTransfer","getData","readSVG","aFile","frd","droppedSVG","readImage","droppedImage","readAudio","snd","Audio","droppedAudio","readText","droppedText","readAsText","readBinary","droppedBinary","readAsArrayBuffer","lastIndexOf","toLowerCase","request","XMLHttpRequest","onreadystatechange","responseText","send","readURL","encodeURIComponent","html","iurl","parseImgURL","stamp","useFillPage","keyboardHandler","lastEditedText","initKeyboardHandler","initEventListeners","updateBroken","condenseDamages","stepAnimations","anim","rects","mergeAll","hit","trgt","condense","doOneCycle","clientHeight","innerHeight","clientWidth","innerWidth","reactToWorldResize","getGlobalPixelColor","dta","kbd","getElementById","setAttribute","overflow","wrap","zIndex","autofocus","body","appendChild","addEventListener","includes","keepValue","passive","onbeforeunload","evt","returnValue","mouseDownRight","mouseClickRight","prev","userCreateMorph","myself","foo","bar","baz","garply","fred","sub","toggleDevMode","hideAll","showAllHiddens","about","versions","slide","toggleBlurredShadows","togglePreferences","toggleHolesDisplay","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","id","loaded","__webpack_modules__","amdO","definition","enumerable","hmd","Symbol","toStringTag","sb","extend","$extend","Ref","isRef","Dictionary","values","rgb","indexedColors","grayVal","colorDepthLengths","1","2","4","8","15","16","12","9","ColorStream","bitmap","bits","read","ColorStreamIndexed","ColorStreamRGB","pow","ColorStream32","bytes","nextAlpha","colorStreams","32","24","getColorStream","Form","bm","isBitmap","decompress","load","imageData","colors","createImageData","putImageData","ColorForm","classIDs","classNames","addFields","base","Reader","on","subarray","readYPR","infoSize","info","stage","time","matchBytes","uint32","reader","timeEnd","readInfo","objectCount","objects","readHeader","readObject","fixReferences","classID","fixFixedFormat","fixArray","className","targetObjectFor","version","fieldCount","readField","readFixedFormat","uint24","int32","int16","uint16","float64","readBytes","join","uint8","skip","hasNext","int8","int24","ieee","ebits","mbits","sign","exponent","mantissa","bias","parseInt","substr","NaN","C","rotationStyles","normal","leftRight","none","customBlockInputs","objectList","number","numberList","textList","listList","anyList","booleanList","command","commandList","reporter","reporterList","predicateList","loop","loopList","unevaluated","unevaluatedList","unevaluatedBoolean","unevaluatedBooleanList","template","blockSelectors","_warp","escapeXML","costumeIndex","media","costume","Text","Element","tagName","attributes","el","toXML","toDOM","createTextNode","write","projectName","project","out","sprites","vars","lists","objectID","customBlocks","preCustomBlocks","scope","blocks","sc","ypr","userSpec","__blockSpec__","_","declarations","warn","__types__","nsCustomBlocks","globals","isGlobal","args","defaults","spec","answer","pop","blockVars","unshift","isAtomic","category","nsScript","script","block","nBlock","node","complex","objName","nValue","nsVariables","listHasItems","strings","nsCostumes","mediaName","form","nsSounds","nsScripts","scripts","collapsed","sprite","app","tempo","tempoBPM","threadsafe","scheduled","blocksBin","hidden","flags","rotationDegrees","rotation","rotationStyle","draggable","pen","XMLWriter","SymbolMorph","names","isProtectedLabel","isReadOnly","setLabelColor","textColor","symbolWidth","renderShape","renderSymbolStop","renderSymbolPointRight","renderSymbolStepForward","renderSymbolGears","renderSymbolGearBig","renderSymbolGearPartial","renderSymbolFile","renderSymbolFullScreen","renderSymbolGrow","renderSymbolNormalScreen","renderSymbolSmallStage","renderSymbolNormalStage","renderSymbolShrink","renderSymbolTurtle","renderSymbolTurtleOutline","renderSymbolPause","renderSymbolFlag","renderSymbolOctagon","renderSymbolCloud","renderSymbolCloudGradient","renderSymbolCloudOutline","renderSymbolTurnRight","renderSymbolTurnLeft","renderSymbolTurnAround","renderSymbolStorage","renderSymbolPoster","renderSymbolFlash","renderSymbolBrush","renderSymbolTick","renderSymbolCheckedBox","renderSymbolRectangle","renderSymbolRectangleSolid","renderSymbolCircle","renderSymbolCircleSolid","renderSymbolLine","renderSymbolCross","renderSymbolCrosshairs","renderSymbolPaintbucket","renderSymbolEraser","renderSymbolPipette","renderSymbolSpeechBubble","renderSymbolSpeechBubbleOutline","renderSymbolLoop","renderSymbolTurnBack","renderSymbolTurnForward","renderSymbolArrowUp","renderSymbolArrowUpOutline","renderSymbolArrowUpThin","renderSymbolArrowUpDownThin","renderSymbolArrowLeft","renderSymbolArrowLeftOutline","renderSymbolArrowLeftThin","renderSymbolArrowLeftRightThin","renderSymbolArrowDown","renderSymbolArrowDownOutline","renderSymbolArrowDownThin","renderSymbolArrowRight","renderSymbolArrowRightOutline","renderSymbolArrowRightThin","renderSymbolRobot","renderSymbolMagnifyingGlass","renderSymbolMagnifierOutline","renderSymbolSelection","renderSymbolOctagonOutline","renderSymbolClosedBrushPath","renderSymbolNotes","renderSymbolCamera","renderSymbolLocation","renderSymbolFootprints","renderSymbolKeyboard","renderSymbolKeyboardFilled","renderSymbolGlobe","renderSymbolGlobeBig","renderSymbolList","renderSymbolFlipVertical","renderSymbolFlipHorizontal","arrows","w2","h2","bezierCurveTo","side","vert","r1","r2","r3","r4","createRadialGradient","unit","drawDisk","w3","h3","quadraticCurveTo","n2","w4","setLineDash","k","detailed","arcTo","NONNUMBERS","ThreadManager","processes","wantsToPause","Process","topBlock","yieldFirst","instrument","readyToYield","readyToTerminate","isDead","isClicked","isShowingResult","errorFlag","homeContext","lastYield","isFirstStep","prompter","httpRequest","isPaused","pauseOffset","frameCount","exportResult","procedureCount","flashingContext","isInterrupted","canBroadcast","variables","parentFrame","blockSequence","pushContext","parentContext","expression","outerContext","VariableFrame","inputs","pc","isContinuation","startTime","activeSends","activeAudio","activeNote","isCustomBlock","isCustomCommand","emptySlots","tag","isFlashing","accumulator","isTransient","JSCompiler","aProcess","process","gensyms","implicitParams","paramCount","List","array","rest","isLinked","lastChanged","ListWatcherMorph","parentCell","WorldMap","host","tileServers","OpenStreetMap","subdomains","credits","Wikimedia","Watercolor","Topographic","Satellite","Streets","Shading","api","lon","lat","zoom","tileXfromLon","tileYfromLat","tileSize","creditsTxt","creditsBG","initializeCredits","loading","SpriteMorph","StageMorph","SpriteHighlightMorph","isQuestion","noFit","shrinkToFit","maxExtent","svgImage","shapes","CostumeEditorMorph","audio","cachedSamples","audioBuffer","isDecoding","pitch","frequency","setupContext","oscillator","fader","ended","Microphone","audioContext","sourceStream","processor","analyser","resolution","GOOD_ENOUGH_CORRELATION","modifier","compiledModifier","compilerProcess","correlations","wrapper","outChannels","volume","signals","output","frequencies","isStarted","isReady","isAutoStop","protocol","WatcherMorph","isHidden","StagePrompterMorph","question","SyntaxElementMorph","BlockLabelMorph","BlockSymbolMorph","BlockMorph","CommandBlockMorph","HatBlockMorph","ReporterBlockMorph","isPredicate","RingMorph","ScriptsMorph","ArgMorph","CommandSlotMorph","RingCommandSlotMorph","InputSlotMorph","choiceDict","InputSlotStringMorph","InputSlotTextMorph","TemplateSlotMorph","BooleanSlotMorph","initialValue","isBlockLabel","TextSlotMorph","ColorSlotMorph","BlockHighlightMorph","threadCount","MultiArgMorph","slotSpec","labelTxt","eSpec","arrowColor","isTransparent","ArgLabelMorph","argMorph","FunctionSlotMorph","ReporterSlotMorph","RingReporterSlotMorph","CommentMorph","ScriptFocusMorph","editor","initialElement","PushButtonMorph","ToggleButtonMorph","query","hasPreview","isPicture","TabMorph","ToggleMorph","builder","ToggleElementMorph","DialogBoxMorph","AlignmentMorph","InputFieldMorph","PianoMenuMorph","soundType","PianoKeyMorph","CustomBlockDefinition","variableNames","comment","codeMapping","codeHeader","translations","editorDimensions","cachedIsRecursive","cachedTranslation","storedSemanticSpec","guid","isImported","isProto","CustomReporterBlockMorph","JaggedBlockMorph","BlockLabelFragment","defaultValue","options","isDeleted","BlockLabelFragmentMorph","BlockLabelPlaceHolderMorph","InputSlotDialogMorph","fragment","BlockExportDialogMorph","serializer","BlockImportDialogMorph","BlockRemovalDialogMorph","Table","rows","colCount","rowCount","colNames","rowNames","TableCellMorph","isLabel","table","startRow","startCol","globalColWidth","colWidths","rowHeight","colLabelHeight","tableMorph","noResize","timeout","isCatchingErrors","enableHyperOps","enableLiveCoding","enableSingleStepping","enableCompiling","flashTime","compileFunction","implicitParamCount","hasEmptySlots","parameters","parms","isEmptySlot","pName","pn","compileSequence","compileExpression","rcvr","compileInfix","compileInput","evaluate","compileInputs","isSnapObject","commandBlock","operator","inp","blockSpec","reportTypeOf","enableTables","cons","car","cdr","at","becomeArray","put","snapEquals","isEmpty","isTable","Variable","colName","rowName","count","repeat","columnNames","itemsArray","asText","becomeLinked","tail","asCSV","encodeCell","atomicValue","cell","asJSON","guessObjects","JSON","stringify","objectify","every","isUniqueIn","canBeObject","equalTo","j","loopcount","it","canBeCSV","hasOnlyAtomicData","canBeJSON","blockify","limit","bool","blockForSelector","slots","removeInput","replaceInput","addInput","fixBlockColor","cellColor","readOnly","lastUpdated","lastCell","startIndexMenu","frame","handle","arrow","ArrowMorph","plusButton","outlineColor","rounding","update","anyway","morphs","starttime","CellMorph","updateLength","notDone","setStartIndex","arrangeCells","expand","fe","ide","IDE_Morph","palette","TableDialogMorph","showTableView","view","TableFrameMorph","TableMorph","positionTalkBubble","setHost","setZoom","setView","refresh","panBy","lonFromTileX","latFromTileY","wrapTile","exp","lonFromSnapX","latFromSnapY","snapXfromLon","snapYfromLat","distanceInKm","lat1","lon1","lat2","lon2","dLat","dLon","atan2","tileX","tileY","coords","tile","tileOrigin","tileDistance","tileGrid","originTile","mapOrigin","ok","cx","cy","crd","addCredits","crossOrigin","categories","blockColor","motion","looks","sound","control","sensing","operators","paletteColor","paletteTextColor","isCachingPrimitives","enableNesting","enableFirstClass","useFlatLineEnds","highlightBorder","bubbleColor","bubbleFontSize","bubbleFontIsBold","bubbleCorner","bubbleBorder","bubbleBorderColor","bubbleMaxTextWidth","initBlocks","only","turnLeft","doFaceTowards","gotoXY","doGotoObject","doGlide","changeXPosition","setXPosition","changeYPosition","setYPosition","bounceOffEdge","xPosition","yPosition","doSwitchToCostume","doWearNextCostume","getCostumeIdx","reportGetImageAttribute","reportNewCostume","reportNewCostumeStretched","doSayFor","bubble","doThinkFor","doThink","changeEffect","setEffect","getEffect","clearEffects","changeScale","setScale","getScale","reportShown","goToLayer","goBack","doScreenshot","dev","reportCostumes","alert","playSound","doPlaySoundUntilDone","doPlaySoundAtRate","doStopAllSounds","reportGetSoundAttribute","reportNewSoundFromSamples","doRest","doPlayNote","doPlayFrequency","doSetInstrument","doChangeTempo","doSetTempo","getTempo","changeVolume","setVolume","getVolume","changePan","setPan","getPan","playFreq","stopFreq","reportSounds","getPenDown","setPenHSVA","changePenHSVA","getPenAttribute","setBackgroundColor","setBackgroundHSVA","changeBackgroundHSVA","changeSize","doStamp","floodFill","reportPenTrailsAsCostume","reportPentrailsAsSVG","doPasteOn","doCutFrom","receiveGo","receiveKey","receiveInteraction","receiveMessage","receiveCondition","doBroadcast","doBroadcastAndWait","getLastMessage","doSend","doWait","doWaitUntil","doForever","doRepeat","doUntil","doFor","doIf","doIfElse","reportIfElse","doStopThis","doRun","fork","doReport","doCallCC","reportCallCC","doWarp","doTellTo","reportAskFor","receiveOnClone","createClone","newClone","removeClone","doPauseAll","reportTouchingObject","reportTouchingColor","reportColorIsTouchingColor","reportAspect","reportStackSize","reportFrameCount","reportThreadCount","doAsk","reportLastAnswer","getLastAnswer","reportMouseX","reportMouseY","reportMouseDown","reportKeyPressed","reportRelationTo","doResetTimer","reportTimer","getTimer","reportAttributeOf","reportObject","reportURL","doSetGlobalFlag","reportGlobalFlag","reportDate","reportGet","reportAudio","reifyScript","alias","reifyReporter","reifyPredicate","reportSum","reportDifference","reportProduct","reportQuotient","reportRound","reportMonadic","reportPower","reportModulus","reportRandom","reportLessThan","reportEquals","reportGreaterThan","reportAnd","reportOr","reportNot","reportBoolean","reportFalse","reportJoinWords","reportLetter","reportStringSize","reportUnicode","reportUnicodeAsLetter","reportIsA","reportIsIdentical","reportTextSplit","reportJSFunction","reportTextFunction","reportCompiled","doSetVar","doChangeVar","doShowVar","doHideVar","doDeclareVariables","doDeleteAttr","reportNewList","reportCONS","reportListItem","reportCDR","reportListLength","reportListContainsItem","reportListIsEmpty","reportListIndex","doAddToList","doDeleteFromList","doInsertInList","doReplaceInList","reportNumbers","reportConcatenatedLists","reportMap","reportAtomicMap","reportKeep","reportAtomicKeep","reportFindFirst","reportAtomicFindFirst","reportCombine","reportAtomicCombine","doForEach","doShowTable","doMapCodeOrHeader","doMapValueCode","doMapListCode","reportMappedCode","doSetVideoTransparency","reportVideo","initBlockMigrations","blockMigrations","doStopAll","doStop","doStopBlock","doStopOthers","receiveClick","reportTrue","doMapStringCode","reportDistanceTo","comeToFront","setHue","setBrightness","changeHue","changeBrightness","reportIsFastTracking","doSetFastTracking","blockAlternatives","costumes","sounds","normalExtent","isTemporary","isCorpse","cloneOriginName","gainNode","pan","pannerNode","freqPlayer","cachedHSV","inheritedMethodsCache","parts","anchor","nestingScale","rotatesWithAnchor","layers","blocksCache","paletteCache","rotationOffset","graphicsValues","exemplar","instances","cachedPropagation","inheritedAttributes","imageExtent","imageOffset","motionAmount","motionDirection","frameNumber","forClone","cb","effect","arr","stopTalking","att","inheritedVariableNames","shadowVar","getVar","addSpecimen","def","copyAndBindTo","allBlockInstances","cst","dp","attachPart","appearIn","newSpriteName","corral","addSprite","setName","currentCenter","isFlipped","isLoadingCostume","imageSide","stageScale","costumeExtent","flipped","wearCostume","applyGraphicsEffects","canvasContext","newExtent","pixels","Uint32Array","buffer","projectionSnap","rot","snap","projectionLayer","newCostumeName","setDefaults","migration","isStatic","setSpec","variableBlock","varName","isLocalTemplate","isLocalVarTemplate","makeBlockButton","showHelp","freshPalette","searchButton","makeButton","ry","hideNextSpace","shade","labelShadowColor","defs","hiddens","more","searchBlocks","hiddenPrimitives","flushBlocksCache","refreshPalette","blockTemplates","globalBlocks","templateInstance","inheritedBlocks","ghost","blocksMatching","searchString","strictly","types","varNames","blocksDict","reporterized","search","labelOf","aBlockSpec","parseSpec","relevance","aBlockLabel","aSearchString","atWord","anInt","totalDigits","fillChar","fillDigits","primitive","newBlock","vName","rel","blocksList","localizedSpec","reporterize","scriptFocus","oldSearch","searchBar","searchPane","createPalette","showSelection","logo","contrast","insertBlock","getValue","reactToKeystroke","reactToInput","expressionString","ast","parseInfix","nested","expr","blockFromAST","selectors","monads","inps","reverseDict","not","addVariable","globalVariables","addVar","deleteVariable","deleteVariableWatcher","deleteVar","addCostume","shadowAttribute","silentGotoXY","specimens","instance","inheritsAttribute","doWearPreviousCostume","dimensions","addSound","doPlaySound","aud","gain","getGainNode","getPannerNode","resume","createMediaElementSource","connect","play","activeSounds","terminated","setValueAtTime","log2","currentTime","createGain","getAudioContext","panner","createStereoPanner","hz","note","createOscillator","noteOn","noteOff","setInstrument","setValueCurveAtTime","fadeIn","fadeTime","allParts","anchors","isAppMode","enableInheritance","anchorsMenu","targets","attachTo","thumbnail","exportSprite","selectSprite","showOnStage","duplicate","duplicateSprite","instantiate","instantiateSprite","removeSprite","immediately","clone","cloneCount","clonify","allHatBlocksFor","threads","startProcess","isThreadSafe","initClone","hats","stopAllForReceiver","detachPart","corpsify","setExemplar","perpetuate","perpetuateAndEdit","release","inst","watchers","watcher","createCorral","currentSprite","toggleAppMode","setVisibility","talkBubble","setColorComponentHSVA","getColorComponentHSLA","changeColorComponentHSVA","attrib","goToBack","layer","targetLayer","newLayer","thisColor","thatColor","otherSprite","fancyThumbnail","neighbors","aStage","myPerimeter","perimeter","eachPerimeter","cachedPenTrailsMorph","clearPenTrails","trans","blitOn","mask","sourceCostume","targetCostume","relRot","relScale","centerDist","centerDelta","centerAngleRadians","originDist","originAngleRadians","sourceHeading","targetHeading","rasterized","setPenDown","percentage","realScale","xDist","yDist","graphicsChanged","imagedata","fisheye","newImageData","newPixels","centerX","centerY","srcX","srcY","srcI","transform_fisheye","whirl","scaleX","scaleY","whirlRadians","radiusSquared","factor","sina","cosa","transform_whirl","pixelate","transform_pixelate","mosaic","transform_mosaic","transform_duplicate","saturation","brightness","hueShift","saturationShift","brightnessShift","span","newR","newG","newB","transform_HSV","negative","rcom","gcom","bcom","transform_negative","comic","transform_comic","confetti","transform_confetti","eff","getGhostEffect","middle","recordLayers","enableCustomHatBlocks","refreshInheritedAttribute","restoreLayers","receiveUserInteraction","stagePos","damagedFrom","damagedTo","damaged","enablePenLogging","trailsLog","snapPoint","stack","trailsCanvas","shrinkWrap","inheritsX","inheritsY","nestingBounds","dot","dir","isFinite","trg","faceToXY","angleToXY","penSize","penState","glide","endX","endY","startPoint","fraction","rPos","dirX","dirY","setRotationX","absoluteX","setRotationCenter","setRotationY","absoluteY","absoluteCoordinate","moveRotationCenter","worldCoordinate","xCenter","yCenter","xLeft","xRight","yTop","yBottom","allMessageNames","msgs","allScripts","allSendersOf","message","receiverName","known","isSending","allHatBlocksForKey","allHatBlocksForInteraction","interaction","hasGenericHatBlocks","allGenericHatBlocks","all","scr","rightAway","threadSafe","procs","lastAnswer","refactorVariableInstances","oldName","newName","hasSpriteVariable","refactorVarInStack","findVariableWatcher","toggleVariableWatcher","others","showingVariableWatcher","toggleWatcher","watcherFor","showingWatcher","deleteAllBlockInstances","allIndependentInvocationsOf","deleteBlock","purgeCorpses","allSpecimens","inDefinitions","allLocalBlockInstances","eachScript","aSpec","getMethod","allInvocationsOf","addAllInvocationsOf","allDependentInvocationsOf","inScripts","inBlockEditors","allEditorBlockInstances","anArray","getLocalMethod","inPalette","paletteBlockInstance","BlockEditorMorph","isPrototype","PrototypeHatBlockMorph","usesBlockInstance","forRemoval","skipGlobals","skipBlocks","doubleDefinitionsFor","blockList","replaceDoubleDefinitionsFor","doubles","double","flushPaletteCache","pauseGenericHatBlocks","pauseCustomHatBlocks","controlBar","stopButton","chooseExemplar","allExemplars","aSprite","eachSprite","another","enableError","emancipate","prune","shadowAllAttributes","shadowAllMethods","shadowAllVars","removeSpecimen","aName","updatePropagationCache","shadowedAttributes","inherited","wardrobe","jukebox","createSpriteEditor","fixMultiArgs","spriteEditor","inheritAttribute","toggleInheritanceForAttribute","isVariableNameInUse","allNames","toggleInheritedVariable","shadowedOnly","own","deletableVariableNames","locals","allLocalVariableNames","sorted","reachableGlobalVariableNames","allBlocks","ownBlocks","dict","valuesOnly","inheritedMethods","dup","xOut","compositeOperation","fullThumbnail","thumb","booleanMorph","sym","detachAllParts","detachFromAnchor","allAnchors","layerCache","flash","addHighlight","removeHighlight","oldHighlight","highlight","getHighlight","toggleHighlight","highlightImage","hi","highlights","SpriteIconMorph","ignoredCostume","ix","stem","imgSource","newSoundName","ignoredSound","frameRate","codeMappings","codeHeaders","enableCodeMapping","enableSublistIDs","isFastTracked","timerStart","lastMessage","watcherUpdateFrequency","lastWatcherUpdate","keysPressed","microphone","remixID","projectionSource","getProjectionImage","stopProjectionSource","continuousProjection","projectionCanvas","projectionTransparency","mirrorVideo","videoMotion","worldMap","messageCallbacks","relativePos","ws","hs","penTrailsMorph","trails","clearProjectionLayer","startVideo","noCameraSupport","dialog","VideoMotion","mediaDevices","getUserMedia","video","then","stream","getVideoImage","stopVideo","srcObject","catch","getTracks","track","stopProjection","leftPos","resetTimer","setTempo","bpm","changeTempo","keyPressed","stepGenericConditions","pauseButton","updateProjection","addFrame","stopAll","hatCount","doWhen","processKeyEvent","fireKeyEvent","removePressedKey","fireGreenFlagEvent","editScripts","saveProjectsBrowser","fireStopAllEvent","openProjectsBrowser","createNewProject","redrop","undrop","removeAllClones","resumeAll","runStopScripts","stopAllActiveSounds","enableKeyboard","sortedScripts","nextCommand","cat","isLocal","watcherToggle","variableWatcherToggle","VariableDialogMorph","saveCanvasAs","hasChangedMedia","spriteBar","tabBar","tabTo","showAll","excludedSprite","fimg","exportTrailsLogAsSVG","saveFileAs","trailsLogAsSVG","box","svg","normalizePoint","makeBlock","pause","pauseAllActiveSounds","resumeAllActiveSounds","globalBlocksSending","collectDependencies","dep","canvasBoundingBox","getAlpha","getLeft","getTop","getRight","getBottom","stretched","xRatio","yRatio","editRotationPointOnly","anIDE","setPicture","addBody","addButton","noPadding","isTainted","shape","parseShapes","XML_Element","atob","parseString","fromSVG","isnew","oncancel","onsubmit","VectorPaintEditorMorph","openIn","margin","rp","createTexture","grey","Float32Array","fadeOut","AudioContext","mozAudioContext","msAudioContext","oAudioContext","webkitAudioContext","createGainNode","fade","isOn","binSizes","binSize","setResolution","setupNodes","onaudioprocess","disconnect","createProcessor","createAnalyser","createMediaStreamSource","bufLength","fftSize","frequencyBinCount","Uint8Array","createScriptProcessor","stepAudio","clipping","lastClip","clipLevel","averaging","clipLag","channels","inputBuffer","getChannelData","outputBuffer","numberOfChannels","getByteFrequencyData","detectPitchAndVolume","sampleRate","buf","correlation","lastCorrelation","modified","SIZE","MAX_SAMPLES","best_offset","best_correlation","rms","foundGoodCorrelation","performance","invoke","isBig","labelText","isGhosted","readoutColor","currentValue","labelMorph","sliderMorph","cellMorph","setSliderMin","setSliderMax","updateLabel","isList","setVar","big","typeInPadding","vNames","shiftClicked","importData","varFrame","monitor","raw","filePicker","display","ftype","isType","parseCSV","parseJSON","isTextFile","confirm","click","parseTxt","setStyle","styleNormal","styleLarge","styleSlider","userSetSliderMin","userSetSliderMax","isDone","inputField","flatEdge","jag","hatHeight","hatWidth","rfBorder","dent","bottomPadding","cSlotPadding","labelPadding","labelFontName","labelFontStyle","embossing","labelWidth","labelWordWrap","dynamicInputLabels","feedbackMinHeight","minSnapDistance","reporterDropFeedbackPadding","labelContrast","activeHighlight","errorHighlight","activeBlur","activeBorder","rfColor","isCachingInputs","cachedClr","cachedClrBright","cachedClrDark","cachedNormalColor","cachedInputs","isNonPartMorph","nextBlock","debugCachedInputs","realInputs","allInputs","allEmptySlots","empty","tagExitBlocks","stopTag","isCommand","partOfCustomCommand","exitTag","oldArg","newArg","replacement","cachedSlotSpec","fixLabelColor","revertToDefaultInput","noValues","deflt","labelPart","scriptTarget","setChoices","inputOptionsOfIdx","defaultValueOfInputIdx","emptySlot","isLocked","isScriptVar","inputNames","definesScriptVariable","CustomCommandBlockMorph","input","selectionID","grabbedMorph","affected","allComments","align","bright","dark","isLoop","unflash","doWithAlpha","nearestBlock","isForced","tokens","isObjInputFragment","canBeEmpty","isBlockLabelBreak","getSpec","isUnevaluated","last","z","ceiling","asin","acos","ln","lg","front","back","hue","transparency","Number","header","isLambda","getSlotSpec","blockHeight","bottomCorrection","lineHeight","blockWidth","ico","hasLocationPin","methodIconExtent","hasLoopCSlot","hasLoopArrow","adjustMultiWidth","fixLoopLayout","fixHighlight","exportPictureWithResult","aBubble","bub","taller","mappedCode","definitions","isFading","nextId","copyIDs","zebraContrast","snapSound","toggleSnapSound","instantiationSpec","getNewID","blockId","userDestroy","inputIdx","placeHolder","userSetSpec","tb","buildSpec","trim","rebuild","showMessageUsers","knownSenders","stageIcon","eventReceiver","hidePrimitive","isInheritedVariable","isTransientVariable","silentFind","toggleTransientVariable","tobefixed","isindef","ringify","ring","embed","unringify","relabel","alternativeSelectors","oldInputs","alternative","restoreInputs","setSelector","aSelector","inputOffset","surplus","setCategory","blk","leftOver","nestedBlock","constant","blockEditor","help","helpSpec","blockInstance","refreshDefaults","resourceURL","exportResultPic","stopProcess","mapToHeader","codeDefinitionHeader","promptCode","mapToCode","codeMappingHeader","mapHeader","mapCode","codeLines","headers","headerLines","bodyLines","defKey","headerLine","indent","prefix","trimLeft","RegExp","partLines","rx","codeLine","hat","alternateBlockColor","refactorThisVar","justTheTemplate","doRefactorBlockParameter","doRefactorRingParameter","doRefactorScriptVar","doRefactorSpriteVar","doRefactorGlobalVar","getVarNamesDict","varExistsError","where","fragMorph","BlockInputFragmentMorph","definer","updateBlockLabel","oldValue","oldWatcher","eachBlock","clipWidth","scriptPic","stackFullBounds","clearAlpha","drawEdges","drawMethodIcon","isNormal","cSlots","addErrorHighlight","highlightImageBlurred","cslot","nearest","forceNormalColoring","fixChildrensBlockColor","hasLabels","initializeVariables","cmnt","hasBlockVars","dragged","droppedMorph","wrld","bindingID","startFollowing","stopFollowing","justThis","stackHeight","commentsBottom","stackWidth","commentsRight","bottomBlock","topAttachPoint","dentCenter","bottomAttachPoint","wrapAttachPoint","dentLeft","attachTargets","tp","loc","enableNestedAutoWrapping","isStop","allAttachTargets","newParent","rejectsHats","closestAttachTarget","thresh","ref","minDist","eachTarget","eachRef","before","offsetY","clearDropInfo","lastDroppedBlock","recordDrop","lastDropTarget","lastNextBlock","lastWrapParent","slotAttachPoint","cmd","handMorph","extract","userDestroyJustThis","dropRecord","removeBlock","userExtractJustThis","pb","cs","bottomCorner","drawTopDentEdge","drawBottomDentEdge","drawLeftEdge","drawRightEdge","drawTopLeftEdge","drawBottomRightEdge","upperGradient","lowerGradient","leftGradient","lgx","rightGradient","drawFlatBottomDentEdge","drawDent","cslots","sa","sp","closestInput","lastReplacedInput","lastPreservedBlocks","determineSlotSpec","outlinePathDiamond","outlinePathOval","drawEdgesDiamond","drawEdgesOval","aBlock","noVanish","vanishForSimilar","dataType","cleanUpMargin","cleanUpSpacing","isPreferringEmptySlots","feedbackColor","feedbackMorph","isAnimating","showCommentDropFeedback","showReporterDropFeedback","showCommandDropFeedback","showReporterDropFeedbackFromTarget","showCSlotWrapFeedback","closestBlock","titleBar","srcBlock","trgBlock","handPos","stacks","hasUndropQueue","toggle","offHint","lastRecord","nextRecord","BlockDialogMorph","exportScriptsPicture","scriptsPicture","addComment","lastOrigin","recoverLastDrop","updateToolbar","forRedrop","dropped","rec","lastGrabOrigin","record","addToolbar","respectHiddens","undoButton","redoButton","keyboardButton","toggleKeyboardEntry","argId","argIndex","executeOnSliderEdit","drawFlat","isFilled","ins","rf","ox","oy","reify","drawTopRightEdge","drawTopEdge","drawBottomEdge","selectedBlock","oldContentsExtent","isConstant","userSetContents","aStringOrFloat","dropDownMenu","menuFromDict","noEmptyOption","flag","reactToSliderEdit","getImg","fKey","messagesMenu","__shout__go__","messagesReceivedMenu","collidablesMenu","locationMenu","distancesMenu","clonablesMenu","objectsMenuWithSelf","objectsMenu","includeMyself","typesMenu","Boolean","gettablesMenu","nest","oop","clones","attributesMenu","costumesMenu","Turtle","Empty","soundsMenu","shadowedVariablesMenu","pianoKeyboardMenu","selectKey","directionDialMenu","audioMenu","readonly","arrowWidth","reactToEdit","freshTextEdit","mapStringToCode","mapNumberToCode","drawRoundBorder","drawRectBorder","tmp","isTernary","progress","isBinary","boolOrNull","toggleValue","nextValue","mapTrueToCode","mapFalseToCode","boolTrue","boolFalse","textLabelExtent","drawDiamond","drawLabel","drawKnob","slideStep","topColor","bottomColor","isLbl","pad","getUserColor","mouseMoveBak","mouseDownBak","mouseUpBak","pal","readout","updateReadout","leftArrow","rightArrow","minInputs","elementSpec","fixArrowsLayout","inpCount","dim","is3ArgRingInHOF","newPart","oldPart","repetition","mapCodeList","mapCodeItem","mapCodeDelimiter","itemCode","delim","drawRounded","shrink","enableCommandDrops","refreshScale","stickyOffset","isCollapsed","toggleExpand","setTextWidth","tw","ignoreLayer","affectedBlocks","rightMost","atEnd","manifestStatement","manifestExpression","newScript","insertVariableGetter","deleteLastElement","lastElement","fillInBlock","nextElement","blockTypes","shiftScript","lastCommand","cm","nextScript","lastScript","runScript","reactToKeyEvent","labelShadowOffset","outlineGradient","labelMinExtent","isDisabled","updateLabelColors","drawOutline","drawBackground","outlineStyle","minInset","shading","disable","enable","labelPressColor","state","hasNeutralBackground","trueStateLabel","lw","getPressRenderColor","previewPath","eh","captionString","labelAlignment","toggleElement","shadowAlpha","inactiveColor","titleFontSize","titleTextColor","titleBarColor","titlePadding","buttonContrast","buttonFontSize","buttonCorner","buttonEdge","buttonPadding","buttonOutline","buttonOutlineColor","buttonOutlineGradient","head","buttons","createButtons","textString","askYesNo","defaultString","sliderMin","sliderMax","sliderAction","decimals","sld","precision","reactToChoice","instructions","bdy","getInput","promptVector","xLabel","yLabel","vec","xInp","yInp","xCol","yCol","promptCredentials","purpose","tosURL","tosLabel","prvURL","prvLabel","checkBoxLabel","bmn","byr","emlLabel","chk","usr","eml","pw1","pw2","opw","agree","dof","mCol","lnk","years","currentYear","getFullYear","firstYear","linkButton","btn","checklist","em","indicate","validInputs","username","email","oldpassword","passwordRepeat","month","today","year","monthName","getMonth","withKey","normalizeSpaces","aMorphOrCanvas","addHead","th","outlinePathTitle","outlinePathBody","lfb","cfb","setChoice","setIsNumeric","blackkey","keycolor","keywidth","keyheight","keyposition","aPianoKeyItem","midiNum","Note","piano","storeTranslations","storedTranslations","translationsAsText","prototypeInstance","headerOnly","XML_Serializer","idProperty","typeOf","inputName","has","defaultValueOf","dropDownMenuOfInputIdx","dropDownMenuOf","isReadOnlyInputIdx","isReadOnlyInput","inputOptionsOf","fname","parseChoices","params","quoted","isDirectlyRecursive","myspec","locParts","SnapTranslator","language","sem","isInput","str","abstractBlockSpec","lang","updateTranslations","scriptsModel","sortedElements","proto","excluding","semanticSpec","oldVars","aDefinition","newSpec","CSlotMorph","refreshPrototype","protoSpec","newFrag","frags","specFromFragments","blockCategory","refreshPrototypeSlotTypes","defTemplateSpecFragment","inputFragmentNames","upvarFragmentNames","upvarFragmentName","defSpecFragment","blockSpecFromFragments","blockSpecFragment","declarationsFromFragments","alternatives","allDefs","isInUse","duplicateBlockDefinition","deleteBlockDefinition","exportBlockDefinition","jags","blockType","scopes","createCategoryButtons","fixCategoriesLayout","createTypeButtons","createScopeButtons","openForChange","preventTypeChange","addCategoryButton","buttonWidth","buttonHeight","addBlockTypeButton","setType","addTypeButton","addScopeButton","setScope","varType","enableBlockVars","prot","pref","suff","isUpvar","isMultipleInput","hasOptions","hasSpecialMenu","isSingleInput","setToSingleInput","singleInputType","setToMultipleInput","setToUpvar","setSingleInputType","sO","frag","isPlaceHolder","isOnlyElement","newFragment","symbolColor","plainLabel","isLaunchingExpanded","fh","textfield","isExpanded","noDelete","createSlotTypeButtons","fixSlotsLayout","addSlotsMenu","noticesTransparentClick","fragmentType","symbolMenu","defaultSwitch","defaultInputField","noDeleteButton","symbols","deleteFragment","defLabel","defInput","defSwitch","loopArrow","settingsButton","addSlotTypeButton","radioButtonSingle","addSlotArityButton","setSlotArity","defaultInputLabel","setSlotType","arity","setSlotOptions","xPadding","ypadding","ah","specialOptionsMenu","specialSlotsMenu","editSlotOptions","addSpecialSlotType","addSpecialOptions","exportBlocks","buildContents","checkBox","lastCat","selectNone","serialize","saveXMLAs","importBlocks","removeBlocks","showMessage","demo","fillWithTestData","setRows","rowsArray","setCols","colsArray","setColNames","setRowNames","setColName","setRowName","addRow","addCol","toList","eachRow","cachedListSymbol","listSymbol","setData","txtWidth","txtHeight","dataRepresentation","highContrast","shouldBeList","background","isOvershooting","foreground","raggedBoxPath","Context","tm","columnAt","textHeight","tableVersion","rowLabelWidth","columns","maxStartRow","maxStartCol","dragAnchor","resizeAnchor","resizeCol","resizeRow","wantsUpdate","initScrollBars","showData","updateScrollBars","rowLabelsWidth","columnsLayout","visibleRows","buildCells","colWidth","drawData","noScrollUpdate","cellIdx","xSteps","ySteps","shiftCells","resizeCells","oldCols","oldRows","colNum","possible","globalExtent","relativeX","resetColumns","openInDialog","showListView","SpriteBubbleMorph","tableView","setInitialDimensions","mex","findProcess","lastRun","toggleProcess","activeProcess","blackList","touchingVariadicArrowsIfAny","cleanUp","silently","tempVars","allNamesDict","my","Localizer","PaintEditorMorph","PaintColorPickerMorph","PaintCanvasMorph","contextArgs","timeoutErrorMsg","suppressErrors","callerProcess","returnContext","proc","deadline","reportContextFor","initializeFor","isRunning","runStep","ReadStream","arrayOrString","isCollectingMedia","isExportingBlocksLibrary","SnapSerializer","Cloud","languages","languageName","language_name","language_translator","last_changed","unload","keep","en","de","ja","ja_HIRA","ko","pt","zh_CN","eo","fr","si","ru","es","nl","pl","zh_TW","no","dk","ca","ca_VA","fi","sv","pt_BR","bn","kn","ml","ta","te","tr","hu","ia","hr","ar","et","gl","eu","ua","sk","he","paper","controls","edits","buildEdits","toolbox","buildToolbox","scaleBox","buildScaleBox","propertiesControls","colorpicker","penSizeSlider","penSizeField","primaryColorButton","primaryColorViewer","constrain","populatePropertiesMenu","refreshToolButtons","tools","brush","eraser","crosshairs","rectangleSolid","circleSolid","paintbucket","pipette","tool","toolButton","drawcrosshair","pushButton","clearCanvas","undoBuffer","switchToVector","oldim","oldrc","automaticCrosshairs","centermerge","drawNew","updateAutomaticCenter","alpen","brushControl","settings","primarycolor","linewidth","currentTool","toolChanged","colorselection","dragRect","previousDragPoint","erasermask","brushBuffer","isShiftPressed","calculateCanvasCenter","canvasBounds","cacheUndo","cachecan","floodfill","sourcepoint","currentpoint","sourcecolor","checkpoint","relpos","mctx","pctx","strokeRect","newW","newH","bkctx","can","drawFrame","inheritedVars","helpMenu","isText","scaledImg","dataAsMorph","isCircular","listwatcher","isSameList","isSameTable","createContents","drawShadow","listWatcher","textMorph","newValue","isInherited","atomic","glow","newProc","removeTerminatedProcesses","processesForBlock","excpt","stopAllForBlock","aTopBlock","pauseAll","remaining","showBubble","stopIt","pred","toggleSingleStepping","pauseStep","evaluateContext","popContext","stopMusic","flashPausedContext","expectReport","evaluateSequence","evaluateMultiSlot","evaluateArgLabel","evaluateInput","evaluateBlock","returnValueToParentContext","argCount","handleError","evaluateNextInput","flashContext","doStopCustomBlock","doStopWarping","multiSlot","argLabel","doYield","errorObsolete","parameterNames","for","reportScript","parmNames","blockReceiver","runContinuation","exit","runnable","caller","isReporter","continuation","copyForContinuationCall","evaluateCustomBlock","method","doSet","assertType","changeVar","reportGetVar","doChangePrimitiveVisibility","find","doRemoveTemporaries","hideIt","attrName","inputOption","shadowListAttribute","reportBasicRandom","rank","reportItems","indices","makeSelector","makeBranch","makeLeafSelector","hyperDyadic","strt","stp","reportBasicNumbers","reportLinkedNumbers","rowIdx","concatenateLinkedLists","startFastTracking","stopFastTracking","counter","goalCondition","upvar","secs","startValue","thread","samples","Sound","decodeSound","encodeSound","onended","soundName","option","untype","base64","binaryString","arrayBuffer","audioCtx","charCodeAt","decodeAudioData","createBuffer","copyToChannel","channel","createBufferSource","blob","audioBufferToWav","opt","numChannels","float32","bitDepth","inputL","inputR","inputIndex","interleave","encodeWAV","bytesPerSample","blockAlign","ArrayBuffer","DataView","writeString","setUint8","setUint32","setUint16","setInt16","floatTo16BitPCM","setFloat32","writeFloat32","typedArray","setMicrophoneModifier","isStage","isHiddenSprite","response","thisObj","rcvrs","getOtherObject","typeString","thingType","assertAlive","Costume","baseOp","isMatrix","hyperZip","cur","reportBasicSum","reportBasicDifference","reportBasicProduct","reportBasicQuotient","reportBasicPower","reportBasicModulus","random","reportBasicLessThan","reportBasicGreaterThan","isImmutable","log10","encodeURI","decodeURI","decodeURIComponent","escape","unescape","hex_sha512","reportJoin","aList","reportBasicLetter","codePointAt","fromCodePoint","delimiter","reportBasicTextSplit","del","strType","delType","rawParseCSV","guessDelimiterCSV","delims","firstLine","char","records","esc","listify","jsonObject","eachElement","eachKey","stageObj","thatObj","getObjectsNamed","those","check","setHSVA","changeHSVA","objectTouchingObject","mouse","aspect","spritesAtPoint","colorAtSprite","colorBelowSprite","found","relation","isCoordinate","reportDirectionTo","attribute","nameField","otherObj","receiverVars","rootVars","keyString","datefn","inputFn","dateMap","getLocalMotion","getStageMotion","anOption","doMapCode","doMapHeader","kind","key1","key2","beats","reportTempo","doPlayNoteForSecs","doPlayFrequencyForSecs","costumeNamed","xP","yP","px","acc","ready","SVG_Costume","rotationShift","stackSize","flashable","lastFlashable","doInterrupt","doIdle","capture","clos","getVarNamed","setVarNamed","incrementVarNamed","func","formalParameterCount","reportAtomicSort","reportAtomicGroup","groupKey","cont","copyForContinuation","prepareContinuationForBinding","sender","upTo","addKeysToDict","srcDict","trgtDict","nonSpace","nonWord","peek","peekUpTo","skipSpace","lastIndex","exec","indentation","require","fallback","childNamed","childrenNamed","parentNamed","isFormatted","indentationLevel","ignoreQuotes","parseStream","mediaIdProperty","mediaDetectionProperty","forBlocksLibrary","xml","flush","flushMedia","store","mediaID","addMedia","mediaXML","integer","xmlString","appParent","thumbnailSize","watcherLabels","mediaDict","loadProjectModel","xmlNode","appInfo","sourceApp","sourceAppParent","rawLoadProjectModel","model","nameID","localStorage","notes","loadColor","penlog","pentrails","ternary","hyperops","codify","inheritance","sublistIDs","loadCustomBlocks","populateCustomBlocks","loadObject","loadValue","inheritanceInfo","delegated","nestingInfo","synch","costumeNumber","close","editing","defaultGUID","loadEditing","loadVariables","extX","extY","loadBlocks","targetStage","loadSprites","loadMedia","loadMediaModel","dispatches","loadInheritanceInfo","loadNestingInfo","loadCostumes","loadSounds","loadScripts","transient","isDispatch","loadCustomBlock","loadComment","populateCustomBlock","loadScript","loadScriptsArray","allSprites","editingDefinition","originalDefinition","editingSprite","oldUpdate","updateDefinition","Trace","logErrorMessage","scriptsPaneTexture","loadBlock","setBlockId","migrationOffset","obsoleteBlock","loadInput","wish","struct","oncanplaythrough","colorString","openProject","projectNotes","setProjectData","reduce","thumbdata","excludeMedia","costumeIdx","editingBlocks","projectData","getProjectData","assignment","applyToDefinition","noCostumes","noSounds","noScripts","isVar","toScriptXML","savePosition","toBlockXML","decl","mediaContext","apiBasePath","determineCloudDomain","disabled","MAX_FILE_SIZE","knownDomains","defaultDomain","currentDomain","metaTag","querySelector","cloudDomain","domainMap","getAttribute","server","isMatchingDomain","client","parseDict","entry","encodeDict","genericErrorMessage","genericError","path","onSuccess","onError","errorMsg","wantsRawResponse","fullPath","setRequestHeader","withCredentials","errors","withCredentialsRequest","checkCredentials","initSession","getCurrentUser","user","verified","role","getUser","logout","login","persist","signup","password_repeat","changePassword","newPassword","newpassword","resetPassword","resendVerification","saveProject","getProjectList","withThumbnail","getPublishedProjectList","page","pageSize","searchTerm","getThumbnail","getProject","getPublicProject","getProjectMetadata","getProjectVersionMetadata","getRemixes","deleteProject","shareProject","unshareProject","publishProject","unpublishProject","updateNotes","updateProjectName","projectname","newCollection","collectionName","getCollectionMetadata","collectionUsername","getCollectionProjects","setCollectionThumbnail","thumbnailId","updateCollectionDescription","description","updateCollectionName","shareCollection","unshareCollection","publishCollection","unpublishCollection","addProjectToCollection","projectUsername","removeProjectFromCollection","projectId","getUserCollections","pagesize","matchtext","getCollectionsContainingProject","getCollections","deleteCollection","addEditorToCollection","editorUsername","editor_username","removeEditorFromCollection","showProjectPath","isAutoFill","ProjectDialogMorph","ProjectRecoveryDialogMorph","browser","LibraryImportDialogMorph","librariesData","CostumeIconMorph","aCostume","TurtleIconMorph","aSpriteOrStage","WardrobeMorph","SoundIconMorph","aSound","JukeboxMorph","StageHandleMorph","PaletteHandleMorph","CamSnapshotDialogMorph","onCancel","onAccept","SoundRecorderDialogMorph","requestAnimationFrame","setDefaultDesign","frameColor","groupColor","buttonLabelColor","tabColors","rotationStyleColors","appModeColor","scriptsTexture","setFlatDesign","userLanguage","projectsInURLs","applySavedSettings","cloud","cloudMsg","currentCategory","currentTab","paletteHandle","stageHandle","corralBar","embedPlayButton","embedOverlay","isEmbedMode","isSmallStage","paletteWidth","stageRatio","wasSingleStepping","loadNewProject","shield","savingPreferences","hash","urlLanguage","initUser","sessionStorage","cloudButton","cloudIcon","applyFlags","noCloud","embedMode","setEmbedMode","editMode","noRun","autoRun","hideControls","noExitWarning","setLanguage","runScripts","interpretUrlAnchors","getURL","rawOpenCloudDataString","rawOpenProjectString","Username","ProjectName","cloudError","createCloudAccount","intervalHandle","warnAboutIE","createLogo","createControlBar","createCategories","createStage","createSpriteBar","createCorralBar","snapMenu","startButton","projectButton","stageSizeButton","appModeButton","steppingButton","refreshResumeSymbol","steppingSlider","refreshSlider","pauseSymbols","changeCategory","toUpperCase","forSearching","createPaletteHandle","createStageHandle","padlock","rotationStyleButtons","thumbSize","labels","addRotationStyleButton","tabString","acceptDrops","newbutton","paintbutton","cambutton","enableCamera","notSupportedMessage","spriteIcon","arrangeIcons","maxPaletteWidth","setProjectName","minExt","maxHeight","minRatio","maxRatio","anImage","anAudio","fileType","openProjectString","openCloudDataString","openBlocksString","openSpritesString","openMediaString","openScriptString","openDataString","anArrayBuffer","loadYPR","pname","shouldIgnorePosition","oldTop","pressStart","toggleFastTracking","toggleVariableFrameRate","toggleCameraSupport","togglePauseResume","stopAllScripts","toggleRetina","refreshIDE","defaultDesign","removeSetting","flatDesign","saveSetting","newProject","design","getSetting","longform","longurls","plainprototype","keyboard","tables","tableLines","autoWrapping","solidshadow","setBlockTransparency","hasLocalStorage","addNewSprite","rnd","paintNewSprite","newCamSprite","recordNewSound","soundRecorder","makeSureRecordingIsMono","lastSound","eachSound","ignoredSprite","cloudMenu","hasCloudProject","urlParameters","exportProjectMedia","exportProjectNoMedia","exportProjectAsCloudData","prj","settingsMenu","addPreference","onHint","projectMenu","graphicsName","exportProject","exportGlobalBlocks","removeUnusedBlocks","exportProjectSummary","parseResourceFile","importLocalFile","importMedia","getMediaList","dirname","alphabetically","fileName","folderName","popupMediaImportDialog","selectedIcon","turtle","fp","fw","isSVG","isSound","prevSelected","onloadeddata","createThumbnail","btoa","aboutSnap","dlg","aboutTxt","noticeTxt","btn1","btn2","btn3","btn4","licenseBtn","translatorsBtn","morphic","editProjectNotes","saveProjectToCloud","plain","setURL","unused","trgIdx","pics","useDropShadows","toc","globalVars","addNode","addImage","inline","para","addVariables","ul","listMorph","li","class","addBlocks","charset","paragraph","ol","tocEntry","logError","rawOpenBlocksString","rawOpenSpritesString","rawOpenScriptString","rawOpenDataString","existing","newVarName","fileExt","blobIsSupported","mimeType","hasTypeStr","dataURItoBlob","saveAudioAs","switchToUserMode","getSpriteByName","switchToDevMode","toggleZebraColoring","toggleDynamicInputLabels","toggleLongFormInputDialog","togglePlainPrototypeLabels","togglePreferEmptySlotDrops","toggleVirtualKeyboard","toggleInputSliders","toggleSliderExecute","appMode","toggleStageSize","isSmall","forcedRatio","smallRatio","altClicked","zoomTo","targetRatio","setPaletteWidth","newWidth","microphoneMenu","res","languageMenu","noSave","translation","reflectLanguage","urlBar","userSetBlocksScale","scrpt","blck","sample","setBlocksScale","userFadeBlocks","initial","userSetStageSize","setStageExtent","userSetDragThreshold","initializeCloud","days_left","resetCloudPassword","changeCloudPassword","buildProjectRequest","verifyProject","encodedBody","projectBody","projectSize","cloudAcknowledge","cloudResponse","setCloudURL","responseType","rsp","async","status","isIE","task","projectList","srcBar","filterField","magnifyingGlass","listField","preview","notesText","notesField","deleteButton","shareButton","unshareButton","publishButton","unpublishButton","recoverButton","setSource","notification","addSourceButton","buildFilterField","hasLocalProjects","fixListFieldItemColors","bottomRow","topRow","symbol","lbl1","lbl2","l1","l2","aProject","clearDetails","installCloudProjectList","projects","getExamplesProjectList","getLocalProjectList","stored","proj","ispublic","ispublished","lastupdated","recoveryDialog","openCloudProject","rawOpenCloudProject","clouddata","saveCloudProject","thin","buildListField","drawTexture","drawCachedTexture","yesterday","setDate","getDate","date","getTime","toDateString","toLocaleTimeString","toLocaleString","recoverProject","titleHeight","oldFlag","libraryCache","initializePalette","initializeLibraryDescription","installLibrariesList","importLibrary","hasCached","displayBlocks","libraryXML","cacheLibrary","cachedLibrary","selectedLibrary","libraryName","libraryText","libraryKey","blockImage","previousCategory","blockContainer","msgText","addOption","editTranslations","defaultHatBlockMargin","getDefinitionJSON","scriptsFrame","isLive","deduplicateBlockIDs","consolidateDoubles","refreshAllBlockInstances","oldSpec","blockIDs","findBlockIDs","prototypeSpec","prototypeSlots","prototypeHat","stackFrame","exportPic","morphToShow","field","hasLine","vn","hover","rotationButton","createRotationButton","roationButton","releaseSprite","showSpriteOnStage","copyStack","copyCostume","copySound","previousColor","previousOutline","previousState","editCostume","disinherit","renameCostume","duplicateCostume","newcos","updateList","removeCostume","removeCostumeAt","exportCostume","costumesVersion","spriteVersion","paintNew","newFromCam","camDialog","createInfo","previewAudio","dur","mod","toggleAudioPlaying","audioHasEnded","renameSound","removeSound","exportSound","soundsVersion","recordButton","renderOn","videoElement","videoView","clippingWidth","clippingHeight","videoWidth","videoHeight","Event","mediaRecorder","audioElement","playButton","progressBar","audioChunks","buildProgressBar","channelCount","MediaRecorder","ondataavailable","onstop","setPercentage","Infinity","onWorldLoaded"],"mappings":"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","file":"main.js","sourcesContent":["/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */\nexport var saveAs=saveAs||function(e){\"use strict\";if(typeof e===\"undefined\"||typeof navigator!==\"undefined\"&&/MSIE [1-9]\\./.test(navigator.userAgent)){return}var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=t.createElementNS(\"http://www.w3.org/1999/xhtml\",\"a\"),o=\"download\"in r,a=function(e){var t=new MouseEvent(\"click\");e.dispatchEvent(t)},i=/constructor/i.test(e.HTMLElement)||e.safari,f=/CriOS\\/[\\d]+/.test(navigator.userAgent),u=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},s=\"application/octet-stream\",d=1e3*40,c=function(e){var t=function(){if(typeof e===\"string\"){n().revokeObjectURL(e)}else{e.remove()}};setTimeout(t,d)},l=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var o=e[\"on\"+t[r]];if(typeof o===\"function\"){try{o.call(e,n||e)}catch(a){u(a)}}}},p=function(e){if(/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(e.type)){return new Blob([String.fromCharCode(65279),e],{type:e.type})}return e},v=function(t,u,d){if(!d){t=p(t)}var v=this,w=t.type,m=w===s,y,h=function(){l(v,\"writestart progress write writeend\".split(\" \"))},S=function(){if((f||m&&i)&&e.FileReader){var r=new FileReader;r.onloadend=function(){var t=f?r.result:r.result.replace(/^data:[^;]*;/,\"data:attachment/file;\");var n=e.open(t,\"_blank\");if(!n)e.location.href=t;t=undefined;v.readyState=v.DONE;h()};r.readAsDataURL(t);v.readyState=v.INIT;return}if(!y){y=n().createObjectURL(t)}if(m){e.location.href=y}else{var o=e.open(y,\"_blank\");if(!o){e.location.href=y}}v.readyState=v.DONE;h();c(y)};v.readyState=v.INIT;if(o){y=n().createObjectURL(t);setTimeout(function(){r.href=y;r.download=u;a(r);h();c(y);v.readyState=v.DONE});return}S()},w=v.prototype,m=function(e,t,n){return new v(e,t||e.name||\"download\",n)};if(typeof navigator!==\"undefined\"&&navigator.msSaveOrOpenBlob){return function(e,t,n){t=t||e.name||\"download\";if(!n){e=p(e)}return navigator.msSaveOrOpenBlob(e,t)}}w.abort=function(){};w.readyState=w.INIT=0;w.WRITING=1;w.DONE=2;w.error=w.onwritestart=w.onprogress=w.onwrite=w.onabort=w.onerror=w.onwriteend=null;return m}(typeof self!==\"undefined\"&&self||typeof window!==\"undefined\"&&window||this.content);if(typeof module!==\"undefined\"&&module.exports){module.exports.saveAs=saveAs}else if(typeof define!==\"undefined\"&&define!==null&&define.amd!==null){define(\"FileSaver.js\",function(){return saveAs})}\n","/*\n\n    morphic.js\n\n    a lively Web-GUI\n    inspired by Squeak\n\n    written by Jens Mnig\n    jens@moenig.org\n\n    Copyright (C) 2010-2020 by Jens Mnig\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    documentation contents\n    ----------------------\n    I. inheritance hierarchy\n    II. object definition toc\n    III. yet to implement\n    IV. open issues\n    V. browser compatibility\n    VI. the big picture\n    VII. programming guide\n        (1) setting up a web page\n            (a) single world\n            (b) multiple worlds\n            (c) an application\n        (2) manipulating morphs\n        (3) events\n            (a) mouse events\n            (b) context menu\n            (c) dragging\n            (d) dropping\n            (e) keyboard events\n            (f) resize event\n            (g) combined mouse-keyboard events\n            (h) text editing events\n        (4) stepping\n        (5) creating new kinds of morphs\n            (a) drawing the shape\n            (b) determining extent and arranging submorphs\n            (c) pixel-perfect pointing events\n            (d) caching the shape\n            (e) holes\n            (f) updating\n            (g) duplicating\n        (6) development and user modes\n        (7) turtle graphics\n        (8) supporting high-resolution \"retina\" screens\n        (9 animations\n        (10) minifying morphic.js\n    VIII. acknowledgements\n    IX. contributors\n\n\n    I. hierarchy\n    -------------\n    the following tree lists all constructors hierarchically,\n    indentation indicating inheritance. Refer to this list to get a\n    contextual overview:\n\n    Animation\n    Color\n    Node\n        Morph\n            BlinkerMorph\n                CursorMorph\n            BouncerMorph*\n            BoxMorph\n                InspectorMorph\n                MenuMorph\n                MouseSensorMorph*\n                SpeechBubbleMorph\n            CircleBoxMorph\n                SliderButtonMorph\n                SliderMorph\n            ColorPaletteMorph\n                GrayPaletteMorph\n            ColorPickerMorph\n            DialMorph\n            FrameMorph\n                ScrollFrameMorph\n                    ListMorph\n                StringFieldMorph\n                WorldMorph\n            HandleMorph\n            HandMorph\n            PenMorph\n            ShadowMorph\n            StringMorph\n            TextMorph\n            TriggerMorph\n                MenuItemMorph\n    Point\n    Rectangle\n\n\n    II. toc\n    -------\n    the following list shows the order in which all constructors are\n    defined. Use this list to locate code in this document:\n\n    Global settings\n    Global functions\n\n    Animation\n    Color\n    Point\n    Rectangle\n    Node\n    Morph\n    ShadowMorph\n    HandleMorph\n    PenMorph\n    ColorPaletteMorph\n    GrayPaletteMorph\n    ColorPickerMorph\n    BlinkerMorph\n    CursorMorph\n    BoxMorph\n    SpeechBubbleMorph\n    DialMorph\n    CircleBoxMorph\n    SliderButtonMorph\n    SliderMorph\n    MouseSensorMorph*\n    InspectorMorph\n    MenuMorph\n    StringMorph\n    TextMorph\n    TriggerMorph\n    MenuItemMorph\n    FrameMorph\n    ScrollFrameMorph\n    ListMorph\n    StringFieldMorph\n    BouncerMorph*\n    HandMorph\n    WorldMorph\n\n    * included only for demo purposes\n\n\n    III. yet to implement\n    ---------------------\n    - keyboard support for scroll frames and lists\n    - virtual keyboard support for Android\n\n\n    IV. open issues\n    ----------------\n    - clipboard support (copy & paste) for non-textual data\n\n\n    V. browser compatibility\n    ------------------------\n    I have taken great care and considerable effort to make morphic.js\n    runnable and appearing exactly the same on all current browsers\n    available to me:\n\n    - Firefox for Windows\n    - Firefox for Mac\n    - Firefox for Android\n    - Chrome for Windows\n    - Chrome for Mac\n    - Chrome for Android\n    - Safari for Windows (deprecated)\n    - safari for Mac\n    - Safari for iOS (mobile)\n    - IE for Windows (partial support)\n    - Edge for Windows\n    - Opera for Windows\n    - Opera for Mac\n\n\n    VI. the big picture\n    -------------------\n    Morphic.js is completely based on Canvas and JavaScript, it is just\n    Morphic, nothing else. Morphic.js is very basic and covers only the\n    bare essentials:\n\n        * a stepping mechanism (a time-sharing multiplexer for lively\n          user interaction ontop of a single OS/browser thread)\n        * progressive display updates (only dirty rectangles are\n          redrawn at each display cycle)\n        * a tree structure\n        * a single World per Canvas element (although you can have\n          multiple worlds in multiple Canvas elements on the same web\n          page)\n        * a single Hand per World (but you can support multi-touch\n          events)\n        * a single text entry focus per World\n\n    In its current state morphic.js doesn't support transforms (you\n    cannot rotate Morphs), but with PenMorph there already is a simple\n    LOGO-like turtle that you can use to draw onto any Morph it is\n    attached to. I'm planning to add special Morphs that support these\n    operations later on, but not for every Morph in the system.\n    Therefore these additions (\"sprites\" etc.) are likely to be part of\n    other libraries (\"microworld.js\") in separate files.\n\n    the purpose of morphic.js is to provide a malleable framework that\n    will let me experiment with lively GUIs for my hobby horse, which\n    is drag-and-drop, blocks based programming languages. Those things\n    (BYOB4 - http://byob.berkeley.edu) will be written using morphic.js\n    as a library.\n\n\n    VII. programming guide\n    ----------------------\n    Morphic.js provides a library for lively GUIs inside single HTML\n    Canvas elements. Each such canvas element functions as a \"world\" in\n    which other visible shapes (\"morphs\") can be positioned and\n    manipulated, often directly and interactively by the user. Morphs\n    are tree nodes and may contain any number of submorphs (\"children\").\n\n    All things visible in a morphic World are morphs themselves, i.e.\n    all text rendering, blinking cursors, entry fields, menus, buttons,\n    sliders, windows and dialog boxes etc. are created with morphic.js\n    rather than using HTML DOM elements, and as a consequence can be\n    changed and adjusted by the programmer regardless of proprietary\n    browser behavior.\n\n    Each World has an - invisible - \"Hand\" resembling the mouse cursor\n    (or the user's finger on touch screens) which handles mouse events,\n    and may also have a keyboard focus to handle key events.\n\n    The basic idea of Morphic is to continuously run display cycles and\n    to incrementally update the screen by only redrawing those  World\n    regions which have been \"dirtied\" since the last redraw. Before\n    each shape is processed for redisplay it gets the chance to perform\n    a \"step\" procedure, thus allowing for an illusion of concurrency.\n\n\n    (1) setting up a web page\n    -------------------------\n    Setting up a web page for Morphic always involves three steps:\n    adding one or more Canvas elements, defining one or more worlds,\n    initializing and starting the main loop.\n\n\n    (a) single world\n    -----------------\n    Most commonly you will want your World to fill the browsers's whole\n    client area. This default situation is easiest and most straight\n    forward.\n\n    example html file:\n\n    <!DOCTYPE html>\n    <html>\n        <head>\n            <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n            <title>Morphic!</title>\n            <script type=\"text/javascript\" src=\"morphic.js\"></script>\n            <script type=\"text/javascript\">\n                var world;\n\n                window.onload = function () {\n                    world = new WorldMorph(document.getElementById('world'));\n                    world.isDevMode = true;\n                    loop();\n                };\n\n                function loop() {\n                    requestAnimationFrame(loop);\n                    world.doOneCycle();\n                }\n            </script>\n        </head>\n        <body style=\"margin: 0;\">\n            <canvas id=\"world\" tabindex=\"1\" width=\"800\" height=\"600\"\n                style=\"position: absolute;\"></canvas>\n        </body>\n    </html>\n\n    if you use ScrollFrames or otherwise plan to support mouse wheel\n    scrolling events, make sure to add the following inline-CSS\n    attribute to the Canvas element:\n\n        style=\"position: absolute;\"\n\n    which will prevent the World to be scrolled around instead of the\n    elements inside of it in some browsers.\n\n\n    (b) multiple worlds\n    -------------------\n    If you wish to create a web page with more than one world, make\n    sure to prevent each world from auto-filling the whole page and\n    include it in the main loop. It's also a good idea to give each\n    world its own tabindex:\n\n    example html file:\n\n    <!DOCTYPE html>\n    <html>\n        <head>\n            <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n            <title>Morphic!</title>\n            <script type=\"text/javascript\" src=\"morphic.js\"></script>\n            <script type=\"text/javascript\">\n                var\tworld1, world2;\n\n                window.onload = function () {\n                    disableRetinaSupport();\n                    world1 = new WorldMorph(\n                        document.getElementById('world1'), false);\n                    world2 = new WorldMorph(\n                        document.getElementById('world2'), false);\n                    loop();\n                };\n\n                function loop() {\n            requestAnimationFrame(loop);\n                    world1.doOneCycle();\n                    world2.doOneCycle();\n                }\n            </script>\n        </head>\n        <body>\n            <p>first world:</p>\n            <canvas id=\"world1\" tabindex=\"1\" width=\"600\" height=\"400\"></canvas>\n            <p>second world:</p>\n            <canvas id=\"world2\" tabindex=\"2\" width=\"400\" height=\"600\"></canvas>\n        </body>\n    </html>\n\n\n    (c) an application\n    -------------------\n    Of course, most of the time you don't want to just plain use the\n    standard Morphic World \"as is\" out of the box, but write your own\n    application (something like Scratch!) in it. For such an\n    application you'll create your own morph prototypes, perhaps\n    assemble your own \"window frame\" and bring it all to life in a\n    customized World state. the following example creates a simple\n    snake-like mouse drawing game.\n\n    example html file:\n\n    <!DOCTYPE html>\n    <html>\n        <head>\n            <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n            <title>touch me!</title>\n            <script type=\"text/javascript\" src=\"morphic.js\"></script>\n            <script type=\"text/javascript\">\n                var worldCanvas, sensor;\n\n                window.onload = function () {\n                    var x, y, w, h;\n\n                    worldCanvas = document.getElementById('world');\n                    world = new WorldMorph(worldCanvas);\n                    world.worldCanvas.focus();\n                    world.isDevMode = false;\n                    world.setColor(new Color());\n\n                    w = 100;\n                    h = 100;\n\n                    x = 0;\n                    y = 0;\n\n                    while ((y * h) < world.height()) {\n                        while ((x * w) < world.width()) {\n                            sensor = new MouseSensorMorph();\n                            sensor.setPosition(new Point(x * w, y * h));\n                            sensor.alpha = 0;\n                            sensor.setExtent(new Point(w, h));\n                            world.add(sensor);\n                            x += 1;\n                        }\n                        x = 0;\n                        y += 1;\n                    }\n                    loop();\n                };\n\n                function loop() {\n                    requestAnimationFrame(loop);\n                    world.doOneCycle();\n                }\n            </script>\n        </head>\n        <body bgcolor='black' style=\"margin: 0;\">\n            <canvas id=\"world\" width=\"800\" height=\"600\"\n                style=\"position: absolute;\"></canvas>\n        </body>\n    </html>\n\n    To get an idea how you can craft your own custom morph prototypes\n    I've included two examples which should give you an idea how to add\n    properties, override inherited methods and use the stepping\n    mechanism for \"livelyness\":\n\n        BouncerMorph\n        MouseSensorMorph\n\n    For the sake of sharing a single file I've included those examples\n    in morphic.js itself. Usually you'll define your additions in a\n    separate file and keep morphic.js untouched.\n\n\n    (2) manipulating morphs\n    -----------------------\n    There are many methods to programmatically manipulate morphs. Among\n    the most important and common ones among all morphs are the\n    following nine:\n\n    * hide()\n    * show()\n\n    * setPosition(aPoint)\n    * setExtent(aPoint)\n    * setColor(aColor)\n\n    * add(submorph)            - attaches submorph ontop\n    * addBack(submorph)        - attaches submorph underneath\n\n    * fullCopy()               - duplication\n    * destroy()                - deletion\n\n\n    (3) events\n    ----------\n    All user (and system) interaction is triggered by events, which are\n    passed on from the root element - the World - to its submorphs. The\n    World contains a list of system (browser) events it reacts to in its\n\n        initEventListeners()\n\n    method. Currently there are\n\n        - mouse\n        - drop\n        - keyboard\n        - (window) resize\n\n    events.\n\n    These system events are dispatched within the morphic World by the\n    World's Hand and its keyboardFocus (usually the active text\n    cursor).\n\n\n    (a) mouse events:\n    -----------------\n    The Hand dispatches the following mouse events to relevant morphs:\n\n        mouseDownLeft\n        mouseDownRight\n        mouseClickLeft\n        mouseClickRight\n        mouseDoubleClick\n        mouseEnter\n        mouseLeave\n        mouseEnterDragging\n        mouseLeaveDragging\n        mouseEnterBounds\n        mouseLeaveBounds\n        mouseMove\n        mouseScroll\n\n    If you wish your morph to react to any such event, simply add a\n    method of the same name as the event, e.g:\n\n        MyMorph.prototype.mouseMove = function(pos) {};\n\n    Most of these methods have as optional parameter a Point object\n    indicating the current position of the Hand inside the World's\n    coordinate system. The\n\n        mouseMove(pos, button)\n\n    event method has an additional optional parameter indicating the\n    currently pressed mouse button, which is either 'left' or 'right'.\n    You can use this to let users interact with 3D environments.\n\n    The\n\n        mouseEnterDragging(morph)\n        mouseLeaveDragging(morph)\n        mouseEnterBounds(morph)\n        mouseLeaveBounds(morph)\n\n    event methods have as optional parameter the morph currently dragged by\n    the Hand, if any.\n\n    Events may be \"bubbled\" up a morph's owner chain by calling\n\n        this.escalateEvent(functionName, arg)\n\n    in the event handler method's code.\n\n    Likewise, removing the event handler method will render your morph\n    passive to the event in question.\n\n\n    (b) context menu:\n    -----------------\n    By default right-clicking (or single-finger tap-and-hold) on a morph\n    also invokes its context menu (in addition to firing the\n    mouseClickRight event). A morph's context menu can be customized by\n    assigning a Menu instance to its\n\n        customContextMenu\n\n    property, or altogether suppressed by overriding its inherited\n\n        contextMenu()\n\n    method.\n\n\n    (c) dragging:\n    -------------\n    Dragging a morph is initiated when the left mouse button is pressed,\n    held and the mouse is moved.\n\n    You can control whether a morph is draggable by setting its\n\n        isDraggable\n\n    property either to false or true. If a morph isn't draggable itself\n    it will pass the pick-up request up its owner chain. This lets you\n    create draggable composite morphs like Windows, DialogBoxes,\n    Sliders etc.\n\n    Sometimes it is desireable to make \"template\" shapes which cannot be\n    moved themselves, but from which instead duplicates can be peeled\n    off. This is especially useful for building blocks in construction\n    kits, e.g. the MIT-Scratch palette. Morphic.js lets you control this\n    functionality by setting the\n\n        isTemplate\n\n    property flag to true for any morph whose \"isDraggable\" property is\n    turned off. When dragging such a Morph the hand will instead grab\n    a duplicate of the template whose \"isDraggable\" flag is true and\n    whose \"isTemplate\" flag is false, in other words: a non-template.\n\n    When creating a copy from a template, the copy's\n\n        reactToTemplateCopy\n\n    is invoked, if it is present.\n\n    Dragging is indicated by adding a drop shadow to the morph in hand.\n    If a morph follows the hand without displaying a drop shadow it is\n    merely being moved about without changing its parent (owner morph),\n    e.g. when \"dragging\" a morph handle to resize its owner, or when\n    \"dragging\" a slider button.\n\n    Right before a morph is picked up its\n\n        selectForEdit\n\n    and\n\n        prepareToBeGrabbed(handMorph)\n\n    methods are invoked, each if it is present. the optional\n\n        selectForEdit\n\n    if implemented, must return the object that is to be picked up.\n    In addition to just returning the original object chosen by the user\n    your method can also modify the target's environment and instead return\n    a copy of the selected morph if, for example, you would like to implement\n    a copy-on-write mechanism such as in Snap.\n\n    Immediately after the pick-up the former parent's\n\n        reactToGrabOf(grabbedMorph)\n\n    method is called, again only if it exists.\n\n    Similar to events, these  methods are optional and don't exist by\n    default. For a simple example of how they can be used to adjust\n    scroll bars in a scroll frame please have a look at their\n    implementation in FrameMorph.\n\n\n    (d) dropping:\n    -------------\n    Dropping is triggered when the left mouse button is either pressed\n    or released while the Hand is dragging a morph.\n\n    Dropping a morph causes it to become embedded in a new owner morph.\n    You can control this embedding behavior by setting the prospective\n    drop target's\n\n        acceptsDrops\n\n    property to either true or false, or by overriding its inherited\n\n        wantsDropOf(aMorph)\n\n    method.\n\n    Right before dropping a morph the designated new parent's optional\n\n        selectForEdit\n\n    method is invoked if it is present. Again, if implemented this method\n    must return the new parent for the morph that is about to be dropped.\n    Again, in addition to just returning the designeted drop-target\n    your method can also modify its environment and instead return\n    a copy of the new parent if, for example, you would like to implement\n    a copy-on-write mechanism such as in Snap.\n\n    Right after a morph has been dropped its\n\n        justDropped(handMorph)\n\n    method is called, and its new parent's\n\n        reactToDropOf(droppedMorph, handMorph)\n\n    method is invoked, again only if each method exists.\n\n    Similar to events, these  methods are optional and by default are\n    not present in morphs by default (watch out for inheritance,\n    though!). For a simple example of how they can be used to adjust\n    scroll bars in a scroll frame please have a look at their\n    implementation in FrameMorph.\n\n    Drops of image elements from outside the world canvas are dispatched as\n\n        droppedImage(aCanvas, name)\n        droppedSVG(anImage, name)\n\n    events to interested Morphs at the mouse pointer. If you want your Morph\n    to e.g. import outside images you can add the droppedImage() and / or the\n    droppedSVG() methods to it. The parameter passed to the event handles is\n    a new offscreen canvas element representing a copy of the original image\n    element which can be directly used, e.g. by assigning it to another\n    Morph's cachedImage property. In the case of a dropped SVG it is an image\n    element (not a canvas), which has to be rasterized onto a canvas before\n    it can be used. The benefit of handling SVGs as image elements is that\n    rasterization can be deferred until the destination scale is known, taking\n    advantage of SVG's ability for smooth scaling. If instead SVGs are to be\n    rasterized right away, you can set the\n\n        MorphicPreferences.rasterizeSVGs\n\n    preference to <true>. In this case dropped SVGs also trigger the\n    droppedImage() event with a canvas containing a rasterized version of the\n    SVG.\n\n    The same applies to drops of audio or text files from outside the world\n    canvas.\n\n    Those are dispatched as\n\n        droppedAudio(anAudio, name)\n        droppedText(aString, name, type)\n\n    events to interested Morphs at the mouse pointer.\n\n    if none of the above content types can be determined, the file contents\n    is dispatched as an ArrayBuffer to interested Morphs:\n\n        droppedBinary(anArrayBuffer, name)\n\n\n    (e) keyboard events\n    -------------------\n    The World dispatches the following key events to its active\n    keyboard focus:\n\n        keypress\n        keydown\n        keyup\n\n    Currently the only morphs which acts as keyboard focus are\n    CursorMorph - the basic text editing widget - and MenuMorph elements.\n    If you wish to add keyboard support to your morph you need to add event\n    handling methods for\n\n        processKeyPress(event)\n        processKeyDown(event)\n        processKeyUp(event)\n\n    and activate them by assigning your morph to the World's\n\n        keyboardFocus\n\n    property.\n\n    Note that processKeyUp() is optional and doesn't have to be present\n    if your morph doesn't require it.\n\n\n    (f) resize event\n    ----------------\n    The Window resize event is handled by the World and allows the\n    World's extent to be adjusted so that it always completely fills\n    the browser's visible page. You can turn off this default behavior\n    by setting the World's\n\n        useFillPage\n\n    property to false.\n\n    Alternatively you can also initialize the World with the\n    useFillPage switch turned off from the beginning by passing the\n    false value as second parameter to the World's constructor:\n\n        world = new World(aCanvas, false);\n\n    Use this when creating a web page with multiple Worlds.\n\n    if \"useFillPage\" is turned on the World dispatches an\n\n        reactToWorldResize(newBounds)\n\n    events to all of its children (toplevel only), allowing each to\n    adjust to the new World bounds by implementing a corresponding\n    method, the passed argument being the World's new dimensions after\n    completing the resize. By default, the \"reactToWorldResize\" Method\n    does not exist.\n\n    Example:\n\n    Add the following method to your Morph to let it automatically\n    fill the whole World, but leave a 10 pixel border uncovered:\n\n        MyMorph.prototype.reactToWorldResize = function (rect) {\n            this.changed();\n            this.bounds = rect.insetBy(10);\n            this.rerender();\n        };\n\n\n    (g) combined mouse-keyboard events\n    ----------------------------------\n    Occasionally you'll want an object to react differently to a mouse\n    click or to some other mouse event while the user holds down a key\n    on the keyboard. Such \"shift-click\", \"ctl-click\", or \"alt-click\"\n    events can be implemented by querying the World's\n\n        currentKey\n\n    property inside the function that reacts to the mouse event. This\n    property stores the keyCode of the key that's currently pressed.\n    Once the key is released by the user it reverts to null.\n\n\n    (h) text editing events\n    -----------------------\n    Much of Morphic's \"liveliness\" comes out of allowing text elements\n    (instances of either single-lined StringMorph or multi-lined TextMorph)\n    to be directly manipulated and edited by users. This requires other\n    objects which may have an interest in the text element's state to react\n    appropriately. Therefore text elements and their manipulators emit\n    a stream of events, mostly by \"bubbling\" them up the text element's\n    owner chain. Text elements' parents are notified about the following\n    events:\n\n    Whenever the user presses a key on the keyboard while a text element\n    is being edited, first a\n\n        reactToKeystroke(event)\n\n    is escalated up its parent chain, the \"event\" parameter being the\n    original one received by the World.\n\n    Whenever the input changes, by adding or removing one or more characters,\n    an additional\n\n        reactToInput(event)\n\n    is escalated up its parent chain, the \"event\" parameter again being the\n    original one received by the World or by the IME element.\n\n    Note that the \"reactToKeystroke\" event gets triggered before the input\n    changes, and thus befgore the \"reactToInput\" event fires.\n\n    Once the user has completed the edit, the following events are\n    dispatched:\n\n        accept() - <enter> was pressed on a single line of text\n        cancel() - <esc> was pressed on any text element\n\n    Note that \"accept\" only gets triggered by single-line texte elements,\n    as the <enter> key is used to insert line breaks in multi-line\n    elements. Therefore, whenever a text edit is terminated by the user\n    (accepted, cancelled or otherwise),\n\n        reactToEdit(StringOrTextMorph)\n\n    is triggered.\n\n    If the MorphicPreference's\n\n        useSliderForInput\n\n    setting is turned on, a slider is popped up underneath the currently\n    edited text element letting the user insert numbers out of the given\n    slider range. Whenever this happens, i.e. whenever the slider is moved\n    or while the slider button is pressed, a stream of\n\n        reactToSliderEdit(StringOrTextMorph)\n\n    events is dispatched, allowing for \"Bret-Victor\" style \"scrubbing\"\n    applications.\n\n    In addition to user-initiated events text elements also emit\n    change notifications to their direct parents whenever their contents\n    changes. That way complex Morphs containing text elements\n    get a chance to react if something about the embedded text has been\n    modified programmatically. These events are:\n\n        layoutChanged() - sent only from instances of TextMorph\n        fixLayout() - sent from instances of all Morphs, including StringMorphs\n\n    they are different so that Morphs which contain both multi-line and\n    single-line text elements can hold them apart.\n\n\n    (4) stepping\n    ------------\n    Stepping is what makes Morphic \"magical\". Two properties control\n    a morph's stepping behavior: the fps attribute and the step()\n    method.\n\n    By default the\n\n        step()\n\n    method does nothing. As you can see in the examples of BouncerMorph\n    and MouseSensorMorph you can easily override this inherited method\n    to suit your needs.\n\n    By default the step() method is called once per display cycle.\n    Depending on the number of actively stepping morphs and the\n    complexity of your step() methods this can cause quite a strain on\n    your CPU, and also result in your application behaving differently\n    on slower computers than on fast ones.\n\n    setting\n\n        myMorph.fps\n\n    to a number lower than the interval for the main loop lets you free\n    system resources (albeit at the cost of a less responsive or slower\n    behavior for this particular morph).\n\n\n    (5) creating new kinds of morphs\n    --------------------------------\n    The real fun begins when you start to create new kinds of morphs\n    with customized shapes. Imagine, e.g. jigsaw puzzle pieces or\n    musical notes.\n\n    When you create your own morphs, you'll want to think about how to\n    graphically render it, how to determine its size and whether it needs\n    to arrange any other parts (\"submorphs). There are also ways to specify\n    its collision detection behavior and define \"untouchable\" regions\n    (\"holes\").\n\n\n    (a) drawing the shape\n    ---------------------\n    For this you have to override the default\n\n        render(ctx)\n\n    method.\n\n    This method draws the morph's shape using a given 2d graphics context.\n    Note that any coordinates used in the render() method must be relative\n    to the morph's own position, i.e. you don't need to worry about\n    translating the shape yourself.\n\n    You can use the following template for a start:\n\n        MyMorph.prototype.render = function(ctx) {\n            ctx.fillStyle = this.color.toString();\n            ctx.fillRect(0, 0, this.width(), this.height());\n        };\n\n    it renders the morph as a solid rectangle completely filling its\n    area with its current color.\n\n    Notice how the coordinates for the fillRect() call are relative\n    to the morph's own position: The rendered rectangle's origin is always\n    located at (0, 0) regardless of the morph's actual position in the World.\n\n\n    (b) determining extent and arranging submorphs\n    ----------------------------------------------\n    If your new morph also needs to determine its extent and, e.g. to\n    encompass one or several other morphs, or arrange the layout of its\n    submorphs, make sure to also override the default\n\n        fixLayout()\n\n    method.\n\n    NOTE: If you need to set the morph's extent inside, in order to avoid\n    infinite recursion instead of calling morph.setExtent() - which will\n    in turn call morph.fixLayout() again - directly modify the morph's\n\n        bounds\n\n    property. Bounds is a rectable on which you can also use the same\n    size-setters, e.g. by calling:\n\n        this.bounds.setExtent()\n\n\n    (c) pixel-perfect pointing events\n    ---------------------------------\n    In case your new morph needs to support pixel-perfect collision detection\n    with other morphs or pointing devices such as the mouse or a stylus you\n    can set the inherited attribute\n\n        isFreeForm = bool\n\n    to \"true\" (default is \"false\"). This makes sense the more your morph's\n    visual shape diverges from a rectangle. For example, if you create a\n    circular filled morph the default setting will register mouse-events\n    anywhere within its bounding box, e.g. also in the transparent parts\n    between the bounding box's corners outside of the circle's bounds.\n    Instead you can specify your irregulary shaped morph to only register\n    pointing events (mouse and touch) on solid, non-transparent parts.\n\n    Notice, however, that such pixel-perfect collision detection might\n    strain processing resources, especially if applied liberally.\n\n    In order to mitigate unfavorable processor loads for pixel-perfect\n    collision deteciton of irregularly shaped morphs there are two strategies\n    to consider: Caching the shape and specifying \"untouchable\" regions.\n\n\n    (d) caching the shape\n    ---------------------\n    In case of pixel-perfect free-form collision detection it makes sense to\n    cache your morph's current shape, so it doesn't have to be re-drawn onto a\n    new Canvas element every time the mouse moves over its bounding box.\n    For this you can set then inherited\n\n        isCachingImage = bool\n\n    attribute to \"true\" instead of the default \"false\" value. This will\n    significantly speed up collision detection and smoothen animations that\n    continuously perform collision detection. However, it will also consume\n    more memory. Therefore it's best to use this setting with caution.\n\n    Snap! caches the shapes of sprites but not those of blocks. Instead it\n    manages the insides of C- and E-shaped blocks through the morphic \"holes\"\n    mechanism.\n\n\n    (e) holes\n    ---------\n    An alternative albeit not as precise and general way for handling\n    irregularly shaped morphs with \"untouchable\" regions is to specify a set\n    of rectangular areas in which pointing events (mouse or touch) are not\n    registered.\n\n    By default the inherited\n\n        holes = []\n\n    property is an empty array. You can add one or more morphic Rectangle\n    objects to this list, representing regions, in which occurring events will\n    instead be passed on to the morph underneath.\n\n    Note that, same with the render() method, the coordinates of these\n    rectangular holes must be specified relative to your morph's position.\n\n    If you specify holes you might find the need to adjust their layout\n    depending on the layout of your morph. To accomplish this you can override\n    the inherited\n\n        fixHolesLayout()\n\n    method.\n\n\n    (f) updating\n    ------------\n    One way for morphs to become alive is form them to literally \"morph\" their\n    shape depending on whicher contest you wish them to react to. For example,\n    you might want the user to interactively draw a shape using their fingers\n    on a touch screen device, or you want the user to be able to \"pinch\" or\n    otherwise distort a shape interactively. In all of these situations you'll\n    want your morph to frequently rerender its shape.\n\n    You can accomplish this, by calling\n\n        rerender()\n\n    after every change to your morph's appearance that requires rerendering.\n\n    Such changes are usually only happening when the morph's dimensions or\n    other visual properties - such as its color - changes.\n\n\n    (g) duplicating\n    ---------------\n    If your new morph stores or references to other morphs outside of\n    the submorph tree in other properties, be sure to also override the\n    default\n\n        updateReferences()\n\n    method if you want it to support duplication.\n\n\n    (6) development and user modes\n    ------------------------------\n    When working with Squeak on Scratch or BYOB among the features I\n    like the best and use the most is inspecting what's going on in\n    the World while it is up and running. That's what development mode\n    is for (you could also call it debug mode). In essence development\n    mode controls which context menu shows up. In user mode right\n    clicking (or double finger tapping) a morph invokes its\n\n        customContextMenu\n\n    property, whereas in development mode only the general\n\n        developersMenu()\n\n    method is called and the resulting menu invoked. The developers'\n    menu features Gui-Builder-wise functionality to directly inspect,\n    take apart, reassamble and otherwise manipulate morphs and their\n    contents.\n\n    Instead of using the \"customContextMenu\" property you can also\n    assign a more dynamic contextMenu by overriding the general\n\n        userMenu()\n\n    method with a customized menu constructor. The difference between\n    the customContextMenu property and the userMenu() method is that\n    the former is also present in development mode and overrides the\n    developersMenu() result. For an example of how to use the\n    customContextMenu property have a look at TextMorph's evaluation\n    menu, which is used for the Inspector's evaluation pane.\n\n    When in development mode you can inspect every Morph's properties\n    with the inspector, including all of its methods. The inspector\n    also lets you add, remove and rename properties, and even edit\n    their values at runtime. Like in a Smalltalk environment the inspect\n    features an evaluation pane into which you can type in arbitrary\n    JavaScript code and evaluate it in the context of the inspectee.\n\n    Use switching between user and development modes while you are\n    developing an application and disable switching to development once\n    you're done and deploying, because generally you don't want to\n    confuse end-users with inspectors and meta-level stuff.\n\n\n    (7) turtle graphics\n    -------------------\n\n    The basic Morphic kernel features a simple LOGO turtle constructor\n    called\n\n        PenMorph\n\n    which you can use to draw onto its parent Morph. By default every\n    Morph in the system (including the World) is able to act as turtle\n    canvas and can display pen trails. Pen trails will be lost whenever\n    the trails morph (the pen's parent) performs a \"render()\"\n    operation. If you want to create your own pen trails canvas, you\n    may wish to modify its\n\n        penTrails()\n\n    property, so that it keeps a separate offscreen canvas for pen\n    trails (and doesn't loose these on redraw).\n\n    the following properties of PenMorph are relevant for turtle\n    graphics:\n\n        color       - a Color\n        size        - line width of pen trails\n        heading     - degrees\n        isDown      - drawing state\n\n    the following commands can be used to actually draw something:\n\n        up()        - lift the pen up, further movements leave no trails\n        down()      - set down, further movements leave trails\n        clear()     - remove all trails from the current parent\n        forward(n)  - move n steps in the current direction (heading)\n        turn(n)     - turn right n degrees\n\n    Turtle graphics can best be explored interactively by creating a\n    new PenMorph object and by manipulating it with the inspector\n    widget.\n\n    NOTE: PenMorph has a special optimization for recursive operations\n    called\n\n        warp(function)\n\n    You can significantly speed up recursive ops and increase the depth\n    of recursion that's displayable by wrapping WARP around your\n    recursive function call:\n\n    example:\n\n        myPen.warp(function () {\n            myPen.tree(12, 120, 20);\n        })\n\n    will be much faster than just invoking the tree function, because it\n    prevents the parent's parent from keeping track of every single line\n    segment and instead redraws the outcome in a single pass.\n\n\n    (8) supporting high-resolution \"retina\" screens\n    -----------------------------------------------\n    By default retina support gets installed when Morphic.js loads. There\n    are two global functions that let you test for retina availability:\n\n        isRetinaSupported() - Bool, answers if retina support is available\n        isRetinaEnabled()   - Bool, answers if currently in retina mode\n\n    and two more functions that let you control retina support if it is\n    available:\n\n        enableRetinaSupport()\n        disableRetinaSupport()\n\n    Both of these internally test whether retina is available, so they are\n    safe to call directly. For an example how to make retina support\n    user-specifiable refer to\n\n        Snap! >> guis.js >> toggleRetina()\n\n    Even when in retina mode it often makes sense to use normal-resolution\n    canvasses for simple shapes in order to save system resources and\n    optimize performance. Examples are costumes and backgrounds in Snap.\n    In Morphic you can create new canvas elements using\n\n        newCanvas(extentPoint [, nonRetinaFlag])\n\n    If retina support is enabled such new canvasses will automatically be\n    high-resolution canvasses, unless the newCanvas() function is given an\n    otherwise optional second Boolean <true> argument that explicitly makes\n    it a non-retina canvas.\n\n    Not the whole canvas API is supported by Morphic's retina utilities.\n    Especially if your code uses putImageData() you will want to \"downgrade\"\n    a target high-resolution canvas to a normal-resolution (\"non-retina\")\n    one before using\n\n        normalizeCanvas(aCanvas [, copyFlag])\n\n    This will change the target canvas' resolution in place (!). If you\n    pass in the optional second Boolean <true> flag the function returns\n    a non-retina copy and leaves the target canvas unchanged. An example\n    of this normalize mechanism is converting the penTrails layer of Snap's\n    stage (high-resolution) into a sprite-costume (normal resolution).\n\n\n    (9) animations\n    ---------------\n    Animations handle gradual transitions between one state and another over a\n    period of time. Transition effects can be specified using easing functions.\n    An easing function maps a fraction of the transition time to a fraction of\n    the state delta. This way accelerating / decelerating and bouncing sliding\n    effects can be accomplished.\n\n    Animations are generic and not limited to motion, i.e. they can also handle\n    other transitions such as color changes, transparency fadings, growing,\n    shrinking, turning etc.\n\n    Animations need to be stepped by a scheduler, e. g. an interval function.\n    In Morphic the preferred way to run an animation is to register it with\n    the World by adding it to the World's animation queue. The World steps each\n    registered animation once per display cycle independently of the Morphic\n    stepping mechanism.\n\n    For an example how to use animations look at how the Morph's methods\n\n        glideTo()\n        fadeTo()\n\n    and\n\n        slideBackTo()\n\n    are implemented.\n\n\n    (10) minifying morphic.js\n    -------------------------\n    Coming from Smalltalk and being a Squeaker at heart I am a huge fan\n    of browsing the code itself to make sense of it. Therefore I have\n    included this documentation and (too little) inline comments so all\n    you need to get going is this very file.\n\n    Nowadays with live streaming HD video even on mobile phones 250 KB\n    shouldn't be a big strain on bandwith, still minifying and even\n    compressing morphic.js down do about 100 KB may sometimes improve\n    performance in production use.\n\n    Being an attorney-at-law myself you programmer folk keep harassing\n    me with rabulistic nitpickings about free software licenses. I'm\n    releasing morphic.js under an AGPL license. Therefore please make\n    sure to adhere to that license in any minified or compressed version.\n\n\n    VIII. acknowledgements\n    ----------------------\n    The original Morphic was designed and written by Randy Smith and\n    John Maloney for the SELF programming language, and later ported to\n    Squeak (Smalltalk) by John Maloney and Dan Ingalls, who has also\n    ported it to JavaScript (the Lively Kernel), once again setting\n    a \"Gold Standard\" for self sustaining systems which morphic.js\n    cannot and does not aspire to meet.\n\n    This Morphic implementation for JavaScript is not a direct port of\n    Squeak's Morphic, but still many individual functions have been\n    ported almost literally from Squeak, sometimes even including their\n    comments, e.g. the morph duplication mechanism fullCopy(). Squeak\n    has been a treasure trove, and if morphic.js looks, feels and\n    smells a lot like Squeak, I'll take it as a compliment.\n\n    Evelyn Eastmond has inspired and encouraged me with her wonderful\n    implementation of DesignBlocksJS. Thanks for sharing code, ideas\n    and enthusiasm for programming.\n\n    John Maloney has been my mentor and my source of inspiration for\n    these Morphic experiments. Thanks for the critique, the suggestions\n    and explanations for all things Morphic and for being my all time\n    programming hero.\n\n    I have originally written morphic.js in Florian Balmer's Notepad2\n    editor for Windows, later switched to Apple's Dashcode and later\n    still to Apple's Xcode. I've also come to depend on both Douglas\n    Crockford's JSLint and later the JSHint project, as well as on\n    Mozilla's Firebug and Google's Chrome to get it right.\n\n\n    IX. contributors\n    ----------------------\n    Joe Otto found and fixed many early bugs and taught me some tricks.\n    Nathan Dinsmore contributed mouse wheel scrolling, cached\n    background texture handling, countless bug fixes and optimizations.\n    Ian Reynolds contributed backspace key handling for Chrome.\n    Davide Della Casa contributed performance optimizations for Firefox.\n    Jason N (@cyderize) contributed native copy & paste for text editing.\n    Bartosz Leper contributed retina display support.\n    Zhenlei Jia and Dariusz Doroalski pioneered IME text editing.\n    Bernat Romagosa contributed to text editing and to the core design.\n    Michael Ball found and fixed a longstanding scrolling bug.\n    Brian Harvey contributed to the design and implementation of submenus.\n    Ken Kahn contributed to Chinese keboard entry and Android support.\n    Brian Broll contributed clickable URLs in text elements and many bugfixes.\n\n    - Jens Mnig\n*/\n\n// Global settings /////////////////////////////////////////////////////\n\n/*global window, HTMLCanvasElement, FileReader, Audio, FileList, Map*/\n\nexport var morphicVersion = '2020-November-12';\nexport var modules = {}; // keep track of additional loaded modules\nexport var useBlurredShadows = true;\n\nexport const ZERO = new Point();\nexport const BLACK = new Color();\nexport const WHITE = new Color(255, 255, 255);\nexport const CLEAR = new Color(0, 0, 0, 0);\n\nObject.freeze(ZERO);\nObject.freeze(BLACK);\nObject.freeze(WHITE);\n\nexport var standardSettings = {\n    minimumFontHeight: getMinimumFontHeight(), // browser settings\n    globalFontFamily: '',\n    menuFontName: 'sans-serif',\n    menuFontSize: 12,\n    bubbleHelpFontSize: 10,\n    prompterFontName: 'sans-serif',\n    prompterFontSize: 12,\n    prompterSliderSize: 10,\n    handleSize: 15,\n    scrollBarSize: 12,\n    mouseScrollAmount: 40,\n    useSliderForInput: false,\n    isTouchDevice: false, // turned on by touch events, don't set\n    rasterizeSVGs: false,\n    isFlat: false,\n    grabThreshold: 5,\n    showHoles: false\n};\n\nexport var touchScreenSettings = {\n    minimumFontHeight: standardSettings.minimumFontHeight,\n    globalFontFamily: '',\n    menuFontName: 'sans-serif',\n    menuFontSize: 24,\n    bubbleHelpFontSize: 18,\n    prompterFontName: 'sans-serif',\n    prompterFontSize: 24,\n    prompterSliderSize: 20,\n    handleSize: 26,\n    scrollBarSize: 24,\n    mouseScrollAmount: 40,\n    useSliderForInput: false,\n    isTouchDevice: true,\n    rasterizeSVGs: false,\n    isFlat: false,\n    grabThreshold: 5,\n    showHoles: false\n};\n\nexport var MorphicPreferences = standardSettings;\n\n// first, try enabling support for retina displays - can be turned off later\n\n/*\n    Support for retina displays has been pioneered and contributed by\n    Bartosz Leper.\n\n    NOTE: this will make changes to the HTMLCanvasElement that - mostly -\n    make Morphic usable on retina displays in very high resolution mode\n    with crisp fonts and clear fine lines without you (the programmer)\n    needing to know any specifics, provided both the display and the browser\n    support these (Safari currently doesn't), otherwise these utilities will\n    not be installed.\n    If you don't want your Morphic application to support retina resolutions\n    you don't have to edit this morphic.js file to comment out the next line\n    of code, instead you can simply call\n\n        disableRetinaSupport();\n\n    before you create your World(s) in the html page. Disabling retina\n    support also will simply do nothing if retina support is not possible\n    or already disabled, so it's equally safe to call.\n\n    For an example how to make retina support user-specifiable refer to\n    Snap! >> guis.js >> toggleRetina()\n*/\n\nenableRetinaSupport();\n\n// Global Functions ////////////////////////////////////////////////////\n\nexport function nop() {\n    // do explicitly nothing\n    return null;\n}\n\nexport function localize(string) {\n    // override this function with custom localizations\n    return string;\n}\n\nexport function isNil(thing) {\n    return thing === undefined || thing === null;\n}\n\nexport function contains(list, element) {\n    // answer true if element is a member of list\n    return list.indexOf(element) !== -1;\n}\n\nexport function detect(list, predicate) {\n    // answer the first element of list for which predicate evaluates\n    // true, otherwise answer null\n    var i, size = list.length;\n    for (i = 0; i < size; i += 1) {\n        if (predicate.call(null, list[i])) {\n            return list[i];\n        }\n    }\n    return null;\n}\n\nexport function sizeOf(object) {\n    // answer the number of own properties\n    var size = 0, key;\n    for (key in object) {\n        if (Object.prototype.hasOwnProperty.call(object, key)) {\n            size += 1;\n        }\n    }\n    return size;\n}\n\nexport function isString(target) {\n    return typeof target === 'string' || target instanceof String;\n}\n\nexport function isObject(target) {\n    return target !== null &&\n        (typeof target === 'object' || target instanceof Object);\n}\n\nexport function radians(degrees) {\n    return degrees * Math.PI / 180;\n}\n\nexport function degrees(radians) {\n    return radians * 180 / Math.PI;\n}\n\nexport function fontHeight(height) {\n    var minHeight = Math.max(height, MorphicPreferences.minimumFontHeight);\n    return minHeight * 1.2; // assuming 1/5 font size for ascenders\n}\n\nexport function isWordChar(aCharacter) {\n    // can't use \\b or \\w because they ignore diacritics\n    return aCharacter.match(/[A-z-0-9]/);\n}\n\nexport function isURLChar(aCharacter) {\n    return aCharacter.match(/[A-z0-9./:?&_+%-]/);\n}\n\nexport function isURL(text) {\n    return /^https?:\\/\\//.test(text);\n}\n\nexport function newCanvas(extentPoint, nonRetina, recycleMe) {\n    // answer a new empty instance of Canvas, don't display anywhere\n    // nonRetina - optional Boolean \"false\"\n    // by default retina support is automatic\n    // optional existing canvas to be used again, unless it is marked as\n    // being shared among Morphs (dataset property \"morphicShare\")\n    var canvas, ext;\n    nonRetina = nonRetina || false;\n    ext = (extentPoint ||\n            (recycleMe ? new Point(recycleMe.width, recycleMe.height)\n                : new Point(0, 0))).ceil();\n    if (recycleMe &&\n            !recycleMe.dataset.morphicShare &&\n            (recycleMe.isRetinaEnabled || false) !== nonRetina &&\n            ext.x === recycleMe.width && ext.y === recycleMe.height\n    ) {\n        canvas = recycleMe;\n        canvas.getContext(\"2d\").clearRect(0, 0, canvas.width, canvas.height);\n        return canvas;\n    } else {\n        canvas = document.createElement('canvas');\n        canvas.width = ext.x;\n        canvas.height = ext.y;\n    }\n    if (nonRetina && canvas.isRetinaEnabled) {\n        canvas.isRetinaEnabled = false;\n    }\n    return canvas;\n}\n\nexport function copyCanvas(aCanvas) {\n    // answer a deep copy of a canvas element respecting its retina status\n    var c;\n    if (aCanvas && aCanvas.width && aCanvas.height) {\n        c = newCanvas(\n            new Point(aCanvas.width, aCanvas.height),\n            !aCanvas.isRetinaEnabled\n        );\n        c.getContext(\"2d\").drawImage(aCanvas, 0, 0);\n        return c;\n    }\n    return aCanvas;\n}\n\nexport function getMinimumFontHeight() {\n    // answer the height of the smallest font renderable in pixels\n    var str = 'I',\n        size = 50,\n        canvas = document.createElement('canvas'),\n        ctx,\n        maxX,\n        data,\n        x,\n        y;\n    canvas.width = size;\n    canvas.height = size;\n    ctx = canvas.getContext('2d');\n    ctx.font = '1px serif';\n    maxX = ctx.measureText(str).width;\n    ctx.fillStyle = 'black';\n    ctx.textBaseline = 'bottom';\n    ctx.fillText(str, 0, size);\n    for (y = 0; y < size; y += 1) {\n        for (x = 0; x < maxX; x += 1) {\n            data = ctx.getImageData(x, y, 1, 1);\n            if (data.data[3] !== 0) {\n                return size - y + 1;\n            }\n        }\n    }\n    return 0;\n}\n\nexport function getDocumentPositionOf(aDOMelement) {\n    // answer the relative coordinates of a DOM element in the viewport\n    var rect = aDOMelement.getBoundingClientRect(),\n    scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,\n    scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n    return {x: rect.left + scrollLeft, y:rect.top + scrollTop};\n}\n\nexport function copy(target) {\n    // answer a shallow copy of target\n    var value, c, property, keys, l, i;\n    if (typeof target !== 'object') {\n        return target;\n    }\n    value = target.valueOf();\n    if (target !== value) {\n        return new target.constructor(value);\n    }\n    if (target instanceof target.constructor &&\n            target.constructor !== Object) {\n        c = Object.create(target.constructor.prototype);\n        keys = Object.keys(target);\n        for (l = keys.length, i = 0; i < l; i += 1) {\n            property = keys[i];\n            if (target[property] instanceof HTMLCanvasElement) {\n                // tag canvas elements as being shared,\n                // so the next time when rerendering a Morph\n                // instead of recycling the shared canvas a\n                // new unshared one get created\n                // see newCanvas() function\n                target[property].dataset.morphicShare = 'true';\n            }\n            c[property] = target[property];\n        }\n    } else {\n        c = {};\n        for (property in target) {\n            c[property] = target[property];\n        }\n    }\n    return c;\n}\n\n// Retina Display Support //////////////////////////////////////////////\n\n/*\n    By default retina support gets installed when Morphic.js loads. There\n    are two global functions that let you test for retina availability:\n\n        isRetinaSupported() - Boolean, whether retina support is available\n        isRetinaEnabled()   - Boolean, whether currently in retina mode\n\n    and two more functions that let you control retina support if it is\n    available:\n\n        enableRetinaSupport()\n        disableRetinaSupport()\n\n    Both of these internally test whether retina is available, so they are\n    safe to call directly.\n\n    Even when in retina mode it often makes sense to use non-high-resolution\n    canvasses for simple shapes in order to save system resources and\n    optimize performance. Examples are costumes and backgrounds in Snap.\n    In Morphic you can create new canvas elements using\n\n        newCanvas(extentPoint [, nonRetinaFlag])\n\n    If retina support is enabled such new canvasses will automatically be\n    high-resolution canvasses, unless the newCanvas() function is given an\n    otherwise optional second Boolean <true> argument that explicitly makes\n    it a non-retina canvas.\n\n    Not the whole canvas API is supported by Morphic's retina utilities.\n    Especially if your code uses putImageData() you will want to \"downgrade\"\n    a target high-resolution canvas to a normal-resolution (\"non-retina\")\n    one before using\n\n        normalizeCanvas(aCanvas [, copyFlag])\n\n    This will change the target canvas' resolution in place (!). If you\n    pass in the optional second Boolean <true> flag the function returns\n    a non-retina copy and leaves the target canvas unchanged. An example\n    of this normalize mechanism is converting the penTrails layer of Snap's\n    stage (high-resolution) into a sprite-costume (normal resolution).\n*/\n\nexport function enableRetinaSupport() {\n/*\n    === contributed by Bartosz Leper ===\n\n    This installs a series of utilities that allow using Canvas the same way\n    on retina and non-retina displays. If the display is a retina one, the\n    underlying dimensions of the Canvas elements are doubled, but this will\n    be transparent to the code that uses Canvas. All dimensions read or\n    written to the Canvas element will be scaled appropriately.\n\n    NOTE: This implementation is not exhaustive; it only implements what is\n    needed by the Snap! UI.\n\n    [Jens]: like all other retina screen support implementations I've seen\n    Bartosz's patch also does not address putImageData() compatibility when\n    mixing retina-enabled and non-retina canvasses. If you need to manipulate\n    pixels in such mixed canvasses, make sure to \"downgrade\" them all using\n    normalizeCanvas() below.\n*/\n\n    // Get the window's pixel ratio for canvas elements.\n    // See: http://www.html5rocks.com/en/tutorials/canvas/hidpi/\n    var ctx = document.createElement(\"canvas\").getContext(\"2d\"),\n        backingStorePixelRatio = ctx.webkitBackingStorePixelRatio ||\n            ctx.mozBackingStorePixelRatio ||\n            ctx.msBackingStorePixelRatio ||\n            ctx.oBackingStorePixelRatio ||\n            ctx.backingStorePixelRatio || 1,\n\n    // Unfortunately, it's really hard to make this work well when changing\n    // zoom level, so let's leave it like this right now, and stick to\n    // whatever the ratio was in the beginning.\n\n        // originalDevicePixelRatio = window.devicePixelRatio,\n\n    // [Jens]: As of summer 2016 non-integer devicePixelRatios lead to\n    // artifacts when blitting images onto canvas elements in all browsers\n    // except Chrome, especially Firefox, Edge, IE (Safari doesn't even\n    // support retina mode as implemented here).\n    // therefore - to ensure crisp fonts - use the ceiling of whatever\n    // the devicePixelRatio is. This needs more memory, but looks nicer.\n\n        originalDevicePixelRatio = Math.ceil(window.devicePixelRatio),\n\n        canvasProto = HTMLCanvasElement.prototype,\n        contextProto = CanvasRenderingContext2D.prototype,\n\n    // [Jens]: keep track of original properties in a dictionary\n    // so they can be iterated over and restored\n        uber = {\n            drawImage: contextProto.drawImage,\n            getImageData: contextProto.getImageData,\n\n            width: Object.getOwnPropertyDescriptor(\n                canvasProto,\n                'width'\n            ),\n            height: Object.getOwnPropertyDescriptor(\n                canvasProto,\n                'height'\n            ),\n            shadowOffsetX: Object.getOwnPropertyDescriptor(\n                contextProto,\n                'shadowOffsetX'\n            ),\n            shadowOffsetY: Object.getOwnPropertyDescriptor(\n                contextProto,\n                'shadowOffsetY'\n            ),\n            shadowBlur: Object.getOwnPropertyDescriptor(\n                contextProto,\n                'shadowBlur'\n            )\n        };\n\n    // [Jens]: only install retina utilities if the display supports them\n    if (backingStorePixelRatio === originalDevicePixelRatio) {return; }\n    // [Jens]: check whether properties can be overridden, needed for Safari\n    if (Object.keys(uber).some(any => {\n        var prop = uber[any];\n        return prop.hasOwnProperty('configurable') && (!prop.configurable);\n    })) {return; }\n\n    function getPixelRatio(imageSource) {\n        return imageSource.isRetinaEnabled ?\n            (originalDevicePixelRatio || 1) / backingStorePixelRatio : 1;\n    }\n\n    canvasProto._isRetinaEnabled = true;\n    // [Jens]: remember the original non-retina properties,\n    // so they can be restored again\n    canvasProto._bak = uber;\n\n    Object.defineProperty(canvasProto, 'isRetinaEnabled', {\n        get: function() {\n            return this._isRetinaEnabled;\n        },\n        set: function(enabled) {\n            var prevPixelRatio = getPixelRatio(this),\n                prevWidth = this.width,\n                prevHeight = this.height;\n\n            this._isRetinaEnabled = enabled;\n            if (getPixelRatio(this) != prevPixelRatio) {\n                this.width = prevWidth;\n                this.height = prevHeight;\n            }\n        },\n        configurable: true // [Jens]: allow to be deleted an reconfigured\n    });\n\n    Object.defineProperty(canvasProto, 'width', {\n        get: function() {\n            return uber.width.get.call(this) / getPixelRatio(this);\n        },\n        set: function(width) {\n            try { // workaround one of FF's dreaded NS_ERROR_FAILURE bugs\n                // this should be taken out as soon as FF gets fixed again\n                var pixelRatio = getPixelRatio(this),\n                    context;\n                uber.width.set.call(this, width * pixelRatio);\n                context = this.getContext('2d');\n                /*\n                context.restore();\n                context.save();\n                */\n                context.scale(pixelRatio, pixelRatio);\n            } catch (err) {\n                console.log('Retina Display Support Problem', err);\n                uber.width.set.call(this, width);\n            }\n        }\n    });\n\n    Object.defineProperty(canvasProto, 'height', {\n        get: function() {\n            return uber.height.get.call(this) / getPixelRatio(this);\n        },\n        set: function(height) {\n            var pixelRatio = getPixelRatio(this),\n                context;\n            uber.height.set.call(this, height * pixelRatio);\n            context = this.getContext('2d');\n            /*\n            context.restore();\n            context.save();\n            */\n            context.scale(pixelRatio, pixelRatio);\n        }\n    });\n\n    contextProto.drawImage = function(image) {\n        var pixelRatio = getPixelRatio(image),\n            sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight;\n\n        // Different signatures of drawImage() method have different\n        // parameter assignments.\n        switch (arguments.length) {\n            case 9:\n                sx = arguments[1];\n                sy = arguments[2];\n                sWidth = arguments[3];\n                sHeight = arguments[4];\n                dx = arguments[5];\n                dy = arguments[6];\n                dWidth = arguments[7];\n                dHeight = arguments[8];\n                break;\n\n            case 5:\n                sx = 0;\n                sy = 0;\n                sWidth = image.width;\n                sHeight = image.height;\n                dx = arguments[1];\n                dy = arguments[2];\n                dWidth = arguments[3];\n                dHeight = arguments[4];\n                break;\n\n            case 3:\n                sx = 0;\n                sy = 0;\n                sWidth = image.width;\n                sHeight = image.height;\n                dx = arguments[1];\n                dy = arguments[2];\n                dWidth = image.width;\n                dHeight = image.height;\n                break;\n\n            default:\n                throw Error('Called drawImage() with ' + arguments.length +\n                        ' arguments');\n        }\n        uber.drawImage.call(\n                this, image,\n                sx * pixelRatio, sy * pixelRatio,\n                sWidth * pixelRatio, sHeight * pixelRatio,\n                dx, dy,\n                dWidth, dHeight);\n    };\n\n    contextProto.getImageData = function(sx, sy, sw, sh) {\n        var pixelRatio = getPixelRatio(this.canvas);\n        return uber.getImageData.call(\n                this,\n                sx * pixelRatio, sy * pixelRatio,\n                sw * pixelRatio, sh * pixelRatio);\n    };\n\n    Object.defineProperty(contextProto, 'shadowOffsetX', {\n        get: function() {\n            return uber.shadowOffsetX.get.call(this) /\n                getPixelRatio(this.canvas);\n        },\n        set: function(offset) {\n            var pixelRatio = getPixelRatio(this.canvas);\n            uber.shadowOffsetX.set.call(this, offset * pixelRatio);\n        }\n    });\n\n    Object.defineProperty(contextProto, 'shadowOffsetY', {\n        get: function() {\n            return uber.shadowOffsetY.get.call(this) /\n                getPixelRatio(this.canvas);\n        },\n        set: function(offset) {\n            var pixelRatio = getPixelRatio(this.canvas);\n            uber.shadowOffsetY.set.call(this, offset * pixelRatio);\n        }\n    });\n\n    Object.defineProperty(contextProto, 'shadowBlur', {\n        get: function() {\n            return uber.shadowBlur.get.call(this) /\n                getPixelRatio(this.canvas);\n        },\n        set: function(blur) {\n            var pixelRatio = getPixelRatio(this.canvas);\n            uber.shadowBlur.set.call(this, blur * pixelRatio);\n        }\n    });\n}\n\nexport function isRetinaSupported () {\n    var ctx = document.createElement(\"canvas\").getContext(\"2d\"),\n        backingStorePixelRatio = ctx.webkitBackingStorePixelRatio ||\n            ctx.mozBackingStorePixelRatio ||\n            ctx.msBackingStorePixelRatio ||\n            ctx.oBackingStorePixelRatio ||\n            ctx.backingStorePixelRatio || 1,\n        canvasProto = HTMLCanvasElement.prototype,\n        contextProto = CanvasRenderingContext2D.prototype,\n        uber = {\n            drawImage: contextProto.drawImage,\n            getImageData: contextProto.getImageData,\n\n            width: Object.getOwnPropertyDescriptor(\n                canvasProto,\n                'width'\n            ),\n            height: Object.getOwnPropertyDescriptor(\n                canvasProto,\n                'height'\n            ),\n            shadowOffsetX: Object.getOwnPropertyDescriptor(\n                contextProto,\n                'shadowOffsetX'\n            ),\n            shadowOffsetY: Object.getOwnPropertyDescriptor(\n                contextProto,\n                'shadowOffsetY'\n            ),\n            shadowBlur: Object.getOwnPropertyDescriptor(\n                contextProto,\n                'shadowBlur'\n            )\n        };\n    return backingStorePixelRatio !== window.devicePixelRatio &&\n        !(Object.keys(uber).some(any => {\n            var prop = uber[any];\n            return prop.hasOwnProperty('configurable') && (!prop.configurable);\n        })\n    );\n}\n\nexport function isRetinaEnabled () {\n    return HTMLCanvasElement.prototype.hasOwnProperty('_isRetinaEnabled');\n}\n\nexport function disableRetinaSupport() {\n    // uninstalls Retina utilities. Make sure to re-create every Canvas\n    // element afterwards\n    var canvasProto, contextProto, uber;\n    if (!isRetinaEnabled()) {return; }\n    canvasProto = HTMLCanvasElement.prototype;\n    contextProto = CanvasRenderingContext2D.prototype;\n    uber = canvasProto._bak;\n    Object.defineProperty(canvasProto, 'width', uber.width);\n    Object.defineProperty(canvasProto, 'height', uber.height);\n    contextProto.drawImage = uber.drawImage;\n    contextProto.getImageData = uber.getImageData;\n    Object.defineProperty(contextProto, 'shadowOffsetX', uber.shadowOffsetX);\n    Object.defineProperty(contextProto, 'shadowOffsetY', uber.shadowOffsetY);\n    Object.defineProperty(contextProto, 'shadowBlur', uber.shadowBlur);\n    delete canvasProto._isRetinaEnabled;\n    delete canvasProto.isRetinaEnabled;\n    delete canvasProto._bak;\n}\n\nexport function normalizeCanvas(aCanvas, getCopy) {\n    // make sure aCanvas is non-retina, otherwise convert it in place (!)\n    // or answer a normalized copy if the \"getCopy\" flag is <true>\n    var cpy;\n    if (!aCanvas.isRetinaEnabled) {return aCanvas; }\n    cpy = newCanvas(new Point(aCanvas.width, aCanvas.height), true);\n    cpy.getContext('2d').drawImage(aCanvas, 0, 0);\n    if (getCopy) {return cpy; }\n    aCanvas.isRetinaEnabled = false;\n    aCanvas.width = cpy.width;\n    aCanvas.height = cpy.height;\n    aCanvas.getContext('2d').drawImage(cpy, 0, 0);\n    return aCanvas;\n}\n\n// Animations //////////////////////////////////////////////////////////////\n\n/*\n    Animations handle gradual transitions between one state and another over a\n    period of time. Transition effects can be specified using easing functions.\n    An easing function maps a fraction of the transition time to a fraction of\n    the state delta. This way accelerating / decelerating and bouncing sliding\n    effects can be accomplished.\n\n    Animations are generic and not limited to motion, i.e. they can also handle\n    other transitions such as color changes, transparency fadings, growing,\n    shrinking, turning etc.\n\n    Animations need to be stepped by a scheduler, e. g. an interval function.\n    In Morphic the preferred way to run an animation is to register it with\n    the World by adding it to the World's animation queue. The World steps each\n    registered animation once per display cycle independently of the Morphic\n    stepping mechanism.\n\n    For an example how to use animations look at how the Morph's methods\n\n        glideTo()\n        fadeTo()\n\n    and\n\n        slideBackTo()\n\n    are implemented.\n*/\n\n// Animation instance creation:\n\nexport function Animation(setter, getter, delta, duration, easing, onComplete) {\n    this.setter = setter; // function\n    this.getter = getter; // function\n    this.delta = delta || 0; // number\n    this.duration = duration || 0; // milliseconds\n    this.easing = isString(easing) ? // string or function\n            this.easings[easing] || this.easings.sinusoidal\n                : easing || this.easings.sinusoidal;\n    this.onComplete = onComplete || null; // optional callback\n    this.endTime = null;\n    this.destination = null;\n    this.isActive = false;\n    this.start();\n}\n\nAnimation.prototype.easings = {\n    // dictionary of a few pre-defined easing functions used to transition\n    // two states\n\n    // ease both in and out:\n    linear: t => t,\n    sinusoidal: t => 1 - Math.cos(radians(t * 90)),\n    quadratic: t => t < 0.5 ? 2 * t * t : ((4 - (2 * t)) * t) - 1,\n    cubic: t => {\n        return t < 0.5 ?\n            4 * t * t * t\n                : ((t - 1) * ((2 * t) - 2) * ((2 * t) - 2)) + 1;\n    },\n    elastic: t => {\n        return (t -= 0.5) < 0 ?\n            (0.01 + 0.01 / t) * Math.sin(50 * t)\n                : (0.02 - 0.01 / t) * Math.sin(50 * t) + 1;\n    },\n\n    // ease in only:\n    sine_in: t => 1 - Math.sin(radians(90 + (t * 90))),\n    quad_in: t => t * t,\n    cubic_in: t => t * t * t,\n    elastic_in: t => (0.04 - 0.04 / t) * Math.sin(25 * t) + 1,\n\n    // ease out only:\n    sine_out: t => Math.sin(radians(t * 90)),\n    quad_out: t => t * (2 - t),\n    elastic_out: t => 0.04 * t / (--t) * Math.sin(25 * t)\n};\n\nAnimation.prototype.start = function () {\n    // (re-) activate the animation, e.g. if is has previously completed,\n    // make sure to plug it into something that repeatedly triggers step(),\n    // e.g. the World's animations queue\n    this.endTime = Date.now() + this.duration;\n    this.destination = this.getter.call(this) + this.delta;\n    this.isActive = true;\n};\n\nAnimation.prototype.step = function () {\n    if (!this.isActive) {return; }\n    var now = Date.now();\n    if (now > this.endTime) {\n        this.setter(this.destination);\n        this.isActive = false;\n        if (this.onComplete) {this.onComplete(); }\n    } else {\n        this.setter(\n            this.destination -\n                (this.delta * this.easing((this.endTime - now) / this.duration))\n        );\n    }\n};\n\n// Colors //////////////////////////////////////////////////////////////\n\n// Color instance creation:\n\nexport function Color(r, g, b, a) {\n    // all values are optional, just (r, g, b) is fine\n    this.r = r || 0;\n    this.g = g || 0;\n    this.b = b || 0;\n    this.a = a || ((a === 0) ? 0 : 1);\n}\n\n// Color string representation: e.g. 'rgba(255,165,0,1)'\n\nColor.prototype.toString = function () {\n    return 'rgba(' +\n        Math.round(this.r) + ',' +\n        Math.round(this.g) + ',' +\n        Math.round(this.b) + ',' +\n        this.a + ')';\n};\n\nColor.prototype.toRGBstring = function () {\n    return 'rgb(' +\n        Math.round(this.r) + ',' +\n        Math.round(this.g) + ',' +\n        Math.round(this.b) + ')';\n};\n\nColor.fromString = function (aString) {\n    // I parse rgb/rgba strings into a Color object\n    var components = aString.split(/[\\(),]/).slice(1,5);\n    return new Color(components[0], components[1], components[2], components[3]);\n};\n\n// Color copying:\n\nColor.prototype.copy = function () {\n    return new Color(\n        this.r,\n        this.g,\n        this.b,\n        this.a\n    );\n};\n\n// Color comparison:\n\nColor.prototype.eq = function (aColor, observeAlpha) {\n    // ==\n    return aColor &&\n        this.r === aColor.r &&\n        this.g === aColor.g &&\n        this.b === aColor.b &&\n        (observeAlpha ? this.a === aColor.a : true);\n};\n\nColor.prototype.isCloseTo = function (aColor, observeAlpha, tolerance) {\n    // experimental - answer whether a color is \"close\" to another one by\n    // a given percentage. tolerance is the percentage by which each color\n    // channel may diverge, alpha needs to be the exact same unless ignored\n    var thres = 2.55 * (tolerance || 10);\n\n    function dist(a, b) {\n        var diff = a - b;\n        return diff < 0 ? 255 + diff : diff;\n    }\n\n    return aColor &&\n        dist(this.r, aColor.r) < thres &&\n        dist(this.g, aColor.g) < thres &&\n        dist(this.b, aColor.b) < thres &&\n        (observeAlpha ? this.a === aColor.a : true);\n};\n\n// Color conversion (hsv):\n\nColor.prototype.hsv = function () {\n    // ignore alpha\n    var max, min, h, s, v, d,\n        rr = this.r / 255,\n        gg = this.g / 255,\n        bb = this.b / 255;\n    max = Math.max(rr, gg, bb);\n    min = Math.min(rr, gg, bb);\n    h = max;\n    s = max;\n    v = max;\n    d = max - min;\n    s = max === 0 ? 0 : d / max;\n    if (max === min) {\n        h = 0;\n    } else {\n        switch (max) {\n        case rr:\n            h = (gg - bb) / d + (gg < bb ? 6 : 0);\n            break;\n        case gg:\n            h = (bb - rr) / d + 2;\n            break;\n        case bb:\n            h = (rr - gg) / d + 4;\n            break;\n        }\n        h /= 6;\n    }\n    return [h, s, v];\n};\n\nColor.prototype.set_hsv = function (h, s, v) {\n    // ignore alpha, h, s and v are to be within [0, 1]\n    var i, f, p, q, t;\n    i = Math.floor(h * 6);\n    f = h * 6 - i;\n    p = v * (1 - s);\n    q = v * (1 - f * s);\n    t = v * (1 - (1 - f) * s);\n    switch (i % 6) {\n    case 0:\n        this.r = v;\n        this.g = t;\n        this.b = p;\n        break;\n    case 1:\n        this.r = q;\n        this.g = v;\n        this.b = p;\n        break;\n    case 2:\n        this.r = p;\n        this.g = v;\n        this.b = t;\n        break;\n    case 3:\n        this.r = p;\n        this.g = q;\n        this.b = v;\n        break;\n    case 4:\n        this.r = t;\n        this.g = p;\n        this.b = v;\n        break;\n    case 5:\n        this.r = v;\n        this.g = p;\n        this.b = q;\n        break;\n    }\n\n    this.r *= 255;\n    this.g *= 255;\n    this.b *= 255;\n\n};\n\n// Color conversion (hsl):\n\nColor.prototype.hsl = function () {\n    // ignore alpha\n    var rr = this.r / 255,\n        gg = this.g / 255,\n        bb = this.b / 255,\n        max = Math.max(rr, gg, bb), min = Math.min(rr, gg, bb),\n        h,\n        s,\n        l = (max + min) / 2,\n        d;\n    if (max === min) { // achromatic\n        h = 0;\n        s = 0;\n    } else {\n        d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        switch (max) {\n        case rr:\n            h = (gg - bb) / d + (gg < bb ? 6 : 0);\n            break;\n        case gg:\n            h = (bb - rr) / d + 2;\n            break;\n        case bb:\n            h = (rr - gg) / d + 4;\n            break;\n        }\n        h /= 6;\n    }\n    return [h, s, l];\n};\n\nColor.prototype.set_hsl = function (h, s, l) {\n    // ignore alpha, h, s and l are to be within [0, 1]\n    var q, p;\n\n    function hue2rgb(p, q, t) {\n        if (t < 0) {\n            t += 1;\n        }\n        if (t > 1) {\n            t -= 1;\n        }\n        if (t < 1/6) {\n            return p + (q - p) * 6 * t;\n        }\n        if (t < 1/2) {\n            return q;\n        }\n        if (t < 2/3) {\n            return p + (q - p) * (2/3 - t) * 6;\n        }\n        return p;\n    }\n\n    if (s == 0) { // achromatic\n        this.r = l;\n        this.g = l;\n        this.b = l;\n    } else {\n        q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n        p = 2 * l - q;\n        this.r = hue2rgb(p, q, h + 1/3);\n        this.g = hue2rgb(p, q, h);\n        this.b = hue2rgb(p, q, h - 1/3);\n    }\n\n    this.r *= 255;\n    this.g *= 255;\n    this.b *= 255;\n};\n\n// Color mixing:\n\nColor.prototype.mixed = function (proportion, otherColor) {\n    // answer a copy of this color mixed with another color, ignore alpha\n    var frac1 = Math.min(Math.max(proportion, 0), 1),\n        frac2 = 1 - frac1;\n    return new Color(\n        this.r * frac1 + otherColor.r * frac2,\n        this.g * frac1 + otherColor.g * frac2,\n        this.b * frac1 + otherColor.b * frac2\n    );\n};\n\nColor.prototype.darker = function (percent) {\n    // return an rgb-interpolated darker copy of me, ignore alpha\n    var fract = 0.8333;\n    if (percent) {\n        fract = (100 - percent) / 100;\n    }\n    return this.mixed(fract, new Color(0, 0, 0));\n};\n\nColor.prototype.lighter = function (percent) {\n    // return an rgb-interpolated lighter copy of me, ignore alpha\n    var fract = 0.8333;\n    if (percent) {\n        fract = (100 - percent) / 100;\n    }\n    return this.mixed(fract, WHITE);\n};\n\nColor.prototype.dansDarker = function () {\n    // return an hsv-interpolated darker copy of me, ignore alpha\n    var hsv = this.hsv(),\n        result = new Color(),\n        vv = Math.max(hsv[2] - 0.16, 0);\n    result.set_hsv(hsv[0], hsv[1], vv);\n    return result;\n};\n\nColor.prototype.inverted = function () {\n    return new Color(\n        255 - this.r,\n        255 - this.g,\n        255 - this.b\n    );\n};\n\nColor.prototype.solid = function () {\n    return new Color(\n        this.r,\n        this.g,\n        this.b\n    );\n};\n\n// Points //////////////////////////////////////////////////////////////\n\n// Point instance creation:\n\nexport function Point(x, y) {\n    this.x = x || 0;\n    this.y = y || 0;\n}\n\n// Point string representation: e.g. '12@68'\n\nPoint.prototype.toString = function () {\n    return Math.round(this.x.toString()) +\n        '@' + Math.round(this.y.toString());\n};\n\n// Point copying:\n\nPoint.prototype.copy = function () {\n    return new Point(this.x, this.y);\n};\n\n// Point comparison:\n\nPoint.prototype.eq = function (aPoint) {\n    // ==\n    return this.x === aPoint.x && this.y === aPoint.y;\n};\n\nPoint.prototype.lt = function (aPoint) {\n    // <\n    return this.x < aPoint.x && this.y < aPoint.y;\n};\n\nPoint.prototype.gt = function (aPoint) {\n    // >\n    return this.x > aPoint.x && this.y > aPoint.y;\n};\n\nPoint.prototype.ge = function (aPoint) {\n    // >=\n    return this.x >= aPoint.x && this.y >= aPoint.y;\n};\n\nPoint.prototype.le = function (aPoint) {\n    // <=\n    return this.x <= aPoint.x && this.y <= aPoint.y;\n};\n\nPoint.prototype.max = function (aPoint) {\n    return new Point(Math.max(this.x, aPoint.x),\n        Math.max(this.y, aPoint.y));\n};\n\nPoint.prototype.min = function (aPoint) {\n    return new Point(Math.min(this.x, aPoint.x),\n        Math.min(this.y, aPoint.y));\n};\n\n// Point conversion:\n\nPoint.prototype.round = function () {\n    return new Point(Math.round(this.x), Math.round(this.y));\n};\n\nPoint.prototype.abs = function () {\n    return new Point(Math.abs(this.x), Math.abs(this.y));\n};\n\nPoint.prototype.neg = function () {\n    return new Point(-this.x, -this.y);\n};\n\nPoint.prototype.mirror = function () {\n    return new Point(this.y, this.x);\n};\n\nPoint.prototype.floor = function () {\n    return new Point(\n        Math.max(Math.floor(this.x), 0),\n        Math.max(Math.floor(this.y), 0)\n    );\n};\n\nPoint.prototype.ceil = function () {\n    return new Point(Math.ceil(this.x), Math.ceil(this.y));\n};\n\n// Point arithmetic:\n\nPoint.prototype.add = function (other) {\n    if (other instanceof Point) {\n        return new Point(this.x + other.x, this.y + other.y);\n    }\n    return new Point(this.x + other, this.y + other);\n};\n\nPoint.prototype.subtract = function (other) {\n    if (other instanceof Point) {\n        return new Point(this.x - other.x, this.y - other.y);\n    }\n    return new Point(this.x - other, this.y - other);\n};\n\nPoint.prototype.multiplyBy = function (other) {\n    if (other instanceof Point) {\n        return new Point(this.x * other.x, this.y * other.y);\n    }\n    return new Point(this.x * other, this.y * other);\n};\n\nPoint.prototype.divideBy = function (other) {\n    if (other instanceof Point) {\n        return new Point(this.x / other.x, this.y / other.y);\n    }\n    return new Point(this.x / other, this.y / other);\n};\n\nPoint.prototype.floorDivideBy = function (other) {\n    if (other instanceof Point) {\n        return new Point(Math.floor(this.x / other.x),\n            Math.floor(this.y / other.y));\n    }\n    return new Point(Math.floor(this.x / other),\n        Math.floor(this.y / other));\n};\n\n// Point polar coordinates:\n\nPoint.prototype.r = function () {\n    var t = (this.multiplyBy(this));\n    return Math.sqrt(t.x + t.y);\n};\n\nPoint.prototype.degrees = function () {\n/*\n    answer the angle I make with origin in degrees.\n    Right is 0, down is 90\n*/\n    var tan, theta;\n\n    if (this.x === 0) {\n        if (this.y >= 0) {\n            return 90;\n        }\n        return 270;\n    }\n    tan = this.y / this.x;\n    theta = Math.atan(tan);\n    if (this.x >= 0) {\n        if (this.y >= 0) {\n            return degrees(theta);\n        }\n        return 360 + (degrees(theta));\n    }\n    return 180 + degrees(theta);\n};\n\nPoint.prototype.theta = function () {\n/*\n    answer the angle I make with origin in radians.\n    Right is 0, down is 90\n*/\n    var tan, theta;\n\n    if (this.x === 0) {\n        if (this.y >= 0) {\n            return radians(90);\n        }\n        return radians(270);\n    }\n    tan = this.y / this.x;\n    theta = Math.atan(tan);\n    if (this.x >= 0) {\n        if (this.y >= 0) {\n            return theta;\n        }\n        return radians(360) + theta;\n    }\n    return radians(180) + theta;\n};\n\n// Point functions:\n\nPoint.prototype.crossProduct = function (aPoint) {\n    return this.multiplyBy(aPoint.mirror());\n};\n\nPoint.prototype.distanceTo = function (aPoint) {\n    return (aPoint.subtract(this)).r();\n};\n\nPoint.prototype.rotate = function (direction, center) {\n    // direction must be 'right', 'left' or 'pi'\n    var offset = this.subtract(center);\n    if (direction === 'right') {\n        return new Point(-offset.y, offset.y).add(center);\n    }\n    if (direction === 'left') {\n        return new Point(offset.y, -offset.y).add(center);\n    }\n    // direction === 'pi'\n    return center.subtract(offset);\n};\n\nPoint.prototype.flip = function (direction, center) {\n    // direction must be 'vertical' or 'horizontal'\n    if (direction === 'vertical') {\n        return new Point(this.x, center.y * 2 - this.y);\n    }\n    // direction === 'horizontal'\n    return new Point(center.x * 2 - this.x, this.y);\n};\n\nPoint.prototype.distanceAngle = function (dist, angle) {\n    var deg = angle, x, y;\n    if (deg > 270) {\n        deg = deg - 360;\n    } else if (deg < -270) {\n        deg = deg + 360;\n    }\n    if (-90 <= deg && deg <= 90) {\n        x = Math.sin(radians(deg)) * dist;\n        y = Math.sqrt((dist * dist) - (x * x));\n        return new Point(x + this.x, this.y - y);\n    }\n    x = Math.sin(radians(180 - deg)) * dist;\n    y = Math.sqrt((dist * dist) - (x * x));\n    return new Point(x + this.x, this.y + y);\n};\n\n// Point transforming:\n\nPoint.prototype.scaleBy = function (scalePoint) {\n    return this.multiplyBy(scalePoint);\n};\n\nPoint.prototype.translateBy = function (deltaPoint) {\n    return this.add(deltaPoint);\n};\n\nPoint.prototype.rotateBy = function (angle, centerPoint) {\n    var center = centerPoint || ZERO,\n        p = this.subtract(center),\n        r = p.r(),\n        theta = angle - p.theta();\n    return new Point(\n        center.x + (r * Math.cos(theta)),\n        center.y - (r * Math.sin(theta))\n    );\n};\n\n// Point conversion:\n\nPoint.prototype.asArray = function () {\n    return [this.x, this.y];\n};\n\n// Rectangles //////////////////////////////////////////////////////////\n\n// Rectangle instance creation:\n\nexport function Rectangle(left, top, right, bottom) {\n    this.init(new Point((left || 0), (top || 0)),\n            new Point((right || 0), (bottom || 0)));\n}\n\nRectangle.prototype.init = function (originPoint, cornerPoint) {\n    this.origin = originPoint;\n    this.corner = cornerPoint;\n};\n\n// Rectangle string representation: e.g. '[0@0 | 160@80]'\n\nRectangle.prototype.toString = function () {\n    return '[' + this.origin.toString() + ' | ' +\n        this.extent().toString() + ']';\n};\n\n// Rectangle copying:\n\nRectangle.prototype.copy = function () {\n    return new Rectangle(\n        this.left(),\n        this.top(),\n        this.right(),\n        this.bottom()\n    );\n};\n\n// creating Rectangle instances from Points:\n\nPoint.prototype.corner = function (cornerPoint) {\n    // answer a new Rectangle\n    return new Rectangle(\n        this.x,\n        this.y,\n        cornerPoint.x,\n        cornerPoint.y\n    );\n};\n\nPoint.prototype.rectangle = function (aPoint) {\n    // answer a new Rectangle\n    var org, crn;\n    org = this.min(aPoint);\n    crn = this.max(aPoint);\n    return new Rectangle(org.x, org.y, crn.x, crn.y);\n};\n\nPoint.prototype.extent = function (aPoint) {\n    //answer a new Rectangle\n    var crn = this.add(aPoint);\n    return new Rectangle(this.x, this.y, crn.x, crn.y);\n};\n\n// Rectangle accessing - setting:\n\nRectangle.prototype.setTo = function (left, top, right, bottom) {\n    // note: all inputs are optional and can be omitted\n\n    this.origin = new Point(\n        left || ((left === 0) ? 0 : this.left()),\n        top || ((top === 0) ? 0 : this.top())\n    );\n\n    this.corner = new Point(\n        right || ((right === 0) ? 0 : this.right()),\n        bottom || ((bottom === 0) ? 0 : this.bottom())\n    );\n};\n\n// Rectangle mutating\n\nRectangle.prototype.setExtent = function(aPoint) {\n    this.setWidth(aPoint.x);\n    this.setHeight(aPoint.y);\n};\n\nRectangle.prototype.setWidth = function (width) {\n    this.corner.x = this.origin.x + width;\n};\n\nRectangle.prototype.setHeight = function (height) {\n    this.corner.y = this.origin.y + height;\n};\n\n// Rectangle accessing - getting:\n\nRectangle.prototype.area = function () {\n    //requires width() and height() to be defined\n    var w = this.width();\n    if (w < 0) {\n        return 0;\n    }\n    return Math.max(w * this.height(), 0);\n};\n\nRectangle.prototype.bottom = function () {\n    return this.corner.y;\n};\n\nRectangle.prototype.bottomCenter = function () {\n    return new Point(this.center().x, this.bottom());\n};\n\nRectangle.prototype.bottomLeft = function () {\n    return new Point(this.origin.x, this.corner.y);\n};\n\nRectangle.prototype.bottomRight = function () {\n    return this.corner.copy();\n};\n\nRectangle.prototype.boundingBox = function () {\n    return this;\n};\n\nRectangle.prototype.center = function () {\n    return this.origin.add(\n        this.corner.subtract(this.origin).floorDivideBy(2)\n    );\n};\n\nRectangle.prototype.corners = function () {\n    return [this.origin,\n        this.bottomLeft(),\n        this.corner,\n        this.topRight()];\n};\n\nRectangle.prototype.extent = function () {\n    return this.corner.subtract(this.origin);\n};\n\nRectangle.prototype.height = function () {\n    return this.corner.y - this.origin.y;\n};\n\nRectangle.prototype.left = function () {\n    return this.origin.x;\n};\n\nRectangle.prototype.leftCenter = function () {\n    return new Point(this.left(), this.center().y);\n};\n\nRectangle.prototype.right = function () {\n    return this.corner.x;\n};\n\nRectangle.prototype.rightCenter = function () {\n    return new Point(this.right(), this.center().y);\n};\n\nRectangle.prototype.top = function () {\n    return this.origin.y;\n};\n\nRectangle.prototype.topCenter = function () {\n    return new Point(this.center().x, this.top());\n};\n\nRectangle.prototype.topLeft = function () {\n    return this.origin;\n};\n\nRectangle.prototype.topRight = function () {\n    return new Point(this.corner.x, this.origin.y);\n};\n\nRectangle.prototype.width = function () {\n    return this.corner.x - this.origin.x;\n};\n\nRectangle.prototype.position = function () {\n    return this.origin;\n};\n\n// Rectangle comparison:\n\nRectangle.prototype.eq = function (aRect) {\n    return this.origin.eq(aRect.origin) &&\n        this.corner.eq(aRect.corner);\n};\n\nRectangle.prototype.abs = function () {\n    var newOrigin, newCorner;\n\n    newOrigin = this.origin.abs();\n    newCorner = this.corner.max(newOrigin);\n    return newOrigin.corner(newCorner);\n};\n\n// Rectangle functions:\n\nRectangle.prototype.insetBy = function (delta) {\n    // delta can be either a Point or a Number\n    var result = new Rectangle();\n    result.origin = this.origin.add(delta);\n    result.corner = this.corner.subtract(delta);\n    return result;\n};\n\nRectangle.prototype.expandBy = function (delta) {\n    // delta can be either a Point or a Number\n    var result = new Rectangle();\n    result.origin = this.origin.subtract(delta);\n    result.corner = this.corner.add(delta);\n    return result;\n};\n\nRectangle.prototype.growBy = function (delta) {\n    // delta can be either a Point or a Number\n    var result = new Rectangle();\n    result.origin = this.origin.copy();\n    result.corner = this.corner.add(delta);\n    return result;\n};\n\nRectangle.prototype.intersect = function (aRect) {\n    var result = new Rectangle();\n    result.origin = this.origin.max(aRect.origin);\n    result.corner = this.corner.min(aRect.corner);\n    return result;\n};\n\nRectangle.prototype.merge = function (aRect) {\n    var result = new Rectangle();\n    result.origin = this.origin.min(aRect.origin);\n    result.corner = this.corner.max(aRect.corner);\n    return result;\n};\n\nRectangle.prototype.mergeWith = function (aRect) {\n    // mutates myself\n    this.origin = this.origin.min(aRect.origin);\n    this.corner = this.corner.max(aRect.corner);\n};\n\nRectangle.prototype.round = function () {\n    return this.origin.round().corner(this.corner.round());\n};\n\nRectangle.prototype.spread = function () {\n    // round me by applying floor() to my origin and ceil() to my corner\n    // avoids artefacts on retina displays\n    return this.origin.floor().corner(this.corner.ceil());\n};\n\nRectangle.prototype.amountToTranslateWithin = function (aRect) {\n/*\n    Answer a Point, delta, such that self + delta is forced within\n    aRectangle. when all of me cannot be made to fit, prefer to keep\n    my topLeft inside. Taken from Squeak.\n*/\n    var dx = 0, dy = 0;\n\n    if (this.right() > aRect.right()) {\n        dx = aRect.right() - this.right();\n    }\n    if (this.bottom() > aRect.bottom()) {\n        dy = aRect.bottom() - this.bottom();\n    }\n    if ((this.left() + dx) < aRect.left()) {\n        dx = aRect.left() - this.left();\n    }\n    if ((this.top() + dy) < aRect.top()) {\n        dy = aRect.top() - this.top();\n    }\n    return new Point(dx, dy);\n};\n\nRectangle.prototype.regionsAround = function (aRect) {\n    // answer a list of rectangles surrounding another one,\n    // use this to clip \"holes\"\n    var regions = [];\n    if (!this.intersects(aRect)) {\n        return regions;\n    }\n    // left\n    if (aRect.left() > this.left()) {\n        regions.push(\n            new Rectangle(\n                this.left(),\n                this.top(),\n                aRect.left(),\n                this.bottom()\n            )\n        );\n    }\n    // above:\n    if (aRect.top() > this.top()) {\n        regions.push(\n            new Rectangle(\n                this.left(),\n                this.top(),\n                this.right(),\n                aRect.top()\n            )\n        );\n    }\n    // right:\n    if (aRect.right() < this.right()) {\n        regions.push(\n            new Rectangle(\n                aRect.right(),\n                this.top(),\n                this.right(),\n                this.bottom()\n            )\n        );\n    }\n    // below:\n    if (aRect.bottom() < this.bottom()) {\n        regions.push(\n            new Rectangle(\n                this.left(),\n                aRect.bottom(),\n                this.right(),\n                this.bottom()\n            )\n        );\n    }\n    return regions;\n};\n\n// Rectangle testing:\n\nRectangle.prototype.containsPoint = function (aPoint) {\n    return this.origin.le(aPoint) && aPoint.lt(this.corner);\n};\n\nRectangle.prototype.containsRectangle = function (aRect) {\n    return aRect.origin.gt(this.origin) &&\n        aRect.corner.lt(this.corner);\n};\n\nRectangle.prototype.intersects = function (aRect) {\n    var ro = aRect.origin, rc = aRect.corner;\n    return (rc.x >= this.origin.x) &&\n        (rc.y >= this.origin.y) &&\n        (ro.x <= this.corner.x) &&\n        (ro.y <= this.corner.y);\n};\n\nRectangle.prototype.isNearTo = function (aRect, threshold) {\n    var ro = aRect.origin, rc = aRect.corner, border = threshold || 0;\n    return (rc.x + border >= this.origin.x) &&\n        (rc.y  + border >= this.origin.y) &&\n        (ro.x - border <= this.corner.x) &&\n        (ro.y - border <= this.corner.y);\n};\n\n// Rectangle transforming:\n\nRectangle.prototype.scaleBy = function (scale) {\n    // scale can be either a Point or a scalar\n    var o = this.origin.multiplyBy(scale),\n        c = this.corner.multiplyBy(scale);\n    return new Rectangle(o.x, o.y, c.x, c.y);\n};\n\nRectangle.prototype.translateBy = function (delta) {\n    // delta can be either a Point or a number\n    var o = this.origin.add(delta),\n        c = this.corner.add(delta);\n    return new Rectangle(o.x, o.y, c.x, c.y);\n};\n\n// Rectangle converting:\n\nRectangle.prototype.asArray = function () {\n    return [this.left(), this.top(), this.right(), this.bottom()];\n};\n\nRectangle.prototype.asArray_xywh = function () {\n    return [this.left(), this.top(), this.width(), this.height()];\n};\n\n// Nodes ///////////////////////////////////////////////////////////////\n\n// Node instance creation:\n\nexport function Node(parent, childrenArray) {\n    this.init(parent || null, childrenArray || []);\n}\n\nNode.prototype.init = function (parent, childrenArray) {\n    this.parent = parent || null;\n    this.children = childrenArray || [];\n};\n\n// Node string representation: e.g. 'a Node[3]'\n\nNode.prototype.toString = function () {\n    return 'a Node' + '[' + this.children.length.toString() + ']';\n};\n\n// Node accessing:\n\nNode.prototype.addChild = function (aNode) {\n    this.children.push(aNode);\n    aNode.parent = this;\n};\n\nNode.prototype.addChildFirst = function (aNode) {\n    this.children.splice(0, null, aNode);\n    aNode.parent = this;\n};\n\nNode.prototype.removeChild = function (aNode) {\n    var idx = this.children.indexOf(aNode);\n    if (idx !== -1) {\n        this.children.splice(idx, 1);\n    }\n};\n\n// Node functions:\n\nNode.prototype.root = function () {\n    if (this.parent === null) {\n        return this;\n    }\n    return this.parent.root();\n};\n\nNode.prototype.depth = function () {\n    if (this.parent === null) {\n        return 0;\n    }\n    return this.parent.depth() + 1;\n};\n\nNode.prototype.allChildren = function () {\n    // includes myself\n    var result = [this];\n    this.children.forEach(child => {\n        result = result.concat(child.allChildren());\n    });\n    return result;\n};\n\nNode.prototype.forAllChildren = function (aFunction) {\n    if (this.children.length > 0) {\n        this.children.forEach(child => child.forAllChildren(aFunction));\n    }\n    aFunction.call(null, this);\n};\n\nNode.prototype.anyChild = function (aPredicate) {\n    // includes myself\n    var i;\n    if (aPredicate.call(null, this)) {\n        return true;\n    }\n    for (i = 0; i < this.children.length; i += 1) {\n        if (this.children[i].anyChild(aPredicate)) {\n            return true;\n        }\n    }\n    return false;\n};\n\nNode.prototype.allLeafs = function () {\n    var result = [];\n    this.allChildren().forEach(element => {\n        if (element.children.length === 0) {\n            result.push(element);\n        }\n    });\n    return result;\n};\n\nNode.prototype.allParents = function () {\n    // includes myself\n    var result = [this];\n    if (this.parent !== null) {\n        result = result.concat(this.parent.allParents());\n    }\n    return result;\n};\n\nNode.prototype.siblings = function () {\n    if (this.parent === null) {\n        return [];\n    }\n    return this.parent.children.filter(child => child !== this);\n};\n\nNode.prototype.parentThatIsA = function () {\n    // including myself\n    // Note: you can pass in multiple constructors to test for\n    var i;\n    for (i = 0; i < arguments.length; i += 1) {\n        if (this instanceof arguments[i]) {\n            return this;\n        }\n    }\n    if (!this.parent) {\n        return null;\n    }\n    return this.parentThatIsA.apply(this.parent, arguments);\n};\n\nNode.prototype.parentThatIsAnyOf = function (constructors) {\n    // deprecated, use parentThatIsA instead\n    return this.parentThatIsA.apply(this, constructors);\n};\n\n// Morphs //////////////////////////////////////////////////////////////\n\n// Morph: referenced constructors\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// Morph inherits from Node:\n\nMorph.prototype = new Node();\nMorph.prototype.constructor = Morph;\nMorph.uber = Node.prototype;\n\n// Morph settings:\n\nMorph.prototype.shadowBlur = 4;\n\n// Morph instance creation:\n\nexport function Morph() {\n    this.init();\n}\n\n// Morph initialization:\n\nMorph.prototype.init = function () {\n    Morph.uber.init.call(this);\n    this.isMorph = true; // used to optimize deep copying\n    this.cachedImage = null;\n    this.isCachingImage = false;\n    this.shouldRerender = false;\n    this.bounds = new Rectangle(0, 0, 50, 40);\n    this.holes = []; // list of \"untouchable\" regions (rectangles)\n    this.color = new Color(80, 80, 80);\n    this.texture = null; // optional url of a fill-image\n    this.cachedTexture = null; // internal cache of actual bg image\n    this.alpha = 1;\n    this.isVisible = true;\n    this.isDraggable = false;\n    this.isTemplate = false;\n    this.acceptsDrops = false;\n    this.isFreeForm = false;\n    this.noDropShadow = false;\n    this.fullShadowSource = true;\n    this.fps = 0;\n    this.customContextMenu = null;\n    this.lastTime = Date.now();\n    this.onNextStep = null; // optional function to be run once\n};\n\n// Morph string representation: e.g. 'a Morph 2 [20@45 | 130@250]'\n\nMorph.prototype.toString = function () {\n    return 'a ' +\n        (this.constructor.name ||\n            this.constructor.toString().split(' ')[1].split('(')[0]) +\n        ' ' +\n        this.children.length.toString() + ' ' +\n        this.bounds;\n};\n\n// Morph deleting:\n\nMorph.prototype.destroy = function () {\n    if (this.parent !== null) {\n        this.fullChanged();\n        this.parent.removeChild(this);\n    }\n};\n\n// Morph stepping:\n\nMorph.prototype.stepFrame = function () {\n    if (!this.step) {\n        return null;\n    }\n    var current, elapsed, leftover, nxt;\n    current = Date.now();\n    elapsed = current - this.lastTime;\n    if (this.fps > 0) {\n        leftover = (1000 / this.fps) - elapsed;\n    } else {\n        leftover = 0;\n    }\n    if (leftover < 1) {\n        this.lastTime = current;\n        if (this.onNextStep) {\n            nxt = this.onNextStep;\n            this.onNextStep = null;\n            nxt.call(this);\n        }\n        this.step();\n        this.children.forEach(child => child.stepFrame());\n    }\n};\n\nMorph.prototype.nextSteps = function (arrayOfFunctions) {\n    var lst = arrayOfFunctions || [],\n        nxt = lst.shift();\n    if (nxt) {\n        this.onNextStep = () => {\n            nxt.call(this);\n            this.nextSteps(lst);\n        };\n    }\n};\n\nMorph.prototype.step = nop;\n\n// Morph accessing - geometry getting:\n\nMorph.prototype.left = function () {\n    return this.bounds.left();\n};\n\nMorph.prototype.right = function () {\n    return this.bounds.right();\n};\n\nMorph.prototype.top = function () {\n    return this.bounds.top();\n};\n\nMorph.prototype.bottom = function () {\n    return this.bounds.bottom();\n};\n\nMorph.prototype.center = function () {\n    return this.bounds.center();\n};\n\nMorph.prototype.bottomCenter = function () {\n    return this.bounds.bottomCenter();\n};\n\nMorph.prototype.bottomLeft = function () {\n    return this.bounds.bottomLeft();\n};\n\nMorph.prototype.bottomRight = function () {\n    return this.bounds.bottomRight();\n};\n\nMorph.prototype.boundingBox = function () {\n    return this.bounds;\n};\n\nMorph.prototype.corners = function () {\n    return this.bounds.corners();\n};\n\nMorph.prototype.leftCenter = function () {\n    return this.bounds.leftCenter();\n};\n\nMorph.prototype.rightCenter = function () {\n    return this.bounds.rightCenter();\n};\n\nMorph.prototype.topCenter = function () {\n    return this.bounds.topCenter();\n};\n\nMorph.prototype.topLeft = function () {\n    return this.bounds.topLeft();\n};\n\nMorph.prototype.topRight = function () {\n    return this.bounds.topRight();\n};\nMorph.prototype.position = function () {\n    return this.bounds.origin;\n};\n\nMorph.prototype.extent = function () {\n    return this.bounds.extent();\n};\n\nMorph.prototype.width = function () {\n    return this.bounds.width();\n};\n\nMorph.prototype.height = function () {\n    return this.bounds.height();\n};\n\nMorph.prototype.fullBounds = function () {\n    var result;\n    result = this.bounds;\n    this.children.forEach(child => {\n        if (child.isVisible) {\n            result = result.merge(child.fullBounds());\n        }\n    });\n    return result;\n};\n\nMorph.prototype.fullBoundsNoShadow = function () {\n    // answer my full bounds but ignore any shadow\n    var result;\n    result = this.bounds;\n    this.children.forEach(child => {\n        if (!(child instanceof ShadowMorph) && (child.isVisible)) {\n            result = result.merge(child.fullBounds());\n        }\n    });\n    return result;\n};\n\nMorph.prototype.visibleBounds = function () {\n    // answer which part of me is not clipped by a Frame\n    var visible = this.bounds,\n        frames = this.allParents().filter(p => p instanceof FrameMorph);\n    frames.forEach(f => visible = visible.intersect(f.bounds));\n    return visible;\n};\n\n// Morph accessing - simple changes:\n\nMorph.prototype.moveBy = function (delta) {\n    var children = this.children,\n        i = children.length;\n    this.changed();\n    this.bounds = this.bounds.translateBy(delta);\n    this.changed();\n    for (i; i > 0; i -= 1) {\n        children[i - 1].moveBy(delta);\n    }\n};\n\nMorph.prototype.setPosition = function (aPoint) {\n    var delta = aPoint.subtract(this.topLeft());\n    if (!(delta.eq(ZERO))) {\n        this.moveBy(delta);\n    }\n};\n\nMorph.prototype.setLeft = function (x) {\n    this.setPosition(\n        new Point(\n            x,\n            this.top()\n        )\n    );\n};\n\nMorph.prototype.setRight = function (x) {\n    this.setPosition(\n        new Point(\n            x - this.width(),\n            this.top()\n        )\n    );\n};\n\nMorph.prototype.setTop = function (y) {\n    this.setPosition(\n        new Point(\n            this.left(),\n            y\n        )\n    );\n};\n\nMorph.prototype.setBottom = function (y) {\n    this.setPosition(\n        new Point(\n            this.left(),\n            y - this.height()\n        )\n    );\n};\n\nMorph.prototype.setCenter = function (aPoint) {\n    this.setPosition(\n        aPoint.subtract(\n            this.extent().floorDivideBy(2)\n        )\n    );\n};\n\nMorph.prototype.setFullCenter = function (aPoint) {\n    this.setPosition(\n        aPoint.subtract(\n            this.fullBounds().extent().floorDivideBy(2)\n        )\n    );\n};\n\nMorph.prototype.keepWithin = function (aMorph) {\n    // make sure I am completely within another Morph's bounds\n    var leftOff, rightOff, topOff, bottomOff;\n    rightOff = this.fullBounds().right() - aMorph.right();\n    if (rightOff > 0) {\n        this.moveBy(new Point(-rightOff, 0));\n    }\n    leftOff = this.fullBounds().left() - aMorph.left();\n    if (leftOff < 0) {\n        this.moveBy(new Point(-leftOff, 0));\n    }\n    bottomOff = this.fullBounds().bottom() - aMorph.bottom();\n    if (bottomOff > 0) {\n        this.moveBy(new Point(0, -bottomOff));\n    }\n    topOff = this.fullBounds().top() - aMorph.top();\n    if (topOff < 0) {\n        this.moveBy(new Point(0, -topOff));\n    }\n};\n\nMorph.prototype.scrollIntoView = function () {\n    var leftOff, rightOff, topOff, bottomOff,\n        sf = this.parentThatIsA(ScrollFrameMorph);\n    if (!sf) {return; }\n    rightOff = Math.min(\n        this.fullBounds().right() - sf.right(),\n        sf.contents.right() - sf.right()\n    );\n    if (rightOff > 0) {\n        sf.contents.moveBy(new Point(-rightOff, 0));\n    }\n    leftOff = this.fullBounds().left() - sf.left();\n    if (leftOff < 0) {\n        sf.contents.moveBy(new Point(-leftOff, 0));\n    }\n    topOff = this.fullBounds().top() - sf.top();\n    if (topOff < 0) {\n        sf.contents.moveBy(new Point(0, -topOff));\n    }\n    bottomOff = this.fullBounds().bottom() - sf.bottom();\n    if (bottomOff > 0) {\n        sf.contents.moveBy(new Point(0, -bottomOff));\n    }\n    sf.adjustScrollBars();\n};\n\n// Morph accessing - dimensional changes requiring a complete redraw\n\nMorph.prototype.setExtent = function (aPoint) {\n    if (aPoint.eq(this.extent())) {return; }\n    this.changed();\n    this.bounds.setWidth(aPoint.x);\n    this.bounds.setHeight(aPoint.y);\n    this.fixLayout();\n    this.rerender();\n};\n\nMorph.prototype.setWidth = function (width) {\n    this.setExtent(new Point(width || 0, this.height()));\n};\n\nMorph.prototype.setHeight = function (height) {\n    this.setExtent(new Point(this.width(), height || 0));\n};\n\nMorph.prototype.setColor = function (aColor) {\n    if (aColor) {\n        if (!this.color.eq(aColor)) {\n            this.color = aColor;\n            this.rerender();\n        }\n    }\n};\n\n// Morph rendering:\n\nMorph.prototype.getImage = function () {\n    var img;\n    if (this.cachedImage && !this.shouldRerender) {\n        return this.cachedImage;\n    }\n    img = newCanvas(this.extent(), false, this.cachedImage);\n    if (this.isCachingImage) {\n        this.cachedImage = img;\n    }\n    this.render(img.getContext('2d'));\n    this.shouldRerender = false;\n    return img;\n};\n\nMorph.prototype.render = function (aContext) {\n    aContext.fillStyle = this.getRenderColor().toString();\n    aContext.fillRect(0, 0, this.width(), this.height());\n    if (this.cachedTexture) {\n        this.renderCachedTexture(aContext);\n    } else if (this.texture) {\n        this.renderTexture(this.texture, aContext);\n    }\n};\n\nMorph.prototype.getRenderColor = function () {\n    // can be overriden by my heirs or instances\n    return this.color;\n};\n\nMorph.prototype.fixLayout = function () {\n    // implemented by my heirs\n    // determine my extent and arrange my submorphs, if any\n    // default is to do nothing\n    // NOTE: If you need to set the extent, in order to avoid\n    // infinite recursion instead of calling setExtent() (which will\n    // in turn call fixLayout() again) directly modify the bounds\n    // property, e.g. like this: this.bounds.setExtent()\n    return;\n};\n\nMorph.prototype.fixHolesLayout = function () {\n    // implemented by my heirs\n    // arrange my untouchable areas, if any\n    // default is to do nothing\n    return;\n};\n\n// Morph displaying:\n\nMorph.prototype.renderTexture = function (url, ctx) {\n    this.cachedTexture = new Image();\n    this.cachedTexture.onload = () => this.changed();\n    this.cachedTexture.src = this.texture = url;\n};\n\nMorph.prototype.renderCachedTexture = function (ctx) {\n    var bg = this.cachedTexture,\n        cols = Math.floor(this.width() / bg.width),\n        lines = Math.floor(this.height() / bg.height),\n        x,\n        y;\n\n    ctx.save();\n    ctx.globalAlpha = this.alpha;\n    ctx.beginPath();\n    ctx.rect(0, 0, this.width(), this.height());\n    ctx.clip();\n    for (y = 0; y <= lines; y += 1) {\n        for (x = 0; x <= cols; x += 1) {\n            ctx.drawImage(bg, x * bg.width, y * bg.height);\n        }\n    }\n    ctx.restore();\n};\n\nMorph.prototype.drawOn = function (ctx, rect) {\n    var clipped = rect.intersect(this.bounds),\n        pos = this.position(),\n        pic, src, w, h, sl, st;\n\n    if (!clipped.extent().gt(ZERO)) {return; }\n    ctx.save();\n    ctx.globalAlpha = this.alpha;\n    if (this.isCachingImage) {\n        pic = this.getImage();\n        src = clipped.translateBy(pos.neg());\n        sl = src.left();\n        st = src.top();\n        w = Math.min(src.width(), pic.width - sl);\n        h = Math.min(src.height(), pic.height - st);\n        if (w < 1 || h < 1) {return; }\n        ctx.drawImage(\n            pic,\n            sl,\n            st,\n            w,\n            h,\n            clipped.left(),\n            clipped.top(),\n            w,\n            h\n        );\n    } else { // render directly on target canvas\n        ctx.beginPath();\n        ctx.rect(clipped.left(), clipped.top(), clipped.width(), clipped.height());\n        ctx.clip();\n        ctx.translate(pos.x, pos.y);\n        this.render(ctx);\n        if (MorphicPreferences.showHoles) { // debug hole rendering\n            ctx.translate(-pos.x, -pos.y);\n            ctx.globalAlpha = 0.25;\n            ctx.fillStyle = 'white';\n            this.holes.forEach(hole => {\n                var sect = hole.translateBy(pos).intersect(clipped);\n                ctx.fillRect(\n                    sect.left(),\n                    sect.top(),\n                    sect.width(),\n                    sect.height()\n                );\n            });\n        }\n    }\n    ctx.restore();\n};\n\nMorph.prototype.fullDrawOn = function (aContext, aRect) {\n    if (!this.isVisible) {return; }\n    this.drawOn(aContext, aRect);\n    this.children.forEach(child => child.fullDrawOn(aContext, aRect));\n};\n\nMorph.prototype.hide = function () {\n    this.isVisible = false;\n    this.changed();\n};\n\nMorph.prototype.show = function () {\n    this.isVisible = true;\n    this.changed();\n};\n\nMorph.prototype.toggleVisibility = function () {\n    this.isVisible = !this.isVisible;\n    this.changed();\n};\n\n// Morph full image:\n\nMorph.prototype.fullImage = function () {\n    var fb = this.fullBounds(),\n        img = newCanvas(fb.extent()),\n        ctx = img.getContext('2d');\n    ctx.translate(-fb.origin.x, -fb.origin.y);\n    this.fullDrawOn(ctx, fb);\n    return img;\n};\n\n// Morph shadow:\n\nMorph.prototype.shadowImage = function (off, color) {\n    // for flat design mode\n    var fb, img, outline, sha, ctx,\n        offset = off || new Point(7, 7),\n        clr = color || new Color(0, 0, 0);\n    if (this.fullShadowSource) {\n        fb = this.fullBounds().extent();\n        img = this.fullImage();\n    } else { // optimization when all submorphs are contained inside\n        fb = this.extent();\n        img = this.getImage();\n    }\n    outline = newCanvas(fb);\n    ctx = outline.getContext('2d');\n    ctx.drawImage(img, 0, 0);\n    ctx.globalCompositeOperation = 'destination-out';\n    ctx.drawImage(\n        img,\n        -offset.x,\n        -offset.y\n    );\n    sha = newCanvas(fb);\n    ctx = sha.getContext('2d');\n    ctx.drawImage(outline, 0, 0);\n    ctx.globalCompositeOperation = 'source-atop';\n    ctx.fillStyle = clr.toString();\n    ctx.fillRect(0, 0, fb.x, fb.y);\n    return sha;\n};\n\nMorph.prototype.shadowImageBlurred = function (off, color) {\n    var fb, img, sha, ctx,\n        offset = off || new Point(7, 7),\n        blur = this.shadowBlur,\n        clr = color || new Color(0, 0, 0);\n    if (this.fullShadowSource) {\n        fb = this.fullBounds().extent().add(blur * 2);\n        img = this.fullImage();\n    } else { // optimization when all submorphs are contained inside\n        fb = this.extent().add(blur * 2);\n        img = this.getImage();\n    }\n    sha = newCanvas(fb);\n    ctx = sha.getContext('2d');\n    ctx.shadowOffsetX = offset.x;\n    ctx.shadowOffsetY = offset.y;\n    ctx.shadowBlur = blur;\n    ctx.shadowColor = clr.toString();\n    ctx.drawImage(\n        img,\n        blur - offset.x,\n        blur - offset.y\n    );\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 0;\n    ctx.shadowBlur = 0;\n    ctx.globalCompositeOperation = 'destination-out';\n    ctx.drawImage(\n        img,\n        blur - offset.x,\n        blur - offset.y\n    );\n    return sha;\n};\n\nMorph.prototype.shadow = function (off, a, color) {\n    var shadow = new ShadowMorph(),\n        offset = off || new Point(7, 7),\n        alpha = a || ((a === 0) ? 0 : 0.2),\n        fb = this.fullBounds();\n    shadow.setExtent(fb.extent().add(this.shadowBlur * 2));\n    if (useBlurredShadows /*&& !MorphicPreferences.isFlat*/) {\n        shadow.cachedImage = this.shadowImageBlurred(offset, color);\n        shadow.alpha = alpha;\n        shadow.setPosition(fb.origin.add(offset).subtract(this.shadowBlur));\n    } else {\n        shadow.cachedImage = this.shadowImage(offset, color);\n        shadow.alpha = alpha;\n        shadow.setPosition(fb.origin.add(offset));\n    }\n    shadow.shouldRerender = false;\n    return shadow;\n};\n\nMorph.prototype.addShadow = function (off, a, color) {\n    var shadow,\n        offset = off || new Point(7, 7),\n        alpha = a || ((a === 0) ? 0 : 0.2);\n    shadow = this.shadow(offset, alpha, color);\n    this.addBack(shadow);\n    this.fullChanged();\n    return shadow;\n};\n\nMorph.prototype.getShadow = function () {\n    var shadows;\n    shadows = this.children.slice(0).reverse().filter(\n        child => child instanceof ShadowMorph\n    );\n    if (shadows.length !== 0) {\n        return shadows[0];\n    }\n    return null;\n};\n\nMorph.prototype.removeShadow = function () {\n    var shadow = this.getShadow();\n    if (shadow !== null) {\n        this.fullChanged();\n        this.removeChild(shadow);\n    }\n};\n\n// Morph pen trails:\n\nMorph.prototype.penTrails = function () {\n    // answer my pen trails canvas. default is to answer my image\n    // NOTE: clients calling this also want to make sure the\n    // obtained canvas will be around at the next display cycle,\n    // so they might also wish to set the receiver's \"isCachingImage\"\n    // property to \"true\".\n    return this.getImage();\n};\n\n// Morph updating:\n\nMorph.prototype.rerender = function () {\n    this.shouldRerender = true;\n    this.changed();\n};\n\nMorph.prototype.changed = function () {\n    var w = this.root();\n    if (w instanceof WorldMorph) {\n        w.broken.push(this.visibleBounds().spread());\n    }\n    if (this.parent) {\n        this.parent.childChanged(this);\n    }\n};\n\nMorph.prototype.fullChanged = function () {\n    var w = this.root();\n    if (w instanceof WorldMorph) {\n        w.broken.push(\n            this.fullBounds().spread()\n        );\n    }\n};\n\nMorph.prototype.childChanged = function () {\n    // react to a change in one of my children,\n    // default is to just pass this message on upwards\n    // override this method for Morphs that need to adjust accordingly\n    if (this.parent) {\n        this.parent.childChanged(this);\n    }\n};\n\n// Morph accessing - structure:\n\nMorph.prototype.world = function () {\n    var root = this.root();\n    if (root instanceof WorldMorph) {\n        return root;\n    }\n    if (root instanceof HandMorph) {\n        return root.world;\n    }\n    return null;\n};\n\nMorph.prototype.add = function (aMorph) {\n    var owner = aMorph.parent;\n    if (owner !== null) {\n        owner.removeChild(aMorph);\n    }\n    this.addChild(aMorph);\n};\n\nMorph.prototype.addBack = function (aMorph) {\n    var owner = aMorph.parent;\n    if (owner !== null) {\n        owner.removeChild(aMorph);\n    }\n    this.addChildFirst(aMorph);\n};\n\nMorph.prototype.topMorphAt = function (point) {\n    var i, result;\n    if (!this.isVisible) {return null; }\n    for (i = this.children.length - 1; i >= 0; i -= 1) {\n        result = this.children[i].topMorphAt(point);\n        if (result) {return result; }\n    }\n    if (this.bounds.containsPoint(point)) {\n        if (this.holes.some(\n                any => any.translateBy(this.position()).containsPoint(point))\n        ) {\n            return null;\n        }\n        if (this.isFreeForm) {\n            if (!this.isTransparentAt(point)) {\n                return this;\n            }\n        } else {\n            return this;\n        }\n    }\n    return null;\n};\n\nMorph.prototype.topMorphSuchThat = function (predicate) {\n    var next;\n    if (predicate.call(null, this)) {\n        next = detect(\n            this.children.slice(0).reverse(),\n            predicate\n        );\n        if (next) {\n            return next.topMorphSuchThat(predicate);\n        }\n        return this;\n    }\n    return null;\n};\n\nMorph.prototype.overlappedMorphs = function () {\n    //exclude the World\n    var world = this.world(),\n        fb = this.fullBounds(),\n        allParents = this.allParents(),\n        allChildren = this.allChildren(),\n        morphs;\n\n    morphs = world.allChildren();\n    return morphs.filter(m => {\n        return m.isVisible &&\n            m !== this &&\n            m !== world &&\n            !contains(allParents, m) &&\n            !contains(allChildren, m) &&\n            m.fullBounds().intersects(fb);\n    });\n};\n\n// Morph pixel access:\n\nMorph.prototype.getPixelColor = function (aPoint) {\n    var point, context, data;\n    point = aPoint.subtract(this.bounds.origin);\n    context = this.getImage().getContext('2d');\n    data = context.getImageData(point.x, point.y, 1, 1);\n    return new Color(\n        data.data[0],\n        data.data[1],\n        data.data[2],\n        data.data[3] / 255\n    );\n};\n\nMorph.prototype.isTransparentAt = function (aPoint) {\n    var point, context, data;\n    if (this.bounds.containsPoint(aPoint)) {\n        if (this.texture) {\n            return false;\n        }\n        point = aPoint.subtract(this.bounds.origin);\n        context = this.getImage().getContext('2d');\n        data = context.getImageData(\n            Math.floor(point.x),\n            Math.floor(point.y),\n            1,\n            1\n        );\n        return data.data[3] === 0;\n    }\n    return false;\n};\n\n// Morph duplicating:\n\nMorph.prototype.copy = function () {\n    var c = copy(this);\n    c.parent = null;\n    c.children = [];\n    c.bounds = this.bounds.copy();\n    return c;\n};\n\nMorph.prototype.fullCopy = function () {\n    /*\n    Produce a copy of me with my entire tree of submorphs. Morphs\n    mentioned more than once are all directed to a single new copy.\n    Other properties are also *shallow* copied, so you must override\n    to deep copy Arrays and (complex) Objects\n    */\n    var map = new Map(), c;\n    c = this.copyRecordingReferences(map);\n    c.forAllChildren(m => m.updateReferences(map));\n    return c;\n};\n\nMorph.prototype.copyRecordingReferences = function (map) {\n    /*\n    Recursively copy this entire composite morph, recording the\n    correspondence between old and new morphs in the given dictionary.\n    This dictionary will be used to update intra-composite references\n    in the copy. See updateReferences().\n\n    Note: This default implementation copies ONLY morphs. If a morph\n    stores morphs in other properties that it wants to copy, then it\n    should override this method to do so. The same goes for morphs that\n    contain other complex data that should be copied when the morph is\n    duplicated.\n    */\n    var c = this.copy();\n    map.set(this, c);\n    this.children.forEach(m => c.add(m.copyRecordingReferences(map)));\n    return c;\n};\n\nMorph.prototype.updateReferences = function (map) {\n    /*\n    Update intra-morph references within a composite morph that has\n    been copied. For example, if a button refers to morph X in the\n    orginal composite then the copy of that button in the new composite\n    should refer to the copy of X in new composite, not the original X.\n    */\n    var properties = Object.keys(this),\n        l = properties.length,\n        property,\n        value,\n        reference,\n        i;\n    for (i = 0; i < l; i += 1) {\n        property = properties[i];\n        value = this[property];\n        if (value && value.isMorph) {\n            reference = map.get(value);\n            if (reference) { this[property] = reference; }\n        }\n    }\n};\n\n// Morph dragging and dropping:\n\nMorph.prototype.rootForGrab = function () {\n    if (this instanceof ShadowMorph) {\n        return this.parent.rootForGrab();\n    }\n    if (this.parent instanceof ScrollFrameMorph) {\n        return this.parent;\n    }\n    if (this.parent === null ||\n            this.parent instanceof WorldMorph ||\n            this.parent instanceof FrameMorph ||\n            this.isDraggable === true) {\n        return this;\n    }\n    return this.parent.rootForGrab();\n};\n\nMorph.prototype.isCorrectingOutsideDrag = function () {\n    // make sure I don't \"trail behind\" the hand when dragged\n    // override for morphs that you want to be dragged outside\n    // their full bounds\n    return true;\n};\n\nMorph.prototype.wantsDropOf = function (aMorph) {\n    // default is to answer the general flag - change for my heirs\n    if ((aMorph instanceof HandleMorph) ||\n            (aMorph instanceof MenuMorph) ||\n            (aMorph instanceof InspectorMorph)) {\n        return false;\n    }\n    return this.acceptsDrops;\n};\n\nMorph.prototype.pickUp = function (wrrld) {\n    var world = wrrld || this.world();\n    this.setPosition(\n        world.hand.position().subtract(\n            this.extent().floorDivideBy(2)\n        )\n    );\n    world.hand.grab(this);\n};\n\nMorph.prototype.isPickedUp = function () {\n    return this.parentThatIsA(HandMorph) !== null;\n};\n\nMorph.prototype.situation = function () {\n    // answer a dictionary specifying where I am right now, so\n    // I can slide back to it if I'm dropped somewhere else\n    if (this.parent) {\n        return {\n            origin: this.parent,\n            position: this.position().subtract(this.parent.position())\n        };\n    }\n    return null;\n};\n\nMorph.prototype.slideBackTo = function (\n    situation,\n    msecs,\n    onBeforeDrop,\n    onComplete\n) {\n    var pos = situation.origin.position().add(situation.position);\n    this.glideTo(\n        pos,\n        msecs,\n        null, // easing\n        () => {\n            situation.origin.add(this);\n            if (onBeforeDrop) {onBeforeDrop(); }\n            if (this.justDropped) {this.justDropped(); }\n            if (situation.origin.reactToDropOf) {\n                situation.origin.reactToDropOf(this);\n            }\n            if (onComplete) {onComplete(); }\n        }\n    );\n};\n\n// Morph animating:\n\nMorph.prototype.glideTo = function (endPoint, msecs, easing, onComplete) {\n    var world = this.world(),\n        horizontal = new Animation(\n            x => this.setLeft(x),\n            () => this.left(),\n            -(this.left() - endPoint.x),\n            msecs || 100,\n            easing\n        );\n    world.animations.push(horizontal);\n    world.animations.push(new Animation(\n        y => this.setTop(y),\n        () => this.top(),\n        -(this.top() - endPoint.y),\n        msecs || 100,\n        easing,\n        () => {\n            horizontal.setter(horizontal.destination);\n            horizontal.isActive = false;\n            onComplete();\n        }\n\n    ));\n};\n\nMorph.prototype.fadeTo = function (endAlpha, msecs, easing, onComplete) {\n    // include all my children, restore all original transparencies\n    // on completion, so I can be recovered\n    var world = this.world(),\n        oldAlpha = this.alpha;\n    this.children.forEach(child => child.fadeTo(endAlpha, msecs, easing));\n    world.animations.push(new Animation(\n        n => {\n            this.alpha = n;\n            this.changed();\n        },\n        () => this.alpha,\n        endAlpha - this.alpha,\n        msecs || 200,\n        easing,\n        () => {\n            this.alpha = oldAlpha;\n            if (onComplete) {onComplete(); }\n        }\n    ));\n};\n\nMorph.prototype.perish = function (msecs, onComplete) {\n    this.fadeTo(\n        0,\n        msecs || 100,\n        null,\n        () => {\n            this.destroy();\n            if (onComplete) {onComplete(); }\n        }\n    );\n};\n\n// Morph utilities:\n\nMorph.prototype.nop = nop;\n\nMorph.prototype.resize = function () {\n    this.world().activeHandle = new HandleMorph(this);\n};\n\nMorph.prototype.move = function () {\n    this.world().activeHandle = new HandleMorph(\n        this,\n        null,\n        null,\n        null,\n        null,\n        'move'\n    );\n};\n\nMorph.prototype.moveCenter = function () {\n    this.world().activeHandle = new HandleMorph(\n        this,\n        null,\n        null,\n        null,\n        null,\n        'moveCenter'\n    );\n};\n\nMorph.prototype.hint = function (msg) {\n    var m, text;\n    text = msg;\n    if (msg) {\n        if (msg.toString) {\n            text = msg.toString();\n        }\n    } else {\n        text = 'NULL';\n    }\n    m = new MenuMorph(this, text);\n    m.isDraggable = true;\n    m.popUpCenteredAtHand(this.world());\n};\n\nMorph.prototype.inform = function (msg) {\n    var m, text;\n    text = msg;\n    if (msg) {\n        if (msg.toString) {\n            text = msg.toString();\n        }\n    } else {\n        text = 'NULL';\n    }\n    m = new MenuMorph(this, text);\n    m.addItem(\"Ok\");\n    m.isDraggable = true;\n    m.popUpCenteredAtHand(this.world());\n};\n\nMorph.prototype.prompt = function (\n    msg,\n    callback,\n    environment,\n    defaultContents,\n    width,\n    floorNum,\n    ceilingNum,\n    isRounded,\n    action = nop\n) {\n    var menu, entryField, slider, isNumeric;\n    if (ceilingNum) {\n        isNumeric = true;\n    }\n    menu = new MenuMorph(\n        callback || null,\n        msg || '',\n        environment || null\n    );\n    entryField = new StringFieldMorph(\n        defaultContents || '',\n        width || 100,\n        MorphicPreferences.prompterFontSize,\n        MorphicPreferences.prompterFontName,\n        false,\n        false,\n        isNumeric\n    );\n    menu.items.push(entryField);\n    if (ceilingNum || MorphicPreferences.useSliderForInput) {\n        slider = new SliderMorph(\n            floorNum || 0,\n            ceilingNum,\n            parseFloat(defaultContents),\n            Math.floor((ceilingNum - floorNum) / 4),\n            'horizontal'\n        );\n        slider.alpha = 1;\n        slider.color = new Color(225, 225, 225);\n        slider.button.color = menu.borderColor;\n        slider.button.highlightColor = slider.button.color.copy();\n        slider.button.highlightColor.b += 100;\n        slider.button.pressColor = slider.button.color.copy();\n        slider.button.pressColor.b += 150;\n        slider.setHeight(MorphicPreferences.prompterSliderSize);\n        if (isRounded) {\n            slider.action = (num) => {\n                entryField.changed();\n                entryField.text.text = Math.round(num).toString();\n                entryField.text.fixLayout();\n                entryField.text.changed();\n                entryField.text.edit();\n                action(Math.round(num));\n            };\n        } else {\n            slider.action = (num) => {\n                entryField.changed();\n                entryField.text.text = num.toString();\n                entryField.text.fixLayout();\n                entryField.text.changed();\n                action(num);\n            };\n        }\n        menu.items.push(slider);\n    }\n\n    menu.addLine(2);\n    menu.addItem('Ok', () => entryField.string());\n    menu.addItem(\n        'Cancel',\n        () => {\n            action(defaultContents);\n            return null;\n        }\n    );\n    menu.isDraggable = true;\n    menu.popUpAtHand(this.world());\n    entryField.text.edit();\n};\n\nMorph.prototype.pickColor = function (\n    msg,\n    callback,\n    environment,\n    defaultContents\n) {\n    var menu, colorPicker;\n    menu = new MenuMorph(\n        callback || null,\n        msg || '',\n        environment || null\n    );\n    colorPicker = new ColorPickerMorph(defaultContents);\n    menu.items.push(colorPicker);\n    menu.addLine(2);\n    menu.addItem('Ok', () => colorPicker.getChoice());\n    menu.addItem('Cancel', () => null);\n    menu.isDraggable = true;\n    menu.popUpAtHand(this.world());\n};\n\nMorph.prototype.inspect = function (anotherObject) {\n    var world = this.world instanceof Function ?\n            this.world() : this.root() || this.world,\n        inspector,\n        inspectee = this;\n\n    if (anotherObject) {\n        inspectee = anotherObject;\n    }\n    inspector = new InspectorMorph(inspectee);\n    inspector.setPosition(world.hand.position());\n    inspector.keepWithin(world);\n    world.add(inspector);\n    inspector.changed();\n};\n\nMorph.prototype.inspectKeyEvent = function (event) {\n    this.inform(\n        'Key pressed: ' +\n            String.fromCharCode(event.charCode) +\n            '\\n------------------------' +\n            '\\ncharCode: ' +\n            event.charCode.toString() +\n            '\\nkeyCode: ' +\n            event.keyCode.toString() +\n            '\\nkey: ' +\n            event.key.toString() +\n            '\\nshiftKey: ' +\n            event.shiftKey.toString() +\n            '\\naltKey: ' +\n            event.altKey.toString() +\n            '\\nctrlKey: ' +\n            event.ctrlKey.toString() +\n            '\\ncmdKey: ' +\n            event.metaKey.toString()\n    );\n};\n\n// Morph menus:\n\nMorph.prototype.contextMenu = function () {\n    var world;\n\n    if (this.customContextMenu) {\n        return this.customContextMenu;\n    }\n    world = this.world instanceof Function ? this.world() : this.world;\n    if (world && world.isDevMode) {\n        if (this.parent === world) {\n            return this.developersMenu();\n        }\n        return this.hierarchyMenu();\n    }\n    return this.userMenu() ||\n        (this.parent && this.parent.userMenu());\n};\n\nMorph.prototype.hierarchyMenu = function () {\n    var parents = this.allParents(),\n        world = this.world instanceof Function ? this.world() : this.world,\n        menu = new MenuMorph(this, null);\n\n    parents.forEach(each => {\n        if (each.developersMenu && (each !== world)) {\n            menu.addMenu(\n                each.toString().slice(0, 50),\n                each.developersMenu()\n            );\n        }\n    });\n    return menu;\n};\n\nMorph.prototype.developersMenu = function () {\n    // 'name' is not an official property of a function, hence:\n    var world = this.world instanceof Function ? this.world() : this.world,\n        userMenu = this.userMenu() ||\n            (this.parent && this.parent.userMenu()),\n        menu = new MenuMorph(this, this.constructor.name ||\n            this.constructor.toString().split(' ')[1].split('(')[0]);\n    if (userMenu) {\n        menu.addMenu('user features', userMenu);\n        menu.addLine();\n    }\n    menu.addItem(\n        \"color...\",\n        () => {\n            this.pickColor(\n                menu.title + localize('\\ncolor:'),\n                this.setColor,\n                this,\n                this.color\n            );\n        },\n        'choose another color \\nfor this morph'\n    );\n    menu.addItem(\n        \"transparency...\",\n        () => {\n            this.prompt(\n                menu.title + localize('\\nalpha\\nvalue:'),\n                this.setAlphaScaled,\n                this,\n                (this.alpha * 100).toString(),\n                null,\n                1,\n                100,\n                true\n            );\n        },\n        'set this morph\\'s\\nalpha value'\n    );\n    menu.addItem(\n        \"resize...\",\n        'resize',\n        'show a handle\\nwhich can be dragged\\nto change this morph\\'s' +\n            ' extent'\n    );\n    menu.addLine();\n    menu.addItem(\n        \"duplicate\",\n        () =>  this.fullCopy().pickUp(this.world()),\n        'make a copy\\nand pick it up'\n    );\n    menu.addItem(\n        \"pick up\",\n        'pickUp',\n        'detach and put \\ninto the hand'\n    );\n    menu.addItem(\n        \"attach...\",\n        'attach',\n        'stick this morph\\nto another one'\n    );\n    menu.addItem(\n        \"move...\",\n        'move',\n        'show a handle\\nwhich can be dragged\\nto move this morph'\n    );\n    menu.addItem(\n        \"inspect...\",\n        'inspect',\n        'open a window\\non all properties'\n    );\n    menu.addItem(\n        \"pic...\",\n        () => window.open(this.fullImage().toDataURL()),\n        'open a new window\\nwith a picture of this morph'\n    );\n    menu.addLine();\n    if (this.isDraggable) {\n        menu.addItem(\n            \"lock\",\n            'toggleIsDraggable',\n            'make this morph\\nunmovable'\n        );\n    } else {\n        menu.addItem(\n            \"unlock\",\n            'toggleIsDraggable',\n            'make this morph\\nmovable'\n        );\n    }\n    menu.addItem(\"hide\", 'hide');\n    menu.addItem(\"delete\", 'destroy');\n    if (!(this instanceof WorldMorph)) {\n        menu.addLine();\n        menu.addItem(\n            \"World...\",\n            () => world.contextMenu().popUpAtHand(world),\n            'show the\\nWorld\\'s menu'\n        );\n    }\n    return menu;\n};\n\nMorph.prototype.userMenu = function () {\n    return null;\n};\n\nMorph.prototype.addToDemoMenu = function (aMorphOrMenuArray) {\n    // register a Morph or a Menu with Morphs with the World's demos menu\n    // a menu can be added in the form of a two-item array: [name, [morphs]]\n    WorldMorph.prototype.customMorphs.push(aMorphOrMenuArray);\n};\n\n// Morph menu actions\n\nMorph.prototype.setAlphaScaled = function (alpha) {\n    // for context menu demo purposes\n    var newAlpha, unscaled;\n    if (typeof alpha === 'number') {\n        unscaled = alpha / 100;\n        this.alpha = Math.min(Math.max(unscaled, 0), 1);\n    } else {\n        newAlpha = parseFloat(alpha);\n        if (!isNaN(newAlpha)) {\n            unscaled = newAlpha / 100;\n            this.alpha = Math.min(Math.max(unscaled, 0), 1);\n        }\n    }\n    this.changed();\n};\n\nMorph.prototype.attach = function () {\n    var choices = this.overlappedMorphs(),\n        menu = new MenuMorph(this, 'choose new parent:');\n\n    choices.forEach(each => {\n        menu.addItem(each.toString().slice(0, 50), () => {\n            each.add(this);\n            this.isDraggable = false;\n        });\n    });\n    if (choices.length > 0) {\n        menu.popUpAtHand(this.world());\n    }\n};\n\nMorph.prototype.toggleIsDraggable = function () {\n    // for context menu demo purposes\n    this.isDraggable = !this.isDraggable;\n};\n\nMorph.prototype.colorSetters = function () {\n    // for context menu demo purposes\n    return ['color'];\n};\n\nMorph.prototype.numericalSetters = function () {\n    // for context menu demo purposes\n    return [\n        'setLeft',\n        'setTop',\n        'setWidth',\n        'setHeight',\n        'setAlphaScaled'\n    ];\n};\n\n// Morph entry field tabbing:\n\nMorph.prototype.allEntryFields = function () {\n    return this.allChildren().filter(each => {\n        return each.isEditable &&\n            (each instanceof StringMorph ||\n                each instanceof TextMorph);\n    });\n};\n\nMorph.prototype.nextEntryField = function (current) {\n    var fields = this.allEntryFields(),\n        idx = fields.indexOf(current);\n    if (idx !== -1) {\n        if (fields.length > idx + 1) {\n            return fields[idx + 1];\n        }\n    }\n    return fields[0];\n};\n\nMorph.prototype.previousEntryField = function (current) {\n    var fields = this.allEntryFields(),\n        idx = fields.indexOf(current);\n    if (idx !== -1) {\n        if (idx > 0) {\n            return fields[idx - 1];\n        }\n        return fields[fields.length - 1];\n    }\n    return fields[0];\n};\n\nMorph.prototype.tab = function (editField) {\n/*\n    the <tab> key was pressed in one of my edit fields.\n    invoke my \"nextTab()\" function if it exists, else\n    propagate it up my owner chain.\n*/\n    if (this.nextTab) {\n        this.nextTab(editField);\n    } else if (this.parent) {\n        this.parent.tab(editField);\n    }\n};\n\nMorph.prototype.backTab = function (editField) {\n/*\n    the <back tab> key was pressed in one of my edit fields.\n    invoke my \"previousTab()\" function if it exists, else\n    propagate it up my owner chain.\n*/\n    if (this.previousTab) {\n        this.previousTab(editField);\n    } else if (this.parent) {\n        this.parent.backTab(editField);\n    }\n};\n\n/*\n    the following are examples of what the navigation methods should\n    look like. Insert these at the World level for fallback, and at lower\n    levels in the Morphic tree (e.g. dialog boxes) for a more fine-grained\n    control over the tabbing cycle.\n\nMorph.prototype.nextTab = function (editField) {\n    var next = this.nextEntryField(editField);\n    editField.clearSelection();\n    next.selectAll();\n    next.edit();\n};\n\nMorph.prototype.previousTab = function (editField) {\n    var prev = this.previousEntryField(editField);\n    editField.clearSelection();\n    prev.selectAll();\n    prev.edit();\n};\n\n*/\n\n// Morph events:\n\nMorph.prototype.escalateEvent = function (functionName, arg) {\n    var handler = this.parent;\n    while (!handler[functionName] && handler.parent !== null) {\n        handler = handler.parent;\n    }\n    if (handler[functionName]) {\n        handler[functionName](arg);\n    }\n};\n\n// Morph eval:\n\nMorph.prototype.evaluateString = function (code) {\n    var result;\n\n    try {\n        result = eval(code);\n        this.changed();\n    } catch (err) {\n        this.inform(err);\n    }\n    return result;\n};\n\n// Morph collision detection:\n\nMorph.prototype.isTouching = function (otherMorph) {\n    var data = this.overlappingPixels(otherMorph),\n        len, i;\n\n    if (!data) {return false; }\n    len = data[0].length;\n    for (i = 3; i < len; i += 4) {\n        if (data[0][i] && data[1][i]) {return true; }\n    }\n    return false;\n};\n\nMorph.prototype.overlappingPixels = function (otherMorph) {\n    var fb = this.fullBounds(),\n        otherFb = otherMorph.fullBounds(),\n        oRect = fb.intersect(otherFb),\n        thisImg, thatImg;\n\n    if (oRect.width() < 1 || oRect.height() < 1) {\n        return false;\n    }\n    thisImg = this.fullImage();\n    thatImg = otherMorph.fullImage();\n    if (thisImg.isRetinaEnabled !== thatImg.isRetinaEnabled) {\n        thisImg = normalizeCanvas(thisImg, true);\n        thatImg = normalizeCanvas(thatImg, true);\n    }\n    return [\n        thisImg.getContext(\"2d\").getImageData(\n            oRect.left() - this.left(),\n            oRect.top() - this.top(),\n            oRect.width(),\n            oRect.height()\n        ).data,\n        thatImg.getContext(\"2d\").getImageData(\n            oRect.left() - otherMorph.left(),\n            oRect.top() - otherMorph.top(),\n            oRect.width(),\n            oRect.height()\n        ).data\n    ];\n};\n\n// ShadowMorph /////////////////////////////////////////////////////////\n\n// ShadowMorph inherits from Morph:\n\nShadowMorph.prototype = new Morph();\nShadowMorph.prototype.constructor = ShadowMorph;\nShadowMorph.uber = Morph.prototype;\n\n// ShadowMorph instance creation:\n\nexport function ShadowMorph() {\n    this.init();\n}\n\nShadowMorph.prototype.init = function () {\n    ShadowMorph.uber.init.call(this);\n    this.isCachingImage = true;\n};\n\nShadowMorph.prototype.topMorphAt = function () {\n    return null;\n};\n\n// HandleMorph ////////////////////////////////////////////////////////\n\n// I am a resize / move handle that can be attached to any Morph\n\n// HandleMorph inherits from Morph:\n\nHandleMorph.prototype = new Morph();\nHandleMorph.prototype.constructor = HandleMorph;\nHandleMorph.uber = Morph.prototype;\n\n// HandleMorph instance creation:\n\nexport function HandleMorph(target, minX, minY, insetX, insetY, type) {\n    // if insetY is missing, it will be the same as insetX\n    this.init(target, minX, minY, insetX, insetY, type);\n}\n\nHandleMorph.prototype.init = function (\n    target,\n    minX,\n    minY,\n    insetX,\n    insetY,\n    type\n) {\n    var size = MorphicPreferences.handleSize;\n    this.target = target || null;\n    this.minExtent = new Point(minX || 0, minY || 0);\n    this.inset = new Point(insetX || 0, insetY || insetX || 0);\n    this.type =  type || 'resize'; // also: 'move', 'moveCenter', 'movePivot'\n    this.isHighlighted = false;\n    HandleMorph.uber.init.call(this);\n    this.color = WHITE;\n    this.isDraggable = false;\n    if (this.type === 'movePivot') {\n        size *= 2;\n    }\n    this.setExtent(new Point(size, size));\n    this.fixLayout();\n};\n\n// HandleMorph drawing:\n\nHandleMorph.prototype.fixLayout = function () {\n    if (this.target) {\n        if (this.type === 'moveCenter') {\n            this.setCenter(this.target.center());\n        } else if (this.type === 'movePivot') {\n            this.setCenter(this.target.rotationCenter());\n        } else { // 'resize', 'move'\n            this.setPosition(\n                this.target.bottomRight().subtract(\n                    this.extent().add(this.inset)\n                )\n            );\n        }\n        this.target.add(this);\n        this.target.changed();\n    }\n};\n\nHandleMorph.prototype.render = function (ctx) {\n    if (this.type === 'movePivot') {\n        if (this.isHighlighted) {\n            this.renderCrosshairsOn(ctx, 0.5);\n        } else {\n            this.renderCrosshairsOn(ctx, 0.6);\n        }\n    } else {\n        if (this.isHighlighted) {\n            this.renderHandleOn(\n                ctx,\n                new Color(100, 100, 255),\n                WHITE\n            );\n        } else {\n            this.renderHandleOn(\n                ctx,\n                this.color,\n                new Color(100, 100, 100)\n            );\n        }\n    }\n};\n\nHandleMorph.prototype.renderCrosshairsOn = function (ctx, fract) {\n    var r = this.width() / 2;\n\n    // semi-transparent white background blob\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';\n    ctx.beginPath();\n    ctx.arc(\n        r,\n        r,\n        r * 0.9,\n        radians(0),\n        radians(360),\n        false\n    );\n    ctx.fill();\n\n    // solid black ring\n    ctx.strokeStyle = 'black';\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    ctx.arc(\n        r,\n        r,\n        r * fract,\n        radians(0),\n        radians(360),\n        false\n    );\n    ctx.stroke();\n\n    // vertically centered horizontal line\n    ctx.moveTo(0, r);\n    ctx.lineTo(this.width(), r);\n    ctx.stroke();\n\n    // horizontally centered vertical line\n    ctx.moveTo(r, 0);\n    ctx.lineTo(r, this.height());\n    ctx.stroke();\n};\n\nHandleMorph.prototype.renderHandleOn = function (\n    ctx,\n    color,\n    shadowColor\n) {\n    var isSquare = (this.type.indexOf('move') === 0),\n        p1 = new Point(0, this.height()), // bottom left\n        p2 = new Point(this.width(), 0), // top right\n        p11, p22, i;\n\n    ctx.lineWidth = 1;\n    ctx.lineCap = 'round';\n    ctx.strokeStyle = color.toString();\n\n    if (isSquare) {\n        p11 = p1.copy();\n        p22 = p2.copy();\n        for (i = 0; i <= this.height(); i = i + 6) {\n            p11.y = p1.y - i;\n            p22.y = p2.y - i;\n\n            ctx.beginPath();\n            ctx.moveTo(p11.x, p11.y);\n            ctx.lineTo(p22.x, p22.y);\n            ctx.closePath();\n            ctx.stroke();\n        }\n    }\n\n    p11 = p1.copy();\n    p22 = p2.copy();\n    for (i = 0; i <= this.width(); i = i + 6) {\n        p11.x = p1.x + i;\n        p22.x = p2.x + i;\n\n        ctx.beginPath();\n        ctx.moveTo(p11.x, p11.y);\n        ctx.lineTo(p22.x, p22.y);\n        ctx.closePath();\n        ctx.stroke();\n    }\n    ctx.strokeStyle = shadowColor.toString();\n\n    if (isSquare) {\n        p11 = p1.copy();\n        p22 = p2.copy();\n        for (i = -2; i <= this.height(); i = i + 6) {\n            p11.y = p1.y - i;\n            p22.y = p2.y - i;\n\n            ctx.beginPath();\n            ctx.moveTo(p11.x, p11.y);\n            ctx.lineTo(p22.x, p22.y);\n            ctx.closePath();\n            ctx.stroke();\n        }\n    }\n\n    p11 = p1.copy();\n    p22 = p2.copy();\n    for (i = 2; i <= this.width(); i = i + 6) {\n        p11.x = p1.x + i;\n        p22.x = p2.x + i;\n\n        ctx.beginPath();\n        ctx.moveTo(p11.x, p11.y);\n        ctx.lineTo(p22.x, p22.y);\n        ctx.closePath();\n        ctx.stroke();\n    }\n};\n\n// HandleMorph stepping:\n\nHandleMorph.prototype.step = null;\n\nHandleMorph.prototype.mouseDownLeft = function (pos) {\n    var world = this.root(),\n        offset;\n\n    if (!this.target) {\n        return null;\n    }\n    if (this.type.indexOf('move') === 0) {\n        offset = pos.subtract(this.center());\n    } else {\n        offset = pos.subtract(this.bounds.origin);\n    }\n\n    this.step = () => {\n        var newPos, newExt;\n        if (world.hand.mouseButton) {\n            newPos = world.hand.bounds.origin.copy().subtract(offset);\n            if (this.type === 'resize') {\n                newExt = newPos.add(\n                    this.extent().add(this.inset)\n                ).subtract(this.target.bounds.origin);\n                newExt = newExt.max(this.minExtent);\n                this.target.setExtent(newExt);\n\n                this.setPosition(\n                    this.target.bottomRight().subtract(\n                        this.extent().add(this.inset)\n                    )\n                );\n            } else if (this.type === 'moveCenter') {\n                this.target.setCenter(newPos);\n            } else if (this.type === 'movePivot') {\n                this.target.setPivot(newPos);\n                this.setCenter(this.target.rotationCenter());\n            } else { // type === 'move'\n                this.target.setPosition(\n                    newPos.subtract(this.target.extent())\n                        .add(this.extent())\n                );\n            }\n        } else {\n            this.step = null;\n        }\n    };\n\n    if (!this.target.step) {\n        this.target.step = nop;\n    }\n};\n\n// HandleMorph dragging and dropping:\n\nHandleMorph.prototype.rootForGrab = function () {\n    return this;\n};\n\n// HandleMorph events:\n\nHandleMorph.prototype.mouseEnter = function () {\n    this.isHighlighted = true;\n    this.changed();\n};\n\nHandleMorph.prototype.mouseLeave = function () {\n    this.isHighlighted = false;\n    this.changed();\n};\n\n// HandleMorph menu:\n\nHandleMorph.prototype.attach = function () {\n    var choices = this.overlappedMorphs(),\n        menu = new MenuMorph(this, 'choose target:');\n\n    choices.forEach(each => {\n        menu.addItem(each.toString().slice(0, 50), () => {\n            this.isDraggable = false;\n            this.target = each;\n            this.fixLayout();\n        });\n    });\n    if (choices.length > 0) {\n        menu.popUpAtHand(this.world());\n    }\n};\n\n// PenMorph ////////////////////////////////////////////////////////////\n\n// I am a simple LOGO-wise turtle.\n\n// PenMorph: referenced constructors\n\n//\n\n// PenMorph inherits from Morph:\n\nPenMorph.prototype = new Morph();\nPenMorph.prototype.constructor = PenMorph;\nPenMorph.uber = Morph.prototype;\n\n// PenMorph instance creation:\n\nexport function PenMorph() {\n    this.init();\n}\n\nPenMorph.prototype.init = function () {\n    var size = MorphicPreferences.handleSize * 4;\n\n    // additional properties:\n    this.isWarped = false; // internal optimization\n    this.heading = 0;\n    this.isDown = true;\n    this.size = 1;\n    this.penPoint = 'tip'; // or 'center\"\n    this.penBounds = null; // rect around the visible arrow shape\n\n    HandleMorph.uber.init.call(this);\n    this.setExtent(new Point(size, size));\n};\n\n// PenMorph updating - optimized for warping, i.e atomic recursion\n\nPenMorph.prototype.changed = function () {\n    if (this.isWarped) {return; }\n    PenMorph.uber.changed.call(this);\n\n};\n\n// PenMorph display:\n\nPenMorph.prototype.render = function (ctx, facing) {\n    // my orientation can be overridden with the \"facing\" parameter to\n    // implement Scratch-style rotation styles\n\n    var start, dest, left, right, len,\n        direction = facing || this.heading;\n\n    len = this.width() / 2;\n    start = this.center().subtract(this.bounds.origin);\n\n    if (this.penPoint === 'tip') {\n        dest = start.distanceAngle(len * 0.75, direction - 180);\n        left = start.distanceAngle(len, direction + 195);\n        right = start.distanceAngle(len, direction - 195);\n    } else { // 'middle'\n        dest = start.distanceAngle(len * 0.75, direction);\n        left = start.distanceAngle(len * 0.33, direction + 230);\n        right = start.distanceAngle(len * 0.33, direction - 230);\n    }\n\n    // cache penBounds\n    this.penBounds = new Rectangle(\n        Math.min(start.x, dest.x, left.x, right.x),\n        Math.min(start.y, dest.y, left.y, right.y),\n        Math.max(start.x, dest.x, left.x, right.x),\n        Math.max(start.y, dest.y, left.y, right.y)\n    );\n\n    // draw arrow shape\n    ctx.fillStyle = this.color.toString();\n    ctx.beginPath();\n\n    ctx.moveTo(start.x, start.y);\n    ctx.lineTo(left.x, left.y);\n    ctx.lineTo(dest.x, dest.y);\n    ctx.lineTo(right.x, right.y);\n\n    ctx.closePath();\n    ctx.strokeStyle = 'white';\n    ctx.lineWidth = 3;\n    ctx.stroke();\n    ctx.strokeStyle = 'black';\n    ctx.lineWidth = 1;\n    ctx.stroke();\n    ctx.fill();\n};\n\n// PenMorph access:\n\nPenMorph.prototype.setHeading = function (degrees) {\n    this.heading = ((+degrees % 360) + 360) % 360;\n    this.fixLayout();\n    this.rerender();\n};\n\nPenMorph.prototype.numericalSetters = function () {\n    // for context menu demo purposes\n    return [\n        'setLeft',\n        'setTop',\n        'setWidth',\n        'setHeight',\n        'setAlphaScaled',\n        'setHeading'\n    ];\n};\n\n// PenMorph menu:\n\nPenMorph.prototype.developersMenu = function () {\n    var menu = PenMorph.uber.developersMenu.call(this);\n    menu.addLine();\n    menu.addItem(\n        'set rotation',\n        \"setRotation\",\n        'interactively turn this morph\\nusing a dial widget'\n    );\n    return menu;\n};\n\nPenMorph.prototype.setRotation = function () {\n    var menu, dial,\n    \tname = this.name || this.constructor.name;\n    if (name.length > 10) {\n    \tname = name.slice(0, 9) + '...';\n    }\n    menu = new MenuMorph(this, name);\n    dial = new DialMorph(null, null, this.heading);\n    dial.rootForGrab = () => dial;\n    dial.target = this;\n    dial.action = 'setHeading';\n    menu.items.push(dial);\n    menu.addLine();\n    menu.addItem('(90) right', () => this.setHeading(90));\n    menu.addItem('(-90) left', () => this.setHeading(-90));\n    menu.addItem('(0) up', () => this.setHeading(0));\n    menu.addItem('(180) down', () => this.setHeading(180));\n    menu.isDraggable = true;\n    menu.popUpAtHand(this.world());\n};\n\n// PenMorph drawing:\n\nPenMorph.prototype.drawLine = function (start, dest) {\n    var context = this.parent.penTrails().getContext('2d'),\n        from = start.subtract(this.parent.bounds.origin),\n        to = dest.subtract(this.parent.bounds.origin);\n    if (this.isDown) {\n        context.lineWidth = this.size;\n        context.strokeStyle = this.color.toString();\n        context.lineCap = 'round';\n        context.lineJoin = 'round';\n        context.beginPath();\n        context.moveTo(from.x, from.y);\n        context.lineTo(to.x, to.y);\n        context.stroke();\n        if (this.isWarped === false) {\n            this.world().broken.push(\n                start.rectangle(dest).expandBy(\n                    Math.max(this.size / 2, 1)\n                ).intersect(this.parent.visibleBounds()).spread()\n            );\n        }\n    }\n};\n\n// PenMorph turtle ops:\n\nPenMorph.prototype.turn = function (degrees) {\n    this.setHeading(this.heading + parseFloat(degrees));\n};\n\nPenMorph.prototype.forward = function (steps) {\n    var start = this.center(),\n        dest,\n        dist = parseFloat(steps);\n    if (dist >= 0) {\n        dest = this.position().distanceAngle(dist, this.heading);\n    } else {\n        dest = this.position().distanceAngle(\n            Math.abs(dist),\n            (this.heading - 180)\n        );\n    }\n    this.setPosition(dest);\n    this.drawLine(start, this.center());\n};\n\nPenMorph.prototype.down = function () {\n    this.isDown = true;\n};\n\nPenMorph.prototype.up = function () {\n    this.isDown = false;\n};\n\nPenMorph.prototype.clear = function () {\n    this.parent.rerender();\n};\n\n// PenMorph optimization for atomic recursion:\n\nPenMorph.prototype.startWarp = function () {\n    this.isWarped = true;\n};\n\nPenMorph.prototype.endWarp = function () {\n    this.isWarped = false;\n    this.parent.changed();\n};\n\nPenMorph.prototype.warp = function (fun) {\n    this.startWarp();\n    fun.call(this);\n    this.endWarp();\n};\n\nPenMorph.prototype.warpOp = function (selector, argsArray) {\n    this.startWarp();\n    this[selector].apply(this, argsArray);\n    this.endWarp();\n};\n\n// PenMorph demo ops:\n// try these with WARP eg.: this.warp(function () {tree(12, 120, 20)})\n\nPenMorph.prototype.warpSierpinski = function (length, min) {\n    this.warpOp('sierpinski', [length, min]);\n};\n\nPenMorph.prototype.sierpinski = function (length, min) {\n    var i;\n    if (length > min) {\n        for (i = 0; i < 3; i += 1) {\n            this.sierpinski(length * 0.5, min);\n            this.turn(120);\n            this.forward(length);\n        }\n    }\n};\n\nPenMorph.prototype.warpTree = function (level, length, angle) {\n    this.warpOp('tree', [level, length, angle]);\n};\n\nPenMorph.prototype.tree = function (level, length, angle) {\n    if (level > 0) {\n        this.size = level;\n        this.forward(length);\n        this.turn(angle);\n        this.tree(level - 1, length * 0.75, angle);\n        this.turn(angle * -2);\n        this.tree(level - 1, length * 0.75, angle);\n        this.turn(angle);\n        this.forward(-length);\n    }\n};\n\n// ColorPaletteMorph ///////////////////////////////////////////////////\n\n//\n\n// ColorPaletteMorph inherits from Morph:\n\nColorPaletteMorph.prototype = new Morph();\nColorPaletteMorph.prototype.constructor = ColorPaletteMorph;\nColorPaletteMorph.uber = Morph.prototype;\n\n// ColorPaletteMorph instance creation:\n\nexport function ColorPaletteMorph(target, sizePoint) {\n    this.init(\n        target || null,\n        sizePoint || new Point(80, 50)\n    );\n}\n\nColorPaletteMorph.prototype.init = function (target, size) {\n    ColorPaletteMorph.uber.init.call(this);\n    this.isCachingImage = true;\n    this.target = target;\n    this.targetSetter = 'color';\n    this.setExtent(size);\n    this.choice = null;\n};\n\nColorPaletteMorph.prototype.render = function (ctx) {\n    var ext = this.extent(),\n        x, y, h, l;\n\n    this.choice = BLACK;\n    for (x = 0; x <= ext.x; x += 1) {\n        h = 360 * x / ext.x;\n        for (y = 0; y <= ext.y; y += 1) {\n            l = 100 - (y / ext.y * 100);\n            ctx.fillStyle = 'hsl(' + h + ',100%,' + l + '%)';\n            ctx.fillRect(x, y, 1, 1);\n        }\n    }\n};\n\nColorPaletteMorph.prototype.mouseMove = function (pos) {\n    this.choice = this.getPixelColor(pos);\n    this.updateTarget();\n};\n\nColorPaletteMorph.prototype.mouseDownLeft = function (pos) {\n    this.choice = this.getPixelColor(pos);\n    this.updateTarget();\n};\n\nColorPaletteMorph.prototype.updateTarget = function () {\n    if (this.target instanceof Morph && this.choice !== null) {\n        if (this.target[this.targetSetter] instanceof Function) {\n            this.target[this.targetSetter](this.choice);\n        } else {\n            this.target[this.targetSetter] = this.choice;\n            this.target.rerender();\n        }\n    }\n};\n\n// ColorPaletteMorph menu:\n\nColorPaletteMorph.prototype.developersMenu = function () {\n    var menu = ColorPaletteMorph.uber.developersMenu.call(this);\n    menu.addLine();\n    menu.addItem(\n        'set target',\n        \"setTarget\",\n        'choose another morph\\nwhose color property\\n will be' +\n            ' controlled by this one'\n    );\n    return menu;\n};\n\nColorPaletteMorph.prototype.setTarget = function () {\n    var choices = this.overlappedMorphs(),\n        menu = new MenuMorph(this, 'choose target:');\n\n    choices.push(this.world());\n    choices.forEach(each => {\n        menu.addItem(each.toString().slice(0, 50), () => {\n            this.target = each;\n            this.setTargetSetter();\n        });\n    });\n    if (choices.length === 1) {\n        this.target = choices[0];\n        this.setTargetSetter();\n    } else if (choices.length > 0) {\n        menu.popUpAtHand(this.world());\n    }\n};\n\nColorPaletteMorph.prototype.setTargetSetter = function () {\n    var choices = this.target.colorSetters(),\n        menu = new MenuMorph(this, 'choose target property:');\n\n    choices.forEach(each => {\n        menu.addItem(each, () => this.targetSetter = each);\n    });\n    if (choices.length === 1) {\n        this.targetSetter = choices[0];\n    } else if (choices.length > 0) {\n        menu.popUpAtHand(this.world());\n    }\n};\n\n// GrayPaletteMorph ///////////////////////////////////////////////////\n\n//\n\n// GrayPaletteMorph inherits from ColorPaletteMorph:\n\nGrayPaletteMorph.prototype = new ColorPaletteMorph();\nGrayPaletteMorph.prototype.constructor = GrayPaletteMorph;\nGrayPaletteMorph.uber = ColorPaletteMorph.prototype;\n\n// GrayPaletteMorph instance creation:\n\nexport function GrayPaletteMorph(target, sizePoint) {\n    this.init(\n        target || null,\n        sizePoint || new Point(80, 10)\n    );\n}\n\nGrayPaletteMorph.prototype.render = function (ctx) {\n    var ext = this.extent(),\n        gradient;\n\n    this.choice = BLACK;\n    gradient = ctx.createLinearGradient(0, 0, ext.x, ext.y);\n    gradient.addColorStop(0, 'black');\n    gradient.addColorStop(1, 'white');\n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, ext.x, ext.y);\n};\n\n// ColorPickerMorph ///////////////////////////////////////////////////\n\n// ColorPickerMorph inherits from Morph:\n\nColorPickerMorph.prototype = new Morph();\nColorPickerMorph.prototype.constructor = ColorPickerMorph;\nColorPickerMorph.uber = Morph.prototype;\n\n// ColorPickerMorph instance creation:\n\nexport function ColorPickerMorph(defaultColor) {\n    this.init(defaultColor || WHITE);\n}\n\nColorPickerMorph.prototype.init = function (defaultColor) {\n    this.choice = defaultColor;\n    ColorPickerMorph.uber.init.call(this);\n    this.color = WHITE;\n    this.setExtent(new Point(80, 80));\n};\n\nColorPickerMorph.prototype.fixLayout = function () {\n    var cpal, gpal, x, y;\n\n    this.children.forEach(child => child.destroy());\n    this.children = [];\n    this.feedback = new Morph();\n    this.feedback.color = this.choice;\n    this.feedback.setExtent(new Point(20, 20));\n    cpal = new ColorPaletteMorph(\n        this.feedback,\n        new Point(this.width(), 50)\n    );\n    gpal = new GrayPaletteMorph(\n        this.feedback,\n        new Point(this.width(), 5)\n    );\n    cpal.setPosition(this.bounds.origin);\n    this.add(cpal);\n    gpal.setPosition(cpal.bottomLeft());\n    this.add(gpal);\n    x = (gpal.left() +\n        Math.floor((gpal.width() - this.feedback.width()) / 2));\n    y = gpal.bottom() + Math.floor((this.bottom() -\n        gpal.bottom() - this.feedback.height()) / 2);\n    this.feedback.setPosition(new Point(x, y));\n    this.add(this.feedback);\n};\n\nColorPickerMorph.prototype.getChoice = function () {\n    return this.feedback.color;\n};\n\nColorPickerMorph.prototype.rootForGrab = function () {\n    return this;\n};\n\n// BlinkerMorph ////////////////////////////////////////////////////////\n\n// can be used for text cursors\n\n\n\n// BlinkerMorph inherits from Morph:\n\nBlinkerMorph.prototype = new Morph();\nBlinkerMorph.prototype.constructor = BlinkerMorph;\nBlinkerMorph.uber = Morph.prototype;\n\n// BlinkerMorph instance creation:\n\nexport function BlinkerMorph(rate) {\n    this.init(rate);\n}\n\nBlinkerMorph.prototype.init = function (rate) {\n    BlinkerMorph.uber.init.call(this);\n    this.color = new Color(0, 0, 0);\n    this.fps = rate || 2;\n};\n\n// BlinkerMorph stepping:\n\nBlinkerMorph.prototype.step = function () {\n    this.toggleVisibility();\n};\n\n// CursorMorph /////////////////////////////////////////////////////////\n\n// I am a String/Text editing widget\n\n// CursorMorph: referenced constructors\n\n\n\n// CursorMorph inherits from BlinkerMorph:\n\nCursorMorph.prototype = new BlinkerMorph();\nCursorMorph.prototype.constructor = CursorMorph;\nCursorMorph.uber = BlinkerMorph.prototype;\n\n// CursorMorph preferences settings:\n\nCursorMorph.prototype.viewPadding = 1;\n\n// CursorMorph instance creation:\n\nexport function CursorMorph(aStringOrTextMorph, aTextarea) {\n    this.init(aStringOrTextMorph, aTextarea);\n}\n\nCursorMorph.prototype.init = function (aStringOrTextMorph, aTextarea) {\n    var ls;\n\n    // additional properties:\n    this.keyDownEventUsed = false;\n    this.target = aStringOrTextMorph;\n    this.originalContents = this.target.text;\n    this.originalAlignment = this.target.alignment;\n    this.slot = this.target.text.length;\n    this.textarea = aTextarea;\n\n    CursorMorph.uber.init.call(this);\n\n    // override inherited defaults\n    ls = fontHeight(this.target.fontSize);\n    this.setExtent(new Point(Math.max(Math.floor(ls / 20), 1), ls));\n\n    if (this.target instanceof TextMorph &&\n            (this.target.alignment !== 'left')) {\n        this.target.setAlignmentToLeft();\n    }\n    this.textarea.value = this.target.text;\n    this.textarea.style.fontSize = this.target.fontSize + 'px';\n    this.gotoSlot(this.slot);\n    this.updateTextAreaPosition();\n    this.syncTextareaSelectionWith(this.target);\n};\n\n// CursorMorph event handling\n\n /*\n     There are three cases when the textarea gets inputs:\n\n     1. Inputs that represent special shortcuts of Snap!, so we\n     don't want the textarea to handle it. These events are captured in\n     \"keydown\" event handler.\n\n     2. inputs that change the content of the textarea, we need to update\n     the content of its target morph accordingly. This is handled in\n     the \"input\" event handler.\n\n     3. input that change the textarea without triggering an \"input\" event,\n     e.g. selection change, cursor movements. These are handled in the\n     \"keyup\" event handler.\n\n     Note that some changes in case 2 are not caused by keyboards (for\n     example, select a word by clicking in IME window), so there are overlaps\n     between case 2 and case 3. but no one can replace the other.\n */\n\nCursorMorph.prototype.processKeyDown = function (event) {\n    /* Special shortcuts\n        - ctrl-d, ctrl-i and ctrl-p: doit, inspect it and print it\n        - tab: goto next text field\n        - esc: discard the editing\n        - enter / shift+enter: accept the editing\n    */\n    var keyName = event.key,\n        shift = event.shiftKey,\n        singleLineText = this.target instanceof StringMorph,\n        dest;\n\n    if (!isNil(this.target.receiver) && (event.ctrlKey || event.metaKey)) {\n        if (keyName === 'd') {\n            event.preventDefault();\n            this.target.doIt();\n            return;\n        } else if (keyName === 'i') {\n            event.preventDefault();\n            this.target.inspectIt();\n            return;\n        } else if (keyName === 'p') {\n            event.preventDefault();\n            this.target.showIt();\n            return;\n        }\n    }\n\n    if (keyName === 'Tab' || keyName === 'U+0009') {\n        if (shift) {\n            this.target.backTab(this.target);\n        } else {\n            this.target.tab(this.target);\n        }\n        event.preventDefault();\n        this.target.escalateEvent('reactToEdit', this.target);\n    } else if (keyName === 'Escape') {\n        this.cancel();\n    } else if (keyName === \"Enter\" && (singleLineText || shift)) {\n        this.accept();\n    } else {\n        // catch \"up arrow\" and \"down arrow\" keys\n        if (keyName === 'ArrowDown') {\n            dest = this.target.downFrom(this.slot);\n            this.textarea.setSelectionRange(dest, dest);\n            // to do: allow holding shift to select\n            event.preventDefault();\n        }\n        if (keyName === 'ArrowUp') {\n            dest = this.target.upFrom(this.slot);\n            this.textarea.setSelectionRange(dest, dest);\n            // to do: allow holding shift to select\n            event.preventDefault();\n        }\n        this.target.escalateEvent('reactToKeystroke', event);\n    }\n};\n\nCursorMorph.prototype.processKeyUp = function (event) {\n    // handle selection change and cursor position change.\n    var textarea = this.textarea,\n        target = this.target;\n\n    if (textarea.selectionStart === textarea.selectionEnd) {\n        target.startMark = null;\n        target.endMark = null;\n    } else {\n        if (textarea.selectionDirection === 'backward') {\n            target.startMark = textarea.selectionEnd;\n            target.endMark = textarea.selectionStart;\n        } else {\n            target.startMark = textarea.selectionStart;\n            target.endMark = textarea.selectionEnd;\n        }\n    }\n    target.fixLayout();\n    target.rerender();\n    this.gotoSlot(textarea.selectionEnd);\n};\n\nCursorMorph.prototype.processInput = function (event) {\n    // handle content change.\n    var target = this.target,\n        textarea = this.textarea,\n        filteredContent,\n        caret;\n\n    // filter invalid chars for numeric fields\n    function filterText (content) {\n        var points = 0,\n            result = '',\n            i, ch, valid;\n        for (i = 0; i < content.length; i += 1) {\n            ch = content.charAt(i);\n            valid = (\n                ('0' <= ch && ch <= '9') || // digits\n                (i === 0 && ch === '-')  || // leading '-'\n                (ch === '.' && points === 0) // at most '.'\n            );\n            if (valid) {\n                result += ch;\n                if (ch === '.') {\n                    points += 1;\n                }\n            }\n        }\n        return result;\n    }\n\n    if (target.isNumeric) {\n        filteredContent = filterText(textarea.value);\n    } else {\n        filteredContent = textarea.value;\n    }\n\n    if (filteredContent.length < textarea.value.length) {\n        textarea.value = filteredContent;\n        caret = Math.min(textarea.selectionStart, filteredContent.length);\n        textarea.selectionEnd = caret;\n        textarea.selectionStart = caret;\n    }\n    // target morph: copy the content and selection status to the target.\n    target.text = filteredContent;\n\n    if (textarea.selectionStart === textarea.selectionEnd) {\n        target.startMark = null;\n        target.endMark = null;\n    } else {\n        if (textarea.selectionDirection === 'backward') {\n            target.startMark = textarea.selectionEnd;\n            target.endMark = textarea.selectionStart;\n        } else {\n            target.startMark = textarea.selectionStart;\n            target.endMark = textarea.selectionEnd;\n        }\n    }\n    target.changed();\n    target.fixLayout();\n    target.rerender();\n\n    // cursor morph: copy the caret position to cursor morph.\n    this.gotoSlot(textarea.selectionStart);\n\n    this.updateTextAreaPosition();\n\n    // the \"reactToInput\" event gets triggered AFTER \"reactToKeystroke\"\n    this.target.escalateEvent('reactToInput', event);\n};\n\n// CursorMorph synching:\n\nCursorMorph.prototype.updateTextAreaPosition = function () {\n    var pos = getDocumentPositionOf(this.target.world().worldCanvas),\n        origin = this.target.bounds.origin.add(new Point(pos.x, pos.y));\n\n    function number2px (n) {\n        return Math.ceil(n) + 'px';\n    }\n\n    this.textarea.style.top = number2px(origin.y);\n    this.textarea.style.left = number2px(origin.x);\n};\n\nCursorMorph.prototype.syncTextareaSelectionWith = function (targetMorph) {\n    var start = targetMorph.startMark,\n        end = targetMorph.endMark;\n\n    if (start === end) {\n        this.textarea.setSelectionRange(this.slot, this.slot, 'none');\n    } else if (start < end) {\n        this.textarea.setSelectionRange(start, end, 'forward');\n    } else {\n        this.textarea.setSelectionRange(end, start, 'backward');\n    }\n    this.textarea.focus();\n};\n\n// CursorMorph navigation:\n\nCursorMorph.prototype.gotoSlot = function (slot) {\n    var length = this.target.text.length,\n        pos = this.target.slotPosition(slot),\n        right,\n        left;\n    this.slot = slot < 0 ? 0 : slot > length ? length : slot;\n    if (this.parent && this.target.isScrollable) {\n        right = this.parent.right() - this.viewPadding;\n        left = this.parent.left() + this.viewPadding;\n        if (pos.x > right) {\n            this.target.setLeft(this.target.left() + right - pos.x);\n            pos.x = right;\n        }\n        if (pos.x < left) {\n            left = Math.min(this.parent.left(), left);\n            this.target.setLeft(this.target.left() + left - pos.x);\n            pos.x = left;\n        }\n        if (this.target.right() < right &&\n                right - this.target.width() < left) {\n            pos.x += right - this.target.right();\n            this.target.setRight(right);\n        }\n    }\n    this.show();\n    this.setPosition(pos);\n    if (this.parent\n            && this.parent.parent instanceof ScrollFrameMorph\n            && this.target.isScrollable) {\n        this.parent.parent.scrollCursorIntoView(this);\n    }\n};\n\nCursorMorph.prototype.gotoPos = function (aPoint) {\n    this.gotoSlot(this.target.slotAt(aPoint));\n    this.show();\n};\n\n// CursorMorph selecting:\n\nCursorMorph.prototype.updateSelection = function (shift) {\n    if (shift) {\n        if (isNil(this.target.endMark) && isNil(this.target.startMark)) {\n            this.target.startMark = this.slot;\n            this.target.endMark = this.slot;\n        } else if (this.target.endMark !== this.slot) {\n            this.target.endMark = this.slot;\n            this.target.changed();\n        }\n    } else {\n        this.target.clearSelection();\n    }\n};\n\n// CursorMorph editing:\n\nCursorMorph.prototype.accept = function () {\n    var world = this.root();\n    if (world) {\n        world.stopEditing();\n    }\n    this.escalateEvent('accept', this);\n};\n\nCursorMorph.prototype.cancel = function () {\n    var world = this.root();\n    this.undo();\n    if (world) {\n        world.stopEditing();\n    }\n    this.escalateEvent('cancel', this);\n};\n\nCursorMorph.prototype.undo = function () {\n    this.target.text = this.originalContents;\n    this.target.changed();\n    this.target.fixLayout();\n    this.target.changed();\n    this.gotoSlot(0);\n};\n\n// CursorMorph destroying:\n\nCursorMorph.prototype.destroy = function () {\n    if (this.target.alignment !== this.originalAlignment) {\n        this.target.alignment = this.originalAlignment;\n        this.target.changed();\n    }\n    CursorMorph.uber.destroy.call(this);\n    this.target.world().resetKeyboardHandler();\n};\n\n// BoxMorph ////////////////////////////////////////////////////////////\n\n// I can have an optionally rounded border\n\n\n\n// BoxMorph inherits from Morph:\n\nBoxMorph.prototype = new Morph();\nBoxMorph.prototype.constructor = BoxMorph;\nBoxMorph.uber = Morph.prototype;\n\n// BoxMorph instance creation:\n\nexport function BoxMorph(edge, border, borderColor) {\n    this.init(edge, border, borderColor);\n}\n\nBoxMorph.prototype.init = function (edge, border, borderColor) {\n    this.edge = edge || 4;\n    this.border = border || ((border === 0) ? 0 : 2);\n    this.borderColor = borderColor || BLACK;\n    BoxMorph.uber.init.call(this);\n};\n\n// BoxMorph drawing:\n\nBoxMorph.prototype.render = function (ctx) {\n    if ((this.edge === 0) && (this.border === 0)) {\n        BoxMorph.uber.render.call(this, ctx);\n        return;\n    }\n    ctx.fillStyle = this.color.toString();\n    ctx.beginPath();\n    this.outlinePath(\n        ctx,\n        Math.max(this.edge - this.border, 0),\n        this.border\n    );\n    ctx.closePath();\n    ctx.fill();\n    if (this.border > 0) {\n        ctx.lineWidth = this.border;\n        ctx.strokeStyle = this.borderColor.toString();\n        ctx.beginPath();\n        this.outlinePath(ctx, this.edge, this.border / 2);\n        ctx.closePath();\n        ctx.stroke();\n    }\n};\n\nBoxMorph.prototype.outlinePath = function (ctx, corner, inset) {\n    var w = this.width(),\n        h = this.height(),\n        radius = Math.min(corner, (Math.min(w, h) - inset) / 2),\n        offset = radius + inset;\n\n    // top left:\n    ctx.arc(\n        offset,\n        offset,\n        radius,\n        radians(-180),\n        radians(-90),\n        false\n    );\n    // top right:\n    ctx.arc(\n        w - offset,\n        offset,\n        radius,\n        radians(-90),\n        radians(-0),\n        false\n    );\n    // bottom right:\n    ctx.arc(\n        w - offset,\n        h - offset,\n        radius,\n        radians(0),\n        radians(90),\n        false\n    );\n    // bottom left:\n    ctx.arc(\n        offset,\n        h - offset,\n        radius,\n        radians(90),\n        radians(180),\n        false\n    );\n};\n\n// BoxMorph menus:\n\nBoxMorph.prototype.developersMenu = function () {\n    var menu = BoxMorph.uber.developersMenu.call(this);\n    menu.addLine();\n    menu.addItem(\n        \"border width...\",\n        () => {\n            this.prompt(\n                menu.title + '\\nborder\\nwidth:',\n                this.setBorderWidth,\n                this,\n                this.border.toString(),\n                null,\n                0,\n                100,\n                true\n            );\n        },\n        'set the border\\'s\\nline size'\n    );\n    menu.addItem(\n        \"border color...\",\n        () => {\n            this.pickColor(\n                menu.title + '\\nborder color:',\n                this.setBorderColor,\n                this,\n                this.borderColor\n            );\n        },\n        'set the border\\'s\\nline color'\n    );\n    menu.addItem(\n        \"corner size...\",\n        () => {\n            this.prompt(\n                menu.title + '\\ncorner\\nsize:',\n                this.setCornerSize,\n                this,\n                this.edge.toString(),\n                null,\n                0,\n                100,\n                true\n            );\n        },\n        'set the corner\\'s\\nradius'\n    );\n    return menu;\n};\n\nBoxMorph.prototype.setBorderWidth = function (size) {\n    // for context menu demo purposes\n    var newSize;\n    if (typeof size === 'number') {\n        this.border = Math.max(size, 0);\n    } else {\n        newSize = parseFloat(size);\n        if (!isNaN(newSize)) {\n            this.border = Math.max(newSize, 0);\n        }\n    }\n    this.changed();\n};\n\nBoxMorph.prototype.setBorderColor = function (color) {\n    // for context menu demo purposes\n    if (color) {\n        this.borderColor = color;\n        this.changed();\n    }\n};\n\nBoxMorph.prototype.setCornerSize = function (size) {\n    // for context menu demo purposes\n    var newSize;\n    if (typeof size === 'number') {\n        this.edge = Math.max(size, 0);\n    } else {\n        newSize = parseFloat(size);\n        if (!isNaN(newSize)) {\n            this.edge = Math.max(newSize, 0);\n        }\n    }\n    this.changed();\n};\n\nBoxMorph.prototype.colorSetters = function () {\n    // for context menu demo purposes\n    return ['color', 'borderColor'];\n};\n\nBoxMorph.prototype.numericalSetters = function () {\n    // for context menu demo purposes\n    var list = BoxMorph.uber.numericalSetters.call(this);\n    list.push('setBorderWidth', 'setCornerSize');\n    return list;\n};\n\n// SpeechBubbleMorph ///////////////////////////////////////////////////\n\n/*\n    I am a comic-style speech bubble that can display either a string,\n    a Morph, a Canvas or a toString() representation of anything else.\n    If I am invoked using popUp() I behave like a tool tip.\n*/\n\n// SpeechBubbleMorph: referenced constructors\n\n\n\n// SpeechBubbleMorph inherits from BoxMorph:\n\nSpeechBubbleMorph.prototype = new BoxMorph();\nSpeechBubbleMorph.prototype.constructor = SpeechBubbleMorph;\nSpeechBubbleMorph.uber = BoxMorph.prototype;\n\n// SpeechBubbleMorph instance creation:\n\nexport function SpeechBubbleMorph(\n    contents,\n    color,\n    edge,\n    border,\n    borderColor,\n    padding,\n    isThought,\n    noShadow\n) {\n    this.init(\n        contents,\n        color,\n        edge,\n        border,\n        borderColor,\n        padding,\n        isThought,\n        noShadow\n    );\n}\n\nSpeechBubbleMorph.prototype.init = function (\n    contents,\n    color,\n    edge,\n    border,\n    borderColor,\n    padding,\n    isThought, // bool or anything but \"true\" to draw no hook at all\n    noShadow // explicit TRUE to suppress\n) {\n    this.isPointingRight = true; // orientation of text\n    this.contents = contents || '';\n    this.padding = padding || 0; // additional vertical pixels\n    this.isThought = isThought || false; // draw \"think\" bubble\n    this.isClickable = false;\n    SpeechBubbleMorph.uber.init.call(\n        this,\n        edge || 6,\n        border || ((border === 0) ? 0 : 1),\n        borderColor || new Color(140, 140, 140)\n    );\n    this.hasShadow = noShadow !== true;\n    this.noDropShadow = true;\n    this.fullShadowSource = false;\n    this.color = color || new Color(230, 230, 230);\n    this.fixLayout();\n};\n\n// SpeechBubbleMorph invoking:\n\nSpeechBubbleMorph.prototype.popUp = function (world, pos, isClickable) {\n    this.fixLayout();\n    this.setPosition(pos.subtract(new Point(0, this.height())));\n    this.keepWithin(world);\n    world.add(this);\n    this.fullChanged();\n    world.hand.destroyTemporaries();\n    world.hand.temporaries.push(this);\n\n    if (!isClickable) {\n        this.mouseEnter = this.destroy;\n    } else {\n        this.isClickable = true;\n    }\n};\n\n// SpeechBubbleMorph drawing:\n\nSpeechBubbleMorph.prototype.fixLayout = function () {\n    // determine my extent and arrange my contents\n\n    if (this.contentsMorph) {\n        this.contentsMorph.destroy();\n    }\n    if (this.contents instanceof Morph) {\n        this.contentsMorph = this.contents;\n    } else if (isString(this.contents)) {\n        this.contentsMorph = new TextMorph(\n            this.contents,\n            MorphicPreferences.bubbleHelpFontSize,\n            null,\n            false,\n            true,\n            'center'\n        );\n    } else if (this.contents instanceof HTMLCanvasElement) {\n        this.contentsMorph = new Morph();\n        this.contentsMorph.setExtent(new Point(\n            this.contents.width,\n            this.contents.height\n        ));\n        this.contentsMorph.cachedImage = this.contents;\n    } else {\n        this.contentsMorph = new TextMorph(\n            this.contents.toString(),\n            MorphicPreferences.bubbleHelpFontSize,\n            null,\n            false,\n            true,\n            'center'\n        );\n    }\n    this.add(this.contentsMorph);\n\n    // adjust my layout\n    this.bounds.setExtent(\n        new Point(\n            this.contentsMorph.width() +\n                (this.padding ? this.padding * 2 : this.edge * 2),\n            this.contentsMorph.height() +\n                this.edge +\n                this.border * 2 +\n                this.padding * 2 +\n                2\n        )\n    );\n\n    // position my contents\n    this.contentsMorph.setPosition(this.position().add(\n        new Point(\n            this.padding || this.edge,\n            this.border + this.padding + 1\n        )\n    ));\n\n    // refresh a shallow shadow\n    if (this.hasShadow) {\n        this.removeShadow();\n        this.addShadow(new Point(2, 2), 80);\n    }\n};\n\nSpeechBubbleMorph.prototype.outlinePath = function (ctx, radius, inset) {\n    var offset = radius + inset,\n        w = this.width(),\n        h = this.height(),\n        rad;\n\n    function circle(x, y, r) {\n        ctx.moveTo(x + r, y);\n        ctx.arc(x, y, r, radians(0), radians(360));\n    }\n\n    // top left:\n    ctx.arc(\n        offset,\n        offset,\n        radius,\n        radians(-180),\n        radians(-90),\n        false\n    );\n    // top right:\n    ctx.arc(\n        w - offset,\n        offset,\n        radius,\n        radians(-90),\n        radians(-0),\n        false\n    );\n    // bottom right:\n    ctx.arc(\n        w - offset,\n        h - offset - radius,\n        radius,\n        radians(0),\n        radians(90),\n        false\n    );\n    if (!this.isThought) { // draw speech bubble hook\n        if (this.isPointingRight) {\n            ctx.lineTo(\n                offset + radius,\n                h - offset\n            );\n            ctx.lineTo(\n                radius / 2 + inset,\n                h - inset\n            );\n        } else { // pointing left\n            ctx.lineTo(\n                w - (radius / 2 + inset),\n                h - inset\n            );\n            ctx.lineTo(\n                w - (offset + radius),\n                h - offset\n            );\n        }\n    }\n    // bottom left:\n    ctx.arc(\n        offset,\n        h - offset - radius,\n        radius,\n        radians(90),\n        radians(180),\n        false\n    );\n    if (this.isThought === true) { // use anything but \"true\" to draw nothing\n        // close large bubble:\n        ctx.lineTo(\n            inset,\n            offset\n        );\n        // draw thought bubbles:\n        if (this.isPointingRight) {\n            // tip bubble:\n            rad = radius / 4;\n            circle(\n                rad + inset,\n                h - rad - inset,\n                rad\n            );\n            // middle bubble:\n            rad = radius / 3.2;\n            circle(\n                (rad * 2) + inset,\n                h - rad - (inset * 2),\n                rad\n            );\n            // top bubble:\n            rad = radius / 2.8;\n            circle(\n                (rad * 3) + inset * 2,\n                h - rad - (inset * 4),\n                rad\n            );\n        } else { // pointing left\n            // tip bubble:\n            rad = radius / 4;\n            circle(\n                w - (rad + inset),\n                h - rad - inset,\n                rad\n            );\n            // middle bubble:\n            rad = radius / 3.2;\n            circle(\n                w - (rad * 2 + inset),\n                h - rad - inset * 2,\n                rad\n            );\n            // top bubble:\n            rad = radius / 2.8;\n            circle(\n                w - (rad * 3 + inset * 2),\n                h - rad - inset * 4,\n                rad\n            );\n        }\n    }\n};\n\n// SpeechBubbleMorph shadow\n\n/*\n    only take the 'plain' image, so the box rounding and the\n    shadow doesn't become conflicted by embedded scrolling panes\n*/\n\nSpeechBubbleMorph.prototype.shadowImage = function (off, color) {\n    // for \"flat\" design mode\n    var fb, img, outline, sha, ctx,\n        offset = off || new Point(7, 7),\n        clr = color || new Color(0, 0, 0);\n    fb = this.extent();\n    img = this.getImage();\n    outline = newCanvas(fb);\n    ctx = outline.getContext('2d');\n    ctx.drawImage(img, 0, 0);\n    ctx.globalCompositeOperation = 'destination-out';\n    ctx.drawImage(\n        img,\n        -offset.x,\n        -offset.y\n    );\n    sha = newCanvas(fb);\n    ctx = sha.getContext('2d');\n    ctx.drawImage(outline, 0, 0);\n    ctx.globalCompositeOperation = 'source-atop';\n    ctx.fillStyle = clr.toString();\n    ctx.fillRect(0, 0, fb.x, fb.y);\n    return sha;\n};\n\nSpeechBubbleMorph.prototype.shadowImageBlurred = function (off, color) {\n    var fb, img, sha, ctx,\n        offset = off || new Point(7, 7),\n        blur = this.shadowBlur,\n        clr = color || new Color(0, 0, 0);\n    fb = this.extent().add(blur * 2);\n    img = this.getImage();\n    sha = newCanvas(fb);\n    ctx = sha.getContext('2d');\n    ctx.shadowOffsetX = offset.x;\n    ctx.shadowOffsetY = offset.y;\n    ctx.shadowBlur = blur;\n    ctx.shadowColor = clr.toString();\n    ctx.drawImage(\n        img,\n        blur - offset.x,\n        blur - offset.y\n    );\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 0;\n    ctx.shadowBlur = 0;\n    ctx.globalCompositeOperation = 'destination-out';\n    ctx.drawImage(\n        img,\n        blur - offset.x,\n        blur - offset.y\n    );\n    return sha;\n};\n\n// DialMorph //////////////////////////////////////////////////////\n\n// I am a knob than can be turned to select a number\n\n//\n\n// DialMorph inherits from Morph:\n\nDialMorph.prototype = new Morph();\nDialMorph.prototype.constructor = DialMorph;\nDialMorph.uber = Morph.prototype;\n\nexport function DialMorph(min, max, value, tick, radius) {\n    this.init(min, max, value, tick, radius);\n}\n\nDialMorph.prototype.init = function (min, max, value, tick, radius) {\n    this.target = null;\n    this.action = null;\n    this.min = min || 0;\n    this.max = max || 360;\n    this.value = Math.max(this.min, (value || 0) % this.max);\n    this.tick = tick || 15;\n    this.fillColor = null;\n\n    DialMorph.uber.init.call(this);\n\n    this.color = new Color(230, 230, 230);\n    this.setRadius(radius || MorphicPreferences.menuFontSize * 4);\n};\n\nDialMorph.prototype.setRadius = function (radius) {\n\tthis.radius = radius;\n    this.setExtent(new Point(this.radius * 2, this.radius * 2));\n};\n\nDialMorph.prototype.setValue = function (value, snapToTick, noUpdate) {\n\tvar range = this.max - this.min;\n \tvalue = value || 0;\n    this.value = this.min + (((+value % range) + range) % range);\n    if (snapToTick) {\n    \tif (this.value < this.tick) {\n     \t\tthis.value = this.min;\n       \t} else {\n    \t\tthis.value -= this.value % this.tick % this.value;\n        }\n    }\n \tthis.changed();\n  \tif (noUpdate) {return; }\n  \tthis.updateTarget();\n};\n\nDialMorph.prototype.getValueOf = function (point) {\n    var range = this.max - this.min,\n    \tcenter = this.center(),\n        deltaX = point.x - center.x,\n        deltaY = center.y - point.y,\n        angle = Math.abs(deltaX) < 0.001 ? (deltaY < 0 ? 90 : 270)\n                : Math.round(\n                (deltaX >= 0 ? 0 : 180)\n                    - (Math.atan(deltaY / deltaX) * 57.2957795131)\n        \t\t),\n        value = angle + 90 % 360,\n        ratio = value / 360;\n    return range * ratio + this.min;\n};\n\nDialMorph.prototype.setExtent = function (aPoint) {\n\tvar size = Math.min(aPoint.x, aPoint.y);\n\tthis.radius = size / 2;\n    DialMorph.uber.setExtent.call(this, new Point(size, size));\n};\n\nDialMorph.prototype.render = function (ctx) {\n    var i, angle, x1, y1, x2, y2,\n        light = this.color.lighter().toString(),\n        range = this.max - this.min,\n        ticks = range / this.tick,\n        face = this.radius * 0.75,\n        inner = face * 0.85,\n        outer = face * 0.95;\n\n    // draw a light border:\n    ctx.fillStyle = light;\n    ctx.beginPath();\n    ctx.arc(\n        this.radius,\n        this.radius,\n        face + Math.min(1, this.radius - face),\n        0,\n        2 * Math.PI,\n        false\n    );\n    ctx.closePath();\n    ctx.fill();\n\n    // fill circle:\n    ctx.fillStyle = this.color.toString();\n    ctx.beginPath();\n    ctx.arc(\n        this.radius,\n        this.radius,\n        face,\n        0,\n        2 * Math.PI,\n        false\n    );\n    ctx.closePath();\n    ctx.fill();\n\n    // fill value\n    angle = (this.value - this.min) * (Math.PI * 2) / range - Math.PI / 2;\n    ctx.fillStyle = (this.fillColor || this.color.darker()).toString();\n    ctx.beginPath();\n    ctx.arc(\n        this.radius,\n        this.radius,\n        face,\n        Math.PI / -2,\n        angle,\n        false\n    );\n    ctx.lineTo(this.radius, this.radius);\n    ctx.closePath();\n    ctx.fill();\n\n    // draw ticks:\n    ctx.strokeStyle = new Color(35, 35, 35).toString();\n    ctx.lineWidth = 1;\n    for (i = 0; i < ticks; i += 1) {\n        angle = (i - 3) * (Math.PI * 2) / ticks - Math.PI / 2;\n        ctx.beginPath();\n        x1 = this.radius + Math.cos(angle) * inner;\n        y1 = this.radius + Math.sin(angle) * inner;\n        x2 = this.radius + Math.cos(angle) * outer;\n        y2 = this.radius + Math.sin(angle) * outer;\n        ctx.moveTo(x1, y1);\n        ctx.lineTo(x2, y2);\n        ctx.stroke();\n    }\n\n    // draw a filled center:\n    inner = face * 0.05;\n    ctx.fillStyle = 'black';\n    ctx.beginPath();\n    ctx.arc(\n        this.radius,\n        this.radius,\n        inner,\n        0,\n        2 * Math.PI,\n        false\n    );\n    ctx.closePath();\n    ctx.fill();\n\n    // draw the inner hand:\n    ctx.strokeStyle = 'black';\n    ctx.lineWidth = 1;\n    angle = (this.value - this.min) * (Math.PI * 2) / range - Math.PI / 2;\n    outer = face * 0.8;\n    x1 = this.radius + Math.cos(angle) * inner;\n    y1 = this.radius + Math.sin(angle) * inner;\n    x2 = this.radius + Math.cos(angle) * outer;\n    y2 = this.radius + Math.sin(angle) * outer;\n    ctx.beginPath();\n    ctx.moveTo(x1, y1);\n    ctx.lineTo(x2, y2);\n    ctx.stroke();\n\n    // draw a read-out circle:\n    inner = inner * 2;\n    x2 = this.radius + Math.cos(angle) * (outer + inner);\n    y2 = this.radius + Math.sin(angle) * (outer + inner);\n    ctx.fillStyle = 'black';\n    ctx.beginPath();\n    ctx.arc(\n        x2,\n        y2,\n        inner,\n        0,\n        2 * Math.PI,\n        false\n    );\n    ctx.closePath();\n    ctx.stroke();\n\n    // draw the outer hand:\n    angle = (this.value - this.min) * (Math.PI * 2) / range - Math.PI / 2;\n    x1 = this.radius + Math.cos(angle) * face;\n    y1 = this.radius + Math.sin(angle) * face;\n    x2 = this.radius + Math.cos(angle) * (this.radius - 1);\n    y2 = this.radius + Math.sin(angle) * (this.radius - 1);\n    ctx.beginPath();\n    ctx.moveTo(x1, y1);\n    ctx.lineTo(x2, y2);\n    ctx.lineWidth = 3;\n    ctx.strokeStyle = light;\n    ctx.stroke();\n    ctx.lineWidth = 1;\n    ctx.strokeStyle = 'black';\n    ctx.stroke();\n\n    // draw arrow tip:\n    angle = radians(degrees(angle) - 4);\n    x1 = this.radius + Math.cos(angle) * this.radius * 0.9;\n    y1 = this.radius + Math.sin(angle) * this.radius * 0.9;\n    ctx.beginPath();\n    ctx.moveTo(x1, y1);\n    angle = radians(degrees(angle) + 8);\n    x1 = this.radius + Math.cos(angle) * this.radius * 0.9;\n    y1 = this.radius + Math.sin(angle) * this.radius * 0.9;\n    ctx.lineTo(x1, y1);\n    ctx.lineTo(x2, y2);\n    ctx.closePath();\n    ctx.lineWidth = 3;\n    ctx.strokeStyle = light;\n    ctx.stroke();\n    ctx.lineWidth = 1;\n    ctx.strokeStyle = 'black';\n    ctx.stroke();\n    ctx.fill();\n};\n\n// DialMorph stepping:\n\nDialMorph.prototype.step = null;\n\nDialMorph.prototype.mouseDownLeft = function (pos) {\n    var world = this.root();\n\n    this.step = () => {\n        if (world.hand.mouseButton) {\n            this.setValue(\n            \tthis.getValueOf(world.hand.bounds.origin),\n             \tworld.currentKey !== 16 // snap to tick\n            );\n        } else {\n            this.step = null;\n        }\n    };\n};\n\n// DialMorph menu:\n\nDialMorph.prototype.developersMenu = function () {\n    var menu = DialMorph.uber.developersMenu.call(this);\n    menu.addLine();\n    menu.addItem(\n        'set target',\n        \"setTarget\",\n        'select another morph\\nwhose numerical property\\nwill be ' +\n            'controlled by this one'\n    );\n    return menu;\n};\n\nDialMorph.prototype.setTarget = function () {\n    var choices = this.overlappedMorphs(),\n        menu = new MenuMorph(this, 'choose target:');\n\n    choices.push(this.world());\n    choices.forEach(each => {\n        menu.addItem(each.toString().slice(0, 50), () => {\n            this.target = each;\n            this.setTargetSetter();\n        });\n    });\n    if (choices.length === 1) {\n        this.target = choices[0];\n        this.setTargetSetter();\n    } else if (choices.length > 0) {\n        menu.popUpAtHand(this.world());\n    }\n};\n\nDialMorph.prototype.setTargetSetter = function () {\n    var choices = this.target.numericalSetters(),\n        menu = new MenuMorph(this, 'choose target property:');\n\n    choices.forEach(each => {\n        menu.addItem(each, () => this.action = each);\n    });\n    if (choices.length === 1) {\n        this.action = choices[0];\n    } else if (choices.length > 0) {\n        menu.popUpAtHand(this.world());\n    }\n};\n\nDialMorph.prototype.updateTarget = function () {\n    if (this.action) {\n        if (typeof this.action === 'function') {\n            this.action.call(this.target, this.value);\n        } else { // assume it's a String\n            this.target[this.action](this.value);\n        }\n    }\n};\n\n// CircleBoxMorph //////////////////////////////////////////////////////\n\n// I can be used for sliders\n\n//\n\n// CircleBoxMorph inherits from Morph:\n\nCircleBoxMorph.prototype = new Morph();\nCircleBoxMorph.prototype.constructor = CircleBoxMorph;\nCircleBoxMorph.uber = Morph.prototype;\n\nexport function CircleBoxMorph(orientation) {\n    this.init(orientation || 'vertical');\n}\n\nCircleBoxMorph.prototype.init = function (orientation) {\n    CircleBoxMorph.uber.init.call(this);\n    this.orientation = orientation;\n    this.autoOrient = true;\n    this.setExtent(new Point(20, 100));\n};\n\nCircleBoxMorph.prototype.autoOrientation = function () {\n    if (this.height() > this.width()) {\n        this.orientation = 'vertical';\n    } else {\n        this.orientation = 'horizontal';\n    }\n};\n\nCircleBoxMorph.prototype.render = function (ctx) {\n    var w = this.width(),\n        h = this.height(),\n        radius;\n\n    if (this.autoOrient) {\n        this.autoOrientation();\n    }\n\n    if (this.orientation === 'vertical') {\n        radius = w / 2;\n        ctx.beginPath();\n\n        // top semi-circle\n        ctx.arc(\n            radius,\n            radius,\n            radius,\n            radians(180),\n            radians(0),\n            false\n        );\n\n        // right line\n        ctx.lineTo(\n            w,\n            h - radius\n        );\n\n        // bottom semi-circle\n        ctx.arc(\n            radius,\n            h - radius,\n            radius,\n            radians(0),\n            radians(180),\n            false\n        );\n\n    } else {\n        radius = h / 2;\n        ctx.beginPath();\n\n        // left semi-circle\n        ctx.arc(\n            radius,\n            radius,\n            radius,\n            radians(90),\n            radians(-90),\n            false\n        );\n\n        // top line\n        ctx.lineTo(\n            w - radius,\n            0\n        );\n\n        // right semi-circle\n        ctx.arc(\n            w - radius,\n            radius,\n            radius,\n            radians(-90),\n            radians(90),\n            false\n        );\n    }\n    ctx.closePath();\n    ctx.fillStyle = this.color.toString();\n    ctx.fill();\n};\n\n// CircleBoxMorph menu:\n\nCircleBoxMorph.prototype.developersMenu = function () {\n    var menu = CircleBoxMorph.uber.developersMenu.call(this);\n    menu.addLine();\n    if (this.orientation === 'vertical') {\n        menu.addItem(\n            \"horizontal...\",\n            'toggleOrientation',\n            'toggle the\\norientation'\n        );\n    } else {\n        menu.addItem(\n            \"vertical...\",\n            'toggleOrientation',\n            'toggle the\\norientation'\n        );\n    }\n    return menu;\n};\n\nCircleBoxMorph.prototype.toggleOrientation = function () {\n    var center = this.center();\n    this.changed();\n    if (this.orientation === 'vertical') {\n        this.orientation = 'horizontal';\n    } else {\n        this.orientation = 'vertical';\n    }\n    this.setExtent(new Point(this.height(), this.width()));\n    this.setCenter(center);\n};\n\n// SliderButtonMorph ///////////////////////////////////////////////////\n\n\n\n// SliderButtonMorph inherits from CircleBoxMorph:\n\nSliderButtonMorph.prototype = new CircleBoxMorph();\nSliderButtonMorph.prototype.constructor = SliderButtonMorph;\nSliderButtonMorph.uber = CircleBoxMorph.prototype;\n\nexport function SliderButtonMorph(orientation) {\n    this.init(orientation);\n}\n\nSliderButtonMorph.prototype.init = function (orientation) {\n    this.color = new Color(80, 80, 80);\n    this.highlightColor = new Color(90, 90, 140);\n    this.pressColor = new Color(80, 80, 160);\n    this.userState = 'normal'; // 'highlight', 'pressed'\n    this.is3D = false;\n    this.hasMiddleDip = true;\n    SliderButtonMorph.uber.init.call(this, orientation);\n};\n\nSliderButtonMorph.prototype.autoOrientation = nop;\n\nSliderButtonMorph.prototype.render = function (ctx) {\n    var colorBak = this.color;\n    if (this.userState === 'highlight') {\n        this.color = this.highlightColor;\n    } else if (this.userState === 'pressed') {\n        this.color = this.pressColor;\n    }\n    SliderButtonMorph.uber.render.call(this, ctx);\n    if (this.is3D || !MorphicPreferences.isFlat) {\n        this.renderEdges(ctx);\n    }\n    this.color = colorBak;\n};\n\nSliderButtonMorph.prototype.renderEdges = function (ctx) {\n    var gradient,\n        radius,\n        w = this.width(),\n        h = this.height();\n\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    if (this.orientation === 'vertical') {\n        ctx.lineWidth = w / 3;\n        gradient = ctx.createLinearGradient(\n            0,\n            0,\n            ctx.lineWidth,\n            0\n        );\n        gradient.addColorStop(0, 'white');\n        gradient.addColorStop(1, this.color.toString());\n\n        ctx.strokeStyle = gradient;\n        ctx.beginPath();\n        ctx.moveTo(ctx.lineWidth * 0.5, w / 2);\n        ctx.lineTo(ctx.lineWidth * 0.5, h - w / 2);\n        ctx.stroke();\n\n        gradient = ctx.createLinearGradient(\n            w - ctx.lineWidth,\n            0,\n            w,\n            0\n        );\n        gradient.addColorStop(0, this.color.toString());\n        gradient.addColorStop(1, 'black');\n\n        ctx.strokeStyle = gradient;\n        ctx.beginPath();\n        ctx.moveTo(w - ctx.lineWidth * 0.5, w / 2);\n        ctx.lineTo(w - ctx.lineWidth * 0.5, h - w / 2);\n        ctx.stroke();\n\n        if (this.hasMiddleDip) {\n            gradient = ctx.createLinearGradient(\n                ctx.lineWidth,\n                0,\n                w - ctx.lineWidth,\n                0\n            );\n\n            radius = w / 4;\n            gradient.addColorStop(0, 'black');\n            gradient.addColorStop(0.35, this.color.toString());\n            gradient.addColorStop(0.65, this.color.toString());\n            gradient.addColorStop(1, 'white');\n\n            ctx.fillStyle = gradient;\n            ctx.beginPath();\n            ctx.arc(\n                w / 2,\n                h / 2,\n                radius,\n                radians(0),\n                radians(360),\n                false\n            );\n            ctx.closePath();\n            ctx.fill();\n        }\n    } else if (this.orientation === 'horizontal') {\n        ctx.lineWidth = h / 3;\n        gradient = ctx.createLinearGradient(\n            0,\n            0,\n            0,\n            ctx.lineWidth\n        );\n        gradient.addColorStop(0, 'white');\n        gradient.addColorStop(1, this.color.toString());\n\n        ctx.strokeStyle = gradient;\n        ctx.beginPath();\n        ctx.moveTo(h / 2, ctx.lineWidth * 0.5);\n        ctx.lineTo(w - h / 2, ctx.lineWidth * 0.5);\n        ctx.stroke();\n\n        gradient = ctx.createLinearGradient(\n            0,\n            h - ctx.lineWidth,\n            0,\n            h\n        );\n        gradient.addColorStop(0, this.color.toString());\n        gradient.addColorStop(1, 'black');\n\n        ctx.strokeStyle = gradient;\n        ctx.beginPath();\n        ctx.moveTo(h / 2, h - ctx.lineWidth * 0.5);\n        ctx.lineTo(w - h / 2, h - ctx.lineWidth * 0.5);\n        ctx.stroke();\n\n        if (this.hasMiddleDip) {\n            gradient = ctx.createLinearGradient(\n                0,\n                ctx.lineWidth,\n                0,\n                h - ctx.lineWidth\n            );\n\n            radius = h / 4;\n            gradient.addColorStop(0, 'black');\n            gradient.addColorStop(0.35, this.color.toString());\n            gradient.addColorStop(0.65, this.color.toString());\n            gradient.addColorStop(1, 'white');\n\n            ctx.fillStyle = gradient;\n            ctx.beginPath();\n            ctx.arc(\n                this.width() / 2,\n                this.height() / 2,\n                radius,\n                radians(0),\n                radians(360),\n                false\n            );\n            ctx.closePath();\n            ctx.fill();\n        }\n    }\n};\n\n//SliderButtonMorph events:\n\nSliderButtonMorph.prototype.mouseEnter = function () {\n    this.userState = 'highlight';\n    this.rerender();\n};\n\nSliderButtonMorph.prototype.mouseLeave = function () {\n    this.userState = 'normal';\n    this.rerender();\n};\n\nSliderButtonMorph.prototype.mouseDownLeft = function (pos) {\n    this.userState = 'pressed';\n    this.rerender();\n    this.escalateEvent('mouseDownLeft', pos);\n};\n\nSliderButtonMorph.prototype.mouseClickLeft = function () {\n    this.userState = 'highlight';\n    this.rerender();\n};\n\nSliderButtonMorph.prototype.mouseMove = function () {\n    // prevent my parent from getting picked up\n    nop();\n};\n\n// SliderMorph ///////////////////////////////////////////////////\n\n// SliderMorph inherits from CircleBoxMorph:\n\nSliderMorph.prototype = new CircleBoxMorph();\nSliderMorph.prototype.constructor = SliderMorph;\nSliderMorph.uber = CircleBoxMorph.prototype;\n\nexport function SliderMorph(start, stop, value, size, orientation, color) {\n    this.init(\n        start || 0,\n        stop || 100,\n        value || 0,\n        size || 10,\n        orientation || 'vertical',\n        color\n    );\n}\n\nSliderMorph.prototype.init = function (\n    start,\n    stop,\n    value,\n    size,\n    orientation,\n    color\n) {\n    this.target = null;\n    this.action = null;\n    this.start = start;\n    this.stop = stop;\n    this.value = value;\n    this.size = size;\n    this.offset = null;\n    this.button = new SliderButtonMorph();\n    this.button.isDraggable = false;\n    this.button.color = new Color(200, 200, 200);\n    this.button.highlightColor = new Color(210, 210, 255);\n    this.button.pressColor = new Color(180, 180, 255);\n    SliderMorph.uber.init.call(this, orientation);\n    this.add(this.button);\n    this.alpha = 0.3;\n    this.color = color || new Color(0, 0, 0);\n    this.setExtent(new Point(20, 100));\n    this.fixLayout();\n};\n\nSliderMorph.prototype.autoOrientation = nop;\n\nSliderMorph.prototype.rangeSize = function () {\n    return this.stop - this.start;\n};\n\nSliderMorph.prototype.ratio = function () {\n    return this.size / (this.rangeSize() + 1);\n};\n\nSliderMorph.prototype.unitSize = function () {\n    if (this.orientation === 'vertical') {\n        return (this.height() - this.button.height()) /\n            this.rangeSize();\n    }\n    return (this.width() - this.button.width()) /\n        this.rangeSize();\n};\n\nSliderMorph.prototype.fixLayout = function () {\n    var bw, bh, posX, posY;\n\n    this.button.orientation = this.orientation;\n    if (this.orientation === 'vertical') {\n        bw  = this.width() - 2;\n        bh = Math.max(bw, Math.round(this.height() * this.ratio()));\n        this.button.setExtent(new Point(bw, bh));\n        posX = 1;\n        posY = Math.max(\n            Math.min(\n                Math.round((this.value - this.start) * this.unitSize()),\n                this.height() - this.button.height()\n            ),\n            0\n        );\n    } else {\n        bh = this.height() - 2;\n        bw  = Math.max(bh, Math.round(this.width() * this.ratio()));\n        this.button.setExtent(new Point(bw, bh));\n        posY = 1;\n        posX = Math.max(\n            Math.min(\n                Math.round((this.value - this.start) * this.unitSize()),\n                this.width() - this.button.width()\n            ),\n            0\n        );\n    }\n    this.button.setPosition(\n        new Point(posX, posY).add(this.bounds.origin)\n    );\n};\n\nSliderMorph.prototype.updateValue = function () {\n    var relPos;\n    if (this.orientation === 'vertical') {\n        relPos = this.button.top() - this.top();\n    } else {\n        relPos = this.button.left() - this.left();\n    }\n    this.value = Math.round(relPos / this.unitSize() + this.start);\n    this.updateTarget();\n};\n\nSliderMorph.prototype.updateTarget = function () {\n    if (this.action) {\n        if (typeof this.action === 'function') {\n            this.action.call(this.target, this.value);\n        } else { // assume it's a String\n            this.target[this.action](this.value);\n        }\n    }\n};\n\n// SliderMorph menu:\n\nSliderMorph.prototype.developersMenu = function () {\n    var menu = SliderMorph.uber.developersMenu.call(this);\n    menu.addItem(\n        \"show value...\",\n        'showValue',\n        'display a dialog box\\nshowing the selected number'\n    );\n    menu.addItem(\n        \"floor...\",\n        () => {\n            this.prompt(\n                menu.title + '\\nfloor:',\n                this.setStart,\n                this,\n                this.start.toString(),\n                null,\n                0,\n                this.stop - this.size,\n                true\n            );\n        },\n        'set the minimum value\\nwhich can be selected'\n    );\n    menu.addItem(\n        \"ceiling...\",\n        () => {\n            this.prompt(\n                menu.title + '\\nceiling:',\n                this.setStop,\n                this,\n                this.stop.toString(),\n                null,\n                this.start + this.size,\n                this.size * 100,\n                true\n            );\n        },\n        'set the maximum value\\nwhich can be selected'\n    );\n    menu.addItem(\n        \"button size...\",\n        () => {\n            this.prompt(\n                menu.title + '\\nbutton size:',\n                this.setSize,\n                this,\n                this.size.toString(),\n                null,\n                1,\n                this.stop - this.start,\n                true\n            );\n        },\n        'set the range\\ncovered by\\nthe slider button'\n    );\n    menu.addLine();\n    menu.addItem(\n        'set target',\n        \"setTarget\",\n        'select another morph\\nwhose numerical property\\nwill be ' +\n            'controlled by this one'\n    );\n    return menu;\n};\n\nSliderMorph.prototype.showValue = function () {\n    this.inform(this.value);\n};\n\nSliderMorph.prototype.userSetStart = function (num) {\n    // for context menu demo purposes\n    this.start = Math.max(num, this.stop);\n};\n\nSliderMorph.prototype.setStart = function (num, noUpdate) {\n    // for context menu demo purposes\n    var newStart;\n    if (typeof num === 'number') {\n        this.start = Math.min(\n            num,\n            this.stop - this.size\n        );\n    } else {\n        newStart = parseFloat(num);\n        if (!isNaN(newStart)) {\n            this.start = Math.min(\n                newStart,\n                this.stop - this.size\n            );\n        }\n    }\n    this.value = Math.max(this.value, this.start);\n    if (!noUpdate) {this.updateTarget(); }\n    this.fixLayout();\n    this.rerender();\n};\n\nSliderMorph.prototype.setStop = function (num, noUpdate) {\n    // for context menu demo purposes\n    var newStop;\n    if (typeof num === 'number') {\n        this.stop = Math.max(num, this.start + this.size);\n    } else {\n        newStop = parseFloat(num);\n        if (!isNaN(newStop)) {\n            this.stop = Math.max(newStop, this.start + this.size);\n        }\n    }\n    this.value = Math.min(this.value, this.stop);\n    if (!noUpdate) {this.updateTarget(); }\n    this.fixLayout();\n    this.rerender();\n};\n\nSliderMorph.prototype.setSize = function (num, noUpdate) {\n    // for context menu demo purposes\n    var newSize;\n    if (typeof num === 'number') {\n        this.size = Math.min(\n            Math.max(num, 1),\n            this.stop - this.start\n        );\n    } else {\n        newSize = parseFloat(num);\n        if (!isNaN(newSize)) {\n            this.size = Math.min(\n                Math.max(newSize, 1),\n                this.stop - this.start\n            );\n        }\n    }\n    this.value = Math.min(this.value, this.stop - this.size);\n    if (!noUpdate) {this.updateTarget(); }\n    this.fixLayout();\n    this.rerender();\n};\n\nSliderMorph.prototype.setTarget = function () {\n    var choices = this.overlappedMorphs(),\n        menu = new MenuMorph(this, 'choose target:');\n\n    choices.push(this.world());\n    choices.forEach(each => {\n        menu.addItem(each.toString().slice(0, 50), () => {\n            this.target = each;\n            this.setTargetSetter();\n        });\n    });\n    if (choices.length === 1) {\n        this.target = choices[0];\n        this.setTargetSetter();\n    } else if (choices.length > 0) {\n        menu.popUpAtHand(this.world());\n    }\n};\n\nSliderMorph.prototype.setTargetSetter = function () {\n    var choices = this.target.numericalSetters(),\n        menu = new MenuMorph(this, 'choose target property:');\n\n    choices.forEach(each => {\n        menu.addItem(each, () => this.action = each);\n    });\n    if (choices.length === 1) {\n        this.action = choices[0];\n    } else if (choices.length > 0) {\n        menu.popUpAtHand(this.world());\n    }\n};\n\nSliderMorph.prototype.numericalSetters = function () {\n    // for context menu demo purposes\n    var list = SliderMorph.uber.numericalSetters.call(this);\n    list.push('setStart', 'setStop', 'setSize');\n    return list;\n};\n\n// SliderMorph stepping:\n\nSliderMorph.prototype.step = null;\n\nSliderMorph.prototype.mouseDownLeft = function (pos) {\n    var world;\n\n    if (!this.button.bounds.containsPoint(pos)) {\n        this.offset = new Point(); // return null;\n    } else {\n        this.offset = pos.subtract(this.button.bounds.origin);\n    }\n    world = this.root();\n\n    this.step = () => {\n        var mousePos, newX, newY;\n        if (world.hand.mouseButton) {\n            mousePos = world.hand.bounds.origin;\n            if (this.orientation === 'vertical') {\n                newX = this.button.bounds.origin.x;\n                newY = Math.max(\n                    Math.min(\n                        mousePos.y - this.offset.y,\n                        this.bottom() - this.button.height()\n                    ),\n                    this.top()\n                );\n            } else {\n                newY = this.button.bounds.origin.y;\n                newX = Math.max(\n                    Math.min(\n                        mousePos.x - this.offset.x,\n                        this.right() - this.button.width()\n                    ),\n                    this.left()\n                );\n            }\n            this.button.setPosition(new Point(newX, newY));\n            this.updateValue();\n        } else {\n            this.step = null;\n        }\n    };\n};\n\n// MouseSensorMorph ////////////////////////////////////////////////////\n\n// for demo and debuggin purposes only, to be removed later\n\n\n\n// MouseSensorMorph inherits from BoxMorph:\n\nMouseSensorMorph.prototype = new BoxMorph();\nMouseSensorMorph.prototype.constructor = MouseSensorMorph;\nMouseSensorMorph.uber = BoxMorph.prototype;\n\n// MouseSensorMorph instance creation:\n\nexport function MouseSensorMorph(edge, border, borderColor) {\n    this.init(edge, border, borderColor);\n}\n\nMouseSensorMorph.prototype.init = function (edge, border, borderColor) {\n    MouseSensorMorph.uber.init.call(this);\n    this.edge = edge || 4;\n    this.border = border || 2;\n    this.color = WHITE;\n    this.borderColor = borderColor || BLACK;\n    this.isTouched = false;\n    this.upStep = 0.05;\n    this.downStep = 0.02;\n};\n\nMouseSensorMorph.prototype.touch = function () {\n    if (!this.isTouched) {\n        this.isTouched = true;\n        this.alpha = 0.6;\n\n        this.step = () => {\n            if (this.isTouched) {\n                if (this.alpha < 1) {\n                    this.alpha += this.upStep;\n                }\n            } else if (this.alpha > this.downStep) {\n                this.alpha -= this.downStep;\n            } else {\n                this.alpha = 0;\n                this.step = null;\n            }\n            this.changed();\n        };\n    }\n};\n\nMouseSensorMorph.prototype.unTouch = function () {\n    this.isTouched = false;\n};\n\nMouseSensorMorph.prototype.mouseEnter = function () {\n    this.touch();\n};\n\nMouseSensorMorph.prototype.mouseLeave = function () {\n    this.unTouch();\n};\n\nMouseSensorMorph.prototype.mouseDownLeft = function () {\n    this.touch();\n};\n\nMouseSensorMorph.prototype.mouseClickLeft = function () {\n    this.unTouch();\n};\n\n// InspectorMorph //////////////////////////////////////////////////////\n\n// InspectorMorph: referenced constructors\n\n\n\n\n// InspectorMorph inherits from BoxMorph:\n\nInspectorMorph.prototype = new BoxMorph();\nInspectorMorph.prototype.constructor = InspectorMorph;\nInspectorMorph.uber = BoxMorph.prototype;\n\n// InspectorMorph instance creation:\n\nexport function InspectorMorph(target) {\n    this.init(target);\n}\n\nInspectorMorph.prototype.init = function (target) {\n    // additional properties:\n    this.target = target;\n    this.currentProperty = null;\n    this.showing = 'attributes';\n    this.markOwnProperties = false;\n    this.hasUserEditedDetails = false;\n\n    // initialize inherited properties:\n    InspectorMorph.uber.init.call(this);\n\n    // override inherited properties:\n    this.isDraggable = true;\n    this.border = 1;\n    this.edge = MorphicPreferences.isFlat ? 1 : 5;\n    this.color = new Color(60, 60, 60);\n    this.borderColor = new Color(95, 95, 95);\n    this.fps = 25;\n\n    // panes:\n    this.label = null;\n    this.list = null;\n    this.detail = null;\n    this.work = null;\n    this.buttonInspect = null;\n    this.buttonClose = null;\n    this.buttonSubset = null;\n    this.buttonEdit = null;\n    this.resizer = null;\n\n    if (this.target) {\n        this.buildPanes();\n    }\n\n    this.setExtent(\n        new Point(\n            MorphicPreferences.handleSize * 20,\n            MorphicPreferences.handleSize * 20 * 2 / 3\n        )\n    );\n};\n\nInspectorMorph.prototype.setTarget = function (target) {\n    this.target = target;\n    this.currentProperty = null;\n    this.buildPanes();\n};\n\nInspectorMorph.prototype.updateCurrentSelection = function () {\n    var val, txt, cnts,\n        sel = this.list.selected,\n        currentTxt = this.detail.contents.children[0],\n        root = this.root();\n\n    if (root &&\n            (root.keyboardFocus instanceof CursorMorph) &&\n            (root.keyboardFocus.target === currentTxt)) {\n        this.hasUserEditedDetails = true;\n        return;\n    }\n    if (isNil(sel) || this.hasUserEditedDetails) {return; }\n    val = this.target[sel];\n    this.currentProperty = val;\n    if (isNil(val)) {\n        txt = 'NULL';\n    } else if (isString(val)) {\n        txt = val;\n    } else {\n        txt = val.toString();\n    }\n    if (currentTxt.text === txt) {return; }\n    cnts = new TextMorph(txt);\n    cnts.isEditable = true;\n    cnts.enableSelecting();\n    cnts.setReceiver(this.target);\n    this.detail.setContents(cnts);\n};\n\nInspectorMorph.prototype.buildPanes = function () {\n    var attribs = [], property, ctrl, ev, doubleClickAction;\n\n    // remove existing panes\n    this.children.forEach(m => {\n        if (m !== this.work) { // keep work pane around\n            m.destroy();\n        }\n    });\n    this.children = [];\n\n    // label\n    this.label = new TextMorph(this.target.toString());\n    this.label.fontSize = MorphicPreferences.menuFontSize;\n    this.label.isBold = true;\n    this.label.color = WHITE;\n    this.add(this.label);\n\n    // properties list\n    for (property in this.target) {\n        if (property) { // dummy condition, to be refined\n            attribs.push(property);\n        }\n    }\n    if (this.showing === 'attributes') {\n        attribs = attribs.filter(\n            prop => typeof this.target[prop] !== 'function'\n        );\n    } else if (this.showing === 'methods') {\n        attribs = attribs.filter(\n            prop => typeof this.target[prop] === 'function'\n        );\n    } // otherwise show all properties\n\n    doubleClickAction = () => {\n        var world, inspector;\n        if (!isObject(this.currentProperty)) {return; }\n        world = this.world();\n        inspector = new InspectorMorph(\n            this.currentProperty\n        );\n        inspector.setPosition(world.hand.position());\n        inspector.keepWithin(world);\n        world.add(inspector);\n        inspector.changed();\n    };\n\n    this.list = new ListMorph(\n        this.target instanceof Array ? attribs : attribs.sort(),\n        null, // label getter\n        this.markOwnProperties ?\n                [ // format list\n                    [ // format element: [color, predicate(element]\n                        new Color(0, 0, 180),\n                        element => {\n                            return Object.prototype.hasOwnProperty.call(\n                                this.target,\n                                element\n                            );\n                        }\n                    ]\n                ]\n                : null,\n        doubleClickAction\n    );\n\n    this.list.action = () => {\n        this.hasUserEditedDetails = false;\n        this.updateCurrentSelection();\n    };\n\n    this.list.hBar.alpha = 0.6;\n    this.list.vBar.alpha = 0.6;\n    this.list.contents.step = null;\n    this.add(this.list);\n\n    // details pane\n    this.detail = new ScrollFrameMorph();\n    this.detail.acceptsDrops = false;\n    this.detail.contents.acceptsDrops = false;\n    this.detail.isTextLineWrapping = true;\n    this.detail.color = WHITE;\n    this.detail.hBar.alpha = 0.6;\n    this.detail.vBar.alpha = 0.6;\n    ctrl = new TextMorph('');\n    ctrl.isEditable = true;\n    ctrl.enableSelecting();\n    ctrl.setReceiver(this.target);\n    this.detail.setContents(ctrl);\n    this.add(this.detail);\n\n    // work ('evaluation') pane\n    // don't refresh the work pane if it already exists\n    if (this.work === null) {\n        this.work = new ScrollFrameMorph();\n        this.work.acceptsDrops = false;\n        this.work.contents.acceptsDrops = false;\n        this.work.isTextLineWrapping = true;\n        this.work.color = WHITE;\n        this.work.hBar.alpha = 0.6;\n        this.work.vBar.alpha = 0.6;\n        ev = new TextMorph('');\n        ev.isEditable = true;\n        ev.enableSelecting();\n        ev.setReceiver(this.target);\n        this.work.setContents(ev);\n    }\n    this.add(this.work);\n\n    // properties button\n    this.buttonSubset = new TriggerMorph();\n    this.buttonSubset.labelString = 'show...';\n    this.buttonSubset.createLabel();\n    this.buttonSubset.action = () => {\n        var menu;\n        menu = new MenuMorph();\n        menu.addItem(\n            'attributes',\n            () => {\n                this.showing = 'attributes';\n                this.buildPanes();\n            }\n        );\n        menu.addItem(\n            'methods',\n            () => {\n                this.showing = 'methods';\n                this.buildPanes();\n            }\n        );\n        menu.addItem(\n            'all',\n            () => {\n                this.showing = 'all';\n                this.buildPanes();\n            }\n        );\n        menu.addLine();\n        menu.addItem(\n            (this.markOwnProperties ?\n                    'un-mark own' : 'mark own'),\n            () => {\n                this.markOwnProperties = !this.markOwnProperties;\n                this.buildPanes();\n            },\n            'highlight\\n\\'own\\' properties'\n        );\n        menu.popUpAtHand(this.world());\n    };\n\n    this.add(this.buttonSubset);\n\n    // inspect button\n    this.buttonInspect = new TriggerMorph();\n    this.buttonInspect.labelString = 'inspect...';\n    this.buttonInspect.createLabel();\n    this.buttonInspect.action = () => {\n        var menu, world, inspector;\n        if (isObject(this.currentProperty)) {\n            menu = new MenuMorph();\n            menu.addItem(\n                'in new inspector...',\n                () => {\n                    world = this.world();\n                    inspector = new InspectorMorph(\n                        this.currentProperty\n                    );\n                    inspector.setPosition(world.hand.position());\n                    inspector.keepWithin(world);\n                    world.add(inspector);\n                    inspector.changed();\n                }\n            );\n            menu.addItem(\n                'here...',\n                () => this.setTarget(this.currentProperty)\n            );\n            menu.popUpAtHand(this.world());\n        } else {\n            this.inform(\n                (this.currentProperty === null ?\n                        'null' : typeof this.currentProperty) +\n                            '\\nis not inspectable'\n            );\n        }\n    };\n    this.add(this.buttonInspect);\n\n    // edit button\n    this.buttonEdit = new TriggerMorph();\n    this.buttonEdit.labelString = 'edit...';\n    this.buttonEdit.createLabel();\n    this.buttonEdit.action = () => {\n        var menu = new MenuMorph(this);\n        menu.addItem(\"save\", 'save', 'accept changes');\n        menu.addLine();\n        menu.addItem(\"add property...\", 'addProperty');\n        menu.addItem(\"rename...\", 'renameProperty');\n        menu.addItem(\"remove...\", 'removeProperty');\n        menu.popUpAtHand(this.world());\n    };\n    this.add(this.buttonEdit);\n\n    // close button\n    this.buttonClose = new TriggerMorph();\n    this.buttonClose.labelString = 'close';\n    this.buttonClose.createLabel();\n    this.buttonClose.action = () => this.destroy();\n    this.add(this.buttonClose);\n\n    // resizer\n    this.resizer = new HandleMorph(\n        this,\n        150,\n        100,\n        this.edge,\n        this.edge\n    );\n\n    // update layout\n    this.fixLayout();\n};\n\nInspectorMorph.prototype.fixLayout = function () {\n    var x, y, r, b, w, h;\n\n    // label\n    x = this.left() + this.edge;\n    y = this.top() + this.edge;\n    r = this.right() - this.edge;\n    w = r - x;\n    this.label.setPosition(new Point(x, y));\n    this.label.setWidth(w);\n    if (this.label.height() > (this.height() - 50)) {\n        this.bounds.setHeight(this.label.height() + 50);\n    }\n\n    // list\n    y = this.label.bottom() + 2;\n    w = Math.min(\n        Math.floor(this.width() / 3),\n        this.list.listContents.width()\n    );\n\n    w -= this.edge;\n    b = this.bottom() - (2 * this.edge) -\n        MorphicPreferences.handleSize;\n    h = b - y;\n    this.list.setPosition(new Point(x, y));\n    this.list.setExtent(new Point(w, h));\n\n    // detail\n    x = this.list.right() + this.edge;\n    r = this.right() - this.edge;\n    w = r - x;\n    this.detail.setPosition(new Point(x, y));\n    this.detail.setExtent(new Point(w, (h * 2 / 3) - this.edge));\n\n    // work\n    y = this.detail.bottom() + this.edge;\n    this.work.setPosition(new Point(x, y));\n    this.work.setExtent(new Point(w, h / 3));\n\n    // properties button\n    x = this.list.left();\n    y = this.list.bottom() + this.edge;\n    w = this.list.width();\n    h = MorphicPreferences.handleSize;\n    this.buttonSubset.setPosition(new Point(x, y));\n    this.buttonSubset.setExtent(new Point(w, h));\n\n    // inspect button\n    x = this.detail.left();\n    w = this.detail.width() - this.edge -\n        MorphicPreferences.handleSize;\n    w = w / 3 - this.edge / 3;\n    this.buttonInspect.setPosition(new Point(x, y));\n    this.buttonInspect.setExtent(new Point(w, h));\n\n    // edit button\n    x = this.buttonInspect.right() + this.edge;\n    this.buttonEdit.setPosition(new Point(x, y));\n    this.buttonEdit.setExtent(new Point(w, h));\n\n    // close button\n    x = this.buttonEdit.right() + this.edge;\n    r = this.detail.right() - this.edge -\n        MorphicPreferences.handleSize;\n    w = r - x;\n    this.buttonClose.setPosition(new Point(x, y));\n    this.buttonClose.setExtent(new Point(w, h));\n\n    // resizer\n    this.resizer.fixLayout();\n};\n\n// InspectorMorph editing ops:\n\nInspectorMorph.prototype.save = function () {\n    var txt = this.detail.contents.children[0].text.toString(),\n        prop = this.list.selected;\n    try {\n        this.target.evaluateString('this.' + prop + ' = ' + txt);\n        this.hasUserEditedDetails = false;\n        this.target.changed();\n    } catch (err) {\n        this.inform(err);\n    }\n};\n\nInspectorMorph.prototype.addProperty = function () {\n    this.prompt(\n        'new property name:',\n        prop => {\n            if (prop) {\n                this.target[prop] = null;\n                this.buildPanes();\n                this.target.changed();\n            }\n        },\n        this,\n        'property'\n    );\n};\n\nInspectorMorph.prototype.renameProperty = function () {\n    var propertyName = this.list.selected;\n    this.prompt(\n        'property name:',\n        prop => {\n            try {\n                delete (this.target[propertyName]);\n                this.target[prop] = this.currentProperty;\n            } catch (err) {\n                this.inform(err);\n            }\n            this.buildPanes();\n            this.target.changed();\n        },\n        this,\n        propertyName\n    );\n};\n\nInspectorMorph.prototype.removeProperty = function () {\n    var prop = this.list.selected;\n    try {\n        delete (this.target[prop]);\n        this.currentProperty = null;\n        this.buildPanes();\n        this.target.changed();\n    } catch (err) {\n        this.inform(err);\n    }\n};\n\n// InspectorMorph stepping\n\nInspectorMorph.prototype.step = function () {\n    this.updateCurrentSelection();\n    var lbl = this.target.toString();\n    if (this.label.text === lbl) {return; }\n    this.label.text = lbl;\n    this.fixLayout();\n};\n\n// InspectorMorph duplicating:\n\nInspectorMorph.prototype.updateReferences = function (map) {\n    var active = this.list.activeIndex();\n    InspectorMorph.uber.updateReferences.call(this, map);\n    this.buildPanes();\n    this.list.activateIndex(active);\n};\n\n// MenuMorph ///////////////////////////////////////////////////////////\n\n// MenuMorph: referenced constructors\n\n\n\n// MenuMorph inherits from BoxMorph:\n\nMenuMorph.prototype = new BoxMorph();\nMenuMorph.prototype.constructor = MenuMorph;\nMenuMorph.uber = BoxMorph.prototype;\n\n// MenuMorph instance creation:\n\nexport function MenuMorph(target, title, environment, fontSize) {\n    this.init(target, title, environment, fontSize);\n\n    /*\n    if target is a function, use it as callback:\n    execute target as callback function with the action property\n    of the triggered MenuItem as argument.\n    Use the environment, if it is specified.\n    Note: if action is also a function, instead of becoming\n    the argument itself it will be called to answer the argument.\n    For selections, Yes/No Choices etc.\n\n    else (if target is not a function):\n\n        if action is a function:\n        execute the action with target as environment (can be null)\n        for lambdafied (inline) actions\n\n        else if action is a String:\n        treat it as function property of target and execute it\n        for selector-like actions\n    */\n}\n\nMenuMorph.prototype.init = function (target, title, environment, fontSize) {\n    // additional properties:\n    this.target = target;\n    this.title = title || null;\n    this.environment = environment || null;\n    this.fontSize = fontSize || null;\n    this.items = [];\n    this.label = null;\n    this.world = null;\n    this.isListContents = false;\n    this.hasFocus = false;\n    this.selection = null;\n    this.submenu = null;\n\n    // initialize inherited properties:\n    MenuMorph.uber.init.call(this);\n\n    // override inherited properties:\n    this.isDraggable = false;\n    this.noDropShadow = true;\n    this.fullShadowSource = false;\n\n    // immutable properties:\n    this.border = null;\n    this.edge = null;\n};\n\nMenuMorph.prototype.addItem = function (\n    labelString,\n    action,\n    hint,\n    color,\n    bold, // bool\n    italic, // bool\n    doubleClickAction, // optional, when used as list contents\n    shortcut, // optional string, icon (Morph or Canvas) or tuple [icon, string]\n    verbatim // optional bool, don't translate if true\n) {\n    /*\n    labelString is normally a single-line string. But it can also be one\n    of the following:\n\n        * a multi-line string (containing line breaks)\n        * an icon (either a Morph or a Canvas)\n        * a tuple of format: [icon, string]\n    */\n    this.items.push([\n        verbatim ? labelString || 'close' : localize(labelString || 'close'),\n        action === 0 ? 0 : action || nop,\n        hint,\n        color,\n        bold || false,\n        italic || false,\n        doubleClickAction,\n        shortcut,\n        verbatim]);\n};\n\nMenuMorph.prototype.addMenu = function (label, aMenu, indicator, verbatim) {\n    this.addPair(\n        label,\n        aMenu,\n        isNil(indicator) ? '\\u25ba' : indicator,\n        null,\n        verbatim // don't translate\n    );\n};\n\nMenuMorph.prototype.addPair = function (\n    label,\n    action,\n    shortcut,\n    hint,\n    verbatim // don't translate\n) {\n    this.addItem(\n        label,\n        action,\n        hint,\n        null,\n        null,\n        null,\n        null,\n        shortcut,\n        verbatim\n    );\n};\n\nMenuMorph.prototype.addLine = function (width) {\n    this.items.push([0, width || 1]);\n};\n\nMenuMorph.prototype.createLabel = function () {\n    var text;\n    if (this.label !== null) {\n        this.label.destroy();\n    }\n    text = new TextMorph(\n        localize(this.title),\n        this.fontSize || MorphicPreferences.menuFontSize,\n        MorphicPreferences.menuFontName,\n        true,\n        false,\n        'center'\n    );\n    text.alignment = 'center';\n    text.color = WHITE;\n    text.backgroundColor = this.borderColor;\n    text.fixLayout();\n    this.label = new BoxMorph(3, 0);\n    if (MorphicPreferences.isFlat) {\n        this.label.edge = 0;\n    }\n    this.label.color = this.borderColor;\n    this.label.borderColor = this.borderColor;\n    this.label.setExtent(text.extent().add(4));\n    this.label.add(text);\n    this.label.text = text;\n};\n\nMenuMorph.prototype.createItems = function () {\n    var item,\n        fb,\n        x,\n        y,\n        isLine = false;\n\n    this.children.forEach(m => m.destroy());\n    this.children = [];\n    if (!this.isListContents) {\n        this.edge = MorphicPreferences.isFlat ? 0 : 5;\n        this.border = MorphicPreferences.isFlat ? 1 : 2;\n    }\n    this.color = WHITE;\n    this.borderColor = new Color(60, 60, 60);\n    this.setExtent(new Point(0, 0));\n\n    y = 2;\n    x = this.left() + 4;\n    if (!this.isListContents) {\n        if (this.title) {\n            this.createLabel();\n            this.label.setPosition(this.bounds.origin.add(4));\n            this.add(this.label);\n            y = this.label.bottom();\n        } else {\n            y = this.top() + 4;\n        }\n    }\n    y += 1;\n    this.items.forEach(tuple => {\n        isLine = false;\n        if (tuple instanceof StringFieldMorph ||\n                tuple instanceof ColorPickerMorph ||\n                tuple instanceof SliderMorph ||\n                tuple instanceof DialMorph) {\n            item = tuple;\n        } else if (tuple[0] === 0) {\n            isLine = true;\n            item = new Morph();\n            item.color = this.borderColor;\n            item.setHeight(tuple[1]);\n        } else {\n            item = new MenuItemMorph(\n                this.target,\n                tuple[1],\n                tuple[0],\n                this.fontSize || MorphicPreferences.menuFontSize,\n                MorphicPreferences.menuFontName,\n                this.environment,\n                tuple[2], // bubble help hint\n                tuple[3], // color\n                tuple[4], // bold\n                tuple[5], // italic\n                tuple[6], // doubleclick action\n                tuple[7] // shortcut\n            );\n        }\n        if (isLine) {\n            y += 1;\n        }\n        item.setPosition(new Point(x, y));\n        this.add(item);\n        y = y + item.height();\n        if (isLine) {\n            y += 1;\n        }\n    });\n\n    fb = this.fullBounds();\n    this.setExtent(fb.extent().add(4));\n    this.adjustWidths();\n};\n\nMenuMorph.prototype.maxWidth = function () {\n    var w = 0;\n\n    if (this.parent instanceof FrameMorph) {\n        if (this.parent.scrollFrame instanceof ScrollFrameMorph) {\n            w = this.parent.scrollFrame.width();\n        }\n    }\n    this.children.forEach(item => {\n        if (item instanceof MenuItemMorph) {\n            w = Math.max(\n                w,\n                item.label.width() + 8 +\n                    (item.shortcut ? item.shortcut.width() + 4 : 0)\n            );\n        } else if ((item instanceof StringFieldMorph) ||\n                (item instanceof ColorPickerMorph) ||\n                (item instanceof SliderMorph) ||\n                (item instanceof DialMorph)) {\n            w = Math.max(w, item.width());\n        }\n    });\n    if (this.label) {\n        w = Math.max(w, this.label.width());\n    }\n    return w;\n};\n\nMenuMorph.prototype.adjustWidths = function () {\n    var w = this.maxWidth();\n    this.children.forEach(item => {\n    \tif (!(item instanceof DialMorph)) {\n            item.setWidth(w);\n        }\n        item.fixLayout();\n        if (item === this.label) {\n            item.text.setPosition(\n                item.center().subtract(\n                    item.text.extent().floorDivideBy(2)\n                )\n            );\n        }\n    });\n};\n\nMenuMorph.prototype.unselectAllItems = function () {\n    this.children.forEach(item => {\n        if (item instanceof MenuItemMorph) {\n            if (item.userState !== 'normal') {\n                item.userState = 'normal';\n                item.rerender();\n            }\n        } else if (item instanceof ScrollFrameMorph) {\n        \titem.contents.children.forEach(morph => {\n         \t\tif (morph instanceof MenuItemMorph &&\n                        morph.userState !== 'normal') {\n                    morph.userState = 'normal';\n                    morph.rerender();\n              \t}\n         \t});\n        }\n    });\n};\n\n// MenuMorph popping up\n\nMenuMorph.prototype.popup = function (world, pos) {\n\tvar scroller;\n\n    this.createItems();\n    this.setPosition(pos);\n    this.addShadow(new Point(2, 2), 80);\n    this.keepWithin(world);\n\n    if (this.bottom() > world.bottom()) {\n    \t// scroll menu items if the menu is taller than the world\n    \tthis.removeShadow();\n        scroller = this.scroll();\n        this.bounds.corner.y = world.bottom() - 2;\n        this.addShadow(new Point(2, 2), 80);\n        scroller.setHeight(world.bottom() - scroller.top() - 6);\n        scroller.adjustScrollBars(); // ?\n     }\n\n    if (world.activeMenu) {\n        world.activeMenu.destroy();\n    }\n    if (this.items.length < 1 && !this.title) { // don't show empty menus\n        return;\n    }\n    world.add(this);\n    world.activeMenu = this;\n    this.world = world; // optionally enable keyboard support\n    this.fullChanged();\n};\n\nMenuMorph.prototype.scroll = function () {\n    // private - move all items into a scroll frame\n    var scroller = new ScrollFrameMorph(),\n        start = this.label ? 1 : 0,\n        first = this.children[start];\n\n    scroller.setPosition(first.position());\n    this.children.slice(start).forEach(morph => scroller.addContents(morph));\n    this.add(scroller);\n    scroller.setWidth(first.width());\n    return scroller;\n};\n\nMenuMorph.prototype.popUpAtHand = function (world) {\n    var wrrld = world || this.world;\n    this.popup(wrrld, wrrld.hand.position());\n};\n\nMenuMorph.prototype.popUpCenteredAtHand = function (world) {\n    var wrrld = world || this.world;\n    this.fixLayout();\n    this.popup(\n        wrrld,\n        wrrld.hand.position().subtract(\n            this.extent().floorDivideBy(2)\n        )\n    );\n};\n\nMenuMorph.prototype.popUpCenteredInWorld = function (world) {\n    var wrrld = world || this.world;\n    this.fixLayout();\n    this.popup(\n        wrrld,\n        wrrld.center().subtract(\n            this.extent().floorDivideBy(2)\n        )\n    );\n};\n\n// MenuMorph submenus\n\nMenuMorph.prototype.closeRootMenu = function () {\n    if (this.parent instanceof MenuMorph) {\n        this.parent.closeRootMenu();\n    } else {\n        this.destroy();\n    }\n};\n\nMenuMorph.prototype.closeSubmenu = function () {\n    if (this.submenu) {\n        this.submenu.destroy();\n        this.submenu = null;\n        this.unselectAllItems();\n        this.world.activeMenu = this;\n    }\n};\n\n// MenuMorph keyboard accessibility\n\nMenuMorph.prototype.getFocus = function () {\n    this.world.keyboardFocus = this;\n    this.selection = null;\n    this.selectFirst();\n    this.hasFocus = true;\n};\n\nMenuMorph.prototype.processKeyDown = function (event) {\n    // console.log(event.keyCode);\n    switch (event.keyCode) {\n    case 13: // 'enter'\n    case 32: // 'space'\n        if (this.selection) {\n            this.selection.mouseClickLeft();\n            if (this.submenu) {\n                this.submenu.getFocus();\n            }\n        }\n        return;\n    case 27: // 'esc'\n        return this.destroy();\n    case 37: // 'left arrow'\n        return this.leaveSubmenu();\n    case 38: // 'up arrow'\n        return this.selectUp();\n    case 39: // 'right arrow'\n        return this.enterSubmenu();\n    case 40: // 'down arrow'\n        return this.selectDown();\n    default:\n        nop();\n    }\n};\n\nMenuMorph.prototype.processKeyUp = function (event) {\n    nop(event);\n};\n\nMenuMorph.prototype.processKeyPress = function (event) {\n    nop(event);\n};\n\nMenuMorph.prototype.selectFirst = function () {\n    var scroller, items, i;\n\n    scroller = detect(\n        this.children,\n        morph => morph instanceof ScrollFrameMorph\n    );\n    items = scroller ? scroller.contents.children : this.children;\n    for (i = 0; i < items.length; i += 1) {\n        if (items[i] instanceof MenuItemMorph) {\n            this.select(items[i]);\n            return;\n    \t}\n\t}\n};\n\nMenuMorph.prototype.selectUp = function () {\n    var scroller, triggers, idx;\n\n\tscroller = detect(\n        this.children,\n        morph => morph instanceof ScrollFrameMorph\n    );\n    triggers = (scroller ? scroller.contents.children : this.children).filter(\n    \teach => each instanceof MenuItemMorph\n    );\n    if (!this.selection) {\n        if (triggers.length) {\n            this.select(triggers[0]);\n        }\n        return;\n    }\n    idx = triggers.indexOf(this.selection) - 1;\n    if (idx < 0) {\n        idx = triggers.length - 1;\n    }\n    this.select(triggers[idx]);\n};\n\nMenuMorph.prototype.selectDown = function () {\n    var scroller, triggers, idx;\n\n    scroller = detect(\n        this.children,\n        morph => morph instanceof ScrollFrameMorph\n    );\n    triggers = (scroller ? scroller.contents.children : this.children).filter(\n        each => each instanceof MenuItemMorph\n    );\n    if (!this.selection) {\n        if (triggers.length) {\n            this.select(triggers[0]);\n        }\n        return;\n    }\n    idx = triggers.indexOf(this.selection) + 1;\n    if (idx >= triggers.length) {\n        idx = 0;\n    }\n    this.select(triggers[idx]);\n};\n\nMenuMorph.prototype.enterSubmenu = function () {\n    if (this.selection && this.selection.action instanceof MenuMorph) {\n        this.selection.popUpSubmenu();\n        if (this.submenu) {\n            this.submenu.getFocus();\n        }\n    }\n};\n\nMenuMorph.prototype.leaveSubmenu = function () {\n    var menu = this.parent;\n    if (this.parent instanceof MenuMorph) {\n        menu.submenu = null;\n        menu.hasFocus = true;\n        this.destroy();\n        menu.world.keyboardFocus = menu;\n        menu.world.activeMenu = menu;\n    }\n};\n\nMenuMorph.prototype.select = function (aMenuItem) {\n    this.unselectAllItems();\n    aMenuItem.userState = 'highlight';\n    aMenuItem.rerender();\n    aMenuItem.scrollIntoView();\n    this.selection = aMenuItem;\n};\n\nMenuMorph.prototype.destroy = function () {\n    if (this.hasFocus) {\n        this.world.keyboardFocus = null;\n    }\n    if (!this.isListContents) {\n        this.world.activeMenu = null;\n    }\n    MenuMorph.uber.destroy.call(this);\n};\n\n// StringMorph /////////////////////////////////////////////////////////\n\n// I am a single line of text\n\n// StringMorph inherits from Morph:\n\nStringMorph.prototype = new Morph();\nStringMorph.prototype.constructor = StringMorph;\nStringMorph.uber = Morph.prototype;\n\n// StringMorph shared properties:\n\n// context for measuring text dimensions, used by StringMorphs and TextMorphs\nStringMorph.prototype.measureCtx = newCanvas().getContext(\"2d\");\n\n// StringMorph instance creation:\n\nexport function StringMorph(\n    text,\n    fontSize,\n    fontStyle,\n    bold,\n    italic,\n    isNumeric,\n    shadowOffset,\n    shadowColor,\n    color,\n    fontName\n) {\n    this.init(\n        text,\n        fontSize,\n        fontStyle,\n        bold,\n        italic,\n        isNumeric,\n        shadowOffset,\n        shadowColor,\n        color,\n        fontName\n    );\n}\n\nStringMorph.prototype.init = function (\n    text,\n    fontSize,\n    fontStyle,\n    bold,\n    italic,\n    isNumeric,\n    shadowOffset,\n    shadowColor,\n    color,\n    fontName\n) {\n    // additional properties:\n    this.text = text || ((text === '') ? '' : 'StringMorph');\n    this.fontSize = fontSize || 12;\n    this.fontName = fontName || MorphicPreferences.globalFontFamily;\n    this.fontStyle = fontStyle || 'sans-serif';\n    this.isBold = bold || false;\n    this.isItalic = italic || false;\n    this.isEditable = false;\n    this.enableLinks = false; // set to \"true\" if I can contain clickable URLs\n    this.isNumeric = isNumeric || false;\n    this.isPassword = false;\n    this.shadowOffset = shadowOffset || ZERO;\n    this.shadowColor = shadowColor || null;\n    this.isShowingBlanks = false;\n    this.blanksColor = new Color(180, 140, 140);\n\n    // additional properties for text-editing:\n    this.isScrollable = true; // scrolls into view when edited\n    this.currentlySelecting = false;\n    this.startMark = 0;\n    this.endMark = 0;\n    this.markedTextColor = WHITE;\n    this.markedBackgoundColor = new Color(60, 60, 120);\n\n    // initialize inherited properties:\n    StringMorph.uber.init.call(this, true);\n\n    // override inherited properites:\n    this.color = color || new Color(0, 0, 0);\n    this.fixLayout(); // determine my extent\n};\n\nStringMorph.prototype.toString = function () {\n    // e.g. 'a StringMorph(\"Hello World\")'\n    return 'a ' +\n        (this.constructor.name ||\n            this.constructor.toString().split(' ')[1].split('(')[0]) +\n        '(\"' + this.text.slice(0, 30) + '...\")';\n};\n\nStringMorph.prototype.password = function (letter, length) {\n    var ans = '',\n        i;\n    for (i = 0; i < length; i += 1) {\n        ans += letter;\n    }\n    return ans;\n};\n\nStringMorph.prototype.font = function () {\n    // answer a font string, e.g. 'bold italic 12px sans-serif'\n    var font = '';\n    if (this.isBold) {\n        font = font + 'bold ';\n    }\n    if (this.isItalic) {\n        font = font + 'italic ';\n    }\n    return font +\n        this.fontSize + 'px ' +\n        (this.fontName ? this.fontName + ', ' : '') +\n        this.fontStyle;\n};\n\nStringMorph.prototype.getShadowRenderColor = function () {\n    // answer the shadow rendering color, can be overridden for my children\n    return this.shadowColor;\n};\n\nStringMorph.prototype.fixLayout = function (justMe) {\n    // determine my extent depending on my current settings\n    var width,\n        shadowOffset = this.shadowOffset || ZERO,\n        txt = this.isPassword ?\n            this.password('*', this.text.length) : this.text;\n\n    this.measureCtx.font = this.font();\n    width = Math.max(\n        this.measureCtx.measureText(txt).width + Math.abs(shadowOffset.x),\n        1\n    );\n    this.bounds.corner = this.bounds.origin.add(\n        new Point(\n            width,\n            fontHeight(this.fontSize) + Math.abs(shadowOffset.y)\n        )\n    );\n\n    // notify my parent of layout change\n    if (!justMe && this.parent) {\n        if (this.parent.fixLayout) {\n            this.parent.fixLayout();\n        }\n    }\n};\n\nStringMorph.prototype.render = function (ctx) {\n    var start, stop, i, p, c, x, y,\n        shadowOffset = this.shadowOffset || ZERO,\n        shadowColor = this.getShadowRenderColor(),\n        txt = this.isPassword ?\n                this.password('*', this.text.length) : this.text;\n\n    // prepare context for drawing text\n    ctx.font = this.font();\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'bottom';\n\n    // first draw the shadow, if any\n    if (shadowColor) {\n        x = Math.max(shadowOffset.x, 0);\n        y = Math.max(shadowOffset.y, 0);\n        ctx.fillStyle = shadowColor.toString();\n        ctx.fillText(txt, x, fontHeight(this.fontSize) + y);\n    }\n\n    // now draw the actual text\n    x = Math.abs(Math.min(shadowOffset.x, 0));\n    y = Math.abs(Math.min(shadowOffset.y, 0));\n    ctx.fillStyle = this.getRenderColor().toString();\n\n    if (this.isShowingBlanks) {\n        this.renderWithBlanks(\n            ctx,\n            x,\n            fontHeight(this.fontSize) + y\n        );\n    } else {\n        ctx.fillText(\n            txt,\n            x,\n            fontHeight(this.fontSize) + y\n        );\n    }\n\n    // draw the selection\n    start = Math.min(this.startMark, this.endMark);\n    stop = Math.max(this.startMark, this.endMark);\n    for (i = start; i < stop; i += 1) {\n        p = this.slotPosition(i).subtract(this.position());\n        c = txt.charAt(i);\n        ctx.fillStyle = this.markedBackgoundColor.toString();\n        ctx.fillRect(p.x, p.y, ctx.measureText(c).width + 1 + x,\n            fontHeight(this.fontSize) + y);\n        ctx.fillStyle = this.markedTextColor.toString();\n        ctx.fillText(c, p.x, fontHeight(this.fontSize) + p.y);\n    }\n};\n\nStringMorph.prototype.renderWithBlanks = function (ctx, startX, y) {\n    var space = ctx.measureText(' ').width,\n        blanksColor = this.blanksColor.toString(),\n        top = y - this.height() / 2,\n        words = this.text.split(' '),\n        x = startX || 0,\n        isFirst = true;\n\n    function drawBlank() {\n        ctx.fillStyle = blanksColor;\n        ctx.beginPath();\n        ctx.arc(\n            x + space / 2,\n            top,\n            space / 2,\n            radians(0),\n            radians(360)\n        );\n        ctx.fill();\n        x += space;\n    }\n\n    // render my text inserting blanks\n    words.forEach(word => {\n        if (!isFirst) {\n            drawBlank();\n        }\n        isFirst = false;\n        if (word !== '') {\n            ctx.fillStyle = this.getRenderColor().toString();\n            ctx.fillText(word, x, y);\n            x += ctx.measureText(word).width;\n        }\n    });\n};\n\n// StringMorph measuring:\n\nStringMorph.prototype.slotPosition = function (slot) {\n    // answer the position point of the given index (\"slot\")\n    // where the cursor should be placed\n    var txt = this.isPassword ?\n                this.password('*', this.text.length) : this.text,\n        dest = Math.min(Math.max(slot, 0), txt.length);\n\n    this.measureCtx.font = this.font();\n    this.pos = dest;\n    return new Point(\n        this.left() + this.measureCtx.measureText(txt.slice(0, dest)).width,\n        this.top()\n    );\n};\n\nStringMorph.prototype.slotAt = function (aPoint) {\n    // answer the slot (index) closest to the given point taking\n    // in account how far from the middle of the character it is,\n    // so the cursor can be moved accordingly\n\n    var txt = this.isPassword ?\n                this.password('*', this.text.length) : this.text,\n        idx = 0,\n        charX = 0;\n\n    this.measureCtx.font = this.font();\n    while (aPoint.x - this.left() > charX) {\n        charX += this.measureCtx.measureText(txt[idx]).width;\n        idx += 1;\n        if (idx === txt.length) {\n            if ((this.measureCtx.measureText(txt).width -\n                    (this.measureCtx.measureText(txt[idx - 1]).width / 2)) <\n                    (aPoint.x - this.left())) {\n                return idx;\n            }\n        }\n    }\n\n    // see where our click fell with respect to the middle of the char\n    if (aPoint.x - this.left() >\n            charX - this.measureCtx.measureText(txt[idx - 1]).width / 2) {\n        return idx;\n    } else {\n        return idx - 1;\n    }\n};\n\nStringMorph.prototype.upFrom = function (slot) {\n    // answer the slot above the given one\n    return slot;\n};\n\nStringMorph.prototype.downFrom = function (slot) {\n    // answer the slot below the given one\n    return slot;\n};\n\nStringMorph.prototype.startOfLine = function () {\n    // answer the first slot (index) of the line for the given slot\n    return 0;\n};\n\nStringMorph.prototype.endOfLine = function () {\n    // answer the slot (index) indicating the EOL for the given slot\n    return this.text.length;\n};\n\nStringMorph.prototype.previousWordFrom = function (aSlot) {\n    // answer the slot (index) slots indicating the position of the\n    // previous word to the left of aSlot\n    var index = aSlot - 1;\n\n    // while the current character is non-word one, we skip it, so that\n    // if we are in the middle of a non-alphanumeric sequence, we'll get\n    // right to the beginning of the previous word\n    while (index > 0 && !isWordChar(this.text[index])) {\n        index -= 1;\n    }\n\n    // while the current character is a word one, we skip it until we\n    // find the beginning of the current word\n    while (index > 0 && isWordChar(this.text[index - 1])) {\n        index -= 1;\n    }\n\n    return index;\n};\n\nStringMorph.prototype.nextWordFrom = function (aSlot) {\n    var index = aSlot;\n\n    while (index < this.endOfLine() && !isWordChar(this.text[index])) {\n        index += 1;\n    }\n\n    while (index < this.endOfLine() && isWordChar(this.text[index])) {\n        index += 1;\n    }\n\n    return index;\n};\n\nStringMorph.prototype.rawHeight = function () {\n    // answer my corrected fontSize\n    return this.height() / 1.2;\n};\n\n// StringMorph menus:\n\nStringMorph.prototype.developersMenu = function () {\n    var menu = StringMorph.uber.developersMenu.call(this);\n\n    menu.addLine();\n    menu.addItem(\"edit\", 'edit');\n    menu.addItem(\n        \"font size...\",\n        () => {\n            this.prompt(\n                menu.title + '\\nfont\\nsize:',\n                this.setFontSize,\n                this,\n                this.fontSize.toString(),\n                null,\n                6,\n                500,\n                true\n            );\n        },\n        'set this String\\'s\\nfont point size'\n    );\n    if (this.fontStyle !== 'serif') {\n        menu.addItem(\"serif\", 'setSerif');\n    }\n    if (this.fontStyle !== 'sans-serif') {\n        menu.addItem(\"sans-serif\", 'setSansSerif');\n    }\n    if (this.isBold) {\n        menu.addItem(\"normal weight\", 'toggleWeight');\n    } else {\n        menu.addItem(\"bold\", 'toggleWeight');\n    }\n    if (this.isItalic) {\n        menu.addItem(\"normal style\", 'toggleItalic');\n    } else {\n        menu.addItem(\"italic\", 'toggleItalic');\n    }\n    if (this.isShowingBlanks) {\n        menu.addItem(\"hide blanks\", 'toggleShowBlanks');\n    } else {\n        menu.addItem(\"show blanks\", 'toggleShowBlanks');\n    }\n    if (this.isPassword) {\n        menu.addItem(\"show characters\", 'toggleIsPassword');\n    } else {\n        menu.addItem(\"hide characters\", 'toggleIsPassword');\n    }\n    return menu;\n};\n\nStringMorph.prototype.toggleIsDraggable = function () {\n    // for context menu demo purposes\n    this.isDraggable = !this.isDraggable;\n    if (this.isDraggable) {\n        this.disableSelecting();\n    } else {\n        this.enableSelecting();\n    }\n};\n\nStringMorph.prototype.toggleShowBlanks = function () {\n    this.isShowingBlanks = !this.isShowingBlanks;\n    this.changed();\n    this.fixLayout();\n    this.rerender();\n};\n\nStringMorph.prototype.toggleWeight = function () {\n    this.isBold = !this.isBold;\n    this.changed();\n    this.fixLayout();\n    this.rerender();\n};\n\nStringMorph.prototype.toggleItalic = function () {\n    this.isItalic = !this.isItalic;\n    this.changed();\n    this.fixLayout();\n    this.rerender();\n};\n\nStringMorph.prototype.toggleIsPassword = function () {\n    this.isPassword = !this.isPassword;\n    this.changed();\n    this.fixLayout();\n    this.rerender();\n};\n\nStringMorph.prototype.setSerif = function () {\n    this.fontStyle = 'serif';\n    this.changed();\n    this.fixLayout();\n    this.rerender();\n};\n\nStringMorph.prototype.setSansSerif = function () {\n    this.fontStyle = 'sans-serif';\n    this.changed();\n    this.fixLayout();\n    this.rerender();\n};\n\nStringMorph.prototype.setFontSize = function (size) {\n    // for context menu demo purposes\n    var newSize;\n    if (typeof size === 'number') {\n        this.fontSize = Math.round(Math.min(Math.max(size, 4), 500));\n    } else {\n        newSize = parseFloat(size);\n        if (!isNaN(newSize)) {\n            this.fontSize = Math.round(\n                Math.min(Math.max(newSize, 4), 500)\n            );\n        }\n    }\n    this.changed();\n    this.fixLayout();\n    this.rerender();\n};\n\nStringMorph.prototype.setText = function (size) {\n    // for context menu demo purposes\n    this.text = Math.round(size).toString();\n    this.changed();\n    this.fixLayout();\n    this.rerender();\n};\n\nStringMorph.prototype.numericalSetters = function () {\n    // for context menu demo purposes\n    return [\n        'setLeft',\n        'setTop',\n        'setAlphaScaled',\n        'setFontSize',\n        'setText'\n    ];\n};\n\n// StringMorph editing:\n\nStringMorph.prototype.edit = function () {\n    this.root().edit(this);\n};\n\nStringMorph.prototype.selection = function () {\n    var start, stop;\n    start = Math.min(this.startMark, this.endMark);\n    stop = Math.max(this.startMark, this.endMark);\n    return this.text.slice(start, stop);\n};\n\nStringMorph.prototype.selectionStartSlot = function () {\n    return Math.min(this.startMark, this.endMark);\n};\n\nStringMorph.prototype.clearSelection = function () {\n    if (!this.currentlySelecting &&\n            isNil(this.startMark) &&\n            isNil(this.endMark)) {\n        return;\n    }\n    this.currentlySelecting = false;\n    this.startMark = null;\n    this.endMark = null;\n    this.changed();\n};\n\nStringMorph.prototype.deleteSelection = function () {\n    var start, stop, text;\n    text = this.text;\n    start = Math.min(this.startMark, this.endMark);\n    stop = Math.max(this.startMark, this.endMark);\n    this.text = text.slice(0, start) + text.slice(stop);\n    this.changed();\n    this.clearSelection();\n};\n\nStringMorph.prototype.selectAll = function () {\n    var cursor;\n    if (this.isEditable) {\n        this.startMark = 0;\n        cursor = this.root().cursor;\n        this.endMark = this.text.length;\n        if (cursor) {\n            cursor.gotoSlot(this.text.length);\n            cursor.syncTextareaSelectionWith(this);\n        }\n        this.fixLayout();\n        this.rerender();\n    }\n};\n\nStringMorph.prototype.mouseDownLeft = function (pos) {\n    if (this.world().currentKey === 16) {\n        this.shiftClick(pos);\n    } else if (this.isEditable) {\n        this.clearSelection();\n    } else {\n        this.escalateEvent('mouseDownLeft', pos);\n    }\n};\n\nStringMorph.prototype.shiftClick = function (pos) {\n    var cursor = this.root().cursor;\n\n    if (cursor) {\n        if (!this.startMark) {\n            this.startMark = cursor.slot;\n        }\n        cursor.gotoPos(pos);\n        this.endMark = cursor.slot;\n        cursor.syncTextareaSelectionWith(this);\n        this.changed();\n    }\n    this.currentlySelecting = false;\n    this.escalateEvent('mouseDownLeft', pos);\n};\n\nStringMorph.prototype.mouseClickLeft = function (pos) {\n    var cursor,\n        slot,\n        clickedText,\n        startMark,\n        endMark;\n\n    if (this.isEditable) {\n        if (!this.currentlySelecting) {\n            this.edit(); // creates a new cursor\n        }\n        cursor = this.root().cursor;\n        if (cursor) {\n            cursor.gotoPos(pos);\n        }\n        this.currentlySelecting = true;\n    } else if (this.enableLinks) {\n        slot = this.slotAt(pos);\n        if (slot === this.text.length) {\n            slot -= 1;\n        }\n        startMark = slot;\n        while (startMark > 1 && isURLChar(this.text[startMark-1])) {\n            startMark -= 1;\n        }\n        endMark = slot;\n        while (endMark < this.text.length - 1 &&\n                isURLChar(this.text[endMark + 1])) {\n            endMark += 1;\n        }\n        clickedText = this.text.substring(startMark, endMark + 1);\n        if (isURL(clickedText)) {\n            window.open(clickedText, '_blank');\n        } else {\n            this.escalateEvent('mouseClickLeft', pos);\n        }\n    } else {\n        this.escalateEvent('mouseClickLeft', pos);\n    }\n};\n\nStringMorph.prototype.mouseDoubleClick = function (pos) {\n    // selects the word at pos\n    // if there is no word, we select whatever is between\n    // the previous and next words\n    var slot = this.slotAt(pos);\n\n    if (this.isEditable) {\n        this.edit();\n\n        if (slot === this.text.length) {\n            slot -= 1;\n        }\n\n        if (this.text[slot] && isWordChar(this.text[slot])) {\n            this.selectWordAt(slot);\n        } else if (this.text[slot]) {\n            this.selectBetweenWordsAt(slot);\n        } else {\n            // special case for when we click right after the\n            // last slot in multi line TextMorphs\n            this.selectAll();\n        }\n        this.root().cursor.syncTextareaSelectionWith(this);\n    } else {\n        this.escalateEvent('mouseDoubleClick', pos);\n    }\n};\n\nStringMorph.prototype.selectWordAt = function (slot) {\n    var cursor = this.root().cursor;\n\n    if (slot === 0 || isWordChar(this.text[slot - 1])) {\n        cursor.gotoSlot(this.previousWordFrom(slot));\n        this.startMark = cursor.slot;\n        this.endMark = this.nextWordFrom(cursor.slot);\n    } else {\n        cursor.gotoSlot(slot);\n        this.startMark = slot;\n        this.endMark = this.nextWordFrom(slot);\n    }\n    this.changed();\n};\n\nStringMorph.prototype.selectBetweenWordsAt = function (slot) {\n    var cursor = this.root().cursor;\n\n    cursor.gotoSlot(this.nextWordFrom(this.previousWordFrom(slot)));\n    this.startMark = cursor.slot;\n    this.endMark = cursor.slot;\n\n    while (this.endMark < this.text.length\n            && !isWordChar(this.text[this.endMark])) {\n        this.endMark += 1;\n    }\n    this.changed();\n};\n\nStringMorph.prototype.enableSelecting = function () {\n    this.mouseDownLeft = function (pos) {\n        var crs = this.root().cursor,\n            already = crs ? crs.target === this : false;\n        if (this.world().currentKey === 16) {\n            this.shiftClick(pos);\n        } else {\n            this.clearSelection();\n            if (this.isEditable && (!this.isDraggable)) {\n                this.edit();\n                this.root().cursor.gotoPos(pos);\n                this.startMark = this.slotAt(pos);\n                this.endMark = this.startMark;\n                this.currentlySelecting = true;\n                this.root().cursor.syncTextareaSelectionWith(this);\n                if (!already) {this.escalateEvent('mouseDownLeft', pos); }\n            }\n        }\n    };\n    this.mouseMove = function (pos) {\n        if (this.isEditable &&\n                this.currentlySelecting &&\n                (!this.isDraggable)) {\n            var newMark = this.slotAt(pos);\n            if (newMark !== this.endMark) {\n                this.endMark = newMark;\n                this.root().cursor.syncTextareaSelectionWith(this);\n                this.changed();\n            }\n        }\n    };\n};\n\nStringMorph.prototype.disableSelecting = function () {\n    this.mouseDownLeft = StringMorph.prototype.mouseDownLeft;\n    delete this.mouseMove;\n};\n\n// TextMorph ////////////////////////////////////////////////////////////////\n\n// I am a multi-line, word-wrapping String, quasi-inheriting from StringMorph\n\n// TextMorph inherits from Morph:\n\nTextMorph.prototype = new Morph();\nTextMorph.prototype.constructor = TextMorph;\nTextMorph.uber = Morph.prototype;\n\n// TextMorph shared properties:\n\n// context for measuring text dimensions, shared with StringMorph prototype\nTextMorph.prototype.measureCtx = StringMorph.prototype.measureCtx;\n\n// TextMorph instance creation:\n\nexport function TextMorph(\n    text,\n    fontSize,\n    fontStyle,\n    bold,\n    italic,\n    alignment,\n    width,\n    fontName,\n    shadowOffset,\n    shadowColor\n) {\n    this.init(text,\n        fontSize,\n        fontStyle,\n        bold,\n        italic,\n        alignment,\n        width,\n        fontName,\n        shadowOffset,\n        shadowColor);\n}\n\nTextMorph.prototype.init = function (\n    text,\n    fontSize,\n    fontStyle,\n    bold,\n    italic,\n    alignment,\n    width,\n    fontName,\n    shadowOffset,\n    shadowColor\n) {\n    // additional properties:\n    this.text = text || (text === '' ? text : 'TextMorph');\n    this.words = [];\n    this.lines = [];\n    this.lineSlots = [];\n    this.fontSize = fontSize || 12;\n    this.fontName = fontName || MorphicPreferences.globalFontFamily;\n    this.fontStyle = fontStyle || 'sans-serif';\n    this.isBold = bold || false;\n    this.isItalic = italic || false;\n    this.alignment = alignment || 'left';\n    this.shadowOffset = shadowOffset || ZERO;\n    this.shadowColor = shadowColor || null;\n    this.maxWidth = width || 0;\n    this.maxLineWidth = 0;\n    this.backgroundColor = null;\n    this.isEditable = false;\n    this.enableLinks = false; // set to \"true\" if I can contain clickable URLs\n\n    //additional properties for ad-hoc evaluation:\n    this.receiver = null;\n\n    // additional properties for text-editing:\n    this.isScrollable = true; // scrolls into view when edited\n    this.currentlySelecting = false;\n    this.startMark = 0;\n    this.endMark = 0;\n    this.markedTextColor = WHITE;\n    this.markedBackgoundColor = new Color(60, 60, 120);\n\n    // initialize inherited properties:\n    TextMorph.uber.init.call(this);\n\n    // override inherited properites:\n    this.color = new Color(0, 0, 0);\n    this.fixLayout(); // determine my extent\n};\n\nTextMorph.prototype.toString = function () {\n    // e.g. 'a TextMorph(\"Hello World\")'\n    return 'a TextMorph' + '(\"' + this.text.slice(0, 30) + '...\")';\n};\n\nTextMorph.prototype.font = StringMorph.prototype.font;\n\nTextMorph.prototype.parse = function () {\n    var paragraphs = this.text.split('\\n'),\n        context = this.measureCtx,\n        oldline = '',\n        newline,\n        w,\n        slot = 0;\n\n    context.font = this.font();\n    this.maxLineWidth = 0;\n    this.lines = [];\n    this.lineSlots = [0];\n    this.words = [];\n\n    paragraphs.forEach(p => {\n        this.words = this.words.concat(p.split(' '));\n        this.words.push('\\n');\n    });\n\n    this.words.forEach(word => {\n        if (word === '\\n') {\n            this.lines.push(oldline);\n            this.lineSlots.push(slot);\n            this.maxLineWidth = Math.max(\n                this.maxLineWidth,\n                context.measureText(oldline).width\n            );\n            oldline = '';\n        } else {\n            if (this.maxWidth > 0) {\n                newline = oldline + word + ' ';\n                w = context.measureText(newline).width;\n                if (w > this.maxWidth) {\n                    this.lines.push(oldline);\n                    this.lineSlots.push(slot);\n                    this.maxLineWidth = Math.max(\n                        this.maxLineWidth,\n                        context.measureText(oldline).width\n                    );\n                    oldline = word + ' ';\n                } else {\n                    oldline = newline;\n                }\n            } else {\n                oldline = oldline + word + ' ';\n            }\n            slot += word.length + 1;\n        }\n    });\n};\n\nTextMorph.prototype.fixLayout = function () {\n    // determine my extent depending on my current settings\n    var height, shadowHeight, shadowWidth;\n\n    this.parse();\n\n    // set my extent\n    shadowWidth = Math.abs(this.shadowOffset.x);\n    shadowHeight = Math.abs(this.shadowOffset.y);\n    height = this.lines.length * (fontHeight(this.fontSize) + shadowHeight);\n    if (this.maxWidth === 0) {\n        this.bounds = this.bounds.origin.extent(\n            new Point(this.maxLineWidth + shadowWidth, height)\n        );\n    } else {\n        this.bounds = this.bounds.origin.extent(\n            new Point(this.maxWidth + shadowWidth, height)\n        );\n    }\n\n    // notify my parent of layout change\n    if (this.parent) {\n        if (this.parent.layoutChanged) {\n            this.parent.layoutChanged();\n        }\n    }\n};\n\nTextMorph.prototype.render = function (ctx) {\n    var shadowWidth = Math.abs(this.shadowOffset.x),\n        shadowHeight = Math.abs(this.shadowOffset.y),\n        shadowColor = this.getShadowRenderColor(),\n        i, line, width, offx, offy, x, y, start, stop, p, c;\n\n    // prepare context for drawing text\n    ctx.font = this.font();\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'bottom';\n\n    // fill the background, if desired\n    if (this.backgroundColor) {\n        ctx.fillStyle = this.backgroundColor.toString();\n        ctx.fillRect(0, 0, this.width(), this.height());\n    }\n\n    // draw the shadow, if any\n    if (shadowColor) {\n        offx = Math.max(this.shadowOffset.x, 0);\n        offy = Math.max(this.shadowOffset.y, 0);\n        ctx.fillStyle = shadowColor.toString();\n\n        for (i = 0; i < this.lines.length; i = i + 1) {\n            line = this.lines[i];\n            width = ctx.measureText(line).width + shadowWidth;\n            if (this.alignment === 'right') {\n                x = this.width() - width;\n            } else if (this.alignment === 'center') {\n                x = (this.width() - width) / 2;\n            } else { // 'left'\n                x = 0;\n            }\n            y = (i + 1) * (fontHeight(this.fontSize) + shadowHeight)\n                - shadowHeight;\n            ctx.fillText(line, x + offx, y + offy);\n        }\n    }\n\n    // now draw the actual text\n    offx = Math.abs(Math.min(this.shadowOffset.x, 0));\n    offy = Math.abs(Math.min(this.shadowOffset.y, 0));\n    ctx.fillStyle = this.getRenderColor().toString();\n\n    for (i = 0; i < this.lines.length; i = i + 1) {\n        line = this.lines[i];\n        width = ctx.measureText(line).width + shadowWidth;\n        if (this.alignment === 'right') {\n            x = this.width() - width;\n        } else if (this.alignment === 'center') {\n            x = (this.width() - width) / 2;\n        } else { // 'left'\n            x = 0;\n        }\n        y = (i + 1) * (fontHeight(this.fontSize) + shadowHeight) - shadowHeight;\n        ctx.fillText(line, x + offx, y + offy);\n    }\n\n    // draw the selection\n    start = Math.min(this.startMark, this.endMark);\n    stop = Math.max(this.startMark, this.endMark);\n    for (i = start; i < stop; i += 1) {\n        p = this.slotPosition(i).subtract(this.position());\n        c = this.text.charAt(i);\n        ctx.fillStyle = this.markedBackgoundColor.toString();\n        ctx.fillRect(p.x, p.y, ctx.measureText(c).width + 1,\n            fontHeight(this.fontSize));\n        ctx.fillStyle = this.markedTextColor.toString();\n        ctx.fillText(c, p.x, p.y + fontHeight(this.fontSize));\n    }\n};\n\nTextMorph.prototype.getShadowRenderColor =\n    StringMorph.prototype.getShadowRenderColor;\n\nTextMorph.prototype.setExtent = function (aPoint) {\n    this.maxWidth = Math.max(aPoint.x, 0);\n    this.changed();\n    this.fixLayout();\n    this.rerender();\n};\n\n// TextMorph mesuring:\n\nTextMorph.prototype.columnRow = function (slot) {\n    // answer the logical position point of the given index (\"slot\")\n    var row,\n        col,\n        idx = 0;\n\n    for (row = 0; row < this.lines.length; row += 1) {\n        idx = this.lineSlots[row];\n        for (col = 0; col < this.lines[row].length; col += 1) {\n            if (idx === slot) {\n                return new Point(col, row);\n            }\n            idx += 1;\n        }\n    }\n    // return new Point(0, 0);\n    return new Point(\n        this.lines[this.lines.length - 1].length - 1,\n        this.lines.length - 1\n    );\n};\n\nTextMorph.prototype.slotPosition = function (slot) {\n    // answer the physical position point of the given index (\"slot\")\n    // where the cursor should be placed\n    var colRow = this.columnRow(slot),\n        ctx = this.measureCtx,\n        shadowHeight = Math.abs(this.shadowOffset.y),\n        xOffset = 0,\n        yOffset;\n\n    ctx.font = this.font();\n    yOffset = colRow.y * (fontHeight(this.fontSize) + shadowHeight);\n    xOffset = ctx.measureText(this.lines[colRow.y].slice(0, colRow.x)).width;\n    return new Point(this.left() + xOffset, this.top() + yOffset);\n};\n\nTextMorph.prototype.slotAt = function (aPoint) {\n    // answer the slot (index) closest to the given point taking\n    // in account how far from the middle of the character it is,\n    // so the cursor can be moved accordingly\n    var charX,\n        row = 0,\n        col = 0,\n        columnLength,\n        shadowHeight = Math.abs(this.shadowOffset.y),\n        ctx = this.measureCtx,\n        textWidth;\n\n    while (aPoint.y - this.top() >\n            ((fontHeight(this.fontSize) + shadowHeight) * row)) {\n        row += 1;\n    }\n    row = Math.max(row, 1);\n\n    ctx.font = this.font();\n    textWidth = ctx.measureText(this.lines[row - 1]).width;\n    if (this.alignment === 'right') {\n        charX = this.width() - textWidth;\n    } else if (this.alignment === 'center') {\n        charX = (this.width() - textWidth) / 2;\n    } else { // 'left'\n        charX = 0;\n    }\n    columnLength = this.lines[row - 1].length;\n    while (col < columnLength - 1 && aPoint.x - this.left() > charX) {\n        charX += ctx.measureText(this.lines[row - 1][col]).width;\n        col += 1;\n    }\n\n    // see where our click fell with respect to the middle of the char\n    if (aPoint.x - this.left() >\n            charX - ctx.measureText(this.lines[row - 1][col]).width / 2) {\n        return this.lineSlots[Math.max(row - 1, 0)] + col;\n    } else {\n        return this.lineSlots[Math.max(row - 1, 0)] + col - 1;\n    }\n};\n\nTextMorph.prototype.upFrom = function (slot) {\n    // answer the slot above the given one\n    var above,\n        colRow = this.columnRow(slot);\n    if (colRow.y < 1) {\n        return slot;\n    }\n    above = this.lines[colRow.y - 1];\n    if (above.length < colRow.x - 1) {\n        return this.lineSlots[colRow.y - 1] + above.length;\n    }\n    return this.lineSlots[colRow.y - 1] + colRow.x;\n};\n\nTextMorph.prototype.downFrom = function (slot) {\n    // answer the slot below the given one\n    var below,\n        colRow = this.columnRow(slot);\n    if (colRow.y > this.lines.length - 2) {\n        return slot;\n    }\n    below = this.lines[colRow.y + 1];\n    if (below.length < colRow.x - 1) {\n        return this.lineSlots[colRow.y + 1] + below.length;\n    }\n    return this.lineSlots[colRow.y + 1] + colRow.x;\n};\n\nTextMorph.prototype.startOfLine = function (slot) {\n    // answer the first slot (index) of the line for the given slot\n    return this.lineSlots[this.columnRow(slot).y];\n};\n\nTextMorph.prototype.endOfLine = function (slot) {\n    // answer the slot (index) indicating the EOL for the given slot\n    return this.startOfLine(slot) +\n        this.lines[this.columnRow(slot).y].length - 1;\n};\n\nTextMorph.prototype.previousWordFrom = StringMorph.prototype.previousWordFrom;\n\nTextMorph.prototype.nextWordFrom = StringMorph.prototype.nextWordFrom;\n\n// TextMorph editing:\n\nTextMorph.prototype.edit = StringMorph.prototype.edit;\n\nTextMorph.prototype.selection = StringMorph.prototype.selection;\n\nTextMorph.prototype.selectionStartSlot\n    = StringMorph.prototype.selectionStartSlot;\n\nTextMorph.prototype.clearSelection = StringMorph.prototype.clearSelection;\n\nTextMorph.prototype.deleteSelection = StringMorph.prototype.deleteSelection;\n\nTextMorph.prototype.selectAll = StringMorph.prototype.selectAll;\n\nTextMorph.prototype.mouseDownLeft = StringMorph.prototype.mouseDownLeft;\n\nTextMorph.prototype.shiftClick = StringMorph.prototype.shiftClick;\n\nTextMorph.prototype.mouseClickLeft = StringMorph.prototype.mouseClickLeft;\n\nTextMorph.prototype.mouseDoubleClick = StringMorph.prototype.mouseDoubleClick;\n\nTextMorph.prototype.selectWordAt = StringMorph.prototype.selectWordAt;\n\nTextMorph.prototype.selectBetweenWordsAt\n    = StringMorph.prototype.selectBetweenWordsAt;\n\nTextMorph.prototype.enableSelecting = StringMorph.prototype.enableSelecting;\n\nTextMorph.prototype.disableSelecting = StringMorph.prototype.disableSelecting;\n\nTextMorph.prototype.selectAllAndEdit = function () {\n    this.edit();\n    this.selectAll();\n};\n\n// TextMorph menus:\n\nTextMorph.prototype.developersMenu = function () {\n    var menu = TextMorph.uber.developersMenu.call(this);\n    menu.addLine();\n    menu.addItem(\"edit\", 'edit');\n    menu.addItem(\n        \"font size...\",\n        () => {\n            this.prompt(\n                menu.title + '\\nfont\\nsize:',\n                this.setFontSize,\n                this,\n                this.fontSize.toString(),\n                null,\n                6,\n                100,\n                true\n            );\n        },\n        'set this Text\\'s\\nfont point size'\n    );\n    if (this.alignment !== 'left') {\n        menu.addItem(\"align left\", 'setAlignmentToLeft');\n    }\n    if (this.alignment !== 'right') {\n        menu.addItem(\"align right\", 'setAlignmentToRight');\n    }\n    if (this.alignment !== 'center') {\n        menu.addItem(\"align center\", 'setAlignmentToCenter');\n    }\n    menu.addLine();\n    if (this.fontStyle !== 'serif') {\n        menu.addItem(\"serif\", 'setSerif');\n    }\n    if (this.fontStyle !== 'sans-serif') {\n        menu.addItem(\"sans-serif\", 'setSansSerif');\n    }\n    if (this.isBold) {\n        menu.addItem(\"normal weight\", 'toggleWeight');\n    } else {\n        menu.addItem(\"bold\", 'toggleWeight');\n    }\n    if (this.isItalic) {\n        menu.addItem(\"normal style\", 'toggleItalic');\n    } else {\n        menu.addItem(\"italic\", 'toggleItalic');\n    }\n    return menu;\n};\n\nTextMorph.prototype.setAlignmentToLeft = function () {\n    this.alignment = 'left';\n    this.rerender();\n};\n\nTextMorph.prototype.setAlignmentToRight = function () {\n    this.alignment = 'right';\n    this.rerender();\n};\n\nTextMorph.prototype.setAlignmentToCenter = function () {\n    this.alignment = 'center';\n    this.rerender();\n};\n\nTextMorph.prototype.toggleIsDraggable\n    = StringMorph.prototype.toggleIsDraggable;\n\nTextMorph.prototype.toggleWeight = StringMorph.prototype.toggleWeight;\n\nTextMorph.prototype.toggleItalic = StringMorph.prototype.toggleItalic;\n\nTextMorph.prototype.setSerif = StringMorph.prototype.setSerif;\n\nTextMorph.prototype.setSansSerif = StringMorph.prototype.setSansSerif;\n\nTextMorph.prototype.setText = StringMorph.prototype.setText;\n\nTextMorph.prototype.setFontSize = StringMorph.prototype.setFontSize;\n\nTextMorph.prototype.numericalSetters = StringMorph.prototype.numericalSetters;\n\n// TextMorph evaluation:\n\nTextMorph.prototype.evaluationMenu = function () {\n    var menu = new MenuMorph(this, null);\n    menu.addItem(\n        \"do it\",\n        'doIt',\n        'evaluate the\\nselected expression'\n    );\n    menu.addItem(\n        \"show it\",\n        'showIt',\n        'evaluate the\\nselected expression\\nand show the result'\n    );\n    menu.addItem(\n        \"inspect it\",\n        'inspectIt',\n        'evaluate the\\nselected expression\\nand inspect the result'\n    );\n    menu.addLine();\n    menu.addItem(\"select all\", 'selectAllAndEdit');\n    return menu;\n};\n\nTextMorph.prototype.setReceiver = function (obj) {\n    this.receiver = obj;\n    this.customContextMenu = this.evaluationMenu();\n};\n\nTextMorph.prototype.doIt = function () {\n    this.receiver.evaluateString(this.selection());\n    this.edit();\n};\n\nTextMorph.prototype.showIt = function () {\n    var result = this.receiver.evaluateString(this.selection());\n    if (result !== null) {\n        this.inform(result);\n    }\n};\n\nTextMorph.prototype.inspectIt = function () {\n    var result = this.receiver.evaluateString(this.selection()),\n        world = this.world(),\n        inspector;\n    if (isObject(result)) {\n        inspector = new InspectorMorph(result);\n        inspector.setPosition(world.hand.position());\n        inspector.keepWithin(world);\n        world.add(inspector);\n        inspector.changed();\n    }\n};\n\n// TriggerMorph ////////////////////////////////////////////////////////\n\n// I provide basic button functionality\n\n// TriggerMorph inherits from Morph:\n\nTriggerMorph.prototype = new Morph();\nTriggerMorph.prototype.constructor = TriggerMorph;\nTriggerMorph.uber = Morph.prototype;\n\n// TriggerMorph instance creation:\n\nexport function TriggerMorph(\n    target,\n    action,\n    labelString,\n    fontSize,\n    fontStyle,\n    environment,\n    hint,\n    labelColor,\n    labelBold,\n    labelItalic,\n    doubleClickAction\n) {\n    this.init(\n        target,\n        action,\n        labelString,\n        fontSize,\n        fontStyle,\n        environment,\n        hint,\n        labelColor,\n        labelBold,\n        labelItalic,\n        doubleClickAction\n    );\n}\n\nTriggerMorph.prototype.init = function (\n    target,\n    action,\n    labelString,\n    fontSize,\n    fontStyle,\n    environment,\n    hint,\n    labelColor,\n    labelBold,\n    labelItalic,\n    doubleClickAction\n) {\n    // additional properties:\n    this.target = target || null;\n    this.action = action === 0 ? 0 : action|| null;\n    this.doubleClickAction = doubleClickAction || null;\n    this.environment = environment || null;\n    this.labelString = labelString || ' ';\n    this.label = null;\n    this.hint = hint || null; // null, String, or Function\n    this.schedule = null; // animation slot for displaying hints\n    this.fontSize = fontSize || MorphicPreferences.menuFontSize;\n    this.fontStyle = fontStyle || 'sans-serif';\n    this.highlightColor = new Color(192, 192, 192);\n    this.pressColor = new Color(128, 128, 128);\n    this.labelColor = labelColor || new Color(0, 0, 0);\n    this.labelBold = labelBold || false;\n    this.labelItalic = labelItalic || false;\n    this.userState = 'normal'; // 'highlight', 'pressed'\n\n    // initialize inherited properties:\n    TriggerMorph.uber.init.call(this);\n\n    // override inherited properites:\n    this.color = WHITE;\n    this.createLabel();\n};\n\n// TriggerMorph drawing:\n\nTriggerMorph.prototype.render = function (ctx) {\n    var colorBak = this.color;\n    if (this.userState === 'highlight') {\n        this.color = this.highlightColor;\n    } else if (this.userState === 'pressed') {\n        this.color = this.pressColor;\n    }\n    TriggerMorph.uber.render.call(this, ctx);\n    this.color = colorBak;\n};\n\nTriggerMorph.prototype.createLabel = function () {\n    if (this.label !== null) {\n        this.label.destroy();\n    }\n    this.label = new StringMorph(\n        this.labelString,\n        this.fontSize,\n        this.fontStyle,\n        this.labelBold,\n        this.labelItalic,\n        false, // numeric\n        null, // shadow offset\n        null, // shadow color\n        this.labelColor\n    );\n    this.fixLayout();\n    this.add(this.label);\n};\n\nTriggerMorph.prototype.fixLayout = function () {\n    this.label.setPosition(\n        this.center().subtract(\n            this.label.extent().floorDivideBy(2)\n        )\n    );\n};\n\n// TriggerMorph action:\n\nTriggerMorph.prototype.trigger = function () {\n    /*\n    if target is a function, use it as callback:\n    execute target as callback function with action as argument\n    in the environment as optionally specified.\n    Note: if action is also a function, instead of becoming\n    the argument itself it will be called to answer the argument.\n    for selections, Yes/No Choices etc. As second argument pass\n    myself, so I can be modified to reflect status changes, e.g.\n    inside a list box:\n\n    else (if target is not a function):\n\n        if action is a function:\n        execute the action with target as environment (can be null)\n        for lambdafied (inline) actions\n\n        else if action is a String:\n        treat it as function property of target and execute it\n        for selector-like actions\n    */\n    if (this.schedule) {\n        this.schedule.isActive = false;\n    }\n    if (typeof this.target === 'function') {\n        if (typeof this.action === 'function') {\n            this.target.call(this.environment, this.action.call(), this);\n        } else {\n            this.target.call(this.environment, this.action, this);\n        }\n    } else {\n        if (typeof this.action === 'function') {\n            this.action.call(this.target);\n        } else { // assume it's a String\n            this.target[this.action]();\n        }\n    }\n};\n\nTriggerMorph.prototype.triggerDoubleClick = function () {\n    // same as trigger() but use doubleClickAction instead of action property\n    // note that specifying a doubleClickAction is optional\n    if (!this.doubleClickAction) {return; }\n    if (this.schedule) {\n        this.schedule.isActive = false;\n    }\n    if (typeof this.target === 'function') {\n        if (typeof this.doubleClickAction === 'function') {\n            this.target.call(\n                this.environment,\n                this.doubleClickAction.call(),\n                this\n            );\n        } else {\n            this.target.call(this.environment, this.doubleClickAction, this);\n        }\n    } else {\n        if (typeof this.doubleClickAction === 'function') {\n            this.doubleClickAction.call(this.target);\n        } else { // assume it's a String\n            this.target[this.doubleClickAction]();\n        }\n    }\n};\n\n// TriggerMorph events:\n\nTriggerMorph.prototype.mouseEnter = function () {\n    var contents = this.hint instanceof Function ? this.hint() : this.hint;\n    this.userState = 'highlight';\n    this.rerender();\n    if (contents) {\n        this.bubbleHelp(contents);\n    }\n};\n\nTriggerMorph.prototype.mouseLeave = function () {\n    this.userState = 'normal';\n    this.rerender();\n    if (this.schedule) {\n        this.schedule.isActive = false;\n    }\n    if (this.hint) {\n        this.world().hand.destroyTemporaries();\n    }\n};\n\nTriggerMorph.prototype.mouseDownLeft = function () {\n    this.userState = 'pressed';\n    this.rerender();\n};\n\nTriggerMorph.prototype.mouseClickLeft = function () {\n    this.userState = 'highlight';\n    this.rerender();\n    this.trigger();\n};\n\nTriggerMorph.prototype.mouseDoubleClick = function () {\n    this.triggerDoubleClick();\n};\n\nTriggerMorph.prototype.rootForGrab = function () {\n    return this.isDraggable ? TriggerMorph.uber.rootForGrab.call(this) : null;\n};\n\n// TriggerMorph bubble help:\n\nTriggerMorph.prototype.bubbleHelp = function (contents) {\n    var world = this.world();\n    this.schedule = new Animation(\n        nop,\n        nop,\n        0,\n        500,\n        nop,\n        () => this.popUpbubbleHelp(contents)\n    );\n    world.animations.push(this.schedule);\n};\n\nTriggerMorph.prototype.popUpbubbleHelp = function (contents) {\n    new SpeechBubbleMorph(\n        localize(contents),\n        null,\n        null,\n        1\n    ).popUp(this.world(), this.rightCenter().add(new Point(-8, 0)));\n};\n\n// MenuItemMorph ///////////////////////////////////////////////////////\n\n// I automatically determine my bounds\n\n\n\n// MenuItemMorph inherits from TriggerMorph:\n\nMenuItemMorph.prototype = new TriggerMorph();\nMenuItemMorph.prototype.constructor = MenuItemMorph;\nMenuItemMorph.uber = TriggerMorph.prototype;\n\n// MenuItemMorph instance creation:\n\nexport function MenuItemMorph(\n    target,\n    action,\n    labelString, // can also be a Morph or a Canvas or a tuple: [icon, string]\n    fontSize,\n    fontStyle,\n    environment,\n    hint,\n    color,\n    bold,\n    italic,\n    doubleClickAction, // optional when used as list morph item\n    shortcut // optional string, Morph, Canvas or tuple: [icon, string]\n) {\n    // additional properties:\n    this.shortcutString = shortcut || null;\n    this.shortcut = null;\n\n    // initialize inherited properties:\n    this.init(\n        target,\n        action,\n        labelString,\n        fontSize,\n        fontStyle,\n        environment,\n        hint,\n        color,\n        bold,\n        italic,\n        doubleClickAction\n    );\n}\n\nMenuItemMorph.prototype.createLabel = function () {\n    var w, h;\n    if (this.label) {\n        this.label.destroy();\n    }\n    this.label = this.createLabelPart(this.labelString);\n    this.add(this.label);\n    w = this.label.width();\n    h = this.label.height();\n    if (this.shortcut) {\n        this.shortcut.destroy();\n    }\n    if (this.shortcutString) {\n        this.shortcut = this.createLabelPart(this.shortcutString);\n        w += this.shortcut.width() + 4;\n        h = Math.max(h, this.shortcut.height());\n        this.add(this.shortcut);\n    }\n    this.setExtent(new Point(w + 8, h));\n};\n\nMenuItemMorph.prototype.fixLayout = function () {\n    var cntr = this.center();\n    this.label.setCenter(cntr);\n    this.label.setLeft(this.left() + 4);\n    if (this.shortcut) {\n        this.shortcut.setCenter(cntr);\n        this.shortcut.setRight(this.right() - 4);\n    }\n};\n\nMenuItemMorph.prototype.createLabelPart = function (source) {\n    var part, icon, lbl;\n    if (isString(source)) {\n        return this.createLabelString(source);\n    }\n    if (source instanceof Array) {\n        // assume its pattern is: [icon, string]\n        part = new Morph();\n        part.alpha = 0; // transparent\n        icon = this.createIcon(source[0]);\n        part.add(icon);\n        lbl = this.createLabelString(source[1]);\n        part.add(lbl);\n        lbl.setCenter(icon.center());\n        lbl.setLeft(icon.right() + 4);\n        part.bounds = (icon.bounds.merge(lbl.bounds));\n        part.rerender();\n        return part;\n    }\n    // assume it's either a Morph or a Canvas\n    return this.createIcon(source);\n};\n\nMenuItemMorph.prototype.createIcon = function (source) {\n    // source can be either a Morph or an HTMLCanvasElement\n    var icon;\n\n    if (source instanceof Morph) {\n        return source.fullCopy();\n    }\n    // assume a Canvas\n    icon = new Morph();\n    icon.isCachingImage = true;\n    icon.cachedImage = source; // should we copy the canvas?\n    icon.bounds.setWidth(source.width);\n    icon.bounds.setHeight(source.height);\n    return icon;\n};\n\nMenuItemMorph.prototype.createLabelString = function (string) {\n    var lbl = new TextMorph(\n        string,\n        this.fontSize,\n        this.fontStyle,\n        this.labelBold,\n        this.labelItalic\n    );\n    lbl.setColor(this.labelColor);\n    return lbl;\n};\n\n// MenuItemMorph events:\n\nMenuItemMorph.prototype.mouseEnter = function () {\n    var menu = this.parentThatIsA(MenuMorph);\n    if (this.isShowingSubmenu()) {\n        return;\n    }\n    if (menu) {\n        menu.closeSubmenu();\n    }\n    if (!this.isListItem()) {\n        this.userState = 'highlight';\n        this.rerender();\n    }\n    if (this.action instanceof MenuMorph) {\n        this.delaySubmenu();\n    } else if (this.hint) {\n        this.bubbleHelp(this.hint);\n    }\n};\n\nMenuItemMorph.prototype.mouseLeave = function () {\n    if (!this.isListItem()) {\n        if (this.isShowingSubmenu()) {\n            this.userState = 'highlight';\n        } else {\n            this.userState = 'normal';\n        }\n        this.rerender();\n    }\n    if (this.schedule) {\n        this.schedule.isActive = false;\n    }\n    if (this.hint) {\n        this.world().hand.destroyTemporaries();\n    }\n};\n\nMenuItemMorph.prototype.mouseDownLeft = function (pos) {\n    if (this.isListItem()) {\n        this.parentThatIsA(MenuMorph).unselectAllItems();\n        this.escalateEvent('mouseDownLeft', pos);\n    }\n    this.userState = 'pressed';\n    this.rerender();\n};\n\nMenuItemMorph.prototype.mouseMove = function () {\n    if (this.isListItem()) {\n        this.escalateEvent('mouseMove');\n    }\n};\n\nMenuItemMorph.prototype.mouseClickLeft = function () {\n    if (this.action instanceof MenuMorph) {\n        this.popUpSubmenu();\n    } else {\n        if (!this.isListItem()) {\n            this.parentThatIsA(MenuMorph).closeRootMenu();\n            this.world().activeMenu = null;\n        }\n        this.trigger();\n    }\n};\n\nMenuItemMorph.prototype.isListItem = function () {\n\tvar menu = this.parentThatIsA(MenuMorph);\n    if (menu) {\n        return menu.isListContents;\n    }\n    return false;\n};\n\nMenuItemMorph.prototype.isSelectedListItem = function () {\n    if (this.isListItem()) {\n        return this.userState === 'pressed';\n    }\n    return false;\n};\n\nMenuItemMorph.prototype.isShowingSubmenu = function () {\n    var menu = this.parentThatIsA(MenuMorph);\n    if (menu && (this.action instanceof MenuMorph)) {\n        return menu.submenu === this.action;\n    }\n    return false;\n};\n\n// MenuItemMorph submenus:\n\nMenuItemMorph.prototype.delaySubmenu = function () {\n    var world = this.world();\n    this.schedule = new Animation(\n        nop,\n        nop,\n        0,\n        500,\n        nop,\n        () => this.popUpSubmenu()\n    );\n    world.animations.push(this.schedule);\n};\n\nMenuItemMorph.prototype.popUpSubmenu = function () {\n    var menu = this.parentThatIsA(MenuMorph),\n        world = this.world(),\n        scroller;\n\n    if (!(this.action instanceof MenuMorph)) {return; }\n    this.action.createItems();\n    this.action.setPosition(this.topRight().subtract(new Point(0, 5)));\n    this.action.addShadow(new Point(2, 2), 80);\n    this.action.keepWithin(this.world());\n    if (this.action.items.length < 1 && !this.action.title) {return; }\n\n    if (this.action.bottom() > world.bottom()) {\n        // scroll menu items if the menu is taller than the world\n        this.action.removeShadow();\n        scroller = this.action.scroll();\n        this.action.bounds.corner.y = world.bottom() - 2;\n        this.action.addShadow(new Point(2, 2), 80);\n        scroller.setHeight(world.bottom() - scroller.top() - 6);\n        scroller.adjustScrollBars(); // ?\n     }\n\n    menu.add(this.action);\n    menu.submenu = this.action;\n    menu.submenu.world = menu.world; // keyboard control\n    this.action.fullChanged();\n};\n\n// FrameMorph //////////////////////////////////////////////////////////\n\n// I clip my submorphs at my bounds\n\n// Frames inherit from Morph:\n\nFrameMorph.prototype = new Morph();\nFrameMorph.prototype.constructor = FrameMorph;\nFrameMorph.uber = Morph.prototype;\n\nexport function FrameMorph(aScrollFrame) {\n    this.init(aScrollFrame);\n}\n\nFrameMorph.prototype.init = function (aScrollFrame) {\n    this.scrollFrame = aScrollFrame || null;\n\n    FrameMorph.uber.init.call(this);\n    this.color = new Color(255, 250, 245);\n    this.acceptsDrops = true;\n\n    if (this.scrollFrame) {\n        this.isDraggable = false;\n        this.alpha = 0;\n    }\n};\n\nFrameMorph.prototype.fullBounds = function () {\n    var shadow = this.getShadow();\n    if (shadow !== null) {\n        return this.bounds.merge(shadow.bounds);\n    }\n    return this.bounds;\n};\n\nFrameMorph.prototype.fullImage = function () {\n    // use only for shadows\n    return this.getImage();\n};\n\nFrameMorph.prototype.fullDrawOn = function (ctx, aRect) {\n    var shadow, clipped;\n    if (!this.isVisible) {return; }\n    clipped = this.bounds.intersect(aRect);\n    if (!clipped.extent().gt(ZERO)) {return; }\n    this.drawOn(ctx, clipped);\n    this.children.forEach(child => {\n        if (child instanceof ShadowMorph) {\n            shadow = child;\n        } else {\n            child.fullDrawOn(ctx, clipped);\n        }\n    });\n    if (shadow) {\n        shadow.drawOn(ctx, aRect);\n    }\n};\n\n// FrameMorph navigation:\n\nFrameMorph.prototype.topMorphAt = function (point) {\n    var i, result;\n    if (!(this.isVisible && this.bounds.containsPoint(point))) {\n        return null;\n    }\n    for (i = this.children.length - 1; i >= 0; i -= 1) {\n        result = this.children[i].topMorphAt(point);\n        if (result) {return result; }\n    }\n    if (this.isFreeForm) {\n        return this.isTransparentAt(point) ? null : this;\n    }\n    return this;\n};\n\n// FrameMorph scrolling support:\n\nFrameMorph.prototype.submorphBounds = function () {\n    var result = null;\n\n    if (this.children.length > 0) {\n        result = this.children[0].bounds;\n        this.children.forEach(child => {\n            result = result.merge(child.fullBounds());\n        });\n    }\n    return result;\n};\n\nFrameMorph.prototype.keepInScrollFrame = function () {\n    if (this.scrollFrame === null) {\n        return null;\n    }\n    if (this.left() > this.scrollFrame.left()) {\n        this.moveBy(\n            new Point(this.scrollFrame.left() - this.left(), 0)\n        );\n    }\n    if (this.right() < this.scrollFrame.right()) {\n        this.moveBy(\n            new Point(this.scrollFrame.right() - this.right(), 0)\n        );\n    }\n    if (this.top() > this.scrollFrame.top()) {\n        this.moveBy(\n            new Point(0, this.scrollFrame.top() - this.top())\n        );\n    }\n    if (this.bottom() < this.scrollFrame.bottom()) {\n        this.moveBy(\n            0,\n            new Point(this.scrollFrame.bottom() - this.bottom(), 0)\n        );\n    }\n};\n\nFrameMorph.prototype.adjustBounds = function () {\n    var subBounds,\n        newBounds;\n\n    if (this.scrollFrame === null) {return; }\n    subBounds = this.submorphBounds();\n    if (subBounds && (!this.scrollFrame.isTextLineWrapping)) {\n        newBounds = subBounds\n            .expandBy(this.scrollFrame.padding)\n            .growBy(this.scrollFrame.growth)\n            .merge(this.scrollFrame.bounds);\n    } else {\n        newBounds = this.scrollFrame.bounds.copy();\n    }\n    if (!this.bounds.eq(newBounds)) {\n        this.bounds = newBounds;\n        this.keepInScrollFrame();\n    }\n    if (this.scrollFrame.isTextLineWrapping) {\n        this.children.forEach(morph => {\n            if (morph instanceof TextMorph) {\n                morph.setWidth(this.width());\n                this.setHeight(\n                    Math.max(morph.height(), this.scrollFrame.height())\n                );\n            }\n        });\n    }\n    this.scrollFrame.adjustScrollBars();\n};\n\n// FrameMorph dragging & dropping of contents:\n\nFrameMorph.prototype.reactToDropOf = function () {\n    this.adjustBounds();\n};\n\nFrameMorph.prototype.reactToGrabOf = function () {\n    this.adjustBounds();\n};\n\n// FrameMorph menus:\n\nFrameMorph.prototype.developersMenu = function () {\n    var menu = FrameMorph.uber.developersMenu.call(this);\n    if (this.children.length > 0) {\n        menu.addLine();\n        menu.addItem(\n            \"move all inside...\",\n            'keepAllSubmorphsWithin',\n            'keep all submorphs\\nwithin and visible'\n        );\n    }\n    return menu;\n};\n\nFrameMorph.prototype.keepAllSubmorphsWithin = function () {\n    this.children.forEach(m => m.keepWithin(this));\n};\n\n// ScrollFrameMorph ////////////////////////////////////////////////////\n\nScrollFrameMorph.prototype = new FrameMorph();\nScrollFrameMorph.prototype.constructor = ScrollFrameMorph;\nScrollFrameMorph.uber = FrameMorph.prototype;\n\nexport function ScrollFrameMorph(scroller, size, sliderColor) {\n    this.init(scroller, size, sliderColor);\n}\n\nScrollFrameMorph.prototype.init = function (scroller, size, sliderColor) {\n    ScrollFrameMorph.uber.init.call(this);\n    this.scrollBarSize = size || MorphicPreferences.scrollBarSize;\n    this.autoScrollTrigger = null;\n    this.enableAutoScrolling = true; // change to suppress\n    this.isScrollingByDragging = true; // change to suppress\n    this.hasVelocity = true; // dto.\n    this.padding = 0; // around the scrollable area\n    this.growth = 0; // pixels or Point to grow right/left when near edge\n    this.isTextLineWrapping = false;\n    this.contents = scroller || new FrameMorph(this);\n    this.add(this.contents);\n    this.hBar = new SliderMorph(\n        null, // start\n        null, // stop\n        null, // value\n        null, // size\n        'horizontal',\n        sliderColor\n    );\n    this.hBar.setHeight(this.scrollBarSize);\n    this.hBar.action = (num) => {\n        this.contents.setPosition(\n            new Point(\n                this.left() - num,\n                this.contents.position().y\n            )\n        );\n    };\n    this.hBar.isDraggable = false;\n    this.add(this.hBar);\n    this.vBar = new SliderMorph(\n        null, // start\n        null, // stop\n        null, // value\n        null, // size\n        'vertical',\n        sliderColor\n    );\n    this.vBar.setWidth(this.scrollBarSize);\n    this.vBar.action = (num) => {\n        this.contents.setPosition(\n            new Point(\n                this.contents.position().x,\n                this.top() - num\n            )\n        );\n    };\n    this.vBar.isDraggable = false;\n    this.add(this.vBar);\n    this.toolBar = null; // optional slot\n};\n\nScrollFrameMorph.prototype.adjustScrollBars = function () {\n    var hWidth = this.width() - this.scrollBarSize,\n        vHeight = this.height() - this.scrollBarSize;\n\n    this.changed();\n    if (this.contents.width() > this.width()) {\n        this.hBar.show();\n        if (this.hBar.width() !== hWidth) {\n            this.hBar.setWidth(hWidth);\n        }\n\n        this.hBar.setPosition(\n            new Point(\n                this.left(),\n                this.bottom() - this.hBar.height()\n            )\n        );\n        this.hBar.start = 0;\n        this.hBar.stop = this.contents.width() -\n            this.width() +\n            this.scrollBarSize;\n        this.hBar.size =\n            this.width() / this.contents.width() * this.hBar.stop;\n        this.hBar.value = this.left() - this.contents.left();\n        this.hBar.fixLayout();\n    } else {\n        this.hBar.hide();\n    }\n\n    if (this.contents.height() > this.height()) {\n        this.vBar.show();\n        if (this.vBar.height() !== vHeight) {\n            this.vBar.setHeight(vHeight);\n        }\n\n        this.vBar.setPosition(\n            new Point(\n                this.right() - this.vBar.width(),\n                this.top()\n            )\n        );\n        this.vBar.start = 0;\n        this.vBar.stop = this.contents.height() -\n            this.height() +\n            this.scrollBarSize;\n        this.vBar.size =\n            this.height() / this.contents.height() * this.vBar.stop;\n        this.vBar.value = this.top() - this.contents.top();\n        this.vBar.fixLayout();\n    } else {\n        this.vBar.hide();\n    }\n    this.adjustToolBar();\n};\n\nScrollFrameMorph.prototype.adjustToolBar = function () {\n    var padding = 3;\n    if (this.toolBar) {\n        this.toolBar.setTop(this.top() + padding);\n        this.toolBar.setRight(\n            (this.vBar.isVisible ? this.vBar.left() : this.right()) - padding\n        );\n    }\n};\n\nScrollFrameMorph.prototype.addContents = function (aMorph) {\n    this.contents.add(aMorph);\n    this.contents.adjustBounds();\n};\n\nScrollFrameMorph.prototype.setContents = function (aMorph) {\n    this.contents.children.forEach(m => m.destroy());\n    this.contents.children = [];\n    aMorph.setPosition(this.position().add(this.padding + 2));\n    this.addContents(aMorph);\n};\n\nScrollFrameMorph.prototype.setExtent = function (aPoint) {\n    if (this.isTextLineWrapping) {\n        this.contents.setPosition(this.position().copy());\n    }\n    ScrollFrameMorph.uber.setExtent.call(this, aPoint);\n    this.contents.adjustBounds();\n};\n\n// ScrollFrameMorph scrolling by dragging:\n\nScrollFrameMorph.prototype.scrollX = function (steps) {\n    var cl = this.contents.left(),\n        l = this.left(),\n        cw = this.contents.width(),\n        r = this.right(),\n        newX;\n\n    if (this.vBar.isVisible) {\n        r -= this.scrollBarSize;\n    }\n\n    newX = cl + steps;\n    if (newX + cw < r) {\n        newX = r - cw;\n    }\n    if (newX > l) {\n        newX = l;\n    }\n    if (newX !== cl) {\n        this.contents.setLeft(newX);\n    }\n};\n\nScrollFrameMorph.prototype.scrollY = function (steps) {\n    var ct = this.contents.top(),\n        t = this.top(),\n        ch = this.contents.height(),\n        b = this.bottom(),\n        newY;\n\n    if (this.hBar.isVisible) {\n        b -= this.scrollBarSize;\n    }\n\n    newY = ct + steps;\n    if (newY + ch < b) {\n        newY = b - ch;\n    }\n    if (newY > t) {\n        newY = t;\n    }\n    if (newY !== ct) {\n        this.contents.setTop(newY);\n    }\n};\n\nScrollFrameMorph.prototype.step = nop;\n\nScrollFrameMorph.prototype.mouseDownLeft = function (pos) {\n    if (!this.isScrollingByDragging) {\n        return null;\n    }\n    var world = this.root(),\n        hand = world.hand,\n        oldPos = pos,\n        deltaX = 0,\n        deltaY = 0,\n        friction = 0.8;\n\n    this.step = () => {\n        var newPos;\n        if (hand.mouseButton &&\n                (hand.children.length === 0) &&\n                (this.bounds.containsPoint(hand.bounds.origin))) {\n\n            if (hand.grabPosition &&\n                (hand.grabPosition.distanceTo(hand.position()) <=\n                    MorphicPreferences.grabThreshold)) {\n                // still within the grab threshold\n                return null;\n            }\n\n            newPos = hand.bounds.origin;\n            deltaX = newPos.x - oldPos.x;\n            if (deltaX !== 0) {\n                this.scrollX(deltaX);\n            }\n            deltaY = newPos.y - oldPos.y;\n            if (deltaY !== 0) {\n                this.scrollY(deltaY);\n            }\n            oldPos = newPos;\n        } else {\n            if (!this.hasVelocity) {\n                this.step = nop;\n            } else {\n                if ((Math.abs(deltaX) < 0.5) &&\n                        (Math.abs(deltaY) < 0.5)) {\n                    this.step = nop;\n                } else {\n                    deltaX = deltaX * friction;\n                    this.scrollX(Math.round(deltaX));\n                    deltaY = deltaY * friction;\n                    this.scrollY(Math.round(deltaY));\n                }\n            }\n        }\n        this.adjustScrollBars();\n    };\n};\n\nScrollFrameMorph.prototype.startAutoScrolling = function () {\n    var inset = MorphicPreferences.scrollBarSize * 3,\n        world = this.world(),\n        hand,\n        inner,\n        pos;\n\n    if (!world) {\n        return null;\n    }\n    hand = world.hand;\n    if (!this.autoScrollTrigger) {\n        this.autoScrollTrigger = Date.now();\n    }\n    this.step = () => {\n        pos = hand.bounds.origin;\n        inner = this.bounds.insetBy(inset);\n        if ((this.bounds.containsPoint(pos)) &&\n                (!(inner.containsPoint(pos))) &&\n                (hand.children.length > 0)) {\n            this.autoScroll(pos);\n        } else {\n            this.step = nop;\n            this.autoScrollTrigger = null;\n        }\n    };\n};\n\nScrollFrameMorph.prototype.autoScroll = function (pos) {\n    var inset, area;\n\n    if (Date.now() - this.autoScrollTrigger < 500) {\n        return null;\n    }\n\n    inset = MorphicPreferences.scrollBarSize * 3;\n    area = this.topLeft().extent(new Point(this.width(), inset));\n    if (area.containsPoint(pos)) {\n        this.scrollY(inset - (pos.y - this.top()));\n    }\n    area = this.topLeft().extent(new Point(inset, this.height()));\n    if (area.containsPoint(pos)) {\n        this.scrollX(inset - (pos.x - this.left()));\n    }\n    area = (new Point(this.right() - inset, this.top()))\n        .extent(new Point(inset, this.height()));\n    if (area.containsPoint(pos)) {\n        this.scrollX(-(inset - (this.right() - pos.x)));\n    }\n    area = (new Point(this.left(), this.bottom() - inset))\n        .extent(new Point(this.width(), inset));\n    if (area.containsPoint(pos)) {\n        this.scrollY(-(inset - (this.bottom() - pos.y)));\n    }\n    this.adjustScrollBars();\n};\n\n// ScrollFrameMorph scrolling by editing text:\n\nScrollFrameMorph.prototype.scrollCursorIntoView = function (morph) {\n    var txt = morph.target,\n        offset = txt.position().subtract(this.contents.position()),\n        ft = this.top() + this.padding,\n        fb = this.bottom() - this.padding;\n    this.contents.setExtent(txt.extent().add(offset).add(this.padding));\n    if (morph.top() < ft) {\n        this.contents.setTop(this.contents.top() + ft - morph.top());\n        morph.setTop(ft);\n    } else if (morph.bottom() > fb) {\n        this.contents.setBottom(this.contents.bottom() + fb - morph.bottom());\n        morph.setBottom(fb);\n    }\n    this.adjustScrollBars();\n};\n\n// ScrollFrameMorph events:\n\nScrollFrameMorph.prototype.mouseScroll = function (y, x) {\n    if (y) {\n        this.scrollY(y * MorphicPreferences.mouseScrollAmount);\n    }\n    if (x) {\n        this.scrollX(x * MorphicPreferences.mouseScrollAmount);\n    }\n    this.adjustScrollBars();\n};\n\n// ScrollFrameMorph duplicating:\n\nScrollFrameMorph.prototype.updateReferences = function (map) {\n    ScrollFrameMorph.uber.updateReferences.call(this, map);\n    if (this.hBar) {\n        this.hBar.action = (num) => {\n            this.contents.setPosition(\n                new Point(this.left() - num, this.contents.position().y)\n            );\n        };\n    }\n    if (this.vBar) {\n        this.vBar.action = (num) => {\n            this.contents.setPosition(\n                new Point(this.contents.position().x, this.top() - num)\n            );\n        };\n    }\n};\n\n// ScrollFrameMorph menu:\n\nScrollFrameMorph.prototype.developersMenu = function () {\n    var menu = ScrollFrameMorph.uber.developersMenu.call(this);\n    if (this.isTextLineWrapping) {\n        menu.addItem(\n            \"auto line wrap off...\",\n            'toggleTextLineWrapping',\n            'turn automatic\\nline wrapping\\noff'\n        );\n    } else {\n        menu.addItem(\n            \"auto line wrap on...\",\n            'toggleTextLineWrapping',\n            'enable automatic\\nline wrapping'\n        );\n    }\n    return menu;\n};\n\nScrollFrameMorph.prototype.toggleTextLineWrapping = function () {\n    this.isTextLineWrapping = !this.isTextLineWrapping;\n};\n\n// ListMorph ///////////////////////////////////////////////////////////\n\nListMorph.prototype = new ScrollFrameMorph();\nListMorph.prototype.constructor = ListMorph;\nListMorph.uber = ScrollFrameMorph.prototype;\n\nexport function ListMorph(elements, labelGetter, format, onDoubleClick, separator) {\n/*\n    passing a format is optional. If the format parameter is specified\n    it has to be of the following pattern:\n\n        [\n            [<color>, <single-argument predicate>],\n            ['bold', <single-argument predicate>],\n            ['italic', <single-argument predicate>],\n            ...\n        ]\n\n    multiple conditions can be passed in such a format list, the\n    last predicate to evaluate true when given the list element sets\n    the given format category (color, bold, italic).\n    If no condition is met, the default format (color black, non-bold,\n    non-italic) will be assigned.\n\n    An example of how to use fomats can be found in the InspectorMorph's\n    \"markOwnProperties\" mechanism.\n*/\n    this.init(\n        elements || [],\n        labelGetter || function (element) {\n            if (isString(element)) {\n                return element;\n            }\n            if (element.toSource) {\n                return element.toSource();\n            }\n            return element.toString();\n        },\n        format || [],\n        onDoubleClick, // optional callback\n        separator // string indicating a horizontal line between items\n    );\n}\n\nListMorph.prototype.init = function (\n    elements,\n    labelGetter,\n    format,\n    onDoubleClick,\n    separator\n) {\n    ListMorph.uber.init.call(this);\n\n    this.contents.acceptsDrops = false;\n    this.color = WHITE;\n    this.hBar.alpha = 0.6;\n    this.vBar.alpha = 0.6;\n    this.elements = elements || [];\n    this.labelGetter = labelGetter;\n    this.format = format;\n    this.listContents = null;\n    this.selected = null; // actual element currently selected\n    this.active = null; // menu item representing the selected element\n    this.action = null;\n    this.doubleClickAction = onDoubleClick || null;\n    this.separator = separator || '';\n    this.acceptsDrops = false;\n    this.buildListContents();\n};\n\nListMorph.prototype.buildListContents = function () {\n    if (this.listContents) {\n        this.listContents.destroy();\n    }\n    this.listContents = new MenuMorph(\n        this.select,\n        null,\n        this\n    );\n    if (this.elements.length === 0) {\n        this.elements = ['(empty)'];\n    }\n    this.elements.forEach(element => {\n        var color = null,\n            bold = false,\n            italic = false,\n            label;\n\n        this.format.forEach(pair => {\n            if (pair[1].call(null, element)) {\n                if (pair[0] === 'bold') {\n                    bold = true;\n                } else if (pair[0] === 'italic') {\n                    italic = true;\n                } else { // assume it's a color\n                    color = pair[0];\n                }\n            }\n        });\n\n        label = this.labelGetter(element);\n        if (label === this.separator) {\n            this.listContents.addLine();\n        } else {\n            this.listContents.addItem(\n                label, // label string\n                element, // action\n                null, // hint\n                color,\n                bold,\n                italic,\n                this.doubleClickAction,\n                null, // shortcut\n                true // verbatim - don't translate\n            );\n        }\n    });\n    this.listContents.isListContents = true;\n    this.listContents.createItems();\n    this.listContents.setPosition(this.contents.position());\n    this.addContents(this.listContents);\n};\n\nListMorph.prototype.select = function (item, trigger) {\n    if (isNil(item)) {return; }\n    this.selected = item;\n    this.active = trigger;\n    if (this.action) {\n        this.action.call(null, item);\n    }\n};\n\nListMorph.prototype.setExtent = function (aPoint) {\n    var lb = this.listContents.bounds,\n        nb = this.bounds.origin.copy().corner(\n            this.bounds.origin.add(aPoint)\n        );\n\n    if (nb.right() > lb.right() && nb.width() <= lb.width()) {\n        this.listContents.setRight(nb.right());\n    }\n    if (nb.bottom() > lb.bottom() && nb.height() <= lb.height()) {\n        this.listContents.setBottom(nb.bottom());\n    }\n    ListMorph.uber.setExtent.call(this, aPoint);\n};\n\nListMorph.prototype.activeIndex = function () {\n    return this.listContents.children.indexOf(this.active);\n};\n\nListMorph.prototype.activateIndex = function (idx) {\n    var item = this.listContents.children[idx];\n    if (!item) {return; }\n    item.userState = 'pressed';\n    item.rerender();\n    item.trigger();\n};\n\n// StringFieldMorph ////////////////////////////////////////////////////\n\n// StringFieldMorph inherit from FrameMorph:\n\nStringFieldMorph.prototype = new FrameMorph();\nStringFieldMorph.prototype.constructor = StringFieldMorph;\nStringFieldMorph.uber = FrameMorph.prototype;\n\nexport function StringFieldMorph(\n    defaultContents,\n    minWidth,\n    fontSize,\n    fontStyle,\n    bold,\n    italic,\n    isNumeric\n) {\n    this.init(\n        defaultContents || '',\n        minWidth || 100,\n        fontSize || 12,\n        fontStyle || 'sans-serif',\n        bold || false,\n        italic || false,\n        isNumeric\n    );\n}\n\nStringFieldMorph.prototype.init = function (\n    defaultContents,\n    minWidth,\n    fontSize,\n    fontStyle,\n    bold,\n    italic,\n    isNumeric\n) {\n    this.defaultContents = defaultContents;\n    this.minWidth = minWidth;\n    this.fontSize = fontSize;\n    this.fontStyle = fontStyle;\n    this.isBold = bold;\n    this.isItalic = italic;\n    this.isNumeric = isNumeric || false;\n    this.text = null;\n    StringFieldMorph.uber.init.call(this);\n    this.color = WHITE;\n    this.isEditable = true;\n    this.acceptsDrops = false;\n    this.createText();\n};\n\nStringFieldMorph.prototype.createText = function () {\n    var txt;\n    txt = this.text ? this.string() : this.defaultContents;\n    this.text = null;\n    this.children.forEach(child => child.destroy());\n    this.children = [];\n    this.text = new StringMorph(\n        txt,\n        this.fontSize,\n        this.fontStyle,\n        this.isBold,\n        this.isItalic,\n        this.isNumeric\n    );\n\n    this.text.isNumeric = this.isNumeric; // for whichever reason...\n    this.text.setPosition(this.bounds.origin.copy());\n    this.text.isEditable = this.isEditable;\n    this.text.isDraggable = false;\n    this.text.enableSelecting();\n    this.setExtent(\n        new Point(\n            Math.max(this.width(), this.minWidth),\n            this.text.height()\n        )\n    );\n    this.add(this.text);\n};\n\nStringFieldMorph.prototype.string = function () {\n    return this.text.text;\n};\n\nStringFieldMorph.prototype.mouseClickLeft = function (pos) {\n    if (this.isEditable) {\n        this.text.edit();\n    } else {\n        this.escalateEvent('mouseClickLeft', pos);\n    }\n};\n\n// BouncerMorph ////////////////////////////////////////////////////////\n\n// I am a Demo of a stepping custom Morph\n\n\n\n// Bouncers inherit from Morph:\n\nBouncerMorph.prototype = new Morph();\nBouncerMorph.prototype.constructor = BouncerMorph;\nBouncerMorph.uber = Morph.prototype;\n\n// BouncerMorph instance creation:\n\nexport function BouncerMorph() {\n    this.init();\n}\n\n// BouncerMorph initialization:\n\nBouncerMorph.prototype.init = function (type, speed) {\n    BouncerMorph.uber.init.call(this);\n    this.fps = 50;\n\n    // additional properties:\n    this.isStopped = false;\n    this.type = type || 'vertical';\n    if (this.type === 'vertical') {\n        this.direction = 'down';\n    } else {\n        this.direction = 'right';\n    }\n    this.speed = speed || 1;\n};\n\n// BouncerMorph moving:\n\nBouncerMorph.prototype.moveUp = function () {\n    this.moveBy(new Point(0, -this.speed));\n};\n\nBouncerMorph.prototype.moveDown = function () {\n    this.moveBy(new Point(0, this.speed));\n};\n\nBouncerMorph.prototype.moveRight = function () {\n    this.moveBy(new Point(this.speed, 0));\n};\n\nBouncerMorph.prototype.moveLeft = function () {\n    this.moveBy(new Point(-this.speed, 0));\n};\n\n// BouncerMorph stepping:\n\nBouncerMorph.prototype.step = function () {\n    if (!this.isStopped) {\n        if (this.type === 'vertical') {\n            if (this.direction === 'down') {\n                this.moveDown();\n            } else {\n                this.moveUp();\n            }\n            if (this.fullBounds().top() < this.parent.top() &&\n                    this.direction === 'up') {\n                this.direction = 'down';\n            }\n            if (this.fullBounds().bottom() > this.parent.bottom() &&\n                    this.direction === 'down') {\n                this.direction = 'up';\n            }\n        } else if (this.type === 'horizontal') {\n            if (this.direction === 'right') {\n                this.moveRight();\n            } else {\n                this.moveLeft();\n            }\n            if (this.fullBounds().left() < this.parent.left() &&\n                    this.direction === 'left') {\n                this.direction = 'right';\n            }\n            if (this.fullBounds().right() > this.parent.right() &&\n                    this.direction === 'right') {\n                this.direction = 'left';\n            }\n        }\n    }\n};\n\n// HandMorph ///////////////////////////////////////////////////////////\n\n// I represent the Mouse cursor\n\n// HandMorph inherits from Morph:\n\nHandMorph.prototype = new Morph();\nHandMorph.prototype.constructor = HandMorph;\nHandMorph.uber = Morph.prototype;\n\n// HandMorph instance creation:\n\nexport function HandMorph(aWorld) {\n    this.init(aWorld);\n}\n\n// HandMorph initialization:\n\nHandMorph.prototype.init = function (aWorld) {\n    HandMorph.uber.init.call(this, true);\n    this.bounds = new Rectangle();\n\n    // additional properties:\n    this.world = aWorld;\n    this.mouseButton = null;\n    this.mouseOverList = [];\n    this.mouseOverBounds = [];\n    this.morphToGrab = null;\n    this.grabPosition = null;\n    this.grabOrigin = null;\n    this.temporaries = [];\n    this.touchHoldTimeout = null;\n    this.contextMenuEnabled = false;\n\n    // properties for caching dragged objects:\n    this.cachedFullImage = null;\n    this.cachedFullBounds = null;\n};\n\n// HandMorph dragging optimizations:\n\nHandMorph.prototype.changed = function () {\n    var b;\n    if (this.world !== null) {\n        b = this.cachedFullBounds || this.fullBounds();\n        if (!b.extent().eq(ZERO)) {\n            this.world.broken.push(b.spread());\n        }\n    }\n};\n\nHandMorph.prototype.moveBy = function (delta) {\n    var children = this.children,\n        i = children.length;\n    this.changed();\n    this.bounds = this.bounds.translateBy(delta);\n    if (this.cachedFullBounds) {\n        this.cachedFullBounds = this.cachedFullBounds.translateBy(delta);\n    }\n    this.changed();\n    for (i; i > 0; i -= 1) {\n        children[i - 1].moveBy(delta);\n    }\n};\n\nHandMorph.prototype.fullChanged = HandMorph.prototype.changed;\n\n// HandMorph display:\n\nHandMorph.prototype.fullDrawOn = function (ctx, rect) {\n    if (!this.cachedFullBounds) {\n        HandMorph.uber.fullDrawOn.call(this, ctx, rect);\n        return;\n    }\n\n    var clipped = rect.intersect(this.cachedFullBounds),\n        pos = this.cachedFullBounds.origin,\n        pic, src, w, h, sl, st;\n\n    if (!clipped.extent().gt(ZERO)) {return; }\n    ctx.save();\n    ctx.globalAlpha = this.alpha;\n    pic = this.cachedFullImage;\n    src = clipped.translateBy(pos.neg());\n    sl = src.left();\n    st = src.top();\n    w = Math.min(src.width(), pic.width - sl);\n    h = Math.min(src.height(), pic.height - st);\n    if (w < 1 || h < 1) {return; }\n    ctx.drawImage(\n        pic,\n        sl,\n        st,\n        w,\n        h,\n        clipped.left(),\n        clipped.top(),\n        w,\n        h\n    );\n    ctx.restore();\n};\n\n// HandMorph navigation:\n\nHandMorph.prototype.morphAtPointer = function () {\n    return this.world.topMorphAt(this.bounds.origin) || this.world;\n};\n\nHandMorph.prototype.allMorphsAtPointer = function () {\n    return this.world.allChildren().filter(m => m.isVisible &&\n        m.visibleBounds().containsPoint(this.bounds.origin) &&\n        !m.holes.some(any =>\n            any.translateBy(m.position()).containsPoint(this.bounds.origin))\n        );\n};\n\n// HandMorph dragging and dropping:\n/*\n    drag 'n' drop events, method(arg) -> receiver:\n\n        prepareToBeGrabbed(handMorph) -> grabTarget\n        reactToGrabOf(grabbedMorph) -> oldParent\n        wantsDropOf(morphToDrop) ->  newParent\n        justDropped(handMorph) -> droppedMorph\n        reactToDropOf(droppedMorph, handMorph) -> newParent\n*/\n\nHandMorph.prototype.dropTargetFor = function (aMorph) {\n    var target = this.morphAtPointer();\n    while (!target.wantsDropOf(aMorph)) {\n        target = target.parent;\n    }\n    return target;\n};\n\nHandMorph.prototype.grab = function (aMorph) {\n    var oldParent = aMorph.parent;\n    if (aMorph instanceof WorldMorph) {\n        return null;\n    }\n    if (this.children.length === 0) {\n        this.world.stopEditing();\n        this.grabOrigin = aMorph.situation();\n        if (aMorph.prepareToBeGrabbed) {\n            aMorph.prepareToBeGrabbed(this);\n        }\n        if (!aMorph.noDropShadow) {\n            aMorph.addShadow();\n        }\n        this.add(aMorph);\n\n        // cache the dragged object's display resources\n        this.cachedFullImage = aMorph.fullImage();\n        this.cachedFullBounds = aMorph.fullBounds();\n\n        this.changed();\n        if (oldParent && oldParent.reactToGrabOf) {\n            oldParent.reactToGrabOf(aMorph);\n        }\n    }\n};\n\nHandMorph.prototype.drop = function () {\n    var target, morphToDrop;\n    this.alpha = 1;\n    if (this.children.length !== 0) {\n        morphToDrop = this.children[0];\n        target = this.dropTargetFor(morphToDrop);\n        target = target.selectForEdit ? target.selectForEdit() : target;\n        this.changed();\n        target.add(morphToDrop);\n        morphToDrop.changed();\n\n        // invalidate dragging-cache\n        this.cachedFullImage = null;\n        this.cachedFullBounds = null;\n\n        if (!morphToDrop.noDropShadow) {\n\t        morphToDrop.removeShadow();\n        }\n        this.children = [];\n        this.setExtent(new Point());\n        if (morphToDrop.justDropped) {\n            morphToDrop.justDropped(this);\n        }\n        if (target.reactToDropOf) {\n            target.reactToDropOf(morphToDrop, this);\n        }\n    }\n};\n\n// HandMorph event dispatching:\n/*\n    mouse events:\n\n        mouseDownLeft\n        mouseDownRight\n        mouseClickLeft\n        mouseClickRight\n        mouseDoubleClick\n        mouseEnter\n        mouseLeave\n        mouseEnterDragging\n        mouseLeaveDragging\n        mouseEnterBounds\n        mouseLeaveBounds\n        mouseMove\n        mouseScroll\n*/\n\nHandMorph.prototype.processMouseDown = function (event) {\n    var morph, actualClick,\n        posInDocument = getDocumentPositionOf(this.world.worldCanvas);\n\n    // update my position, in case I've just been initialized\n    if (event.pageX) {\n        this.setPosition(new Point(\n            event.pageX - posInDocument.x,\n            event.pageY - posInDocument.y\n        ));\n    }\n\n    // process the actual event\n    this.destroyTemporaries();\n    this.contextMenuEnabled = true;\n    this.morphToGrab = null;\n    this.grabPosition = null;\n    if (this.children.length !== 0) {\n        this.drop();\n        this.mouseButton = null;\n    } else {\n        morph = this.morphAtPointer();\n        if (this.world.activeMenu) {\n            if (!contains(\n                    morph.allParents(),\n                    this.world.activeMenu\n                )) {\n                this.world.activeMenu.destroy();\n            } else {\n                clearInterval(this.touchHoldTimeout);\n            }\n        }\n        if (this.world.activeHandle) {\n            if (morph !== this.world.activeHandle) {\n                this.world.activeHandle.destroy();\n            }\n        }\n        if (this.world.cursor) {\n            if (morph !== this.world.cursor.target) {\n                this.world.stopEditing();\n            }\n        }\n        if (!morph.mouseMove) {\n            this.morphToGrab = morph.rootForGrab();\n            this.grabPosition = this.bounds.origin.copy();\n        }\n        if (event.button === 2 || event.ctrlKey) {\n            this.mouseButton = 'right';\n            actualClick = 'mouseDownRight';\n        } else {\n            this.mouseButton = 'left';\n            actualClick = 'mouseDownLeft';\n        }\n        while (!morph[actualClick]) {\n            morph = morph.parent;\n        }\n        morph[actualClick](this.bounds.origin);\n    }\n};\n\nHandMorph.prototype.processTouchStart = function (event) {\n    MorphicPreferences.isTouchDevice = true;\n    clearInterval(this.touchHoldTimeout);\n    if (event.touches.length === 1) {\n        this.touchHoldTimeout = setInterval( // simulate mouseRightClick\n            () => {\n                this.processMouseDown({button: 2});\n                this.processMouseUp({button: 2});\n                event.preventDefault();\n                clearInterval(this.touchHoldTimeout);\n            },\n            400\n        );\n        this.processMouseMove(event.touches[0]); // update my position\n        this.processMouseDown({button: 0});\n        event.preventDefault();\n    }\n};\n\nHandMorph.prototype.processTouchMove = function (event) {\n    MorphicPreferences.isTouchDevice = true;\n    if (event.touches.length === 1) {\n        var touch = event.touches[0];\n        this.processMouseMove(touch);\n        clearInterval(this.touchHoldTimeout);\n    }\n};\n\nHandMorph.prototype.processTouchEnd = function (event) {\n    MorphicPreferences.isTouchDevice = true;\n    clearInterval(this.touchHoldTimeout);\n    nop(event);\n    this.processMouseUp({button: 0});\n};\n\nHandMorph.prototype.processMouseUp = function () {\n    var morph = this.morphAtPointer(),\n        context,\n        contextMenu,\n        expectedClick;\n\n    this.destroyTemporaries();\n    if (this.children.length !== 0) {\n        this.drop();\n    } else {\n        if (this.mouseButton === 'left') {\n            expectedClick = 'mouseClickLeft';\n        } else {\n            expectedClick = 'mouseClickRight';\n            if (this.mouseButton && this.contextMenuEnabled) {\n                context = morph;\n                contextMenu = context.contextMenu();\n                while ((!contextMenu) &&\n                        context.parent) {\n                    context = context.parent;\n                    contextMenu = context.contextMenu();\n                }\n                if (contextMenu) {\n                    contextMenu.popUpAtHand(this.world);\n                }\n            }\n        }\n        while (!morph[expectedClick]) {\n            morph = morph.parent;\n        }\n        morph[expectedClick](this.bounds.origin);\n    }\n    this.mouseButton = null;\n};\n\nHandMorph.prototype.processDoubleClick = function () {\n    var morph = this.morphAtPointer();\n\n    this.destroyTemporaries();\n    if (this.children.length !== 0) {\n        this.drop();\n    } else {\n        while (morph && !morph.mouseDoubleClick) {\n            morph = morph.parent;\n        }\n        if (morph) {\n            morph.mouseDoubleClick(this.bounds.origin);\n        }\n    }\n    this.mouseButton = null;\n};\n\nHandMorph.prototype.processMouseMove = function (event) {\n    var pos,\n        posInDocument = getDocumentPositionOf(this.world.worldCanvas),\n        mouseOverNew,\n        mouseOverBoundsNew,\n        morph,\n        topMorph;\n\n    pos = new Point(\n        event.pageX - posInDocument.x,\n        event.pageY - posInDocument.y\n    );\n\n    this.setPosition(pos);\n\n    // determine the new mouse-over-list:\n    mouseOverNew = this.morphAtPointer().allParents();\n    mouseOverBoundsNew = mouseOverNew.filter(m => m.isVisible &&\n        m.visibleBounds().containsPoint(this.bounds.origin) &&\n            !m.holes.some(any =>\n                any.translateBy(m.position()).containsPoint(this.bounds.origin))\n    );\n\n    if (!this.children.length && this.mouseButton) {\n        topMorph = this.morphAtPointer();\n        morph = topMorph.rootForGrab();\n        if (topMorph.mouseMove) {\n            topMorph.mouseMove(pos, this.mouseButton);\n            if (this.mouseButton === 'right') {\n                this.contextMenuEnabled = false;\n            }\n        }\n\n        // if a morph is marked for grabbing, just grab it\n        if (this.mouseButton === 'left' &&\n                this.morphToGrab &&\n                (this.grabPosition.distanceTo(this.bounds.origin) >\n                    MorphicPreferences.grabThreshold)) {\n            this.setPosition(this.grabPosition);\n            if (this.morphToGrab.isDraggable) {\n                morph = this.morphToGrab.selectForEdit ?\n                        this.morphToGrab.selectForEdit() : this.morphToGrab;\n                this.grab(morph);\n            } else if (this.morphToGrab.isTemplate) {\n                this.world.stopEditing();\n                morph = this.morphToGrab.fullCopy();\n                morph.isTemplate = false;\n                morph.isDraggable = true;\n                if (morph.reactToTemplateCopy) {\n                    morph.reactToTemplateCopy();\n                }\n                this.grab(morph);\n                this.grabOrigin = this.morphToGrab.situation();\n            }\n            this.setPosition(pos);\n        }\n    }\n\n    this.mouseOverBounds.forEach(old => {\n        if (!contains(mouseOverBoundsNew, old)) {\n            if (old.mouseLeaveBounds) {\n                old.mouseLeaveBounds(this.children[0]);\n            }\n        }\n    });\n    mouseOverBoundsNew.forEach(newMorph => {\n        if (!contains(this.mouseOverBounds, newMorph)) {\n            if (newMorph.mouseEnterBounds) {\n                newMorph.mouseEnterBounds(this.children[0]);\n            }\n        }\n    });\n\n    this.mouseOverList.forEach(old => {\n        if (!contains(mouseOverNew, old)) {\n            if (old.mouseLeave) {\n                old.mouseLeave();\n            }\n            if (old.mouseLeaveDragging && this.mouseButton) {\n                old.mouseLeaveDragging(this.children[0]);\n            }\n        }\n    });\n    mouseOverNew.forEach(newMorph => {\n        if (!contains(this.mouseOverList, newMorph)) {\n            if (newMorph.mouseEnter) {\n                newMorph.mouseEnter();\n            }\n            if (newMorph.mouseEnterDragging && this.mouseButton) {\n                newMorph.mouseEnterDragging(this.children[0]);\n            }\n        }\n\n        // autoScrolling support:\n        if (this.children.length > 0) {\n            if (newMorph instanceof ScrollFrameMorph &&\n                    newMorph.enableAutoScrolling &&\n                    newMorph.contents.allChildren().some(any => {\n                        return any.wantsDropOf(this.children[0]);\n                    })\n            ) {\n                if (!newMorph.bounds.insetBy(\n                        MorphicPreferences.scrollBarSize * 3\n                    ).containsPoint(this.bounds.origin)) {\n                    newMorph.startAutoScrolling();\n                }\n            }\n        }\n    });\n    this.mouseOverList = mouseOverNew;\n    this.mouseOverBounds = mouseOverBoundsNew;\n};\n\nHandMorph.prototype.processMouseScroll = function (event) {\n    var morph = this.morphAtPointer();\n    while (morph && !morph.mouseScroll) {\n        morph = morph.parent;\n    }\n    if (morph) {\n        morph.mouseScroll(\n            (event.detail / -3) || (\n                Object.prototype.hasOwnProperty.call(\n                    event,\n                    'wheelDeltaY'\n                ) ?\n                        event.wheelDeltaY / 120 :\n                        event.wheelDelta / 120\n            ),\n            event.wheelDeltaX / 120 || 0\n        );\n    }\n};\n\n/*\n    drop event:\n\n        droppedImage\n        droppedSVG\n        droppedAudio\n        droppedText\n*/\n\nHandMorph.prototype.processDrop = function (event) {\n/*\n    find out whether an external image or audio file was dropped\n    onto the world canvas, turn it into an offscreen canvas or audio\n    element and dispatch the\n\n        droppedImage(canvas, name)\n        droppedSVG(image, name)\n        droppedAudio(audio, name)\n        droppedText(text, name, type)\n\n    events to interested Morphs at the mouse pointer\n*/\n    var files = event instanceof FileList ? event\n                : event.target.files || event.dataTransfer.files,\n        file,\n        url = event.dataTransfer ?\n                event.dataTransfer.getData('URL') : null,\n        txt = event.dataTransfer ?\n                event.dataTransfer.getData('Text/HTML') : null,\n        suffix,\n        src,\n        target = this.morphAtPointer(),\n        img = new Image(),\n        canvas,\n        i;\n\n    function readSVG(aFile) {\n        var pic = new Image(),\n            frd = new FileReader();\n        while (!target.droppedSVG) {\n            target = target.parent;\n        }\n        pic.onload = () => target.droppedSVG(pic, aFile.name);\n        frd = new FileReader();\n        frd.onloadend = (e) => pic.src = e.target.result;\n        frd.readAsDataURL(aFile);\n    }\n\n    function readImage(aFile) {\n        var pic = new Image(),\n            frd = new FileReader();\n        while (!target.droppedImage) {\n            target = target.parent;\n        }\n        pic.onload = () => {\n            canvas = newCanvas(new Point(pic.width, pic.height), true);\n            canvas.getContext('2d').drawImage(pic, 0, 0);\n            target.droppedImage(canvas, aFile.name);\n        };\n        frd = new FileReader();\n        frd.onloadend = (e) => pic.src = e.target.result;\n        frd.readAsDataURL(aFile);\n    }\n\n    function readAudio(aFile) {\n        var snd = new Audio(),\n            frd = new FileReader();\n        while (!target.droppedAudio) {\n            target = target.parent;\n        }\n        frd.onloadend = (e) => {\n            snd.src = e.target.result;\n            target.droppedAudio(snd, aFile.name);\n        };\n        frd.readAsDataURL(aFile);\n    }\n\n    function readText(aFile) {\n        var frd = new FileReader();\n        while (!target.droppedText) {\n            target = target.parent;\n        }\n        frd.onloadend = (e) => {\n            target.droppedText(e.target.result, aFile.name, aFile.type);\n        };\n        frd.readAsText(aFile);\n    }\n\n    function readBinary(aFile) {\n        var frd = new FileReader();\n        while (!target.droppedBinary) {\n            target = target.parent;\n        }\n        frd.onloadend = (e) => {\n            target.droppedBinary(e.target.result, aFile.name);\n        };\n        frd.readAsArrayBuffer(aFile);\n    }\n\n    function readURL(url, callback) {\n        var request = new XMLHttpRequest();\n        request.open('GET', url);\n        request.onreadystatechange = () => {\n            if (request.readyState === 4) {\n                if (request.responseText) {\n                    callback(request.responseText);\n                } else {\n                    throw new Error('unable to retrieve ' + url);\n                }\n            }\n        };\n        request.send();\n    }\n\n    function parseImgURL(html) {\n        var iurl = '',\n            idx,\n            c,\n            start = html.indexOf('<img src=\"');\n        if (start === -1) {return null; }\n        start += 10;\n        for (idx = start; idx < html.length; idx += 1) {\n            c = html[idx];\n            if (c === '\"') {\n                return iurl;\n            }\n            iurl = iurl.concat(c);\n        }\n        return null;\n    }\n\n    if (files.length > 0) {\n        for (i = 0; i < files.length; i += 1) {\n            file = files[i];\n            suffix = file.name.slice(\n                file.name.lastIndexOf('.') + 1\n            ).toLowerCase();\n            if (file.type.indexOf(\"svg\") !== -1\n                    && !MorphicPreferences.rasterizeSVGs) {\n                readSVG(file);\n            } else if (file.type.indexOf(\"image\") === 0) {\n                readImage(file);\n            } else if (file.type.indexOf(\"audio\") === 0 ||\n                    file.type.indexOf(\"ogg\") > -1) {\n                    // check the file-extension because Firefox\n                    // thinks OGGs are videos\n                readAudio(file);\n            } else if ((file.type.indexOf(\"text\") === 0) ||\n                    contains(['txt', 'csv', 'json'], suffix)) {\n                    // check the file-extension because Windows\n                    // doesn't specify CSVs to be text/csv, sigh\n                readText(file);\n            } else { // assume it's meant to be binary\n                readBinary(file);\n            }\n        }\n    } else if (url) {\n        suffix = url.slice(url.lastIndexOf('.') + 1).toLowerCase();\n        if (\n            contains(\n                ['gif', 'png', 'jpg', 'jpeg', 'bmp'],\n                suffix\n            )\n        ) {\n            while (!target.droppedImage) {\n                target = target.parent;\n            }\n            img = new Image();\n            img.onload = () => {\n                canvas = newCanvas(new Point(img.width, img.height), true);\n                canvas.getContext('2d').drawImage(img, 0, 0);\n                target.droppedImage(canvas);\n            };\n            img.src = url;\n        } else if (suffix === 'svg' && !MorphicPreferences.rasterizeSVGs) {\n            while (!target.droppedSVG) {\n                target = target.parent;\n            }\n            readURL(\n                url,\n                txt => {\n                    var pic = new Image();\n                    pic.onload = () => {\n                        target.droppedSVG(\n                            pic,\n                            url.slice(\n                                url.lastIndexOf('/') + 1,\n                                url.lastIndexOf('.')\n                            )\n                        );\n                    };\n                    pic.src = 'data:image/svg+xml;utf8,' +\n                        encodeURIComponent(txt);\n                }\n            );\n        }\n    } else if (txt) {\n        while (!target.droppedImage) {\n            target = target.parent;\n        }\n        img = new Image();\n        img.onload = () => {\n            canvas = newCanvas(new Point(img.width, img.height), true);\n            canvas.getContext('2d').drawImage(img, 0, 0);\n            target.droppedImage(canvas);\n        };\n        src = parseImgURL(txt);\n        if (src) {img.src = src; }\n    }\n};\n\n// HandMorph tools\n\nHandMorph.prototype.destroyTemporaries = function () {\n/*\n    temporaries are just an array of morphs which will be deleted upon\n    the next mouse click, or whenever another temporary Morph decides\n    that it needs to remove them. The primary purpose of temporaries is\n    to display tools tips of speech bubble help.\n*/\n    this.temporaries.forEach(morph => {\n        if (!(morph.isClickable\n                && morph.bounds.containsPoint(this.position()))) {\n            morph.destroy();\n            this.temporaries.splice(this.temporaries.indexOf(morph), 1);\n        }\n    });\n};\n\n// WorldMorph //////////////////////////////////////////////////////////\n\n// I represent the <canvas> element\n\n// WorldMorph inherits from FrameMorph:\n\nWorldMorph.prototype = new FrameMorph();\nWorldMorph.prototype.constructor = WorldMorph;\nWorldMorph.uber = FrameMorph.prototype;\n\n// WorldMorph global settings & examples\n\nWorldMorph.prototype.customMorphs = [];\n\n// WorldMorph instance creation:\n\nexport function WorldMorph(aCanvas, fillPage) {\n    this.init(aCanvas, fillPage);\n}\n\n// WorldMorph initialization:\n\nWorldMorph.prototype.init = function (aCanvas, fillPage) {\n    WorldMorph.uber.init.call(this);\n    this.color = new Color(205, 205, 205);\n    this.alpha = 1;\n    this.bounds = new Rectangle(0, 0, aCanvas.width, aCanvas.height);\n    this.isVisible = true;\n    this.isDraggable = false;\n    this.currentKey = null; // currently pressed key code\n    this.worldCanvas = aCanvas;\n\n    // additional properties:\n    this.stamp = Date.now(); // reference in multi-world setups\n    while (this.stamp === Date.now()) {nop(); }\n    this.stamp = Date.now();\n\n    this.useFillPage = fillPage;\n    if (this.useFillPage === undefined) {\n        this.useFillPage = true;\n    }\n    this.isDevMode = false;\n    this.broken = [];\n    this.animations = [];\n    this.hand = new HandMorph(this);\n    this.keyboardHandler = null;\n    this.keyboardFocus = null;\n    this.cursor = null;\n    this.lastEditedText = null;\n    this.activeMenu = null;\n    this.activeHandle = null;\n\n    this.initKeyboardHandler();\n    this.resetKeyboardHandler();\n    this.initEventListeners();\n};\n\n// World Morph display:\n\nWorldMorph.prototype.fullDrawOn = function (aContext, aRect) {\n    WorldMorph.uber.fullDrawOn.call(this, aContext, aRect);\n    this.hand.fullDrawOn(aContext, aRect);\n};\n\nWorldMorph.prototype.updateBroken = function () {\n    var ctx = this.worldCanvas.getContext('2d');\n    this.condenseDamages();\n    this.broken.forEach(rect => {\n        if (rect.extent().gt(ZERO)) {\n            this.fullDrawOn(ctx, rect);\n        }\n    });\n    this.broken = [];\n};\n\nWorldMorph.prototype.stepAnimations = function () {\n    this.animations.forEach(anim => anim.step());\n    this.animations = this.animations.filter(anim => anim.isActive);\n};\n\nWorldMorph.prototype.condenseDamages = function () {\n    // collapse clustered damaged rectangles into their unions,\n    // thereby reducing the array of brokens to a manageable size\n\n    function condense(src) {\n        var trgt = [],\n            len = src.length,\n            rect,\n            test = each => each.isNearTo(rect, 20),\n            hit, i;\n\n        for (i = 0; i < len; i += 1) {\n            rect = src[i];\n            hit = detect(trgt, test);\n            if (hit) {\n                hit.mergeWith(rect);\n            } else {\n                trgt.push(rect);\n            }\n        }\n        return trgt;\n    }\n\n    function mergeAll(rects) {\n        var left = rects[0].origin.x,\n            top = rects[0].origin.y,\n            right = rects[0].corner.x,\n            bottom = rects[0].corner.y,\n            len = rects.length,\n            each,\n            i;\n\n        for (i = 1; i < len; i += 1) {\n            each = rects[i];\n            left = Math.min(left, each.origin.x);\n            top = Math.min(top, each.origin.y);\n            right = Math.max(right, each.corner.x);\n            bottom = Math.max(bottom, each.corner.y);\n        }\n\n        return new Rectangle(left, top, right, bottom);\n    }\n\n    if (this.broken.length > 1000) {\n        this.broken = [mergeAll(this.broken)];\n    } else {\n        this.broken = condense(this.broken);\n    }\n\n    /* // overly eager reduction algorithm, commented out for performance\n    var again = true,\n        size = this.broken.length;\n\n    while (again) {\n        this.broken = condense(this.broken);\n        again = (this.broken.length < size);\n        size = this.broken.length;\n    }\n    */\n};\n\nWorldMorph.prototype.doOneCycle = function () {\n    this.stepFrame();\n    this.stepAnimations();\n    this.updateBroken();\n};\n\nWorldMorph.prototype.fillPage = function () {\n    var clientHeight = window.innerHeight,\n        clientWidth = window.innerWidth;\n\n    this.worldCanvas.style.position = \"absolute\";\n    this.worldCanvas.style.left = \"0px\";\n    this.worldCanvas.style.right = \"0px\";\n    this.worldCanvas.style.width = \"100%\";\n    this.worldCanvas.style.height = \"100%\";\n\n    if (document.documentElement.scrollTop) {\n        // scrolled down b/c of viewport scaling\n        clientHeight = document.documentElement.clientHeight;\n    }\n    if (document.documentElement.scrollLeft) {\n        // scrolled left b/c of viewport scaling\n        clientWidth = document.documentElement.clientWidth;\n    }\n    if (this.worldCanvas.width !== clientWidth) {\n        this.worldCanvas.width = clientWidth;\n        this.setWidth(clientWidth);\n    }\n    if (this.worldCanvas.height !== clientHeight) {\n        this.worldCanvas.height = clientHeight;\n        this.setHeight(clientHeight);\n    }\n    this.children.forEach(child => {\n        if (child.reactToWorldResize) {\n            child.reactToWorldResize(this.bounds.copy());\n        }\n    });\n};\n\n// WorldMorph global pixel access:\n\nWorldMorph.prototype.getGlobalPixelColor = function (point) {\n    // answer the color at the given point.\n    var dta = this.worldCanvas.getContext('2d').getImageData(\n        point.x,\n        point.y,\n        1,\n        1\n    ).data;\n    return new Color(dta[0], dta[1], dta[2]);\n};\n\n// WorldMorph events:\n\nWorldMorph.prototype.initKeyboardHandler = function () {\n    var kbd = document.getElementById('morphic_keyboard');\n    if (kbd) { // share existing handler with other worlds\n        this.keyboardHandler = kbd;\n        return;\n    }\n    kbd = document.createElement('textarea');\n    kbd.setAttribute('id', 'morphic_keyboard');\n    kbd.setAttribute('style', 'caret-color:transparent;');\n    kbd.style.position = 'absolute';\n    kbd.style.overflow = \"hidden\";\n    kbd.style.border = 'none';\n    kbd.style.resize = 'none';\n    kbd.wrap = \"off\";\n    kbd.world = this;\n    kbd.style.zIndex = -1;\n    kbd.autofocus = true;\n    document.body.appendChild(kbd);\n    this.keyboardHandler = kbd;\n\n    kbd.addEventListener(\n        \"keydown\",\n         event => {\n            // remember the keyCode in the world's currentKey property\n            kbd.world.currentKey = event.keyCode;\n            if (kbd.world.activeMenu && !kbd.world.activeMenu.hasFocus) {\n                kbd.world.stopEditing();\n                kbd.world.activeMenu.getFocus();\n            }\n            if (kbd.world.keyboardFocus &&\n                    kbd.world.keyboardFocus.processKeyDown) {\n                kbd.world.keyboardFocus.processKeyDown(event);\n            }\n            // suppress tab override and make sure tab gets\n            // received by all browsers\n            if (event.keyCode === 9) {\n                if (kbd.world.keyboardFocus &&\n                        kbd.world.keyboardFocus.processKeyPress) {\n                    kbd.world.keyboardFocus.processKeyPress(event);\n                }\n                event.preventDefault();\n            }\n            // suppress cmd-d/f/i/p/s override\n            if ((event.ctrlKey || event.metaKey) &&\n                    'dfips'.includes(event.key)) {\n                event.preventDefault();\n            }\n        },\n        true\n    );\n\n    kbd.addEventListener(\n        \"keyup\",\n        event => {\n            // flush the world's currentKey property\n            kbd.world.currentKey = null;\n            // dispatch to keyboard receiver\n            if (kbd.world.keyboardFocus &&\n                    kbd.world.keyboardFocus.processKeyUp) {\n                kbd.world.keyboardFocus.processKeyUp(event);\n            }\n            event.preventDefault();\n        },\n        false\n    );\n\n    kbd.addEventListener(\n        \"keypress\",\n        event => {\n            if (kbd.world.keyboardFocus &&\n                    kbd.world.keyboardFocus.processKeyPress) {\n                kbd.world.keyboardFocus.processKeyPress(event);\n                event.preventDefault();\n            }\n        },\n        false\n    );\n\n    kbd.addEventListener(\n        \"input\",\n        event => {\n            if (kbd.world.keyboardFocus &&\n                    kbd.world.keyboardFocus.processInput) {\n                // flush the world's currentKey property\n                kbd.world.currentKey = null;\n                kbd.world.keyboardFocus.processInput(event);\n            } else {\n                kbd.world.keyboardHandler.value = '';\n            }\n            event.preventDefault();\n        },\n        false\n    );\n};\n\nWorldMorph.prototype.resetKeyboardHandler = function (keepValue) {\n    var pos = getDocumentPositionOf(this.worldCanvas);\n\n    function number2px (n) {\n        return Math.ceil(n) + 'px';\n    }\n\n    if (!keepValue) {\n        this.keyboardHandler.value = '';\n    }\n    this.keyboardHandler.style.top = number2px(pos.y);\n    this.keyboardHandler.style.left = number2px(pos.x);\n};\n\nWorldMorph.prototype.initEventListeners = function () {\n    var canvas = this.worldCanvas;\n\n    if (this.useFillPage) {\n        this.fillPage();\n    } else {\n        this.changed();\n    }\n\n    canvas.addEventListener(\n        \"mousedown\",\n        event => {\n            event.preventDefault();\n            this.keyboardHandler.world = this; // focus the current world\n            this.resetKeyboardHandler(true); // keep the handler's value\n            if (!this.onNextStep) {\n                // horrible kludge to keep Safari from popping up\n                // a overlay when right-clicking out of a focused\n                // and edited text or string element\n                this.keyboardHandler.blur();\n                this.onNextStep = () => this.keyboardHandler.focus();\n            }\n            this.hand.processMouseDown(event);\n        },\n        true\n    );\n\n    canvas.addEventListener(\n        \"touchstart\",\n        event => this.hand.processTouchStart(event),\n        false\n    );\n\n    canvas.addEventListener(\n        \"mouseup\",\n        event => {\n            event.preventDefault();\n            this.hand.processMouseUp(event);\n        },\n        false\n    );\n\n    canvas.addEventListener(\n        \"dblclick\",\n        event => {\n            event.preventDefault();\n            this.hand.processDoubleClick(event);\n        },\n        false\n    );\n\n    canvas.addEventListener(\n        \"touchend\",\n        event => this.hand.processTouchEnd(event),\n        false\n    );\n\n    canvas.addEventListener(\n        \"mousemove\",\n        event => this.hand.processMouseMove(event),\n        false\n    );\n\n    canvas.addEventListener(\n        \"touchmove\",\n        event => this.hand.processTouchMove(event),\n        {passive: true}\n    );\n\n    canvas.addEventListener(\n        \"contextmenu\",\n        event => event.preventDefault(),\n        true // suppress context menu for Mac-Firefox\n    );\n\n    canvas.addEventListener( // Safari, Chrome\n        \"mousewheel\",\n        event => {\n            this.hand.processMouseScroll(event);\n            event.preventDefault();\n        },\n        false\n    );\n    canvas.addEventListener( // Firefox\n        \"DOMMouseScroll\",\n        event => {\n            this.hand.processMouseScroll(event);\n            event.preventDefault();\n        },\n        false\n    );\n\n    window.addEventListener(\n        \"dragover\",\n        event => event.preventDefault(),\n        true\n    );\n    window.addEventListener(\n        \"drop\",\n        event => {\n            this.hand.processDrop(event);\n            event.preventDefault();\n        },\n        false\n    );\n\n    window.addEventListener(\n        \"resize\",\n        () => {\n            if (this.useFillPage) {\n                this.fillPage();\n            }\n        },\n        false\n    );\n\n    window.onbeforeunload = (evt) => {\n        var e = evt || window.event,\n            msg = \"Are you sure you want to leave?\";\n        // For IE and Firefox\n        if (e) {\n            e.returnValue = msg;\n        }\n        // For Safari / chrome\n        return msg;\n    };\n};\n\nWorldMorph.prototype.mouseDownLeft = nop;\n\nWorldMorph.prototype.mouseClickLeft = nop;\n\nWorldMorph.prototype.mouseDownRight = nop;\n\nWorldMorph.prototype.mouseClickRight = nop;\n\nWorldMorph.prototype.wantsDropOf = function () {\n    // allow handle drops if any drops are allowed\n    return this.acceptsDrops;\n};\n\nWorldMorph.prototype.droppedImage = function () {\n    return null;\n};\n\nWorldMorph.prototype.droppedSVG = function () {\n    return null;\n};\n\n// WorldMorph text field tabbing:\n\nWorldMorph.prototype.nextTab = function (editField) {\n    var next = this.nextEntryField(editField);\n    if (next) {\n        editField.clearSelection();\n        next.selectAll();\n        next.edit();\n    }\n};\n\nWorldMorph.prototype.previousTab = function (editField) {\n    var prev = this.previousEntryField(editField);\n    if (prev) {\n        editField.clearSelection();\n        prev.selectAll();\n        prev.edit();\n    }\n};\n\n// WorldMorph menu:\n\nWorldMorph.prototype.contextMenu = function () {\n    var menu;\n\n    if (this.isDevMode) {\n        menu = new MenuMorph(this, this.constructor.name ||\n            this.constructor.toString().split(' ')[1].split('(')[0]);\n    } else {\n        menu = new MenuMorph(this, 'Morphic');\n    }\n    if (this.isDevMode) {\n        menu.addItem(\"demo...\", 'userCreateMorph', 'sample morphs');\n        menu.addLine();\n        menu.addItem(\"hide all...\", 'hideAll');\n        menu.addItem(\"show all...\", 'showAllHiddens');\n        menu.addItem(\n            \"move all inside...\",\n            'keepAllSubmorphsWithin',\n            'keep all submorphs\\nwithin and visible'\n        );\n        menu.addItem(\n            \"inspect...\",\n            'inspect',\n            'open a window on\\nall properties'\n        );\n        menu.addItem(\n            \"screenshot...\",\n            () => window.open(this.fullImage().toDataURL()),\n            'open a new window\\nwith a picture of this morph'\n        );\n        menu.addLine();\n        menu.addItem(\n            \"restore display\",\n            'changed',\n            'redraw the\\nscreen once'\n        );\n        menu.addItem(\n            \"fill page...\",\n            'fillPage',\n            'let the World automatically\\nadjust to browser resizing'\n        );\n        if (useBlurredShadows) {\n            menu.addItem(\n                \"sharp shadows...\",\n                'toggleBlurredShadows',\n                'sharp drop shadows\\nuse for old browsers'\n            );\n        } else {\n            menu.addItem(\n                \"blurred shadows...\",\n                'toggleBlurredShadows',\n                'blurry shades,\\n use for new browsers'\n            );\n        }\n        menu.addItem(\n            \"color...\",\n            () => {\n                this.pickColor(\n                    menu.title + localize('\\ncolor:'),\n                    this.setColor,\n                    this,\n                    this.color\n                );\n            },\n            'choose the World\\'s\\nbackground color'\n        );\n        if (MorphicPreferences === standardSettings) {\n            menu.addItem(\n                \"touch screen settings\",\n                'togglePreferences',\n                'bigger menu fonts\\nand sliders'\n            );\n        } else {\n            menu.addItem(\n                \"standard settings\",\n                'togglePreferences',\n                'smaller menu fonts\\nand sliders'\n            );\n        }\n        if (MorphicPreferences.showHoles) {\n            menu.addItem(\n                'hide holes',\n                'toggleHolesDisplay',\n                'debug untouchable regions'\n            );\n        } else {\n            menu.addItem(\n                'show holes',\n                'toggleHolesDisplay',\n                'debug untouchable regions'\n            );\n        }\n        menu.addLine();\n    }\n    if (this.isDevMode) {\n        menu.addItem(\n            \"user mode...\",\n            'toggleDevMode',\n            'disable developers\\'\\ncontext menus'\n        );\n    } else {\n        menu.addItem(\"development mode...\", 'toggleDevMode');\n    }\n    menu.addItem(\"about morphic.js...\", 'about');\n    return menu;\n};\n\nWorldMorph.prototype.userCreateMorph = function () {\n    var myself = this, menu, newMorph;\n\n    function create(aMorph) {\n        var cpy = aMorph.fullCopy();\n        cpy.isDraggable = true;\n        cpy.pickUp(myself);\n    }\n\n    menu = new MenuMorph(this, 'make a morph');\n    menu.addItem('rectangle', () => create(new Morph()));\n    menu.addItem('box', () => create(new BoxMorph()));\n    menu.addItem('circle box', () => create(new CircleBoxMorph()));\n    menu.addLine();\n    menu.addItem('slider', () => create(new SliderMorph()));\n    menu.addItem('dial', () => {\n    \tnewMorph = new DialMorph();\n     \tnewMorph.pickUp(this);\n    });\n    menu.addItem('frame', () => {\n        newMorph = new FrameMorph();\n        newMorph.setExtent(new Point(350, 250));\n        create(newMorph);\n    });\n    menu.addItem('scroll frame', () => {\n        newMorph = new ScrollFrameMorph();\n        newMorph.contents.acceptsDrops = true;\n        newMorph.contents.adjustBounds();\n        newMorph.setExtent(new Point(350, 250));\n        create(newMorph);\n    });\n    menu.addItem('handle', () => create(new HandleMorph()));\n    menu.addLine();\n    menu.addItem('string', () => {\n        newMorph = new StringMorph('Hello, World!');\n        newMorph.isEditable = true;\n        create(newMorph);\n    });\n    menu.addItem('text', () => {\n        newMorph = new TextMorph(\n            \"Ich wei\\u00DF nicht, was soll es bedeuten, dass ich so \" +\n                \"traurig bin, ein M\\u00E4rchen aus uralten Zeiten, das \" +\n                \"kommt mir nicht aus dem Sinn. Die Luft ist k\\u00FChl \" +\n                \"und es dunkelt, und ruhig flie\\u00DFt der Rhein; der \" +\n                \"Gipfel des Berges funkelt im Abendsonnenschein. \" +\n                \"Die sch\\u00F6nste Jungfrau sitzet dort oben wunderbar, \" +\n                \"ihr gold'nes Geschmeide blitzet, sie k\\u00E4mmt ihr \" +\n                \"goldenes Haar, sie k\\u00E4mmt es mit goldenem Kamme, \" +\n                \"und singt ein Lied dabei; das hat eine wundersame, \" +\n                \"gewalt'ge Melodei. Den Schiffer im kleinen \" +\n                \"Schiffe, ergreift es mit wildem Weh; er schaut \" +\n                \"nicht die Felsenriffe, er schaut nur hinauf in \" +\n                \"die H\\u00F6h'. Ich glaube, die Wellen verschlingen \" +\n                \"am Ende Schiffer und Kahn, und das hat mit ihrem \" +\n                \"Singen, die Loreley getan.\"\n        );\n        newMorph.isEditable = true;\n        newMorph.maxWidth = 300;\n        newMorph.fixLayout();\n        create(newMorph);\n    });\n    menu.addItem('speech bubble', () => {\n        newMorph = new SpeechBubbleMorph('Hello, World!');\n        create(newMorph);\n    });\n    menu.addLine();\n    menu.addItem('gray scale palette', () => create(new GrayPaletteMorph()));\n    menu.addItem('color palette', () => create(new ColorPaletteMorph()));\n    menu.addItem('color picker', () => create(new ColorPickerMorph()));\n    menu.addLine();\n    menu.addItem('sensor demo', () => {\n        newMorph = new MouseSensorMorph();\n        newMorph.setColor(new Color(230, 200, 100));\n        newMorph.edge = 35;\n        newMorph.border = 15;\n        newMorph.borderColor = new Color(200, 100, 50);\n        newMorph.alpha = 0.2;\n        newMorph.setExtent(new Point(100, 100));\n        create(newMorph);\n    });\n    menu.addItem('animation demo', () => {\n        var foo, bar, baz, garply, fred;\n\n        foo = new BouncerMorph();\n        foo.setPosition(new Point(50, 20));\n        foo.setExtent(new Point(300, 200));\n        foo.alpha = 0.9;\n        foo.speed = 3;\n\n        bar = new BouncerMorph();\n        bar.setColor(new Color(50, 50, 50));\n        bar.setPosition(new Point(80, 80));\n        bar.setExtent(new Point(80, 250));\n        bar.type = 'horizontal';\n        bar.direction = 'right';\n        bar.alpha = 0.9;\n        bar.speed = 5;\n\n        baz = new BouncerMorph();\n        baz.setColor(new Color(20, 20, 20));\n        baz.setPosition(new Point(90, 140));\n        baz.setExtent(new Point(40, 30));\n        baz.type = 'horizontal';\n        baz.direction = 'right';\n        baz.speed = 3;\n\n        garply = new BouncerMorph();\n        garply.setColor(new Color(200, 20, 20));\n        garply.setPosition(new Point(90, 140));\n        garply.setExtent(new Point(20, 20));\n        garply.type = 'vertical';\n        garply.direction = 'up';\n        garply.speed = 8;\n\n        fred = new BouncerMorph();\n        fred.setColor(new Color(20, 200, 20));\n        fred.setPosition(new Point(120, 140));\n        fred.setExtent(new Point(20, 20));\n        fred.type = 'vertical';\n        fred.direction = 'down';\n        fred.speed = 4;\n\n        bar.add(garply);\n        bar.add(baz);\n        foo.add(fred);\n        foo.add(bar);\n\n        create(foo);\n    });\n    menu.addItem('pen', () => create(new PenMorph()));\n    if (this.customMorphs.length) {\n        menu.addLine();\n        this.customMorphs.forEach(item => {\n            var sub;\n            if (item instanceof Array) { // assume [name, [morphs]]\n                sub = new MenuMorph();\n                item[1].forEach(morph => sub.addItem(morph,\n                    () => create(morph instanceof Array ? morph[0] : morph)));\n                menu.addMenu(item[0], sub);\n            } else { // assume a Morph\n                menu.addItem(item.toString(), () => create(item));\n            }\n        });\n    }\n    menu.popUpAtHand(this);\n};\n\nWorldMorph.prototype.toggleDevMode = function () {\n    this.isDevMode = !this.isDevMode;\n};\n\nWorldMorph.prototype.hideAll = function () {\n    this.children.forEach(child => child.hide());\n};\n\nWorldMorph.prototype.showAllHiddens = function () {\n    this.forAllChildren(child => {\n        if (!child.isVisible) {\n            child.show();\n        }\n    });\n};\n\nWorldMorph.prototype.about = function () {\n    var versions = '', module;\n\n    for (module in modules) {\n        if (Object.prototype.hasOwnProperty.call(modules, module)) {\n            versions += ('\\n' + module + ' (' + modules[module] + ')');\n        }\n    }\n    if (versions !== '') {\n        versions = '\\n\\nmodules:\\n\\n' +\n            'morphic (' + morphicVersion + ')' +\n            versions;\n    }\n\n    this.inform(\n        'morphic.js\\n\\n' +\n            'a lively Web GUI\\ninspired by Squeak\\n' +\n            morphicVersion +\n            '\\n\\nwritten by Jens M\\u00F6nig\\njens@moenig.org' +\n            versions\n    );\n};\n\nWorldMorph.prototype.edit = function (aStringOrTextMorph) {\n    if (this.lastEditedText === aStringOrTextMorph) {\n        return;\n    }\n    if (!isNil(this.lastEditedText)) {\n        this.stopEditing();\n    }\n    if (!aStringOrTextMorph.isEditable) {\n        return null;\n    }\n    if (this.cursor) {\n        this.cursor.destroy();\n    }\n\n    // some magic we apparently need for Android\n    this.worldCanvas.focus();\n    this.keyboardHandler.focus();\n\n    // create a new cursor\n    this.cursor = new CursorMorph(aStringOrTextMorph, this.keyboardHandler);\n    this.keyboardFocus = this.cursor;\n    aStringOrTextMorph.parent.add(this.cursor);\n    if (MorphicPreferences.useSliderForInput) {\n        if (!aStringOrTextMorph.parentThatIsA(MenuMorph)) {\n            this.slide(aStringOrTextMorph);\n        }\n    }\n    if (this.lastEditedText !== aStringOrTextMorph) {\n        aStringOrTextMorph.escalateEvent('freshTextEdit', aStringOrTextMorph);\n    }\n    this.lastEditedText = aStringOrTextMorph;\n};\n\nWorldMorph.prototype.slide = function (aStringOrTextMorph) {\n    // display a slider for numeric text entries\n    var val = parseFloat(aStringOrTextMorph.text),\n        menu,\n        slider;\n\n    if (isNaN(val)) {\n        val = 0;\n    }\n    menu = new MenuMorph();\n    slider = new SliderMorph(\n        val - 25,\n        val + 25,\n        val,\n        10,\n        'horizontal'\n    );\n    slider.alpha = 1;\n    slider.color = new Color(225, 225, 225);\n    slider.button.color = menu.borderColor;\n    slider.button.highlightColor = slider.button.color.copy();\n    slider.button.highlightColor.b += 100;\n    slider.button.pressColor = slider.button.color.copy();\n    slider.button.pressColor.b += 150;\n    slider.setExtent(new Point(\n        MorphicPreferences.scrollBarSize * 10,\n        MorphicPreferences.menuFontSize\n    ));\n    slider.action = (num) => {\n        aStringOrTextMorph.changed();\n        aStringOrTextMorph.text = Math.round(num).toString();\n        aStringOrTextMorph.fixLayout();\n        aStringOrTextMorph.rerender();\n        aStringOrTextMorph.escalateEvent(\n            'reactToSliderEdit',\n            aStringOrTextMorph\n        );\n    };\n    menu.items.push(slider);\n    menu.popup(this, aStringOrTextMorph.bottomLeft().add(new Point(0, 5)));\n};\n\nWorldMorph.prototype.stopEditing = function () {\n    if (this.cursor) {\n        this.cursor.target.escalateEvent('reactToEdit', this.cursor.target);\n        this.cursor.target.clearSelection();\n        this.cursor.destroy();\n        this.cursor = null;\n    }\n    if (this.keyboardFocus && this.keyboardFocus.stopEditing) {\n    \tthis.keyboardFocus.stopEditing();\n    }\n    this.keyboardFocus = null;\n    this.lastEditedText = null;\n};\n\nWorldMorph.prototype.toggleBlurredShadows = function () {\n    useBlurredShadows = !useBlurredShadows;\n};\n\nWorldMorph.prototype.togglePreferences = function () {\n    if (MorphicPreferences === standardSettings) {\n        MorphicPreferences = touchScreenSettings;\n    } else {\n        MorphicPreferences = standardSettings;\n    }\n};\n\nWorldMorph.prototype.toggleHolesDisplay = function () {\n    MorphicPreferences.showHoles = !MorphicPreferences.showHoles;\n    this.rerender();\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","__webpack_require__.amdO = {};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.hmd = function(module) {\n\tmodule = Object.create(module);\n\tif (!module.children) module.children = [];\n\tObject.defineProperty(module, 'exports', {\n\t\tenumerable: true,\n\t\tset: function() {\n\t\t\tthrow new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);\n\t\t}\n\t});\n\treturn module;\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/*\n\nCopyright 2012 Nathan Dinsmore\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nLast changed 2017-07-04 by Jens Moenig (disabled text area overlay, introduced Sprite::isTemporary)\n\n*/\n\nexport var sb = (function (sb) {\n    'use strict';\n\n    function extend(o, p) {\n        var key;\n        for (key in p) if (p.hasOwnProperty(key)) {\n            o[key] = p[key];\n        }\n    }\n    sb.$extend = extend;\n\n    extend((sb.Ref = function (id) {\n        this.id = id;\n    }).prototype, {\n        isRef: true\n    });\n\n    extend((sb.Dictionary = function (keys, values) {\n        this.keys = keys;\n        this.values = values;\n    }).prototype, {\n        get: function (key) {\n            return this.values[this.keys.indexOf(key)];\n        },\n        set: function (key, value) {\n            var i = this.keys.indexOf(key);\n            if (i === -1) {\n                this.keys.push(key);\n                this.values.push(value);\n            } else {\n                this.values[i] = value;\n            }\n        }\n    });\n\n    sb.Color = function (rgb, a) {\n        this.r = (rgb / 0x100000 | 0) % 0x400 / (0x400 - 1);\n        this.g = (rgb / 0x400 | 0) % 0x400 / (0x400 - 1);\n        this.b = (rgb % 0x400) / (0x400 - 1);\n        this.a = a / (0x100 - 1);\n    };\n    sb.Point = function (x, y) {\n        this.x = x;\n        this.y = y;\n    };\n    sb.Rectangle = function (x, y, x2, y2) {\n        this.origin = new sb.Point(x, y);\n        this.corner = new sb.Point(x2, y2);\n    };\n\n    sb.indexedColors = [\n        [1, 1, 1, 1],\n        [0, 0, 0, 1],\n        [1, 1, 1, 1],\n        [.5, .5, .5, 1],\n        [1, 0, 0, 1],\n        [0, 1, 0, 1],\n        [0, 0, 1, 1],\n        [0, 1, 1, 1],\n        [1, 1, 0, 1],\n        [1, 0, 1, 1],\n        [.125, .125, .125, 1],\n        [.25, .25, .25, 1],\n        [.375, .375, .375, 1],\n        [.625, .625, .625, 1],\n        [.75, .75, .75, 1],\n        [.875, .875, .875, 1]\n    ];\n    (function () {\n        var i, r, g, b, grayVal;\n        for (i = 1; i <= 31; ++i) {\n            if (i % 4 != 0) {\n                grayVal = i / 32;\n                sb.indexedColors[i + 15] = [grayVal, grayVal, grayVal, 1];\n            }\n        }\n        for (r = 0; r < 6; ++r) {\n            for (g = 0; g < 6; ++g) {\n                for (b = 0; b < 6; ++b) {\n                    i = 40 + 36 * r + 6 * b + g;\n                    sb.indexedColors[i] = [r / 5, g / 5, b / 5, 1];\n                }\n            }\n        }\n    })();\n\n    sb.colorDepthLengths = {\n        1: 1,\n        2: 2,\n        4: 4,\n        8: 8,\n        15: 5,\n        16: 5,\n        12: 4,\n        9: 3\n    };\n    extend((sb.ColorStream = function (bitmap, depth) {\n        var i = 0,\n            l = bitmap.length,\n            b = this.bits = [],\n            n;\n        this.length = sb.colorDepthLengths[this.depth = depth];\n        this.position = 0;\n        while (i < l) {\n            n = bitmap[i++];\n            b.push(n / 0x80 & 1);\n            b.push(n / 0x40 & 1);\n            b.push(n / 0x20 & 1);\n            b.push(n / 0x10 & 1);\n            b.push(n / 0x8 & 1);\n            b.push(n / 0x4 & 1);\n            b.push(n / 0x2 & 1);\n            b.push(n & 1);\n        }\n    }).prototype, {\n        read: function () {\n            var i = this.length,\n                b = this.bits,\n                n = 0;\n            while (i--) {\n                n = n * 2 + b[this.position++];\n            }\n            return n;\n        }\n    });\n\n    extend((sb.ColorStreamIndexed = function (bitmap, depth) {\n        sb.ColorStream.call(this, bitmap, depth);\n    }).prototype = Object.create(sb.ColorStream.prototype), {\n        next: function (b) {\n            var c = sb.indexedColors[this.read()];\n            if (!c) return c;\n            b[0] = c[0];\n            b[1] = c[1];\n            b[2] = c[2];\n            b[3] = c[3];\n        }\n    });\n\n    extend((sb.ColorStreamRGB = function (bitmap, depth) {\n        sb.ColorStream.call(this, bitmap, depth);\n        this.max = Math.pow(2, this.length) - 1;\n    }).prototype = Object.create(sb.ColorStream.prototype), {\n        next: function (b) {\n            var c;\n            switch (this.depth) {\n            case 16:\n                ++this.position;\n                c = [this.read() / this.max, this.read() / this.max, this.read() / this.max, 1];\n                if (c[0] + c[1] + c[2] === 0) {\n                    return b[0] = b[1] = b[2] = b[3] = 0;\n                }\n                b[0] = c[0];\n                b[1] = c[1];\n                b[2] = c[2];\n                b[3] = c[3];\n                return;\n            case 12:\n                this.position += 3;\n                break;\n            }\n            b[0] = this.read() / this.max;\n            b[1] = this.read() / this.max;\n            b[2] = this.read() / this.max;\n            b[3] = 1;\n        }\n    });\n\n    extend((sb.ColorStream32 = function (bitmap, depth) {\n        this.bytes = bitmap;\n        if (depth === 32) {\n            this.next = this.nextAlpha;\n        }\n        this.position = 0;\n    }).prototype, {\n        next: function (b) {\n            b[0] = this.read() / 255;\n            b[1] = this.read() / 255;\n            b[2] = this.read() / 255;\n            b[3] = 1;\n        },\n        nextAlpha: function (b) {\n            var a = this.read() / 255;\n            b[0] = this.read() / 255;\n            b[1] = this.read() / 255;\n            b[2] = this.read() / 255\n            b[3] = a;\n        },\n        read: function () {\n            return this.bytes[this.position++];\n        }\n    });\n\n    sb.colorStreams = {\n        1: sb.ColorStreamIndexed,\n        2: sb.ColorStreamIndexed,\n        4: sb.ColorStreamIndexed,\n        8: sb.ColorStreamIndexed,\n        15: sb.ColorStreamRGB,\n        16: sb.ColorStreamRGB,\n        32: sb.ColorStream32,\n        24: sb.ColorStream32,\n        12: sb.ColorStreamRGB,\n        9: sb.ColorStreamRGB\n    };\n\n    sb.getColorStream = function (bitmap, depth) {\n        return new sb.colorStreams[depth](bitmap, depth);\n    };\n\n    extend((sb.Form = function (w, h, d, o, b) {\n        this.width = w;\n        this.height = h;\n        this.depth = d;\n        this.offset = o;\n        this.bits = b;\n    }).prototype, {\n        init: function (bm) {\n            if (this.bits.isBitmap) {\n                this.bitmap = this.bits;\n            } else {\n                this.decompress(bm);\n            }\n            this.image = document.createElement('canvas');\n            this.image.width = this.width;\n            this.image.height = this.height;\n        },\n        decompress: function (bm) {\n            var b = this.bits,\n                p = 0,\n                q = 0,\n                r = !!bm,\n                length = (i = b[p++], i <= 223 ? i : i < 255 ? (i - 224) * 256 + b[p++] : (b[p++] << 24) + (b[p++] << 16) + (b[p++] << 8) + b[p++]),\n                bm, i, n, d, e, f, g;\n            // stream = new sb.Reader().on(this.bits),\n            this.bitmap = bm || (bm = []);\n            while (p < b.length) {\n                i = b[p++];\n                if (i > 223) {\n                    i = i < 255 ? (i - 224) * 256 + b[p++] : (b[p++] << 24) + (b[p++] << 16) + (b[p++] << 8) + b[p++];\n                }\n                n = i >> 2;\n                switch (i & 3) {\n                case 1:\n                    d = b[p++];\n                    n *= 4;\n                    while (n--) {\n                        bm[q++] = d;\n                    }\n                    break;\n                case 2:\n                    // d = stream.readBytes(4);\n                    d = b[p++];\n                    e = b[p++];\n                    f = b[p++];\n                    g = b[p++];\n                    while (n--) {\n                        if (r) {\n                            bm[q++] = e;\n                            bm[q++] = f;\n                            bm[q++] = g;\n                            bm[q++] = d;\n                        } else {\n                            bm[q++] = d;\n                            bm[q++] = e;\n                            bm[q++] = f;\n                            bm[q++] = g;\n                        }\n                    }\n                    break;\n                case 3:\n                    while (n--) {\n                        if (r) {\n                            d = b[p++];\n                            bm[q++] = b[p++];\n                            bm[q++] = b[p++];\n                            bm[q++] = b[p++];\n                            bm[q++] = d;\n                        } else {\n                            bm[q++] = b[p++];\n                            bm[q++] = b[p++];\n                            bm[q++] = b[p++];\n                            bm[q++] = b[p++];\n                        }\n                    }\n                    // bm.push.apply(bm, stream.readBytes(n * 4));\n                    break;\n                }\n            }\n        },\n        load: function () {\n            var w = this.width,\n                h = this.height,\n                x, y, i, imageData, data, context, colors, color, b;\n            if (this.depth === 32) {\n                this.image = document.createElement('canvas');\n                this.image.width = this.width;\n                this.image.height = this.height;\n                data = (imageData = (context = this.image.getContext('2d')).createImageData(this.width, this.height)).data;\n                this.decompress(data);\n                context.putImageData(imageData, 0, 0);\n                return;\n            }\n            color = [0, 0, 0, 0];\n            if (this.depth === 16) {\n                w = this.width += 1;\n            }\n            this.init();\n            colors = sb.getColorStream(this.bitmap, this.depth);\n            data = (imageData = (context = this.image.getContext('2d')).createImageData(this.width, this.height)).data;\n            for (x = 0; x < w; ++x) {\n                for (y = 0; y < h; ++y) {\n                    colors.next(color);\n                    if (!color) continue;\n                    i = (x * h + y) * 4;\n                    data[i] = color[0] * 255;\n                    data[i + 1] = color[1] * 255;\n                    data[i + 2] = color[2] * 255;\n                    data[i + 3] = color[3] * 255;\n                }\n            }\n            context.putImageData(imageData, 0, 0);\n        }\n    });\n\n    extend((sb.ColorForm = function (w, h, d, o, b, c) {\n        this.width = w;\n        this.height = h;\n        this.depth = d;\n        this.offset = o;\n        this.bits = b;\n        this.colors = c;\n    }).prototype = Object.create(sb.Form.prototype), {\n        load: function () {\n            var w = this.width,\n                h = this.height,\n                colors = this.colors,\n                bits, x, y, i, imageData, data, context, color;\n            this.init();\n            data = (imageData = (context = this.image.getContext('2d')).createImageData(this.width, this.height)).data;\n            bits = this.bitmap;\n            for (x = 0; x < w; ++x) {\n                for (y = 0; y < h; ++y) {\n                    color = colors[bits[x * h + y]];\n                    if (!color) continue;\n                    i = (x * h + y) * 4;\n                    data[i] = color.r * 255;\n                    data[i + 1] = color.g * 255;\n                    data[i + 2] = color.b * 255;\n                    data[i + 3] = color.a * 255;\n                }\n            }\n            context.putImageData(imageData, 0, 0);\n        }\n    });\n\n    sb.fields = {};\n    sb.classIDs = {};\n    sb.classNames = {};\n    sb.addFields = function (id, name, base, fields) {\n        sb.classIDs[name] = id;\n        sb.classNames[id] = name;\n        fields = fields.length ? fields.split(',') : [];\n        if (base) {\n            base = sb.fields[sb.classIDs[base]];\n            if (!base) throw new Error('Initialization error');\n            fields = base.concat(fields);\n        }\n        sb.fields[id] = fields;\n    };\n\n\tsb.addFields(100, 'Morph', '', 'bounds,owner,submorphs,color,flags,properties');\n\tsb.addFields(101, 'BorderedMorph', 'Morph', 'borderWidth,borderColor');\n\tsb.addFields(102, 'RectangleMorph', 'BorderedMorph', '');\n\tsb.addFields(103, 'EllipseMorph', 'BorderedMorph', '');\n\tsb.addFields(104, 'AlignmentMorph', 'RectangleMorph', 'orientation,centering,hResizing,vResizing,inset');\n\tsb.addFields(105, 'StringMorph', 'Morph', 'fontSpec,emphasis,contents');\n\n\tsb.addFields(-1, 'Slider', 'BorderedMorph', 'slider,value,setValueSelector,sliderShadow,sliderColor,descending,model');\n\tsb.addFields(-2, 'AbstractSound', '', '');\n\tsb.addFields(-3, 'ScriptableScratchMorph', 'Morph', 'objName,vars,blocksBin,customBlocks,isTemporary,media,costume');\n\tsb.addFields(-4, 'ArgMorph', 'BorderedMorph', 'labelMorph');\n\tsb.addFields(-5, 'PasteUpMorph', 'BorderedMorph', '');\n\tsb.addFields(-6, 'ScratchMedia', '', 'mediaName');\n\tsb.addFields(-7, 'ScrollFrameMorph', 'BorderedMorph', '');\n\n\tsb.addFields(106, 'UpdatingStringMorph', 'StringMorph', 'format,target,getSelector,putSelector,parameter,floatPrecision,growable,stepTime');\n\tsb.addFields(107, 'SimpleSliderMorph', 'Slider', 'target,arguments,minVal,maxVal,truncate,sliderThickness');\n\tsb.addFields(108, 'SimpleButtonMorph', 'RectangleMorph', 'target,actionSelector,arguments,actWhen');\n\tsb.addFields(109, 'SampledSound', 'AbstractSound', 'envelopes,scaledVol,initialCount,samples,originalSamplingRate,samplesSize,scaledIncrement,scaledInitialIndex');\n\tsb.addFields(110, 'ImageMorph', 'Morph', 'form,transparency');\n\tsb.addFields(111, 'SketchMorph', 'Morph', 'originalForm,rotationCenter,rotationDegrees,rotationStyle,scalePoint,offsetWhenRotated');\n\tsb.addFields(123, 'SensorBoardMorph', 'Morph', 'portNum');\n\tsb.addFields(124, 'ScratchSpriteMorph', 'ScriptableScratchMorph', 'visibility,scalePoint,rotationDegrees,rotationStyle,volume,tempoBPM,draggable,sceneStates,lists,virtualScale,ownerSprite,subsprites,rotateWithOwner,refPos,prototype,deletedAttributes');\n\tsb.addFields(125, 'ScratchStageMorph', 'ScriptableScratchMorph', 'zoom,hPan,vPan,obsoleteSavedState,sprites,volume,tempoBPM,sceneStates,lists');\n\tsb.addFields(140, 'ChoiceArgMorph', 'ArgMorph', 'isBoolean,options,choice,getOptionsSelector');\n\tsb.addFields(141, 'ColorArgMorph', 'ArgMorph', '');\n\tsb.addFields(142, 'ExpressionArgMorph', 'ArgMorph', 'isNumber');\n\tsb.addFields(145, 'SpriteArgMorph', 'ArgMorph', 'morph');\n\tsb.addFields(147, 'BlockMorph', 'Morph', 'isSpecialForm,oldColor');\n\tsb.addFields(148, 'CommandBlockMorph', 'BlockMorph', 'commandSpec,argMorphs,titleMorph,receiver,selector,isReporter,isTimed,wantsName,wantsPossession');\n\tsb.addFields(149, 'CBlockMorph', 'CommandBlockMorph', 'nestedBlock,nextBlock');\n\tsb.addFields(151, 'HatBlockMorph', 'CommandBlockMorph', 'scriptNameMorph,indicatorMorph,scriptOwner,parameters,isClickable');\n\tsb.addFields(153, 'ScratchScriptsMorph', 'PasteUpMorph', '');\n\tsb.addFields(154, 'ScratchSliderMorph', 'AlignmentMorph', 'slider,sliderMin,sliderMax,variable');\n\tsb.addFields(155, 'WatcherMorph', 'AlignmentMorph', 'titleMorph,readout,readoutFrame,scratchSlider,watcher,isSpriteSpecific,unused,sliderMin,sliderMax,isLarge');\n\tsb.addFields(157, 'SetterBlockMorph', 'CommandBlockMorph', 'variable');\n\tsb.addFields(158, 'EventHatMorph', 'HatBlockMorph', '');\n\tsb.addFields(170, 'ReporterBlockMorph', 'CommandBlockMorph', 'isBoolean');\n\tsb.addFields(160, 'VariableBlockMorph', 'ReporterBlockMorph', '');\n\tsb.addFields(162, 'ImageMedia', 'ScratchMedia', 'form,rotationCenter,textBox,jpegBytes,compositeForm');\n\tsb.addFields(163, 'MovieMedia', 'ScratchMedia', 'fileName,fade,fadeColor,zoom,hPan,vPan,msecsPerFrame,currentFrame,moviePlaying');\n\tsb.addFields(164, 'SoundMedia', 'ScratchMedia', 'originalSound,volume,balance,compressedSampleRate,compressedBitsPerSample,compressedData');\n\tsb.addFields(165, 'KeyEventHatMorph', 'HatBlockMorph', '');\n\tsb.addFields(166, 'BooleanArgMorph', 'ArgMorph', '');\n\tsb.addFields(167, 'EventTitleMorph', 'ArgMorph', '');\n\tsb.addFields(168, 'MouseClickEventHatMorph', 'HatBlockMorph', '');\n\tsb.addFields(169, 'ExpressionArgMorphWithMenu', 'ExpressionArgMorph', 'menuMorph,getMenuSelector,specialValue');\n\tsb.addFields(171, 'MultilineStringMorph', 'BorderedMorph', 'fontSpec,textColor,selectionColor,lines');\n\tsb.addFields(172, 'ToggleButton', 'SimpleButtonMorph', 'onForm,offForm,overForm,disabledForm,isMomentary,toggleMode,isOn,isDisabled');\n\tsb.addFields(173, 'WatcherReadoutFrameMorph', 'BorderedMorph', '');\n\tsb.addFields(174, 'WatcherSliderMorph', 'SimpleSliderMorph', '');\n\tsb.addFields(175, 'ScratchListMorph', 'BorderedMorph', 'listName,strings,target,complex');\n\tsb.addFields(176, 'ScrollingStringMorph', 'BorderedMorph', 'fontSpec,showScrollbar,firstVisibleLine,textColor,selectionColor,lines');\n\n\tsb.addFields(180, 'ScrollFrameMorph2', 'ScrollFrameMorph', '');\n\tsb.addFields(181, 'ListMultilineStringMorph', 'MultilineStringMorph', '');\n\tsb.addFields(182, 'ScratchScrollBar', 'Morph', '');\n\n\tsb.addFields(200, 'CustomCommandBlockMorph', 'CommandBlockMorph', 'userSpec');\n\tsb.addFields(201, 'CustomBlockDefinition', '', 'userSpec,blockVars,isAtomic,isReporter,isBoolean,body,answer,type,category,declarations,defaults,isGlobal');\n\tsb.addFields(203, 'ReporterScriptBlockMorph', 'ReporterBlockMorph', '');\n\tsb.addFields(202, 'CommandScriptBlockMorph', 'ReporterScriptBlockMorph', '');\n\tsb.addFields(205, 'VariableFrame', '', 'vars');\n\tsb.addFields(206, 'CustomReporterBlockMorph', 'ReporterBlockMorph', 'userSpec');\n\n\tsb.addFields(207, 'CReporterSlotMorph', 'ReporterScriptBlockMorph', '');\n\n\tsb.addFields(300, 'StringFieldMorph', 'BorderedMorph', '');\n\tsb.addFields(301, 'MultiArgReporterBlockMorph', 'ReporterBlockMorph', '');\n\n\t(function (C, p) {\n\n\t\tp.on = function (bytes) {\n\t\t\tthis.bytes = bytes;\n\t\t\tif (!bytes.subarray) bytes.subarray = bytes.slice;\n\t\t\tthis.position = 0;\n\t\t\treturn this;\n\t\t};\n\t\tp.readYPR = function (bytes) {\n\t\t\tvar version, infoSize, info, stage;\n\t\t\tconsole.time('readSB');\n\t\t\tthis.on(bytes);\n\n\t\t\t// skip header\n\t\t\tthis.matchBytes([66, 108, 111, 120, 69, 120, 112, 86]);\n\t\t\tversion = +(String.fromCharCode(this.next()) + String.fromCharCode(this.next()));\n\t\t\tif (version < 1) {\n\t\t\t\tthrow new Error('Invalid version');\n\t\t\t}\n\n\t\t\t// read info\n\t\t\tinfoSize = this.uint32();\n\t\t\tinfo = this.read();\n\n\t\t\tthis.position = infoSize + 14; // header + uint32\n\t\t\tstage = this.read();\n\n\t\t\tthis.onload({\n\t\t\t\treader: this,\n\t\t\t\tinfo: info,\n\t\t\t\tstage: stage\n\t\t\t});\n\t\t\tconsole.timeEnd('readSB');\n\t\t};\n\t\tp.readInfo = function (bytes) {\n\t\t\tvar version, infoSize, info;\n\t\t\tthis.on(bytes);\n\n\t\t\tthis.matchBytes([66, 108, 111, 120, 69, 120, 112, 86]);\n\t\t\tversion = +(String.fromCharCode(this.next()) + String.fromCharCode(this.next()));\n\t\t\tif (version < 1) {\n\t\t\t\tthrow new Error('Invalid version');\n\t\t\t}\n\n\t\t\t// read info\n\t\t\tinfoSize = this.uint32();\n\t\t\tinfo = this.read();\n\n\t\t\tthis.onload({\n\t\t\t\treader: this,\n\t\t\t\tinfo: info\n\t\t\t});\n\t\t};\n\t\tp.read = function () {\n\t\t\tvar i, objectCount;\n\t\t\tthis.objects = [];\n\t\t\tthis.readHeader();\n\t\t\tobjectCount = this.uint32();\n\n\t\t\ti = objectCount;\n\t\t\twhile (i--) {\n\t\t\t\tthis.objects.push(this.readObject());\n\t\t\t}\n\t\t\ti = objectCount;\n\t\t\twhile (i--) {\n\t\t\t\tthis.fixReferences(this.objects[i]);\n\t\t\t}\n\t\t\treturn this.objects[0][1];\n\t\t};\n\t\tp.fixReferences = function (object) {\n\t\t\tvar classID = object[0],\n\t\t\t\tvalue = object[1],\n\t\t\t\ti = 0,\n\t\t\t\tfields, source;\n\t\t\tif (classID < 99) {\n\t\t\t\tthis.fixFixedFormat(classID, value);\n\t\t\t} else {\n\t\t\t\tthis.fixArray(object[3]);\n\t\t\t\tfields = sb.fields[classID];\n\t\t\t\tif (!fields)\n\t\t\t\t\tthrow new Error('Invalid class ID ' + classID);\n\t\t\t\tsource = value.fields;\n\t\t\t\tdelete value.fields;\n\t\t\t\tvalue.className = sb.classNames[classID];\n\t\t\t\ti = fields.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tvalue[fields[i]] = source[i];\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tp.fixArray = function (a) {\n\t\t\tvar i = a.length,\n\t\t\t\to;\n\t\t\twhile (i--) {\n\t\t\t\tif ((o = a[i]) && o.isRef) {\n\t\t\t\t\tif (o.id > this.objects.length) {\n\t\t\t\t\t\tthrow new Error('Invalid object reference');\n\t\t\t\t\t}\n\t\t\t\t\ta[i] = this.objects[o.id - 1][1];\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tp.targetObjectFor = function (o) {\n\t\t\tif (o && o.isRef) {\n\t\t\t\tif (o.id > this.objects.length)\n\t\t\t\t\tthrow new Error('Invalid object reference');\n\t\t\t\treturn this.objects[o.id - 1][1];\n\t\t\t}\n\t\t\treturn o;\n\t\t};\n\t\tp.fixFixedFormat = function (classID, object) {\n\t\t\tswitch (classID) {\n\t\t\tcase 20: // Array\n\t\t\tcase 21: // OrderedCollection\n\t\t\tcase 22: // Set\n\t\t\tcase 23: // IdentitySet\n\t\t\t\tthis.fixArray(object);\n\t\t\t\treturn object;\n\t\t\tcase 24: // Dictionary\n\t\t\tcase 25: // IdentityDictionary\n\t\t\t\tthis.fixArray(object.keys);\n\t\t\t\tthis.fixArray(object.values);\n\t\t\t\tbreak;\n\t\t\tcase 32: // Point\n\t\t\t\tobject.x = this.targetObjectFor(object.x);\n\t\t\t\tobject.y = this.targetObjectFor(object.y);\n\t\t\t\tbreak;\n\t\t\tcase 33: // Rectangle\n\t\t\t\tobject.origin.x = this.targetObjectFor(object.origin.x);\n\t\t\t\tobject.origin.y = this.targetObjectFor(object.origin.y);\n\t\t\t\tobject.corner.x = this.targetObjectFor(object.corner.x);\n\t\t\t\tobject.corner.y = this.targetObjectFor(object.corner.y);\n\t\t\t\tbreak;\n\t\t\tcase 34: // Form\n\t\t\t\tobject.offset = this.targetObjectFor(object.offset);\n\t\t\t\tobject.bits = this.targetObjectFor(object.bits);\n\t\t\t\tobject.load();\n\t\t\t\tbreak;\n\t\t\tcase 35: // ColorForm\n\t\t\t\tobject.offset = this.targetObjectFor(object.offset);\n\t\t\t\tobject.bits = this.targetObjectFor(object.bits);\n\t\t\t\tobject.colors = this.targetObjectFor(object.colors);\n\t\t\t\tobject.load();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn object;\n\t\t};\n\t\tp.readObject = function () {\n\t\t\tvar classID = this.next(),\n\t\t\t\tversion, fieldCount, fields;\n\t\t\tif (classID > 99) {\n\t\t\t\tversion = this.next();\n\t\t\t\tfieldCount = this.next();\n\t\t\t\tfields = [];\n\t\t\t\twhile (fieldCount--) {\n\t\t\t\t\tfields.push(this.readField());\n\t\t\t\t}\n\t\t\t\treturn [classID, { fields: fields }, version, fields];\n\t\t\t}\n\t\t\treturn [classID, this.readFixedFormat(classID)];\n\t\t};\n\t\tp.readField = function () {\n\t\t\tvar classID = this.next();\n\t\t\tif (classID === 99) {\n\t\t\t\treturn new sb.Ref(this.uint24());\n\t\t\t}\n\t\t\treturn this.readFixedFormat(classID);\n\t\t};\n\t\tp.readFixedFormat = function (classID) {\n\t\t\tvar a, n;\n\t\t\tswitch (classID) {\n\t\t\tcase 1: // UndefinedObject\n\t\t\t\treturn null;\n\t\t\tcase 2: // True\n\t\t\t\treturn true;\n\t\t\tcase 3: // False\n\t\t\t\treturn false;\n\t\t\tcase 4: // SmallInteger\n\t\t\t\treturn this.int32();\n\t\t\tcase 5: // SmallInteger16\n\t\t\t\treturn this.int16();\n\t\t\tcase 6: // LargePositiveInteger\n\t\t\tcase 7: // LargeNegativeInteger\n\t\t\t\tn = this.uint16();\n\t\t\t\ta = 0;\n\t\t\t\twhile (n--) {\n\t\t\t\t\ta *= 0x100;\n\t\t\t\t\ta += this.next();\n\t\t\t\t}\n\t\t\t\treturn a;\n\t\t\tcase 8: // Float\n\t\t\t\treturn this.float64();\n\t\t\tcase 9: // String\n\t\t\tcase 10: // Symbol\n\t\t\tcase 14: // UTF8\n\t\t\t\ta = [].slice.call(this.readBytes(n = this.uint32()));\n\t\t\t\twhile (n--) {\n\t\t\t\t\ta[n] = String.fromCharCode(a[n]);\n\t\t\t\t}\n\t\t\t\treturn a.join('');\n\t\t\tcase 11: // ByteArray\n\t\t\t\treturn this.readBytes(this.uint32());\n\t\t\tcase 12: // SoundBuffer\n\t\t\t\ta = [];\n\t\t\t\tn = this.uint32();\n\t\t\t\twhile (n--) {\n\t\t\t\t\ta.push(this.int16());\n\t\t\t\t}\n\t\t\t\treturn a;\n\t\t\tcase 13: // Bitmap\n\t\t\t\ta = [];\n\t\t\t\ta.isBitmap = true;\n\t\t\t\tn = this.uint32();\n\t\t\t\twhile (n--) {\n\t\t\t\t\ta.push(this.uint32());\n\t\t\t\t}\n\t\t\t\treturn a;\n\t\t\tcase 20: // Array\n\t\t\tcase 21: // OrderedCollection\n\t\t\tcase 22: // Set\n\t\t\tcase 23: // IdentitySet\n\t\t\t\ta = [];\n\t\t\t\tn = this.uint32();\n\t\t\t\twhile (n--) {\n\t\t\t\t\ta.push(this.readField());\n\t\t\t\t}\n\t\t\t\treturn a;\n\t\t\tcase 24: // Dictionary\n\t\t\tcase 25: // IdentityDictionary\n\t\t\t\ta = new sb.Dictionary([], []);\n\t\t\t\tn = this.uint32();\n\t\t\t\twhile (n--) {\n\t\t\t\t\ta.keys.push(this.readField());\n\t\t\t\t\ta.values.push(this.readField());\n\t\t\t\t}\n\t\t\t\treturn a;\n\t\t\tcase 30: // Color\n\t\t\t\treturn new sb.Color(this.uint32(), 255);\n\t\t\tcase 31: // TranslucentColor\n\t\t\t\treturn new sb.Color(this.uint32(), this.uint8());\n\t\t\tcase 32: // Point\n\t\t\t\treturn new sb.Point(this.readField(), this.readField());\n\t\t\tcase 33: // Rectangle\n\t\t\t\treturn new sb.Rectangle(this.readField(), this.readField(), this.readField(), this.readField());\n\t\t\tcase 34: // Form\n\t\t\t\treturn new sb.Form(this.readField(), this.readField(), this.readField(), this.readField(), this.readField());\n\t\t\tcase 35: // ColorForm\n\t\t\t\treturn new sb.ColorForm(this.readField(), this.readField(), this.readField(), this.readField(), this.readField(), this.readField());\n\t\t\t}\n\t\t\tthrow new Error('Invalid fixed-format class ID');\n\t\t};\n\t\tp.readHeader = function () {\n\t\t\tthis.matchBytes([79, 98, 106, 83, 1, 83, 116, 99, 104, 1]);\n\t\t};\n\t\tp.readBytes = function (length) {\n\t\t\treturn this.bytes.subarray(this.position, this.position += length);\n\t\t};\n\t\tp.matchBytes = function (bytes) {\n\t\t\tvar i = bytes.length,\n\t\t\t\tr = this.readBytes(i);\n\t\t\twhile (i--) {\n\t\t\t\tif (r[i] !== bytes[i]) {\n\t\t\t\t\tthrow new Error('Invalid format');\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tp.skip = function (length) {\n\t\t\tthis.position += length;\n\t\t};\n\t\tp.next = p.uint8 = function () {\n\t\t\treturn this.bytes[this.position++];\n\t\t};\n\t\tp.hasNext = function () {\n\t\t\treturn this.position < this.bytes.length;\n\t\t};\n\t\tp.uint16 = function () {\n\t\t\treturn this.next() * 0x100 + this.next();\n\t\t};\n\t\tp.uint24 = function () {\n\t\t\treturn this.next() * 0x10000 + this.next() * 0x100 + this.next();\n\t\t};\n\t\tp.uint32 = function () {\n\t\t\treturn this.next() * 0x1000000 + this.next() * 0x10000 + this.next() * 0x100 + this.next();\n\t\t};\n\t\tp.int8 = function () {\n\t\t\tvar v = this.bytes[++this.position];\n\t\t\treturn v >= 0x80 ? v - 0x100 : v;\n\t\t};\n\t\tp.int16 = function () {\n\t\t\tvar d = this.next(),\n\t\t\t\tv = d * 0x100 + this.next();\n\t\t\treturn d >= 0x80 ? v - 0x10000 : v;\n\t\t};\n\t\tp.int24 = function () {\n\t\t\tvar d = this.next(),\n\t\t\t\tv = d * 0x10000 + this.next() * 0x100 + this.next();\n\t\t\treturn d >= 0x80 ? v - 0x1000000 : v;\n\t\t};\n\t\tp.int32 = function () {\n\t\t\tvar d = this.next(),\n\t\t\t\tv = d * 0x1000000 + this.next() * 0x10000 + this.next() * 0x100 + this.next();\n\t\t\treturn d >= 0x80 ? v - 0x100000000 : v;\n\t\t};\n\t\tp.string = function () {\n\t\t\tvar length = this.uint16(),\n\t\t\t\tbytes = this.readBytes(length),\n\t\t\t\ti = length;\n\t\t\twhile (i--) {\n\t\t\t\tbytes[i] = String.fromCharCode(bytes[i]);\n\t\t\t}\n\t\t\treturn bytes.join('');\n\t\t};\n\t\tp.float64 = function () {\n\t\t\treturn this.ieee(8, 11, 52, 1023);\n\t\t};\n\t\tp.ieee = function (n, ebits, mbits) {\n\t\t\tvar bias = (1 << (ebits - 1)) - 1,\n\t\t\t\tstring = '',\n\t\t\t\ti = n,\n\t\t\t\tb, sign, exponent, mantissa, result;\n\t\t\twhile (i--) {\n\t\t\t\tb = this.next().toString(2);\n\t\t\t\tstring = string + Array(9 - b.length).join('0') + b;\n\t\t\t}\n\t\t\tsign = string.charAt(0) === '0' ? 1 : -1;\n\t\t\texponent = parseInt(string.substr(1, ebits), 2);\n\t\t\tmantissa = parseInt(string.substr(ebits + 1), 2);\n\t\t\tif (exponent === 0) {\n\t\t\t\treturn mantissa === 0 ? sign * 0 : sign * Math.pow(2, 1 - bias) * mantissa / Math.pow(2, mbits);\n\t\t\t}\n\t\t\tif (exponent === (1 << ebits) - 1) {\n\t\t\t\treturn mantissa === 0 ? sign / 0 : NaN;\n\t\t\t}\n\t\t\treturn sign * Math.pow(2, exponent - bias) * (1 + mantissa / Math.pow(2, mbits));\n\t\t};\n\n\t})(sb.Reader = function () {}, sb.Reader.prototype);\n\n\t(function (C, p) {\n\n\t\tvar rotationStyles = {\n\t\t\tnormal: 1,\n\t\t\tleftRight: 2,\n\t\t\tnone: 0\n\t\t}, customBlockInputs = {\n\t\t\tobject: '%obj',\n\t\t\tobjectList: '%mult%obj',\n\t\t\tnumber: '%n',\n\t\t\tnumberList: '%mult%n',\n\t\t\ttext: '%txt',\n\t\t\ttextList: '%mult%txt',\n\t\t\tlist: '%l',\n\t\t\tlistList: '%mult%l',\n\t\t\tany: '%s',\n\t\t\tanyList: '%mult%s',\n\t\t\t'boolean': '%b',\n\t\t\tbooleanList: '%mult%b',\n\t\t\tcommand: '%cmdRing',\n\t\t\tcommandList: '%mult%cmdRing',\n\t\t\treporter: '%repRing',\n\t\t\treporterList: '%mult%repRing',\n\t\t\tpredicate: '%predRing',\n\t\t\tpredicateList: '%mult%predRing',\n\t\t\tloop: '%cs',\n\t\t\tloopList: '%mult%cs',\n\t\t\tunevaluated: '%anyUE',\n\t\t\tunevaluatedList: '%mult%anyUE',\n\t\t\tunevaluatedBoolean: '%boolUE',\n\t\t\tunevaluatedBooleanList: '%mult%boolUE',\n\t\t\ttemplate: '%upvar'\n\t\t}, blockSelectors = {\n\t\t\t// Motion': '',\n\t\t\t'forward:': 'forward',\n\t\t\t'turnLeft:': 'turnLeft',\n\t\t\t'turnRight:': 'turn',\n\t\t\t'heading:': 'setHeading',\n\t\t\t'pointTowards:': 'doFaceTowards',\n\t\t\t'gotoX:y:': 'gotoXY',\n\t\t\t'gotoSpriteOrMouse:': 'doGotoObject',\n\t\t\t'glideSecs:toX:y:elapsed:from:': 'doGlide',\n\t\t\t'changeXposBy:': 'changeXPosition',\n\t\t\t'xpos:': 'setXPosition',\n\t\t\t'changeYposBy:': 'changeYPosition',\n\t\t\t'ypos:': 'setYPosition',\n\t\t\t'bounceOffEdge': 'bounceOffEdge',\n\t\t\t'xpos': 'xPosition',\n\t\t\t'ypos': 'yPosition',\n\t\t\t'heading': 'direction',\n\n\t\t\t// Looks\n\t\t\t'lookLike:': 'doSwitchToCostume',\n            'showBackground:': 'doSwitchToCostume',\n\t\t\t'nextCostume': 'doWearNextCostume',\n\t\t\t'nextBackground': 'doWearNextCostume',\n\t\t\t'costumeIndex': 'getCostumeIdx',\n\t\t\t'say:duration:elapsed:from:': 'doSayFor',\n\t\t\t'say:': 'bubble',\n\t\t\t'think:duration:elapsed:from:': 'doThinkFor',\n\t\t\t'think:': 'doThink',\n\t\t\t'changeGraphicEffect:by:': 'changeEffect',\n\t\t\t'setGraphicEffect:to:': 'setEffect',\n\t\t\t'filterReset': 'clearEffects',\n\t\t\t'setSizeTo:': 'setScale',\n            'changeSizeBy:': 'changeScale',\n\t\t\t'scale': 'getScale',\n\t\t\t'show': 'show',\n\t\t\t'hide': 'hide',\n\t\t\t'comeToFront': 'comeToFront',\n\t\t\t'goBackByLayers:': 'goBack',\n\n\t\t\t// Sound\n\t\t\t'playSound:': 'playSound',\n\t\t\t'doPlaySoundAndWait': 'doPlaySoundUntilDone',\n\t\t\t'stopAllSounds': 'doStopAllSounds',\n\t\t\t// 'drum:duration:elapsed:from:': '',\n\t\t\t'rest:elapsed:from:': 'doRest',\n\t\t\t'noteOn:duration:elapsed:from:': 'doPlayNote',\n\t\t\t// 'midiInstrument:': '',\n\t\t\t// 'changeVolumeBy:': '',\n\t\t\t// 'setVolumeTo:': '',\n\t\t\t// 'volume': '',\n\t\t\t'changeTempoBy:': 'doChangeTempo',\n\t\t\t'setTempoTo:': 'doSetTempo',\n\t\t\t'tempo': 'getTempo',\n\n\t\t\t// Pen\n\t\t\t'clearPenTrails': 'clear',\n\t\t\t'putPenDown': 'down',\n\t\t\t'putPenUp': 'up',\n\t\t\t'penColor:': 'setColor',\n\t\t\t'changePenHueBy:': 'changeHue',\n\t\t\t'setPenHueTo:': 'setHue',\n            '_changePenHueBy:': 'changeHue',\n            '_setPenHueTo:': 'setHue',\n\t\t\t'changePenShadeBy:': 'changeBrightness',\n\t\t\t'setPenShadeTo:': 'setBrightness',\n\t\t\t'changePenSizeBy:': 'changeSize',\n\t\t\t'penSize:': 'setSize',\n\t\t\t'stampCostume': 'doStamp',\n\n\t\t\t// Control\n\t\t\t// 'whenStartClicked': '',\n\t\t\t// 'whenKeyPressed:': '',\n\t\t\t// 'whenSpriteClicked': '',\n\t\t\t'wait:elapsed:from:': 'doWait',\n\t\t\t'doForever': 'doForever',\n\t\t\t'doRepeat': 'doRepeat',\n\t\t\t'broadcast:': 'doBroadcast',\n\t\t\t'doBroadcastAndWait': 'doBroadcastAndWait',\n\t\t\t// 'whenMessageReceived:': '',\n\t\t\t// TODO 'doForeverIf': '',\n\t\t\t'doIf': 'doIf',\n\t\t\t'doIfElse': 'doIfElse',\n\t\t\t'doWaitUntil': 'doWaitUntil',\n\t\t\t'doUntil': 'doUntil',\n\t\t\t'doReturn': 'doStop',\n\t\t\t'stopAll': 'doStopAll',\n\t\t\t'doRun': 'doRun',\n\t\t\t'doRunBlockWithArgs': 'doRun',\n\t\t\t'doRunBlockWithArgList': 'doRun',\n\t\t\t'doFork': 'fork',\n\t\t\t'doForkBlockWithArgs': 'fork',\n\t\t\t'doForkBlockWithArgList': 'fork',\n\t\t\t'doReport': 'evaluate',\n\t\t\t'doCallBlockWithArgs': 'evaluate',\n\t\t\t'doCallBlockWithArgList': 'evaluate',\n\t\t\t'doAnswer': 'doReport',\n\t\t\t'doStopBlock': 'doStopBlock',\n\t\t\t// 'doPauseThread': '',\n\t\t\t// 'doPauseThreadReporter': '',\n\n\t\t\t// Sensing\n\t\t\t'touching:': 'reportTouchingObject',\n\t\t\t'touchingColor:': 'reportTouchingColor',\n\t\t\t'color:sees:': 'reportColorIsTouchingColor',\n\t\t\t'doAsk': 'doAsk',\n\t\t\t'answer': 'reportLastAnswer',\n\t\t\t'mouseX': 'reportMouseX',\n\t\t\t'mouseY': 'reportMouseY',\n\t\t\t'mousePressed': 'reportMouseDown',\n\t\t\t'keyPressed:': 'reportKeyPressed',\n\t\t\t'distanceTo:': 'reportDistanceTo',\n\t\t\t'timerReset': 'doResetTimer',\n\t\t\t'timer': 'reportTimer',\n\t\t\t'getAttribute:of:': 'reportAttributeOf',\n\t\t\t// 'attribute:of:': '',\n\t\t\t// 'soundLevel': '',\n\t\t\t// 'isLoud': '',\n\t\t\t// 'sensor:': '',\n\t\t\t// 'sensorPressed:': '',\n\t\t\t// 'getObject:': '',\n\t\t\t// 'get:': '',\n\n\t\t\t// Operators\n\t\t\t'+': 'reportSum',\n\t\t\t'-': 'reportDifference',\n\t\t\t'*': 'reportProduct',\n\t\t\t'/': 'reportQuotient',\n\t\t\t'randomFrom:to:': 'reportRandom',\n\t\t\t'<': 'reportLessThan',\n\t\t\t'=': 'reportEquals',\n\t\t\t'>': 'reportGreaterThan',\n\t\t\t'&': 'reportAnd',\n\t\t\t'|': 'reportOr',\n\t\t\t'not': 'reportNot',\n\t\t\t'getTrue': 'reportTrue',\n\t\t\t'getFalse': 'reportFalse',\n\t\t\t'concatenate:with:': 'reportJoinWords',\n\t\t\t'letter:of:': 'reportLetter',\n\t\t\t'stringLength:': 'reportStringSize',\n\t\t\t'asciiCodeOf:': 'reportUnicode',\n\t\t\t'asciiLetter:': 'reportUnicodeAsLetter',\n\t\t\t'\\\\\\\\': 'reportModulus',\n\t\t\t'rounded': 'reportRound',\n\t\t\t'computeFunction:of:': 'reportMonadic',\n\t\t\t'isObject:type:': 'reportIsA',\n\t\t\t// 'procedure': 'reifyScript',\n\t\t\t// 'procedureWithArgs': 'reifyScript',\n\t\t\t// 'function': 'reifyReporter',\n\t\t\t// 'functionWithArgs': 'reifyReporter',\n\t\t\t// 'spawn': '',\n\n\t\t\t// Variables\n\t\t\t'setVar:to:': 'doSetVar',\n\t\t\t'changeVar:by:': 'doChangeVar',\n\t\t\t// 'deleteObject:': '',\n\t\t\t'showVariable:': 'doShowVar',\n\t\t\t'hideVariable:': 'doHideVar',\n\t\t\t'doDeclareVariables': 'doDeclareVariables',\n\t\t\t'newList:': 'reportNewList',\n\t\t\t'append:toList:': 'doAddToList',\n\t\t\t'deleteLine:ofList:': 'doDeleteFromList',\n\t\t\t'insert:at:ofList:': 'doInsertInList',\n\t\t\t'setLine:ofList:to:': 'doReplaceInList',\n\t\t\t'getLine:ofList:': 'reportListItem',\n\t\t\t'lineCountOfList:': 'reportListLength',\n\t\t\t'list:contains:': 'reportListContainsItem',\n\t\t\t// 'contentsOfList:': '',\n\t\t\t// 'copyOfList:': ''\n\n\t\t\t// Kludge\n\t\t\t_warp: 'doWarp'\n\t\t};\n\n\t\tfunction escapeXML(string) {\n            // over-cautious due to some morphic bugs\n\t\t\treturn string.replace(/&/g, '&amp;')/*.replace(/[\\n\\r]|\\r\\n/g, '&#10;')*/.replace(/</g, '&lt;').replace(/\"/g, '&quot;');\n\t\t}\n\t\tfunction costumeIndex(object) {\n\t\t\treturn object.media.filter(function (m) { return m.className === 'ImageMedia' }).indexOf(object.costume) + 1;\n\t\t}\n\n\t\tfunction Text(value) {\n\t\t\tthis.value = '' + value;\n\t\t}\n\t\tText.prototype.toXML = function (string) {\n\t\t\tstring.push(escapeXML(this.value));\n\t\t};\n        Text.prototype.toDOM = function () {\n            return document.createTextNode(this.value);\n        };\n\n\t\tfunction Element(tagName) {\n\t\t\tthis.tagName = tagName;\n\t\t}\n\t\tElement.prototype.toXML = function (string) {\n\t\t\tvar attributes = this.attributes, key;\n\t\t\tstring.push('<', this.tagName);\n\t\t\tfor (key in attributes) if (attributes.hasOwnProperty(key)) {\n\t\t\t\tstring.push(' ', key, '=\"', escapeXML('' + attributes[key]), '\"');\n\t\t\t}\n\t\t\tif (this.children.length) {\n\t\t\t\tstring.push('>');\n\t\t\t\tthis.children.forEach(function (child) {\n\t\t\t\t\tif (!child.toXML) {\n\t\t\t\t\t\tconsole.error('Invalid', child);\n\t\t\t\t\t}\n\t\t\t\t\tchild.toXML(string);\n\t\t\t\t});\n\t\t\t\tstring.push('</', this.tagName, '>');\n\t\t\t} else {\n\t\t\t\tstring.push('/>');\n\t\t\t}\n\t\t};\n        Element.prototype.toDOM = function () {\n            var el = document.createElement(this.tagName),\n                attributes = this.attributes, key,\n                children = this.children, i = 0, child;\n            for (key in attributes) if (attributes.hasOwnProperty(key)) {\n                el.setAttribute(key, attributes[key]);\n            }\n            while (child = children[i++]) {\n                el.appendChild(child.toDOM());\n            }\n            return el;\n        };\n\n\t\tfunction n(tagName, attributes, children) {\n\t\t\tvar el = new Element(tagName), key;\n\t\t\tel.attributes = attributes || {};\n\t\t\tel.children = children || [];\n\t\t\treturn el;\n\t\t}\n\t\tfunction t(value) {\n\t\t\treturn new Text(value);\n\t\t}\n\n\t\tp.write = function (projectName, project) {\n\t\t\tvar a, xml, out, objectID = 0, customBlocks = {};\n\t\t\tfunction id(n) {\n\t\t\t\treturn n.attributes.id ? n('ref', { id: n.attributes.id }) : n.attributes.id = ++objectID, n;\n\t\t\t}\n\t\t\tfunction preCustomBlocks(scope, blocks) {\n\t\t\t\tvar sc = customBlocks[scope] = {};\n\t\t\t\tif (!blocks) return;\n\t\t\t\tblocks.forEach(function (ypr) {\n\t\t\t\t\tsc[ypr.userSpec] = ypr;\n\t\t\t\t\typr.userSpec = ypr.userSpec.replace(/^\\s+|\\s+$/g, '').replace(/\\s{2,}/g, ' ').replace(/'/g, '');\n\t\t\t\t\typr.__blockSpec__ = ypr.userSpec.replace(/%(\\S+)/g, function (_, name) {\n\t\t\t\t\t\tvar type = customBlockInputs[ypr.declarations.get(name)];\n\t\t\t\t\t\tif (type === undefined) {\n\t\t\t\t\t\t\tif (ypr.declarations.get(name) === undefined) {\n\t\t\t\t\t\t\t\ttype = '%s';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconsole.warn('Missing input type ' + ypr.declarations.get(name));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn type;\n\t\t\t\t\t});\n\t\t\t\t\typr.__types__ = (ypr.userSpec.match(/%\\S+/g) || []).map(function (arg) {\n\t\t\t\t\t\treturn ypr.declarations.get(arg.substr(1)) || 'any';\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\tfunction nsCustomBlocks(blocks, globals) {\n\t\t\t\tif (!blocks) return [];\n\t\t\t\treturn (globals ? blocks : blocks.filter(function (b) { return !b.isGlobal })).map(function (ypr) {\n\t\t\t\t\tvar args = (ypr.userSpec.match(/%\\S+/g) || []).map(function (arg) {\n\t\t\t\t\t\t\tvar name = arg.substr(1),\n\t\t\t\t\t\t\t\ttype = customBlockInputs[ypr.declarations.get(name)];\n\t\t\t\t\t\t\tif (type === undefined) {\n\t\t\t\t\t\t\t\ttype = '%s';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn n('input', {\n\t\t\t\t\t\t\t\ttype: type\n\t\t\t\t\t\t\t}, [t(ypr.defaults.get(name))]);\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tspec = ypr.userSpec.replace(/%(\\S+)/g, '%\\'$1\\'');\n\t\t\t\t\typr.body = ypr.body || [];\n\t\t\t\t\tif (ypr.answer && ypr.answer.pop) {\n\t\t\t\t\t\typr.body.push(['byob', '', 'doAnswer', ypr.answer[0]]);\n\t\t\t\t\t}\n                    if (ypr.blockVars.length) {\n                        ypr.body.unshift(['byob', '', 'doDeclareVariables'].concat(ypr.blockVars.map(function (n) {\n                            return [0, 0, 0, n];\n                        })));\n                    }\n\t\t\t\t\tif (ypr.isAtomic) {\n\t\t\t\t\t\typr.body = [['byob', '', '_warp', ypr.body]];\n\t\t\t\t\t}\n\t\t\t\t\treturn n('block-definition', {\n\t\t\t\t\t\ts: spec,\n\t\t\t\t\t\t// type: ypr.isBoolean ? 'predicate' : ypr.isReporter ? 'reporter' : 'command',\n\t\t\t\t\t\ttype: ypr.type === 'boolean' ? 'predicate' : ypr.answer !== null ? 'reporter' : 'command',\n\t\t\t\t\t\tcategory:\n\t\t\t\t\t\t\typr.category === 'none' ? 'other' :\n\t\t\t\t\t\t\typr.category === 'list' ? 'lists' : ypr.category\n\t\t\t\t\t}, [\n\t\t\t\t\t\tn('inputs', {}, args),\n\t\t\t\t\t\tn('script', {}, nsScript(ypr.body))\n\t\t\t\t\t]);\n\t\t\t\t});\n\t\t\t}\n\t\t\tfunction nsScript(script) {\n\t\t\t\treturn script.map(function (block) {\n\t\t\t\t\treturn nBlock(block);\n\t\t\t\t});\n\t\t\t}\n\t\t\tfunction nBlock(block) {\n\t\t\t\tvar node, a;\n\t\t\t\tnode = n('block');\n\t\t\t\tswitch (block[2]) {\n\t\t\t\tcase 'EventHatMorph':\n\t\t\t\t\tif (block[3] === 'Scratch-StartClicked') {\n\t\t\t\t\t\tnode.attributes.s = 'receiveGo';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnode.attributes.s = 'receiveMessage';\n\t\t\t\t\t\tnode.children.push(n('l', {}, [t(block[3])]));\n\t\t\t\t\t}\n\t\t\t\t\treturn node;\n\t\t\t\tcase 'MouseClickEventHatMorph':\n\t\t\t\t\tnode.attributes.s = 'receiveClick';\n\t\t\t\t\treturn node;\n\t\t\t\tcase 'KeyEventHatMorph':\n\t\t\t\t\tnode.attributes.s = 'receiveKey';\n\t\t\t\t\tnode.children.push(n('l', {}, [t(block[3])]));\n\t\t\t\t\treturn node;\n\t\t\t\tcase 'doRunBlockWithArgs':\n\t\t\t\tcase 'doCallBlockWithArgs':\n\t\t\t\tcase 'doForkBlockWithArgs':\n\t\t\t\t\ta = block.length - 5;\n\t\t\t\t\twhile (a--) {\n\t\t\t\t\t\tif (block[5 + a].pop) {\n\t\t\t\t\t\t\tblock[5 + a] = ['block', '', [block[5 + a]]];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\ta = {\n\t\t\t\t\t\tclassName: 'ScratchListMorph',\n\t\t\t\t\t\tcomplex: block.slice(5)\n\t\t\t\t\t};\n\t\t\t\t\tblock = block.slice(0, 4);\n\t\t\t\t\tblock.push(a);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'doRunBlockWithArgList':\n\t\t\t\tcase 'doCallBlockWithArgList':\n\t\t\t\tcase 'doForkBlockWithArgList':\n\t\t\t\t\ta = block[5];\n\t\t\t\t\tblock = block.slice(0, 4);\n\t\t\t\t\tblock.push(a);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'doDeclareVariables':\n\t\t\t\t\tblock = ['byob', '', 'doDeclareVariables', {\n\t\t\t\t\t\tclassName: 'ScratchListMorph',\n\t\t\t\t\t\tcomplex: block.slice(3).map(function (block) {\n\t\t\t\t\t\t\treturn block[3];\n\t\t\t\t\t\t})\n\t\t\t\t\t}];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'getLine:ofList:':\n\t\t\t\tcase 'append:toList:':\n\t\t\t\tcase 'deleteLine:ofList:':\n\t\t\t\tcase 'setLine:ofList:to:':\n\t\t\t\tcase 'getLine:ofList:':\n\t\t\t\tcase 'insert:at:ofList:':\n\t\t\t\tcase 'lineCountOfList:':\n\t\t\t\tcase 'list:contains:':\n\t\t\t\t\ta = block[2] === 'insert:at:ofList:' ? 5 :\n\t\t\t\t\t\tblock[2] === 'lineCountOfList:' || block[2] === 'list:contains:' ? 3 : 4;\n\t\t\t\t\tif (typeof block[a] === 'string') {\n\t\t\t\t\t\tblock[a] = block[a] === '' ? null : ['byob', '', 'readVariable', block[a]];\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'readBlockVariable':\n\t\t\t\tcase 'readVariable':\n\t\t\t\tcase 'listNamed:':\n\t\t\t\t\tnode.attributes['var'] = block[3];\n\t\t\t\t\treturn node;\n\t\t\t\tcase 'function':\n\t\t\t\tcase 'functionWithArgs':\n\t\t\t\t\tnode.attributes.s = 'reifyReporter';\n\t\t\t\t\tblock.pop();\n\t\t\t\t\tnode.children.push(n('autolambda', {}, [nBlock(block[8])]));\n\t\t\t\t\tif (block[2] === 'functionWithArgs') {\n\t\t\t\t\t\tnode.children.push(n('list', {}, block.slice(9).map(function (arg) {\n\t\t\t\t\t\t\treturn n('l', {}, [t(arg[3])]);\n\t\t\t\t\t\t})));\n\t\t\t\t\t}\n\t\t\t\t\treturn node;\n\t\t\t\tcase 'procedure':\n\t\t\t\tcase 'procedureWithArgs':\n\t\t\t\t\tnode.attributes.s = 'reifyScript';\n\t\t\t\t\tnode.children.push(n('script', {}, nsScript(block.pop())));\n\t\t\t\t\tnode.children.push(n('list', {}, block.slice(8).map(function (arg) {\n\t\t\t\t\t\treturn n('l', {}, [t(arg[3])]);\n\t\t\t\t\t})));\n\t\t\t\t\treturn node;\n\t\t\t\tcase 'autoBlock':\n\t\t\t\tcase 'autoPredicate':\n\t\t\t\t\tnode.attributes.s = block[2] === 'autoPredicate' ? 'reifyPredicate' : 'reifyReporter';\n\t\t\t\t\tnode.children.push(n('autolambda', {}, block[3] ? [nBlock(block[3][0])] : []));\n\t\t\t\t\treturn node;\n\t\t\t\tcase 'concatenate:with:':\n\t\t\t\t\tblock = block.slice(0, 3).concat({\n\t\t\t\t\t\tclassName: 'ScratchListMorph',\n\t\t\t\t\t\tcomplex: block.slice(3)\n\t\t\t\t\t});\n\t\t\t\t\ta = 2;\n\t\t\t\t\twhile (a--) {\n\t\t\t\t\t\tif (block[3].complex[a].pop) {\n\t\t\t\t\t\t\tblock[3].complex[a] = ['block', '', [block[3].complex[a]]];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'loopLambda':\n\t\t\t\t\treturn n('script', {}, block[8] ? nsScript(block[8]) : []);\n\t\t\t\tcase 'autoLambda':\n\t\t\t\t\t// node.attributes.s = block[2] === 'loopLambda' ? 'reifyScript' : 'reifyReporter';\n                    node.attributes.s = 'reifyScript';\n\t\t\t\t\tnode.children.push(n('script', {}, block[8] ? nsScript(block[8]) : []));\n\t\t\t\t\treturn node;\n\t\t\t\tcase 'changeVariable':\n\t\t\t\tcase 'changeBlockVariable':\n\t\t\t\t\tblock = [0, 0, block[4], block[3], block[block[2] === 'changeBlockVariable' ? 6 : 5]];\n\t\t\t\t\tbreak;\n                case 'distanceTo:':\n                case 'gotoSpriteOrMouse:':\n                case 'pointTowards:':\n                case 'touching:':\n                    if (block[3] === 'mouse') {\n                        block[3] = 'mouse-pointer';\n                    } else {\n                        block[3] = block[3].objName;\n                    }\n                    break;\n                case 'doForeverIf':\n                    block = [0, 0, 'doForever', [[0, 0, 'doIf', block[3], block[4]]]]\n                    break;\n                case '\\\\\\\\':\n                case '+':\n                case '-':\n                case '*':\n                case '/':\n                    if (block[3] === ' ') {\n                        block[3] = '';\n                    }\n                    if (block[4] === ' ') {\n                        block[4] = '';\n                    }\n                    break;\n                case 'setPenHueTo:':\n                case 'changePenHueBy:':\n                    block[3] = ['byob', 0, '/', block[3], '2'];\n                    break;\n\t\t\t\t}\n\t\t\t\tif (block[2] === 'doCustomBlock') {\n\t\t\t\t\ta = customBlocks[block[1] === 'Stage' ? '__global__' : block[1]][block[3]];\n\t\t\t\t\tnode = n('custom-block', {\n\t\t\t\t\t\ts: a.__blockSpec__\n\t\t\t\t\t});\n\t\t\t\t\tif (block[1] !== 'Stage' && !a.isGlobal) {\n\t\t\t\t\t\tnode.attributes.scope = block[1];\n\t\t\t\t\t}\n\t\t\t\t\ta.__types__.forEach(function (type, i) {\n\t\t\t\t\t\tif (type === 'template') {\n\t\t\t\t\t\t\tblock[4 + i] = block[4 + i][3];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tblock.shift();\n\t\t\t\t} else {\n\t\t\t\t\tif ((node.attributes.s = blockSelectors[block[2]]) === undefined) {\n\t\t\t\t\t\tconsole.warn('Missing selector mapping for \"' + block[2] + '\"', block);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tblock.slice(3).forEach(function (arg) {\n\t\t\t\t\tif (arg && arg.pop) {\n\t\t\t\t\t\tif (typeof arg[0] === 'string') {\n\t\t\t\t\t\t\tnode.children.push(nBlock(arg));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.children.push(n('script', {}, nsScript(arg)));\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n                        a = nValue(arg);\n                        delete a.attributes.id;\n\t\t\t\t\t\tnode.children.push(a);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn node;\n\t\t\t}\n\t\t\tfunction nsVariables(vars, lists) {\n\t\t\t\treturn vars.keys.map(function (key, i) {\n\t\t\t\t\treturn n('variable', { name: key }, [nValue(vars.values[i], true)]);\n\t\t\t\t}).concat(lists.keys.map(function (key, i) {\n\t\t\t\t\treturn n('variable', { name: key }, [nValue(lists.values[i], true)]);\n\t\t\t\t}));\n\t\t\t}\n\t\t\tfunction nValue(value, listHasItems) {\n\t\t\t\treturn typeof value === 'string' || typeof value === 'number' ? n('l', {}, [t(value)]) :\n\t\t\t\t\tvalue == null || typeof value === 'boolean' ? n('l') :\n\t\t\t\t\tvalue.className === 'ScratchListMorph' ? id(n('list', {}, value.complex.map(function (object, i) {\n\t\t\t\t\t\tvar item = object == null ? n('l', {}, [t((item = value.strings[i]) === 'nil' ? '' : item)]) :\n\t\t\t\t\t\t\ttypeof object === 'string' ? nValue(object) :\n\t\t\t\t\t\t\tobject && object[0] === 'block' ? nsScript(object[2])[0] : n('l');\n\t\t\t\t\t\treturn listHasItems ? n('item', {}, [item]) : item;\n\t\t\t\t\t}))) :\n\t\t\t\t\t// (function () { throw 'Unimplemented' })();\n\t\t\t\t\tvalue.constructor === sb.Color ? n('color', {}, [t([value.r * 255, value.g * 255, value.b * 255, value.a * 255])]) :\n\t\t\t\t\tvalue.constructor === sb.Dictionary ? id(n('list')) :\n\t\t\t\t\t(function () { console.warn('No serializer for', value); return n('__undefined__') })();\n\t\t\t}\n\t\t\tfunction nsCostumes(media) {\n\t\t\t\treturn [id(n('list', {}, media.filter(function (m) { return m.className === 'ImageMedia' }).map(function (c) {\n\t\t\t\t\treturn n('item', {}, [\n\t\t\t\t\t\tn('costume', {\n\t\t\t\t\t\t\tname: c.mediaName,\n\t\t\t\t\t\t\t'center-x': c.rotationCenter.x,\n\t\t\t\t\t\t\t'center-y': c.rotationCenter.y,\n\t\t\t\t\t\t\timage: c.form.image.toDataURL()\n\t\t\t\t\t\t})\n\t\t\t\t\t]);\n\t\t\t\t})))];\n\t\t\t}\n\t\t\tfunction nsSounds(media) {\n\t\t\t\tif (media.filter(function (m) { return m.className === 'SoundMedia' }).length > 0) {\n\t\t\t\t\tconsole.warn('Sounds are unimplemented');\n\t\t\t\t}\n\t\t\t\treturn [id(n('list'))];\n\t\t\t}\n\t\t\tfunction nsScripts(scripts) {\n\t\t\t\treturn scripts.map(function (script) {\n\t\t\t\t\tif (script[1][0] && script[1][0][2] === 'scratchComment') {\n\t\t\t\t\t\treturn n('comment', {\n\t\t\t\t\t\t\tx: script[0].x,\n\t\t\t\t\t\t\ty: script[0].y,\n\t\t\t\t\t\t\tw: script[1][0][5],\n\t\t\t\t\t\t\tcollapsed: !script[1][0][4]\n\t\t\t\t\t\t}, [t(script[1][0][3])]);\n\t\t\t\t\t}\n\t\t\t\t\treturn n('script', {\n\t\t\t\t\t\tx: script[0].x,\n\t\t\t\t\t\ty: script[0].y\n\t\t\t\t\t}, nsScript(script[1]));\n\t\t\t\t});\n\t\t\t}\n\t\t\tfunction nsSprites(sprites, vars, lists) {\n\t\t\t\treturn sprites.map(function (sprite, i) {\n\t\t\t\t\treturn id(n('sprite', {\n\t\t\t\t\t\tname: sprite.objName,\n\t\t\t\t\t\tx: (sprite.bounds.origin.x + sprite.bounds.corner.x) / 2 - 240,\n\t\t\t\t\t\ty: 180 - (sprite.bounds.origin.y + sprite.bounds.corner.y) / 2,\n                        hidden: sprite.flags === 1,\n\t\t\t\t\t\theading: sprite.rotationDegrees + 90,\n\t\t\t\t\t\tscale: sprite.scalePoint.x,\n\t\t\t\t\t\trotation: rotationStyles[sprite.rotationStyle],\n\t\t\t\t\t\tdraggable: sprite.draggable,\n\t\t\t\t\t\tcostume: costumeIndex(sprite),\n\t\t\t\t\t\tcolor: (sprite.color.r * 255 | 0) + ',' + (sprite.color.g * 255 | 0) + ',' + (sprite.color.b * 255 | 0),\n                        pen: 'tip',\n                        idx: i\n\t\t\t\t\t}, [\n\t\t\t\t\t\tn('variables', {}, nsVariables(sprite.vars, sprite.lists)),\n\t\t\t\t\t\tn('costumes', {}, nsCostumes(sprite.media)),\n\t\t\t\t\t\tn('sounds', {}, nsSounds(sprite.media)),\n\t\t\t\t\t\tn('blocks', {}, nsCustomBlocks(sprite.customBlocks, false)),\n\t\t\t\t\t\tn('scripts', {}, nsScripts(sprite.blocksBin))\n\t\t\t\t\t]));\n\t\t\t\t}).concat(vars.keys.concat(lists.keys).map(function (name) {\n\t\t\t\t\treturn n('watcher', {\n\t\t\t\t\t\t'var': name,\n\t\t\t\t\t\tstyle: 'normal',\n\t\t\t\t\t\tx: 10,\n\t\t\t\t\t\ty: 10,\n\t\t\t\t\t\tcolor: '243,118,29',\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t});\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tconsole.log(project);\n\t\t\tpreCustomBlocks('__global__', project.stage.customBlocks);\n\t\t\tproject.stage.sprites.forEach(function (sprite) {\n\t\t\t\tpreCustomBlocks(sprite.objName, sprite.customBlocks);\n\t\t\t});\n\t\t\txml = n('project', {\n\t\t\t\tname: projectName,\n\t\t\t\tapp: 'Snap! 4.0, http://snap.berkeley.edu; serialized by yprxml, http://dl.dropbox.com/u/10715865/Web/snap/app/yprxml.html',\n\t\t\t\tversion: '1'\n\t\t\t}, [\n\t\t\t\tn('notes', {}, [t(project.info.get('comment') || '')]),\n\t\t\t\tn('thumbnail', {}, [t((a = project.info.get('thumbnail')) ? a.image.toDataURL() : '')]),\n\t\t\t\tid(n('stage', {\n                    name: 'Stage',\n                    tempo: project.stage.tempoBPM,\n\t\t\t\t\tcostume: costumeIndex(project.stage),\n\t\t\t\t\tthreadsafe: 'false',\n                    scheduled: true\n\t\t\t\t}, [\n\t\t\t\t\tn('pentrails', {}, [t((a = project.info.get('penTrails')) ? a.image.toDataURL() : '')]),\n\t\t\t\t\tn('costumes', {}, nsCostumes(project.stage.media)),\n\t\t\t\t\tn('sounds', {}, nsSounds(project.stage.media)),\n\t\t\t\t\tn('blocks', {}, []),\n\t\t\t\t\tn('variables', {}, []),\n\t\t\t\t\tn('scripts', {}, nsScripts(project.stage.blocksBin)),\n\t\t\t\t\tn('sprites', {}, nsSprites(project.stage.sprites, project.stage.vars, project.stage.lists))\n\t\t\t\t])),\n\t\t\t\tn('variables', {}, nsVariables(project.stage.vars, project.stage.lists)),\n\t\t\t\tn('blocks', {}, nsCustomBlocks(project.stage.customBlocks, true))\n\t\t\t]);\n\t\t\txml.toXML(out = []);\n            // var d = document.createElement('textarea');\n            // d.style.position = 'absolute';\n            // document.body.appendChild(d).value = out.join('');\n\t\t\treturn out.join('');\n\t\t};\n\n\t})(sb.XMLWriter = function () {}, sb.XMLWriter.prototype);\n\n\treturn sb;\n\n})({});\n","/*\n\n    symbols.js\n\n    graphical GUI-symbols for for morphic.js and Snap!\n\n    written by Jens Mnig\n    jens@moenig.org\n\n    Copyright (C) 2020 by Jens Mnig\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    prerequisites:\n    --------------\n    needs morphic.js\n\n\n    credits:\n    --------\n    additional symbols have been contributed by members of the Snap!\n    open-source community, especially by Bernat Romagosa\n\n*/\n\n/*global modules, Morph, Point, radians, ZERO, BLACK*/\nimport {modules, Morph, Point, radians, ZERO, BLACK} from './morphic';\n// Global stuff ////////////////////////////////////////////////////////\n\nmodules.symbols = '2020-October-07';\n\n\n// SymbolMorph //////////////////////////////////////////////////////////\n\n/*\n    I display graphical symbols, such as special letters. I have been\n    called into existence out of frustration about not being able to\n    consistently use Unicode characters to the same ends.\n\n    Symbols can also display costumes, if one is specified in lieu\n    of a name property, although this feature is currently not being\n    used because of asynchronous image loading issues.\n */\n\n// SymbolMorph inherits from Morph:\n\nSymbolMorph.prototype = new Morph();\nSymbolMorph.prototype.constructor = SymbolMorph;\nSymbolMorph.uber = Morph.prototype;\n\n// SymbolMorph available symbols:\n\nSymbolMorph.prototype.names = [\n    'square',\n    'pointRight',\n    'stepForward',\n    'gears',\n    'gearPartial',\n    'gearBig',\n    'file',\n    'fullScreen',\n    'grow',\n    'normalScreen',\n    'shrink',\n    'smallStage',\n    'normalStage',\n    'turtle',\n    'turtleOutline',\n    'stage',\n    'pause',\n    'flag',\n    'octagon',\n    'cloud',\n    'cloudGradient',\n    'cloudOutline',\n    'turnRight',\n    'turnLeft',\n    'turnAround',\n    'storage',\n    'poster',\n    'flash',\n    'brush',\n    'tick',\n    'checkedBox',\n    'rectangle',\n    'rectangleSolid',\n    'circle',\n    'circleSolid',\n    'ellipse',\n    'line',\n    'cross',\n    'crosshairs',\n    'paintbucket',\n    'eraser',\n    'pipette',\n    'speechBubble',\n    'speechBubbleOutline',\n    'loop',\n    'turnBack',\n    'turnForward',\n    'arrowUp',\n    'arrowUpOutline',\n    'arrowUpThin',\n    'arrowUpDownThin',\n    'arrowLeft',\n    'arrowLeftOutline',\n    'arrowLeftThin',\n    'arrowLeftRightThin',\n    'arrowDown',\n    'arrowDownOutline',\n    'arrowDownThin',\n    'arrowRight',\n    'arrowRightOutline',\n    'arrowRightThin',\n    'robot',\n    'magnifyingGlass',\n    'magnifierOutline',\n    'selection',\n    'polygon',\n    'closedBrush',\n    'notes',\n    'camera',\n    'location',\n    'footprints',\n    'keyboard',\n    'keyboardFilled',\n    'globe',\n    'globeBig',\n    'list',\n    'flipVertical',\n    'flipHorizontal'\n];\n\n// SymbolMorph instance creation:\n\nexport function SymbolMorph(name, size, color, shadowOffset, shadowColor) {\n    this.init(name, size, color, shadowOffset, shadowColor);\n}\n\nSymbolMorph.prototype.init = function (\n    name,\n    size,\n    color,\n    shadowOffset,\n    shadowColor\n) {\n    this.isProtectedLabel = false; // participate in zebraing\n    this.isReadOnly = true;\n    this.name = name || 'square';\n    this.size = size || 50;\n    this.shadowOffset = shadowOffset || ZERO;\n    this.shadowColor = shadowColor || null;\n    SymbolMorph.uber.init.call(this);\n    this.color = color || BLACK;\n    this.fixLayout();\n    this.rerender();\n};\n\n// SymbolMorph string representation: 'a SymbolMorph: \"square\"'\n\nSymbolMorph.prototype.toString = function () {\n    return 'a ' +\n        (this.constructor.name ||\n            this.constructor.toString().split(' ')[1].split('(')[0]) +\n        ': \"' +\n        this.name +\n        '\" ' +\n        this.bounds;\n};\n\n// SymbolMorph zebra coloring:\n\nSymbolMorph.prototype.setLabelColor = function (\n    textColor,\n    shadowColor,\n    shadowOffset\n) {\n    this.shadowOffset = shadowOffset || new Point();\n    this.shadowColor = shadowColor;\n    this.setColor(textColor);\n};\n\n// SymbolMorph dynamic coloring:\n\nSymbolMorph.prototype.getShadowRenderColor = function () {\n    // answer the shadow rendering color, can be overridden for my children\n    return this.shadowColor;\n};\n\n// SymbolMorph layout:\n\nSymbolMorph.prototype.setExtent = function (aPoint) {\n    if (this.size === aPoint.y) {return; }\n    this.changed();\n    this.size = aPoint.y;\n    this.fixLayout();\n    this.rerender();\n};\n\nSymbolMorph.prototype.fixLayout = function () {\n    // determine my extent\n    this.bounds.setWidth(this.symbolWidth() + Math.abs(this.shadowOffset.x));\n    this.bounds.setHeight(this.size + Math.abs(this.shadowOffset.y));\n};\n\n// SymbolMorph displaying:\n\nSymbolMorph.prototype.render = function (ctx) {\n    var sx = this.shadowOffset.x < 0 ? 0 : this.shadowOffset.x,\n        sy = this.shadowOffset.y < 0 ? 0 : this.shadowOffset.y,\n        x = this.shadowOffset.x < 0 ? Math.abs(this.shadowOffset.x) : 0,\n        y = this.shadowOffset.y < 0 ? Math.abs(this.shadowOffset.y) : 0;\n\n    if (this.shadowColor) {\n        ctx.save();\n        ctx.translate(sx, sy);\n        this.renderShape(ctx, this.getShadowRenderColor());\n        ctx.restore();\n    }\n    ctx.save();\n    ctx.translate(x, y);\n    this.renderShape(ctx, this.getRenderColor());\n    ctx.restore();\n};\n\nSymbolMorph.prototype.renderShape = function (ctx, aColor) {\n    // private\n    switch (this.name) {\n    case 'square':\n        this.renderSymbolStop(ctx, aColor);\n        break;\n    case 'pointRight':\n        this.renderSymbolPointRight(ctx, aColor);\n        break;\n    case 'stepForward':\n        this.renderSymbolStepForward(ctx, aColor);\n        break;\n    case 'gears':\n        this.renderSymbolGears(ctx, aColor);\n        break;\n    case 'gearBig':\n        this.renderSymbolGearBig(ctx, aColor);\n        break;\n    case 'gearPartial':\n        this.renderSymbolGearPartial(ctx, aColor);\n        break;\n    case 'file':\n        this.renderSymbolFile(ctx, aColor);\n        break;\n    case 'fullScreen':\n        this.renderSymbolFullScreen(ctx, aColor);\n        break;\n    case 'grow':\n        this.renderSymbolGrow(ctx, aColor);\n        break;\n    case 'normalScreen':\n        this.renderSymbolNormalScreen(ctx, aColor);\n        break;\n    case 'smallStage':\n        this.renderSymbolSmallStage(ctx, aColor);\n        break;\n    case 'normalStage':\n        this.renderSymbolNormalStage(ctx, aColor);\n        break;\n    case 'shrink':\n        this.renderSymbolShrink(ctx, aColor);\n        break;\n    case 'turtle':\n        this.renderSymbolTurtle(ctx, aColor);\n        break;\n    case 'turtleOutline':\n        this.renderSymbolTurtleOutline(ctx, aColor);\n        break;\n    case 'stage':\n        this.renderSymbolStop(ctx, aColor);\n        break;\n    case 'pause':\n        this.renderSymbolPause(ctx, aColor);\n        break;\n    case 'flag':\n        this.renderSymbolFlag(ctx, aColor);\n        break;\n    case 'octagon':\n        this.renderSymbolOctagon(ctx, aColor);\n        break;\n    case 'cloud':\n        this.renderSymbolCloud(ctx, aColor);\n        break;\n    case 'cloudGradient':\n        this.renderSymbolCloudGradient(ctx, aColor);\n        break;\n    case 'cloudOutline':\n        this.renderSymbolCloudOutline(ctx, aColor);\n        break;\n    case 'turnRight':\n        this.renderSymbolTurnRight(ctx, aColor);\n        break;\n    case 'turnLeft':\n        this.renderSymbolTurnLeft(ctx, aColor);\n        break;\n    case 'turnAround':\n        this.renderSymbolTurnAround(ctx, aColor);\n        break;\n    case 'storage':\n        this.renderSymbolStorage(ctx, aColor);\n        break;\n    case 'poster':\n        this.renderSymbolPoster(ctx, aColor);\n        break;\n    case 'flash':\n        this.renderSymbolFlash(ctx, aColor);\n        break;\n    case 'brush':\n        this.renderSymbolBrush(ctx, aColor);\n        break;\n    case 'tick':\n        this.renderSymbolTick(ctx, aColor);\n        break;\n    case 'checkedBox':\n        this.renderSymbolCheckedBox(ctx, aColor);\n        break;\n    case 'rectangle':\n        this.renderSymbolRectangle(ctx, aColor);\n        break;\n    case 'rectangleSolid':\n        this.renderSymbolRectangleSolid(ctx, aColor);\n        break;\n    case 'circle':\n        this.renderSymbolCircle(ctx, aColor);\n        break;\n    case 'circleSolid':\n        this.renderSymbolCircleSolid(ctx, aColor);\n        break;\n    case 'ellipse':\n        this.renderSymbolCircle(ctx, aColor);\n        break;\n    case 'line':\n        this.renderSymbolLine(ctx, aColor);\n        break;\n    case 'cross':\n        this.renderSymbolCross(ctx, aColor);\n        break;\n    case 'crosshairs':\n        this.renderSymbolCrosshairs(ctx, aColor);\n        break;\n    case 'paintbucket':\n        this.renderSymbolPaintbucket(ctx, aColor);\n        break;\n    case 'eraser':\n        this.renderSymbolEraser(ctx, aColor);\n        break;\n    case 'pipette':\n        this.renderSymbolPipette(ctx, aColor);\n        break;\n    case 'speechBubble':\n        this.renderSymbolSpeechBubble(ctx, aColor);\n        break;\n    case 'speechBubbleOutline':\n        this.renderSymbolSpeechBubbleOutline(ctx, aColor);\n        break;\n    case 'loop':\n        this.renderSymbolLoop(ctx, aColor);\n        break;\n    case 'turnBack':\n        this.renderSymbolTurnBack(ctx, aColor);\n        break;\n    case 'turnForward':\n        this.renderSymbolTurnForward(ctx, aColor);\n        break;\n    case 'arrowUp':\n        this.renderSymbolArrowUp(ctx, aColor);\n        break;\n    case 'arrowUpOutline':\n        this.renderSymbolArrowUpOutline(ctx, aColor);\n        break;\n    case 'arrowUpThin':\n        this.renderSymbolArrowUpThin(ctx, aColor);\n        break;\n    case 'arrowUpDownThin':\n        this.renderSymbolArrowUpDownThin(ctx, aColor);\n        break;\n    case 'arrowLeft':\n        this.renderSymbolArrowLeft(ctx, aColor);\n        break;\n    case 'arrowLeftOutline':\n        this.renderSymbolArrowLeftOutline(ctx, aColor);\n        break;\n    case 'arrowLeftThin':\n        this.renderSymbolArrowLeftThin(ctx, aColor);\n        break;\n    case 'arrowLeftRightThin':\n        this.renderSymbolArrowLeftRightThin(ctx, aColor);\n        break;\n    case 'arrowDown':\n        this.renderSymbolArrowDown(ctx, aColor);\n        break;\n    case 'arrowDownOutline':\n        this.renderSymbolArrowDownOutline(ctx, aColor);\n        break;\n    case 'arrowDownThin':\n        this.renderSymbolArrowDownThin(ctx, aColor);\n        break;\n    case 'arrowRight':\n        this.renderSymbolArrowRight(ctx, aColor);\n        break;\n    case 'arrowRightOutline':\n        this.renderSymbolArrowRightOutline(ctx, aColor);\n        break;\n    case 'arrowRightThin':\n        this.renderSymbolArrowRightThin(ctx, aColor);\n        break;\n    case 'robot':\n        this.renderSymbolRobot(ctx, aColor);\n        break;\n    case 'magnifyingGlass':\n        this.renderSymbolMagnifyingGlass(ctx, aColor);\n        break;\n    case 'magnifierOutline':\n        this.renderSymbolMagnifierOutline(ctx, aColor);\n        break;\n    case 'selection':\n        this.renderSymbolSelection(ctx, aColor);\n        break;\n    case 'polygon':\n        this.renderSymbolOctagonOutline(ctx, aColor);\n        break;\n    case 'closedBrush':\n        this.renderSymbolClosedBrushPath(ctx, aColor);\n        break;\n    case 'notes':\n        this.renderSymbolNotes(ctx, aColor);\n        break;\n    case 'camera':\n        this.renderSymbolCamera(ctx, aColor);\n        break;\n    case 'location':\n        this.renderSymbolLocation(ctx, aColor);\n        break;\n    case 'footprints':\n        this.renderSymbolFootprints(ctx, aColor);\n        break;\n    case 'keyboard':\n        this.renderSymbolKeyboard(ctx, aColor);\n        break;\n    case 'keyboardFilled':\n        this.renderSymbolKeyboardFilled(ctx, aColor);\n        break;\n    case 'globe':\n        this.renderSymbolGlobe(ctx, aColor);\n        break;\n    case 'globeBig':\n        this.renderSymbolGlobeBig(ctx, aColor);\n        break;\n    case 'list':\n        this.renderSymbolList(ctx, aColor);\n        break;\n    case 'flipVertical':\n        this.renderSymbolFlipVertical(ctx, aColor);\n        break;\n    case 'flipHorizontal':\n        this.renderSymbolFlipHorizontal(ctx, aColor);\n        break;\n    default:\n        throw new Error('unknown symbol name: \"' + this.name + '\"');\n    }\n};\n\nSymbolMorph.prototype.symbolWidth = function () {\n    // private\n    var size = this.size;\n\n    switch (this.name) {\n    case 'pointRight':\n        return Math.sqrt(size * size - Math.pow(size / 2, 2));\n    case 'location':\n        return size * 0.6;\n    case 'flash':\n    case 'file':\n    case 'list':\n        return size * 0.8;\n    case 'smallStage':\n    case 'normalStage':\n        return size * 1.2;\n    case 'turtle':\n    case 'turtleOutline':\n    case 'stage':\n        return size * 1.3;\n    case 'cloud':\n    case 'cloudGradient':\n    case 'cloudOutline':\n    case 'turnBack':\n    case 'turnForward':\n    case 'keyboard':\n    case 'keyboardFilled':\n        return size * 1.6;\n    case 'turnRight':\n    case 'turnLeft':\n        return size / 3 * 2;\n    case 'loop':\n        return size * 2;\n    default:\n        return size;\n    }\n};\n\nSymbolMorph.prototype.renderSymbolStop = function (ctx, color) {\n    // draw a vertically centered square\n    ctx.fillStyle = color.toString();\n    ctx.fillRect(0, 0, this.symbolWidth(), this.size);\n};\n\nSymbolMorph.prototype.renderSymbolPointRight = function (ctx, color) {\n    // draw a right-pointing, equilateral triangle\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.lineTo(this.symbolWidth(), Math.round(this.size / 2));\n    ctx.lineTo(0, this.size);\n    ctx.lineTo(0, 0);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolStepForward = function (ctx, color) {\n    // draw a right-pointing triangle\n    // followed by a vertical bar\n    var w = this.symbolWidth(),\n        h = this.size;\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.lineTo(w * 0.75, Math.round(h / 2));\n    ctx.lineTo(0, h);\n    ctx.lineTo(0, 0);\n    ctx.closePath();\n    ctx.fill();\n    ctx.fillRect(\n        w * 0.75,\n        0,\n        w * 0.25,\n        h\n    );\n};\n\nSymbolMorph.prototype.renderSymbolGears = function (ctx, color) {\n    // draw gears\n    var w = this.symbolWidth(),\n        r = w / 2,\n        spikes = 8,\n        off = 8,\n        shift = 10,\n        angle, turn, i;\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n\n    // draw the spiked outline\n    ctx.moveTo(w, r);\n    angle = 360 / spikes;\n    turn = angle * 0.5;\n    for (i = 0; i < spikes; i += 1) {\n        ctx.arc(\n            r,\n            r,\n            r,\n            radians(i * angle + turn),\n            radians(i * angle + off + turn)\n        );\n        ctx.arc(\n            r,\n            r,\n            r * 0.7,\n            radians(i * angle - shift + angle * 0.5 + turn),\n            radians(i * angle + shift + angle * 0.5 + turn)\n        );\n        ctx.arc(\n            r,\n            r,\n            r,\n            radians((i + 1) * angle - off + turn),\n            radians((i + 1) * angle + turn)\n        );\n    }\n    ctx.lineTo(w, r);\n\n    // draw the hole in the middle\n    ctx.arc(r, r, r * 0.3, radians(0), radians(360));\n\n    // fill\n    ctx.clip('evenodd');\n    ctx.fillRect(0, 0, w, w);\n};\n\nSymbolMorph.prototype.renderSymbolGearBig = function (ctx, color) {\n    // draw a large gear\n    var w = this.symbolWidth(),\n        r = w / 2,\n        spikes = 10,\n        off = 7,\n        shift = 8,\n        angle, i;\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n\n    // draw the spiked outline\n    ctx.moveTo(w, r);\n    angle = 360 / spikes;\n    for (i = 0; i < spikes; i += 1) {\n        ctx.arc(\n            r,\n            r,\n            r,\n            radians(i * angle),\n            radians(i * angle + off)\n        );\n        ctx.arc(\n            r,\n            r,\n            r * 0.8,\n            radians(i * angle - shift + angle * 0.5),\n            radians(i * angle + shift + angle * 0.5)\n        );\n        ctx.arc(\n            r,\n            r,\n            r,\n            radians((i + 1) * angle - off),\n            radians((i + 1) * angle)\n        );\n    }\n    ctx.lineTo(w, r);\n\n    // draw the holes in the middle\n    ctx.arc(r, r, r * 0.6, radians(0), radians(360));\n    ctx.arc(r, r, r * 0.2, radians(0), radians(360));\n\n    // fill\n    ctx.clip('evenodd');\n    ctx.fillRect(0, 0, w, w);\n};\n\nSymbolMorph.prototype.renderSymbolGearPartial = function (ctx, color) {\n    // draw gears\n    var w = this.symbolWidth(),\n        r = w * 0.75,\n        spikes = 8,\n        off = 8,\n        shift = 10,\n        angle, turn, i;\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n\n    // draw the spiked outline\n    ctx.moveTo(w, r);\n    angle = 360 / spikes;\n    turn = angle * 0.5;\n    for (i = 0; i < spikes; i += 1) {\n        ctx.arc(\n            r,\n            r,\n            r,\n            radians(i * angle + turn),\n            radians(i * angle + off + turn)\n        );\n        ctx.arc(\n            r,\n            r,\n            r * 0.7,\n            radians(i * angle - shift + angle * 0.5 + turn),\n            radians(i * angle + shift + angle * 0.5 + turn)\n        );\n        ctx.arc(\n            r,\n            r,\n            r,\n            radians((i + 1) * angle - off + turn),\n            radians((i + 1) * angle + turn)\n        );\n    }\n    ctx.lineTo(w, r);\n\n    // draw the hole in the middle\n    ctx.arc(r, r, r * 0.3, radians(0), radians(360));\n\n    // fill\n    ctx.clip('evenodd');\n    ctx.fillRect(0, 0, w, w);\n};\n\nSymbolMorph.prototype.renderSymbolFile = function (ctx, color) {\n    // draw a page symbol\n    var height = this.size,\n        width = this.symbolWidth(),\n        w = Math.min(width, height) / 2;\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.lineTo(w, 0);\n    ctx.lineTo(w, w);\n    ctx.lineTo(width, w);\n    ctx.lineTo(width, height);\n    ctx.lineTo(0, height);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = color.darker(25).toString();\n    ctx.beginPath();\n    ctx.moveTo(w, 0);\n    ctx.lineTo(width, w);\n    ctx.lineTo(w, w);\n    ctx.lineTo(w, 0);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolFullScreen = function (ctx, color) {\n    // draw two arrows pointing diagonally outwards\n    var h = this.size,\n        width = this.symbolWidth(),\n        c = width / 2,\n        off = width / 20,\n        w = width / 2;\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = width / 5;\n    ctx.beginPath();\n    ctx.moveTo(c - off, c + off);\n//    ctx.lineTo(0, h);\n    ctx.lineTo(off * 2, h - off * 2);\n    ctx.stroke();\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = width / 5;\n    ctx.beginPath();\n    ctx.moveTo(c + off, c - off);\n    ctx.lineTo(h - off * 2, off * 2);\n    ctx.stroke();\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(0, h);\n    ctx.lineTo(0, h - w);\n    ctx.lineTo(w, h);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(h, 0);\n    ctx.lineTo(h - w, 0);\n    ctx.lineTo(h, w);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolGrow = function (ctx, color) {\n\n    var h = this.size,\n        width = this.symbolWidth(),\n        c = width / 2,\n        off = width / 20,\n        w = width / 3;\n\n    function arrows() {\n        ctx.strokeStyle = color.toString();\n        ctx.lineWidth = width / 7;\n        ctx.beginPath();\n        ctx.moveTo(c - off * 3, c + off * 3);\n        ctx.lineTo(off * 2, h - off * 2);\n        ctx.stroke();\n\n        ctx.strokeStyle = color.toString();\n        ctx.lineWidth = width / 7;\n        ctx.beginPath();\n        ctx.moveTo(c + off * 3 , c - off * 3);\n        ctx.lineTo(h - off * 2, off * 2);\n        ctx.stroke();\n\n        ctx.fillStyle = color.toString();\n        ctx.beginPath();\n        ctx.moveTo(0, h);\n        ctx.lineTo(0, h - w);\n        ctx.lineTo(w, h);\n        ctx.closePath();\n        ctx.fill();\n\n        ctx.fillStyle = color.toString();\n        ctx.beginPath();\n        ctx.moveTo(h, 0);\n        ctx.lineTo(h - w, 0);\n        ctx.lineTo(h, w);\n        ctx.closePath();\n        ctx.fill();\n    }\n\n    // draw four arrows pointing diagonally outwards\n    arrows();\n    ctx.translate(this.size, 0);\n    ctx.rotate(radians(90));\n    arrows();\n};\n\n\nSymbolMorph.prototype.renderSymbolNormalScreen = function (ctx, color) {\n var h = this.size,\n        w = this.symbolWidth(),\n        c = w / 2,\n        off = w / 20;\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = w / 5;\n    ctx.beginPath();\n    ctx.moveTo(c - off * 3, c + off * 3);\n    ctx.lineTo(off, h - off);\n    ctx.stroke();\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = w / 5;\n    ctx.beginPath();\n    ctx.moveTo(c + off * 3, c - off * 3);\n    ctx.lineTo(h - off, off);\n    ctx.stroke();\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(c + off, c - off);\n    ctx.lineTo(w, c - off);\n    ctx.lineTo(c + off, 0);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(c - off, c + off);\n    ctx.lineTo(0, c + off);\n    ctx.lineTo(c - off, w);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolShrink = function (ctx, color) {\n    // draw 4 arrows pointing diagonally inwards\n    var h = this.size,\n        w = this.symbolWidth(),\n        c = w / 2,\n        off = w / 20;\n\n    function arrows() {\n        ctx.strokeStyle = color.toString();\n        ctx.lineWidth = w / 8;\n        ctx.beginPath();\n        ctx.moveTo(c - off * 3, c + off * 3);\n        ctx.lineTo(off, h - off);\n        ctx.stroke();\n\n        ctx.strokeStyle = color.toString();\n        ctx.lineWidth = w / 8;\n        ctx.beginPath();\n        ctx.moveTo(c + off * 3, c - off * 3);\n        ctx.lineTo(h - off, off);\n        ctx.stroke();\n\n        ctx.fillStyle = color.toString();\n        ctx.beginPath();\n        ctx.moveTo(c + off * 2, c - off * 2);\n        ctx.lineTo(w - off, c - off * 2);\n        ctx.lineTo(c + off * 2, 0 + off);\n        ctx.closePath();\n        ctx.fill();\n\n        ctx.fillStyle = color.toString();\n        ctx.beginPath();\n        ctx.moveTo(c - off * 2, c + off * 2);\n        ctx.lineTo(0 + off, c + off * 2);\n        ctx.lineTo(c - off * 2, w - off);\n        ctx.closePath();\n        ctx.fill();\n    }\n\n    arrows();\n    ctx.translate(this.size, 0);\n    ctx.rotate(radians(90));\n    arrows();\n};\n\nSymbolMorph.prototype.renderSymbolSmallStage = function (ctx, color) {\n    // draw a stage toggling symbol\n    var w = this.symbolWidth(),\n        h = this.size,\n        w2 = w / 2,\n        h2 = h / 2;\n\n    ctx.fillStyle = color.darker(50).toString();\n    ctx.fillRect(0, 0, w, h);\n\n    ctx.fillStyle = color.toString();\n    ctx.fillRect(w2, 0, w2, h2);\n\n};\n\nSymbolMorph.prototype.renderSymbolNormalStage = function (ctx, color) {\n    // draw a stage toggling symbol\n    var w = this.symbolWidth(),\n        h = this.size,\n        w2 = w / 2,\n        h2 = h / 2;\n\n    ctx.fillStyle = color.toString();\n    ctx.fillRect(0, 0, w, h);\n\n    ctx.fillStyle = color.darker(50).toString();\n    ctx.fillRect(w2, 0, w2, h2);\n};\n\nSymbolMorph.prototype.renderSymbolTurtle = function (ctx, color) {\n    // draw a LOGO turtle\n    var w = this.symbolWidth(),\n        h = this.size;\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.lineTo(w, h / 2);\n    ctx.lineTo(0, h);\n    ctx.lineTo(h / 2, h / 2);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolTurtleOutline = function (ctx, color) {\n    // draw a LOGO turtle\n    var w = this.symbolWidth(),\n        h = this.size;\n\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.lineTo(w, h / 2);\n    ctx.lineTo(0, h);\n    ctx.lineTo(h / 2, h / 2);\n    ctx.closePath();\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolPause = function (ctx, color) {\n    // draw two parallel rectangles\n    var w = this.symbolWidth() / 5,\n        h = this.size;\n\n    ctx.fillStyle = color.toString();\n    ctx.fillRect(0, 0, w * 2, h);\n    ctx.fillRect(w * 3, 0, w * 2, h);\n};\n\nSymbolMorph.prototype.renderSymbolFlag = function (ctx, color) {\n    // draw a flag\n    var w = this.symbolWidth(),\n        h = this.size,\n        l = Math.max(w / 12, 1);\n\n    ctx.lineWidth = l;\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(l / 2, 0);\n    ctx.lineTo(l / 2, h);\n    ctx.stroke();\n\n    ctx.lineWidth = h / 2;\n    ctx.beginPath();\n    ctx.moveTo(0, h / 4);\n    ctx.bezierCurveTo(\n        w * 0.8,\n        h / 4,\n        w * 0.1,\n        h * 0.5,\n        w,\n        h * 0.5\n    );\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolOctagon = function (ctx, color) {\n    // draw an octagon\n    var side = this.symbolWidth(),\n        vert = (side - (side * 0.383)) / 2;\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(vert, 0);\n    ctx.lineTo(side - vert, 0);\n    ctx.lineTo(side, vert);\n    ctx.lineTo(side, side - vert);\n    ctx.lineTo(side - vert, side);\n    ctx.lineTo(vert, side);\n    ctx.lineTo(0, side - vert);\n    ctx.lineTo(0, vert);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolCloud = function (ctx, color) {\n    // draw a cloud\n    var w = this.symbolWidth(),\n        h = this.size,\n        r1 = h * 2 / 5,\n        r2 = h / 4,\n        r3 = h * 3 / 10,\n        r4 = h / 5;\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.arc(r2, h - r2, r2, radians(90), radians(259), false);\n    ctx.arc(w / 20 * 5, h / 9 * 4, r4, radians(165), radians(300), false);\n    ctx.arc(w / 20 * 11, r1, r1, radians(200), radians(357), false);\n    ctx.arc(w - r3, h - r3, r3, radians(269), radians(90), false);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolCloudGradient = function (ctx, color) {\n    // draw a cloud\n    var w = this.symbolWidth(),\n        h = this.size,\n        gradient,\n        r1 = h * 2 / 5,\n        r2 = h / 4,\n        r3 = h * 3 / 10,\n        r4 = h / 5;\n\n    gradient = ctx.createRadialGradient(\n        0,\n        0,\n        0,\n        0,\n        0,\n        w\n    );\n    gradient.addColorStop(0, color.lighter(25).toString());\n    gradient.addColorStop(1, color.darker(25).toString());\n    ctx.fillStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(r2, h - r2, r2, radians(90), radians(259), false);\n    ctx.arc(w / 20 * 5, h / 9 * 4, r4, radians(165), radians(300), false);\n    ctx.arc(w / 20 * 11, r1, r1, radians(200), radians(357), false);\n    ctx.arc(w - r3, h - r3, r3, radians(269), radians(90), false);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolCloudOutline = function (ctx, color) {\n    // draw cloud\n    var w = this.symbolWidth(),\n        h = this.size,\n        r1 = h * 2 / 5,\n        r2 = h / 4,\n        r3 = h * 3 / 10,\n        r4 = h / 5;\n\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.arc(r2 + 1, h - r2 - 1, r2, radians(90), radians(180), false);\n    ctx.arc(w / 20 * 5, h / 9 * 4, r4, radians(150), radians(300), false);\n    ctx.arc(w / 20 * 11, r1 + 1, r1, radians(210), radians(335), false);\n    ctx.arc(w - r3 - 1, h - r3 - 1, r3, radians(280), radians(90), false);\n    ctx.closePath();\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolTurnRight = function (ctx, color) {\n    // draw a right-turning arrow\n    var w = this.symbolWidth(),\n        l = Math.max(w / 10, 1),\n        r = w / 2;\n\n    ctx.lineWidth = l;\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.arc(r, r * 2, r - l / 2, radians(0), radians(-90), false);\n    ctx.stroke();\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(w, r);\n    ctx.lineTo(r, 0);\n    ctx.lineTo(r, r * 2);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolTurnLeft = function (ctx, color) {\n    // draw a left-turning arrow\n    var w = this.symbolWidth(),\n        l = Math.max(w / 10, 1),\n        r = w / 2;\n\n    ctx.lineWidth = l;\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.arc(r, r * 2, r - l / 2, radians(180), radians(-90), true);\n    ctx.stroke();\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(0, r);\n    ctx.lineTo(r, 0);\n    ctx.lineTo(r, r * 2);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolTurnAround = function (ctx, color) {\n    // draw a right-around-turning arrow\n    var w = this.symbolWidth(),\n        l = Math.max(w / 10, 1),\n        r = w / 2;\n\n    ctx.lineWidth = l;\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.arc(r, r, r - l / 2, radians(-45), radians(225), false);\n    ctx.stroke();\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(0, r * 0.1);\n    ctx.lineTo(r * 0.8, 0);\n    ctx.lineTo(r * 0.7, r * 0.7);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolStorage = function (ctx, color) {\n    // draw a stack of three disks\n    var w = this.symbolWidth(),\n        h = this.size,\n        r = h,\n        unit = h / 11;\n\n    function drawDisk(bottom) {\n        ctx.fillStyle = color.toString();\n        ctx.beginPath();\n        ctx.arc(w / 2, bottom - h, r, radians(60), radians(120), false);\n        ctx.lineTo(0, bottom - unit * 2);\n        ctx.arc(\n            w / 2,\n            bottom - h - unit * 2,\n            r,\n            radians(120),\n            radians(60),\n            true\n        );\n        ctx.closePath();\n        ctx.fill();\n\n        ctx.fillStyle = color.darker(25).toString();\n        ctx.beginPath();\n        ctx.arc(\n            w / 2,\n            bottom + unit * 6 + 1,\n            r,\n            radians(-120), // 60\n            radians(-60), // 120\n            false // true\n        );\n        ctx.stroke();\n    }\n\n    ctx.strokeStyle = color.toString();\n    drawDisk(h);\n    drawDisk(h - unit * 3);\n    drawDisk(h - unit * 6);\n};\n\nSymbolMorph.prototype.renderSymbolPoster = function (ctx, color) {\n    // draw a poster stand\n    var w = this.symbolWidth(),\n        h = this.size,\n        bottom = h * 0.75,\n        edge = h / 5;\n\n    ctx.fillStyle = color.toString();\n    ctx.strokeStyle = color.toString();\n\n    ctx.lineWidth = w / 15;\n\n    ctx.beginPath();\n    ctx.moveTo(w / 2, h / 3);\n    ctx.lineTo(w / 6, h);\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.moveTo(w / 2, h / 3);\n    ctx.lineTo(w / 2, h);\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.moveTo(w / 2, h / 3);\n    ctx.lineTo(w * 5 / 6, h);\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.lineTo(w, 0);\n    ctx.lineTo(w, bottom - edge);\n    ctx.lineTo(w - edge, bottom - edge);\n    ctx.lineTo(w - edge, bottom);\n    ctx.lineTo(0, bottom);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = color.darker(25).toString();\n    ctx.beginPath();\n    ctx.moveTo(w, bottom - edge);\n    ctx.lineTo(w - edge, bottom - edge);\n    ctx.lineTo(w - edge, bottom);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolFlash = function (ctx, color) {\n    // draw a lightning bolt\n    var w = this.symbolWidth(),\n        h = this.size,\n        w3 = w / 3,\n        h3 = h / 3,\n        off = h3 / 3;\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(w3, 0);\n    ctx.lineTo(0, h3);\n    ctx.lineTo(w3, h3);\n    ctx.lineTo(0, h3 * 2);\n    ctx.lineTo(w3, h3 * 2);\n    ctx.lineTo(0, h);\n    ctx.lineTo(w, h3 * 2 - off);\n    ctx.lineTo(w3 * 2, h3 * 2 - off);\n    ctx.lineTo(w, h3 - off);\n    ctx.lineTo(w3 * 2, h3 - off);\n    ctx.lineTo(w, 0);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolBrush = function (ctx, color) {\n    // draw a paintbrush\n    var w = this.symbolWidth(),\n        h = this.size,\n        l = Math.max(w / 30, 0.5);\n\n    ctx.fillStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(w / 8 * 3, h / 2);\n    ctx.quadraticCurveTo(0, h / 2, l, h - l);\n    ctx.quadraticCurveTo(w / 2, h, w / 2, h / 8 * 5);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n    ctx.strokeStyle = color.toString();\n\n    ctx.moveTo(w / 8 * 3, h / 2);\n    ctx.lineTo(w * 0.75, l);\n    ctx.quadraticCurveTo(w, 0, w - l, h * 0.25);\n    ctx.stroke();\n\n    ctx.moveTo(w / 2, h / 8 * 5);\n    ctx.lineTo(w - l, h * 0.25);\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolTick = function (ctx, color) {\n    // draw a check mark\n    var w = this.symbolWidth(),\n        h = this.size;\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(w * 0.2, h * 0.5);\n    ctx.lineTo(w * 0.5, h);\n    ctx.lineTo(w * 0.8, h * 0.3);\n    ctx.lineTo(w, 0);\n    ctx.lineTo(w * 0.65, h * 0.2);\n    ctx.lineTo(w * 0.5, h * 0.65);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolCheckedBox = function (ctx, color) {\n    // draw a rectangle with a check mark\n    this.renderSymbolRectangle(ctx, color);\n    this.renderSymbolTick(ctx, color);\n};\n\nSymbolMorph.prototype.renderSymbolRectangle = function (ctx, color) {\n    // draw a rectangle\n    var w = this.symbolWidth(),\n        h = this.size,\n        l = Math.max(w / 20, 0.5);\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(l, l);\n    ctx.lineTo(w - l, l);\n    ctx.lineTo(w - l, h - l);\n    ctx.lineTo(l, h - l);\n    ctx.closePath();\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolRectangleSolid = function (ctx, color) {\n    // draw a solid rectangle\n    var w = this.symbolWidth(),\n        h = this.size;\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.lineTo(w, 0);\n    ctx.lineTo(w, h);\n    ctx.lineTo(0, h);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolCircle = function (ctx, color) {\n    // draw a circle\n    var w = this.symbolWidth(),\n        l = Math.max(w / 20, 0.5);\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.arc(w / 2, w / 2, w / 2 - l, radians(0), radians(360), false);\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolCircleSolid = function (ctx, color) {\n    // draw a solid circle\n    var w = this.symbolWidth();\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.arc(w / 2, w / 2, w / 2, radians(0), radians(360), false);\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolLine = function (ctx, color) {\n    // draw a plus sign cross\n    var w = this.symbolWidth(),\n        h = this.size,\n        l = Math.max(w / 20, 0.5);\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.lineCap = 'round';\n    ctx.beginPath();\n    ctx.moveTo(l, l);\n    ctx.lineTo(w - l, h - l);\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolCross = function (ctx, color) {\n    // draw a diagonal line\n    var w = this.symbolWidth(),\n        l = Math.max(w / 20, 0.5);\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.lineCap = 'round';\n    ctx.beginPath();\n    ctx.moveTo(l, w / 2);\n    ctx.lineTo(w - l, w / 2);\n    ctx.stroke();\n    ctx.beginPath();\n    ctx.moveTo(w / 2, l);\n    ctx.lineTo(w / 2, w - l);\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolCrosshairs = function (ctx, color) {\n    // draw a crosshairs\n    var w = this.symbolWidth(),\n        h = this.size,\n        l = 0.5;\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(l, h / 2);\n    ctx.lineTo(w - l, h / 2);\n    ctx.stroke();\n    ctx.beginPath();\n    ctx.moveTo(w / 2, l);\n    ctx.lineTo(w / 2, h - l);\n    ctx.stroke();\n    ctx.beginPath();\n    ctx.moveTo(w / 2, h / 2);\n    ctx.arc(w / 2, w / 2, w / 3 - l, radians(0), radians(360), false);\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolPaintbucket = function (ctx, color) {\n    // draw a paint bucket\n    var w = this.symbolWidth(),\n        h = this.size,\n        n = w / 5,\n        l = Math.max(w / 30, 0.5);\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(n * 2, n);\n    ctx.lineTo(n * 4, n * 3);\n    ctx.lineTo(n * 3, n * 4);\n    ctx.quadraticCurveTo(n * 2, h, n, n * 4);\n    ctx.quadraticCurveTo(0, n * 3, n, n * 2);\n    ctx.closePath();\n    ctx.stroke();\n\n    ctx.lineWidth = l;\n    ctx.moveTo(n * 2, n * 2.5);\n    ctx.arc(n * 2, n * 2.5, l, radians(0), radians(360), false);\n    ctx.stroke();\n\n    ctx.moveTo(n * 2, n * 2.5);\n    ctx.lineTo(n * 2, n / 2 + l);\n    ctx.stroke();\n\n    ctx.arc(n * 1.5, n / 2 + l, n / 2, radians(0), radians(180), true);\n    ctx.stroke();\n\n    ctx.moveTo(n, n / 2 + l);\n    ctx.lineTo(n, n * 2);\n    ctx.stroke();\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(n * 3.5, n * 3.5);\n    ctx.quadraticCurveTo(w, n * 3.5, w - l, h);\n    ctx.lineTo(w, h);\n    ctx.quadraticCurveTo(w, n * 2, n * 2.5, n * 1.5);\n    ctx.lineTo(n * 4, n * 3);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolEraser = function (ctx, color) {\n    // draw an eraser\n    var w = this.symbolWidth(),\n        h = this.size,\n        n = w / 4,\n        l = Math.max(w / 20, 0.5);\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(n * 3, l);\n    ctx.lineTo(l, n * 3);\n    ctx.quadraticCurveTo(n, h, n * 2, n * 3);\n    ctx.lineTo(w - l, n);\n    ctx.closePath();\n    ctx.stroke();\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(n * 3, 0);\n    ctx.lineTo(n * 1.5, n * 1.5);\n    ctx.lineTo(n * 2.5, n * 2.5);\n    ctx.lineTo(w, n);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolPipette = function (ctx, color) {\n    // draw an eyedropper\n    var w = this.symbolWidth(),\n        h = this.size,\n        n = w / 4,\n        n2 = n / 2,\n        l = Math.max(w / 20, 0.5);\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(l, h - l);\n    ctx.quadraticCurveTo(n2, h - n2, n2, h - n);\n    ctx.lineTo(n * 2, n * 1.5);\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.moveTo(l, h - l);\n    ctx.quadraticCurveTo(n2, h - n2, n, h - n2);\n    ctx.lineTo(n * 2.5, n * 2);\n    ctx.stroke();\n\n    ctx.fillStyle = color.toString();\n    ctx.arc(n * 3, n, n - l, radians(0), radians(360), false);\n    ctx.fill();\n\n    ctx.beginPath();\n    ctx.moveTo(n * 2, n);\n    ctx.lineTo(n * 3, n * 2);\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolSpeechBubble = function (ctx, color) {\n    // draw a speech bubble\n    var w = this.symbolWidth(),\n        h = this.size,\n        n = w / 3,\n        l = Math.max(w / 20, 0.5);\n\n    ctx.fillStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(n, n * 2);\n    ctx.quadraticCurveTo(l, n * 2, l, n);\n    ctx.quadraticCurveTo(l, l, n, l);\n    ctx.lineTo(n * 2, l);\n    ctx.quadraticCurveTo(w - l, l, w - l, n);\n    ctx.quadraticCurveTo(w - l, n * 2, n * 2, n * 2);\n    ctx.lineTo(n / 2, h - l);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolSpeechBubbleOutline = function (\n    ctx,\n    color\n) {\n    // draw a speech bubble\n    var w = this.symbolWidth(),\n        h = this.size,\n        n = w / 3,\n        l = Math.max(w / 20, 0.5);\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(n, n * 2);\n    ctx.quadraticCurveTo(l, n * 2, l, n);\n    ctx.quadraticCurveTo(l, l, n, l);\n    ctx.lineTo(n * 2, l);\n    ctx.quadraticCurveTo(w - l, l, w - l, n);\n    ctx.quadraticCurveTo(w - l, n * 2, n * 2, n * 2);\n    ctx.lineTo(n / 2, h - l);\n    ctx.closePath();\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolLoop = function (ctx, aColor) {\n    var w = this.symbolWidth(),\n        h = this.size,\n        w2 = w / 2,\n        w4 = w2 / 2,\n        h2 = h / 2,\n        l = Math.max(h / 10, 0.5);\n\n    ctx.lineWidth = l * 2;\n    ctx.strokeStyle = aColor.toString();\n    ctx.beginPath();\n    ctx.moveTo(0, h - l);\n    ctx.lineTo(w2, h - l);\n    ctx.arc(w2, h2, h2 - l, radians(90), radians(0), true);\n    ctx.stroke();\n    ctx.fillStyle = aColor.toString();\n    ctx.beginPath();\n    ctx.moveTo(w4 * 3 - l, 0);\n    ctx.lineTo(w2 - l, h2);\n    ctx.lineTo(w, h2);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolTurnBack = function (ctx, aColor) {\n    var w = this.symbolWidth(),\n        h = this.size,\n        w2 = w / 2,\n        h2 = h / 2,\n        l = Math.max(w / 20, 0.5);\n\n    ctx.fillStyle = aColor.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(0, h2);\n    ctx.lineTo(w2, 0);\n    ctx.lineTo(w2, h);\n    ctx.closePath();\n    ctx.fill();\n    ctx.lineWidth = l * 3;\n    ctx.strokeStyle = aColor.toString();\n    ctx.beginPath();\n    ctx.arc(w2, h, h2, radians(0), radians(-90), true);\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolTurnForward = function (ctx, aColor) {\n    var w = this.symbolWidth(),\n        h = this.size,\n        w2 = w / 2,\n        h2 = h / 2,\n        l = Math.max(w / 20, 0.5);\n\n    ctx.fillStyle = aColor.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(w, h2);\n    ctx.lineTo(w2, 0);\n    ctx.lineTo(w2, h);\n    ctx.closePath();\n    ctx.fill();\n    ctx.lineWidth = l * 3;\n    ctx.strokeStyle = aColor.toString();\n    ctx.beginPath();\n    ctx.arc(w2, h, h2, radians(-180), radians(-90), false);\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolArrowUp = function (ctx, color) {\n    // draw an up arrow\n    var w = this.symbolWidth(),\n        h = this.size,\n        n = w / 2,\n        l = Math.max(w / 20, 0.5);\n\n    ctx.fillStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(l, n);\n    ctx.lineTo(n, l);\n    ctx.lineTo(w - l, n);\n    ctx.lineTo(w * 0.65, n);\n    ctx.lineTo(w * 0.65, h - l);\n    ctx.lineTo(w * 0.35, h - l);\n    ctx.lineTo(w * 0.35, n);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolArrowUpOutline = function (ctx, color) {\n    // draw an up arrow\n    var w = this.symbolWidth(),\n        h = this.size,\n        n = w / 2,\n        l = Math.max(w / 20, 0.5);\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(l, n);\n    ctx.lineTo(n, l);\n    ctx.lineTo(w - l, n);\n    ctx.lineTo(w * 0.65, n);\n    ctx.lineTo(w * 0.65, h - l);\n    ctx.lineTo(w * 0.35, h - l);\n    ctx.lineTo(w * 0.35, n);\n    ctx.closePath();\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolArrowUpThin = function (ctx, color) {\n    // draw a thin up arrow\n    var w = this.symbolWidth(),\n        h = this.size,\n        n = w / 3,\n        l = Math.max(w / 20, 0.5);\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(w - n, n);\n    ctx.lineTo(w / 2, l * 2);\n    ctx.lineTo(n, n);\n    ctx.moveTo(w / 2, l * 2);\n    ctx.lineTo(w / 2, h - l);\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolArrowUpDownThin = function (ctx, color) {\n    // draw a thin up-down arrow\n    var w = this.symbolWidth(),\n        h = this.size,\n        n = w / 3,\n        l = Math.max(w / 20, 0.5);\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(w - n, n);\n    ctx.lineTo(w / 2, l * 2);\n    ctx.lineTo(n, n);\n    ctx.moveTo(w - n, h - n);\n    ctx.lineTo(w / 2, h - l * 2);\n    ctx.lineTo(n, h - n);\n    ctx.moveTo(w / 2, l * 2);\n    ctx.lineTo(w / 2, h - l * 2);\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolArrowDown = function (ctx, color) {\n    // draw a down arrow\n    var w = this.symbolWidth();\n    ctx.save();\n    ctx.translate(w, w);\n    ctx.rotate(radians(180));\n    this.renderSymbolArrowUp(ctx, color);\n    ctx.restore();\n};\n\nSymbolMorph.prototype.renderSymbolArrowDownOutline = function (ctx, color) {\n    // draw a down arrow\n    var w = this.symbolWidth();\n    ctx.save();\n    ctx.translate(w, w);\n    ctx.rotate(radians(180));\n    this.renderSymbolArrowUpOutline(ctx, color);\n    ctx.restore();\n};\n\nSymbolMorph.prototype.renderSymbolArrowDownThin = function (ctx, color) {\n    // draw a thin down arrow\n    var w = this.symbolWidth();\n    ctx.save();\n    ctx.translate(w, w);\n    ctx.rotate(radians(180));\n    this.renderSymbolArrowUpThin(ctx, color);\n    ctx.restore();\n};\n\nSymbolMorph.prototype.renderSymbolArrowLeft = function (ctx, color) {\n    // draw a left arrow\n    var w = this.symbolWidth();\n    ctx.save();\n    ctx.translate(0, w);\n    ctx.rotate(radians(-90));\n    this.renderSymbolArrowUp(ctx, color);\n    ctx.restore();\n};\n\nSymbolMorph.prototype.renderSymbolArrowLeftOutline = function (ctx, color) {\n    // draw a left arrow\n    var w = this.symbolWidth();\n    ctx.save();\n    ctx.translate(0, w);\n    ctx.rotate(radians(-90));\n    this.renderSymbolArrowUpOutline(ctx, color);\n    ctx.restore();\n};\n\nSymbolMorph.prototype.renderSymbolArrowLeftThin = function (ctx, color) {\n    // draw a thin left arrow\n    var w = this.symbolWidth();\n    ctx.save();\n    ctx.translate(0, w);\n    ctx.rotate(radians(-90));\n    this.renderSymbolArrowUpThin(ctx, color);\n    ctx.restore();\n};\n\nSymbolMorph.prototype.renderSymbolArrowLeftRightThin = function (ctx, color) {\n    // draw a thin left-right arrow\n    var w = this.symbolWidth();\n    ctx.save();\n    ctx.translate(0, w);\n    ctx.rotate(radians(-90));\n    this.renderSymbolArrowUpDownThin(ctx, color);\n    ctx.restore();\n};\n\nSymbolMorph.prototype.renderSymbolArrowRight = function (ctx, color) {\n    // draw a right arrow\n    var w = this.symbolWidth();\n    ctx.save();\n    ctx.translate(w, 0);\n    ctx.rotate(radians(90));\n    this.renderSymbolArrowUp(ctx, color);\n    ctx.restore();\n};\n\nSymbolMorph.prototype.renderSymbolArrowRightOutline = function (ctx, color) {\n    // draw a right arrow\n    var w = this.symbolWidth();\n    ctx.save();\n    ctx.translate(w, 0);\n    ctx.rotate(radians(90));\n    this.renderSymbolArrowUpOutline(ctx, color);\n    ctx.restore();\n};\n\nSymbolMorph.prototype.renderSymbolArrowRightThin = function (ctx, color) {\n    // draw a thin right arrow\n    var w = this.symbolWidth();\n    ctx.save();\n    ctx.translate(w, 0);\n    ctx.rotate(radians(90));\n    this.renderSymbolArrowUpThin(ctx, color);\n    ctx.restore();\n};\n\nSymbolMorph.prototype.renderSymbolRobot = function (ctx, color) {\n    // draw a humanoid robot\n    var w = this.symbolWidth(),\n        h = this.size,\n        n = w / 6,\n        n2 = n / 2,\n        l = Math.max(w / 20, 0.5);\n\n    ctx.fillStyle = color.toString();\n    //ctx.lineWidth = l * 2;\n\n    ctx.beginPath();\n    ctx.moveTo(n + l, n);\n    ctx.lineTo(n * 2, n);\n    ctx.lineTo(n * 2.5, n * 1.5);\n    ctx.lineTo(n * 3.5, n * 1.5);\n    ctx.lineTo(n * 4, n);\n    ctx.lineTo(n * 5 - l, n);\n    ctx.lineTo(n * 4, n * 3);\n    ctx.lineTo(n * 4, n * 4 - l);\n    ctx.lineTo(n * 2, n * 4 - l);\n    ctx.lineTo(n * 2, n * 3);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.beginPath();\n    ctx.moveTo(n * 2.75, n + l);\n    ctx.lineTo(n * 2.4, n);\n    ctx.lineTo(n * 2.2, 0);\n    ctx.lineTo(n * 3.8, 0);\n    ctx.lineTo(n * 3.6, n);\n    ctx.lineTo(n * 3.25, n + l);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.beginPath();\n    ctx.moveTo(n * 2.5, n * 4);\n    ctx.lineTo(n, n * 4);\n    ctx.lineTo(n2 + l, h);\n    ctx.lineTo(n * 2, h);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.beginPath();\n    ctx.moveTo(n * 3.5, n * 4);\n    ctx.lineTo(n * 5, n * 4);\n    ctx.lineTo(w - (n2 + l), h);\n    ctx.lineTo(n * 4, h);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.beginPath();\n    ctx.moveTo(n, n);\n    ctx.lineTo(l, n * 1.5);\n    ctx.lineTo(l, n * 3.25);\n    ctx.lineTo(n * 1.5, n * 3.5);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.beginPath();\n    ctx.moveTo(n * 5, n);\n    ctx.lineTo(w - l, n * 1.5);\n    ctx.lineTo(w - l, n * 3.25);\n    ctx.lineTo(n * 4.5, n * 3.5);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolMagnifyingGlass = function (ctx, color) {\n    // draw a magnifying glass\n    var w = this.symbolWidth(),\n        h = this.size,\n        gradient,\n        r = w * 0.3,\n        x = w * 2 / 3 - Math.sqrt(r),\n        y = h / 3 + Math.sqrt(r),\n        l = Math.max(w / 5, 0.5);\n\n    ctx.strokeStyle = color.toString();\n\n    gradient = ctx.createRadialGradient(\n        x,\n        y,\n        0,\n        x + r,\n        y + r,\n        w\n    );\n\n    gradient.addColorStop(0, color.inverted().lighter(50).toString());\n    gradient.addColorStop(1, color.inverted().darker(25).toString());\n    ctx.fillStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(x, y, r, radians(0), radians(360), false);\n    ctx.fill();\n\n    ctx.lineWidth = l / 2;\n    ctx.beginPath();\n    ctx.arc(x, y, r, radians(0), radians(360), false);\n    ctx.stroke();\n\n    ctx.lineWidth = l;\n    ctx.beginPath();\n    ctx.moveTo(l / 2, h - l / 2);\n    ctx.lineTo(x - Math.sqrt(r + l), y + Math.sqrt(r + l));\n    ctx.closePath();\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolMagnifierOutline = function (ctx, color) {\n    // draw a magnifying glass\n    var w = this.symbolWidth(),\n        h = this.size,\n        r = w * 0.3,\n        x = w * 2 / 3 - Math.sqrt(r),\n        y = h / 3 + Math.sqrt(r),\n        l = Math.max(w / 5, 0.5);\n\n    ctx.strokeStyle = color.toString();\n\n    ctx.lineWidth = l * 0.5;\n    ctx.beginPath();\n    ctx.arc(x, y, r, radians(0), radians(360), false);\n    ctx.stroke();\n\n    ctx.lineWidth = l;\n    ctx.beginPath();\n    ctx.moveTo(l / 2, h - l / 2);\n    ctx.lineTo(x - Math.sqrt(r + l), y + Math.sqrt(r + l));\n    ctx.closePath();\n    ctx.stroke();\n};\n\n\nSymbolMorph.prototype.renderSymbolSelection = function (ctx, color) {\n    // draw a filled arrow and a dashed rectangle\n    var w = this.symbolWidth(),\n        h = this.size;\n\n    ctx.save();\n    ctx.setLineDash([3]);\n    this.renderSymbolRectangle(ctx, color);\n    ctx.restore();\n\n    ctx.save();\n    ctx.fillStyle = color.toString();\n    ctx.translate(0.7 * w, 0.4 * h);\n    ctx.scale(0.5, 0.5);\n    ctx.rotate(radians(135));\n    this.renderSymbolArrowDownOutline(ctx, color);\n    ctx.fill();\n    ctx.restore();\n};\n\nSymbolMorph.prototype.renderSymbolOctagonOutline = function (ctx, color) {\n    // draw an octagon\n    var side = this.symbolWidth(),\n        vert = (side - (side * 0.383)) / 2,\n        l = Math.max(side / 20, 0.5);\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = l * 2;\n    ctx.beginPath();\n    ctx.moveTo(vert, l);\n    ctx.lineTo(side - vert, l);\n    ctx.lineTo(side - l, vert);\n    ctx.lineTo(side - l, side - vert);\n    ctx.lineTo(side - vert, side - l);\n    ctx.lineTo(vert, side - l);\n    ctx.lineTo(l, side - vert);\n    ctx.lineTo(l, vert);\n    ctx.closePath();\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolClosedBrushPath =\n\tSymbolMorph.prototype.renderSymbolCloudOutline;\n\nSymbolMorph.prototype.renderSymbolNotes = function (ctx, color) {\n    // draw two musical notes\n    var size = this.symbolWidth(),\n        r = size / 6,\n        l = Math.max(r / 3, 1);\n\n    ctx.strokeStyle = color.toString();\n    ctx.fillStyle = color.toString();\n\n    ctx.beginPath();\n    ctx.arc(r, size - r, r, radians(0), radians(360), false);\n    ctx.fill();\n    ctx.beginPath();\n    ctx.arc(size - r, size - (r * 2), r, radians(0), radians(360), false);\n    ctx.fill();\n\n    ctx.beginPath();\n    ctx.moveTo(r * 2 - l, r);\n    ctx.lineTo(size, 0);\n    ctx.lineTo(size, r);\n    ctx.lineTo(r * 2 - l, r * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.lineWidth = l;\n    ctx.beginPath();\n    ctx.moveTo(r * 2 - (l / 2), size - r);\n    ctx.lineTo(r * 2 - (l / 2), r + l);\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.moveTo(size - (l / 2), size - (r * 2));\n    ctx.lineTo(size - (l / 2), l);\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolCamera = function (ctx, color) {\n    // draw a camera\n    var w = this.symbolWidth(),\n        h = this.size,\n        r = w * 0.16,\n        l = Math.max(w / 20, 0.5);\n\n    ctx.lineWidth = l * 2;\n\n    // camera body\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(l, h * 5 / 6);\n    ctx.lineTo(w - l, h * 5 / 6);\n    ctx.lineTo(w - l, h / 4);\n    ctx.lineTo(w * 3 / 4 , h / 4);\n    ctx.lineTo(w * 5 / 8 , l);\n    ctx.lineTo(w * 3 / 8 , l);\n    ctx.lineTo(w / 4 , h / 4);\n    ctx.lineTo(l , h / 4);\n    ctx.lineTo(l, h * 5 / 6);\n\n    // camera lens\n    ctx.arc(w / 2, h / 2, r, radians(0), radians(360), false);\n\n    ctx.clip();\n    ctx.fillRect(0, 0, w, h);\n};\n\nSymbolMorph.prototype.renderSymbolLocation = function (ctx, color) {\n    // draw a map pin\n    var w = this.symbolWidth(),\n        h = this.size,\n        r = w / 2;\n\n    // pin\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n\n    ctx.moveTo(0, r);\n    ctx.arc(r, r, r, radians(-180), radians(0), false);\n    ctx.lineTo(r, h);\n    ctx.lineTo(0, r);\n\n    // hole\n    ctx.arc(r, r, r * 0.5, radians(0), radians(360), false);\n\n    ctx.clip('evenodd');\n    ctx.fillRect(0, 0, w, h);\n};\n\nSymbolMorph.prototype.renderSymbolFootprints = function (ctx, color) {\n    // draw a pair of (shoe) footprints\n    var w = this.symbolWidth(),\n        u = w / 10,\n        r = u * 1.5;\n\n    ctx.fillStyle = color.toString();\n\n    // left shoe\n    // tip\n    ctx.beginPath();\n    ctx.arc(r, r, r, radians(-200), radians(0), false);\n    ctx.lineTo(r * 2, u * 5.5);\n    ctx.lineTo(u, u * 6);\n    ctx.closePath();\n    ctx.fill();\n    // heel\n    ctx.beginPath();\n    ctx.arc(u * 2.25, u * 6.75, u , radians(-40), radians(-170), false);\n    ctx.closePath();\n    ctx.fill();\n\n    // right shoe\n    // tip\n    ctx.beginPath();\n    ctx.arc(w - r, u * 4.5, r, radians(-180), radians(20), false);\n    ctx.lineTo(w - u, u * 8.5);\n    ctx.lineTo(w - (r * 2), u * 8);\n    ctx.closePath();\n    ctx.fill();\n    // heel\n    ctx.beginPath();\n    ctx.arc(w - (u * 2.25), u * 9, u, radians(0), radians(-150), false);\n    ctx.closePath();\n    ctx.fill();\n};\n\nSymbolMorph.prototype.renderSymbolKeyboard = function (ctx, color) {\n    // draw a typing keyboard\n    var h = this.size,\n        u = h / 10,\n        k = h / 5,\n        row, col;\n\n    ctx.fillStyle = color.toString();\n    for (row = 0; row < 2; row += 1) {\n\t\tfor (col = 0; col < 5; col += 1) {\n\t\t\tctx.fillRect(\n      \t\t\t((u + k) * col) + u,\n          \t\t((u + k) * row) + u,\n           \t\tk,\n           \t\tk\n\t\t\t);\n   \t\t}\n  \t}\n\tctx.fillRect(u * 4, u * 7, k * 4, k);\n};\n\nSymbolMorph.prototype.renderSymbolKeyboardFilled = function (ctx, color) {\n    // draw a typing keyboard\n    var w = this.symbolWidth(),\n        h = this.size,\n        u = h / 10,\n        k = h / 5,\n        row, col;\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.rect(0, 0, w, h);\n    for (row = 0; row < 2; row += 1) {\n        for (col = 0; col < 5; col += 1) {\n            ctx.rect(\n                  ((u + k) * col) + u,\n                  ((u + k) * row) + u,\n                   k,\n                   k\n            );\n           }\n      }\n    ctx.rect(u * 4, u * 7, k * 4, k);\n\n    ctx.clip('evenodd');\n    ctx.fillRect(0, 0, w, h);\n};\n\nSymbolMorph.prototype.renderSymbolGlobeBig = function (ctx, color) {\n    this.renderSymbolGlobe(ctx, color, true);\n};\n\nSymbolMorph.prototype.renderSymbolGlobe = function (ctx, color, detailed) {\n    // draw a stylized globe\n    var w = this.symbolWidth(),\n        l = Math.max(w / 30, 0.5);\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = l * 2;\n\n    ctx.beginPath();\n    ctx.arc(w / 2, w / 2, w / 2 - l, radians(0), radians(360), false);\n    ctx.stroke();\n\n    if (detailed) {\n        ctx.moveTo(l * 3, w * 0.3);\n        ctx.lineTo(w - l * 3, w * 0.3);\n        ctx.stroke();\n        ctx.moveTo(l * 3, w * 0.7);\n        ctx.lineTo(w - l * 3, w * 0.7);\n        ctx.stroke();\n    }\n\n    // single line version, looks better when small:\n    ctx.beginPath();\n    ctx.moveTo(l, w / 2);\n    ctx.lineTo(w - l, w / 2);\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.moveTo(w / 2, l / 2);\n    ctx.arcTo(0, w / 2, w / 2, w, w * 0.75);\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.moveTo(w / 2, l / 2);\n    ctx.arcTo(w, w / 2, w / 2, w, w * 0.75);\n    ctx.stroke();\n};\n\nSymbolMorph.prototype.renderSymbolList = function (ctx, color) {\n    // draw a stylized list\n    var w = this.symbolWidth(),\n        h = this.size,\n        padding = h / 10,\n        item = h / 5,\n        row;\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.rect(0, 0, w, h);\n    for (row = 0; row < 4; row += 1) {\n        ctx.rect(\n            padding,\n            ((padding + item) * row) + padding,\n            w - item,\n            item\n        );\n    }\n    ctx.clip('evenodd');\n    ctx.fillRect(0, 0, w, h);\n};\n\nSymbolMorph.prototype.renderSymbolFlipHorizontal = function (ctx, color) {\n    var w = this.symbolWidth(),\n        h = this.size,\n        c = w / 2,\n        off = w / 15;\n\n    ctx.strokeStyle = color.toString();\n    ctx.lineWidth = w / 15;\n    ctx.beginPath();\n    ctx.moveTo(0 + off, h - off / 2);\n    ctx.lineTo(c - off * 1.2, h - off / 2);\n    ctx.lineTo(c - off * 1.2, off * 2);\n    ctx.closePath();\n    ctx.stroke();\n\n    ctx.fillStyle = color.toString();\n    ctx.lineWidth = w / 15;\n    ctx.beginPath();\n    ctx.moveTo(w - off, h - off / 2);\n    ctx.lineTo(c + off * 1.2, h - off / 2);\n    ctx.lineTo(c + off * 1.2, off * 2);\n    ctx.closePath();\n    ctx.stroke();\n    ctx.fill();\n    };\n\nSymbolMorph.prototype.renderSymbolFlipVertical = function (ctx, color) {\n    ctx.translate(0, this.size);\n    ctx.rotate(radians(-90));\n    this.renderSymbolFlipHorizontal(ctx, color);\n};\n\n\n/*\n// register examples with the World demo menu\n// comment out to shave off a millisecond loading speed ;-)\n\n(function () {\n    var bright = new Color(240, 240, 240),\n        dark = new Color(20, 20, 20),\n        offset = new Point(-1, -1);\n\n    SymbolMorph.prototype.addToDemoMenu([\n        'Symbols',\n        SymbolMorph.prototype.names.map(sym => [\n            new SymbolMorph(\n                sym,\n                30,\n                bright,\n                offset,\n                dark\n            ),\n            sym\n        ])\n    ]);\n})();\n*/\n","/*\n\n    threads.js\n\n    a tail call optimized blocks-based programming language interpreter\n    based on morphic.js and blocks.js\n    inspired by Scratch, Scheme and Squeak\n\n    written by Jens Mnig\n    jens@moenig.org\n\n    Copyright (C) 2020 by Jens Mnig\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    prerequisites:\n    --------------\n    needs blocks.js and objects.js\n\n\n    toc\n    ---\n    the following list shows the order in which all constructors are\n    defined. Use this list to locate code in this document:\n\n        ThreadManager\n        Process\n        Context\n        Variable\n        VariableFrame\n        JSCompiler\n\n    credits\n    -------\n    John Maloney and Dave Feinberg designed the original Scratch evaluator\n    Ivan Motyashov contributed initial porting from Squeak\n\n*/\n\n// Global stuff ////////////////////////////////////////////////////////\n\n/*global ArgMorph, BlockMorph, CommandBlockMorph, CommandSlotMorph, Morph, ZERO,\nMultiArgMorph, Point, ReporterBlockMorph, SyntaxElementMorph, contains, Costume,\ndegrees, detect, nop, radians, ReporterSlotMorph, CSlotMorph, RingMorph, Sound,\nIDE_Morph, ArgLabelMorph, localize, XML_Element, hex_sha512, TableDialogMorph,\nStageMorph, SpriteMorph, StagePrompterMorph, Note, modules, isString, copy, Map,\nisNil, WatcherMorph, List, ListWatcherMorph, alert, console, TableMorph, BLACK,\nTableFrameMorph, ColorSlotMorph, isSnapObject, newCanvas, Symbol, SVG_Costume*/\n\n\n\nimport {ZERO, BLACK, modules, contains, Morph,Point,\n  degrees, detect, nop, radians,\n  localize, isString,\n  isNil,newCanvas} from './morphic'\n\n\nimport {ArgMorph, BlockMorph, CommandBlockMorph, CommandSlotMorph,\n  MultiArgMorph,  ReporterBlockMorph, SyntaxElementMorph,\n  ReporterSlotMorph, CSlotMorph, RingMorph\n  , ArgLabelMorph,   ColorSlotMorph} from './blocks.js'\n\nmodules.threads = '2020-November-20';\n\n// export var ThreadManager;\n// export var Process;\n// export var Context;\n// export var Variable;\n// export var VariableFrame;\n// export var JSCompiler;\n\nexport const NONNUMBERS = [true, false, ''];\n\n(function () {\n    // \"zum Schneckengang verdorben, was Adlerflug geworden wre\"\n    // collecting edge-cases that somebody complained about\n    // on Github. Folks, take it easy and keep it fun, okay?\n    // Shit like this is patently ugly and slows Snap down. Tnx!\n    for (var i = 9; i <= 13; i += 1) {\n        NONNUMBERS.push(String.fromCharCode(i));\n    }\n    NONNUMBERS.push(String.fromCharCode(160));\n})();\n\n\n\n// ThreadManager ///////////////////////////////////////////////////////\n\nexport function ThreadManager() {\n    this.processes = [];\n    this.wantsToPause = false; // single stepping support\n}\n\n// Process /////////////////////////////////////////////////////////////\n\n/*\n    A Process is what brings a stack of blocks to life. The process\n    keeps track of which block to run next, evaluates block arguments,\n    handles control structures, and so forth.\n\n    The ThreadManager is the (passive) scheduler, telling each process\n    when to run by calling its runStep() method. The runStep() method\n    will execute some number of blocks, then voluntarily yield control\n    so that the ThreadManager can run another process.\n\n    The Scratch etiquette is that a process should yield control at the\n    end of every loop iteration, and while it is running a timed command\n    (e.g. \"wait 5 secs\") or a synchronous command (e.g. \"broadcast xxx\n    and wait\"). Since Snap also has lambda and custom blocks Snap adds\n    yields at the beginning of each non-atomic custom command block\n    execution, and - to let users escape infinite loops and recursion -\n    whenever the process runs into a timeout.\n\n    a Process runs for a receiver, i.e. a sprite or the stage or any\n    blocks-scriptable object that we'll introduce.\n\n    structure:\n\n    topBlock            the stack's first block, of which all others\n                        are children\n    receiver            object (sprite) to which the process applies,\n                        cached from the top block\n    instrument          musical instrument type, cached from the receiver,\n                        so a single sprite can play several instruments\n                        at once\n    context             the Context describing the current state\n                        of this process\n    homeContext         stores information relevant to the whole process,\n                        i.e. its receiver, result etc.\n    isPaused            boolean indicating whether to pause\n    readyToYield        boolean indicating whether to yield control to\n                        another process\n    readyToTerminate    boolean indicating whether the stop method has\n                        been called\n    isDead              boolean indicating a terminated clone process\n    timeout             msecs after which to force yield\n    lastYield           msecs when the process last yielded\n    isFirstStep         boolean indicating whether on first step - for clones\n    errorFlag           boolean indicating whether an error was encountered\n    prompter            active instance of StagePrompterMorph\n    httpRequest         active instance of an HttpRequest or null\n    pauseOffset         msecs between the start of an interpolated operation\n                        and when the process was paused\n    isClicked           boolean flag indicating whether the process was\n                        initiated by a user-click on a block\n    isShowingResult     boolean flag indicating whether a \"report\" command\n                        has been executed in a user-clicked process\n    exportResult        boolean flag indicating whether a picture of the top\n                        block along with the result bubble shoud be exported\n    onComplete          an optional callback function to be executed when\n                        the process is done\n    procedureCount      number counting procedure call entries,\n                        used to tag custom block calls, so \"stop block\"\n                        invocations can catch them\n    flashingContext     for single stepping\n    isInterrupted       boolean, indicates intra-step flashing of blocks\n    canBroadcast        boolean, used to control reentrancy & \"when stopped\"\n*/\n\nProcess.prototype = {};\nProcess.prototype.constructor = Process;\nProcess.prototype.timeout = 500; // msecs after which to force yield\nProcess.prototype.isCatchingErrors = true;\nProcess.prototype.enableHyperOps = true; // experimental hyper operations\nProcess.prototype.enableLiveCoding = false; // experimental\nProcess.prototype.enableSingleStepping = false; // experimental\nProcess.prototype.enableCompiling = false; // experimental\nProcess.prototype.flashTime = 0; // experimental\n// Process.prototype.enableJS = false;\n\nexport function Process(topBlock, receiver, onComplete, yieldFirst) {\n    this.topBlock = topBlock || null;\n    this.receiver = receiver;\n    this.instrument = receiver ? receiver.instrument : null;\n    this.readyToYield = false;\n    this.readyToTerminate = false;\n    this.isDead = false;\n    this.isClicked = false;\n    this.isShowingResult = false;\n    this.errorFlag = false;\n    this.context = null;\n    this.homeContext = new Context(null, null, null, receiver);\n    this.lastYield =  Date.now();\n    this.isFirstStep = true;\n    this.isAtomic = false;\n    this.prompter = null;\n    this.httpRequest = null;\n    this.isPaused = false;\n    this.pauseOffset = null;\n    this.frameCount = 0;\n    this.exportResult = false;\n    this.onComplete = onComplete || null;\n    this.procedureCount = 0;\n    this.flashingContext = null; // experimental, for single-stepping\n    this.isInterrupted = false; // experimental, for single-stepping\n    this.canBroadcast = true; // used to control \"when I am stopped\"\n\n    if (topBlock) {\n        this.homeContext.variables.parentFrame =\n            this.homeContext.receiver.variables;\n        this.context = new Context(\n            null,\n            topBlock.blockSequence(),\n            this.homeContext\n        );\n        if (yieldFirst) {\n            this.pushContext('doYield'); // highlight top block\n        }\n    }\n}\n\n// Process accessing\n// Context /////////////////////////////////////////////////////////////\n\n/*\n    A Context describes the state of a Process.\n\n    Each Process has a pointer to a Context containing its\n    state. Whenever the Process yields control, its Context\n    tells it exactly where it left off.\n\n    structure:\n\n    parentContext   the Context to return to when this one has\n                    been evaluated.\n    outerContext    the Context holding my lexical scope\n    expression      SyntaxElementMorph, an array of blocks to evaluate,\n                    null or a String denoting a selector, e.g. 'doYield'\n    origin          the object of origin, only used for serialization\n    receiver        the object to which the expression applies, if any\n    variables       the current VariableFrame, if any\n    inputs          an array of input values computed so far\n                    (if expression is a    BlockMorph)\n    pc              the index of the next block to evaluate\n                    (if expression is an array)\n    isContinuation  flag for marking a transient continuation context\n    startTime       time when the context was first evaluated\n    startValue      initial value for interpolated operations\n    activeAudio     audio buffer for interpolated operations, don't persist\n    activeNote      audio oscillator for interpolated ops, don't persist\n    activeSends\t\tforked processes waiting to be completed\n    isCustomBlock   marker for return ops\n    isCustomCommand marker for interpolated blocking reporters (reportURL)\n    emptySlots      caches the number of empty slots for reification\n    tag             string or number to optionally identify the Context,\n                    as a \"return\" target (for the \"stop block\" primitive)\n    isFlashing      flag for single-stepping\n    accumulator     slot for collecting data from reentrant visits\n*/\n\nexport function Context(\n  parentContext,\n  expression,\n  outerContext,\n  receiver\n) {\n  this.outerContext = outerContext || null;\n  this.parentContext = parentContext || null;\n  this.expression = expression || null;\n  this.receiver = receiver || null;\n  this.origin = receiver || null; // only for serialization\n  this.variables = new VariableFrame();\n  if (this.outerContext) {\n    this.variables.parentFrame = this.outerContext.variables;\n    this.receiver = this.outerContext.receiver;\n  }\n  this.inputs = [];\n  this.pc = 0;\n  this.isContinuation = false;\n  this.startTime = null;\n  this.activeSends = null;\n  this.activeAudio = null;\n  this.activeNote = null;\n  this.isCustomBlock = false; // marks the end of a custom block's stack\n  this.isCustomCommand = null; // used for ignoring URL reporters' results\n  this.emptySlots = 0; // used for block reification\n  this.tag = null;  // lexical catch-tag for custom blocks\n  this.isFlashing = false; // for single-stepping\n  this.accumulator = null;\n}\n\n\n// Variable /////////////////////////////////////////////////////////////////\n\nexport function Variable(value, isTransient) {\n    this.value = value;\n    this.isTransient = isTransient || false; // prevent value serialization\n}\n\nVariable.prototype.toString = function () {\n    return 'a ' + (this.isTransient ? 'transient ' : '') + 'Variable [' +\n        this.value + ']';\n};\n\nVariable.prototype.copy = function () {\n    return new Variable(this.value, this.isTransient);\n};\n\n// VariableFrame ///////////////////////////////////////////////////////\n\nexport function VariableFrame(parentFrame, owner) {\n    this.vars = {};\n    this.parentFrame = parentFrame || null;\n    this.owner = owner || null;\n}\n\n\n// JSCompiler /////////////////////////////////////////////////////////////////\n\n/*\n\tCompile simple, side-effect free Reporters\n    with either only explicit formal parameters or a specified number of\n    implicit formal parameters mapped to empty input slots\n\t*** highly experimental and heavily under construction ***\n*/\n\nexport function JSCompiler(aProcess) {\n\tthis.process = aProcess;\n\tthis.source = null; // a context\n \tthis.gensyms = null; // temp dictionary for parameter substitutions\n  \tthis.implicitParams = null;\n   \tthis.paramCount = null;\n}\n\nJSCompiler.prototype.toString = function () {\n    return 'a JSCompiler';\n};\n\nJSCompiler.prototype.compileFunction = function (aContext, implicitParamCount) {\n    var block = aContext.expression,\n  \t\tparameters = aContext.inputs,\n        parms = [],\n        hasEmptySlots = false,\n        i;\n\n\tthis.source = aContext;\n    this.implicitParams = implicitParamCount || 1;\n\n\t// scan for empty input slots\n \thasEmptySlots = !isNil(detect(\n  \t\tblock.allChildren(),\n    \tmorph => morph.isEmptySlot && morph.isEmptySlot()\n    ));\n\n    // translate formal parameters into gensyms\n    this.gensyms = {};\n    this.paramCount = 0;\n    if (parameters.length) {\n        // test for conflicts\n        if (hasEmptySlots) {\n        \tthrow new Error(\n                'compiling does not yet support\\n' +\n                'mixing explicit formal parameters\\n' +\n                'with empty input slots'\n            );\n        }\n        // map explicit formal parameters\n        parameters.forEach((pName, idx) => {\n        \tvar pn = 'p' + idx;\n            parms.push(pn);\n        \tthis.gensyms[pName] = pn;\n        });\n    } else if (hasEmptySlots) {\n    \tif (this.implicitParams > 1) {\n        \tfor (i = 0; i < this.implicitParams; i += 1) {\n         \t\tparms.push('p' + i);\n         \t}\n     \t} else {\n        \t// allow for a single implicit formal parameter\n        \tparms = ['p0'];\n        }\n    }\n\n    // compile using gensyms\n\n    if (block instanceof CommandBlockMorph) {\n        return Function.apply(\n            null,\n            parms.concat([this.compileSequence(block)])\n        );\n    }\n    return Function.apply(\n        null,\n        parms.concat(['return ' + this.compileExpression(block)])\n    );\n};\n\nJSCompiler.prototype.compileExpression = function (block) {\n    var selector = block.selector,\n        inputs = block.inputs(),\n        target,\n        rcvr,\n        args;\n\n    // first check for special forms and infix operators\n    switch (selector) {\n    case 'reportOr':\n        return this.compileInfix('||', inputs);\n    case 'reportAnd':\n        return this.compileInfix('&&', inputs);\n    case 'reportIfElse':\n        return '(' +\n            this.compileInput(inputs[0]) +\n            ' ? ' +\n            this.compileInput(inputs[1]) +\n            ' : ' +\n            this.compileInput(inputs[2]) +\n            ')';\n    case 'evaluateCustomBlock':\n        throw new Error(\n            'compiling does not yet support\\n' +\n            'custom blocks'\n        );\n\n    // special command forms\n    case 'doSetVar': // redirect var to process\n        return 'arguments[arguments.length - 1].setVarNamed(' +\n            this.compileInput(inputs[0]) +\n            ',' +\n            this.compileInput(inputs[1]) +\n            ')';\n    case 'doChangeVar': // redirect var to process\n        return 'arguments[arguments.length - 1].incrementVarNamed(' +\n            this.compileInput(inputs[0]) +\n            ',' +\n            this.compileInput(inputs[1]) +\n            ')';\n    case 'doReport':\n        return 'return ' + this.compileInput(inputs[0]);\n    case 'doIf':\n        return 'if (' +\n            this.compileInput(inputs[0]) +\n            ') {\\n' +\n            this.compileSequence(inputs[1].evaluate()) +\n            '}';\n    case 'doIfElse':\n        return 'if (' +\n            this.compileInput(inputs[0]) +\n            ') {\\n' +\n            this.compileSequence(inputs[1].evaluate()) +\n            '} else {\\n' +\n            this.compileSequence(inputs[2].evaluate()) +\n            '}';\n\n    default:\n        target = this.process[selector] ? this.process\n            : (this.source.receiver || this.process.receiver);\n        rcvr = target.constructor.name + '.prototype';\n        args = this.compileInputs(inputs);\n        if (isSnapObject(target)) {\n            return rcvr + '.' + selector + '.apply('+ rcvr + ', [' + args +'])';\n        } else {\n            return 'arguments[arguments.length - 1].' +\n                selector +\n                '.apply(arguments[arguments.length - 1], [' + args +'])';\n        }\n    }\n};\n\nJSCompiler.prototype.compileSequence = function (commandBlock) {\n    var body = '';\n    commandBlock.blockSequence().forEach(block => {\n        body += this.compileExpression(block);\n        body += ';\\n';\n    });\n    return body;\n};\n\nJSCompiler.prototype.compileInfix = function (operator, inputs) {\n    return '(' + this.compileInput(inputs[0]) + ' ' + operator + ' ' +\n        this.compileInput(inputs[1]) +')';\n};\n\nJSCompiler.prototype.compileInputs = function (array) {\n    var args = '';\n    array.forEach(inp => {\n        if (args.length) {\n            args += ', ';\n        }\n        args += this.compileInput(inp);\n    });\n    return args;\n};\n\nJSCompiler.prototype.compileInput = function (inp) {\n     var value, type;\n\n    if (inp.isEmptySlot && inp.isEmptySlot()) {\n        // implicit formal parameter\n        if (this.implicitParams > 1) {\n         \tif (this.paramCount < this.implicitParams) {\n            \tthis.paramCount += 1;\n             \treturn 'p' + (this.paramCount - 1);\n        \t}\n            throw new Error(\n                localize('expecting') + ' ' + this.implicitParams + ' '\n                    + localize('input(s), but getting') + ' '\n                    + this.paramCount\n            );\n        }\n\t\treturn 'p0';\n    } else if (inp instanceof MultiArgMorph) {\n        return 'new List([' + this.compileInputs(inp.inputs()) + '])';\n    } else if (inp instanceof ArgLabelMorph) {\n    \treturn this.compileInput(inp.argMorph());\n    } else if (inp instanceof ArgMorph) {\n        // literal - evaluate inline\n        value = inp.evaluate();\n        type = this.process.reportTypeOf(value);\n        switch (type) {\n        case 'number':\n        case 'Boolean':\n            return '' + value;\n        case 'text':\n            // enclose in double quotes\n            return '\"' + value + '\"';\n        case 'list':\n            return 'new List([' + this.compileInputs(value) + '])';\n        default:\n            if (value instanceof Array) {\n                 return '\"' + value[0] + '\"';\n            }\n            throw new Error(\n                'compiling does not yet support\\n' +\n                'inputs of type\\n' +\n                 type\n            );\n        }\n    } else if (inp instanceof BlockMorph) {\n        if (inp.selector === 'reportGetVar') {\n        \tif (contains(this.source.inputs, inp.blockSpec)) {\n            \t// un-quoted gensym:\n            \treturn this.gensyms[inp.blockSpec];\n        \t}\n         \t// redirect var query to process\n            return 'arguments[arguments.length - 1].getVarNamed(\"' +\n            \tinp.blockSpec +\n            \t'\")';\n        }\n        return this.compileExpression(inp);\n    } else {\n        throw new Error(\n            'compiling does not yet support\\n' +\n            'input slots of type\\n' +\n            inp.constructor.name\n        );\n    }\n};\n","/*\n\n    lists.js\n\n    list data structure and GUI for SNAP!\n\n    written by Jens Mnig and Brian Harvey\n    jens@moenig.org, bh@cs.berkeley.edu\n\n    Copyright (C) 2019 by Jens Mnig and Brian Harvey\n    Copyright (C) 2020 by Jens Mnig and Brian Harvey\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    prerequisites:\n    --------------\n    needs morphic.js, widgets.js and gui.js\n\n\n    I. hierarchy\n    -------------\n    the following tree lists all constructors hierarchically,\n    indentation indicating inheritance. Refer to this list to get a\n    contextual overview:\n\n    List\n\n    BoxMorph*\n        ListWatcherMorph\n\n    * from Morphic.js\n\n\n    II. toc\n    -------\n    the following list shows the order in which all constructors are\n    defined. Use this list to locate code in this document:\n\n    List\n    ListWatcherMorph\n\n*/\n\n// Global settings /////////////////////////////////////////////////////\n\n/*global modules, BoxMorph, HandleMorph, PushButtonMorph, SyntaxElementMorph,\nColor, Point, WatcherMorph, StringMorph, SpriteMorph, ScrollFrameMorph, isNil,\nCellMorph, ArrowMorph, MenuMorph, snapEquals, localize, isString, IDE_Morph,\nMorphicPreferences, TableDialogMorph, SpriteBubbleMorph, SpeechBubbleMorph,\nTableFrameMorph, TableMorph, Variable, isSnapObject, Costume, contains, detect,\nZERO, WHITE*/\n\n\nimport { ZERO, detect, BoxMorph, Color,\n   MenuMorph,  contains,\n  MorphicPreferences, WHITE, ScrollFrameMorph,\n  StringMorph, Point,\n  isString, modules, HandleMorph,\n  SpeechBubbleMorph, isNil,\n  localize\n  } from './morphic.js'\n\n\n\nimport { PushButtonMorph,\n} from './widgets.js'\n\nimport { SyntaxElementMorph} from './blocks.js';\n\n\nimport { SpriteBubbleMorph, isSnapObject, Costume, SpriteMorph, WatcherMorph} from './objects';\n\nmodules.lists = '2020-July-01';\n\n// export var List;\n// var ListWatcherMorph;\n\n// List ////////////////////////////////////////////////////////////////\n\n/*\n    I am a dynamic array data structure for SNAP!\n    My index starts with 1\n\n    I am a \"smart\" hybrid list, because I can be used as both a linked\n    list and as a dynamic array\n\n    public interface:\n\n    setters (linked):\n    -----------------\n    cons                    - answer a new list with the given item in front\n    cdr                     - answer all but the first element\n\n    setters (arrayed):\n    ------------------\n    add(element, index)     - insert the element before the given slot,\n    put(element, index)     - overwrite the element at the given slot\n    remove(index)           - remove the given slot, shortening the list\n    clear()                 - remove all elements\n\n    getters (all hybrid):\n    ---------------------\n    length()                - number of slots\n    at(index)               - element present in specified slot\n    contains(element)       - <bool>\n    isEmpty()               - <bool>\n    indexOf(element)        - index of element's first occurrence, 0 if none\n\n    conversion:\n    -----------\n    asArray()               - answer me as JavaScript array, convert to arrayed\n    itemsArray()            - answer a JavaScript array shallow copy of myself\n    asText()                - answer my elements (recursively) concatenated\n    asCSV()                 - answer a csv-formatted String of myself\n    asJSON()                - answer a json-formatted String of myself\n\n    utility:\n    ---------\n    map(callback)           - answer an arrayed copy applying a JS func to all\n*/\n\n// List instance creation:\n\nexport function List(array) {\n    this.type = null; // for UI lists, such as costumes, sounds, sprites\n    this.contents = array || [];\n    this.first = null;\n    this.rest = null;\n    this.isLinked = false;\n    this.lastChanged = Date.now();\n}\n\n// List global preferences\n\nList.prototype.enableTables = true;\n\n// List printing\n\nList.prototype.toString = function () {\n    return 'a List [' + this.length() + ' elements]';\n};\n\n// List updating:\n\nList.prototype.changed = function () {\n    this.lastChanged = Date.now();\n};\n\n// Linked List ops:\n\nList.prototype.cons = function (car, cdr) {\n    var answer = new List();\n    if (!(cdr instanceof List || isNil(cdr))) {\n        throw new Error(\"cdr isn't a list: \" + cdr);\n    }\n    answer.first = isNil(car) ? null : car;\n    answer.rest = cdr || null;\n    answer.isLinked = true;\n    return answer;\n};\n\nList.prototype.cdr = function () {\n    var result, i;\n    if (this.isLinked) {\n        return this.rest || new List();\n    }\n    if (this.contents.length < 2) {\n        return new List();\n    }\n\n    result = new List();\n    for (i = this.contents.length; i > 1; i -= 1) {\n        result = this.cons(this.at(i), result);\n    }\n    return result;\n};\n\n// List array setters:\n\nList.prototype.add = function (element, index) {\n/*\n    insert the element before the given slot index,\n    if no index is specifed, append the element\n*/\n    var idx = index || this.length() + 1,\n        obj = isNil(element) ? null : element;\n\n    this.becomeArray();\n    this.contents.splice(idx - 1, 0, obj);\n    this.changed();\n};\n\nList.prototype.put = function (element, index) {\n    // exchange the element at the given slot for another\n    var data = element === 0 ? 0\n            : element === false ? false\n                    : element || null;\n\n    this.becomeArray();\n    this.contents[index - 1] = data;\n    this.changed();\n};\n\nList.prototype.remove = function (index) {\n    // remove the given slot, shortening the list\n    this.becomeArray();\n    this.contents.splice(index - 1, 1);\n    this.changed();\n};\n\nList.prototype.clear = function () {\n    this.contents = [];\n    this.first = null;\n    this.rest = null;\n    this.isLinked = false;\n    this.changed();\n};\n\nList.prototype.map = function(callback) {\n    return new List(\n        this.asArray().map(callback)\n    );\n};\n\n// List getters (all hybrid):\n\nList.prototype.length = function () {\n    if (this.isLinked) {\n        var pair = this,\n            result = 0;\n        while (pair && pair.isLinked) {\n            result += 1;\n            pair = pair.rest;\n        }\n        return result + (pair ? pair.contents.length : 0);\n    }\n    return this.contents.length;\n};\n\nList.prototype.at = function (index) {\n    var value, idx = +index, pair = this;\n    while (pair.isLinked) {\n        if (idx > 1) {\n            pair = pair.rest;\n            idx -= 1;\n        } else {\n            return pair.first;\n        }\n    }\n    value = pair.contents[idx - 1];\n    return isNil(value) ? '' : value;\n};\n\nList.prototype.contains = function (element) {\n    var pair = this;\n    while (pair.isLinked) {\n        if (snapEquals(pair.first, element)) {\n            return true;\n        }\n        pair = pair.rest;\n    }\n    // in case I'm arrayed\n    return pair.contents.some(any => snapEquals(any, element));\n};\n\nList.prototype.isEmpty = function () {\n    if (this.isLinked) {\n        return isNil(this.first);\n    }\n    return !this.contents.length;\n};\n\nList.prototype.indexOf = function (element) {\n    var pair = this,\n        idx = 1,\n        i, len;\n    while (pair.isLinked) {\n        if (snapEquals(pair.first, element)) {\n            return idx;\n        }\n        pair = pair.rest;\n        idx += 1;\n    }\n    // in case I'm arrayed\n    len = pair.contents.length;\n    for (i = 0; i < len; i += 1) {\n        if (snapEquals(pair.contents[i], element)) {\n            return idx + i;\n        }\n    }\n    return 0;\n};\n\n// List table (2D) accessing (for table morph widget):\n\nList.prototype.isTable = function () {\n    return this.enableTables && (this.length() > 100 || this.cols() > 1);\n};\n\nList.prototype.get = function (col, row) {\n    var r, len, cols;\n    if (!col) {\n        if (!row) {return [this.length()]; }\n        if (row > this.rows()) {return null; }\n        return this.rowName(row);\n    } else if (!row) {\n        if (this.cols() === 1) {return localize('items'); }\n        return this.colName(col);\n    }\n    r = this.at(row);\n\n    // encode \"orphaned\" as arrays and overshooting ones as Variables\n    if (r instanceof List) {\n        len = r.length();\n        cols = this.cols();\n        if (col > len) {\n            return null;\n        } else if (cols === 1 && len > 1) {\n            return [r];\n        } else if (col >= cols && len > cols) { // overshooting\n            return new Variable(r.at(col));\n        }\n        return r.at(col);\n    }\n    if (col === 1 && row <= this.rows()) {\n        return [r];\n    }\n    return null;\n};\n\nList.prototype.rows = function () {\n    return this.length();\n};\n\nList.prototype.cols = function () {\n    // scan the first 10 rows for the maximun width\n    var len = Math.min(10, this.length()),\n        count = 1,\n        r, i;\n\n    for (i = 1; i <= len; i += 1) {\n        r = this.at(i);\n        if (r instanceof List) {\n            count = Math.max(count, r.length());\n        }\n    }\n    return count;\n};\n\nList.prototype.colName = function (col) {\n    if (col > this.cols()) {return null; }\n    return String.fromCharCode(64 + ((col % 26) || 26)).repeat(\n        Math.floor((col - 1) / 26) + 1\n    );\n};\n\nList.prototype.rowName = function (row) {\n    return row;\n};\n\nList.prototype.columnNames = function () {\n    return [];\n};\n\nList.prototype.version = function (startRow, rows, startCol, cols) {\n    var l = Math.min(startRow + rows, this.length()),\n        v = this.lastChanged,\n        r,\n        i;\n    for (i = startRow; i <= l; i += 1) {\n        r = this.at(i);\n        if (r instanceof Costume) {\n            v = Math.max(v, r.version);\n        } else if (r instanceof List) {\n            v = Math.max(v, r.version(startCol, cols));\n        } else {\n            v = Math.max(v, r.lastChanged ? r.lastChanged : 0);\n        }\n    }\n    return v;\n};\n\n// List conversion:\n\nList.prototype.asArray = function () {\n    // for use in the evaluator\n    this.becomeArray();\n    return this.contents;\n};\n\nList.prototype.itemsArray = function () {\n    // answer an array containing my elements\n    // don't convert linked lists to arrays\n    if (this.isLinked) {\n        var next = this,\n            result = [],\n            i;\n        while (next && next.isLinked) {\n            result.push(next.first);\n            next = next.rest;\n        }\n        if (next) {\n            for (i = 1; i <= next.contents.length; i += 1) {\n                result.push(next.at(i));\n            }\n        }\n        return result;\n    }\n    return this.contents;\n};\n\nList.prototype.asText = function () {\n    var result = '',\n        length,\n        element,\n        pair = this,\n        i;\n    while (pair.isLinked) {\n        element = pair.first;\n        if (element instanceof List) {\n            result = result.concat(element.asText());\n        } else {\n            element = isNil(element) ? '' : element.toString();\n            result = result.concat(element);\n        }\n        pair = pair.rest;\n    }\n    length = pair.length();\n    for (i = 1; i <= length; i += 1) {\n        element = pair.at(i);\n        if (element instanceof List) {\n            result = result.concat(element.asText());\n        } else {\n            element = isNil(element) ? '' : element.toString();\n            result = result.concat(element);\n        }\n    }\n    return result;\n};\n\nList.prototype.becomeArray = function () {\n    if (this.isLinked) {\n        this.contents = this.itemsArray();\n        this.isLinked = false;\n        this.first = null;\n        this.rest = null;\n    }\n};\n\nList.prototype.becomeLinked = function () {\n    var i, stop, tail = this;\n    if (!this.isLinked) {\n        stop = this.length();\n        for (i = 0; i < stop; i += 1) {\n            tail.first = this.contents[i];\n            if (i < stop) {\n                tail.rest = new List();\n                tail.isLinked = true;\n                tail = tail.rest;\n            }\n        }\n        this.contents = [];\n        this.isLinked = true;\n    }\n};\n\nList.prototype.asCSV = function () {\n    // RFC 4180\n    // Caution, no error catching!\n    // this method assumes that the list.canBeCSV()\n\n    var items = this.itemsArray(),\n        rows = [];\n\n    function encodeCell(atomicValue) {\n        var string = isNil(atomicValue) ? '' : atomicValue.toString(),\n            cell;\n        if (string.indexOf('\\\"') ===  -1 &&\n                (string.indexOf('\\n') === -1) &&\n                (string.indexOf('\\,') === -1)) {\n            return string;\n        }\n        cell = ['\\\"'];\n        string.split('').forEach(letter => {\n            cell.push(letter);\n            if (letter === '\\\"') {\n                cell.push(letter);\n            }\n        });\n        cell.push('\\\"');\n        return cell.join('');\n    }\n\n    if (items.some(any => any instanceof List)) {\n        // 2-dimensional table\n        items.forEach(item => {\n            if (item instanceof List) {\n                rows.push(item.itemsArray().map(encodeCell).join(','));\n            } else {\n                rows.push(encodeCell(item));\n            }\n        });\n        return rows.join('\\n');\n    }\n    // single row\n    return items.map(encodeCell).join(',');\n};\n\nList.prototype.asJSON = function (guessObjects) {\n    // Caution, no error catching!\n    // this method assumes that the list.canBeJSON()\n\n    function objectify(list, guessObjects) {\n        var items = list.itemsArray(),\n            obj = {};\n        if (canBeObject(items)) {\n            items.forEach(pair => {\n                var value = pair.length() === 2 ? pair.at(2) : undefined;\n                obj[pair.at(1)] = (value instanceof List ?\n                    objectify(value, guessObjects) : value);\n            });\n            return obj;\n        }\n        return items.map(element => {\n            return element instanceof List ?\n                objectify(element, guessObjects) : element;\n        });\n    }\n\n    function canBeObject(array) {\n        // try to determine whether the contents of a list\n        // might be better represented as dictionary/object\n        // than as array\n        var keys;\n        if (array.every(\n            element => element instanceof List && (element.length() < 3)\n        )) {\n            keys = array.map(each => each.at(1));\n            return keys.every(each => isString(each) && isUniqueIn(each, keys));\n        }\n    }\n\n    function isUniqueIn(element, array) {\n        return array.indexOf(element) === array.lastIndexOf(element);\n    }\n\n    return JSON.stringify(objectify(this, guessObjects));\n};\n\n// List testing\n\nList.prototype.equalTo = function (other) {\n    var myself = this, it = other, i, j, loopcount;\n    if (!(other instanceof List)) {\n        return false;\n    }\n\n    while (myself.isLinked && it.isLinked) {\n        if (!snapEquals(myself.first, it.first)) {\n            return false;\n        }\n        myself = myself.rest;\n        it = it.rest;\n    }\n\n    if (it.isLinked) {\n        i = it;\n        it = myself;\n        myself = i;\n    }\n\n    j = 0;\n    while (myself.isLinked) {\n        if (!snapEquals(myself.first, it.contents[j])) {\n            return false;\n        }\n        myself = myself.rest;\n        j += 1;\n    }\n\n    i = 0;\n    if (myself.contents.length !== (it.contents.length - j)) {\n        return false;\n    }\n\n    loopcount = myself.contents.length;\n    while (loopcount > 0) {\n        loopcount -= 1;\n        if (!snapEquals(myself.contents[i], it.contents[j])) {\n            return false;\n        }\n        i += 1;\n        j += 1;\n    }\n    return true;\n};\n\nList.prototype.canBeCSV = function () {\n    return this.itemsArray().every(value => {\n        return (!isNaN(+value) && typeof value !== 'boolean') ||\n            isString(value) ||\n            (value instanceof List && value.hasOnlyAtomicData());\n    });\n};\n\nList.prototype.canBeJSON = function () {\n    return this.itemsArray().every(value => {\n        return !isNaN(+value) ||\n            isString(value) ||\n            value === true ||\n            value === false ||\n            (value instanceof List && value.canBeJSON());\n    });\n};\n\nList.prototype.hasOnlyAtomicData = function () {\n    return this.itemsArray().every(value => {\n        return (!isNaN(+value) && typeof value !== 'boolean') ||\n            isString(value);\n    });\n};\n\n// List-to-block (experimental)\n\nList.prototype.blockify = function (limit = 500, count = [0]) {\n    var block = SpriteMorph.prototype.blockForSelector('reportNewList'),\n        slots = block.inputs()[0],\n        len = this.length(),\n        bool,\n        i, value;\n\n    block.isDraggable = true;\n    slots.removeInput();\n\n    // fill the slots with the data\n    for (i = 0; i < len && count[0] < limit; i += 1) {\n        value = this.at(i + 1);\n        if (value instanceof List) {\n            slots.replaceInput(\n                slots.addInput(),\n                value.blockify(limit, count)\n            );\n        } else if (typeof value === 'boolean') {\n            bool = SpriteMorph.prototype.blockForSelector('reportBoolean');\n            bool.inputs()[0].setContents(value);\n            bool.isDraggable = true;\n            slots.replaceInput(\n                slots.addInput(),\n                bool\n            );\n        } else {\n            slots.addInput(value);\n        }\n        count[0] += 1;\n    }\n\n    slots.fixBlockColor(null, true);\n    return block;\n};\n\n// ListWatcherMorph ////////////////////////////////////////////////////\n\n/*\n    I am a little window which observes a list and continuously\n    updates itself accordingly\n*/\n\n// ListWatcherMorph inherits from BoxMorph:\n\nListWatcherMorph.prototype = new BoxMorph();\nListWatcherMorph.prototype.constructor = ListWatcherMorph;\nListWatcherMorph.uber = BoxMorph.prototype;\n\n// ListWatcherMorph default settings\n\nListWatcherMorph.prototype.cellColor = new Color(217, 77, 17);\n\n// ListWatcherMorph instance creation:\n\nexport function ListWatcherMorph(list, parentCell) {\n    this.init(list, parentCell);\n}\n\nListWatcherMorph.prototype.init = function (list, parentCell) {\n    var myself = this,\n        readOnly;\n\n    this.list = list || new List();\n    this.start = 1;\n    this.range = 100;\n    this.lastUpdated = 0;\n    this.lastCell = null;\n    this.parentCell = parentCell || null; // for circularity detection\n\n    // elements declarations\n    this.label = new StringMorph(\n        localize('length: ') + this.list.length(),\n        SyntaxElementMorph.prototype.fontSize,\n        null,\n        false,\n        false,\n        false,\n        MorphicPreferences.isFlat ? ZERO : new Point(1, 1),\n        WHITE\n    );\n    this.label.mouseClickLeft = function () {myself.startIndexMenu(); };\n\n\n    this.frame = new ScrollFrameMorph(null, 10);\n    this.frame.alpha = 0;\n    this.frame.acceptsDrops = false;\n    this.frame.contents.acceptsDrops = false;\n\n    this.handle = new HandleMorph(\n        this,\n        80,\n        70,\n        3,\n        3\n    );\n    this.handle.setExtent(new Point(13, 13));\n\n    this.arrow = new ArrowMorph(\n        'down',\n        SyntaxElementMorph.prototype.fontSize\n    );\n    this.arrow.mouseClickLeft = function () {myself.startIndexMenu(); };\n    this.arrow.setRight(this.handle.right());\n    this.arrow.setBottom(this.handle.top());\n    this.handle.add(this.arrow);\n\n    readOnly = this.list.type && !contains(['text', 'number'], this.list.type);\n    if (readOnly) {\n        this.plusButton = null;\n    } else {\n        this.plusButton = new PushButtonMorph(\n            this.list,\n            'add',\n            '+'\n        );\n        this.plusButton.padding = 0;\n        this.plusButton.edge = 0;\n        this.plusButton.outlineColor = this.color;\n        this.plusButton.fixLayout();\n    }\n\n    ListWatcherMorph.uber.init.call(\n        this,\n        SyntaxElementMorph.prototype.rounding,\n        1,\n        new Color(120, 120, 120)\n    );\n\n    this.color = new Color(220, 220, 220);\n    this.isDraggable = false;\n    this.setExtent(new Point(80, 70).multiplyBy(\n        SyntaxElementMorph.prototype.scale\n    ));\n    this.add(this.label);\n    this.add(this.frame);\n    if (!readOnly) {\n        this.add(this.plusButton);\n    }\n    this.add(this.handle);\n    this.handle.fixLayout();\n    this.update();\n    this.fixLayout();\n};\n\n// ListWatcherMorph updating:\n\nListWatcherMorph.prototype.update = function (anyway) {\n    var i, idx, ceil, morphs, cell, cnts, label, button, max,\n        starttime, maxtime = 1000;\n    this.frame.contents.children.forEach(m => {\n        if (m instanceof CellMorph) {\n            if (m.contentsMorph instanceof ListWatcherMorph) {\n                m.contentsMorph.update();\n            } else if (isSnapObject(m.contents) ||\n                    (m.contents instanceof Costume)) {\n                m.update();\n            }\n        }\n    });\n\n    if (this.lastUpdated === this.list.lastChanged && !anyway) {\n        return null;\n    }\n    this.updateLength(true);\n\n    // adjust start index to current list length\n    this.start = Math.max(\n        Math.min(\n            this.start,\n            Math.floor((this.list.length() - 1) / this.range)\n                * this.range + 1\n        ),\n        1\n    );\n\n    // refresh existing cells\n    // highest index shown:\n    max = Math.min(\n        this.start + this.range - 1,\n        this.list.length()\n    );\n\n    // number of morphs available for refreshing\n    ceil = Math.min(\n        (max - this.start + 1) * 3,\n        this.frame.contents.children.length\n    );\n\n    for (i = 0; i < ceil; i += 3) {\n        idx = this.start + (i / 3);\n\n        cell = this.frame.contents.children[i];\n        label = this.frame.contents.children[i + 1];\n        button = this.frame.contents.children[i + 2];\n        cnts = this.list.at(idx);\n\n        if (cell.contents !== cnts) {\n            cell.contents = cnts;\n            cell.fixLayout();\n            if (this.lastCell) {\n                cell.setLeft(this.lastCell.left());\n            }\n        }\n        this.lastCell = cell;\n\n        if (label.text !== idx.toString()) {\n            label.text = idx.toString();\n            label.fixLayout();\n        }\n\n        button.action = idx;\n    }\n\n    // remove excess cells\n    // number of morphs to be shown\n    morphs = (max - this.start + 1) * 3;\n\n    while (this.frame.contents.children.length > morphs) {\n        this.frame.contents.children[morphs].destroy();\n    }\n\n    // add additional cells\n    ceil = morphs; //max * 3;\n    i = this.frame.contents.children.length;\n\n    starttime = Date.now();\n    if (ceil > i + 1) {\n        for (i; i < ceil; i += 3) {\n            if (Date.now() - starttime > maxtime) {\n                this.fixLayout();\n                this.frame.contents.adjustBounds();\n                this.frame.contents.setLeft(this.frame.left());\n                return null;\n            }\n            idx = this.start + (i / 3);\n            label = new StringMorph(\n                idx.toString(),\n                SyntaxElementMorph.prototype.fontSize,\n                null,\n                false,\n                false,\n                false,\n                MorphicPreferences.isFlat ? ZERO : new Point(1, 1),\n                WHITE\n            );\n            cell = new CellMorph(\n                this.list.at(idx),\n                this.cellColor,\n                idx,\n                this.parentCell\n            );\n            button = new PushButtonMorph(\n                this.list.remove,\n                idx,\n                '-',\n                this.list\n            );\n            button.padding = 1;\n            button.edge = 0;\n            button.corner = 1;\n            button.outlineColor = this.color.darker();\n            button.fixLayout();\n\n            this.frame.contents.add(cell);\n            if (this.lastCell) {\n                cell.setPosition(this.lastCell.bottomLeft());\n            } else {\n                cell.setTop(this.frame.contents.top());\n            }\n            this.lastCell = cell;\n            label.setCenter(cell.center());\n            label.setRight(cell.left() - 2);\n            this.frame.contents.add(label);\n            this.frame.contents.add(button);\n        }\n    }\n    this.lastCell = null;\n\n    this.fixLayout();\n    this.frame.contents.adjustBounds();\n    this.frame.contents.setLeft(this.frame.left());\n    this.updateLength();\n    this.lastUpdated = this.list.lastChanged;\n};\n\nListWatcherMorph.prototype.updateLength = function (notDone) {\n    this.label.text = localize('length: ') + this.list.length();\n    if (notDone) {\n        this.label.color = new Color(0, 0, 100);\n    } else {\n        this.label.color = new Color(0, 0, 0);\n    }\n    this.label.fixLayout();\n    this.label.setCenter(this.center());\n    this.label.setBottom(this.bottom() - 3);\n};\n\nListWatcherMorph.prototype.startIndexMenu = function () {\n    var i,\n        range,\n        items = Math.ceil(this.list.length() / this.range),\n        menu = new MenuMorph(\n            idx => this.setStartIndex(idx),\n            null,\n            this\n        );\n    menu.addItem('1...', 1);\n    for (i = 1; i < items; i += 1) {\n        range = i * 100 + 1;\n        menu.addItem(range + '...', range);\n    }\n    menu.popUpAtHand(this.world());\n};\n\nListWatcherMorph.prototype.setStartIndex = function (index) {\n    this.start = index;\n    this.list.changed();\n    this.update();\n};\n\nListWatcherMorph.prototype.fixLayout = function () {\n    if (!this.label) {return; }\n    if (this.frame) {\n        this.arrangeCells();\n        this.frame.setPosition(this.position().add(3));\n        this.frame.bounds.corner = this.bounds.corner.subtract(new Point(\n            3,\n            17\n        ));\n        this.frame.fixLayout();\n        this.frame.contents.adjustBounds();\n    }\n\n    this.label.setCenter(this.center());\n    this.label.setBottom(this.bottom() - 3);\n    if (this.plusButton) {\n        this.plusButton.setLeft(this.left() + 3);\n        this.plusButton.setBottom(this.bottom() - 3);\n    }\n\n    if (this.parent) {\n        this.parent.changed();\n        this.parent.fixLayout();\n        this.parent.rerender();\n    }\n};\n\nListWatcherMorph.prototype.arrangeCells = function () {\n    var i, cell, label, button, lastCell,\n        end = this.frame.contents.children.length;\n    for (i = 0; i < end; i += 3) {\n        cell = this.frame.contents.children[i];\n        label = this.frame.contents.children[i + 1];\n        button = this.frame.contents.children[i + 2];\n        if (lastCell) {\n            cell.setTop(lastCell.bottom());\n        }\n        if (label) {\n            label.setTop(cell.center().y - label.height() / 2);\n            label.setRight(cell.left() - 2);\n        }\n        if (button) {\n            button.setCenter(cell.center());\n            button.setLeft(cell.right() + 2);\n        }\n        lastCell = cell;\n    }\n    this.frame.contents.adjustBounds();\n};\n\nListWatcherMorph.prototype.expand = function (maxExtent) {\n    // make sure to show all (first 100) cells\n    var fe = this.frame.contents.extent(),\n        ext = new Point(fe.x + 6, fe.y + this.label.height() + 6);\n    if (maxExtent) {\n        ext = ext.min(maxExtent);\n    }\n    this.setExtent(ext);\n    this.handle.setRight(this.right() - 3);\n    this.handle.setBottom(this.bottom() - 3);\n};\n\n// ListWatcherMorph context menu\n\nListWatcherMorph.prototype.userMenu = function () {\n    if (!List.prototype.enableTables) {\n        return this.escalateEvent('userMenu');\n    }\n    var menu = new MenuMorph(this);\n    menu.addItem('table view...', 'showTableView');\n    if (this.list.canBeJSON()) {\n        menu.addItem(\n            'blockify',\n            () => {\n                var world = this.world(),\n                    ide = detect(world.children, m => m instanceof IDE_Morph);\n                this.list.blockify().pickUp(world);\n                world.hand.grabOrigin = {\n                    origin: ide.palette,\n                    position: ide.palette.center()\n                };\n            }\n        );\n    }\n    menu.addLine();\n    menu.addItem(\n        'open in dialog...',\n        () => new TableDialogMorph(this.list).popUp(this.world())\n    );\n    return menu;\n};\n\nListWatcherMorph.prototype.showTableView = function () {\n    var view = this.parentThatIsA(\n        SpriteBubbleMorph,\n        SpeechBubbleMorph,\n        CellMorph\n    );\n    if (!view) {return; }\n    if (view instanceof SpriteBubbleMorph) {\n        view.contentsMorph.destroy();\n        view.contentsMorph = new TableFrameMorph(new TableMorph(this.list, 10));\n        view.contentsMorph.expand(this.extent());\n        view.parent.positionTalkBubble();\n    } else if (view instanceof SpeechBubbleMorph) {\n        view.contents = new TableFrameMorph(new TableMorph(this.list, 10));\n        view.contents.expand(this.extent());\n    } else { // watcher cell\n        view.changed();\n        view.contentsMorph.destroy();\n        view.contentsMorph = new TableFrameMorph(new TableMorph(this.list, 10));\n        view.add(view.contentsMorph);\n        view.contentsMorph.setPosition(this.position());\n        view.contentsMorph.expand(this.extent());\n    }\n    view.fixLayout();\n    view.rerender();\n};\n\n// ListWatcherMorph events:\n\nListWatcherMorph.prototype.mouseDoubleClick = function (pos) {\n    if (List.prototype.enableTables) {\n        new TableDialogMorph(this.list).popUp(this.world());\n    } else {\n        this.escalateEvent('mouseDoubleClick', pos);\n    }\n};\n\n// ListWatcherMorph hiding/showing:\n\nListWatcherMorph.prototype.show = function () {\n    ListWatcherMorph.uber.show.call(this);\n    this.frame.contents.adjustBounds();\n};\n\n// ListWatcherMorph rendering:\n\nListWatcherMorph.prototype.render = WatcherMorph.prototype.render;\n","/*\n\n    maps.js\n\n    a slippy maps tile client for morphic.js and Snap!\n\n    written by Jens Mnig\n    jens@moenig.org\n\n    Copyright (C) 2020 by Jens Mnig\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    prerequisites:\n    --------------\n    needs morphic.js\n\n    credits:\n    --------\n    https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames\n*/\n\n/*global modules, Point, newCanvas, radians, StringMorph, normalizeCanvas*/\n\n// Global stuff ////////////////////////////////////////////////////////\nimport {modules, Point, newCanvas, radians, StringMorph, normalizeCanvas} from './morphic'\nmodules.maps = '2020-March-25';\n\n// WorldMap /////////////////////////////////////////////////////////////\n\nexport function WorldMap(host) {\n    this.tileServers = {\n        OpenStreetMap: {\n            url: 'tile.openstreetmap.org',\n            type: 'zxy',\n            subdomains: ['a', 'b', 'c'],\n            key: null,\n            min: 0,\n            max: 19,\n            credits: 'Map data \\u00A9 OpenStreetMap contributors' +\n                'CC-BY-SA, Imagery \\u00A9 Mapnik'\n        },\n        Wikimedia: {\n            url: 'maps.wikimedia.org/osm-intl',\n            type: 'zxy',\n            subdomains: null,\n            key: null,\n            min: 0,\n            max: 19,\n            credits: 'Map data \\u00A9 OpenStreetMap contributors, ' +\n                'CC-BY-SA, Imagery \\u00A9 Wikimedia'\n        },\n        Watercolor: {\n            url: 'stamen-tiles.a.ssl.fastly.net/watercolor',\n            type: 'zxy',\n            subdomains: null,\n            key: null,\n            min: 0,\n            max: 20,\n            credits: 'Map data \\u00A9 OpenStreetMap contributors, ' +\n                'CC-BY-SA, Imagery \\u00A9 Stamen, CC-BY-3.0.'\n        },\n        'Toner': {\n            url: 'stamen-tiles.a.ssl.fastly.net/toner',\n            type: 'zxy',\n            subdomains: null,\n            key: null,\n            min: 0,\n            max: 20,\n            credits: 'Map data \\u00A9 OpenStreetMap contributors, ' +\n                'CC-BY-SA, Imagery \\u00A9 Stamen, CC-BY-3.0.'\n        },\n        'Terrain': {\n            url: 'stamen-tiles.a.ssl.fastly.net/terrain',\n            type: 'zxy',\n            subdomains: null,\n            key: null,\n            min: 0,\n            max: 16,\n            credits: 'Map data \\u00A9 OpenStreetMap contributors, ' +\n                'CC-BY-SA, Imagery \\u00A9 Stamen, CC-BY-3.0.'\n        },\n        Topographic: {\n            url: 'tile.opentopomap.org',\n            type: 'zxy',\n            subdomains: null,\n            key: null,\n            min: 0,\n            max: 17,\n            credits: 'Map data \\u00A9 OpenStreetMap contributors, ' +\n                'CC-BY-SA, Imagery \\u00A9 Opentopomaps'\n        },\n        Satellite: {\n            url: 'services.arcgisonline.com/ArcGIS/rest/services/' +\n                'World_Imagery/MapServer/tile',\n            type: 'zyx',\n            subdomains: null,\n            key: null,\n            min: 0,\n            max: 19,\n            credits: 'Imagery \\u00A9 ArcGIS'\n        },\n        Streets: {\n            url: 'services.arcgisonline.com/ArcGIS/rest/services/' +\n                'World_Street_Map/MapServer/tile',\n            type: 'zyx',\n            subdomains: null,\n            key: null,\n            min: 0,\n            max: 19,\n            credits: 'Imagery \\u00A9 ArcGIS'\n        },\n        Shading: {\n            url: 'services.arcgisonline.com/ArcGIS/rest/services/' +\n                'World_Topo_Map/MapServer/tile',\n            type: 'zyx',\n            subdomains: null,\n            key: null,\n            min: 0,\n            max: 19,\n            credits: 'Imagery \\u00A9 ArcGIS'\n        },\n        'Mapbox (experimental)': {\n            url: 'api.tiles.mapbox.com/v4/mapbox.streets',\n            type: 'zxy',\n            subdomains: null,\n            key: '?access_token=' +\n                'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycX' +\n                'BndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw',\n            min: 0,\n            max: 20,\n            credits: 'Map data \\u00A9 OpenStreetMap contributors, ' +\n                'CC-BY-SA, Imagery \\u00A9 Mapbox'\n        }\n    };\n    this.api = this.tileServers[host || 'Wikimedia'];\n    this.lon = -122.257852;\n    this.lat = 37.872099;\n    this.zoom = 13;\n    this.position = new Point(\n        this.tileXfromLon(this.lon),\n        this.tileYfromLat(this.lat)\n    );\n    this.extent = new Point(480, 360);\n    this.tileSize = 256;\n    this.canvas = null;\n    this.creditsTxt = null;\n    this.creditsBG = null;\n    this.initializeCredits();\n    this.loading = 0;\n}\n\nWorldMap.prototype.setHost = function (host) {\n    this.api = this.tileServers[host || 'Wikimedia'];\n    this.initializeCredits();\n    this.setZoom(this.zoom);\n};\n\nWorldMap.prototype.setView = function (lon, lat) {\n    this.lat = lat;\n    this.lon = lon;\n    this.refresh();\n};\n\nWorldMap.prototype.setZoom = function (num) {\n    this.zoom = Math.max(Math.min(this.api.max, Math.floor(num)), this.api.min);\n    this.refresh();\n};\n\nWorldMap.prototype.panBy = function (x, y) {\n    this.lon = this.lonFromTileX(this.position.x + (x / this.tileSize));\n    this.lat = this.latFromTileY(this.position.y + (y / this.tileSize));\n    this.refresh();\n};\n\nWorldMap.prototype.refresh = function () {\n    this.position = new Point(\n        this.wrapTile(this.tileXfromLon(this.lon)),\n        this.tileYfromLat(this.lat)\n    );\n};\n\nWorldMap.prototype.wrapTile = function (n) {\n    var max = Math.pow(2, this.zoom);\n    return n < 0 ? max + n : n % max;\n};\n\nWorldMap.prototype.tileXfromLon = function (lon) {\n    return (parseFloat(lon) + 180) / 360 * Math.pow(2, this.zoom);\n};\n\nWorldMap.prototype.tileYfromLat = function (lat) {\n    return (1 - Math.log(Math.tan(parseFloat(lat) * Math.PI / 180) + 1 /\n        Math.cos(parseFloat(lat) * Math.PI / 180)) / Math.PI) / 2 *\n        Math.pow(2, this.zoom);\n};\n\nWorldMap.prototype.lonFromTileX = function (x) {\n    return x / Math.pow(2, this.zoom) * 360 - 180;\n};\n\nWorldMap.prototype.latFromTileY = function (y) {\n    var n = Math.PI - 2 * Math.PI * y / Math.pow(2, this.zoom);\n    return 180 / Math.PI * Math.atan(0.5 * (Math.exp(n) - Math.exp(-n)));\n};\n\nWorldMap.prototype.lonFromSnapX = function (x) {\n    return this.lonFromTileX(this.position.x + (x / this.tileSize));\n};\n\nWorldMap.prototype.latFromSnapY = function (y) {\n    return this.latFromTileY(this.position.y - (y / this.tileSize));\n};\n\nWorldMap.prototype.snapXfromLon = function (lon) {\n    return (this.tileXfromLon(lon) - this.position.x) * this.tileSize;\n};\n\nWorldMap.prototype.snapYfromLat = function (lat) {\n    return (this.tileYfromLat(lat) - this.position.y) * -this.tileSize;\n};\n\nWorldMap.prototype.distanceInKm = function(lat1, lon1, lat2, lon2) {\n    // haversine formula:\n    var R = 6371, // radius of the earth in km\n        dLat = radians(+lat2 - lat1),\n        dLon = radians(+lon2 - lon1),\n        a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n            Math.cos(radians(+lat1)) * Math.cos(radians(+lat2)) *\n            Math.sin(dLon/2) * Math.sin(dLon/2),\n        c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\n    return R * c;\n};\n\nWorldMap.prototype.render = function () {\n    var cntr = this.extent.divideBy(2),\n        size = this.tileSize,\n        tile = this.position.floor(),\n        off = new Point(\n            this.position.x % 1,\n            this.position.y % 1\n        ).multiplyBy(size),\n        tileOrigin = cntr.subtract(off),\n        tileDistance = tileOrigin.floorDivideBy(size).add(1),\n        tileGrid = this.extent.floorDivideBy(size).add(2),\n        originTile = tile.subtract(tileDistance),\n        mapOrigin = tileOrigin.subtract(\n            tileDistance.multiplyBy(size)\n        ),\n        sub = 0,\n        myself = this,\n        max = Math.pow(2, this.zoom),\n        x, y, img, ctx, tileX, tileY, coords;\n\n    function ok() {\n        myself.loading -= 1;\n        ctx.drawImage(\n            this,\n            mapOrigin.x + (this.cx * size),\n            mapOrigin.y + (this.cy * size)\n        );\n        crd();\n    }\n\n    function err() {\n        myself.loading -= 1;\n        crd();\n    }\n\n    function crd() {\n        if (!myself.loading) {\n            myself.addCredits();\n        }\n    }\n\n    // create a new canvas. Note, we cannot reuse the existing canvas,\n    // because it could be queried while tiles are still rendering\n    this.canvas = newCanvas(this.extent, true);\n\n    ctx = this.canvas.getContext('2d');\n    for (x = 0; x < tileGrid.x; x += 1) {\n        for (y = 0; y < tileGrid.y; y += 1) {\n            tileX = this.wrapTile(originTile.x + x);\n            tileY = originTile.y + y;\n            if ((tileX >= 0 && tileX < max) && (tileY >= 0 && tileY < max)) {\n                img = new Image();\n                img.cx = x;\n                img.cy = y;\n                img.crossOrigin = ''; // anonymous\n                img.onload = ok;\n                img.onerror = err;\n                myself.loading += 1;\n                switch (this.api.type) {\n                    case 'zxy':\n                        coords = '' + this.zoom + '/' + tileX + '/' + tileY;\n                        break;\n                    case 'zyx':\n                        coords = '' + this.zoom + '/' + tileY + '/' + tileX;\n                        break;\n                    case 'xyz':\n                        coords = '' + tileX + '/' + tileY + '/' + this.zoom ;\n                        break;\n                }\n                img.src = 'https://' +\n                    (this.api.subdomains ?\n                        this.api.subdomains[sub] + '.'\n                            : '') +\n                    this.api.url + '/' + coords + '.png' + (this.api.key || '');\n                if (this.api.subdomains) {\n                    sub += 1;\n                    if  (sub === this.api.subdomains.length) {\n                        sub = 0;\n                    }\n                }\n            }\n        }\n    }\n};\n\nWorldMap.prototype.initializeCredits = function () {\n    var ctx;\n    this.creditsTxt = new StringMorph(\n        ' ' + this.api.credits + ' ',\n        8\n    );\n    this.creditsTxt.isCachingImage = true;\n    this.creditsTxt.cachedImage = normalizeCanvas(\n        this.creditsTxt.getImage(), true\n    );\n    this.creditsBG = newCanvas(this.creditsTxt.extent(), true);\n    ctx = this.creditsBG.getContext('2d');\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, this.creditsBG.width, this.creditsBG.height);\n};\n\nWorldMap.prototype.addCredits = function () {\n    var ctx = this.canvas.getContext('2d'),\n        crd = this.creditsTxt.getImage();\n    ctx.globalAlpha = 0.5;\n    ctx.drawImage(\n        this.creditsBG,\n        this.canvas.width - crd.width,\n        this.canvas.height - crd.height\n    );\n    ctx.globalAlpha = 1;\n    ctx.drawImage(\n        crd,\n        this.canvas.width - crd.width,\n        this.canvas.height - crd.height\n    );\n};\n","/*\n\n    objects.js\n\n    a scriptable microworld\n    based on morphic.js, blocks.js and threads.js\n    inspired by Scratch\n\n    written by Jens Mnig\n    jens@moenig.org\n\n    Copyright (C) 2020 by Jens Mnig\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    prerequisites:\n    --------------\n    needs blocks.js, threads.js, morphic.js and widgets.js\n\n\n    toc\n    ---\n    the following list shows the order in which all constructors are\n    defined. Use this list to locate code in this document:\n\n        SpriteMorph\n        SpriteHighlightMorph\n        StageMorph\n        Costume\n            SVG_Costume\n        CostumeEditorMorph\n        Sound\n        Note\n        Microphone\n        CellMorph\n        WatcherMorph\n        StagePrompterMorph\n\n        SpeechBubbleMorph*\n            SpriteBubbleMorph\n\n    * defined in Morphic.js\n\n\n    credits\n    -------\n    Ian Reynolds contributed initial porting of primitives from Squeak and\n    sound handling\n    Achal Dave contributed research and prototyping for creating music\n    using the Web Audio API\n    Yuan Yuan and Dylan Servilla contributed graphic effects for costumes\n\n*/\n\n// Global stuff ////////////////////////////////////////////////////////\n\n/*global PaintEditorMorph, ListWatcherMorph, PushButtonMorph, ToggleMorph, ZERO,\nDialogBoxMorph, InputFieldMorph, SpriteIconMorph, BlockMorph, SymbolMorph, nop,\nThreadManager, VariableFrame, detect, BlockMorph, BoxMorph, Color, Animation,\nCommandBlockMorph, FrameMorph, HatBlockMorph, MenuMorph, Morph, MultiArgMorph,\nReporterBlockMorph, ScriptsMorph, StringMorph, SyntaxElementMorph, XML_Element,\nTextMorph, contains, degrees, detect, newCanvas, radians, Array, CursorMorph,\nDate, FrameMorph, Math, MenuMorph, Morph, invoke, MorphicPreferences, WHITE,\nObject, PenMorph, Point, Rectangle, ScrollFrameMorph, SliderMorph, VideoMotion,\nStringMorph, TextMorph, contains, copy, degrees, detect, document, isNaN, Point,\nisString, newCanvas, nop, parseFloat, radians, window, modules, IDE_Morph,\n// VariableDialogMorph, HTMLCanvasElement, Context, List, RingMorph, HandleMorph,\nSpeechBubbleMorph, InputSlotMorph, isNil, FileReader, TableDialogMorph, String,\nBlockEditorMorph, BlockDialogMorph, PrototypeHatBlockMorph,  BooleanSlotMorph,\nlocalize, TableMorph, TableFrameMorph, normalizeCanvas, VectorPaintEditorMorph,\nAlignmentMorph, Process, WorldMap, copyCanvas, useBlurredShadows*/\n\n\n\n\n\nimport { ZERO, nop, detect, BoxMorph, Color, Animation,\n   FrameMorph, MenuMorph, Morph,\n  TextMorph, contains, radians, CursorMorph,\n    MorphicPreferences, WHITE,\n   PenMorph, Rectangle, ScrollFrameMorph, SliderMorph,\n  StringMorph, copy, degrees, Point,\n  isString, newCanvas, modules, HandleMorph,\n  SpeechBubbleMorph, isNil,\n  localize, normalizeCanvas, copyCanvas, useBlurredShadows} from './morphic.js'\n\n\nimport { SymbolMorph} from './symbols.js'\n\nimport {PushButtonMorph, ToggleMorph,\n  DialogBoxMorph, InputFieldMorph, AlignmentMorph} from './widgets.js'\n\nimport { BlockMorph,\n  CommandBlockMorph, HatBlockMorph,  MultiArgMorph,\n  ReporterBlockMorph, ScriptsMorph, SyntaxElementMorph,  RingMorph,\n  InputSlotMorph,  BooleanSlotMorph} from './blocks.js';\n\nimport {\n  ThreadManager, VariableFrame, invoke, Context,  Process } from './threads.js';\n\nimport {List} from './lists.js'\n\nimport {WorldMap} from './maps'\nimport {IDE_Morph} from \"./gui\";\n// import {PaintEditorMorph} from \"./paint\";\n// import {\n//  VariableDialogMorph,\n//   BlockEditorMorph, BlockDialogMorph, PrototypeHatBlockMorph} from \"./byob\";\nmodules.objects = '2020-November-20';\n\n\n// var SpriteMorph;\n// var StageMorph;\n// var SpriteBubbleMorph;\n// export var Costume;\n// export var SVG_Costume;\n// var CostumeEditorMorph;\n// export var Sound;\n// export var Note;\n// export var Microphone;\n// var CellMorph;\n// var WatcherMorph;\n// var StagePrompterMorph;\n// export var Note;\n// var SpriteHighlightMorph;\n\nexport function isSnapObject(thing) {\n    return thing instanceof SpriteMorph || (thing instanceof StageMorph);\n}\n\n// SpriteMorph /////////////////////////////////////////////////////////\n\n// I am a scriptable object\n\n// SpriteMorph inherits from PenMorph:\n\nSpriteMorph.prototype = new PenMorph();\nSpriteMorph.prototype.constructor = SpriteMorph;\nSpriteMorph.uber = PenMorph.prototype;\n\n// SpriteMorph settings\n\nSpriteMorph.prototype.attributes =\n    [\n        'x position',\n        'y position',\n        'direction',\n        'size',\n        'costumes',\n        'costume #',\n        'volume',\n        'balance',\n        'sounds',\n        'shown?',\n        'pen down?',\n        'scripts'\n    ];\n\nSpriteMorph.prototype.categories =\n    [\n        'motion',\n        'control',\n        'looks',\n        'sensing',\n        'sound',\n        'operators',\n        'pen',\n        'variables',\n        'lists',\n        'other'\n    ];\n\nSpriteMorph.prototype.blockColor = {\n    motion : new Color(74, 108, 212),\n    looks : new Color(143, 86, 227),\n    sound : new Color(207, 74, 217),\n    pen : new Color(0, 161, 120),\n    control : new Color(230, 168, 34),\n    sensing : new Color(4, 148, 220),\n    operators : new Color(98, 194, 19),\n    variables : new Color(243, 118, 29),\n    lists : new Color(217, 77, 17),\n    other: new Color(150, 150, 150)\n};\n\nSpriteMorph.prototype.paletteColor = new Color(55, 55, 55);\nSpriteMorph.prototype.paletteTextColor = new Color(230, 230, 230);\nSpriteMorph.prototype.sliderColor\n    = SpriteMorph.prototype.paletteColor.lighter(30);\nSpriteMorph.prototype.isCachingPrimitives = true;\n\nSpriteMorph.prototype.enableNesting = true;\nSpriteMorph.prototype.enableFirstClass = true;\nSpriteMorph.prototype.useFlatLineEnds = false;\nSpriteMorph.prototype.highlightColor = new Color(250, 200, 130);\nSpriteMorph.prototype.highlightBorder = 8;\n\nSpriteMorph.prototype.bubbleColor = WHITE;\nSpriteMorph.prototype.bubbleFontSize = 14;\nSpriteMorph.prototype.bubbleFontIsBold = true;\nSpriteMorph.prototype.bubbleCorner = 10;\nSpriteMorph.prototype.bubbleBorder = 3;\nSpriteMorph.prototype.bubbleBorderColor = new Color(190, 190, 190);\nSpriteMorph.prototype.bubbleMaxTextWidth = 130;\n\nSpriteMorph.prototype.initBlocks = function () {\n    SpriteMorph.prototype.blocks = {\n\n        // Motion\n        forward: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'motion',\n            spec: 'move %n steps',\n            defaults: [10]\n        },\n        turn: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'motion',\n            spec: 'turn %clockwise %n degrees',\n            defaults: [15]\n        },\n        turnLeft: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'motion',\n            spec: 'turn %counterclockwise %n degrees',\n            defaults: [15]\n        },\n        setHeading: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'motion',\n            spec: 'point in direction %dir',\n            defaults: [90]\n        },\n        doFaceTowards: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'motion',\n            spec: 'point towards %dst',\n            defaults: [['mouse-pointer']]\n        },\n        gotoXY: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'motion',\n            spec: 'go to x: %n y: %n',\n            defaults: [0, 0]\n        },\n        doGotoObject: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'motion',\n            spec: 'go to %dst',\n            defaults: [['random position']]\n        },\n        doGlide: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'motion',\n            spec: 'glide %n secs to x: %n y: %n',\n            defaults: [1, 0, 0]\n        },\n        changeXPosition: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'motion',\n            spec: 'change x by %n',\n            defaults: [10]\n        },\n        setXPosition: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'motion',\n            spec: 'set x to %n',\n            defaults: [0]\n        },\n        changeYPosition: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'motion',\n            spec: 'change y by %n',\n            defaults: [10]\n        },\n        setYPosition: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'motion',\n            spec: 'set y to %n',\n            defaults: [0]\n        },\n        bounceOffEdge: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'motion',\n            spec: 'if on edge, bounce'\n        },\n        xPosition: {\n            only: SpriteMorph,\n            type: 'reporter',\n            category: 'motion',\n            spec: 'x position'\n        },\n        yPosition: {\n            only: SpriteMorph,\n            type: 'reporter',\n            category: 'motion',\n            spec: 'y position'\n        },\n        direction: {\n            only: SpriteMorph,\n            type: 'reporter',\n            category: 'motion',\n            spec: 'direction'\n        },\n\n        // Looks\n        doSwitchToCostume: {\n            type: 'command',\n            category: 'looks',\n            spec: 'switch to costume %cst'\n        },\n        doWearNextCostume: {\n            type: 'command',\n            category: 'looks',\n            spec: 'next costume'\n        },\n        getCostumeIdx: {\n            type: 'reporter',\n            category: 'looks',\n            spec: 'costume #'\n        },\n        reportGetImageAttribute: {\n            type: 'reporter',\n            category: 'looks',\n            spec: '%img of costume %cst',\n            defaults: [['width'], ['current']]\n        },\n        reportNewCostume: {\n            type: 'reporter',\n            category: 'looks',\n            spec: 'new costume %l width %dim height %dim'\n        },\n        reportNewCostumeStretched: {\n            type: 'reporter',\n            category: 'looks',\n            spec: 'stretch %cst x: %n y: %n %',\n            defaults: [['current'], 100, 50]\n        },\n        doSayFor: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'looks',\n            spec: 'say %s for %n secs',\n            defaults: [localize('Hello!'), 2]\n        },\n        bubble: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'looks',\n            spec: 'say %s',\n            defaults: [localize('Hello!')]\n        },\n        doThinkFor: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'looks',\n            spec: 'think %s for %n secs',\n            defaults: [localize('Hmm...'), 2]\n        },\n        doThink: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'looks',\n            spec: 'think %s',\n            defaults: [localize('Hmm...')]\n        },\n        changeEffect: {\n            type: 'command',\n            category: 'looks',\n            spec: 'change %eff effect by %n',\n            defaults: [['ghost'], 25]\n        },\n        setEffect: {\n            type: 'command',\n            category: 'looks',\n            spec: 'set %eff effect to %n',\n            defaults: [['ghost'], 0]\n        },\n        getEffect: {\n            type: 'reporter',\n            category: 'looks',\n            spec: '%eff effect',\n            defaults: [['ghost']]\n        },\n        clearEffects: {\n            type: 'command',\n            category: 'looks',\n            spec: 'clear graphic effects'\n        },\n        changeScale: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'looks',\n            spec: 'change size by %n',\n            defaults: [10]\n        },\n        setScale: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'looks',\n            spec: 'set size to %n %',\n            defaults: [100]\n        },\n        getScale: {\n            only: SpriteMorph,\n            type: 'reporter',\n            category: 'looks',\n            spec: 'size'\n        },\n        show: {\n            type: 'command',\n            category: 'looks',\n            spec: 'show'\n        },\n        hide: {\n            type: 'command',\n            category: 'looks',\n            spec: 'hide'\n        },\n        reportShown: {\n            type: 'predicate',\n            category: 'looks',\n            spec: 'shown?'\n        },\n        goToLayer: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'looks',\n            spec: 'go to %layer layer',\n            defaults: [['front']]\n        },\n        goBack: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'looks',\n            spec: 'go back %n layers',\n            defaults: [1]\n        },\n\n        // Looks - Debugging primitives for development mode\n        doScreenshot: {\n            dev: true,\n            type: 'command',\n            category: 'looks',\n            spec: 'save %imgsource as costume named %s',\n            defaults: [['pen trails'], localize('screenshot')]\n        },\n        reportCostumes: {\n            dev: true,\n            type: 'reporter',\n            category: 'looks',\n            spec: 'wardrobe'\n        },\n        alert: {\n            dev: true,\n            type: 'command',\n            category: 'looks',\n            spec: 'alert %mult%s'\n        },\n        log: {\n            dev: true,\n            type: 'command',\n            category: 'looks',\n            spec: 'console log %mult%s'\n        },\n\n        // Sound\n        playSound: {\n            type: 'command',\n            category: 'sound',\n            spec: 'play sound %snd'\n        },\n        doPlaySoundUntilDone: {\n            type: 'command',\n            category: 'sound',\n            spec: 'play sound %snd until done'\n        },\n        doPlaySoundAtRate: {\n            type: 'command',\n            category: 'sound',\n            spec: 'play sound %snd at %rate Hz',\n            defaults: ['', 44100]\n        },\n        doStopAllSounds: {\n            type: 'command',\n            category: 'sound',\n            spec: 'stop all sounds'\n        },\n        reportGetSoundAttribute: {\n            type: 'reporter',\n            category: 'sound',\n            spec: '%aa of sound %snd',\n            defaults: [['duration']]\n        },\n        reportNewSoundFromSamples: {\n            type: 'reporter',\n            category: 'sound',\n            spec: 'new sound %l rate %rate Hz',\n            defaults: [null, 44100]\n        },\n        doRest: {\n            type: 'command',\n            category: 'sound',\n            spec: 'rest for %n beats',\n            defaults: [0.2]\n        },\n        doPlayNote: {\n            type: 'command',\n            category: 'sound',\n            spec: 'play note %note for %n beats',\n            defaults: [60, 0.5]\n        },\n        doPlayFrequency: { // only in dev mode - experimental\n            dev: true,\n            type: 'command',\n            category: 'sound',\n            spec: 'play %n Hz for %n secs',\n            defaults: [440, 2]\n        },\n        doSetInstrument: {\n            type: 'command',\n            category: 'sound',\n            spec: 'set instrument to %inst',\n            defaults: [1]\n        },\n        doChangeTempo: {\n            type: 'command',\n            category: 'sound',\n            spec: 'change tempo by %n',\n            defaults: [20]\n        },\n        doSetTempo: {\n            type: 'command',\n            category: 'sound',\n            spec: 'set tempo to %n bpm',\n            defaults: [60]\n        },\n        getTempo: {\n            type: 'reporter',\n            category: 'sound',\n            spec: 'tempo'\n        },\n        changeVolume: {\n            type: 'command',\n            category: 'sound',\n            spec: 'change volume by %n',\n            defaults: [10]\n        },\n        setVolume: {\n            type: 'command',\n            category: 'sound',\n            spec: 'set volume to %n %',\n            defaults: [100]\n        },\n        getVolume: {\n            type: 'reporter',\n            category: 'sound',\n            spec: 'volume'\n        },\n        changePan: {\n            type: 'command',\n            category: 'sound',\n            spec: 'change balance by %n',\n            defaults: [10]\n        },\n        setPan: {\n            type: 'command',\n            category: 'sound',\n            spec: 'set balance to %n',\n            defaults: [0]\n        },\n        getPan: {\n            type: 'reporter',\n            category: 'sound',\n            spec: 'balance'\n        },\n        playFreq: {\n            type: 'command',\n            category: 'sound',\n            spec: 'play frequency %n Hz',\n            defaults: [440]\n        },\n        stopFreq: {\n            type: 'command',\n            category: 'sound',\n            spec: 'stop frequency'\n        },\n\n        // Sound - Debugging primitives for development mode\n        reportSounds: {\n            dev: true,\n            type: 'reporter',\n            category: 'sound',\n            spec: 'jukebox'\n        },\n\n        // Pen\n        clear: {\n            type: 'command',\n            category: 'pen',\n            spec: 'clear'\n        },\n        down: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'pen',\n            spec: 'pen down'\n        },\n        up: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'pen',\n            spec: 'pen up'\n        },\n        getPenDown: {\n            only: SpriteMorph,\n            type: 'predicate',\n            category: 'pen',\n            spec: 'pen down?'\n        },\n        setColor: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'pen',\n            spec: 'set pen color to %clr'\n        },\n        setPenHSVA: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'pen',\n            spec: 'set pen %hsva to %n',\n            defaults: [['hue'], 50]\n        },\n        changePenHSVA: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'pen',\n            spec: 'change pen %hsva by %n',\n            defaults: [['hue'], 10]\n        },\n        getPenAttribute: {\n            type: 'reporter',\n            category: 'pen',\n            spec: 'pen %pen',\n            defaults: [['hue']]\n        },\n        setBackgroundColor: {\n            only: StageMorph,\n            type: 'command',\n            category: 'pen',\n            spec: 'set background color to %clr'\n        },\n        setBackgroundHSVA: {\n            only: StageMorph,\n            type: 'command',\n            category: 'pen',\n            spec: 'set background %hsva to %n',\n            defaults: [['hue'], 50]\n        },\n        changeBackgroundHSVA: {\n            only: StageMorph,\n            type: 'command',\n            category: 'pen',\n            spec: 'change background %hsva by %n',\n            defaults: [['hue'], 10]\n        },\n        changeSize: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'pen',\n            spec: 'change pen size by %n',\n            defaults: [1]\n        },\n        setSize: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'pen',\n            spec: 'set pen size to %n',\n            defaults: [1]\n        },\n        doStamp: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'pen',\n            spec: 'stamp'\n        },\n        floodFill: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'pen',\n            spec: 'fill'\n        },\n        write: {\n            only: SpriteMorph,\n            type: 'command',\n            category: 'pen',\n            spec: 'write %s size %n',\n            defaults: [localize('Hello!'), 12]\n        },\n        reportPenTrailsAsCostume: {\n            type: 'reporter',\n            category: 'pen',\n            spec: 'pen trails'\n        },\n        reportPentrailsAsSVG: {\n            type: 'reporter',\n            category: 'pen',\n            spec: 'pen vectors'\n        },\n        doPasteOn: {\n            type: 'command',\n            category: 'pen',\n            spec: 'paste on %spr'\n        },\n        doCutFrom: {\n            type: 'command',\n            category: 'pen',\n            spec: 'cut from %spr'\n        },\n\n        // Control\n        receiveGo: {\n            type: 'hat',\n            category: 'control',\n            spec: 'when %greenflag clicked'\n        },\n        receiveKey: {\n            type: 'hat',\n            category: 'control',\n            spec: 'when %keyHat key pressed',\n            defaults: [['space']]\n        },\n        receiveInteraction: {\n            type: 'hat',\n            category: 'control',\n            spec: 'when I am %interaction',\n            defaults: ['clicked']\n        },\n        receiveMessage: {\n            type: 'hat',\n            category: 'control',\n            spec: 'when I receive %msgHat'\n        },\n        receiveCondition: {\n            type: 'hat',\n            category: 'control',\n            spec: 'when %b'\n        },\n        doBroadcast: {\n            type: 'command',\n            category: 'control',\n            spec: 'broadcast %msg'\n        },\n        doBroadcastAndWait: {\n            type: 'command',\n            category: 'control',\n            spec: 'broadcast %msg and wait'\n        },\n        getLastMessage: {\n            type: 'reporter',\n            category: 'control',\n            spec: 'message'\n        },\n        doSend: {\n            type: 'command',\n            category: 'control',\n            spec: 'send %msg to %spr'\n        },\n        doWait: {\n            type: 'command',\n            category: 'control',\n            spec: 'wait %n secs',\n            defaults: [1]\n        },\n        doWaitUntil: {\n            type: 'command',\n            category: 'control',\n            spec: 'wait until %b'\n        },\n        doForever: {\n            type: 'command',\n            category: 'control',\n            spec: 'forever %loop'\n        },\n        doRepeat: {\n            type: 'command',\n            category: 'control',\n            spec: 'repeat %n %loop',\n            defaults: [10]\n        },\n        doUntil: {\n            type: 'command',\n            category: 'control',\n            spec: 'repeat until %b %loop'\n        },\n        doFor: {\n            type: 'command',\n            category: 'control',\n            spec: 'for %upvar = %n to %n %cla',\n            defaults: ['i', 1, 10]\n        },\n        doIf: {\n            type: 'command',\n            category: 'control',\n            spec: 'if %b %c'\n        },\n        doIfElse: {\n            type: 'command',\n            category: 'control',\n            spec: 'if %b %c else %c'\n        },\n        reportIfElse: {\n            type: 'reporter',\n            category: 'control',\n            spec: 'if %b then %s else %s'\n        },\n        doStopThis: {\n            type: 'command',\n            category: 'control',\n            spec: 'stop %stopChoices',\n            defaults: [['all']]\n        },\n        doRun: {\n            type: 'command',\n            category: 'control',\n            spec: 'run %cmdRing %inputs'\n        },\n        fork: {\n            type: 'command',\n            category: 'control',\n            spec: 'launch %cmdRing %inputs'\n        },\n        evaluate: {\n            type: 'reporter',\n            category: 'control',\n            spec: 'call %repRing %inputs'\n        },\n        doReport: {\n            type: 'command',\n            category: 'control',\n            spec: 'report %s'\n        },\n        doCallCC: {\n            type: 'command',\n            category: 'control',\n            spec: 'run %cmdRing w/continuation'\n        },\n        reportCallCC: {\n            type: 'reporter',\n            category: 'control',\n            spec: 'call %cmdRing w/continuation'\n        },\n        doWarp: {\n            type: 'command',\n            category: 'other',\n            spec: 'warp %c'\n        },\n\n        // Message passing\n        doTellTo: {\n            type: 'command',\n            category: 'control',\n            // spec: 'tell %spr to %cl' // I liked this version much better, -Jens\n            spec: 'tell %spr to %cmdRing %inputs'\n        },\n        reportAskFor: {\n            type: 'reporter',\n            category: 'control',\n            spec: 'ask %spr for %repRing %inputs'\n        },\n\n        // Cloning\n        receiveOnClone: {\n            type: 'hat',\n            category: 'control',\n            spec: 'when I start as a clone'\n        },\n        createClone: {\n            type: 'command',\n            category: 'control',\n            spec: 'create a clone of %cln',\n            defaults: [['myself']]\n        },\n        newClone: {\n            type: 'reporter',\n            category: 'control',\n            spec: 'a new clone of %cln',\n            defaults: [['myself']]\n        },\n        removeClone: {\n            type: 'command',\n            category: 'control',\n            spec: 'delete this clone'\n        },\n\n        // Debugging - pausing\n        doPauseAll: {\n            type: 'command',\n            category: 'control',\n            spec: 'pause all %pause'\n        },\n\n        // Sensing\n        reportTouchingObject: {\n            only: SpriteMorph,\n            type: 'predicate',\n            category: 'sensing',\n            spec: 'touching %col ?',\n            defaults: [['mouse-pointer']]\n        },\n        reportTouchingColor: {\n            only: SpriteMorph,\n            type: 'predicate',\n            category: 'sensing',\n            spec: 'touching %clr ?'\n        },\n        reportColorIsTouchingColor: {\n            only: SpriteMorph,\n            type: 'predicate',\n            category: 'sensing',\n            spec: 'color %clr is touching %clr ?'\n        },\n        reportAspect: {\n            type: 'reporter',\n            category: 'sensing',\n            spec: '%asp at %loc',\n            defaults: [['hue'], ['mouse-pointer']]\n        },\n        reportStackSize: {\n            dev: true,\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'stack size'\n        },\n        reportFrameCount: {\n            dev: true,\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'frames'\n        },\n        reportThreadCount: {\n            dev: true,\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'processes'\n        },\n        doAsk: {\n            type: 'command',\n            category: 'sensing',\n            spec: 'ask %s and wait',\n            defaults: [localize('what\\'s your name?')]\n        },\n        reportLastAnswer: { // retained for legacy compatibility\n            dev: true,\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'answer'\n        },\n        getLastAnswer: {\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'answer'\n        },\n        reportMouseX: {\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'mouse x'\n        },\n        reportMouseY: {\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'mouse y'\n        },\n        reportMouseDown: {\n            type: 'predicate',\n            category: 'sensing',\n            spec: 'mouse down?'\n        },\n        reportKeyPressed: {\n            type: 'predicate',\n            category: 'sensing',\n            spec: 'key %key pressed?',\n            defaults: [['space']]\n        },\n        reportRelationTo: {\n            only: SpriteMorph,\n            type: 'reporter',\n            category: 'sensing',\n            spec: '%rel to %dst',\n            defaults: [['distance'], ['mouse-pointer']]\n        },\n        doResetTimer: {\n            type: 'command',\n            category: 'sensing',\n            spec: 'reset timer'\n        },\n        reportTimer: { // retained for legacy compatibility\n            dev: true,\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'timer'\n        },\n        getTimer: {\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'timer'\n        },\n        reportAttributeOf: {\n            type: 'reporter',\n            category: 'sensing',\n            spec: '%att of %spr',\n            defaults: [['costume #']]\n        },\n        reportObject: {\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'object %self',\n            defaults: [['myself']]\n        },\n        reportURL: {\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'url %s',\n            defaults: ['snap.berkeley.edu']\n        },\n        doSetGlobalFlag: {\n            type: 'command',\n            category: 'sensing',\n            spec: 'set %setting to %b',\n            defaults: [['video capture']]\n        },\n        reportGlobalFlag: {\n            type: 'predicate',\n            category: 'sensing',\n            spec: 'is %setting on?',\n            defaults: [['turbo mode']]\n        },\n        reportDate: {\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'current %dates',\n            defaults: [['date']]\n        },\n        reportGet: {\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'my %get',\n            defaults: [['neighbors']]\n        },\n        reportAudio: {\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'microphone %audio',\n            defaults: [['volume']]\n        },\n\n        // Operators\n        reifyScript: {\n            type: 'ring',\n            category: 'other',\n            spec: '%rc %ringparms',\n            alias: 'command ring lambda'\n        },\n        reifyReporter: {\n            type: 'ring',\n            category: 'other',\n            spec: '%rr %ringparms',\n            alias: 'reporter ring lambda'\n        },\n        reifyPredicate: {\n            type: 'ring',\n            category: 'other',\n            spec: '%rp %ringparms',\n            alias: 'predicate ring lambda'\n        },\n        reportSum: {\n            type: 'reporter',\n            category: 'operators',\n            spec: '%n + %n'\n        },\n        reportDifference: {\n            type: 'reporter',\n            category: 'operators',\n            spec: '%n \\u2212 %n',\n            alias: '-'\n        },\n        reportProduct: {\n            type: 'reporter',\n            category: 'operators',\n            spec: '%n \\u00D7 %n',\n            alias: '*'\n        },\n        reportQuotient: {\n            type: 'reporter',\n            category: 'operators',\n            spec: '%n / %n' // '%n \\u00F7 %n'\n        },\n        reportRound: {\n            type: 'reporter',\n            category: 'operators',\n            spec: 'round %n'\n        },\n        reportMonadic: {\n            type: 'reporter',\n            category: 'operators',\n            spec: '%fun of %n',\n            defaults: [['sqrt'], 10]\n        },\n        reportPower: {\n            type: 'reporter',\n            category: 'operators',\n            spec: '%n ^ %n'\n        },\n        reportModulus: {\n            type: 'reporter',\n            category: 'operators',\n            spec: '%n mod %n'\n        },\n        reportRandom: {\n            type: 'reporter',\n            category: 'operators',\n            spec: 'pick random %n to %n',\n            defaults: [1, 10]\n        },\n        reportLessThan: {\n            type: 'predicate',\n            category: 'operators',\n            spec: '%s < %s'\n        },\n        reportEquals: {\n            type: 'predicate',\n            category: 'operators',\n            spec: '%s = %s'\n        },\n        reportGreaterThan: {\n            type: 'predicate',\n            category: 'operators',\n            spec: '%s > %s'\n        },\n        reportAnd: {\n            type: 'predicate',\n            category: 'operators',\n            spec: '%b and %b'\n        },\n        reportOr: {\n            type: 'predicate',\n            category: 'operators',\n            spec: '%b or %b'\n        },\n        reportNot: {\n            type: 'predicate',\n            category: 'operators',\n            spec: 'not %b'\n        },\n        reportBoolean: {\n            type: 'predicate',\n            category: 'operators',\n            spec: '%bool',\n            alias: 'true boolean'\n        },\n        reportFalse: { // special case for keyboard entry and search\n            type: 'predicate',\n            category: 'operators',\n            spec: '%bool',\n            defaults: [false],\n            alias: 'false boolean'\n        },\n        reportJoinWords: {\n            type: 'reporter',\n            category: 'operators',\n            spec: 'join %words',\n            defaults: [localize('hello') + ' ', localize('world')]\n        },\n        reportLetter: {\n            type: 'reporter',\n            category: 'operators',\n            spec: 'letter %idx of %s',\n            defaults: [1, localize('world')]\n        },\n        reportStringSize: {\n            type: 'reporter',\n            category: 'operators',\n            spec: 'length of %s',\n            defaults: [localize('world')]\n        },\n        reportUnicode: {\n            type: 'reporter',\n            category: 'operators',\n            spec: 'unicode of %s',\n            defaults: ['a']\n        },\n        reportUnicodeAsLetter: {\n            type: 'reporter',\n            category: 'operators',\n            spec: 'unicode %n as letter',\n            defaults: [65]\n        },\n        reportIsA: {\n            type: 'predicate',\n            category: 'operators',\n            spec: 'is %s a %typ ?',\n            defaults: [5, ['number']]\n        },\n        reportIsIdentical: {\n            type: 'predicate',\n            category: 'operators',\n            spec: 'is %s identical to %s ?'\n        },\n        reportTextSplit: {\n            type: 'reporter',\n            category: 'operators',\n            spec: 'split %s by %delim',\n            defaults: [localize('hello') + ' ' + localize('world'), \" \"]\n        },\n        reportJSFunction: {\n            type: 'reporter',\n            category: 'operators',\n            spec: 'JavaScript function ( %mult%s ) { %code }'\n        },\n        reportTypeOf: { // only in dev mode for debugging\n            dev: true,\n            type: 'reporter',\n            category: 'operators',\n            spec: 'type of %s',\n            defaults: [5]\n        },\n        reportTextFunction: { // only in dev mode - experimental\n            dev: true,\n            type: 'reporter',\n            category: 'operators',\n            spec: '%txtfun of %s',\n            defaults: [['encode URI'], \"Abelson & Sussman\"]\n        },\n        reportCompiled: { // experimental\n            type: 'reporter',\n            category: 'operators',\n            spec: 'compile %repRing for %n args',\n            defaults: [null, 0]\n        },\n\n        // Variables\n        doSetVar: {\n            type: 'command',\n            category: 'variables',\n            spec: 'set %var to %s',\n            defaults: [null, 0]\n        },\n        doChangeVar: {\n            type: 'command',\n            category: 'variables',\n            spec: 'change %var by %n',\n            defaults: [null, 1]\n        },\n        doShowVar: {\n            type: 'command',\n            category: 'variables',\n            spec: 'show variable %var'\n        },\n        doHideVar: {\n            type: 'command',\n            category: 'variables',\n            spec: 'hide variable %var'\n        },\n        doDeclareVariables: {\n            type: 'command',\n            category: 'other',\n            spec: 'script variables %scriptVars'\n        },\n\n        // inheritance\n        doDeleteAttr: {\n            type: 'command',\n            category: 'variables',\n            spec: 'inherit %shd'\n        },\n\n        // Lists\n        reportNewList: {\n            type: 'reporter',\n            category: 'lists',\n            spec: 'list %exp'\n        },\n        reportCONS: {\n            type: 'reporter',\n            category: 'lists',\n            spec: '%s in front of %l'\n        },\n        reportListItem: {\n            type: 'reporter',\n            category: 'lists',\n            spec: 'item %idx of %l',\n            defaults: [1]\n        },\n        reportCDR: {\n            type: 'reporter',\n            category: 'lists',\n            spec: 'all but first of %l'\n        },\n        reportListLength: {\n            type: 'reporter',\n            category: 'lists',\n            spec: 'length of %l'\n        },\n        reportListContainsItem: {\n            type: 'predicate',\n            category: 'lists',\n            spec: '%l contains %s',\n            defaults: [null, localize('thing')]\n        },\n        reportListIsEmpty: {\n            type: 'predicate',\n            category: 'lists',\n            spec: 'is %l empty?'\n        },\n        reportListIndex: {\n            dev: true,\n            type: 'reporter',\n            category: 'lists',\n            spec: 'index of %s in %l',\n            defaults: [localize('thing')]\n        },\n        doAddToList: {\n            type: 'command',\n            category: 'lists',\n            spec: 'add %s to %l',\n            defaults: [localize('thing')]\n        },\n        doDeleteFromList: {\n            type: 'command',\n            category: 'lists',\n            spec: 'delete %ida of %l',\n            defaults: [1]\n        },\n        doInsertInList: {\n            type: 'command',\n            category: 'lists',\n            spec: 'insert %s at %idx of %l',\n            defaults: [localize('thing'), 1]\n        },\n        doReplaceInList: {\n            type: 'command',\n            category: 'lists',\n            spec: 'replace item %idx of %l with %s',\n            defaults: [1, null, localize('thing')]\n        },\n\n        // numbers - (arrayed when hyper-blocks is on, otherwise linked)\n        reportNumbers: {\n            type: 'reporter',\n            category: 'lists',\n            spec: 'numbers from %n to %n',\n            defaults: [1, 10]\n        },\n\n        reportConcatenatedLists: { // only in dev mode - experimental\n            type: 'reporter',\n            category: 'lists',\n            spec: 'append %lists'\n        },\n\n        // HOFs\n        reportMap: {\n            type: 'reporter',\n            category: 'lists',\n            spec: 'map %repRing over %l'\n        },\n        reportAtomicMap: {\n            dev: true, // not shown in palette, only accessible via relabelling\n            type: 'reporter',\n            category: 'lists',\n            spec: '%blitz map %repRing over %l'\n        },\n        reportKeep: {\n            type: 'reporter',\n            category: 'lists',\n            spec: 'keep items %predRing from %l'\n        },\n        reportAtomicKeep: {\n            dev: true, // not shown in palette, only accessible via relabelling\n            type: 'reporter',\n            category: 'lists',\n            spec: '%blitz keep items %predRing from %l'\n        },\n        reportFindFirst: {\n            type: 'reporter',\n            category: 'lists',\n            spec: 'find first item %predRing in %l'\n        },\n        reportAtomicFindFirst: {\n            dev: true, // not shown in palette, only accessible via relabelling\n            type: 'reporter',\n            category: 'lists',\n            spec: '%blitz find first item %predRing in %l'\n        },\n        reportCombine: {\n            type: 'reporter',\n            category: 'lists',\n            spec: 'combine %l using %repRing'\n        },\n        reportAtomicCombine: {\n            dev: true, // not shown in palette, only accessible via relabelling\n            type: 'reporter',\n            category: 'lists',\n            spec: '%blitz combine %l using %repRing'\n        },\n        doForEach: {\n            type: 'command',\n            category: 'lists',\n            spec: 'for each %upvar in %l %cla',\n            defaults: [localize('item')]\n        },\n\n        // Tables - experimental\n        doShowTable: {\n            dev: true,\n            type: 'command',\n            category: 'lists',\n            spec: 'show table %l'\n        },\n\n        // Code mapping\n        doMapCodeOrHeader: {\n            type: 'command',\n            category: 'other',\n            spec: 'map %cmdRing to %codeKind %code',\n            defaults: [null, ['code']]\n        },\n        doMapValueCode: {\n            type: 'command',\n            category: 'other',\n            spec: 'map %mapValue to code %code',\n            defaults: [['String'], '<#1>']\n        },\n        doMapListCode: {\n            type: 'command',\n            category: 'other',\n            spec: 'map %codeListPart of %codeListKind to code %code'\n        },\n        reportMappedCode: {\n            type: 'reporter',\n            category: 'other',\n            spec: 'code of %cmdRing'\n        },\n\n        // Video motion\n        doSetVideoTransparency: {\n            type: 'command',\n            category: 'sensing',\n            spec: 'set video transparency to %n',\n            defaults: [50]\n        },\n        reportVideo: {\n            type: 'reporter',\n            category: 'sensing',\n            spec: 'video %vid on %self',\n            defaults: [['motion'], ['myself']]\n        },\n    };\n};\n\nSpriteMorph.prototype.initBlocks();\n\nSpriteMorph.prototype.initBlockMigrations = function () {\n    // change blocks in existing projects to their updated version\n    SpriteMorph.prototype.blockMigrations = {\n        doStopAll: {\n            selector: 'doStopThis',\n            inputs: [['all']]\n        },\n        doStop: {\n            selector: 'doStopThis',\n            inputs: [['this script']]\n        },\n        doStopBlock: {\n            selector: 'doStopThis',\n            inputs: [['this block']]\n        },\n        doStopOthers: {\n            selector: 'doStopThis',\n            inputs: [['all']],\n            offset: 0\n        },\n        receiveClick: {\n            selector: 'receiveInteraction',\n            inputs: [['clicked']]\n        },\n        reportTrue: {\n            selector: 'reportBoolean',\n            inputs: [true]\n        },\n        reportFalse: {\n            selector: 'reportBoolean',\n            inputs: [false]\n        },\n        reportCostumes: {\n            selector: 'reportGet',\n            inputs: [['costumes']]\n        },\n        reportSounds: {\n            selector: 'reportGet',\n            inputs: [['sounds']]\n        },\n        doMapStringCode: {\n            selector: 'doMapValueCode',\n            inputs: [['String'], '<#1>'],\n            offset: 1\n        },\n        reportDistanceTo: {\n        \tselector: 'reportRelationTo',\n         \tinputs: [['distance']],\n            offset: 1\n        },\n        comeToFront: {\n            selector: 'goToLayer',\n            inputs: [['front']]\n        },\n        setHue: {\n            selector: 'setPenHSVA',\n            inputs: [['hue']],\n            offset: 1\n        },\n        setBrightness: {\n            selector: 'setPenHSVA',\n            inputs: [['brightness']],\n            offset: 1\n        },\n        changeHue: {\n            selector: 'changePenHSVA',\n            inputs: [['hue']],\n            offset: 1\n        },\n        changeBrightness: {\n            selector: 'changePenHSVA',\n            inputs: [['brightness']],\n            offset: 1\n        },\n        reportIsFastTracking: {\n            selector: 'reportGlobalFlag',\n            inputs: [['turbo mode']],\n            offset: 1\n        },\n        doSetFastTracking: {\n            selector: 'doSetGlobalFlag',\n            inputs: [['turbo mode']],\n            offset: 1\n        }\n    };\n};\n\nSpriteMorph.prototype.initBlockMigrations();\n\nSpriteMorph.prototype.blockAlternatives = {\n    // structure:\n    //      selector: [ersatz, ...]\n    //      ersatz can also be a 2-item array: [selector, input-offset]\n\n    // motion:\n    forward: ['changeXPosition', 'changeYPosition'],\n    turn: ['turnLeft'],\n    turnLeft: ['turn'],\n    doFaceTowards:  ['doGotoObject'],\n    gotoXY: [['doGlide', 1]],\n    doGotoObject: ['doFaceTowards'],\n    doGlide: [['gotoXY', -1]],\n    changeXPosition: ['changeYPosition', 'setXPosition', 'setYPosition',\n        'forward'],\n    setXPosition: ['setYPosition', 'changeXPosition', 'changeYPosition'],\n    changeYPosition: ['changeXPosition', 'setYPosition', 'setXPosition',\n        'forward'],\n    setYPosition: ['setXPosition', 'changeYPosition', 'changeXPosition'],\n    xPosition: ['yPosition'],\n    yPosition: ['xPosition'],\n\n    // looks:\n    doSayFor: ['doThinkFor', 'bubble', 'doThink', 'doAsk'],\n    doThinkFor: ['doSayFor', 'doThink', 'bubble', 'doAsk'],\n    bubble: ['doThink', 'doAsk', 'doSayFor', 'doThinkFor'],\n    doThink: ['bubble', 'doAsk', 'doSayFor', 'doThinkFor'],\n    show: ['hide'],\n    hide: ['show'],\n    changeEffect: ['setEffect'],\n    setEffect: ['changeEffect'],\n    changeScale: ['setScale'],\n    setScale: ['changeScale'],\n\n    // sound:\n    playSound: ['doPlaySoundUntilDone', 'doPlaySoundAtRate'],\n    doPlaySoundUntilDone: ['playSound', 'doPlaySoundAtRate'],\n    doPlaySoundAtRate: ['playSound', 'doPlaySoundUntilDone'],\n    doPlayNote: [['doRest', -1]],\n    doRest: [['doPlayNote', 1]],\n    doChangeTempo: ['doSetTempo'],\n    doSetTempo: ['doChangeTempo'],\n    setVolume: ['changeVolume'],\n    changeVolume: ['setVolume'],\n    setPan: ['changePan'],\n    changePan: ['setPan'],\n    getVolume: ['getTempo', 'getPan'],\n    getTempo: ['getVolume', 'getPan'],\n    getPan: ['getVolume', 'getTempo'],\n\n    // pen:\n    clear: ['down', 'up', 'doStamp'],\n    down: ['up', 'clear', 'doStamp'],\n    up: ['down', 'clear', 'doStamp'],\n    doPasteOn: ['doCutFrom'],\n    doCutFrom: ['doPasteOn'],\n    doStamp: ['clear', 'down', 'up'],\n    setPenHSVA: ['changePenHSVA'],\n    changePenHSVA: ['setPenHSVA'],\n    setBackgroundHSVA: ['changeBackgroundHSVA'],\n    changeBackgroundHSVA: ['setBackgroundHSVA'],\n    changeSize: ['setSize'],\n    setSize: ['changeSize'],\n\n    // control:\n    doBroadcast: ['doBroadcastAndWait', 'doSend'],\n    doBroadcastAndWait: ['doBroadcast', 'doSend'],\n    doSend: ['doBroadcast', 'doBroadcastAndWait'],\n    doIf: ['doIfElse', 'doUntil'],\n    doIfElse: ['doIf', 'doUntil'],\n    doRepeat: ['doUntil', ['doForever', -1], ['doFor', 2], ['doForEach', 1]],\n    doUntil: ['doRepeat', 'doIf', ['doForever', -1], ['doFor', 2],\n        ['doForEach', 1]],\n    doForever: [['doUntil', 1], ['doRepeat', 1], ['doFor', 3],\n        ['doForEach', 2]],\n    doFor: [['doForever', -3], ['doRepeat', -2], ['doUntil', -2],\n        ['doForEach', -1]],\n    // doRun: ['fork'],\n    // fork: ['doRun'],\n\n    // sensing:\n    doAsk: ['bubble', 'doThink', 'doSayFor', 'doThinkFor'],\n    getLastAnswer: ['getTimer'],\n    getTimer: ['getLastAnswer'],\n    reportMouseX: ['reportMouseY'],\n    reportMouseY: ['reportMouseX'],\n\n    // operators:\n    reportSum: ['reportDifference', 'reportProduct', 'reportQuotient',\n        'reportPower', 'reportModulus'],\n    reportDifference: ['reportSum', 'reportProduct', 'reportQuotient',\n        'reportPower', 'reportModulus'],\n    reportProduct: ['reportDifference', 'reportSum', 'reportQuotient',\n        'reportPower', 'reportModulus'],\n    reportQuotient: ['reportDifference', 'reportProduct', 'reportSum',\n        'reportPower', 'reportModulus'],\n    reportPower: ['reportDifference', 'reportProduct', 'reportSum',\n        'reportQuotient', 'reportModulus'],\n    reportModulus: ['reportDifference', 'reportProduct', 'reportSum',\n        'reportQuotient', 'reportPower'],\n    reportLessThan: ['reportEquals', 'reportGreaterThan'],\n    reportEquals: ['reportLessThan', 'reportGreaterThan'],\n    reportGreaterThan: ['reportEquals', 'reportLessThan'],\n    reportAnd: ['reportOr'],\n    reportOr: ['reportAnd'],\n\n    // variables\n    doSetVar: ['doChangeVar'],\n    doChangeVar: ['doSetVar'],\n    doShowVar: ['doHideVar'],\n    doHideVar: ['doShowVar'],\n\n    // lists - HOFs\n    reportMap: ['reportKeep', 'reportFindFirst'],\n    reportKeep: ['reportFindFirst', 'reportMap'],\n    reportFindFirst: ['reportKeep', 'reportMap'],\n    doForEach: [['doFor', 1], ['doForever', -2], ['doRepeat', -1],\n        ['doUntil', -1]]\n};\n\n// SpriteMorph instance creation\n\nexport function SpriteMorph(globals) {\n    this.init(globals);\n}\n\nSpriteMorph.prototype.init = function (globals) {\n    this.name = localize('Sprite');\n    this.variables = new VariableFrame(globals || null, this);\n    this.scripts = new ScriptsMorph();\n    this.customBlocks = [];\n    this.costumes = new List();\n    this.costumes.type = 'costume';\n    this.costume = null;\n    this.sounds = new List();\n    this.sounds.type = 'sound';\n    this.normalExtent = new Point(60, 60); // only for costume-less situation\n    this.scale = 1;\n    this.rotationStyle = 1; // 1 = full, 2 = left/right, 0 = off\n    this.instrument = null;\n    this.version = Date.now(); // for observer optimization\n    this.isTemporary = false; // indicate a temporary Scratch-style clone\n    this.isCorpse = false; // indicate whether a sprite/clone has been deleted\n    this.cloneOriginName = '';\n\n    // volume and stereo-pan support, experimental:\n    this.volume = 100;\n    this.gainNode = null; // must be lazily initialized in Chrome, sigh...\n    this.pan = 0;\n    this.pannerNode = null; // must be lazily initialized in Chrome, sigh...\n\n    // frequency player, experimental\n    this.freqPlayer = null; // Note, to be lazily initialized\n\n    // pen hsv color support\n    this.cachedHSV = [0, 0, 0]; // not serialized\n\n    // only temporarily for serialization\n    this.inheritedMethodsCache = [];\n\n    // sprite nesting properties\n    this.parts = []; // not serialized, only anchor (name)\n    this.anchor = null;\n    this.nestingScale = 1;\n    this.rotatesWithAnchor = true;\n    this.layers = null; // cache for dragging nested sprites, don't serialize\n\n    this.blocksCache = {}; // not to be serialized (!)\n    this.paletteCache = {}; // not to be serialized (!)\n    this.rotationOffset = ZERO; // not to be serialized (!)\n    this.idx = 0; // not to be serialized (!) - used for de-serialization\n\n    this.graphicsValues = {\n        'color': 0,\n        'fisheye': 0,\n        'whirl': 0,\n        'pixelate': 0,\n        'mosaic': 0,\n        'duplicate': 0,\n        'negative': 0,\n        'comic': 0,\n        'confetti': 0,\n        'saturation': 0,\n        'brightness': 0\n    };\n\n    // sprite inheritance\n    this.exemplar = null;\n    this.instances = [];\n    this.cachedPropagation = false; // not to be persisted\n    this.inheritedAttributes = []; // 'x position', 'direction', 'size' etc...\n\n    // video- and rendering state\n    this.imageExtent = ZERO;\n    this.imageOffset = ZERO;\n    this.imageData = {}; // version: date, pixels: Uint32Array\n    this.motionAmount = 0;\n    this.motionDirection = 0;\n    this.frameNumber = 0;\n\n    SpriteMorph.uber.init.call(this);\n\n    this.isCachingImage = true;\n    this.isFreeForm = true;\n    this.cachedHSV = this.color.hsv();\n    this.isDraggable = true;\n    this.isDown = false;\n    this.heading = 90;\n    this.fixLayout();\n    this.rerender();\n};\n\n// SpriteMorph duplicating (fullCopy)\n\nSpriteMorph.prototype.fullCopy = function (forClone) {\n    var c = SpriteMorph.uber.fullCopy.call(this),\n        arr = [],\n        cb, effect;\n\n    // make sure the clone has its own canvas to recycle\n    // needs to be copied instead of redrawn, because at\n    // this time the clone is not yet onstage and therefore\n    // has no access to the stage's scale\n    c.cachedImage = copyCanvas(this.cachedImage);\n\n    // un-share individual properties\n    c.instances = [];\n    c.stopTalking();\n    c.color = this.color.copy();\n    c.gainNode = null;\n    c.pannerNode = null;\n    c.freqPlayer = null;\n    c.blocksCache = {};\n    c.paletteCache = {};\n    c.imageData = {};\n    c.cachedHSV = c.color.hsv();\n    arr = [];\n    this.inheritedAttributes.forEach(att => arr.push(att));\n    c.inheritedAttributes = arr;\n    if (forClone) {\n        c.exemplar = this;\n        c.customBlocks = [];\n        c.variables = new VariableFrame(null, c);\n        c.variables.parentFrame = this.variables;\n        c.inheritedVariableNames().forEach(name =>\n            c.shadowVar(name, c.variables.getVar(name))\n        );\n        this.addSpecimen(c);\n        this.cachedPropagation = false;\n        ['scripts', 'costumes', 'sounds'].forEach(att => {\n            if (!contains(c.inheritedAttributes, att)) {\n                c.inheritedAttributes.push(att);\n            }\n        });\n    } else {\n        c.variables = this.variables.copy();\n        c.variables.owner = c;\n        c.scripts = this.scripts.fullCopy();\n        c.customBlocks = [];\n        this.customBlocks.forEach(def => {\n            cb = def.copyAndBindTo(c);\n            c.customBlocks.push(cb);\n            c.allBlockInstances(def).forEach(block =>\n                block.definition = cb\n            );\n        });\n        arr = [];\n        this.costumes.asArray().forEach(costume => {\n            var cst = forClone ? costume : costume.copy();\n            arr.push(cst);\n            if (costume === this.costume) {\n                c.costume = cst;\n            }\n        });\n        c.costumes = new List(arr);\n        arr = [];\n        this.sounds.asArray().forEach(sound => {\n            var snd = forClone ? sound : sound.copy();\n            arr.push(snd);\n        });\n        c.sounds = new List(arr);\n        arr = [];\n    }\n    c.nestingScale = 1;\n    c.rotatesWithAnchor = true;\n    c.anchor = null;\n    c.parts = [];\n    this.parts.forEach(part => {\n        var dp = part.fullCopy(forClone);\n        dp.nestingScale = part.nestingScale;\n        dp.rotatesWithAnchor = part.rotatesWithAnchor;\n        c.attachPart(dp);\n    });\n    c.graphicsValues = {};\n    for (effect in this.graphicsValues) {\n        if (this.graphicsValues.hasOwnProperty(effect)) {\n            c.graphicsValues[effect] = this.graphicsValues[effect];\n        }\n    }\n    return c;\n};\n\nSpriteMorph.prototype.appearIn = function (ide) {\n    // private - used in IDE_Morph.duplicateSprite()\n    if (!this.isTemporary) {\n        this.name = ide.newSpriteName(this.name);\n        ide.corral.addSprite(this);\n        ide.sprites.add(this);\n    }\n    ide.stage.add(this);\n    this.parts.forEach(part => part.appearIn(ide));\n};\n\n// SpriteMorph versioning\n\nSpriteMorph.prototype.setName = function (string) {\n    this.name = string || this.name;\n    if (name != this.name) {\n        // Trace.log('Sprite.setName', name);\n    }\n    this.version = Date.now();\n};\n\n// SpriteMorph rendering\n\nSpriteMorph.prototype.getImage = function () {\n    // overrides inherited method to allow for an image exceeding my bounds\n    // to accommodate rotation and to disable retina resolution to\n    // optimize graphics performance\n    if (this.shouldRerender || !this.cachedImage) {\n        this.cachedImage = newCanvas(\n            this.costume ? this.imageExtent : this.extent(),\n            !isNil(this.costume), // retina\n            this.cachedImage\n        );\n        this.render(this.cachedImage.getContext('2d'));\n        this.shouldRerender = false;\n    }\n    return this.cachedImage;\n};\n\nSpriteMorph.prototype.fixLayout = function () {\n    // determine my extent and the extent designated for my cached image\n    var currentCenter,\n        facing, // actual costume heading based on my rotation style\n        isFlipped,\n        isLoadingCostume,\n        pic, // (flipped copy of) actual costume based on my rotation style\n        imageSide,\n        stageScale,\n        newX,\n        corners = [],\n        origin,\n        corner,\n        costumeExtent;\n\n    currentCenter = this.center();\n    isLoadingCostume = this.costume &&\n        typeof this.costume.loaded === 'function';\n    stageScale = this.parent instanceof StageMorph ?\n            this.parent.scale : 1;\n    facing = this.rotationStyle ? this.heading : 90;\n    if (this.rotationStyle === 2) {\n        facing = 90;\n        if ((this.heading > 180 && (this.heading < 360))\n                || (this.heading < 0 && (this.heading > -180))) {\n            isFlipped = true;\n        }\n    }\n    if (this.costume && !isLoadingCostume) {\n         pic = isFlipped ? this.costume.flipped() : this.costume;\n\n         // determine the rotated costume's bounding box\n         corners = pic.bounds().corners().map(point =>\n            point.rotateBy(\n                radians(facing - 90),\n                this.costume.center()\n            )\n         );\n         origin = corners[0];\n         corner = corners[0];\n         corners.forEach(point => {\n             origin = origin.min(point);\n             corner = corner.max(point);\n         });\n         costumeExtent = origin.corner(corner)\n             .extent().multiplyBy(this.scale * stageScale);\n\n         // determine the new relative origin of the rotated shape\n         this.imageOffset = ZERO.rotateBy(\n             radians(-(facing - 90)),\n             pic.center()\n         ).subtract(origin);\n\n        // determine an adequately dimensioned image extent, so the\n        // shape on the canvas ran be rotated without having to create\n        // a new canvas each time\n\n        if (this.rotationStyle === 1) { // rotate freely in all directions\n            // create a canvas that is big enough, so the sprite's current\n            // costume can be fully rotated inside, so we can recycle\n            // the canvas for re-rendering until the sprite's or the stage's\n            // scale changes.\n            // note that the canvas will be too big for most situations, but\n            // the sprite's bounds indicate the actually visible area.\n            // recycling canvas elements instead of creating new ones whenever\n            // we render a sprite boosts performance for recent browser\n            // architectures that move canvas elements to the GPU for\n            // rendering (which is a pain in the ass and an altogether\n            // bad idea for any serious GUI but looks oh-so-nice for\n            // some flashy graphic effects in the Apple store).\n            imageSide = Math.sqrt(\n                Math.pow(pic.width(), 2) + Math.pow(pic.height(), 2)\n            ) * this.scale * stageScale;\n            this.imageExtent = new Point(imageSide, imageSide);\n        } else { // don't actually rotate\n            this.imageExtent = costumeExtent;\n        }\n        this.bounds.setExtent(costumeExtent);\n\n        // adjust my position to the rotation\n        this.setCenter(currentCenter, true);\n\n        // determine my rotation offset\n        this.rotationOffset = this.imageOffset\n            .translateBy(pic.rotationCenter)\n            .rotateBy(radians(-(facing - 90)), this.imageOffset)\n            .scaleBy(this.scale * stageScale);\n    } else {\n        facing = isFlipped ? -90 : facing;\n        newX = Math.min(\n            Math.max(\n                this.normalExtent.x * this.scale * stageScale,\n                5\n            ),\n            1000\n        );\n        this.bounds.setWidth(newX);\n        this.bounds.setHeight(newX);\n        this.setCenter(currentCenter, true); // just me\n        this.rotationOffset = this.extent().divideBy(2);\n    }\n };\n\nSpriteMorph.prototype.render = function (ctx) {\n    var myself = this,\n        facing, // actual costume heading based on my rotation style\n        isFlipped,\n        isLoadingCostume,\n        cst,\n        pic, // (flipped copy of) actual costume based on my rotation style\n        stageScale,\n        handle;\n\n    isLoadingCostume = this.costume &&\n        typeof this.costume.loaded === 'function';\n    stageScale = this.parent instanceof StageMorph ?\n            this.parent.scale : 1;\n    facing = this.rotationStyle ? this.heading : 90;\n    if (this.rotationStyle === 2) {\n        facing = 90;\n        if ((this.heading > 180 && (this.heading < 360))\n                || (this.heading < 0 && (this.heading > -180))) {\n            isFlipped = true;\n        }\n    }\n    if (this.costume && !isLoadingCostume) {\n        pic = isFlipped ? this.costume.flipped() : this.costume;\n        ctx.save();\n        ctx.scale(this.scale * stageScale, this.scale * stageScale);\n        ctx.translate(this.imageOffset.x, this.imageOffset.y);\n        ctx.rotate(radians(facing - 90));\n        ctx.drawImage(pic.contents, 0, 0);\n        ctx.restore();\n\n    } else {\n        facing = isFlipped ? -90 : facing;\n        SpriteMorph.uber.render.call(this, ctx, facing);\n\n        if (isLoadingCostume) { // retry until costume is done loading\n            cst = this.costume;\n            handle = setInterval(\n                function () {\n                    myself.wearCostume(cst, true);\n                    clearInterval(handle);\n                },\n                100\n            );\n            return this.wearCostume(null, true);\n        }\n    }\n    // apply graphics effects to image\n    this.cachedImage = this.applyGraphicsEffects(this.cachedImage);\n    this.version = Date.now();\n};\n\nSpriteMorph.prototype.rotationCenter = function () {\n    return this.position().add(this.rotationOffset);\n};\n\nSpriteMorph.prototype.getImageData = function () {\n    // used for video motion detection.\n    // Get sprite image data scaled to 1 an converted to ABGR array,\n    // cache to reduce GC load\n    if (this.version !== this.imageData.version) {\n        var stage = this.parentThatIsA(StageMorph),\n            ext = this.extent(),\n            newExtent = new Point(\n                Math.floor(ext.x / stage.scale),\n                Math.floor(ext.y / stage.scale)\n            ),\n            canvas = newCanvas(newExtent, true),\n            canvasContext,\n            imageData;\n        canvasContext = canvas.getContext(\"2d\");\n        canvasContext.drawImage(\n            this.getImage(),\n            0, 0, Math.floor(ext.x),\n            Math.floor(ext.y),\n            0, 0, newExtent.x, newExtent.y\n        );\n        imageData = canvasContext.getImageData(\n            0,\n            0,\n            newExtent.x,\n            newExtent.y\n        ).data;\n        this.imageData = {\n            version : this.version,\n            pixels : new Uint32Array(imageData.buffer.slice(0))\n        };\n    }\n    return this.imageData.pixels;\n};\n\nSpriteMorph.prototype.projectionSnap = function() {\n    var stage = this.parentThatIsA(StageMorph),\n        center = this.center().subtract(stage.position())\n            .divideBy(stage.scale),\n        cst = this.costume || this.getImage(),\n        w, h, rot,\n        offset,\n        snap,\n        ctx;\n\n    if (cst instanceof Costume) {\n        rot = cst.rotationCenter.copy();\n        cst = cst.contents;\n        w = cst.width;\n        h = cst.height;\n    } else {\n        w = this.width();\n        h = this.height();\n    }\n    offset = new Point(\n        Math.floor(center.x - (w / 2)),\n        Math.floor(center.y - (h / 2))\n    );\n    snap = newCanvas(new Point(w, h), true);\n    ctx = snap.getContext('2d');\n    ctx.drawImage(cst, 0, 0);\n    ctx.globalCompositeOperation = 'source-atop';\n    ctx.drawImage(stage.projectionLayer(), -offset.x, -offset.y);\n    return new Costume(snap, this.newCostumeName(localize('snap')), rot);\n};\n\n// SpriteMorph block instantiation\n\nSpriteMorph.prototype.blockForSelector = function (selector, setDefaults) {\n    var migration, info, block, defaults, inputs, i;\n    migration = this.blockMigrations[selector];\n    info = this.blocks[migration ? migration.selector : selector];\n    if (!info) {return null; }\n    block = info.type === 'command' ? new CommandBlockMorph()\n        : info.type === 'hat' ? new HatBlockMorph()\n            : info.type === 'ring' ? new RingMorph()\n                : new ReporterBlockMorph(info.type === 'predicate');\n    block.color = this.blockColor[info.category];\n    block.category = info.category;\n    block.selector = migration ? migration.selector : selector;\n    if (contains(['reifyReporter', 'reifyPredicate'], block.selector)) {\n        block.isStatic = true;\n    }\n    block.setSpec(localize(info.spec));\n    if ((setDefaults && info.defaults) || (migration && migration.inputs)) {\n        defaults = migration ? migration.inputs : info.defaults;\n        block.defaults = defaults;\n        inputs = block.inputs();\n        if (inputs[0] instanceof MultiArgMorph) {\n            inputs[0].setContents(defaults);\n            inputs[0].defaults = defaults;\n        } else {\n            for (i = 0; i < defaults.length; i += 1) {\n                if (defaults[i] !== null) {\n                    inputs[i].setContents(defaults[i]);\n                }\n            }\n        }\n    }\n    return block;\n};\n\nSpriteMorph.prototype.variableBlock = function (varName, isLocalTemplate) {\n    var block = new ReporterBlockMorph(false);\n    block.selector = 'reportGetVar';\n    block.color = this.blockColor.variables;\n    block.category = 'variables';\n    block.isLocalVarTemplate = isLocalTemplate;\n    block.setSpec(varName);\n    block.isDraggable = true;\n    return block;\n};\n\n// SpriteMorph block templates\n\n// SpriteMorph.prototype.blockTemplates = function (category) {\n//     var blocks = [], myself = this, varNames, button,\n//         cat = category || 'motion', txt,\n//         inheritedVars = this.inheritedVariableNames();\n//\n//     function block(selector, isGhosted) {\n//         if (StageMorph.prototype.hiddenPrimitives[selector]) {\n//             return null;\n//         }\n//         var newBlock = SpriteMorph.prototype.blockForSelector(selector, true);\n//         newBlock.isTemplate = true;\n//         if (isGhosted) {newBlock.ghost(); }\n//         return newBlock;\n//     }\n//\n//     function variableBlock(varName, isLocal) {\n//         var newBlock = SpriteMorph.prototype.variableBlock(varName, isLocal);\n//         newBlock.isDraggable = false;\n//         newBlock.isTemplate = true;\n//         if (contains(inheritedVars, varName)) {\n//             newBlock.ghost();\n//         }\n//         return newBlock;\n//     }\n//\n//     function watcherToggle(selector) {\n//         if (StageMorph.prototype.hiddenPrimitives[selector]) {\n//             return null;\n//         }\n//         var info = SpriteMorph.prototype.blocks[selector];\n//         return new ToggleMorph(\n//             'checkbox',\n//             this,\n//             function () {\n//                 myself.toggleWatcher(\n//                     selector,\n//                     localize(info.spec),\n//                     myself.blockColor[info.category]\n//                 );\n//             },\n//             null,\n//             function () {\n//                 return myself.showingWatcher(selector);\n//             },\n//             null\n//         );\n//     }\n//\n//     function variableWatcherToggle(varName) {\n//         return new ToggleMorph(\n//             'checkbox',\n//             this,\n//             function () {\n//                 myself.toggleVariableWatcher(varName);\n//             },\n//             null,\n//             function () {\n//                 return myself.showingVariableWatcher(varName);\n//             },\n//             null\n//         );\n//     }\n//\n//     function helpMenu() {\n//         var menu = new MenuMorph(this);\n//         menu.addItem('help...', 'showHelp');\n//         return menu;\n//     }\n//\n//     function addVar(pair) {\n//         var ide;\n//         if (pair) {\n//             if (myself.isVariableNameInUse(pair[0], pair[1])) {\n//                 myself.inform('that name is already in use');\n//             } else {\n//                 ide = myself.parentThatIsA(IDE_Morph);\n//                 myself.addVariable(pair[0], pair[1]);\n//                 myself.toggleVariableWatcher(pair[0], pair[1]);\n//                 ide.flushBlocksCache('variables'); // b/c of inheritance\n//                 ide.refreshPalette();\n//             }\n//         }\n//     }\n//\n//     if (cat === 'motion') {\n//\n//         blocks.push(block('forward'));\n//         blocks.push(block('turn'));\n//         blocks.push(block('turnLeft'));\n//         blocks.push('-');\n//         blocks.push(block('setHeading'));\n//         blocks.push(block('doFaceTowards'));\n//         blocks.push('-');\n//         blocks.push(block('gotoXY'));\n//         blocks.push(block('doGotoObject'));\n//         blocks.push(block('doGlide'));\n//         blocks.push('-');\n//         blocks.push(block('changeXPosition'));\n//         blocks.push(block('setXPosition'));\n//         blocks.push(block('changeYPosition'));\n//         blocks.push(block('setYPosition'));\n//         blocks.push('-');\n//         blocks.push(block('bounceOffEdge'));\n//         blocks.push('-');\n//         blocks.push(watcherToggle('xPosition'));\n//         blocks.push(block('xPosition', this.inheritsAttribute('x position')));\n//         blocks.push(watcherToggle('yPosition'));\n//         blocks.push(block('yPosition', this.inheritsAttribute('y position')));\n//         blocks.push(watcherToggle('direction'));\n//         blocks.push(block('direction', this.inheritsAttribute('direction')));\n//         blocks.push('=');\n//         blocks.push(this.makeBlockButton(cat));\n//\n//     } else if (cat === 'looks') {\n//\n//         blocks.push(block('doSwitchToCostume'));\n//         blocks.push(block('doWearNextCostume'));\n//         blocks.push(watcherToggle('getCostumeIdx'));\n//         blocks.push(block('getCostumeIdx', this.inheritsAttribute('costume #')));\n//         blocks.push('-');\n//         blocks.push(block('doSayFor'));\n//         blocks.push(block('bubble'));\n//         blocks.push(block('doThinkFor'));\n//         blocks.push(block('doThink'));\n//         blocks.push('-');\n//         blocks.push(block('reportGetImageAttribute'));\n//         blocks.push(block('reportNewCostumeStretched'));\n//         blocks.push(block('reportNewCostume'));\n//         blocks.push('-');\n//         blocks.push(block('changeEffect'));\n//         blocks.push(block('setEffect'));\n//         blocks.push(block('clearEffects'));\n//         blocks.push(block('getEffect'));\n//         blocks.push('-');\n//         blocks.push(block('changeScale'));\n//         blocks.push(block('setScale'));\n//         blocks.push(watcherToggle('getScale'));\n//         blocks.push(block('getScale', this.inheritsAttribute('size')));\n//         blocks.push('-');\n//         blocks.push(block('show'));\n//         blocks.push(block('hide'));\n//         blocks.push(watcherToggle('reportShown'));\n//         blocks.push(block('reportShown', this.inheritsAttribute('shown?')));\n//         blocks.push('-');\n//         blocks.push(block('goToLayer'));\n//         blocks.push(block('goBack'));\n//\n//     // for debugging: ///////////////\n//\n//         if (this.world().isDevMode) {\n//             blocks.push('-');\n//             txt = new TextMorph(localize(\n//                 'development mode \\ndebugging primitives:'\n//             ));\n//             txt.fontSize = 9;\n//             txt.setColor(this.paletteTextColor);\n//             blocks.push(txt);\n//             blocks.push('-');\n//             blocks.push(block('log'));\n//             blocks.push(block('alert'));\n//             blocks.push('-');\n//             blocks.push(block('doScreenshot'));\n//         }\n//\n//     /////////////////////////////////\n//\n//         blocks.push('=');\n//         blocks.push(this.makeBlockButton(cat));\n//\n//     } else if (cat === 'sound') {\n//\n//         blocks.push(block('playSound'));\n//         blocks.push(block('doPlaySoundUntilDone'));\n//         blocks.push(block('doStopAllSounds'));\n//         blocks.push('-');\n//         blocks.push(block('doPlaySoundAtRate'));\n//         blocks.push(block('reportGetSoundAttribute'));\n//         blocks.push(block('reportNewSoundFromSamples'));\n//         blocks.push('-');\n//         blocks.push(block('doRest'));\n//         blocks.push(block('doPlayNote'));\n//         blocks.push(block('doSetInstrument'));\n//         blocks.push('-');\n//         blocks.push(block('doChangeTempo'));\n//         blocks.push(block('doSetTempo'));\n//         blocks.push(watcherToggle('getTempo'));\n//         blocks.push(block('getTempo'));\n//         blocks.push('-');\n//         blocks.push(block('changeVolume'));\n//         blocks.push(block('setVolume'));\n//         blocks.push(watcherToggle('getVolume'));\n//         blocks.push(block('getVolume', this.inheritsAttribute('volume')));\n//         blocks.push('-');\n//         blocks.push(block('changePan'));\n//         blocks.push(block('setPan'));\n//         blocks.push(watcherToggle('getPan'));\n//         blocks.push(block('getPan', this.inheritsAttribute('balance')));\n//         blocks.push('-');\n//         blocks.push(block('playFreq'));\n//         blocks.push(block('stopFreq'));\n//\n//     // for debugging: ///////////////\n//\n//         if (this.world().isDevMode) {\n//             blocks.push('-');\n//             txt = new TextMorph(localize(\n//                 'development mode \\ndebugging primitives:'\n//             ));\n//             txt.fontSize = 9;\n//             txt.setColor(this.paletteTextColor);\n//             blocks.push(txt);\n//             blocks.push('-');\n//             blocks.push(block('doPlayFrequency'));\n//         }\n//\n//     /////////////////////////////////\n//\n//         blocks.push('=');\n//         blocks.push(this.makeBlockButton(cat));\n//\n//     } else if (cat === 'pen') {\n//\n//         blocks.push(block('clear'));\n//         blocks.push('-');\n//         blocks.push(block('down'));\n//         blocks.push(block('up'));\n//         blocks.push(watcherToggle('getPenDown'));\n//         blocks.push(block('getPenDown', this.inheritsAttribute('pen down?')));\n//         blocks.push('-');\n//         blocks.push(block('setColor'));\n//         blocks.push(block('changePenHSVA'));\n//         blocks.push(block('setPenHSVA'));\n//         blocks.push(block('getPenAttribute'));\n//         blocks.push('-');\n//         blocks.push(block('changeSize'));\n//         blocks.push(block('setSize'));\n//         blocks.push('-');\n//         blocks.push(block('doStamp'));\n//         blocks.push(block('floodFill'));\n//         blocks.push(block('write'));\n//         blocks.push('-');\n//         blocks.push(block('reportPenTrailsAsCostume'));\n//         blocks.push('-');\n//         blocks.push(block('doPasteOn'));\n//         blocks.push(block('doCutFrom'));\n//         blocks.push('=');\n//         blocks.push(this.makeBlockButton(cat));\n//\n//     } else if (cat === 'control') {\n//\n//         blocks.push(block('receiveGo'));\n//         blocks.push(block('receiveKey'));\n//         blocks.push(block('receiveInteraction'));\n//         blocks.push(block('receiveCondition'));\n//         blocks.push(block('receiveMessage'));\n//         blocks.push('-');\n//         blocks.push(block('doBroadcast'));\n//         blocks.push(block('doBroadcastAndWait'));\n//         blocks.push(block('doSend'));\n//         blocks.push(watcherToggle('getLastMessage'));\n//         blocks.push(block('getLastMessage'));\n//         blocks.push('-');\n//         blocks.push(block('doWarp'));\n//         blocks.push('-');\n//         blocks.push(block('doWait'));\n//         blocks.push(block('doWaitUntil'));\n//         blocks.push('-');\n//         blocks.push(block('doForever'));\n//         blocks.push(block('doRepeat'));\n//         blocks.push(block('doUntil'));\n//         blocks.push(block('doFor'));\n//         blocks.push('-');\n//         blocks.push(block('doIf'));\n//         blocks.push(block('doIfElse'));\n//         blocks.push(block('reportIfElse'));\n//         blocks.push('-');\n//         blocks.push(block('doReport'));\n//         blocks.push(block('doStopThis'));\n//         blocks.push('-');\n//         blocks.push(block('doRun'));\n//         blocks.push(block('fork'));\n//         blocks.push(block('evaluate'));\n//         blocks.push('-');\n//         blocks.push(block('doTellTo'));\n//         blocks.push(block('reportAskFor'));\n//         blocks.push('-');\n//         blocks.push(block('doCallCC'));\n//         blocks.push(block('reportCallCC'));\n//         blocks.push('-');\n//         blocks.push(block('receiveOnClone'));\n//         blocks.push(block('createClone'));\n//         blocks.push(block('newClone'));\n//         blocks.push(block('removeClone'));\n//         blocks.push('-');\n//         blocks.push(block('doPauseAll'));\n//         blocks.push('=');\n//         blocks.push(this.makeBlockButton(cat));\n//\n//     } else if (cat === 'sensing') {\n//\n//         blocks.push(block('reportTouchingObject'));\n//         blocks.push(block('reportTouchingColor'));\n//         blocks.push(block('reportColorIsTouchingColor'));\n//         blocks.push('-');\n//         blocks.push(block('doAsk'));\n//         blocks.push(watcherToggle('getLastAnswer'));\n//         blocks.push(block('getLastAnswer'));\n//         blocks.push('-');\n//         blocks.push(watcherToggle('reportMouseX'));\n//         blocks.push(block('reportMouseX'));\n//         blocks.push(watcherToggle('reportMouseY'));\n//         blocks.push(block('reportMouseY'));\n//         blocks.push(block('reportMouseDown'));\n//         blocks.push('-');\n//         blocks.push(block('reportKeyPressed'));\n//         blocks.push('-');\n//         blocks.push(block('reportRelationTo'));\n//         blocks.push(block('reportAspect'));\n//         blocks.push('-');\n//         blocks.push(block('doResetTimer'));\n//         blocks.push(watcherToggle('getTimer'));\n//         blocks.push(block('getTimer'));\n//         blocks.push('-');\n//         blocks.push(block('reportAttributeOf'));\n//\n//         if (SpriteMorph.prototype.enableFirstClass) {\n//             blocks.push(block('reportGet'));\n//         }\n//\n//         blocks.push(block('reportObject'));\n//         blocks.push('-');\n//         blocks.push(block('reportURL'));\n//         blocks.push(block('reportAudio'));\n//         blocks.push(block('reportVideo'));\n//         blocks.push(block('doSetVideoTransparency'));\n//         blocks.push('-');\n//         blocks.push(block('reportGlobalFlag'));\n//         blocks.push(block('doSetGlobalFlag'));\n//         blocks.push('-');\n//         blocks.push(block('reportDate'));\n//\n//     // for debugging: ///////////////\n//\n//         if (this.world().isDevMode) {\n//\n//             blocks.push('-');\n//             txt = new TextMorph(localize(\n//                 'development mode \\ndebugging primitives:'\n//             ));\n//             txt.fontSize = 9;\n//             txt.setColor(this.paletteTextColor);\n//             blocks.push(txt);\n//             blocks.push('-');\n//             blocks.push(watcherToggle('reportThreadCount'));\n//             blocks.push(block('reportThreadCount'));\n//             blocks.push(block('reportStackSize'));\n//             blocks.push(block('reportFrameCount'));\n//         }\n//\n// \t/////////////////////////////////\n//\n// \t\tblocks.push('=');\n//         blocks.push(this.makeBlockButton(cat));\n//\n//     } else if (cat === 'operators') {\n//\n//         blocks.push(block('reifyScript'));\n//         blocks.push(block('reifyReporter'));\n//         blocks.push(block('reifyPredicate'));\n//         blocks.push('#');\n//         blocks.push('-');\n//         blocks.push(block('reportSum'));\n//         blocks.push(block('reportDifference'));\n//         blocks.push(block('reportProduct'));\n//         blocks.push(block('reportQuotient'));\n//         blocks.push(block('reportPower'));\n//         blocks.push('-');\n//         blocks.push(block('reportModulus'));\n//         blocks.push(block('reportRound'));\n//         blocks.push(block('reportMonadic'));\n//         blocks.push(block('reportRandom'));\n//         blocks.push('-');\n//         blocks.push(block('reportLessThan'));\n//         blocks.push(block('reportEquals'));\n//         blocks.push(block('reportGreaterThan'));\n//         blocks.push('-');\n//         blocks.push(block('reportAnd'));\n//         blocks.push(block('reportOr'));\n//         blocks.push(block('reportNot'));\n//         blocks.push(block('reportBoolean'));\n//         blocks.push('-');\n//         blocks.push(block('reportJoinWords'));\n//         blocks.push(block('reportTextSplit'));\n//         blocks.push(block('reportLetter'));\n//         blocks.push(block('reportStringSize'));\n//         blocks.push('-');\n//         blocks.push(block('reportUnicode'));\n//         blocks.push(block('reportUnicodeAsLetter'));\n//         blocks.push('-');\n//         blocks.push(block('reportIsA'));\n//         blocks.push(block('reportIsIdentical'));\n//\n//         if (true) { // (Process.prototype.enableJS) {\n//             blocks.push('-');\n//             blocks.push(block('reportJSFunction'));\n//             if (Process.prototype.enableCompiling) {\n// \t            blocks.push(block('reportCompiled'));\n//             }\n//         }\n//\n//     // for debugging: ///////////////\n//\n//         if (this.world().isDevMode) {\n//             blocks.push('-');\n//             txt = new TextMorph(localize(\n//                 'development mode \\ndebugging primitives:'\n//             ));\n//             txt.fontSize = 9;\n//             txt.setColor(this.paletteTextColor);\n//             blocks.push(txt);\n//             blocks.push('-');\n//             blocks.push(block('reportTypeOf'));\n//             blocks.push(block('reportTextFunction'));\n//         }\n//\n//     /////////////////////////////////\n//\n//         blocks.push('=');\n//         blocks.push(this.makeBlockButton(cat));\n//\n//     } else if (cat === 'variables') {\n//\n//         button = new PushButtonMorph(\n//             null,\n//             function () {\n//                 new VariableDialogMorph(\n//                     null,\n//                     addVar,\n//                     myself\n//                 ).prompt(\n//                     'Variable name',\n//                     null,\n//                     myself.world()\n//                 );\n//             },\n//             'Make a variable'\n//         );\n//         button.userMenu = helpMenu;\n//         button.selector = 'addVariable';\n//         button.showHelp = BlockMorph.prototype.showHelp;\n//         blocks.push(button);\n//\n//         if (this.deletableVariableNames().length > 0) {\n//             button = new PushButtonMorph(\n//                 null,\n//                 function () {\n//                     var menu = new MenuMorph(\n//                         myself.deleteVariable,\n//                         null,\n//                         myself\n//                     );\n//                     myself.deletableVariableNames().forEach(name =>\n//                         menu.addItem(\n//                             name,\n//                             name,\n//                             null,\n//                             null,\n//                             null,\n//                             null,\n//                             null,\n//                             null,\n//                             true // verbatim - don't translate\n//                         )\n//                     );\n//                     menu.popUpAtHand(myself.world());\n//                 },\n//                 'Delete a variable'\n//             );\n//             button.userMenu = helpMenu;\n//             button.selector = 'deleteVariable';\n//             button.showHelp = BlockMorph.prototype.showHelp;\n//             blocks.push(button);\n//         }\n//\n//         blocks.push('-');\n//\n//         varNames = this.reachableGlobalVariableNames(true);\n//         if (varNames.length > 0) {\n//             varNames.forEach(name => {\n//                 blocks.push(variableWatcherToggle(name));\n//                 blocks.push(variableBlock(name));\n//             });\n//             blocks.push('-');\n//         }\n//\n//         varNames = this.allLocalVariableNames(true);\n//         if (varNames.length > 0) {\n//             varNames.forEach(name => {\n//                 blocks.push(variableWatcherToggle(name));\n//                 blocks.push(variableBlock(name, true));\n//             });\n//             blocks.push('-');\n//         }\n//\n//         blocks.push(block('doSetVar'));\n//         blocks.push(block('doChangeVar'));\n//         blocks.push(block('doShowVar'));\n//         blocks.push(block('doHideVar'));\n//         blocks.push(block('doDeclareVariables'));\n//\n//     // inheritance:\n//\n//         if (StageMorph.prototype.enableInheritance) {\n//             blocks.push('-');\n//             blocks.push(block('doDeleteAttr'));\n//         }\n//\n//     ///////////////////////////////\n//\n//         blocks.push('=');\n//\n//         blocks.push(block('reportNewList'));\n//         blocks.push(block('reportNumbers'));\n//         blocks.push('-');\n//         blocks.push(block('reportCONS'));\n//         blocks.push(block('reportListItem'));\n//         blocks.push(block('reportCDR'));\n//         blocks.push('-');\n//         blocks.push(block('reportListLength'));\n//         blocks.push(block('reportListIndex'));\n//         blocks.push(block('reportListContainsItem'));\n//         blocks.push(block('reportListIsEmpty'));\n//         blocks.push('-');\n//         blocks.push(block('reportMap'));\n//         blocks.push(block('reportKeep'));\n//         blocks.push(block('reportFindFirst'));\n//         blocks.push(block('reportCombine'));\n//         blocks.push('-');\n//         blocks.push(block('doForEach'));\n//         blocks.push('-');\n//         blocks.push(block('reportConcatenatedLists'));\n//         blocks.push('-');\n//         blocks.push(block('doAddToList'));\n//         blocks.push(block('doDeleteFromList'));\n//         blocks.push(block('doInsertInList'));\n//         blocks.push(block('doReplaceInList'));\n//\n//     // for debugging: ///////////////\n//\n//         if (this.world().isDevMode) {\n//             blocks.push('-');\n//             txt = new TextMorph(localize(\n//                 'development mode \\ndebugging primitives:'\n//             ));\n//             txt.fontSize = 9;\n//             txt.setColor(this.paletteTextColor);\n//             blocks.push(txt);\n//             blocks.push('-');\n//             blocks.push(block('doShowTable'));\n//         }\n//\n//     /////////////////////////////////\n//\n//         blocks.push('=');\n//\n//         if (StageMorph.prototype.enableCodeMapping) {\n//             blocks.push(block('doMapCodeOrHeader'));\n//             blocks.push(block('doMapValueCode'));\n//             blocks.push(block('doMapListCode'));\n//             blocks.push('-');\n//             blocks.push(block('reportMappedCode'));\n//             blocks.push('=');\n//         }\n//\n//         blocks.push(this.makeBlockButton());\n//  \t}\n//     return blocks;\n// };\n\nSpriteMorph.prototype.makeBlockButton = function (category) {\n\t// answer a button that prompts the user to make a new block\n    var button = new PushButtonMorph(\n        this,\n\t\t'makeBlock',\n        'Make a block'\n    );\n\n    button.userMenu = function () {\n        var menu = new MenuMorph(this);\n        menu.addItem('help...', 'showHelp');\n        return menu;\n    };\n\n    button.selector = 'addCustomBlock';\n    button.showHelp = BlockMorph.prototype.showHelp;\n    return button;\n};\n//\n// SpriteMorph.prototype.makeBlock = function () {\n//     // prompt the user to make a new block\n//     var ide = this.parentThatIsA(IDE_Morph),\n//         stage = this.parentThatIsA(StageMorph),\n//         category = ide.currentCategory,\n//         clr = SpriteMorph.prototype.blockColor[category],\n//         dlg;\n//     dlg = new BlockDialogMorph(\n//         null,\n//         definition => {\n//             if (definition.spec !== '') {\n//                 if (definition.isGlobal) {\n//                     stage.globalBlocks.push(definition);\n//                 } else {\n//                     this.customBlocks.push(definition);\n//                 }\n//                 ide.flushPaletteCache();\n//                 ide.refreshPalette();\n//                 new BlockEditorMorph(definition, this).popUp();\n//             }\n//         },\n//         this\n//     );\n//     if (category !== 'variables') {\n//         dlg.category = category;\n//         dlg.categories.children.forEach(each => each.refresh());\n//         dlg.types.children.forEach(each => {\n//             each.setColor(clr);\n//             each.refresh();\n//         });\n//     }\n//     dlg.prompt(\n//         'Make a block',\n//         null,\n//         this.world()\n//     );\n// };\n\nSpriteMorph.prototype.palette = function (category) {\n    if (!this.paletteCache[category]) {\n        this.paletteCache[category] = this.freshPalette(category);\n    }\n    return this.paletteCache[category];\n};\n\nSpriteMorph.prototype.freshPalette = function (category) {\n    var palette = new ScrollFrameMorph(null, null, this.sliderColor),\n        unit = SyntaxElementMorph.prototype.fontSize,\n        x = 0,\n        y = 5,\n        ry = 0,\n        blocks,\n        hideNextSpace = false,\n        stage = this.parentThatIsA(StageMorph),\n        shade = new Color(140, 140, 140),\n        searchButton,\n        makeButton;\n\n    palette.owner = this;\n    palette.padding = unit / 2;\n    palette.color = this.paletteColor;\n    palette.growth = new Point(0, MorphicPreferences.scrollBarSize);\n\n    // toolbar:\n\n    palette.toolBar = new AlignmentMorph('column');\n\n    searchButton = new PushButtonMorph(\n        this,\n        \"searchBlocks\",\n        new SymbolMorph(\"magnifierOutline\", 16)\n    );\n    searchButton.alpha = 0.2;\n    searchButton.padding = 1;\n    searchButton.hint = localize('find blocks') + '...';\n    searchButton.labelShadowColor = shade;\n    searchButton.edge = 0;\n    searchButton.padding = 3;\n    searchButton.fixLayout();\n\tpalette.toolBar.add(searchButton);\n\n    makeButton = new PushButtonMorph(\n        this,\n        \"makeBlock\",\n        new SymbolMorph(\"cross\", 16)\n    );\n    makeButton.alpha = 0.2;\n    makeButton.padding = 1;\n    makeButton.hint = localize('Make a block') + '...';\n    makeButton.labelShadowColor = shade;\n    makeButton.edge = 0;\n    makeButton.padding = 3;\n    makeButton.fixLayout();\n    palette.toolBar.add(makeButton);\n\n\tpalette.toolBar.fixLayout();\n    palette.add(palette.toolBar);\n\n    // menu:\n    palette.userMenu = function () {\n        var menu = new MenuMorph(),\n            ide = this.parentThatIsA(IDE_Morph),\n            more = {\n                operators:\n                    ['reifyScript', 'reifyReporter', 'reifyPredicate'],\n                control:\n                    ['doWarp'],\n                variables:\n                    [\n                        'doDeclareVariables',\n                        'reportNewList',\n                        'reportNumbers',\n                        'reportCONS',\n                        'reportListItem',\n                        'reportCDR',\n                        'reportListLength',\n                        'reportListIndex',\n                        'reportConcatenatedLists',\n                        'reportListContainsItem',\n                        'reportListIsEmpty',\n                        'doForEach',\n                        'reportMap',\n                        'reportKeep',\n                        'reportFindFirst',\n                        'reportCombine',\n                        'doAddToList',\n                        'doDeleteFromList',\n                        'doInsertInList',\n                        'doReplaceInList'\n                    ]\n            };\n\n        function hasHiddenPrimitives() {\n            var defs = SpriteMorph.prototype.blocks,\n                hiddens = StageMorph.prototype.hiddenPrimitives;\n            return Object.keys(hiddens).some(any =>\n                !isNil(defs[any]) &&\n                    (defs[any].category === category ||\n                        contains((more[category] || []), any))\n            );\n        }\n\n        function canHidePrimitives() {\n            return palette.contents.children.some(any =>\n                contains(\n                    Object.keys(SpriteMorph.prototype.blocks),\n                    any.selector\n                )\n            );\n        }\n\n        menu.addPair(\n            [\n                new SymbolMorph(\n                    'magnifyingGlass',\n                    MorphicPreferences.menuFontSize\n                ),\n                localize('find blocks') + '...'\n            ],\n            () => this.searchBlocks(),\n            '^F'\n        );\n        if (canHidePrimitives()) {\n            menu.addItem(\n                'hide primitives',\n                function () {\n                    var defs = SpriteMorph.prototype.blocks;\n                    Object.keys(defs).forEach(sel => {\n                        if (defs[sel].category === category) {\n                            StageMorph.prototype.hiddenPrimitives[sel] = true;\n                        }\n                    });\n                    (more[category] || []).forEach(sel =>\n                        StageMorph.prototype.hiddenPrimitives[sel] = true\n                    );\n                    ide.flushBlocksCache(category);\n                    ide.refreshPalette();\n                }\n            );\n        }\n        if (hasHiddenPrimitives()) {\n            menu.addItem(\n                'show primitives',\n                function () {\n                    // Trace.log('IDE.showPrimitives', ide.currentCategory);\n                    var hiddens = StageMorph.prototype.hiddenPrimitives,\n                        defs = SpriteMorph.prototype.blocks;\n                    Object.keys(hiddens).forEach(sel => {\n                        if (defs[sel] && (defs[sel].category === category)) {\n                            delete StageMorph.prototype.hiddenPrimitives[sel];\n                        }\n                    });\n                    (more[category] || []).forEach(sel =>\n                        delete StageMorph.prototype.hiddenPrimitives[sel]\n                    );\n                    ide.flushBlocksCache(category);\n                    ide.refreshPalette();\n                }\n            );\n        }\n        return menu;\n    };\n\n    // primitives:\n\n    blocks = this.blocksCache[category];\n    if (!blocks) {\n        blocks = this.blockTemplates(category);\n        if (this.isCachingPrimitives) {\n            this.blocksCache[category] = blocks;\n        }\n    }\n\n    blocks.forEach(block => {\n        if (block === null) {\n            return;\n        }\n        if (block === '-') {\n            if (hideNextSpace) {return; }\n            y += unit * 0.8;\n            hideNextSpace = true;\n        } else if (block === '=') {\n            if (hideNextSpace) {return; }\n            y += unit * 1.6;\n            hideNextSpace = true;\n        } else if (block === '#') {\n            x = 0;\n            y = ry;\n        } else {\n            hideNextSpace = false;\n            if (x === 0) {\n                y += unit * 0.3;\n            }\n            block.setPosition(new Point(x, y));\n            palette.addContents(block);\n            if (block instanceof ToggleMorph\n                    || (block instanceof RingMorph)) {\n                x = block.right() + unit / 2;\n                ry = block.bottom();\n            } else {\n                x = 0;\n                y += block.height();\n            }\n        }\n    });\n\n    // global custom blocks:\n\n    if (stage) {\n        y += unit * 1.6;\n\n        stage.globalBlocks.forEach(definition => {\n            var block;\n            if (definition.category === category ||\n                    (category === 'variables'\n                        && contains(\n                            ['lists', 'other'],\n                            definition.category\n                        ))) {\n                block = definition.templateInstance();\n                y += unit * 0.3;\n                block.setPosition(new Point(x, y));\n                palette.addContents(block);\n                x = 0;\n                y += block.height();\n            }\n        });\n    }\n\n    // local custom blocks:\n\n    y += unit * 1.6;\n    this.customBlocks.forEach(definition => {\n        var block;\n        if (definition.category === category ||\n                (category === 'variables'\n                    && contains(\n                        ['lists', 'other'],\n                        definition.category\n                    ))) {\n            block = definition.templateInstance();\n            y += unit * 0.3;\n            block.setPosition(new Point(x, y));\n            palette.addContents(block);\n            x = 0;\n            y += block.height();\n        }\n    });\n\n    // inherited custom blocks:\n\n    // y += unit * 1.6;\n    if (this.exemplar) {\n        this.inheritedBlocks(true).forEach(definition => {\n            var block;\n            if (definition.category === category ||\n                    (category === 'variables'\n                        && contains(\n                            ['lists', 'other'],\n                            definition.category\n                        ))) {\n                block = definition.templateInstance();\n                y += unit * 0.3;\n                block.setPosition(new Point(x, y));\n                palette.addContents(block);\n                block.ghost();\n                x = 0;\n                y += block.height();\n            }\n        });\n    }\n\n    //layout\n\n    palette.scrollX(palette.padding);\n    palette.scrollY(palette.padding);\n    return palette;\n};\n\n// SpriteMorph blocks searching\n\nSpriteMorph.prototype.blocksMatching = function (\n    searchString,\n    strictly,\n    types, // optional, ['hat', 'command', 'reporter', 'predicate']\n    varNames // optional, list of reachable unique variable names\n) {\n    // answer an array of block templates whose spec contains\n    // the given search string, ordered by descending relevance\n    // types is an optional array containing block types the search\n    // is limited to, e.g. \"command\", \"hat\", \"reporter\", \"predicate\".\n    // Note that \"predicate\" is not subsumed by \"reporter\" and has\n    // to be specified explicitly.\n    // if no types are specified all blocks are searched\n    var blocks = [],\n        blocksDict,\n        search = searchString.toLowerCase(),\n        stage = this.parentThatIsA(StageMorph),\n        reporterized;\n\n    if (!types || !types.length) {\n        types = ['hat', 'command', 'reporter', 'predicate', 'ring'];\n    }\n    if (!varNames) {varNames = []; }\n\n    function labelOf(aBlockSpec) {\n        var words = (BlockMorph.prototype.parseSpec(aBlockSpec)),\n            filtered = words.filter(each => each.indexOf('%') !== 0);\n        return filtered.join(' ');\n    }\n\n    function fillDigits(anInt, totalDigits, fillChar) {\n        var ans = String(anInt);\n        while (ans.length < totalDigits) {ans = fillChar + ans; }\n        return ans;\n    }\n\n    function relevance(aBlockLabel, aSearchString) {\n        var lbl = ' ' + aBlockLabel,\n            idx = lbl.indexOf(aSearchString),\n            atWord;\n        if (idx === -1) {return -1; }\n        atWord = (lbl.charAt(idx - 1) === ' ');\n        if (strictly && !atWord) {return -1; }\n        return (atWord ? '1' : '2') + fillDigits(idx, 4, '0');\n    }\n\n    function primitive(selector) {\n        var newBlock = SpriteMorph.prototype.blockForSelector(selector, true);\n        newBlock.isTemplate = true;\n        return newBlock;\n    }\n\n    // variable getters\n    varNames.forEach(vName => {\n        var rel = relevance(labelOf(vName.toLowerCase()), search);\n        if (rel !== -1) {\n            blocks.push([this.variableBlock(vName), rel + '1']);\n        }\n    });\n    // custom blocks\n    [this.customBlocks, stage.globalBlocks].forEach(blocksList =>\n        blocksList.forEach(definition => {\n            if (contains(types, definition.type)) {\n                var spec = definition.localizedSpec().toLowerCase(),\n                    rel = relevance(labelOf(spec), search);\n                if (rel !== -1) {\n                    blocks.push([definition.templateInstance(), rel + '2']);\n                }\n            }\n        })\n    );\n    // primitives\n    blocksDict = SpriteMorph.prototype.blocks;\n    Object.keys(blocksDict).forEach(selector => {\n        if (!StageMorph.prototype.hiddenPrimitives[selector] &&\n                contains(types, blocksDict[selector].type)) {\n            var block = blocksDict[selector],\n                spec = localize(block.alias || block.spec).toLowerCase(),\n                rel = relevance(labelOf(spec), search);\n            if (\n                (rel !== -1) &&\n                    (!block.dev) &&\n                    (!block.only || (block.only === this.constructor))\n            ) {\n                blocks.push([primitive(selector), rel + '3']);\n            }\n        }\n    });\n    // infix arithmetic expression\n    if (contains(types, 'reporter')) {\n        reporterized = this.reporterize(searchString);\n        if (reporterized) {\n            // reporterized.isTemplate = true;\n            // reporterized.isDraggable = false;\n            blocks.push([reporterized, '']);\n        }\n    }\n    blocks.sort((x, y) => x[1] < y[1] ? -1 : 1);\n    return blocks.map(each => each[0]);\n};\n\nSpriteMorph.prototype.searchBlocks = function (\n    searchString,\n    types,\n    varNames,\n    scriptFocus\n) {\n    var myself = this,\n        unit = SyntaxElementMorph.prototype.fontSize,\n        ide = this.parentThatIsA(IDE_Morph),\n        oldSearch = '',\n        searchBar = new InputFieldMorph(searchString || ''),\n        searchPane = ide.createPalette('forSearch'),\n        blocksList = [],\n        selection,\n        focus;\n\n    function showSelection() {\n        if (focus) {focus.destroy(); }\n        if (!selection || !scriptFocus) {return; }\n        focus = selection.outline(\n            MorphicPreferences.isFlat ? new Color(150, 200, 255) : WHITE,\n            2\n        );\n        searchPane.contents.add(focus);\n        focus.scrollIntoView();\n    }\n\n    function show(blocks) {\n        var x = searchPane.contents.left() + 5,\n            y = (searchBar.bottom() + unit);\n        blocksList = blocks;\n        selection = null;\n        if (blocks.length && scriptFocus) {\n            selection = blocks[0];\n        }\n        searchPane.contents.children = [searchPane.contents.children[0]];\n        blocks.forEach(block => {\n            block.setPosition(new Point(x, y));\n            searchPane.addContents(block);\n            y += block.height();\n            y += unit * 0.3;\n        });\n        showSelection();\n        searchPane.changed();\n    }\n\n    searchPane.owner = this;\n    searchPane.color = this.paletteColor;\n    searchPane.contents.color = this.paletteColor;\n    searchPane.addContents(searchBar);\n    searchBar.setWidth(ide.logo.width() - 30);\n    searchBar.contrast = 90;\n    searchBar.setPosition(\n        searchPane.contents.topLeft().add(new Point(10, 10))\n    );\n    searchBar.fixLayout();\n\n    searchPane.accept = function () {\n        var search;\n        if (scriptFocus) {\n            searchBar.cancel();\n            if (selection) {\n                scriptFocus.insertBlock(selection);\n            }\n        } else {\n            search = searchBar.getValue();\n            if (search.length > 0) {\n                show(myself.blocksMatching(search));\n            }\n        }\n    };\n\n    searchPane.reactToKeystroke = function (evt) {\n        var idx, code = evt ? evt.keyCode : 0;\n        switch (code) {\n        case 38: // up arrow\n            if (!scriptFocus || !selection) {return; }\n            idx = blocksList.indexOf(selection) - 1;\n            if (idx < 0) {\n                idx = blocksList.length - 1;\n            }\n            selection = blocksList[idx];\n            showSelection();\n            return;\n        case 40: // down arrow\n            if (!scriptFocus || !selection) {return; }\n            idx = blocksList.indexOf(selection) + 1;\n            if (idx >= blocksList.length) {\n                idx = 0;\n            }\n            selection = blocksList[idx];\n            showSelection();\n            return;\n        default:\n            nop();\n        }\n    };\n\n    searchPane.reactToInput = function (evt) {\n        var search = searchBar.getValue();\n        if (search !== oldSearch) {\n            oldSearch = search;\n            show(myself.blocksMatching(\n                search,\n                search.length < 2,\n                types,\n                varNames\n            ));\n        }\n    };\n\n    searchBar.cancel = function () {\n        ide.refreshPalette();\n        ide.palette.adjustScrollBars();\n    };\n\n    ide.fixLayout('refreshPalette');\n    searchBar.edit();\n    if (searchString) {searchPane.reactToKeystroke(); }\n};\n\n// SpritMorph parsing simple arithmetic expressions to reporter blocks\n\nSpriteMorph.prototype.reporterize = function (expressionString) {\n    // highly experimental Christmas Easter Egg 2016 :-)\n    var ast;\n\n    function parseInfix(expression, operator, already) {\n        // very basic diadic infix parser for arithmetic expressions\n        // with strict left-to-right operator precedence (as in Smalltalk)\n        // which can be overriden by - nested - parentheses.\n        // assumes well-formed expressions, no graceful error handling yet.\n\n        var inputs = ['', ''],\n            idx = 0,\n            ch;\n\n        function format(value) {\n            return value instanceof Array || isNaN(+value) ? value : +value;\n        }\n\n        function nested() {\n            var level = 1,\n                expr = '';\n            while (idx < expression.length) {\n                ch = expression[idx];\n                idx += 1;\n                switch (ch) {\n                case '(':\n                    level += 1;\n                    break;\n                case ')':\n                    level -= 1;\n                    if (!level) {\n                        return expr;\n                    }\n                    break;\n                }\n                expr += ch;\n            }\n        }\n\n        while (idx < expression.length) {\n            ch = expression[idx];\n            idx += 1;\n            switch (ch) {\n            case ' ':\n                break;\n            case '(':\n                if (inputs[operator ? 1 : 0].length) {\n                    inputs[operator ? 1 : 0] = [\n                        inputs[operator ? 1 : 0],\n                        parseInfix(nested())\n                    ];\n                } else {\n                    inputs[operator ? 1 : 0] = parseInfix(nested());\n                }\n                break;\n            case '-':\n            case '+':\n            case '*':\n            case '/':\n            case '%':\n            case '^':\n            case '=':\n            case '<':\n            case '>':\n            case '&':\n            case '|':\n                if (!operator && !inputs[0].length) {\n                    inputs[0] = ch;\n                } else if (operator) {\n                    if (!inputs[1].length) {\n                        inputs[1] = ch;\n                    } else {\n                        return parseInfix(\n                            expression.slice(idx),\n                            ch,\n                            [operator, already, format(inputs[1])]\n                        );\n                    }\n                } else {\n                    operator = ch;\n                    already = format(inputs[0]);\n                }\n                break;\n            default:\n                inputs[operator ? 1 : 0] += ch;\n            }\n        }\n        if (operator) {\n            return [operator, already, format(inputs[1])];\n        }\n        return format(inputs[0]);\n    }\n\n    function blockFromAST(ast) {\n        var block, selectors, monads, alias, key, sel, i, inps,\n            off = 1,\n            reverseDict = {};\n        selectors = {\n            '+': 'reportSum',\n            '-': 'reportDifference',\n            '*': 'reportProduct',\n            '/': 'reportQuotient',\n            '%': 'reportModulus',\n            '^': 'reportPower',\n            '=': 'reportEquals',\n            '<': 'reportLessThan',\n            '>': 'reportGreaterThan',\n            '&': 'reportAnd',\n            '|': 'reportOr',\n            round: 'reportRound',\n            not: 'reportNot'\n        };\n        monads = ['abs', 'neg', 'ceiling', 'floor', 'sqrt', 'sin', 'cos',\n            'tan', 'asin', 'acos', 'atan', 'ln', 'log', 'lg', 'id', 'round',\n            'not'];\n        alias = {\n            ceil: 'ceiling',\n            '!' : 'not',\n            '-' : 'neg'\n        };\n        monads.concat(['true', 'false']).forEach(word =>\n            reverseDict[localize(word).toLowerCase()] = word\n        );\n        key = alias[ast[0]] || reverseDict[ast[0].toLowerCase()] || ast[0];\n        if (contains(monads, key)) { // monadic\n            sel = selectors[key];\n            if (sel) { // single input\n                block = SpriteMorph.prototype.blockForSelector(sel);\n                inps = block.inputs();\n            } else { // two inputs, first is function name\n                block = SpriteMorph.prototype.blockForSelector('reportMonadic');\n                inps = block.inputs();\n                inps[0].setContents([key]);\n                off = 0;\n            }\n        } else { // dyadic\n            block = SpriteMorph.prototype.blockForSelector(selectors[key]);\n            inps = block.inputs();\n        }\n        for (i = 1; i < ast.length; i += 1) {\n            if (ast[i] instanceof Array) {\n                block.replaceInput(inps[i - off], blockFromAST(ast[i]));\n            } else if (isString(ast[i])) {\n                if (contains(\n                    ['true', 'false'], reverseDict[ast[i]] || ast[i])\n                ) {\n                    block.replaceInput(\n                        inps[i - off],\n                        SpriteMorph.prototype.blockForSelector(\n                            (reverseDict[ast[i]] || ast[i]) === 'true' ?\n                                    'reportTrue' : 'reportFalse'\n                        )\n                    );\n                } else if (ast[i] !== '_') {\n                    block.replaceInput(\n                        inps[i - off],\n                        SpriteMorph.prototype.variableBlock(ast[i])\n                    );\n                }\n            } else { // number\n                inps[i - off].setContents(ast[i]);\n            }\n        }\n        block.isDraggable = true;\n        block.fixLayout();\n        block.fixBlockColor(null, true);\n        return block;\n    }\n\n    if (expressionString.length > 100) {return null; }\n    try {\n        ast = parseInfix(expressionString);\n        return ast instanceof Array ? blockFromAST(ast) : null;\n    } catch (error) {\n        return null;\n    }\n};\n\n// SpriteMorph variable management\n\nSpriteMorph.prototype.addVariable = function (name, isGlobal) {\n    // Trace.log('Sprite.addVariable', name);\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (isGlobal) {\n        this.globalVariables().addVar(name);\n        if (ide) {\n            ide.flushBlocksCache('variables');\n        }\n    } else {\n        this.variables.addVar(name);\n        this.blocksCache.variables = null;\n    }\n};\n\nSpriteMorph.prototype.deleteVariable = function (varName) {\n    // Trace.log('Sprite.deleteVariable', varName);\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (!contains(this.inheritedVariableNames(true), varName)) {\n        // check only shadowed variables\n        this.deleteVariableWatcher(varName);\n    }\n    this.variables.deleteVar(varName);\n    if (ide) {\n        ide.flushBlocksCache('variables'); // b/c the var could be global\n        ide.refreshPalette();\n    }\n};\n\n// SpriteMorph costume management\n\nSpriteMorph.prototype.addCostume = function (costume) {\n    if (!costume.name) {\n        costume.name = 'costume' + (this.costumes.length() + 1);\n    }\n    this.shadowAttribute('costumes');\n    this.costumes.add(costume);\n};\n\nSpriteMorph.prototype.wearCostume = function (costume, noShadow) {\n    var x = this.xPosition ? this.xPosition() : null,\n        y = this.yPosition ? this.yPosition() : null,\n        idx = isNil(costume) ? null : this.costumes.asArray().indexOf(costume);\n\n    this.changed();\n    this.costume = costume;\n    this.fixLayout();\n    this.rerender();\n    if (x !== null) {\n        this.silentGotoXY(x, y, true); // just me\n    }\n    if (this.positionTalkBubble) { // the stage doesn't talk\n        this.positionTalkBubble();\n    }\n    this.version = Date.now();\n\n    // propagate to children that inherit my costume #\n    if (!noShadow) {\n        this.shadowAttribute('costume #');\n    }\n    this.specimens().forEach(instance => {\n        if (instance.cachedPropagation) {\n            if (instance.inheritsAttribute('costume #')) {\n                if (idx === null) {\n                    instance.wearCostume(null, true);\n                } else if (idx === -1) {\n                    instance.wearCostume(costume, true);\n                } else {\n                    instance.doSwitchToCostume(idx + 1, true);\n                }\n            }\n        }\n    });\n};\n\nSpriteMorph.prototype.getCostumeIdx = function () {\n    if (this.inheritsAttribute('costume #')) {\n        return this.exemplar.getCostumeIdx();\n    }\n    return this.costumes.asArray().indexOf(this.costume) + 1;\n};\n\nSpriteMorph.prototype.doWearNextCostume = function () {\n    var arr = this.costumes.asArray(),\n        idx;\n    if (arr.length > 1) {\n        idx = arr.indexOf(this.costume);\n        if (idx > -1) {\n            idx += 1;\n            if (idx > (arr.length - 1)) {\n                idx = 0;\n            }\n            this.wearCostume(arr[idx]);\n        }\n    }\n};\n\nSpriteMorph.prototype.doWearPreviousCostume = function () {\n    var arr = this.costumes.asArray(),\n        idx;\n    if (arr.length > 1) {\n        idx = arr.indexOf(this.costume);\n        if (idx > -1) {\n            idx -= 1;\n            if (idx < 0) {\n                idx = arr.length - 1;\n            }\n            this.wearCostume(arr[idx]);\n        }\n    }\n};\n\nSpriteMorph.prototype.doSwitchToCostume = function (id, noShadow) {\n    var w = 0, h = 0;\n    if (id instanceof List) { // try to turn a list of pixels into a costume\n        if (this.costume) {\n            // recycle dimensions of current costume\n            w = this.costume.width();\n            h = this.costume.height();\n        }\n        if (w * h !== id.length()) {\n            // assume stage's dimensions\n            w = StageMorph.prototype.dimensions.x;\n            h = StageMorph.prototype.dimensions.y;\n        }\n        id = Process.prototype.reportNewCostume(\n            id,\n            w,\n            h,\n            this.newCostumeName(localize('snap'))\n        );\n    }\n    if (id instanceof Costume) { // allow first-class costumes\n        this.wearCostume(id, noShadow);\n        return;\n    }\n    if (id instanceof Array && (id[0] === 'current')) {\n        return;\n    }\n\n    var num,\n        arr = this.costumes.asArray(),\n        costume;\n    if (\n        contains(\n            [localize('Turtle'), localize('Empty')],\n            (id instanceof Array ? id[0] : null)\n        )\n    ) {\n        costume = null;\n    } else {\n        if (id === -1) {\n            this.doWearPreviousCostume();\n            return;\n        }\n        costume = detect(arr, cst => cst.name === id);\n        if (costume === null) {\n            num = parseFloat(id);\n            if (num === 0) {\n                costume = null;\n            } else {\n                costume = arr[num - 1] || null;\n            }\n        }\n    }\n    this.wearCostume(costume, noShadow);\n};\n\nSpriteMorph.prototype.reportCostumes = function () {\n    return this.costumes;\n};\n\n// SpriteMorph sound management\n\nSpriteMorph.prototype.addSound = function (audio, name) {\n    var sound = new Sound(audio, name);\n    this.shadowAttribute('sounds');\n    this.sounds.add(sound);\n    return sound;\n};\n\nSpriteMorph.prototype.doPlaySound = function (name) {\n    var stage = this.parentThatIsA(StageMorph),\n        sound = name instanceof Sound ? name\n            : (typeof name === 'number' ? this.sounds.at(name)\n                : detect(\n                    this.sounds.asArray(),\n                    s => s.name === name.toString()\n            )),\n        ctx = this.audioContext(),\n        gain =  this.getGainNode(),\n        pan = this.getPannerNode(),\n        aud,\n        source;\n    if (sound) {\n        aud = document.createElement('audio');\n        aud.src = sound.audio.src;\n        ctx.resume(); // needed to fix tainted context in case of autoplay\n        source = ctx.createMediaElementSource(aud);\n        source.connect(gain);\n        if (pan) {\n            gain.connect(pan);\n            pan.connect(ctx.destination); // perhaps redundant\n            this.setPan(this.getPan()); // yep, should be redundant\n        } else {\n            gain.connect(ctx.destination);\n        }\n        this.setVolume(this.getVolume()); // probably redundant as well\n        aud.play();\n        if (stage) {\n            stage.activeSounds.push(aud);\n            stage.activeSounds = stage.activeSounds.filter(snd =>\n                !snd.ended && !snd.terminated\n            );\n        }\n        return aud;\n    }\n};\n\nSpriteMorph.prototype.reportSounds = function () {\n    return this.sounds;\n};\n\n// SpriteMorph volume\n\nSpriteMorph.prototype.setVolume = function (num, noShadow) {\n    this.volume = Math.max(Math.min(+num || 0, 100), 0);\n    this.getGainNode().gain.setValueAtTime(\n        1 / Math.pow(10, Math.log2(100 / this.volume)),\n        this.audioContext().currentTime\n    );\n    if (this instanceof StageMorph) {\n        return;\n    }\n    // propagate to children that inherit my volume\n    if (!noShadow) {\n        this.shadowAttribute('volume');\n    }\n    this.instances.forEach(instance => {\n        if (instance.cachedPropagation) {\n            if (instance.inheritsAttribute('volume')) {\n                instance.setVolume(num, true);\n            }\n        }\n    });\n};\n\nSpriteMorph.prototype.changeVolume = function (delta) {\n    this.setVolume(this.getVolume() + (+delta || 0));\n};\n\nSpriteMorph.prototype.getVolume = function () {\n    if (this.inheritsAttribute('volume')) {\n        return this.exemplar.getVolume();\n    }\n    return this.volume;\n};\n\nSpriteMorph.prototype.getGainNode = function () {\n    if (!this.gainNode) {\n        this.gainNode = this.audioContext().createGain();\n    }\n    return this.gainNode;\n};\n\nSpriteMorph.prototype.audioContext = function () {\n    return Note.prototype.getAudioContext();\n};\n\n// SpriteMorph stero panning\n\nSpriteMorph.prototype.setPan = function (num, noShadow) {\n    var panner = this.getPannerNode();\n    if (!panner) {return; }\n    this.pan = Math.max(Math.min((+num || 0), 100), -100);\n    panner.pan.setValueAtTime(\n        this.pan / 100,\n        this.audioContext().currentTime\n    );\n    if (this instanceof StageMorph) {\n        return;\n    }\n    // propagate to children that inherit my balance\n    if (!noShadow) {\n        this.shadowAttribute('balance');\n    }\n    this.instances.forEach(instance => {\n        if (instance.cachedPropagation) {\n            if (instance.inheritsAttribute('balance')) {\n                instance.setPan(num, true);\n            }\n        }\n    });\n};\n\nSpriteMorph.prototype.changePan = function (delta) {\n    this.setPan(this.getPan() + (+delta || 0));\n};\n\nSpriteMorph.prototype.getPan = function () {\n    if (this.inheritsAttribute('balance')) {\n        return this.exemplar.getPan();\n    }\n    return this.pan;\n};\n\nSpriteMorph.prototype.getPannerNode = function () {\n    var ctx;\n    if (!this.pannerNode) {\n        ctx = this.audioContext();\n        if (ctx.createStereoPanner) {\n            this.pannerNode = this.audioContext().createStereoPanner();\n        }\n    }\n    return this.pannerNode;\n};\n\n// SpriteMorph frequency player\n\nSpriteMorph.prototype.playFreq = function (hz) {\n    // start playing the given frequency until stopped\n    var note,\n        ctx = this.audioContext(),\n        gain = this.getGainNode(),\n        pan = this.getPannerNode(),\n        stage = this.parentThatIsA(StageMorph);\n    if (!this.freqPlayer) {\n        this.freqPlayer = new Note();\n    }\n    note = this.freqPlayer;\n    note.fader = ctx.createGain();\n    if (note.oscillator) {\n        note.oscillator.frequency.value = hz;\n    } else {\n        note.oscillator = ctx.createOscillator();\n        if (!note.oscillator.start) {\n            note.oscillator.start = note.oscillator.noteOn;\n        }\n        if (!note.oscillator.stop) {\n            note.oscillator.stop = note.oscillator.noteOff;\n        }\n        note.setInstrument(this.instrument);\n        note.oscillator.frequency.value = hz;\n        this.setVolume(this.getVolume());\n        note.oscillator.connect(note.fader);\n        note.fader.connect(gain);\n        if (pan) {\n            gain.connect(pan);\n            pan.connect(ctx.destination);\n            this.setPan(this.pan);\n        } else {\n            gain.connect(ctx.destination);\n        }\n        note.ended = false;\n        if (stage) {\n            stage.activeSounds.push(note);\n            stage.activeSounds = stage.activeSounds.filter(snd =>\n                !snd.ended && !snd.terminated\n            );\n        }\n        note.fader.gain.setValueCurveAtTime(\n            note.fadeIn,\n            ctx.currentTime,\n            note.fadeTime\n        );\n        note.oscillator.start(0);\n    }\n};\n\nSpriteMorph.prototype.stopFreq = function () {\n    if (this.freqPlayer) {\n        this.freqPlayer.stop();\n    }\n};\n\n// SpriteMorph user menu\n\nSpriteMorph.prototype.userMenu = function () {\n    var ide = this.parentThatIsA(IDE_Morph),\n        menu = new MenuMorph(this),\n        allParts,\n        anchors;\n\n    if (ide && ide.isAppMode) {\n        // menu.addItem('help', 'nop');\n        return menu;\n    }\n    if (!this.isTemporary) {\n        menu.addItem(\"duplicate\", 'duplicate');\n        if (StageMorph.prototype.enableInheritance) {\n            menu.addItem(\"clone\", 'instantiate');\n            menu.addLine();\n        }\n    }\n    menu.addItem(\"delete\", 'remove');\n    menu.addItem(\"move\", 'moveCenter');\n    menu.addItem(\"rotate\", 'setRotation');\n    if (this.costume) {\n        menu.addItem(\n            \"pivot\",\n            'moveRotationCenter',\n            'edit the costume\\'s\\nrotation center'\n        );\n    }\n    if (this.isTemporary) {\n        if (StageMorph.prototype.enableInheritance) {\n            menu.addItem(\n                \"edit\",\n                'perpetuateAndEdit',\n                'make permanent and\\nshow in the sprite corral'\n            );\n        }\n    } else {\n        menu.addItem(\"edit\", 'edit');\n    }\n    menu.addLine();\n    if (this.anchor) {\n        menu.addItem(\n            localize('detach from') + ' ' + this.anchor.name,\n            'detachFromAnchor'\n        );\n    } else {\n        allParts = this.allParts();\n        anchors = this.parent.children.filter(morph =>\n            morph instanceof SpriteMorph && !contains(allParts, morph)\n        );\n        if (anchors.length) {\n            menu.addMenu('stick to', this.anchorsMenu(anchors));\n        }\n    }\n    if (this.parts.length) {\n        menu.addItem('detach all parts', 'detachAllParts');\n    }\n    menu.addItem(\"export...\", 'exportSprite');\n    return menu;\n};\n\nSpriteMorph.prototype.anchorsMenu = function (targets) {\n    var menu = new MenuMorph(this.attachTo, null, this);\n    targets.forEach(sprite =>\n        menu.addItem(\n            [\n                sprite.thumbnail(new Point(24, 24)),\n                sprite.name,\n            ],\n            sprite\n        )\n    );\n    return menu;\n};\n\nSpriteMorph.prototype.exportSprite = function () {\n    if (this.isTemporary) {return; }\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (ide) {\n        ide.exportSprite(this);\n    }\n};\n\nSpriteMorph.prototype.edit = function () {\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (ide && !ide.isAppMode) {\n        ide.selectSprite(this);\n    }\n};\n\nSpriteMorph.prototype.showOnStage = function () {\n    var stage = this.parentThatIsA(StageMorph);\n    if (stage) {\n        this.keepWithin(stage);\n        stage.add(this);\n    }\n    this.show();\n};\n\nSpriteMorph.prototype.duplicate = function () {\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (ide) {\n        ide.duplicateSprite(this);\n    }\n};\n\nSpriteMorph.prototype.instantiate = function () {\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (ide) {\n        ide.instantiateSprite(this);\n    }\n};\n\nSpriteMorph.prototype.remove = function () {\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (ide) {\n        ide.removeSprite(this);\n    }\n};\n\n// SpriteMorph cloning\n\n/*\n    clones are temporary, partially shallow copies of sprites that don't\n    appear as icons in the corral. Clones get deleted when the red stop button\n    is pressed. Shallow-copying clones' scripts and costumes makes spawning\n    very fast, so they can be used for particle system simulations.\n    This speed-up, however, comes at the cost of some detrimental side\n    effects: Changes to a costume or a script of the original sprite are\n    in some cases shared with all of its clones, however such shared changes\n    are hard to predict for users and not actively propagated, so they don't\n    offer any reliable feature, and will not be supported as such.\n    Changes to the original sprite's scripts affect all of its clones, unless\n    the script contains any custom block whose definition contains one or more\n    block variables (in which case the script does get deep-copied).\n    The original sprite's scripting area, costumes wardrobe or sounds jukebox\n    are also not shared. therefore adding or deleting a script, sound or\n    costume in the original sprite has no effect on any of its clones.\n*/\n\nSpriteMorph.prototype.createClone = function (immediately) {\n    var stage = this.parentThatIsA(StageMorph),\n        clone;\n    if (stage && stage.cloneCount <= 5000) {\n        clone = this.fullCopy(true);\n        clone.clonify(stage, immediately);\n    }\n    return clone;\n};\n\nSpriteMorph.prototype.newClone = function (immediately) {\n    var clone = this.createClone(immediately);\n    if (isNil(clone)) {\n        throw new Error('exceeding maximum number of clones');\n    }\n    return clone;\n};\n\nSpriteMorph.prototype.clonify = function (stage, immediately) {\n    var hats;\n    this.parts.forEach(part => part.clonify(stage));\n    stage.cloneCount += 1;\n    this.cloneOriginName = this.isTemporary ?\n            this.cloneOriginName : this.name;\n    this.isTemporary = true;\n    this.name = '';\n    stage.add(this);\n    hats = this.allHatBlocksFor('__clone__init__');\n    hats.forEach(block =>\n        stage.threads.startProcess(\n            block,\n            this,\n            stage.isThreadSafe,\n            null, // export result\n            null, // callback\n            null, // is clicked\n            immediately // without yielding\n        )\n    );\n    this.endWarp();\n};\n\nSpriteMorph.prototype.initClone = function (hats) {\n    // used when manually instantiating a sprite in the IDE\n    var stage = this.parentThatIsA(StageMorph);\n    if (stage) {\n        hats.forEach(block =>\n            stage.threads.startProcess(\n                block,\n                this,\n                stage.isThreadSafe\n            )\n        );\n        this.endWarp();\n    }\n};\n\nSpriteMorph.prototype.removeClone = function () {\n    var exemplar = this.exemplar;\n    if (this.isTemporary) {\n        // this.stopTalking();\n        this.parent.threads.stopAllForReceiver(this);\n        this.parts.slice().forEach(part => {\n        \tthis.detachPart(part);\n            part.removeClone();\n        });\n        this.corpsify();\n        this.instances.forEach(child => {\n            if (child.isTemporary) {\n                child.setExemplar(exemplar);\n            }\n        });\n        this.destroy();\n        this.parent.cloneCount -= 1;\n    }\n};\n\nSpriteMorph.prototype.perpetuate = function () {\n    // make a temporary sprite (clone) permanent\n    var stage = this.parentThatIsA(StageMorph),\n        ide = this.parentThatIsA(IDE_Morph);\n\n\t// make sure my exemplar-chain is fully perpetuated\n    if (this.exemplar) {\n        this.exemplar.perpetuate();\n    }\n    if (!this.isTemporary || !stage || !ide) {\n        return;\n    }\n    this.isTemporary = false;\n    this.name = ide.newSpriteName(this.cloneOriginName);\n    this.cloneOriginName = '';\n    stage.cloneCount -= 1;\n    ide.corral.addSprite(this);\n    ide.sprites.add(this);\n    this.parts.forEach(part => part.perpetuate());\n};\n\nSpriteMorph.prototype.perpetuateAndEdit = function () {\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (ide) {\n        this.perpetuate();\n        ide.selectSprite(this);\n    }\n};\n\nSpriteMorph.prototype.release = function () {\n    // turn a permenent sprite that's an instance of another one\n    // into a temporary one (clone), that will vanish either when\n    // the \"delete this clone\" operation is executed or when the user\n    // hits the red stop sign button in the IDE\n    var stage = this.parentThatIsA(StageMorph),\n        ide = this.parentThatIsA(IDE_Morph),\n        idx;\n\n    if (this.isTemporary || !this.exemplar || !stage || !ide) {\n        return;\n    }\n\n\t// make sure all parts and instances are also released\n    this.parts.forEach(part => part.release());\n    this.instances.forEach(inst => inst.release());\n    this.isTemporary = true;\n    this.name = '';\n    this.cloneOriginName = this.exemplar.name;\n    stage.cloneCount += 1;\n    idx = ide.sprites.asArray().indexOf(this) + 1;\n    stage.watchers().forEach(watcher => {\n        if (watcher.object() === this) {\n            watcher.destroy();\n        }\n    });\n    if (idx > 0) {\n        ide.sprites.remove(idx);\n    }\n    ide.createCorral();\n    ide.fixLayout();\n    if (ide.currentSprite === this) {\n        ide.currentSprite = detect(\n            stage.children,\n            morph => morph instanceof SpriteMorph && !morph.isTemporary\n        ) || this.stage;\n    }\n    ide.selectSprite(ide.currentSprite);\n    if (ide.isAppMode) {\n        ide.toggleAppMode(true);\n    }\n};\n\n// SpriteMorph deleting\n\nSpriteMorph.prototype.corpsify = function () {\n    this.isCorpse = true;\n    this.version = Date.now();\n};\n\n// SpriteMorph primitives\n\n// SpriteMorph hiding and showing:\n\n/*\n    override the inherited behavior to also hide/show all\n    nested parts.\n*/\n\nSpriteMorph.prototype.show = function () {\n    this.setVisibility(true);\n};\n\nSpriteMorph.prototype.hide = function () {\n    this.setVisibility(false);\n};\n\nSpriteMorph.prototype.setVisibility = function (bool, noShadow) {\n    var bubble = this.talkBubble();\n\n    if (bool) {\n        SpriteMorph.uber.show.call(this);\n    } else {\n        SpriteMorph.uber.hide.call(this);\n    }\n\n    // propagate to speech bubble, if any\n    if (bubble) {\n        if (bool) {\n            bubble.show();\n        } else {\n            bubble.hide();\n        }\n    }\n\n    // progagate to parts\n    this.parts.forEach(part => part.setVisibility(bool));\n\n    // propagate to children that inherit my visibility\n    if (!noShadow) {\n        this.shadowAttribute('shown?');\n    }\n    this.instances.forEach(instance => {\n        if (instance.cachedPropagation) {\n            if (instance.inheritsAttribute('shown?')) {\n                instance.setVisibility(bool, true);\n            }\n        }\n    });\n};\n\nSpriteMorph.prototype.reportShown = function () {\n    if (this.inheritsAttribute('shown?')) {\n        return this.exemplar.reportShown();\n    }\n    return this.isVisible;\n};\n\n// SpriteMorph pen color\n\nSpriteMorph.prototype.setColorComponentHSVA = function (idx, num) {\n    var x = this.xPosition(),\n        y = this.yPosition(),\n        n = +num;\n\n    idx = +idx;\n    if (idx < 0 || idx > 3) {return; }\n    if (idx == 0) {\n        if (n < 0 || n > 100) { // wrap the hue\n            n = (n < 0 ? 100 : 0) + n % 100;\n        }\n    } else {\n        n = Math.min(100, Math.max(0, n));\n    }\n    if (idx === 3) {\n        this.color.a = 1 - n / 100;\n    } else {\n        this.cachedHSV[idx] = n / 100;\n        this.color.set_hsv.apply(this.color, this.cachedHSV);\n    }\n    if (!this.costume) {\n        this.rerender();\n    }\n    this.gotoXY(x, y);\n};\n\nSpriteMorph.prototype.getColorComponentHSLA = function (idx) {\n    idx = +idx;\n    if (idx === 3) {\n        return (1 - this.color.a) * 100;\n    }\n    return (this.cachedHSV[idx] || 0) * 100;\n};\n\nSpriteMorph.prototype.changeColorComponentHSVA = function (idx, delta) {\n    this.setColorComponentHSVA(\n        idx,\n        this.getColorComponentHSLA(idx) + (+delta || 0)\n    );\n};\n\nSpriteMorph.prototype.setColor = function (aColor) {\n    var x = this.xPosition(),\n        y = this.yPosition();\n    if (!this.color.eq(aColor, true)) { // observeAlpha\n        this.color = aColor.copy();\n        if (!this.costume) {\n            this.rerender();\n            this.silentGotoXY(x, y);\n        }\n        this.cachedHSV = this.color.hsv();\n    }\n};\n\nSpriteMorph.prototype.setBackgroundColor = SpriteMorph.prototype.setColor;\n\nSpriteMorph.prototype.getPenAttribute = function (attrib) {\n    var name = attrib instanceof Array ? attrib[0] : attrib.toString(),\n        options = ['hue', 'saturation', 'brightness', 'transparency'];\n    if (name === 'size') {\n        return this.size || 0;\n    }\n    return this.getColorComponentHSLA(options.indexOf(name));\n};\n\n// SpriteMorph layers\n\nSpriteMorph.prototype.comeToFront = function () {\n    if (this.parent) {\n        this.parent.add(this);\n        this.changed();\n    }\n};\n\nSpriteMorph.prototype.goToBack = function () {\n    if (this.parent) {\n        this.parent.addBack(this);\n        this.changed();\n    }\n};\n\nSpriteMorph.prototype.goBack = function (layers) {\n    var layer,\n        newLayer = +layers,\n        targetLayer;\n\n    if (!this.parent) {return null; }\n    layer = this.parent.children.indexOf(this);\n    this.parent.removeChild(this);\n    targetLayer = Math.max(layer - newLayer, 0);\n    this.parent.children.splice(targetLayer, null, this);\n    this.parent.changed();\n};\n\n// SpriteMorph collision detection\n\nSpriteMorph.prototype.reportTouchingColor = function (aColor) {\n    var stage = this.parentThatIsA(StageMorph),\n        data, len, i;\n\n    if (stage) {\n        data = this.overlappingPixels(stage);\n        if (!data) {return false; }\n        len = data[0].length;\n        for (i = 3; i < len; i += 4) {\n            if (data[0][i] && data[1][i]) {\n                if (\n                    data[1][i - 3] === aColor.r &&\n                    data[1][i - 2] === aColor.g &&\n                    data[1][i - 1] === aColor.b\n                ) {\n                    return true;\n                }\n            }\n        }\n    }\n    return false;\n};\n\nSpriteMorph.prototype.reportColorIsTouchingColor = function (\n    thisColor,\n    thatColor\n) {\n    var stage = this.parentThatIsA(StageMorph),\n        data, len, i;\n\n    if (stage) {\n        data = this.overlappingPixels(stage);\n        if (!data) {return false; }\n        len = data[0].length;\n        for (i = 3; i < len; i += 4) {\n            if (data[0][i] && data[1][i]) {\n                if (\n                    data[0][i - 3] === thisColor.r &&\n                    data[0][i - 2] === thisColor.g &&\n                    data[0][i - 1] === thisColor.b &&\n                    data[1][i - 3] === thatColor.r &&\n                    data[1][i - 2] === thatColor.g &&\n                    data[1][i - 1] === thatColor.b\n                ) {\n                    return true;\n                }\n            }\n        }\n    }\n    return false;\n};\n\nSpriteMorph.prototype.overlappingPixels = function (otherSprite) {\n    // overrides method from Morph because Sprites aren't nested Morphs\n    // the same applies for speech balloons, where it's enough to\n    // test the encompassing shape only\n    var oRect = this.bounds.intersect(otherSprite.bounds),\n        thisImg = this.getImage(),\n        thatImg = otherSprite.getImage();\n\n    if (otherSprite instanceof StageMorph) {\n        // only check for color collision\n        thatImg = otherSprite.fancyThumbnail(otherSprite.extent(), this, true);\n    }\n    if (oRect.width() < 1 || oRect.height() < 1 || !thisImg || !thatImg ||\n        !thisImg.width || !thisImg.height || !thatImg.width || !thatImg.height\n    ) {\n        return false;\n    }\n    if (thisImg.isRetinaEnabled !== thatImg.isRetinaEnabled) {\n        thisImg = normalizeCanvas(thisImg, true);\n        thatImg = normalizeCanvas(thatImg, true);\n    }\n    return [\n        thisImg.getContext(\"2d\").getImageData(\n            oRect.left() - this.left(),\n            oRect.top() - this.top(),\n            oRect.width(),\n            oRect.height()\n        ).data,\n        thatImg.getContext(\"2d\").getImageData(\n            oRect.left() - otherSprite.left(),\n            oRect.top() - otherSprite.top(),\n            oRect.width(),\n            oRect.height()\n        ).data\n    ];\n};\n\n// SpriteMorph neighbor detection\n\nSpriteMorph.prototype.neighbors = function (aStage) {\n    var stage = aStage || this.parentThatIsA(StageMorph),\n        myPerimeter = this.perimeter(stage);\n    return new List(\n        stage.children.filter(each => {\n            var eachPerimeter,\n                distance;\n            if (each instanceof SpriteMorph &&\n                each.isVisible &&\n                (each !== this)\n            ) {\n                eachPerimeter = each.perimeter(stage);\n                distance = myPerimeter.center.distanceTo(eachPerimeter.center);\n                return (distance - myPerimeter.radius - eachPerimeter.radius)\n                    < 0;\n            }\n            return false;\n        })\n    );\n};\n\nSpriteMorph.prototype.perimeter = function (aStage) {\n    var stage = aStage || this.parentThatIsA(StageMorph),\n        stageScale = this instanceof StageMorph ? 1 : stage.scale,\n        radius;\n    if (this.costume) {\n        radius = Math.max(\n            this.costume.width(),\n            this.costume.height()\n        ) * this.scale * stageScale;\n    } else {\n        radius = Math.max(this.width(), this.height());\n    }\n    return {\n        center: this.center(), // geometric center rather than position\n        radius: radius\n    };\n};\n\n// SpriteMorph pen ops\n\nSpriteMorph.prototype.doStamp = function () {\n    var stage = this.parent,\n        ctx = stage.penTrails().getContext('2d'),\n        img = this.getImage();\n\n    if (img.width < 1 || (img.height < 1)) {\n        // too small to draw\n        return;\n    }\n    ctx.save();\n    ctx.scale(1 / stage.scale, 1 / stage.scale);\n    ctx.globalAlpha = this.alpha;\n    ctx.drawImage(\n        img,\n        this.left() - stage.left(),\n        this.top() - stage.top()\n    );\n    ctx.restore();\n    this.changed();\n    stage.cachedPenTrailsMorph = null;\n};\n\nSpriteMorph.prototype.clear = function () {\n    this.parent.clearPenTrails();\n};\n\nSpriteMorph.prototype.write = function (text, size) {\n    // thanks to Michael Ball for contributing this code!\n    if (typeof text !== 'string' && typeof text !== 'number') {\n        throw new Error(\n            'LABEL can only draw text or numbers, not a ' +\n            typeof text\n        );\n    }\n\n    var stage = this.parentThatIsA(StageMorph),\n        context = stage.penTrails().getContext('2d'),\n        rotation = radians(this.direction() - 90),\n        trans = new Point(\n            this.rotationCenter().x - stage.left(),\n            this.rotationCenter().y - stage.top()\n        ),\n        len,\n        pos;\n\n    context.save();\n    context.font = size + 'px monospace';\n    context.textAlign = 'left';\n    context.textBaseline = 'alphabetic';\n    context.fillStyle = this.color.toString();\n    len = context.measureText(text).width;\n    trans = trans.multiplyBy(1 / stage.scale);\n    context.translate(trans.x, trans.y);\n    context.rotate(rotation);\n    context.fillText(text, 0, 0);\n    context.translate(-trans.x, -trans.y);\n    context.restore();\n    pos = new Point(\n        len * Math.sin(radians(this.direction())),\n        len * Math.cos(radians(this.direction()))\n    );\n    pos = pos.add(new Point(this.xPosition(), this.yPosition()));\n    this.gotoXY(pos.x, pos.y, false);\n    this.changed();\n    stage.changed();\n};\n\nSpriteMorph.prototype.setSize = function (size) {\n    // pen size\n    if (!isNaN(size)) {\n        this.size = Math.min(Math.max(+size, 0.0001), 1000);\n    }\n};\n\nSpriteMorph.prototype.changeSize = function (delta) {\n    this.setSize(this.size + (+delta || 0));\n};\n\n// SpriteMorph printing on another sprite:\n\nSpriteMorph.prototype.blitOn = function (target, mask = 'source-atop') {\n    // draw my costume onto a copy of the target's costume scaled and rotated\n    // so it appears as though I'm \"stamped\" onto it.\n\n    var sourceHeading = (this.rotationStyle === 1) ? this.heading : 90,\n        targetHeading = (target.rotationStyle === 1) ? target.heading : 90,\n        sourceCostume, targetCostume, ctx,\n        relRot, relScale, stageScale,\n        centerDist, centerDelta, centerAngleRadians, center,\n        originDist, originAngleRadians,\n        spriteCenter, thisCenter, relPos, pos;\n\n    // prevent pasting an object onto itself\n    if (this === target) {return; }\n\n    // check if both source and target have costumes,\n    // rasterize copy of target costume if it's an SVG\n    if (this.costume && target.costume) {\n        sourceCostume = this.costume;\n        if (sourceCostume instanceof SVG_Costume) {\n            sourceCostume = sourceCostume.rasterized();\n        }\n        if (target.costume instanceof SVG_Costume) {\n            targetCostume = target.costume.rasterized();\n        } else {\n            targetCostume = target.costume.copy();\n        }\n    } else {\n        return;\n    }\n\n    // do the math:\n    if (target instanceof SpriteMorph) {\n        if (this instanceof SpriteMorph) {\n            // stamp a sprite on a sprite:\n            relRot = sourceHeading - targetHeading;\n            relScale = this.scale / target.scale;\n            stageScale = this.parentThatIsA(StageMorph).scale;\n            centerDist = target.center().distanceTo(this.center());\n            centerDelta = this.center().subtract(target.center());\n            centerAngleRadians = Math.atan2(centerDelta.y, centerDelta.x);\n            center = new Point(\n                    sourceCostume.width(),\n                    sourceCostume.height()\n                ).multiplyBy(0.5 * this.scale * stageScale);\n            originDist = center.distanceTo(ZERO);\n            originAngleRadians = Math.atan2(center.y, center.x);\n            spriteCenter = new Point(\n                    target.costume.width(),\n                    target.costume.height()\n                ).multiplyBy(0.5 * target.scale * stageScale)\n                .rotateBy(radians(relRot));\n            thisCenter = spriteCenter.distanceAngle(\n                    centerDist,\n                    degrees(centerAngleRadians) - sourceHeading + 180\n                );\n            relPos = thisCenter.distanceAngle(\n                    originDist,\n                    degrees(originAngleRadians) -90\n                );\n            pos = relPos.divideBy(stageScale)\n                .divideBy(relScale)\n                .divideBy(target.scale);\n        } else { // if the stage is the source\n            // stamp the stage on a sprite:\n            relRot = 90 - targetHeading;\n            relScale = 1 / target.scale;\n            centerDist = target.center().distanceTo(this.position());\n            centerDelta = this.position().subtract(target.center());\n            centerAngleRadians = Math.atan2(centerDelta.y, centerDelta.x);\n            center = new Point(\n                    target.costume.width(),\n                    target.costume.height()\n                ).multiplyBy(0.5 * target.scale)\n                .rotateBy(radians(90 - targetHeading));\n            pos = center.distanceAngle(\n                    centerDist / this.scale,\n                    degrees(centerAngleRadians) + 90\n                );\n        }\n    } else { // if the stage is the target\n        // stamp a sprite on the stage:\n        relRot = sourceHeading - 90;\n        relScale = this.scale;\n        center = this.center().subtract(target.position())\n                .divideBy(this.scale * target.scale)\n                .rotateBy(radians(sourceHeading - 90));\n        pos = center.subtract(\n                new Point(\n                    sourceCostume.width(),\n                    sourceCostume.height()\n                ).multiplyBy(0.5)\n            );\n    }\n\n    // draw my costume onto the target's costume copy:\n    ctx = targetCostume.contents.getContext('2d');\n    ctx.rotate(radians(relRot));\n    ctx.scale(relScale, relScale);\n    ctx.globalCompositeOperation = mask;\n    ctx.drawImage(sourceCostume.contents, pos.x, pos.y);\n\n    // make the target wear the new costume\n    target.doSwitchToCostume(targetCostume);\n};\n\n// SpriteMorph pen up and down:\n\nSpriteMorph.prototype.down = function () {\n    this.setPenDown(true);\n};\n\nSpriteMorph.prototype.up = function () {\n    this.setPenDown(false);\n};\n\nSpriteMorph.prototype.setPenDown = function (bool, noShadow) {\n    if (bool) {\n        SpriteMorph.uber.down.call(this);\n    } else {\n        SpriteMorph.uber.up.call(this);\n    }\n\n    // propagate to children that inherit my visibility\n    if (!noShadow) {\n        this.shadowAttribute('pen down?');\n    }\n    this.instances.forEach(instance => {\n        if (instance.cachedPropagation) {\n            if (instance.inheritsAttribute('pen down?')) {\n                instance.setPenDown(bool, true);\n            }\n        }\n    });\n};\n\nSpriteMorph.prototype.getPenDown = function () {\n    if (this.inheritsAttribute('pen down?')) {\n        return this.exemplar.getPenDown();\n    }\n    return this.isDown;\n};\n\n// SpriteMorph scale\n\nSpriteMorph.prototype.getScale = function () {\n    // answer my scale in percent\n    if (this.inheritsAttribute('size')) {\n        return this.exemplar.getScale();\n    }\n    return this.scale * 100;\n};\n\nSpriteMorph.prototype.setScale = function (percentage, noShadow) {\n    // set my (absolute) scale in percent\n    var x = this.xPosition(),\n        y = this.yPosition(),\n        realScale,\n        growth;\n\n    realScale = (+percentage || 0) / 100;\n    growth = realScale / this.nestingScale;\n    this.nestingScale = realScale;\n    this.scale = Math.max(realScale, 0.01);\n\n    // apply to myself\n    this.changed();\n    this.fixLayout();\n    this.rerender();\n\n    this.silentGotoXY(x, y, true); // just me\n    this.positionTalkBubble();\n\n    // propagate to nested parts\n    this.parts.forEach(part => {\n        var xDist = part.xPosition() - x,\n            yDist = part.yPosition() - y;\n        part.setScale(part.scale * 100 * growth);\n        part.silentGotoXY(\n            x + (xDist * growth),\n            y + (yDist * growth)\n        );\n    });\n\n    // propagate to children that inherit my scale\n    if (!noShadow) {\n        this.shadowAttribute('size');\n    }\n    this.instances.forEach(instance => {\n        if (instance.cachedPropagation) {\n            if (instance.inheritsAttribute('size')) {\n                instance.setScale(percentage, true);\n            }\n        }\n    });\n};\n\nSpriteMorph.prototype.changeScale = function (delta) {\n    this.setScale(this.getScale() + (+delta || 0));\n};\n\n// Spritemorph graphic effects\n\nSpriteMorph.prototype.graphicsChanged = function () {\n    return Object.keys(this.graphicsValues).some(any =>\n        this.graphicsValues[any] < 0 ||\n            this.graphicsValues[any] > 0\n    );\n};\n\nSpriteMorph.prototype.applyGraphicsEffects = function (canvas) {\n  // For every effect: apply transform of that effect(canvas, stored value)\n  // Graphic effects from Scratch are heavily based on ScratchPlugin.c\n\n    var ctx, imagedata, w, h;\n\n    function transform_fisheye(imagedata, value) {\n        var pixels, newImageData, newPixels, centerX, centerY,\n            w, h, x, y, dx, dy, r, angle, srcX, srcY, i, srcI;\n\n        w = imagedata.width;\n        h = imagedata.height;\n        pixels = imagedata.data;\n        newImageData = ctx.createImageData(w, h);\n        newPixels = newImageData.data;\n\n        centerX = w / 2;\n        centerY = h / 2;\n        value = Math.max(0, (value + 100) / 100);\n        for (y = 0; y < h; y++) {\n            for (x = 0; x < w; x++) {\n                dx = (x - centerX) / centerX;\n                dy = (y - centerY) / centerY;\n                r = Math.pow(Math.sqrt(dx * dx + dy * dy), value);\n                if (r <= 1) {\n                    angle = Math.atan2(dy, dx);\n                    srcX = Math.floor(\n                        centerX + (r * Math.cos(angle) * centerX)\n                    );\n                    srcY = Math.floor(\n                        centerY + (r * Math.sin(angle) * centerY)\n                    );\n                } else {\n                    srcX = x;\n                    srcY = y;\n                }\n                i = (y * w + x) * 4;\n                srcI = (srcY * w + srcX) * 4;\n                newPixels[i] = pixels[srcI];\n                newPixels[i + 1] = pixels[srcI + 1];\n                newPixels[i + 2] = pixels[srcI + 2];\n                newPixels[i + 3] = pixels[srcI + 3];\n            }\n        }\n        return newImageData;\n    }\n\n    function transform_whirl(imagedata, value) {\n        var pixels, newImageData, newPixels, w, h, centerX, centerY,\n            x, y, radius, scaleX, scaleY, whirlRadians, radiusSquared,\n            dx, dy, d, factor, angle, srcX, srcY, i, srcI, sina, cosa;\n\n        w = imagedata.width;\n        h = imagedata.height;\n        pixels = imagedata.data;\n        newImageData = ctx.createImageData(w, h);\n        newPixels = newImageData.data;\n\n        centerX = w / 2;\n        centerY = h / 2;\n        radius = Math.min(centerX, centerY);\n        if (w < h) {\n            scaleX = h / w;\n            scaleY = 1;\n        } else {\n            scaleX = 1;\n            scaleY = w / h;\n        }\n        whirlRadians = -radians(value);\n        radiusSquared = radius * radius;\n        for (y = 0; y < h; y++) {\n            for (x = 0; x < w; x++) {\n                dx = scaleX * (x - centerX);\n                dy = scaleY * (y - centerY);\n                d = dx * dx + dy * dy;\n                if (d < radiusSquared) {\n                    factor = 1 - (Math.sqrt(d) / radius);\n                    angle = whirlRadians * (factor * factor);\n                    sina = Math.sin(angle);\n                    cosa = Math.cos(angle);\n                    srcX = Math.floor(\n                        (cosa * dx - sina * dy) / scaleX + centerX\n                    );\n                    srcY = Math.floor(\n                        (sina * dx + cosa * dy) / scaleY + centerY\n                    );\n                } else {\n                    srcX = x;\n                    srcY = y;\n                }\n                i = (y * w + x) * 4;\n                srcI = (srcY * w + srcX) * 4;\n                newPixels[i] = pixels[srcI];\n                newPixels[i + 1] = pixels[srcI + 1];\n                newPixels[i + 2] = pixels[srcI + 2];\n                newPixels[i + 3] = pixels[srcI + 3];\n            }\n        }\n        return newImageData;\n    }\n\n    function transform_pixelate(imagedata, value) {\n        var pixels, newImageData, newPixels, w, h,\n            x, y, srcX, srcY, i, srcI;\n\n        w = imagedata.width;\n        h = imagedata.height;\n        pixels = imagedata.data;\n        newImageData = ctx.createImageData(w, h);\n        newPixels = newImageData.data;\n\n        value = Math.floor(Math.abs(value / 10) + 1);\n        for (y = 0; y < h; y++) {\n            for (x = 0; x < w; x++) {\n                srcX = Math.floor(x / value) * value;\n                srcY = Math.floor(y / value) * value;\n                i = (y * w + x) * 4;\n                srcI = (srcY * w + srcX) * 4;\n                newPixels[i] = pixels[srcI];\n                newPixels[i + 1] = pixels[srcI + 1];\n                newPixels[i + 2] = pixels[srcI + 2];\n                newPixels[i + 3] = pixels[srcI + 3];\n            }\n        }\n        return newImageData;\n    }\n\n    function transform_mosaic(imagedata, value) {\n        var pixels, i, l, newImageData, newPixels, srcI;\n        pixels = imagedata.data;\n        newImageData = ctx.createImageData(imagedata.width, imagedata.height);\n        newPixels = newImageData.data;\n\n        value = Math.round((Math.abs(value) + 10) / 10);\n        value = Math.max(\n            0,\n            Math.min(value, Math.min(imagedata.width, imagedata.height))\n        );\n        for (i = 0, l = pixels.length; i < l; i += 4) {\n            srcI = i * value % l;\n            newPixels[i] = pixels[srcI];\n            newPixels[i + 1] = pixels[srcI + 1];\n            newPixels[i + 2] = pixels[srcI + 2];\n            newPixels[i + 3] = pixels[srcI + 3];\n        }\n        return newImageData;\n    }\n\n    function transform_duplicate(imagedata, value) {\n        var pixels, i;\n        pixels = imagedata.data;\n        for (i = 0; i < pixels.length; i += 4) {\n            pixels[i] = pixels[i * value];\n            pixels[i + 1] = pixels[i * value + 1];\n            pixels[i + 2] = pixels[i * value + 2];\n            pixels[i + 3] = pixels[i * value + 3];\n        }\n        return imagedata;\n    }\n\n    function transform_HSV(\n            imagedata,\n            hueShift,\n            saturationShift,\n            brightnessShift\n    ) {\n        var pixels, index, l, r, g, b, max, min, span,\n            h, s, v, i, f, p, q, t, newR, newG, newB;\n        pixels = imagedata.data;\n        for (index = 0, l = pixels.length; index < l; index += 4) {\n            r = pixels[index];\n            g = pixels[index + 1];\n            b = pixels[index + 2];\n\n            max = Math.max(r, g, b);\n            min = Math.min(r, g, b);\n            span = max - min;\n            if (span === 0) {\n                h = s = 0;\n            } else {\n                if (max === r) {\n                    h = (60 * (g - b)) / span;\n                } else if (max === g) {\n                    h = 120 + ((60 * (b - r)) / span);\n                } else if (max === b) {\n                    h = 240 + ((60 * (r - g)) / span);\n                }\n                s = (max - min) / max;\n            }\n            if (h < 0) {\n                h += 360;\n            }\n            v = max / 255;\n\n            h = (h + hueShift * 360 / 200) % 360;\n            s = Math.max(0, Math.min(s + saturationShift / 100, 1));\n            v = Math.max(0, Math.min(v + brightnessShift / 100, 1));\n\n            i = Math.floor(h / 60);\n            f = (h / 60) - i;\n            p = v * (1 - s);\n            q = v * (1 - (s * f));\n            t = v * (1 - (s * (1 - f)));\n\n            if (i === 0 || i === 6) {\n                newR = v;\n                newG = t;\n                newB = p;\n            } else if (i === 1) {\n                newR = q;\n                newG = v;\n                newB = p;\n            } else if (i === 2) {\n                newR = p;\n                newG = v;\n                newB = t;\n            } else if (i === 3) {\n                newR = p;\n                newG = q;\n                newB = v;\n            } else if (i === 4) {\n                newR = t;\n                newG = p;\n                newB = v;\n            } else if (i === 5) {\n                newR = v;\n                newG = p;\n                newB = q;\n            }\n\n            pixels[index] = newR * 255;\n            pixels[index + 1] = newG * 255;\n            pixels[index + 2] = newB * 255;\n        }\n        return imagedata;\n    }\n\n    function transform_negative (imagedata, value) {\n        var pixels, i, l, rcom, gcom, bcom;\n        pixels = imagedata.data;\n        for (i = 0, l = pixels.length; i < l; i += 4) {\n            rcom = 255 - pixels[i];\n            gcom = 255 - pixels[i + 1];\n            bcom = 255 - pixels[i + 2];\n\n            if (pixels[i] < rcom) { //compare to the complement\n                pixels[i] += value;\n            } else if (pixels[i] > rcom) {\n                pixels[i] -= value;\n            }\n            if (pixels[i + 1] < gcom) {\n                pixels[i + 1] += value;\n            } else if (pixels[i + 1] > gcom) {\n                pixels[i + 1] -= value;\n            }\n            if (pixels[i + 2] < bcom) {\n                pixels[i + 2] += value;\n            } else if (pixels[i + 2] > bcom) {\n                pixels[i + 2] -= value;\n            }\n        }\n        return imagedata;\n    }\n\n    function transform_comic (imagedata, value) {\n        var pixels, i, l;\n        pixels = imagedata.data;\n        for (i = 0, l = pixels.length; i < l; i += 4) {\n            pixels[i] += Math.sin(i * value) * 127 + 128;\n            pixels[i + 1] += Math.sin(i * value) * 127 + 128;\n            pixels[i + 2] += Math.sin(i * value) * 127 + 128;\n        }\n        return imagedata;\n    }\n\n    function transform_confetti (imagedata, value) {\n        var pixels, i, l;\n        pixels = imagedata.data;\n        for (i = 0, l = pixels.length; i < l; i += 1) {\n            pixels[i] = Math.sin(value * pixels[i]) * 127 + pixels[i];\n        }\n        return imagedata;\n    }\n\n    if (this.graphicsChanged()) {\n        w = Math.ceil(this.width());\n        h = Math.ceil(this.height());\n        if (!canvas.width || !canvas.height || !w || !h) {\n            // too small to get image data, abort\n            return canvas;\n        }\n        ctx = canvas.getContext(\"2d\");\n        imagedata = ctx.getImageData(0, 0, w, h);\n\n        if (this.graphicsValues.fisheye) {\n            imagedata = transform_fisheye(\n                imagedata,\n                this.graphicsValues.fisheye\n            );\n        }\n        if (this.graphicsValues.whirl) {\n            imagedata = transform_whirl(\n                imagedata,\n                this.graphicsValues.whirl\n            );\n        }\n        if (this.graphicsValues.pixelate) {\n            imagedata = transform_pixelate(\n                imagedata,\n                this.graphicsValues.pixelate\n            );\n        }\n        if (this.graphicsValues.mosaic) {\n            imagedata = transform_mosaic(\n                imagedata,\n                this.graphicsValues.mosaic\n            );\n        }\n        if (this.graphicsValues.duplicate) {\n            imagedata = transform_duplicate(\n                imagedata,\n                this.graphicsValues.duplicate\n            );\n        }\n        if (this.graphicsValues.color ||\n                this.graphicsValues.saturation ||\n                this.graphicsValues.brightness) {\n            imagedata = transform_HSV(\n                imagedata,\n                this.graphicsValues.color,\n                this.graphicsValues.saturation,\n                this.graphicsValues.brightness\n            );\n        }\n        if (this.graphicsValues.negative) {\n            imagedata = transform_negative(\n                imagedata,\n                this.graphicsValues.negative\n            );\n        }\n        if (this.graphicsValues.comic) {\n            imagedata = transform_comic(\n                imagedata,\n                this.graphicsValues.comic\n            );\n        }\n        if (this.graphicsValues.confetti) {\n            imagedata = transform_confetti(\n                imagedata,\n                this.graphicsValues.confetti\n            );\n        }\n\n        ctx.putImageData(imagedata, 0, 0);\n    }\n\n    return canvas;\n};\n\nSpriteMorph.prototype.setEffect = function (effect, value) {\n    var eff = effect instanceof Array ? effect[0] : effect.toString();\n    if (!contains(\n            [\n                'color',\n                'saturation',\n                'brightness',\n                'ghost',\n                'fisheye',\n                'whirl',\n                'pixelate',\n                'mosaic',\n                'negative',\n                // depracated, but still supported in legacy projects:\n                'duplicate',\n                'comic',\n                'confetti'\n            ],\n            eff\n    )) {\n        throw new Error(localize('unsupported graphic effect') + ':\\n' + eff);\n    }\n    if (eff === 'ghost') {\n        this.alpha = 1 - Math.min(Math.max(+value || 0, 0), 100) / 100;\n    } else {\n        this.graphicsValues[eff] = +value;\n    }\n    this.rerender();\n};\n\nSpriteMorph.prototype.getEffect = function (effect) {\n    var eff = effect instanceof Array ? effect[0] : effect.toString();\n    if (eff === 'ghost') {\n        return this.getGhostEffect();\n    }\n    return this.graphicsValues[eff] || 0;\n};\n\nSpriteMorph.prototype.getGhostEffect = function () {\n    return (1 - this.alpha) * 100;\n};\n\nSpriteMorph.prototype.changeEffect = function (effect, value) {\n    var eff = effect instanceof Array ? effect[0] : effect.toString();\n    if (eff === 'ghost') {\n        this.setEffect(effect, this.getGhostEffect() + (+value || 0));\n    } else {\n        this.setEffect(effect, +this.graphicsValues[eff] + (+value));\n    }\n};\n\nSpriteMorph.prototype.clearEffects = function () {\n    var effect;\n    for (effect in this.graphicsValues) {\n        if (this.graphicsValues.hasOwnProperty(effect)) {\n            this.setEffect([effect], 0);\n        }\n    }\n    this.setEffect(['ghost'], 0);\n};\n\n// SpriteMorph talk bubble\n\nSpriteMorph.prototype.stopTalking = function () {\n    var bubble = this.talkBubble();\n    if (bubble) {bubble.destroy(); }\n};\n\nSpriteMorph.prototype.doThink = function (data) {\n    this.bubble(data, true);\n};\n\nSpriteMorph.prototype.bubble = function (data, isThought, isQuestion) {\n    var bubble,\n        stage = this.parentThatIsA(StageMorph);\n\n    this.stopTalking();\n    if (data === '' || isNil(data)) {return; }\n    bubble = new SpriteBubbleMorph(\n        data,\n        stage,\n        isThought,\n        isQuestion\n    );\n    this.add(bubble);\n    this.positionTalkBubble();\n};\n\nSpriteMorph.prototype.talkBubble = function () {\n    return detect(\n        this.children,\n        morph => morph instanceof SpeechBubbleMorph\n    );\n};\n\nSpriteMorph.prototype.positionTalkBubble = function () {\n    var stage = this.parentThatIsA(StageMorph),\n        stageScale = stage ? stage.scale : 1,\n        bubble = this.talkBubble(),\n        middle = this.center().y;\n    if (!bubble) {return null; }\n    bubble.show();\n    if (!bubble.isPointingRight) {\n        bubble.isPointingRight = true;\n        bubble.fixLayout();\n        bubble.rerender();\n    }\n    bubble.setLeft(this.right());\n    bubble.setBottom(this.top());\n    while (!this.isTouching(bubble) && bubble.bottom() < middle) {\n        bubble.moveBy(new Point(-1, 1).scaleBy(stageScale));\n    }\n    if (!stage) {return null; }\n    if (bubble.right() > stage.right()) {\n        bubble.isPointingRight = false;\n        bubble.fixLayout();\n        bubble.rerender();\n        bubble.setRight(this.center().x);\n    }\n    bubble.keepWithin(stage);\n};\n\n// dragging and dropping adjustments b/c of talk bubbles and parts\n\nSpriteMorph.prototype.prepareToBeGrabbed = function (hand) {\n    this.recordLayers();\n    this.shadowAttribute('x position');\n    this.shadowAttribute('y position');\n    if (!this.bounds.containsPoint(hand.position()) &&\n            this.isCorrectingOutsideDrag()) {\n        this.setCenter(hand.position());\n    }\n};\n\nSpriteMorph.prototype.isCorrectingOutsideDrag = function () {\n    // make sure I don't \"trail behind\" the hand when dragged\n    // override for morphs that you want to be dragged outside\n    // their full bounds\n    return !this.parts.length;\n};\n\nSpriteMorph.prototype.justDropped = function () {\n    var stage = this.parentThatIsA(StageMorph);\n    if (stage) {\n        stage.enableCustomHatBlocks = true;\n    }\n    if (this.exemplar) {\n        this.inheritedAttributes.forEach(att => {\n            if (contains(['direction', 'size', 'costume #'], att)) {\n                // only refresh certain propagated attributes\n                this.refreshInheritedAttribute(att);\n            }\n        });\n    }\n    this.restoreLayers();\n    this.positionTalkBubble();\n    this.receiveUserInteraction('dropped');\n};\n\n// SpriteMorph drawing:\n\nSpriteMorph.prototype.drawLine = function (start, dest) {\n    var stagePos = this.parent.bounds.origin,\n        stageScale = this.parent.scale,\n        context = this.parent.penTrails().getContext('2d'),\n        from = start.subtract(stagePos).divideBy(stageScale),\n        to = dest.subtract(stagePos).divideBy(stageScale),\n        damagedFrom = from.multiplyBy(stageScale).add(stagePos),\n        damagedTo = to.multiplyBy(stageScale).add(stagePos),\n        damaged = damagedFrom.rectangle(damagedTo).expandBy(\n            Math.max(this.size * stageScale / 2, 1)\n        ).intersect(this.parent.visibleBounds()).spread();\n\n    if (this.isDown) {\n        // record for later svg conversion\n        if (StageMorph.prototype.enablePenLogging) {\n            this.parent.trailsLog.push(\n                [\n                    this.snapPoint(start),\n                    this.snapPoint(dest),\n                    this.color.copy(),\n                    this.size,\n                    this.useFlatLineEnds ? 'butt' : 'round'\n                ]\n            );\n        }\n\n        // draw on the pen-trails layer\n        context.lineWidth = this.size;\n        context.strokeStyle = this.color.toString();\n        if (this.useFlatLineEnds) {\n            context.lineCap = 'butt';\n            context.lineJoin = 'miter';\n        } else {\n            context.lineCap = 'round';\n            context.lineJoin = 'round';\n        }\n        context.beginPath();\n        context.moveTo(from.x, from.y);\n        context.lineTo(to.x, to.y);\n        context.stroke();\n        if (this.isWarped === false) {\n            this.world().broken.push(damaged);\n        }\n        this.parent.cachedPenTrailsMorph = null;\n    }\n};\n\nSpriteMorph.prototype.floodFill = function () {\n    if (!this.parent.bounds.containsPoint(this.rotationCenter())) {\n        return;\n    }\n    this.parent.cachedPenTrailsMorph = null;\n    if (this.color.a > 1) {\n        // fix a legacy bug in Morphic color detection\n        this.color.a = this.color.a / 255;\n    }\n    var layer = normalizeCanvas(this.parent.penTrails()),\n        width = layer.width,\n        height = layer.height,\n        ctx = layer.getContext('2d'),\n        img = ctx.getImageData(0, 0, width, height),\n        dta = img.data,\n        stack = [\n            Math.round((height / 2) - this.yPosition()) * width +\n            Math.round(this.xPosition() + (width / 2))\n        ],\n        current,\n        src;\n\n    function read(p) {\n        var d = p * 4;\n        return [dta[d], dta[d + 1], dta[d + 2], dta[d + 3]];\n    }\n\n    function check(p) {\n        return p[0] === src[0] &&\n            p[1] === src[1] &&\n            p[2] === src[2] &&\n            p[3] === src[3];\n    }\n\n    src = read(stack[0]);\n    if (src[0] === Math.round(this.color.r) &&\n            src[1] === Math.round(this.color.g) &&\n            src[2] === Math.round(this.color.b) &&\n            src[3] === Math.round(this.color.a * 255)) {\n        return;\n    }\n    while (stack.length > 0) {\n        current = stack.pop();\n        if (check(read(current))) {\n            if (current % width > 1) {\n                stack.push(current + 1);\n                stack.push(current - 1);\n            }\n            if (current > 0 && current < height * width) {\n                stack.push(current + width);\n                stack.push(current - width);\n            }\n        }\n        dta[current * 4] = Math.round(this.color.r);\n        dta[current * 4 + 1] = Math.round(this.color.g);\n        dta[current * 4 + 2] = Math.round(this.color.b);\n        dta[current * 4 + 3] = Math.round(this.color.a * 255);\n    }\n    ctx.putImageData(img, 0, 0);\n    this.parent.changed();\n};\n\n// SpriteMorph pen trails as costume\n\nSpriteMorph.prototype.reportPenTrailsAsCostume = function () {\n    var cst = new Costume(\n        this.parentThatIsA(StageMorph).trailsCanvas,\n        this.newCostumeName(localize('Costume'))\n    );\n    cst.shrinkWrap();\n    cst.rotationCenter = cst.rotationCenter.translateBy(\n        new Point(this.xPosition(), -this.yPosition())\n    );\n    return cst;\n};\n\n// SpriteMorph motion - adjustments due to nesting\n\nSpriteMorph.prototype.moveBy = function (delta, justMe) {\n    // override the inherited default to make sure my parts follow\n    // unless it's justMe (a correction)\n    var start = this.isDown && !justMe && this.parent ?\n            this.rotationCenter() : null;\n    SpriteMorph.uber.moveBy.call(this, delta);\n    if (start) {\n        this.drawLine(start, this.rotationCenter());\n    }\n    if (!justMe) {\n        this.parts.forEach(part => part.moveBy(delta));\n        this.instances.forEach(instance => {\n            if (instance.cachedPropagation) {\n                var inheritsX = instance.inheritsAttribute('x position'),\n                    inheritsY = instance.inheritsAttribute('y position');\n                if (inheritsX && inheritsY) {\n                    instance.moveBy(delta);\n                } else if (inheritsX) {\n                    instance.moveBy(new Point(delta.x, 0));\n                } else if (inheritsY) {\n                    instance.moveBy(new Point(0, delta.y));\n                }\n            }\n        });\n    }\n};\n\nSpriteMorph.prototype.rootForGrab = function () {\n    if (this.anchor) {\n        return this.anchor.rootForGrab();\n    }\n    return SpriteMorph.uber.rootForGrab.call(this);\n};\n\nSpriteMorph.prototype.setCenter = function (aPoint, justMe) {\n    // override the inherited default to make sure my parts follow\n    // unless it's justMe\n    var delta = aPoint.subtract(this.center());\n    this.moveBy(delta, justMe);\n};\n\nSpriteMorph.prototype.nestingBounds = function () {\n    // same as fullBounds(), except that it uses \"parts\" instead of children\n    // and special cases the costume-less \"arrow\" shape's bounding box\n    var result = this.bounds;\n    if (!this.costume && this.penBounds) {\n        result = this.penBounds.translateBy(this.position());\n    }\n    this.parts.forEach(part => {\n        if (part.isVisible) {\n            result = result.merge(part.nestingBounds());\n        }\n    });\n    return result;\n};\n\n// SpriteMorph motion primitives\n\nSpriteMorph.prototype.setPosition = function (aPoint, justMe) {\n    // override the inherited default to make sure my parts follow\n    // unless it's justMe\n    var delta = aPoint.subtract(this.topLeft());\n    if ((delta.x !== 0) || (delta.y !== 0)) {\n        this.moveBy(delta, justMe);\n    }\n};\n\nSpriteMorph.prototype.forward = function (steps) {\n    var dest,\n        dist = steps * this.parent.scale || 0,\n        dot = 0.1;\n\n\tif (dist === 0 && this.isDown) { // draw a dot\n \t\t// dot = Math.min(this.size, 1);\n \t\tthis.isDown = false;\n        this.forward(dot * -0.5);\n        this.isDown = true;\n        this.forward(dot);\n        this.isDown = false;\n        this.forward(dot * -0.5);\n        this.isDown = true;\n     \treturn;\n \t} else if (dist >= 0) {\n        dest = this.position().distanceAngle(dist, this.heading);\n    } else {\n        dest = this.position().distanceAngle(\n            Math.abs(dist),\n            (this.heading - 180)\n        );\n    }\n\n    this.shadowAttribute('x position');\n    this.shadowAttribute('y position');\n\n    this.setPosition(dest);\n    this.positionTalkBubble();\n};\n\nSpriteMorph.prototype.setHeading = function (degrees, noShadow) {\n    var x = this.xPosition(),\n        y = this.yPosition(),\n        dir = !isFinite(degrees) ? 0 : +degrees,\n        turn = dir - this.heading;\n\n    // apply to myself\n    if (this.rotationStyle) { // optimization, only redraw if rotatable\n        this.changed();\n        SpriteMorph.uber.setHeading.call(this, dir);\n        this.silentGotoXY(x, y, true); // just me\n        this.positionTalkBubble();\n    } else {\n        this.heading = ((+degrees % 360) + 360) % 360;\n    }\n\n    // propagate to my parts\n    this.parts.forEach(part => {\n        var pos = new Point(part.xPosition(), part.yPosition()),\n            trg = pos.rotateBy(radians(turn), new Point(x, y));\n        if (part.rotatesWithAnchor) {\n            part.turn(turn);\n        }\n        part.gotoXY(trg.x, trg.y);\n    });\n\n    // propagate to children that inherit my direction\n    if (!noShadow) {\n        this.shadowAttribute('direction');\n    }\n    this.instances.forEach(instance => {\n        if (instance.cachedPropagation) {\n            if (instance.inheritsAttribute('direction')) {\n                instance.setHeading(degrees, true);\n            }\n        }\n    });\n};\n\nSpriteMorph.prototype.faceToXY = function (x, y) {\n    this.setHeading(this.angleToXY(x, y));\n};\n\nSpriteMorph.prototype.angleToXY = function (x, y) {\n    var deltaX = (x - this.xPosition()) * this.parent.scale,\n        deltaY = (y - this.yPosition()) * this.parent.scale,\n        angle = Math.abs(deltaX) < 0.001 ? (deltaY < 0 ? 90 : 270)\n                : Math.round(\n                (deltaX >= 0 ? 0 : 180)\n                    - (Math.atan(deltaY / deltaX) * 57.2957795131)\n            );\n    return angle + 90;\n};\n\nSpriteMorph.prototype.turn = function (degrees) {\n    this.setHeading(this.heading + (+degrees || 0));\n};\n\nSpriteMorph.prototype.turnLeft = function (degrees) {\n    this.setHeading(this.heading - (+degrees || 0));\n};\n\nSpriteMorph.prototype.xPosition = function () {\n    if (this.inheritsAttribute('x position')) {\n        return this.exemplar.xPosition();\n    }\n\n    var stage = this.parentThatIsA(StageMorph);\n\n    if (!stage && this.parent.grabOrigin) { // I'm currently being dragged\n        stage = this.parent.grabOrigin.origin;\n    }\n    if (stage) {\n        return (this.rotationCenter().x - stage.center().x) / stage.scale;\n    }\n    return this.rotationCenter().x;\n};\n\nSpriteMorph.prototype.yPosition = function () {\n    if (this.inheritsAttribute('y position')) {\n        return this.exemplar.yPosition();\n    }\n\n    var stage = this.parentThatIsA(StageMorph);\n\n    if (!stage && this.parent.grabOrigin) { // I'm currently being dragged\n        stage = this.parent.grabOrigin.origin;\n    }\n    if (stage) {\n        return (stage.center().y - this.rotationCenter().y) / stage.scale;\n    }\n    return this.rotationCenter().y;\n};\n\nSpriteMorph.prototype.direction = function () {\n    if (this.inheritsAttribute('direction')) {\n        return this.exemplar.direction();\n    }\n    return this.heading;\n};\n\nSpriteMorph.prototype.penSize = function () {\n    return this.size;\n};\n\nSpriteMorph.prototype.gotoXY = function (x, y, justMe, noShadow) {\n    var stage = this.parentThatIsA(StageMorph),\n        newX,\n        newY,\n        dest;\n\n    if (!stage) {return; }\n    if (!noShadow) {\n        this.shadowAttribute('x position');\n        this.shadowAttribute('y position');\n    }\n    x = !isFinite(+x) ? 0 : +x;\n    y = !isFinite(+y) ? 0 : +y;\n    newX = stage.center().x + x * stage.scale;\n    newY = stage.center().y - y * stage.scale;\n    if (this.costume) {\n        dest = new Point(newX, newY).subtract(this.rotationOffset);\n    } else {\n        dest = new Point(newX, newY).subtract(this.extent().divideBy(2));\n    }\n    this.setPosition(dest, justMe);\n    this.positionTalkBubble();\n};\n\nSpriteMorph.prototype.silentGotoXY = function (x, y, justMe) {\n    // move without drawing\n    // don't shadow coordinate attributes\n    var penState = this.isDown;\n    this.isDown = false;\n    this.gotoXY(x, y, justMe, true); // don't shadow coordinates\n    this.isDown = penState;\n};\n\nSpriteMorph.prototype.setXPosition = function (num) {\n    this.shadowAttribute('x position');\n    this.gotoXY(+num || 0, this.yPosition(), false, true);\n};\n\nSpriteMorph.prototype.changeXPosition = function (delta) {\n    this.setXPosition(this.xPosition() + (+delta || 0));\n};\n\nSpriteMorph.prototype.setYPosition = function (num) {\n    this.shadowAttribute('y position');\n    this.gotoXY(this.xPosition(), +num || 0, false, true);\n};\n\nSpriteMorph.prototype.changeYPosition = function (delta) {\n    this.setYPosition(this.yPosition() + (+delta || 0));\n};\n\nSpriteMorph.prototype.glide = function (\n    duration,\n    endX,\n    endY,\n    elapsed,\n    startPoint\n) {\n    var fraction, endPoint, rPos;\n    endPoint = new Point(endX, endY);\n    fraction = Math.max(Math.min(elapsed / duration, 1), 0);\n    rPos = startPoint.add(\n        endPoint.subtract(startPoint).multiplyBy(fraction)\n    );\n    this.gotoXY(rPos.x, rPos.y);\n};\n\nSpriteMorph.prototype.bounceOffEdge = function () {\n    // taking nested parts into account\n    var stage = this.parentThatIsA(StageMorph),\n        fb = this.nestingBounds(),\n        dirX,\n        dirY;\n\n    if (!stage) {return null; }\n    if (stage.bounds.containsRectangle(fb)) {return null; }\n\n    dirX = Math.cos(radians(this.heading - 90));\n    dirY = -(Math.sin(radians(this.heading - 90)));\n\n    if (fb.left() < stage.left()) {\n        dirX = Math.abs(dirX);\n    }\n    if (fb.right() > stage.right()) {\n        dirX = -(Math.abs(dirX));\n    }\n    if (fb.top() < stage.top()) {\n        dirY = -(Math.abs(dirY));\n    }\n    if (fb.bottom() > stage.bottom()) {\n        dirY = Math.abs(dirY);\n    }\n\n    this.shadowAttribute('x position');\n    this.shadowAttribute('y position');\n    this.shadowAttribute('direction');\n\n    this.setHeading(degrees(Math.atan2(-dirY, dirX)) + 90);\n    this.setPosition(this.position().add(\n        fb.amountToTranslateWithin(stage.bounds)\n    ));\n    this.positionTalkBubble();\n};\n\n// SpriteMorph coordinate conversion\n\nSpriteMorph.prototype.snapPoint = function(aPoint) {\n    var stage = this.parentThatIsA(StageMorph),\n        origin = stage.center();\n    return new Point(\n        (aPoint.x - origin.x) / stage.scale,\n        (origin.y - aPoint.y) / stage.scale\n    );\n};\n\n// SpriteMorph rotation center / fixation point manipulation\n\nSpriteMorph.prototype.setRotationX = function (absoluteX) {\n  this.setRotationCenter(new Point(absoluteX, this.yPosition()));\n};\n\nSpriteMorph.prototype.setRotationY = function (absoluteY) {\n  this.setRotationCenter(new Point(this.xPosition(), absoluteY));\n};\n\nSpriteMorph.prototype.setRotationCenter = function (absoluteCoordinate) {\n    var delta, normal;\n    if (!this.costume) {\n        throw new Error('setting the rotation center requires a costume');\n    }\n    delta = absoluteCoordinate.subtract(\n        new Point(this.xPosition(), this.yPosition())\n    ).divideBy(this.scale).rotateBy(radians(90 - this.heading));\n    normal = this.costume.rotationCenter.add(new Point(delta.x, -delta.y));\n    this.costume.rotationCenter = normal;\n    this.changed();\n    this.fixLayout();\n    this.changed();\n};\n\nSpriteMorph.prototype.moveRotationCenter = function () {\n    // make this a method of Snap >> SpriteMorph\n    this.world().activeHandle = new HandleMorph(\n        this,\n        null,\n        null,\n        null,\n        null,\n        'movePivot'\n    );\n};\n\nSpriteMorph.prototype.setPivot = function (worldCoordinate) {\n    var stage = this.parentThatIsA(StageMorph),\n        cntr;\n    if (stage) {\n        cntr = stage.center();\n        this.setRotationCenter(\n            new Point(\n                (worldCoordinate.x - cntr.x) / stage.scale,\n                (cntr.y - worldCoordinate.y) / stage.scale\n            )\n        );\n    }\n};\n\n// SpriteMorph dimension getters\n\nSpriteMorph.prototype.xCenter = function () {\n    var stage = this.parentThatIsA(StageMorph);\n\n    if (!stage && this.parent.grabOrigin) { // I'm currently being dragged\n        stage = this.parent.grabOrigin.origin;\n    }\n    if (stage) {\n        return (this.center().x - stage.center().x) / stage.scale;\n    }\n    return this.center().x;\n};\n\nSpriteMorph.prototype.yCenter = function () {\n    var stage = this.parentThatIsA(StageMorph);\n\n    if (!stage && this.parent.grabOrigin) { // I'm currently being dragged\n        stage = this.parent.grabOrigin.origin;\n    }\n    if (stage) {\n        return (stage.center().y - this.center().y) / stage.scale;\n    }\n    return this.center().y;\n};\n\nSpriteMorph.prototype.xLeft = function () {\n    var stage = this.parentThatIsA(StageMorph);\n\n    if (!stage && this.parent.grabOrigin) { // I'm currently being dragged\n        stage = this.parent.grabOrigin.origin;\n    }\n    if (stage) {\n        return (this.left() - stage.center().x) / stage.scale;\n    }\n    return this.left();\n};\n\nSpriteMorph.prototype.xRight = function () {\n    var stage = this.parentThatIsA(StageMorph);\n\n    if (!stage && this.parent.grabOrigin) { // I'm currently being dragged\n        stage = this.parent.grabOrigin.origin;\n    }\n    if (stage) {\n        return (this.right() - stage.center().x) / stage.scale;\n    }\n    return this.right();\n};\n\nSpriteMorph.prototype.yTop = function () {\n    var stage = this.parentThatIsA(StageMorph);\n\n    if (!stage && this.parent.grabOrigin) { // I'm currently being dragged\n        stage = this.parent.grabOrigin.origin;\n    }\n    if (stage) {\n        return (stage.center().y - this.top()) / stage.scale;\n    }\n    return this.top();\n};\n\nSpriteMorph.prototype.yBottom = function () {\n    var stage = this.parentThatIsA(StageMorph);\n\n    if (!stage && this.parent.grabOrigin) { // I'm currently being dragged\n        stage = this.parent.grabOrigin.origin;\n    }\n    if (stage) {\n        return (stage.center().y - this.bottom()) / stage.scale;\n    }\n    return this.bottom();\n};\n\n// SpriteMorph message broadcasting\n\nSpriteMorph.prototype.allMessageNames = function () {\n    var msgs = [];\n    this.allScripts().forEach(script => {\n        script.allChildren().forEach(morph => {\n            var txt;\n            if (morph instanceof InputSlotMorph && morph.choices && contains(\n                ['messagesMenu', 'messagesReceivedMenu'],\n                morph.choices\n            )) {\n                txt = morph.evaluate();\n                if (isString(txt) && txt !== '') {\n                    if (!contains(msgs, txt)) {\n                        msgs.push(txt);\n                    }\n                }\n            }\n        });\n    });\n    return msgs;\n};\n\nSpriteMorph.prototype.allSendersOf = function (message, receiverName, known) {\n    return this.allScripts().filter(script =>\n        script.isSending && script.isSending(message, receiverName, known)\n    );\n};\n\nSpriteMorph.prototype.allHatBlocksFor = function (message) {\n    if (typeof message === 'number') { message = message.toString(); }\n    return this.scripts.children.filter(morph => {\n        var event;\n        if (morph.selector) {\n            if (morph.selector === 'receiveMessage') {\n                event = morph.inputs()[0].evaluate();\n                return event === message\n                    || (event instanceof Array\n                        && message !== '__shout__go__'\n                        && message !== '__clone__init__');\n            }\n            if (morph.selector === 'receiveGo') {\n                return message === '__shout__go__';\n            }\n            if (morph.selector === 'receiveOnClone') {\n                return message === '__clone__init__';\n            }\n        }\n        return false;\n    });\n};\n\nSpriteMorph.prototype.allHatBlocksForKey = function (key) {\n    return this.scripts.children.filter(morph => {\n        if (morph.selector) {\n            if (morph.selector === 'receiveKey') {\n                var evt = morph.inputs()[0].evaluate()[0];\n                return evt === key || evt === 'any key';\n            }\n        }\n        return false;\n    });\n};\n\nSpriteMorph.prototype.allHatBlocksForInteraction = function (interaction) {\n    return this.scripts.children.filter(morph => {\n        if (morph.selector) {\n            if (morph.selector === 'receiveInteraction') {\n                return morph.inputs()[0].evaluate()[0] === interaction;\n            }\n        }\n        return false;\n    });\n};\n\nSpriteMorph.prototype.hasGenericHatBlocks = function () {\n    return this.scripts.children.some(morph =>\n        morph.selector === 'receiveCondition'\n    );\n};\n\nSpriteMorph.prototype.allGenericHatBlocks = function () {\n    return this.scripts.children.filter(morph => {\n        if (morph.selector) {\n            return morph.selector === 'receiveCondition';\n        }\n        return false;\n    });\n};\n\nSpriteMorph.prototype.allScripts = function () {\n    var all = this.scripts.children.slice();\n    this.customBlocks.forEach(def => {\n        if (def.body) {\n            all.push(def.body.expression);\n        }\n        def.scripts.forEach(scr => all.push(scr));\n    });\n    if (this.globalBlocks) {\n        this.globalBlocks.forEach(def => {\n            if (def.body) {\n                all.push(def.body.expression);\n            }\n            def.scripts.forEach(scr => all.push(scr));\n        });\n    }\n    return all;\n};\n\n// SpriteMorph events\n\nSpriteMorph.prototype.mouseClickLeft = function () {\n    return this.receiveUserInteraction('clicked');\n};\n\nSpriteMorph.prototype.mouseEnter = function () {\n    return this.receiveUserInteraction('mouse-entered');\n};\n\nSpriteMorph.prototype.mouseDownLeft = function () {\n    return this.receiveUserInteraction('pressed');\n};\n\nSpriteMorph.prototype.mouseScroll = function (y) {\n    return this.receiveUserInteraction('scrolled-' + (y > 0 ? 'up' : 'down'));\n};\n\nSpriteMorph.prototype.receiveUserInteraction = function (\n    interaction,\n    rightAway,\n    threadSafe\n) {\n    var stage = this.parentThatIsA(StageMorph),\n        procs = [],\n        hats;\n    if (!stage) {return; } // currently dragged\n    hats = this.allHatBlocksForInteraction(interaction);\n    hats.forEach(block =>\n        procs.push(stage.threads.startProcess(\n            block,\n            this,\n            threadSafe || stage.isThreadSafe,\n            null, // export result\n            null, // callback\n            null, // is clicked\n            rightAway, // immediately\n            interaction === 'stopped' // atomic\n        ))\n    );\n    return procs;\n};\n\nSpriteMorph.prototype.mouseDoubleClick = function () {\n    if (this.isTemporary) {return; }\n    this.edit();\n};\n\n// SpriteMorph timer\n\nSpriteMorph.prototype.getTimer = function () {\n    var stage = this.parentThatIsA(StageMorph);\n    if (stage) {\n        return stage.getTimer();\n    }\n    return 0;\n};\n\n// SpriteMorph tempo\n\nSpriteMorph.prototype.getTempo = function () {\n    var stage = this.parentThatIsA(StageMorph);\n    if (stage) {\n        return stage.getTempo();\n    }\n    return 0;\n};\n\n// SpriteMorph last message\n\nSpriteMorph.prototype.getLastMessage = function () {\n    var stage = this.parentThatIsA(StageMorph);\n    if (stage) {\n        return stage.getLastMessage();\n    }\n    return '';\n};\n\n// SpriteMorph user prompting\n\nSpriteMorph.prototype.getLastAnswer = function () {\n    return this.parentThatIsA(StageMorph).lastAnswer;\n};\n\n// SpriteMorph mouse coordinates\n\nSpriteMorph.prototype.reportMouseX = function () {\n    var stage = this.parentThatIsA(StageMorph);\n    if (stage) {\n        return stage.reportMouseX();\n    }\n    return 0;\n};\n\nSpriteMorph.prototype.reportMouseY = function () {\n    var stage = this.parentThatIsA(StageMorph);\n    if (stage) {\n        return stage.reportMouseY();\n    }\n    return 0;\n};\n\n// SpriteMorph thread count (for debugging)\n\nSpriteMorph.prototype.reportThreadCount = function () {\n    var stage = this.parentThatIsA(StageMorph);\n    if (stage) {\n        return stage.threads.processes.length;\n    }\n    return 0;\n};\n\n// SpriteMorph variable refactoring\n\nSpriteMorph.prototype.refactorVariableInstances = function (\n    oldName,\n    newName,\n    isGlobal\n) {\n    if (isGlobal && this.hasSpriteVariable(oldName)) {\n        return;\n    }\n\n    this.scripts.children.forEach(child => {\n        if (child instanceof BlockMorph) {\n            child.refactorVarInStack(oldName, newName);\n        }\n    });\n\n};\n\n// SpriteMorph variable watchers (for palette checkbox toggling)\n\nSpriteMorph.prototype.findVariableWatcher = function (varName) {\n    var stage = this.parentThatIsA(StageMorph),\n        globals = this.globalVariables();\n    if (stage === null) {\n        return null;\n    }\n    return detect(\n        stage.children,\n        morph => morph instanceof WatcherMorph &&\n            (morph.target === this.variables || morph.target === globals) &&\n                morph.getter === varName\n    );\n};\n\nSpriteMorph.prototype.toggleVariableWatcher = function (varName, isGlobal) {\n    var stage = this.parentThatIsA(StageMorph),\n        ide = this.parentThatIsA(IDE_Morph),\n        globals = this.globalVariables(),\n        watcher,\n        others;\n\n    if (stage === null) {\n        return null;\n    }\n    if (isNil(isGlobal)) {\n        isGlobal = contains(globals.names(), varName);\n    }\n    watcher = this.findVariableWatcher(varName);\n    if (watcher !== null) {\n        if (watcher.isVisible) {\n            watcher.hide();\n        } else {\n            watcher.show();\n            watcher.fixLayout(); // re-hide hidden parts\n            watcher.keepWithin(stage);\n        }\n        if (isGlobal) {\n            ide.flushBlocksCache('variables');\n            ide.refreshPalette();\n        }\n        return;\n    }\n\n    // if no watcher exists, create a new one\n    watcher = new WatcherMorph(\n        varName,\n        this.blockColor.variables,\n        isGlobal ? globals : this.variables,\n        varName\n    );\n    watcher.setPosition(stage.position().add(10));\n    others = stage.watchers(watcher.left());\n    if (others.length > 0) {\n        watcher.setTop(others[others.length - 1].bottom());\n    }\n    watcher.fixLayout();\n    watcher.keepWithin(stage);\n    stage.add(watcher);\n    watcher.changed();\n    return watcher;\n};\n\nSpriteMorph.prototype.showingVariableWatcher = function (varName) {\n    var stage = this.parentThatIsA(StageMorph),\n        watcher;\n    if (stage === null) {\n        return false;\n    }\n    watcher = this.findVariableWatcher(varName);\n    if (watcher) {\n        return watcher.isVisible;\n    }\n    return false;\n};\n\nSpriteMorph.prototype.deleteVariableWatcher = function (varName) {\n    var stage = this.parentThatIsA(StageMorph),\n        watcher;\n    if (stage === null) {\n        return null;\n    }\n    watcher = this.findVariableWatcher(varName);\n    if (watcher !== null) {\n        watcher.destroy();\n    }\n};\n\n// SpriteMorph non-variable watchers\n\nSpriteMorph.prototype.toggleWatcher = function (selector, label, color) {\n    var stage = this.parentThatIsA(StageMorph),\n        ide = this.parentThatIsA(IDE_Morph),\n        watcher,\n        others;\n    if (!stage) { return; }\n    watcher = this.watcherFor(stage, selector);\n    if (watcher) {\n        if (watcher.isVisible) {\n            watcher.hide();\n        } else {\n            watcher.show();\n            watcher.fixLayout(); // re-hide hidden parts\n            watcher.keepWithin(stage);\n        }\n        if (watcher.isGlobal(selector)) {\n            ide.flushBlocksCache();\n            ide.refreshPalette();\n        }\n        return;\n    }\n\n    // if no watcher exists, create a new one\n    watcher = new WatcherMorph(\n        label,\n        color,\n        WatcherMorph.prototype.isGlobal(selector) ? stage : this,\n        selector\n    );\n    watcher.setPosition(stage.position().add(10));\n    others = stage.watchers(watcher.left());\n    if (others.length > 0) {\n        watcher.setTop(others[others.length - 1].bottom());\n    }\n    stage.add(watcher);\n    watcher.fixLayout();\n    watcher.keepWithin(stage);\n    watcher.changed();\n    if (watcher.isGlobal(selector)) {\n        ide.flushBlocksCache();\n        ide.refreshPalette();\n    }\n};\n\nSpriteMorph.prototype.showingWatcher = function (selector) {\n    var stage = this.parentThatIsA(StageMorph),\n        watcher;\n    if (stage === null) {\n        return false;\n    }\n    watcher = this.watcherFor(stage, selector);\n    if (watcher) {\n        return watcher.isVisible;\n    }\n    return false;\n};\n\nSpriteMorph.prototype.watcherFor = function (stage, selector) {\n    return detect(\n        stage.children,\n        morph => morph instanceof WatcherMorph &&\n            morph.getter === selector &&\n                morph.target === (morph.isGlobal(selector) ? stage : this)\n    );\n};\n\n// SpriteMorph custom blocks\n\nSpriteMorph.prototype.deleteAllBlockInstances = function (definition) {\n    var stage,\n        blocks = definition.isGlobal ? this.allBlockInstances(definition)\n            : this.allIndependentInvocationsOf(definition.blockSpec());\n\n    blocks.forEach(each => each.deleteBlock());\n\n    // purge custom block definitions of \"corpses\"\n    // i.e. blocks that have been marked for deletion\n    if (definition.isGlobal) {\n        stage = this.parentThatIsA(StageMorph);\n        if (stage) {\n            stage.globalBlocks.forEach(def => def.purgeCorpses());\n            stage.children.concat(stage).forEach(sprite => {\n                if (sprite.isSnapObject) {\n                    sprite.customBlocks.forEach(def => def.purgeCorpses());\n                }\n            });\n        }\n    } else {\n        this.allSpecimens().concat(this).forEach(sprite =>\n            sprite.customBlocks.forEach(def => def.purgeCorpses())\n        );\n    }\n};\n\nSpriteMorph.prototype.allBlockInstances = function (definition) {\n    var stage, objects, blocks = [], inDefinitions;\n    if (definition.isGlobal) {\n        stage = this.parentThatIsA(StageMorph);\n        objects = stage.children.filter(morph =>\n            morph instanceof SpriteMorph\n        );\n        objects.push(stage);\n        objects.forEach(sprite =>\n            blocks = blocks.concat(\n                sprite.allLocalBlockInstances(definition)\n            )\n        );\n        inDefinitions = [];\n        stage.globalBlocks.forEach(def => {\n            def.scripts.forEach(eachScript =>\n                eachScript.allChildren().forEach(c => {\n                    if (c.isCustomBlock && (c.definition === definition)) {\n                        inDefinitions.push(c);\n                    }\n                })\n            );\n            if (def.body) {\n                def.body.expression.allChildren().forEach(c => {\n                    if (c.isCustomBlock && (c.definition === definition)) {\n                        inDefinitions.push(c);\n                    }\n                });\n            }\n        });\n        return blocks.concat(inDefinitions);\n    }\n    return this.allLocalBlockInstances(definition);\n};\n\nSpriteMorph.prototype.allIndependentInvocationsOf = function (aSpec) {\n    var blocks;\n    if (this.exemplar && this.exemplar.getMethod(aSpec)) {\n        // shadows an inherited method, don't delete\n        return [];\n    }\n    blocks = this.allInvocationsOf(aSpec);\n    this.instances.forEach(sprite =>\n        sprite.addAllInvocationsOf(aSpec, blocks)\n    );\n    return blocks;\n};\n\nSpriteMorph.prototype.allDependentInvocationsOf = function (aSpec) {\n    var blocks;\n    blocks = this.allInvocationsOf(aSpec);\n    this.instances.forEach(sprite =>\n        sprite.addAllInvocationsOf(aSpec, blocks)\n    );\n    return blocks;\n};\n\nSpriteMorph.prototype.allInvocationsOf = function (aSpec) {\n    // only inside the receiver, without the inheritance branches\n    var inScripts, inDefinitions, inBlockEditors, blocks;\n\n    inScripts = this.scripts.allChildren().filter(c =>\n        c.isCustomBlock && !c.isGlobal && (c.blockSpec === aSpec)\n    );\n\n    inDefinitions = [];\n    this.customBlocks.forEach(def => {\n        def.scripts.forEach(eachScript =>\n            eachScript.allChildren().forEach(c => {\n                if (c.isCustomBlock && !c.isGlobal &&\n                    (c.blockSpec === aSpec)\n                ) {\n                    inDefinitions.push(c);\n                }\n            })\n        );\n        if (def.body) {\n            def.body.expression.allChildren().forEach(c => {\n                if (c.isCustomBlock && !c.isGlobal &&\n                    (c.blockSpec === aSpec)\n                ) {\n                    inDefinitions.push(c);\n                }\n            });\n        }\n    });\n\n    inBlockEditors = this.allEditorBlockInstances(null, aSpec);\n    blocks = inScripts.concat(inDefinitions).concat(inBlockEditors);\n    return blocks;\n};\n\nSpriteMorph.prototype.addAllInvocationsOf = function (aSpec, anArray) {\n    if (!this.getLocalMethod(aSpec)) {\n        this.allInvocationsOf(aSpec).forEach(block =>\n            anArray.push(block)\n        );\n        this.instances.forEach(sprite =>\n            sprite.addAllInvocationsOf(aSpec, anArray)\n        );\n    }\n};\n\n\nSpriteMorph.prototype.allLocalBlockInstances = function (definition) {\n    var inScripts, inDefinitions, inBlockEditors, inPalette, result;\n\n    inScripts = this.scripts.allChildren().filter(c =>\n        c.isCustomBlock && (c.definition === definition)\n    );\n\n    inDefinitions = [];\n    this.customBlocks.forEach(def => {\n        if (def.body) {\n            def.body.expression.allChildren().forEach(c => {\n                if (c.isCustomBlock && (c.definition === definition)) {\n                    inDefinitions.push(c);\n                }\n            });\n        }\n    });\n\n    inBlockEditors = this.allEditorBlockInstances(definition);\n    inPalette = this.paletteBlockInstance(definition);\n\n    result = inScripts.concat(inDefinitions).concat(inBlockEditors);\n    if (inPalette) {\n        result.push(inPalette);\n    }\n    return result;\n};\n\nSpriteMorph.prototype.allEditorBlockInstances = function (definition, spec) {\n    // either pass a definition for global custom blocks\n    // or a spec for local ones\n    var inBlockEditors = [],\n        world = this.world();\n\n    if (!world) {return []; } // when copying a sprite\n\n    this.world().children.forEach(morph => {\n        if (morph instanceof BlockEditorMorph) {\n            morph.body.contents.allChildren().forEach(block => {\n                if (definition) { // global\n                    if (!block.isPrototype\n                            && !(block instanceof PrototypeHatBlockMorph)\n                            && (block.definition === definition)) {\n                        inBlockEditors.push(block);\n                    }\n                } else { // local\n                    if (block.isCustomBlock\n                            && !block.isGlobal\n                            && !block.isPrototype\n                            && !(block instanceof PrototypeHatBlockMorph)\n                            && (block.blockSpec === spec)) {\n                        inBlockEditors.push(block);\n                    }\n                }\n            });\n        }\n    });\n    return inBlockEditors;\n};\n\nSpriteMorph.prototype.paletteBlockInstance = function (definition) {\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (!ide) {return null; }\n    return detect(\n        ide.palette.contents.children,\n        block => block.isCustomBlock && (block.definition === definition)\n    );\n};\n\nSpriteMorph.prototype.usesBlockInstance = function (\n    definition,\n    forRemoval, // optional bool\n    skipGlobals, // optional bool\n    skipBlocks // optional array with ignorable definitions\n) {\n    var inDefinitions,\n        inScripts = detect(\n            this.scripts.allChildren(),\n            c => c.isCustomBlock && (c.definition === definition)\n        );\n\n    if (inScripts) {return true; }\n\n    if (definition.isGlobal && !skipGlobals) {\n        inDefinitions = [];\n        this.parentThatIsA(StageMorph).globalBlocks.forEach(def => {\n            if (forRemoval && (definition === def)) {return; }\n            if (skipBlocks && contains(skipBlocks, def)) {return; }\n            if (def.body) {\n                def.body.expression.allChildren().forEach(c => {\n                    if (c.isCustomBlock && (c.definition === definition)) {\n                        inDefinitions.push(c);\n                    }\n                });\n            }\n        });\n        if (inDefinitions.length > 0) {return true; }\n    }\n\n    inDefinitions = [];\n    this.customBlocks.forEach(def => {\n        if (def.body) {\n            def.body.expression.allChildren().forEach(c => {\n                if (c.isCustomBlock && (c.definition === definition)) {\n                    inDefinitions.push(c);\n                }\n            });\n        }\n    });\n    return (inDefinitions.length > 0);\n};\n\nSpriteMorph.prototype.doubleDefinitionsFor = function (definition) {\n    var spec = definition.blockSpec(),\n        blockList,\n        idx,\n        stage;\n\n    if (definition.isGlobal) {\n        stage = this.parentThatIsA(StageMorph);\n        if (!stage) {return []; }\n        blockList = stage.globalBlocks;\n    } else {\n        blockList = this.customBlocks;\n    }\n    idx = blockList.indexOf(definition);\n    if (idx === -1) {return []; }\n    return blockList.filter((def, i) =>\n        def.blockSpec() === spec && (i !== idx)\n    );\n};\n\nSpriteMorph.prototype.replaceDoubleDefinitionsFor = function (definition) {\n    var doubles = this.doubleDefinitionsFor(definition),\n        stage,\n        ide;\n    doubles.forEach(double =>\n        this.allBlockInstances(double).forEach(block => {\n            block.definition = definition;\n            block.refresh();\n        })\n    );\n    if (definition.isGlobal) {\n        stage = this.parentThatIsA(StageMorph);\n        stage.globalBlocks = stage.globalBlocks.filter(def =>\n            !contains(doubles, def)\n        );\n    } else {\n        this.customBlocks = this.customBlocks.filter(def =>\n            !contains(doubles, def)\n        );\n    }\n    ide = this.parentThatIsA(IDE_Morph);\n    if (ide) {\n        ide.flushPaletteCache();\n        ide.refreshPalette();\n    }\n};\n\n// SpriteMorph controlling generic WHEN hats\n\nSpriteMorph.prototype.pauseGenericHatBlocks = function () {\n    var stage = this.parentThatIsA(StageMorph),\n        ide = this.parentThatIsA(IDE_Morph);\n    if (this.hasGenericHatBlocks()) {\n        stage.enableCustomHatBlocks = true;\n        stage.threads.pauseCustomHatBlocks = true;\n        ide.controlBar.stopButton.refresh();\n    }\n};\n\n// SpriteMorph inheritance - general\n\nSpriteMorph.prototype.chooseExemplar = function () {\n    var stage = this.parentThatIsA(StageMorph),\n        other = stage.children.filter(m =>\n            m instanceof SpriteMorph &&\n                !m.isTemporary &&\n                    (!contains(m.allExemplars(), this))\n        ),\n        menu;\n    menu = new MenuMorph(\n        aSprite => this.setExemplar(aSprite),\n        localize('current parent') +\n            ':\\n' +\n            (this.exemplar ? this.exemplar.name : localize('none'))\n    );\n    other.forEach(eachSprite =>\n        menu.addItem(\n            eachSprite.name,\n            eachSprite,\n            null, // hint\n            null, // color\n            null, // bold\n            null, // italic\n            null, // doubleClickAction\n            null, // shortcut\n            true  // verbatim\n        )\n    );\n    menu.addLine();\n    menu.addItem(localize('none'), null);\n    menu.popUpAtHand(this.world());\n};\n\nSpriteMorph.prototype.setExemplar = function (another, enableError) {\n    var ide;\n\n    // check for circularity\n    if (another instanceof SpriteMorph &&\n            contains(another.allExemplars(), this)) {\n        if (enableError) {\n            throw new Error(\n                localize('unable to inherit\\n(disabled or circular?)')\n            );\n        }\n        return; // silently fail so stored projects can still be loaded\n    }\n\n    this.emancipate();\n    this.exemplar = another;\n    if (another) {\n        this.variables.parentFrame = another.variables;\n        another.addSpecimen(this);\n    } else {\n        this.variables.parentFrame = this.globalVariables();\n    }\n    if (this.isTemporary) {\n        this.cloneOriginName = another.cloneOriginName || another.name;\n    } else {\n        ide = this.parentThatIsA(IDE_Morph);\n        if (ide) {\n            ide.flushBlocksCache();\n            ide.refreshPalette();\n        }\n    }\n};\n\nSpriteMorph.prototype.prune = function () {\n    // sever ties with all my specimen, if any,\n    this.instances.forEach(child => {\n        child.shadowAllAttributes();\n        child.shadowAllMethods();\n        child.shadowAllVars();\n        child.exemplar = null;\n    });\n    this.instances = [];\n};\n\nSpriteMorph.prototype.emancipate = function () {\n    // sever all relations with my exemplar, if any,\n    // and make sure I am the root of my specimen\n    if (this.exemplar) {\n        if (!this.isTemporary) {\n            this.shadowAllAttributes();\n            this.shadowAllMethods();\n            this.shadowAllVars();\n        }\n        this.exemplar.removeSpecimen(this); // optimization\n        this.exemplar = null;\n    }\n};\n\nSpriteMorph.prototype.allExemplars = function () {\n    // including myself\n    var all = [],\n        current = this;\n    while (!isNil(current)) {\n        all.push(current);\n        current = current.exemplar;\n    }\n    return all;\n};\n\nSpriteMorph.prototype.specimens = function () {\n    // without myself\n    return this.instances;\n};\n\nSpriteMorph.prototype.allSpecimens = function () {\n    // without myself\n    var all = this.instances.slice();\n    this.instances.forEach(child =>\n        all.push.apply(all, child.allSpecimens())\n    );\n    return all;\n};\n\nSpriteMorph.prototype.addSpecimen = function (another) {\n    // private - use setExemplar() to establish an inheritance relationship\n    this.instances.push(another);\n};\n\nSpriteMorph.prototype.removeSpecimen = function(another) {\n    // private - use setExemplar(null) to cancel an inheritance relationship\n    var idx = this.instances.indexOf(another);\n    if (idx !== -1) {\n        this.instances.splice(idx, 1);\n    }\n};\n\n// SpriteMorph inheritance - attributes\n\nSpriteMorph.prototype.inheritsAttribute = function (aName) {\n    return !isNil(this.exemplar) && contains(this.inheritedAttributes, aName);\n};\n\nSpriteMorph.prototype.updatePropagationCache = function () {\n    // private - indicate whether one of my inherited attributes is technically\n    // propagated down from my exemplar, instead of truly shared.\n    // (only) needed for internal optimization caching\n    this.cachedPropagation = !isNil(this.exemplar) && detect(\n        [\n            'x position',\n            'y position',\n            'direction',\n            'size',\n            'costume #',\n            'volume',\n            'balance',\n            'shown?',\n            'pen down?'\n        ],\n        att => contains(this.inheritedAttributes, att)\n    );\n};\n\nSpriteMorph.prototype.shadowedAttributes = function () {\n    // answer an array of attribute names that can be deleted/shared\n    var inherited = this.inheritedAttributes;\n    return this.attributes.filter(each => !contains(inherited, each));\n};\n\nSpriteMorph.prototype.shadowAllAttributes = function () {\n    this.attributes.forEach(att =>\n        this.shadowAttribute(att)\n    );\n};\n\nSpriteMorph.prototype.shadowAttribute = function (aName) {\n    var ide, wardrobe, jukebox,\n        pos;\n    if (!this.inheritsAttribute(aName)) {\n        return;\n    }\n    ide = this.parentThatIsA(IDE_Morph);\n    this.inheritedAttributes = this.inheritedAttributes.filter(each =>\n        each !== aName\n    );\n    if (aName === 'costumes') {\n        wardrobe = new List();\n        this.costumes.asArray().forEach(costume => {\n            var cst = costume.copy();\n            wardrobe.add(cst);\n            if (costume === this.costume) {\n                this.wearCostume(cst);\n            }\n        });\n        this.costumes = wardrobe;\n        this.instances.forEach(obj => {\n            if (obj.inheritsAttribute('costumes')) {\n                obj.refreshInheritedAttribute('costumes');\n            }\n        });\n    } else if (aName === 'sounds') {\n        jukebox = new List();\n        this.sounds.asArray().forEach(sound => jukebox.add(sound.copy()));\n        this.sounds = jukebox;\n        this.instances.forEach(obj => {\n            if (obj.inheritsAttribute('sounds')) {\n                obj.refreshInheritedAttribute('sounds');\n            }\n        });\n    } else if (aName === 'scripts') {\n        ide.stage.threads.stopAllForReceiver(this);\n        pos = this.scripts.position();\n        this.scripts = this.exemplar.scripts.fullCopy();\n        if (ide && (contains(ide.currentSprite.allExemplars(), this))) {\n            ide.createSpriteEditor();\n            ide.fixLayout('selectSprite');\n            this.scripts.fixMultiArgs();\n            this.scripts.setPosition(pos);\n            ide.spriteEditor.adjustScrollBars();\n        }\n        this.instances.forEach(obj => {\n            if (obj.inheritsAttribute('scripts')) {\n                obj.refreshInheritedAttribute('scripts');\n            }\n        });\n    } else {\n        this.updatePropagationCache();\n        if (ide && !this.isTemporary) {\n            ide.flushBlocksCache(); // optimization: specify category if known\n            ide.refreshPalette();\n        }\n    }\n};\n\nSpriteMorph.prototype.inheritAttribute = function (aName) {\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (!this.exemplar || !contains(this.attributes, aName)) {\n        return;\n    }\n    if (!this.inheritsAttribute(aName)) {\n        this.inheritedAttributes.push(aName);\n        this.refreshInheritedAttribute(aName);\n        if (ide) {\n            ide.flushBlocksCache(); // optimization: specify category\n            ide.refreshPalette();\n        }\n    }\n};\n\nSpriteMorph.prototype.refreshInheritedAttribute = function (aName) {\n    var ide, idx;\n    switch (aName) {\n    case 'x position':\n    case 'y position':\n        this.cachedPropagation = true;\n        this.gotoXY(this.xPosition(), this.yPosition(), false, true);\n        break;\n    case 'direction':\n        this.cachedPropagation = true;\n        this.setHeading(this.direction(), true);\n        break;\n    case 'size':\n        this.cachedPropagation = true;\n        this.setScale(this.getScale(), true);\n        break;\n    case 'costume #':\n        this.cachedPropagation = true;\n        if (this.inheritsAttribute('costumes')) {\n            // if inheriting the whole wardrobe,\n            // just switch to the exemplar's costume\n            this.wearCostume(this.exemplar.costume, true);\n        } else {\n            // otherwise switch to the own costume of the\n            // corresponing number\n            this.doSwitchToCostume(this.getCostumeIdx(), true);\n        }\n        break;\n    case 'volume':\n        this.cachedPropagation = true;\n        this.setVolume(this.getVolume(), true);\n        break;\n    case 'shown?':\n        this.cachedPropagation = true;\n        this.setVisibility(this.reportShown(), true);\n        break;\n    case 'pen down?':\n        this.cachedPropagation = true;\n        this.setPenDown(this.getPenDown(), true);\n        break;\n    case 'balance':\n        this.cachedPropagation = true;\n        this.setPan(this.getPan(), true);\n        break;\n    case 'costumes':\n        idx = this.getCostumeIdx();\n        this.costumes = this.exemplar.costumes;\n        this.doSwitchToCostume(idx, true);\n        this.instances.forEach(sprite => {\n            if (sprite.inheritsAttribute('costumes')) {\n                sprite.refreshInheritedAttribute('costumes');\n            }\n        });\n        break;\n    case 'sounds':\n        this.sounds = this.exemplar.sounds;\n        this.instances.forEach(sprite => {\n            if (sprite.inheritsAttribute('sounds')) {\n                sprite.refreshInheritedAttribute('sounds');\n            }\n        });\n        break;\n    case 'scripts':\n        this.scripts = this.exemplar.scripts;\n        ide = this.parentThatIsA(IDE_Morph);\n        if (ide) {\n            ide.stage.threads.stopAllForReceiver(this);\n            if (contains(ide.currentSprite.allExemplars(), this)) {\n                ide.createSpriteEditor();\n                ide.fixLayout('selectSprite');\n            }\n        }\n        this.instances.forEach(sprite => {\n            if (sprite.inheritsAttribute('scripts')) {\n                sprite.refreshInheritedAttribute('scripts');\n            }\n        });\n        break;\n    default:\n        nop();\n    }\n};\n\nSpriteMorph.prototype.toggleInheritanceForAttribute = function (aName) {\n    if (this.inheritsAttribute(aName)) {\n        this.shadowAttribute(aName);\n    } else {\n        this.inheritAttribute(aName);\n    }\n};\n\n// SpriteMorph inheritance - variables\n\nSpriteMorph.prototype.isVariableNameInUse = function (vName, isGlobal) {\n    if (isGlobal) {\n        return contains(this.variables.allNames(), vName);\n    }\n    if (contains(this.variables.names(), vName)) {return true; }\n    return contains(this.globalVariables().names(), vName);\n};\n\nSpriteMorph.prototype.globalVariables = function () {\n    var current = this.variables.parentFrame;\n    while (current.owner) {\n        current = current.parentFrame;\n    }\n    return current;\n};\n\nSpriteMorph.prototype.shadowAllVars = function () {\n    this.inheritedVariableNames().forEach(name =>\n        this.shadowVar(name, this.variables.getVar(name))\n    );\n};\n\nSpriteMorph.prototype.shadowVar = function (name, value) {\n    var ide;\n    this.variables.addVar(name, value);\n    if (!this.isTemporary) {\n        ide = this.parentThatIsA(IDE_Morph);\n        if (ide) {\n            ide.flushBlocksCache('variables');\n            ide.refreshPalette();\n        }\n    }\n};\n\nSpriteMorph.prototype.toggleInheritedVariable = function (vName) {\n    if (contains(this.inheritedVariableNames(true), vName)) { // is shadowed\n        this.deleteVariable(vName);\n    } else if (contains(this.inheritedVariableNames(), vName)) { // inherited\n        this.shadowVar(vName, this.variables.getVar(vName));\n    }\n};\n\nSpriteMorph.prototype.inheritedVariableNames = function (shadowedOnly) {\n    var names = [],\n        own = this.variables.names(),\n        current = this.variables.parentFrame;\n\n    function test(each) {\n        return shadowedOnly ? contains(own, each) : !contains(own, each);\n    }\n\n    while (current.owner instanceof SpriteMorph) {\n        names.push.apply(\n            names,\n            current.names().filter(test)\n        );\n        current = current.parentFrame;\n    }\n    return names;\n};\n\nSpriteMorph.prototype.deletableVariableNames = function () {\n    var locals = this.variables.names(),\n        inherited = this.inheritedVariableNames();\n    return locals.concat(\n        this.globalVariables().names().filter(each =>\n            !contains(locals, each) && !contains(inherited, each)\n        )\n    );\n};\n\nSpriteMorph.prototype.hasSpriteVariable = function (varName) {\n    return contains(this.variables.names(), varName);\n};\n\nSpriteMorph.prototype.allLocalVariableNames = function (sorted) {\n    var data;\n\n    function alphabetically(x, y) {\n        return x.toLowerCase() < y.toLowerCase() ? -1 : 1;\n    }\n\n \tdata = this.variables.names();\n\tif (sorted) {\n \t\tdata.sort(alphabetically);\n   }\n   return data;\n};\n\nSpriteMorph.prototype.reachableGlobalVariableNames = function (sorted) {\n    var locals = this.allLocalVariableNames(),\n    \tdata;\n\n    function alphabetically(x, y) {\n        return x.toLowerCase() < y.toLowerCase() ? -1 : 1;\n    }\n\n\tdata = this.globalVariables().names().filter(each =>\n    \t!contains(locals, each)\n\t);\n    if (sorted) {\n    \tdata.sort(alphabetically);\n   }\n   return data;\n};\n\n// SpriteMorph inheritance - custom blocks\n\nSpriteMorph.prototype.getMethod = function (spec) {\n    return this.allBlocks()[spec];\n};\n\nSpriteMorph.prototype.getLocalMethod = function (spec) {\n    return this.ownBlocks()[spec];\n};\n\nSpriteMorph.prototype.ownBlocks = function () {\n    var dict = {};\n    this.customBlocks.forEach(def =>\n        dict[def.blockSpec()] = def\n    );\n    return dict;\n};\n\nSpriteMorph.prototype.allBlocks = function (valuesOnly) {\n    var dict = {};\n    this.allExemplars().reverse().forEach(sprite =>\n        sprite.customBlocks.forEach(def =>\n            dict[def.blockSpec()] = def\n        )\n    );\n    if (valuesOnly) {\n        return Object.keys(dict).map(key => dict[key]);\n    }\n    return dict;\n};\n\nSpriteMorph.prototype.inheritedBlocks = function (valuesOnly) {\n    var dict = {},\n        own = Object.keys(this.ownBlocks()),\n        others = this.allExemplars().reverse();\n    others.pop();\n    others.forEach(sprite =>\n        sprite.customBlocks.forEach(def => {\n            var spec = def.blockSpec();\n            if (!contains(own, spec)) {\n                dict[spec] = def;\n            }\n        })\n    );\n    if (valuesOnly) {\n        return Object.keys(dict).map(key => dict[key]);\n    }\n    return dict;\n};\n\nSpriteMorph.prototype.shadowAllMethods = function () {\n    var ide;\n    this.inheritedMethods().forEach(dup =>\n        this.customBlocks.push(dup)\n    );\n    if (!this.isTemporary) {\n        ide = this.parentThatIsA(IDE_Morph);\n        if (ide) {\n            ide.flushPaletteCache();\n            ide.refreshPalette();\n        }\n    }\n};\n\nSpriteMorph.prototype.inheritedMethods = function () {\n    // private - pre-serialization preparation\n    return this.inheritedBlocks(true).map(def =>\n        def.copyAndBindTo(this, true) // header only\n    );\n};\n\n// SpriteMorph thumbnail\n\nSpriteMorph.prototype.thumbnail = function (extentPoint, recycleMe) {\n    // answer a new Canvas of extentPoint dimensions containing\n    // my thumbnail representation keeping the originial aspect ratio\n    // a \"recycleMe canvas can be passed for re-use\n    var src = this.getImage(), // at this time sprites aren't composite morphs\n        w = this.width(),\n        h = this.height(),\n        scale = Math.min(\n            (extentPoint.x / w),\n            (extentPoint.y / h)\n        ),\n        xOffset = (extentPoint.x - (w * scale)) / 2,\n        yOffset = (extentPoint.y - (h * scale)) / 2,\n        trg = newCanvas(extentPoint, false, recycleMe),\n        ctx = trg.getContext('2d');\n\n    function xOut(style, alpha, width) {\n        var inset = Math.min(extentPoint.x, extentPoint.y) / 10;\n        ctx.strokeStyle = style;\n        ctx.globalAlpha = alpha;\n        ctx.compositeOperation = 'lighter';\n        ctx.lineWidth = width || 1;\n        ctx.moveTo(inset, inset);\n        ctx.lineTo(trg.width - inset, trg.height - inset);\n        ctx.moveTo(inset, trg.height - inset);\n        ctx.lineTo(trg.width - inset, inset);\n        ctx.stroke();\n    }\n\n    ctx.save();\n    if (this.isCorpse) {\n        ctx.globalAlpha = 0.3;\n    }\n    if (w && h && src.width && src.height) {\n        ctx.scale(scale, scale);\n        ctx.drawImage(\n            src,\n            Math.floor(xOffset / scale),\n            Math.floor(yOffset / scale)\n        );\n    }\n    if (this.isCorpse) {\n        ctx.restore();\n        xOut('white', 0.8, 6);\n        xOut('black', 0.8, 1);\n    }\n    ctx.restore();\n    return trg;\n};\n\nSpriteMorph.prototype.fullThumbnail = function (extentPoint, recycleMe) {\n    // containing parts and anchor symbols, if any\n    var thumb = this.thumbnail(extentPoint, recycleMe),\n        ctx = thumb.getContext('2d'),\n        ext = extentPoint.divideBy(3),\n        i = 0;\n\n    ctx.restore();\n    if (this.anchor) {\n        ctx.drawImage(\n            this.anchor.thumbnail(ext),\n            0,\n            0\n        );\n    }\n    for (i = 0; i < 3; i += 1) {\n        if (this.parts[i]) {\n            ctx.drawImage(\n                this.parts[i].thumbnail(ext),\n                i * ext.x,\n                extentPoint.y - ext.y\n            );\n        }\n    }\n    return thumb;\n};\n\n// SpriteMorph Boolean visual representation\n\nSpriteMorph.prototype.booleanMorph = function (bool) {\n    var sym = new BooleanSlotMorph(bool);\n    sym.isStatic = true;\n    sym.fixLayout();\n    return sym;\n};\n\n// SpriteMorph nesting\n/*\n    simulate Morphic trees\n*/\n\nSpriteMorph.prototype.attachTo = function (aSprite) {\n    aSprite.attachPart(this);\n};\n\nSpriteMorph.prototype.attachPart = function (aSprite) {\n    var v = Date.now();\n    if (aSprite.anchor) {\n        aSprite.anchor.detachPart(aSprite);\n    }\n    this.parts.push(aSprite);\n    this.version = v;\n    aSprite.anchor = this;\n    this.allParts().forEach(part =>\n        part.nestingScale = part.scale\n    );\n    aSprite.version = v;\n};\n\nSpriteMorph.prototype.detachPart = function (aSprite) {\n    var idx = this.parts.indexOf(aSprite),\n        v;\n    if (idx !== -1) {\n        v = Date.now();\n        this.parts.splice(idx, 1);\n        this.version = v;\n        aSprite.anchor = null;\n        aSprite.version = v;\n    }\n};\n\nSpriteMorph.prototype.detachAllParts = function () {\n    var v = Date.now();\n\n    this.parts.forEach(part => {\n        part.anchor = null;\n        part.version = v;\n    });\n    this.parts = [];\n    this.version = v;\n};\n\nSpriteMorph.prototype.detachFromAnchor = function () {\n    if (this.anchor) {\n        this.anchor.detachPart(this);\n    }\n};\n\nSpriteMorph.prototype.allParts = function () {\n    // includes myself\n    var result = [this];\n    this.parts.forEach(part =>\n        result = result.concat(part.allParts())\n    );\n    return result;\n};\n\nSpriteMorph.prototype.allAnchors = function () {\n    // includes myself\n    var result = [this];\n    if (this.anchor !== null) {\n        result = result.concat(this.anchor.allAnchors());\n    }\n    return result;\n};\n\nSpriteMorph.prototype.recordLayers = function () {\n    var stage = this.parentThatIsA(StageMorph);\n    if (!stage) {\n        this.layerCache = null;\n        return;\n    }\n    this.layers = this.allParts();\n    this.layers.forEach(part => {\n        var bubble = part.talkBubble();\n        if (bubble) {bubble.hide(); }\n    });\n    this.layers.sort((x, y) =>\n        stage.children.indexOf(x) < stage.children.indexOf(y) ?\n            -1 : 1\n    );\n};\n\nSpriteMorph.prototype.restoreLayers = function () {\n    if (this.layers && this.layers.length > 1) {\n        this.layers.forEach(sprite => {\n            sprite.comeToFront();\n            sprite.positionTalkBubble();\n        });\n    }\n    this.layers = null;\n};\n\n// SpriteMorph destroying\n\nSpriteMorph.prototype.destroy = function () {\n    // make sure to sever all inheritance ties to other sprites\n    if (this.anchor) {\n        this.anchor.detachPart(this);\n    }\n    this.emancipate();\n    if (!this.isTemporary) {\n        this.prune();\n    }\n    SpriteMorph.uber.destroy.call(this);\n};\n\n// SpriteMorph highlighting\n\nSpriteMorph.prototype.flash = function () {\n\tvar world = this.world();\n    this.addHighlight();\n\tworld.animations.push(new Animation(\n\t\tnop,\n  \t\tnop,\n    \t0,\n     \t800,\n      \tnop,\n      \t() => this.removeHighlight()\n\t));\n};\n\nSpriteMorph.prototype.addHighlight = function (oldHighlight) {\n    var isHidden = !this.isVisible,\n        highlight;\n\n    if (isHidden) {this.show(); }\n    highlight = this.highlight(\n        oldHighlight ? oldHighlight.color : this.highlightColor,\n        this.highlightBorder\n    );\n    this.addBack(highlight);\n    this.fullChanged();\n    if (isHidden) {this.hide(); }\n    return highlight;\n};\n\nSpriteMorph.prototype.removeHighlight = function () {\n    var highlight = this.getHighlight();\n    if (highlight !== null) {\n        this.fullChanged();\n        this.removeChild(highlight);\n    }\n    return highlight;\n};\n\nSpriteMorph.prototype.toggleHighlight = function () {\n    if (this.getHighlight()) {\n        this.removeHighlight();\n    } else {\n        this.addHighlight();\n    }\n};\n\nSpriteMorph.prototype.highlight = function (color, border) {\n    var highlight = new SpriteHighlightMorph(),\n        fb = this.bounds, // sprites are not nested in a Morphic way\n        edge = border,\n        ctx;\n\n    highlight.bounds.setExtent(fb.extent().add(edge * 2));\n    highlight.color = color;\n    highlight.cachedImage = this.highlightImage(color, border);\n    ctx = highlight.cachedImage.getContext('2d');\n    ctx.drawImage(\n        this.highlightImage(WHITE, 4),\n        border - 4,\n        border - 4\n    );\n    ctx.drawImage(\n        this.highlightImage(new Color(50, 50, 50), 2),\n        border - 2,\n        border - 2\n    );\n    ctx.drawImage(\n        this.highlightImage(WHITE, 1),\n        border - 1,\n        border - 1\n    );\n    highlight.setPosition(fb.origin.subtract(new Point(edge, edge)));\n    return highlight;\n};\n\nSpriteMorph.prototype.highlightImage = function (color, border) {\n    var fb, img, hi, ctx, out;\n    fb = this.extent();\n    img = this.getImage();\n\n    hi = newCanvas(fb.add(border * 2));\n    ctx = hi.getContext('2d');\n\n    ctx.drawImage(img, 0, 0);\n    ctx.drawImage(img, border, 0);\n    ctx.drawImage(img, border * 2, 0);\n    ctx.drawImage(img, border * 2, border);\n    ctx.drawImage(img, border * 2, border * 2);\n    ctx.drawImage(img, border, border * 2);\n    ctx.drawImage(img, 0, border * 2);\n    ctx.drawImage(img, 0, border);\n\n    ctx.globalCompositeOperation = 'destination-out';\n    ctx.drawImage(img, border, border);\n\n    out = newCanvas(fb.add(border * 2));\n    ctx = out.getContext('2d');\n    ctx.drawImage(hi, 0, 0);\n    ctx.globalCompositeOperation = 'source-atop';\n    ctx.fillStyle = color.toString();\n    ctx.fillRect(0, 0, out.width, out.height);\n\n    return out;\n};\n\nSpriteMorph.prototype.getHighlight = function () {\n    var highlights = this.children.slice(0).reverse().filter(child =>\n        child instanceof SpriteHighlightMorph\n    );\n    if (highlights.length !== 0) {\n        return highlights[0];\n    }\n    return null;\n};\n\n// SpriteMorph nesting events\n\nSpriteMorph.prototype.mouseEnterDragging = function () {\n    var obj;\n    if (!this.enableNesting) {return; }\n    obj = this.world().hand.children[0];\n    if (this.wantsDropOf(obj)) {\n        this.addHighlight();\n    }\n};\n\nSpriteMorph.prototype.mouseLeave = function () {\n    this.receiveUserInteraction('mouse-departed');\n    if (!this.enableNesting) {return; }\n    this.removeHighlight();\n};\n\nSpriteMorph.prototype.wantsDropOf = function (morph) {\n    // allow myself to be the anchor of another sprite\n    // by drag & drop\n    return this.enableNesting\n        && morph instanceof SpriteIconMorph\n        && !contains(morph.object.allParts(), this);\n};\n\nSpriteMorph.prototype.reactToDropOf = function (morph, hand) {\n    this.removeHighlight();\n    this.attachPart(morph.object);\n    this.world().add(morph);\n    morph.slideBackTo(hand.grabOrigin);\n};\n\n// SpriteMorph screenshots\n\nSpriteMorph.prototype.newCostumeName = function (name, ignoredCostume) {\n    var ix = name.indexOf('('),\n        stem = (ix < 0) ? name : name.substring(0, ix),\n        count = 1,\n        newName = stem,\n        all = this.costumes.asArray().filter(each =>\n            each !== ignoredCostume\n        ).map(each => each.name);\n    while (contains(all, newName)) {\n        count += 1;\n        newName = stem + '(' + count + ')';\n    }\n    return newName;\n};\n\nSpriteMorph.prototype.doScreenshot = function (imgSource, data) {\n    var canvas,\n        stage = this.parentThatIsA(StageMorph),\n        costume;\n    data = this.newCostumeName(data);\n    if (imgSource[0] === undefined) {\n        return;\n    }\n    if (imgSource[0] === \"pen trails\") {\n        canvas = stage.trailsCanvas;\n        costume = new Costume(canvas, data).copy(); // prevent mutation\n    } else if (imgSource[0] === \"stage image\") {\n        canvas = stage.fullImage();\n        costume = new Costume(canvas, data);\n    }\n    this.addCostume(costume);\n};\n\n// SpriteMorph adding sounds\n\nSpriteMorph.prototype.newSoundName = function (name, ignoredSound) {\n    var ix = name.indexOf('('),\n        stem = (ix < 0) ? name : name.substring(0, ix),\n        count = 1,\n        newName = stem,\n        all = this.sounds.asArray().filter(each =>\n            each !== ignoredSound\n        ).map(each => each.name);\n    while (contains(all, newName)) {\n        count += 1;\n        newName = stem + '(' + count + ')';\n    }\n    return newName;\n};\n\n// SpriteHighlightMorph /////////////////////////////////////////////////\n\n// SpriteHighlightMorph inherits from Morph:\n\nSpriteHighlightMorph.prototype = new Morph();\nSpriteHighlightMorph.prototype.constructor = SpriteHighlightMorph;\nSpriteHighlightMorph.uber = Morph.prototype;\n\n// SpriteHighlightMorph instance creation:\n\nexport function SpriteHighlightMorph() {\n    this.init();\n}\n\nSpriteHighlightMorph.prototype.init = function () {\n    SpriteHighlightMorph.uber.init.call(this);\n    this.isCachingImage = true;\n};\n\n// StageMorph /////////////////////////////////////////////////////////\n\n/*\n    I inherit from FrameMorph and copy from SpriteMorph.\n*/\n\n// StageMorph inherits from FrameMorph:\n\nStageMorph.prototype = new FrameMorph();\nStageMorph.prototype.constructor = StageMorph;\nStageMorph.uber = FrameMorph.prototype;\n\n// StageMorph preferences settings\n\nStageMorph.prototype.dimensions = new Point(480, 360); // unscaled extent\nStageMorph.prototype.frameRate = 0; // unscheduled per default\n\nStageMorph.prototype.isCachingPrimitives\n    = SpriteMorph.prototype.isCachingPrimitives;\n\nStageMorph.prototype.sliderColor\n    = SpriteMorph.prototype.sliderColor;\n\nStageMorph.prototype.paletteTextColor\n    = SpriteMorph.prototype.paletteTextColor;\n\nStageMorph.prototype.hiddenPrimitives = {};\nStageMorph.prototype.codeMappings = {};\nStageMorph.prototype.codeHeaders = {};\nStageMorph.prototype.enableCodeMapping = false;\nStageMorph.prototype.enableInheritance = true;\nStageMorph.prototype.enableSublistIDs = false;\nStageMorph.prototype.enablePenLogging = false; // for SVG generation\n\n// StageMorph instance creation\n\nexport function StageMorph(globals) {\n    this.init(globals);\n}\n\nStageMorph.prototype.init = function (globals) {\n    this.name = localize('Stage');\n    this.guid = \"testGUID\";\n    // this.guid = newGuid();\n    this.instrument = null;\n    this.threads = new ThreadManager();\n    this.variables = new VariableFrame(globals || null, this);\n    this.scripts = new ScriptsMorph();\n    this.customBlocks = [];\n    this.globalBlocks = [];\n    this.costumes = new List();\n    this.costume = null;\n    this.sounds = new List();\n    this.version = Date.now(); // for observers\n    this.isFastTracked = false;\n    this.enableCustomHatBlocks = true;\n    this.cloneCount = 0;\n\n    this.timerStart = Date.now();\n    this.tempo = 60; // bpm\n    this.lastMessage = '';\n\n    // volume and stereo-pan support, experimental:\n    this.volume = 100;\n    this.gainNode = null; // must be lazily initialized in Chrome, sigh...\n    this.pan = 0;\n    this.pannerNode = null; // must be lazily initialized in Chrome, sigh...\n\n    // frequency player, experimental\n    this.freqPlayer = null; // Note, to be lazily initialized\n\n    this.watcherUpdateFrequency = 2;\n    this.lastWatcherUpdate = Date.now();\n\n    this.scale = 1; // for display modes, do not persist\n\n    this.cachedHSV = [0, 0, 0]; // for background hsv support, not serialized\n\n    this.keysPressed = {}; // for handling keyboard events, do not persist\n    this.blocksCache = {}; // not to be serialized (!)\n    this.paletteCache = {}; // not to be serialized (!)\n    this.lastAnswer = ''; // last user input, do not persist\n    this.activeSounds = []; // do not persist\n\n    this.trailsCanvas = null;\n    this.trailsLog = []; // each line being [p1, p2, color, width, cap]\n    this.isThreadSafe = false;\n\n    this.microphone = new Microphone(); // audio input, do not persist\n\n    this.graphicsValues = {\n        'color': 0,\n        'fisheye': 0,\n        'whirl': 0,\n        'pixelate': 0,\n        'mosaic': 0,\n        'duplicate': 0,\n        'negative': 0,\n        'comic': 0,\n        'confetti': 0,\n        'saturation': 0,\n        'brightness': 0\n    };\n\n    this.cachedPenTrailsMorph = null; // optimization, do not persist\n\n    this.remixID = null;\n\n    // projection layer - for video, maps, 3D extensions etc., transient\n    this.projectionSource = null; // offscreen DOM element for video, maps, 3D\n    this.getProjectionImage = null; // function to return a blittable image\n    this.stopProjectionSource = null; // function to turn off video stream etc.\n    this.continuousProjection = false; // turn ON for video\n    this.projectionCanvas = null;\n    this.projectionTransparency = 50;\n\n    // video motion detection, transient\n    this.mirrorVideo = true;\n    this.videoMotion = null;\n\n    // world map client - experimental, transient\n    this.worldMap = new WorldMap();\n\n    // Snap! API event listeners - experimental, transient\n    this.messageCallbacks = {}; // name : [functions]\n\n    StageMorph.uber.init.call(this);\n\n    this.isCachingImage = true;\n    this.cachedHSV = this.color.hsv();\n    this.acceptsDrops = false;\n    this.setColor(new Color(255, 255, 255));\n    this.fps = this.frameRate;\n};\n\n// StageMorph scaling\n\nStageMorph.prototype.setScale = function (number) {\n    var delta = number / this.scale,\n        pos = this.position(),\n        relativePos,\n        bubble;\n\n    if (delta === 1) {return; }\n    this.cachedPenTrailsMorph = null;\n    this.scale = number;\n    this.setExtent(this.dimensions.multiplyBy(number));\n\n    // now move and resize all children - sprites, bubbles, watchers etc..\n    this.children.forEach(morph => {\n        relativePos = morph.position().subtract(pos);\n        morph.fixLayout();\n        morph.setPosition(\n            relativePos.multiplyBy(delta).add(pos),\n            true // just me (for nested sprites)\n        );\n        if (morph instanceof SpriteMorph) {\n            morph.rerender();\n            bubble = morph.talkBubble();\n            if (bubble) {\n                bubble.setScale(number);\n                morph.positionTalkBubble();\n            }\n        } else if (morph instanceof StagePrompterMorph) {\n            if (this.scale < 1) {\n                morph.setWidth(this.width() - 10);\n            } else {\n                morph.setWidth(this.dimensions.x - 20);\n            }\n            morph.setCenter(this.center());\n            morph.setBottom(this.bottom());\n        }\n    });\n};\n\nStageMorph.prototype.moveBy = function (delta) {\n    // override the inherited method to skip attached sprite parts,\n    // because they are also level-1 children of the stage and thus\n    // will be moved individually\n    var children = this.children,\n        i = children.length;\n    this.changed();\n    this.bounds = this.bounds.translateBy(delta);\n    this.changed();\n    for (i; i > 0; i -= 1) {\n        children[i - 1].moveBy(delta, true); // justMe - skip sprite parts\n    }\n};\n\n// StageMorph rendering\n\nStageMorph.prototype.render = function (ctx) {\n    ctx.save();\n    ctx.fillStyle = this.color.toString();\n    ctx.fillRect(0, 0, this.width(), this.height());\n    if (this.costume) {\n        ctx.scale(this.scale, this.scale);\n        ctx.drawImage(\n            this.costume.contents,\n            (this.width() / this.scale - this.costume.width()) / 2,\n            (this.height() / this.scale - this.costume.height()) / 2\n        );\n        this.cachedImage = this.applyGraphicsEffects(this.cachedImage);\n    }\n    ctx.restore();\n    this.version = Date.now(); // for observer optimization\n};\n\nStageMorph.prototype.drawOn = function (ctx, rect) {\n    // draw pen trails and webcam layers\n    var clipped = rect.intersect(this.bounds),\n        pos, src, w, h, sl, st, ws, hs;\n\n    if (!this.isVisible || !clipped.extent().gt(ZERO)) {\n        return;\n    }\n\n    // costume, if any, and background color\n    StageMorph.uber.drawOn.call(this, ctx, rect);\n\n    pos = this.position();\n    src = clipped.translateBy(pos.neg());\n    sl = src.left();\n    st = src.top();\n    w = src.width();\n    h = src.height();\n    ws = w / this.scale;\n    hs = h / this.scale;\n\n    ctx.save();\n    ctx.scale(this.scale, this.scale);\n\n    // projection layer (e.g. webcam)\n    if (this.projectionSource) {\n        ctx.globalAlpha = 1 - (this.projectionTransparency / 100);\n        ctx.drawImage(\n            this.projectionLayer(),\n            sl / this.scale,\n            st / this.scale,\n            ws,\n            hs,\n            clipped.left() / this.scale,\n            clipped.top() / this.scale,\n            ws,\n            hs\n        );\n        this.version = Date.now(); // update watcher icons\n    }\n\n    // pen trails\n    ctx.globalAlpha = 1;\n    ctx.drawImage(\n        this.penTrails(),\n        sl / this.scale,\n        st / this.scale,\n        ws,\n        hs,\n        clipped.left() / this.scale,\n        clipped.top() / this.scale,\n        ws,\n        hs\n    );\n\n    ctx.restore();\n};\n\nStageMorph.prototype.clearPenTrails = function () {\n    this.cachedPenTrailsMorph = null;\n    this.trailsCanvas = newCanvas(this.dimensions, null, this.trailsCanvas);\n    this.trailsLog = [];\n    this.changed();\n};\n\nStageMorph.prototype.penTrails = function () {\n    if (!this.trailsCanvas) {\n        this.trailsCanvas = newCanvas(this.dimensions);\n    }\n    return this.trailsCanvas;\n};\n\nStageMorph.prototype.penTrailsMorph = function () {\n    // for collision detection purposes\n    var morph, trails, ctx;\n\n    if (this.cachedPenTrailsMorph) {\n        return this.cachedPenTrailsMorph;\n    }\n    morph = new Morph();\n    morph.isCachingImage = true;\n    trails = this.penTrails();\n    morph.bounds = this.bounds.copy();\n    morph.cachedImage = newCanvas(this.extent(), true);\n    ctx = morph.cachedImage.getContext('2d');\n    ctx.drawImage(\n        trails,\n        0,\n        0,\n        trails.width,\n        trails.height,\n        0,\n        0,\n        this.width(),\n        this.height()\n    );\n    this.cachedPenTrailsMorph = morph;\n    return morph;\n};\n\nStageMorph.prototype.projectionLayer = function () {\n    if (!this.projectionCanvas) {\n        this.projectionCanvas = newCanvas(this.dimensions, true);\n    }\n    return this.projectionCanvas;\n};\n\nStageMorph.prototype.clearProjectionLayer = function () {\n    this.projectionCanvas = null;\n    this.changed();\n};\n\n// StageMorph video capture\n\nStageMorph.prototype.startVideo = function() {\n    var myself = this;\n\n    function noCameraSupport() {\n        var dialog = new DialogBoxMorph();\n        dialog.inform(\n            localize('Camera not supported'),\n            localize('Please make sure your web browser is up to date\\n' +\n                'and your camera is properly configured. \\n\\n' +\n                'Some browsers also require you to access Snap!\\n' +\n                'through HTTPS to use the camera.\\n\\n' +\n                'Please replace the \"http://\" part of the address\\n' +\n                'in your browser by \"https://\" and try again.'),\n            this.world\n        );\n        dialog.fixLayout();\n        if (myself.projectionSource) {\n            myself.projectionSource.remove();\n            myself.projectionSource = null;\n        }\n    }\n    if (this.projectionSource) { // video capture has already been started\n        return;\n    }\n\n    this.projectionSource = document.createElement('video');\n    this.projectionSource.width = this.dimensions.x;\n    this.projectionSource.height = this.dimensions.y;\n    this.projectionSource.hidden = true;\n    document.body.appendChild(this.projectionSource);\n    if (!this.videoMotion) {\n        this.videoMotion = new VideoMotion(\n            this.dimensions.x,\n            this.dimensions.y\n        );\n    }\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n        navigator.mediaDevices.getUserMedia({ video: true })\n            .then(function(stream) {\n                myself.getProjectionImage = myself.getVideoImage;\n                myself.stopProjectionSource = myself.stopVideo;\n                myself.continuousProjection = true;\n                myself.projectionSource.srcObject = stream;\n                myself.projectionSource.play().catch(noCameraSupport);\n                myself.projectionSource.stream = stream;\n            })\n            .catch(noCameraSupport);\n    }\n};\n\nStageMorph.prototype.getVideoImage = function () {\n    return this.projectionSource;\n};\n\nStageMorph.prototype.stopVideo = function() {\n    if (this.projectionSource && this.projectionSource.stream) {\n        this.projectionSource.stream.getTracks().forEach(track =>\n            track.stop()\n        );\n    }\n    this.videoMotion = null;\n};\n\nStageMorph.prototype.stopProjection = function() {\n    if (this.projectionSource) {\n        this.stopProjectionSource();\n        this.projectionSource.remove();\n        this.projectionSource = null;\n        this.continuousProjection = false;\n    }\n    this.clearProjectionLayer();\n};\n\nStageMorph.prototype.projectionSnap = function() {\n    var snap = newCanvas(this.dimensions, true),\n        ctx = snap.getContext('2d');\n    ctx.drawImage(this.projectionLayer(), 0, 0);\n    return new Costume(snap, this.newCostumeName(localize('snap')));\n};\n\n// StageMorph pixel access:\n\nStageMorph.prototype.getPixelColor = function (aPoint) {\n    var point, context, data;\n\tif (this.trailsCanvas) {\n        point = aPoint.subtract(this.bounds.origin);\n        context = this.penTrailsMorph().getImage().getContext('2d');\n        data = context.getImageData(point.x, point.y, 1, 1);\n        if (data.data[3] === 0) {\n            if (this.projectionCanvas) {\n                point = point.divideBy(this.scale);\n                context = this.projectionCanvas.getContext('2d');\n                data = context.getImageData(point.x, point.y, 1, 1);\n                return new Color(\n                    data.data[0],\n                    data.data[1],\n                    data.data[2],\n                    data.data[3] / 255\n                );\n            }\n        \treturn StageMorph.uber.getPixelColor.call(this, aPoint);\n        }\n        return new Color(\n            data.data[0],\n            data.data[1],\n            data.data[2],\n            data.data[3] / 255\n        );\n \t}\n};\n\n// StageMorph accessing\n\nStageMorph.prototype.watchers = function (leftPos) {\n/*\n    answer an array of all currently visible watchers.\n    If leftPos is specified, filter the list for all\n    shown or hidden watchers whose left side equals\n    the given border (for automatic positioning)\n*/\n    return this.children.filter(morph => {\n        if (morph instanceof WatcherMorph) {\n            if (leftPos) {\n                return morph.left() === leftPos;\n            }\n            return morph.isVisible;\n        }\n        return false;\n    });\n};\n\n// StageMorph timer\n\nStageMorph.prototype.resetTimer = function () {\n    this.timerStart = Date.now();\n};\n\nStageMorph.prototype.getTimer = function () {\n    var elapsed = Math.floor((Date.now() - this.timerStart) / 100);\n    return elapsed / 10;\n};\n\n// StageMorph tempo\n\nStageMorph.prototype.setTempo = function (bpm) {\n    this.tempo = Math.max(20, (+bpm || 0));\n};\n\nStageMorph.prototype.changeTempo = function (delta) {\n    this.setTempo(this.getTempo() + (+delta || 0));\n};\n\nStageMorph.prototype.getTempo = function () {\n    return +this.tempo;\n};\n\n// StageMorph messages\n\nStageMorph.prototype.getLastMessage = function () {\n    return this.lastMessage || '';\n};\n\n// StageMorph Mouse Coordinates\n\nStageMorph.prototype.reportMouseX = function () {\n    var world = this.world();\n    if (world) {\n        return (world.hand.position().x - this.center().x) / this.scale;\n    }\n    return 0;\n};\n\nStageMorph.prototype.reportMouseY = function () {\n    var world = this.world();\n    if (world) {\n        return (this.center().y - world.hand.position().y) / this.scale;\n    }\n    return 0;\n};\n\n// StageMorph drag & drop\n\n// StageMorph.prototype.wantsDropOf = function (aMorph) {\n//     return aMorph instanceof SpriteMorph ||\n//         aMorph instanceof WatcherMorph ||\n//         aMorph instanceof ListWatcherMorph ||\n//         aMorph instanceof SpriteIconMorph;\n// };\n\nStageMorph.prototype.reactToDropOf = function (morph, hand) {\n    if (morph instanceof SpriteIconMorph) { // detach sprite from anchor\n        if (morph.object.anchor) {\n            morph.object.anchor.detachPart(morph.object);\n        }\n        this.world().add(morph);\n        morph.slideBackTo(hand.grabOrigin);\n    }\n};\n\n// StageMorph stepping\n\nStageMorph.prototype.step = function () {\n    var current, elapsed, leftover, ide, world = this.world();\n\n    // handle keyboard events\n    if (world.keyboardFocus === null) {\n        world.keyboardFocus = this;\n    }\n    if (world.currentKey === null) {\n        this.keyPressed = null;\n    }\n\n    // manage threads\n    if (this.enableCustomHatBlocks) {\n        this.stepGenericConditions();\n    }\n    if (this.isFastTracked && this.threads.processes.length) {\n        while (this.isFastTracked && (Date.now() - this.lastTime) < 15) {\n            this.threads.step(); // approx. 67 fps\n        }\n        this.changed();\n    } else {\n        this.threads.step();\n\n        // single-stepping hook:\n        if (this.threads.wantsToPause) {\n            ide = this.parentThatIsA(IDE_Morph);\n            if (ide) {\n                ide.controlBar.pauseButton.refresh();\n            }\n        }\n    }\n\n    // update watchers\n    current = Date.now();\n    elapsed = current - this.lastWatcherUpdate;\n    leftover = (1000 / this.watcherUpdateFrequency) - elapsed;\n    if (leftover < 1) {\n        this.watchers().forEach(w => w.update());\n        this.lastWatcherUpdate = Date.now();\n    }\n\n    // projection layer update (e.g. video frame capture)\n    if (this.continuousProjection && this.projectionSource) {\n        this.updateProjection();\n    }\n};\n\nStageMorph.prototype.updateProjection = function () {\n    var context = this.projectionLayer().getContext('2d');\n    context.save();\n    if (this.mirrorVideo) {\n        context.translate(this.dimensions.x, 0);\n        context.scale(-1, 1);\n    }\n    context.drawImage(\n        this.getProjectionImage(),\n        0,\n        0,\n        this.projectionSource.width,\n        this.projectionSource.height\n    );\n    if (this.videoMotion) {\n        this.videoMotion.addFrame(\n            context.getImageData(\n                0,\n                0,\n                this.projectionSource.width,\n                this.projectionSource.height\n            ).data\n        );\n    }\n    context.restore();\n    this.changed();\n};\n\nStageMorph.prototype.stepGenericConditions = function (stopAll) {\n    var hatCount = 0,\n        ide;\n    this.children.concat(this).forEach(morph => {\n        if (isSnapObject(morph)) {\n            morph.allGenericHatBlocks().forEach(block => {\n                hatCount += 1;\n                this.threads.doWhen(block, morph, stopAll);\n            });\n        }\n    });\n    if (!hatCount) {\n        this.enableCustomHatBlocks = false;\n        ide = this.parentThatIsA(IDE_Morph);\n        if (ide) {\n            ide.controlBar.stopButton.refresh();\n        }\n    }\n};\n\nStageMorph.prototype.developersMenu = function () {\n    var menu = StageMorph.uber.developersMenu.call(this);\n    menu.addItem(\n        \"stop\",\n        () => this.threads.stopAll(),\n        'terminate all running threads'\n    );\n    return menu;\n};\n\n// StageMorph keyboard events\n\nStageMorph.prototype.processKeyDown = function (event) {\n    this.processKeyEvent(\n        event,\n        this.fireKeyEvent\n    );\n};\n\nStageMorph.prototype.processKeyUp = function (event) {\n    this.processKeyEvent(\n        event,\n        this.removePressedKey\n    );\n};\n\nStageMorph.prototype.processKeyEvent = function (event, action) {\n    var keyName;\n\n    // this.inspectKeyEvent(event);\n    switch (event.keyCode) {\n    case 13:\n        keyName = 'enter';\n        if (event.ctrlKey || event.metaKey) {\n            keyName = 'ctrl enter';\n        } else if (event.shiftKey) {\n            keyName = 'shift enter';\n        }\n        break;\n    case 27:\n        keyName = 'esc';\n        break;\n    case 32:\n        keyName = 'space';\n        break;\n    case 37:\n        keyName = 'left arrow';\n        break;\n    case 39:\n        keyName = 'right arrow';\n        break;\n    case 38:\n        keyName = 'up arrow';\n        break;\n    case 40:\n        keyName = 'down arrow';\n        break;\n    default:\n        keyName = event.key || String.fromCharCode(\n            event.keyCode || event.charCode\n        );\n        if (event.ctrlKey || event.metaKey) {\n            keyName = 'ctrl ' + (event.shiftKey ? 'shift ' : '') + keyName;\n        }\n    }\n    action.call(this, keyName);\n};\n\nStageMorph.prototype.fireKeyEvent = function (key) {\n    var evt = key.toLowerCase(),\n        procs = [],\n        ide = this.parentThatIsA(IDE_Morph);\n\n    this.keysPressed[evt] = true;\n    if (evt === 'ctrl enter' && !ide.isAppMode) {\n        return this.fireGreenFlagEvent();\n    }\n    if (evt === 'shift enter') {\n        return this.editScripts();\n    }\n    if (evt === 'ctrl f') {\n        if (!ide.isAppMode) {ide.currentSprite.searchBlocks(); }\n        return;\n    }\n    if (evt === 'ctrl z') {\n        if (!ide.isAppMode) {ide.currentSprite.scripts.undrop(); }\n         return;\n    }\n    if (evt === 'ctrl shift z' || (evt === 'ctrl y')) {\n        if (!ide.isAppMode) {ide.currentSprite.scripts.redrop(); }\n         return;\n    }\n    if (evt === 'ctrl n') {\n        if (!ide.isAppMode) {ide.createNewProject(); }\n        return;\n    }\n    if (evt === 'ctrl o') {\n        if (!ide.isAppMode) {ide.openProjectsBrowser(); }\n        return;\n    }\n    if (evt === 'ctrl s') {\n        if (!ide.isAppMode) {ide.save(); }\n        return;\n    }\n    if (evt === 'ctrl shift s') {\n        if (!ide.isAppMode) {return ide.saveProjectsBrowser(); }\n        return;\n    }\n    if (evt === 'esc' && !ide.isAppMode) {\n        return this.fireStopAllEvent();\n    }\n    this.children.concat(this).forEach(morph => {\n        if (isSnapObject(morph)) {\n            morph.allHatBlocksForKey(evt).forEach(block =>\n                procs.push(this.threads.startProcess(\n                    block,\n                    morph,\n                    true // ignore running scripts, was: myself.isThreadSafe\n                ))\n            );\n        }\n    });\n    return procs;\n};\n\nStageMorph.prototype.removePressedKey = function (key) {\n    delete this.keysPressed[key.toLowerCase()];\n};\n\nStageMorph.prototype.processKeyPress = function (event) {\n    nop(event);\n};\n\nStageMorph.prototype.inspectKeyEvent\n    = CursorMorph.prototype.inspectKeyEvent;\n\nStageMorph.prototype.fireGreenFlagEvent = function () {\n    var procs = [],\n        ide = this.parentThatIsA(IDE_Morph);\n\n    this.removeAllClones();\n    this.children.concat(this).forEach(morph => {\n        if (isSnapObject(morph)) {\n            morph.allHatBlocksFor('__shout__go__').forEach(block =>\n                procs.push(this.threads.startProcess(\n                    block,\n                    morph,\n                    this.isThreadSafe\n                ))\n            );\n        }\n    });\n    if (ide) {\n        ide.controlBar.pauseButton.refresh();\n    }\n    return procs;\n};\n\nStageMorph.prototype.fireStopAllEvent = function () {\n    var ide = this.parentThatIsA(IDE_Morph);\n\n    this.threads.resumeAll(this.stage);\n\n    // experimental: run one step of a user-defined script\n    this.runStopScripts();\n\n    this.keysPressed = {};\n    this.threads.stopAll();\n\n    this.stopAllActiveSounds();\n    this.children.forEach(morph => {\n        if (morph.stopTalking) {\n            morph.stopTalking();\n        }\n    });\n    this.removeAllClones();\n    if (ide) {\n        ide.nextSteps([\n            nop,\n            () => this.stopAllActiveSounds(), // catch forever loops\n            () => this.stopProjection(),\n            () => ide.controlBar.pauseButton.refresh()\n        ]);\n    }\n};\n\nStageMorph.prototype.runStopScripts = function () {\n    // experimental: Allow each sprite to run one last step before termination\n    // usage example: Stop a robot or device associated with the sprite\n    this.receiveUserInteraction('stopped', true, true);\n    this.children.forEach(morph => {\n        if (morph instanceof SpriteMorph) {\n            morph.receiveUserInteraction('stopped', true, true);\n        }\n    });\n};\n\nStageMorph.prototype.removeAllClones = function () {\n    var clones = this.children.filter(morph =>\n            morph instanceof SpriteMorph && morph.isTemporary\n        );\n    clones.forEach(clone => {\n        this.threads.stopAllForReceiver(clone);\n        clone.detachFromAnchor();\n        clone.corpsify();\n        clone.destroy();\n    });\n    this.cloneCount = 0;\n};\n\nStageMorph.prototype.editScripts = function () {\n    var ide = this.parentThatIsA(IDE_Morph),\n        scripts,\n        sorted;\n    if (ide.isAppMode || !ScriptsMorph.prototype.enableKeyboard) {return; }\n    scripts = this.parentThatIsA(\n        IDE_Morph\n    ).currentSprite.scripts.selectForEdit(); // shadow on edit, if inherited\n    scripts.edit(scripts.position());\n    sorted = scripts.focus.sortedScripts();\n    if (sorted.length) {\n        scripts.focus.element = sorted[0];\n        if (scripts.focus.element instanceof HatBlockMorph) {\n            scripts.focus.nextCommand();\n        }\n    } else {\n        scripts.focus.moveBy(new Point(50, 50));\n    }\n    scripts.focus.fixLayout();\n};\n\n// StageMorph controlling generic WHEN hats\n\nStageMorph.prototype.pauseGenericHatBlocks = function () {\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (this.hasGenericHatBlocks() ||\n            ide.sprites.asArray().some(any => any.hasGenericHatBlocks())) {\n        this.enableCustomHatBlocks = true;\n        this.threads.pauseCustomHatBlocks = true;\n        ide.controlBar.stopButton.refresh();\n    }\n};\n\n// StageMorph block templates\n\nStageMorph.prototype.blockTemplates = function (category) {\n    var blocks = [], myself = this, varNames, button,\n        cat = category || 'motion', txt;\n\n    function block(selector) {\n        if (myself.hiddenPrimitives[selector]) {\n            return null;\n        }\n        var newBlock = SpriteMorph.prototype.blockForSelector(selector, true);\n        newBlock.isTemplate = true;\n        return newBlock;\n    }\n\n    function variableBlock(varName, isLocal) {\n        var newBlock = SpriteMorph.prototype.variableBlock(varName, isLocal);\n        newBlock.isDraggable = false;\n        newBlock.isTemplate = true;\n        return newBlock;\n    }\n\n\n    function watcherToggle(selector) {\n        if (myself.hiddenPrimitives[selector]) {\n            return null;\n        }\n        var info = SpriteMorph.prototype.blocks[selector];\n        return new ToggleMorph(\n            'checkbox',\n            this,\n            function () {\n                myself.toggleWatcher(\n                    selector,\n                    localize(info.spec),\n                    myself.blockColor[info.category]\n                );\n            },\n            null,\n            function () {\n                return myself.showingWatcher(selector);\n            },\n            null\n        );\n    }\n\n    function variableWatcherToggle(varName) {\n        return new ToggleMorph(\n            'checkbox',\n            this,\n            function () {\n                myself.toggleVariableWatcher(varName);\n            },\n            null,\n            function () {\n                return myself.showingVariableWatcher(varName);\n            },\n            null\n        );\n    }\n\n    function addVar(pair) {\n        if (pair) {\n            if (myself.isVariableNameInUse(pair[0])) {\n                myself.inform('that name is already in use');\n            } else {\n                myself.addVariable(pair[0], pair[1]);\n                myself.toggleVariableWatcher(pair[0], pair[1]);\n                myself.blocksCache[cat] = null;\n                myself.paletteCache[cat] = null;\n                myself.parentThatIsA(IDE_Morph).refreshPalette();\n            }\n        }\n    }\n\n    if (cat === 'motion') {\n\n        txt = new TextMorph(localize(\n            'Stage selected:\\nno motion primitives'\n        ));\n        txt.fontSize = 9;\n        txt.setColor(this.paletteTextColor);\n        blocks.push(txt);\n        blocks.push('=');\n        blocks.push(this.makeBlockButton(cat));\n\n    } else if (cat === 'looks') {\n\n        blocks.push(block('doSwitchToCostume'));\n        blocks.push(block('doWearNextCostume'));\n        blocks.push(watcherToggle('getCostumeIdx'));\n        blocks.push(block('getCostumeIdx'));\n        blocks.push('-');\n        blocks.push(block('reportGetImageAttribute'));\n        blocks.push(block('reportNewCostumeStretched'));\n        blocks.push(block('reportNewCostume'));\n        blocks.push('-');\n        blocks.push(block('changeEffect'));\n        blocks.push(block('setEffect'));\n        blocks.push(block('clearEffects'));\n        blocks.push(block('getEffect'));\n        blocks.push('-');\n        blocks.push(block('show'));\n        blocks.push(block('hide'));\n        blocks.push(watcherToggle('reportShown'));\n        blocks.push(block('reportShown'));\n\n    // for debugging: ///////////////\n\n        if (this.world().isDevMode) {\n            blocks.push('-');\n            txt = new TextMorph(localize(\n                'development mode \\ndebugging primitives:'\n            ));\n            txt.fontSize = 9;\n            txt.setColor(this.paletteTextColor);\n            blocks.push(txt);\n            blocks.push('-');\n            blocks.push(block('log'));\n            blocks.push(block('alert'));\n            blocks.push('-');\n            blocks.push(block('doScreenshot'));\n        }\n\n    /////////////////////////////////\n\n        blocks.push('=');\n        blocks.push(this.makeBlockButton(cat));\n\n    } else if (cat === 'sound') {\n\n        blocks.push(block('playSound'));\n        blocks.push(block('doPlaySoundUntilDone'));\n        blocks.push(block('doStopAllSounds'));\n        blocks.push('-');\n        blocks.push(block('doPlaySoundAtRate'));\n        blocks.push(block('reportGetSoundAttribute'));\n        blocks.push(block('reportNewSoundFromSamples'));\n        blocks.push('-');\n        blocks.push(block('doRest'));\n        blocks.push(block('doPlayNote'));\n        blocks.push(block('doSetInstrument'));\n        blocks.push('-');\n        blocks.push(block('doChangeTempo'));\n        blocks.push(block('doSetTempo'));\n        blocks.push(watcherToggle('getTempo'));\n        blocks.push(block('getTempo'));\n        blocks.push('-');\n        blocks.push(block('changeVolume'));\n        blocks.push(block('setVolume'));\n        blocks.push(watcherToggle('getVolume'));\n        blocks.push(block('getVolume'));\n        blocks.push('-');\n        blocks.push(block('changePan'));\n        blocks.push(block('setPan'));\n        blocks.push(watcherToggle('getPan'));\n        blocks.push(block('getPan'));\n        blocks.push('-');\n        blocks.push(block('playFreq'));\n        blocks.push(block('stopFreq'));\n\n    // for debugging: ///////////////\n\n        if (this.world().isDevMode) {\n            blocks.push('-');\n            txt = new TextMorph(localize(\n                'development mode \\ndebugging primitives:'\n            ));\n            txt.fontSize = 9;\n            txt.setColor(this.paletteTextColor);\n            blocks.push(txt);\n            blocks.push('-');\n            blocks.push(block('doPlayFrequency'));\n        }\n\n    /////////////////////////////////\n\n        blocks.push('=');\n        blocks.push(this.makeBlockButton(cat));\n\n    } else if (cat === 'pen') {\n\n        blocks.push(block('clear'));\n        blocks.push('-');\n        blocks.push(block('setBackgroundColor'));\n        blocks.push(block('changeBackgroundHSVA'));\n        blocks.push(block('setBackgroundHSVA'));\n        blocks.push('-');\n        blocks.push(block('reportPenTrailsAsCostume'));\n        blocks.push('-');\n        blocks.push(block('doPasteOn'));\n        blocks.push(block('doCutFrom'));\n        blocks.push('=');\n        blocks.push(this.makeBlockButton(cat));\n\n    } else if (cat === 'control') {\n\n        blocks.push(block('receiveGo'));\n        blocks.push(block('receiveKey'));\n        blocks.push(block('receiveInteraction'));\n        blocks.push(block('receiveCondition'));\n        blocks.push(block('receiveMessage'));\n        blocks.push('-');\n        blocks.push(block('doBroadcast'));\n        blocks.push(block('doBroadcastAndWait'));\n        blocks.push(block('doSend'));\n        blocks.push(watcherToggle('getLastMessage'));\n        blocks.push(block('getLastMessage'));\n        blocks.push('-');\n        blocks.push(block('doWarp'));\n        blocks.push('-');\n        blocks.push(block('doWait'));\n        blocks.push(block('doWaitUntil'));\n        blocks.push('-');\n        blocks.push(block('doForever'));\n        blocks.push(block('doRepeat'));\n        blocks.push(block('doUntil'));\n        blocks.push(block('doFor'));\n        blocks.push('-');\n        blocks.push(block('doIf'));\n        blocks.push(block('doIfElse'));\n        blocks.push(block('reportIfElse'));\n        blocks.push('-');\n        blocks.push(block('doReport'));\n        blocks.push(block('doStopThis'));\n        blocks.push('-');\n        blocks.push(block('doRun'));\n        blocks.push(block('fork'));\n        blocks.push(block('evaluate'));\n        blocks.push('-');\n        blocks.push(block('doTellTo'));\n        blocks.push(block('reportAskFor'));\n        blocks.push('-');\n        blocks.push(block('doCallCC'));\n        blocks.push(block('reportCallCC'));\n        blocks.push('-');\n        blocks.push(block('createClone'));\n        blocks.push(block('newClone'));\n        blocks.push('-');\n        blocks.push(block('doPauseAll'));\n        blocks.push('=');\n        blocks.push(this.makeBlockButton(cat));\n\n    } else if (cat === 'sensing') {\n\n        blocks.push(block('doAsk'));\n        blocks.push(watcherToggle('getLastAnswer'));\n        blocks.push(block('getLastAnswer'));\n        blocks.push('-');\n        blocks.push(watcherToggle('reportMouseX'));\n        blocks.push(block('reportMouseX'));\n        blocks.push(watcherToggle('reportMouseY'));\n        blocks.push(block('reportMouseY'));\n        blocks.push(block('reportMouseDown'));\n        blocks.push('-');\n        blocks.push(block('reportKeyPressed'));\n        blocks.push('-');\n        blocks.push(block('reportAspect'));\n        blocks.push('-');\n        blocks.push(block('doResetTimer'));\n        blocks.push(watcherToggle('getTimer'));\n        blocks.push(block('getTimer'));\n        blocks.push('-');\n        blocks.push(block('reportAttributeOf'));\n\n        if (SpriteMorph.prototype.enableFirstClass) {\n            blocks.push(block('reportGet'));\n        }\n\n        blocks.push(block('reportObject'));\n        blocks.push('-');\n        blocks.push(block('reportURL'));\n        blocks.push(block('reportAudio'));\n        blocks.push(block('reportVideo'));\n        blocks.push(block('doSetVideoTransparency'));\n        blocks.push('-');\n        blocks.push(block('reportGlobalFlag'));\n        blocks.push(block('doSetGlobalFlag'));\n        blocks.push('-');\n        blocks.push(block('reportDate'));\n\n    // for debugging: ///////////////\n\n        if (this.world().isDevMode) {\n\n            blocks.push('-');\n            txt = new TextMorph(localize(\n                'development mode \\ndebugging primitives:'\n            ));\n            txt.fontSize = 9;\n            txt.setColor(this.paletteTextColor);\n            blocks.push(txt);\n            blocks.push('-');\n            blocks.push(watcherToggle('reportThreadCount'));\n            blocks.push(block('reportThreadCount'));\n            blocks.push(block('reportStackSize'));\n            blocks.push(block('reportFrameCount'));\n        }\n\n    /////////////////////////////////\n\n        blocks.push('=');\n        blocks.push(this.makeBlockButton(cat));\n\n    } else if (cat === 'operators') {\n\n        blocks.push(block('reifyScript'));\n        blocks.push(block('reifyReporter'));\n        blocks.push(block('reifyPredicate'));\n        blocks.push('#');\n        blocks.push('-');\n        blocks.push(block('reportSum'));\n        blocks.push(block('reportDifference'));\n        blocks.push(block('reportProduct'));\n        blocks.push(block('reportQuotient'));\n        blocks.push(block('reportPower'));\n        blocks.push('-');\n        blocks.push(block('reportModulus'));\n        blocks.push(block('reportRound'));\n        blocks.push(block('reportMonadic'));\n        blocks.push(block('reportRandom'));\n        blocks.push('-');\n        blocks.push(block('reportLessThan'));\n        blocks.push(block('reportEquals'));\n        blocks.push(block('reportGreaterThan'));\n        blocks.push('-');\n        blocks.push(block('reportAnd'));\n        blocks.push(block('reportOr'));\n        blocks.push(block('reportNot'));\n        blocks.push(block('reportBoolean'));\n        blocks.push('-');\n        blocks.push(block('reportJoinWords'));\n        blocks.push(block('reportTextSplit'));\n        blocks.push(block('reportLetter'));\n        blocks.push(block('reportStringSize'));\n        blocks.push('-');\n        blocks.push(block('reportUnicode'));\n        blocks.push(block('reportUnicodeAsLetter'));\n        blocks.push('-');\n        blocks.push(block('reportIsA'));\n        blocks.push(block('reportIsIdentical'));\n\n        if (true) { // (Process.prototype.enableJS) {\n            blocks.push('-');\n            blocks.push(block('reportJSFunction'));\n            if (Process.prototype.enableCompiling) {\n                blocks.push(block('reportCompiled'));\n            }\n        }\n\n    // for debugging: ///////////////\n\n        if (this.world().isDevMode) {\n            blocks.push('-');\n            txt = new TextMorph(\n                'development mode \\ndebugging primitives:'\n            );\n            txt.fontSize = 9;\n            txt.setColor(this.paletteTextColor);\n            blocks.push(txt);\n            blocks.push('-');\n            blocks.push(block('reportTypeOf'));\n            blocks.push(block('reportTextFunction'));\n        }\n\n    //////////////////////////////////\n\n        blocks.push('=');\n        blocks.push(this.makeBlockButton(cat));\n\n    } else if (cat === 'variables') {\n\n        button = new PushButtonMorph(\n            null,\n            function () {\n                new VariableDialogMorph(\n                    null,\n                    addVar,\n                    myself\n                ).prompt(\n                    'Variable name',\n                    null,\n                    myself.world()\n                );\n            },\n            'Make a variable'\n        );\n        blocks.push(button);\n\n        if (this.variables.allNames().length > 0) {\n            button = new PushButtonMorph(\n                null,\n                function () {\n                    var menu = new MenuMorph(\n                        myself.deleteVariable,\n                        null,\n                        myself\n                    );\n                    myself.variables.allNames().forEach(name =>\n                        menu.addItem(\n                            name,\n                            name,\n                            null,\n                            null,\n                            null,\n                            null,\n                            null,\n                            null,\n                            true // verbatim - don't translate\n                        )\n                    );\n                    menu.popUpAtHand(myself.world());\n                },\n                'Delete a variable'\n            );\n            blocks.push(button);\n        }\n\n        blocks.push('-');\n\n        varNames = this.reachableGlobalVariableNames(true);\n        if (varNames.length > 0) {\n            varNames.forEach(name => {\n                blocks.push(variableWatcherToggle(name));\n                blocks.push(variableBlock(name));\n            });\n            blocks.push('-');\n        }\n\n        varNames = this.allLocalVariableNames(true);\n        if (varNames.length > 0) {\n            varNames.forEach(name => {\n                blocks.push(variableWatcherToggle(name));\n                blocks.push(variableBlock(name, true));\n            });\n            blocks.push('-');\n        }\n\n        blocks.push(block('doSetVar'));\n        blocks.push(block('doChangeVar'));\n        blocks.push(block('doShowVar'));\n        blocks.push(block('doHideVar'));\n        blocks.push(block('doDeclareVariables'));\n        blocks.push('=');\n        blocks.push(block('reportNewList'));\n        blocks.push(block('reportNumbers'));\n        blocks.push('-');\n        blocks.push(block('reportCONS'));\n        blocks.push(block('reportListItem'));\n        blocks.push(block('reportCDR'));\n        blocks.push('-');\n        blocks.push(block('reportListLength'));\n        blocks.push(block('reportListIndex'));\n        blocks.push(block('reportListContainsItem'));\n        blocks.push(block('reportListIsEmpty'));\n        blocks.push('-');\n        blocks.push(block('reportMap'));\n        blocks.push(block('reportKeep'));\n        blocks.push(block('reportFindFirst'));\n        blocks.push(block('reportCombine'));\n        blocks.push('-');\n        blocks.push(block('doForEach'));\n        blocks.push('-');\n        blocks.push(block('reportConcatenatedLists'));\n        blocks.push('-');\n        blocks.push(block('doAddToList'));\n        blocks.push(block('doDeleteFromList'));\n        blocks.push(block('doInsertInList'));\n        blocks.push(block('doReplaceInList'));\n\n    // for debugging: ///////////////\n\n        if (this.world().isDevMode) {\n            blocks.push('-');\n            txt = new TextMorph(localize(\n                'development mode \\ndebugging primitives:'\n            ));\n            txt.fontSize = 9;\n            txt.setColor(this.paletteTextColor);\n            blocks.push(txt);\n            blocks.push('-');\n            blocks.push(block('doShowTable'));\n        }\n\n    /////////////////////////////////\n\n        blocks.push('=');\n\n        if (StageMorph.prototype.enableCodeMapping) {\n            blocks.push(block('doMapCodeOrHeader'));\n            blocks.push(block('doMapValueCode'));\n            blocks.push(block('doMapListCode'));\n            blocks.push('-');\n            blocks.push(block('reportMappedCode'));\n            blocks.push('=');\n        }\n\n        blocks.push(this.makeBlockButton());\n    }\n    return blocks;\n};\n\n// StageMorph primitives\n\nStageMorph.prototype.clear = function () {\n    this.clearPenTrails();\n};\n\n// StageMorph user menu\n\nStageMorph.prototype.userMenu = function () {\n    var ide = this.parentThatIsA(IDE_Morph),\n        menu = new MenuMorph(this);\n\n    if (ide && ide.isAppMode) {\n        // menu.addItem('help', 'nop');\n        return menu;\n    }\n    menu.addItem(\"edit\", 'edit');\n    menu.addItem(\"show all\", 'showAll');\n    menu.addItem(\n        \"pic...\",\n        () => ide.saveCanvasAs(this.fullImage(), this.name),\n        'save a picture\\nof the stage'\n    );\n    menu.addLine();\n    menu.addItem(\n        'pen trails',\n        () => {\n            var costume = ide.currentSprite.reportPenTrailsAsCostume().copy();\n            ide.currentSprite.addCostume(costume);\n            ide.currentSprite.wearCostume(costume);\n            ide.hasChangedMedia = true;\n            ide.spriteBar.tabBar.tabTo('costumes');\n        },\n        ide.currentSprite instanceof SpriteMorph ?\n            'turn all pen trails and stamps\\n' +\n                'into a new costume for the\\ncurrently selected sprite'\n                    : 'turn all pen trails and stamps\\n' +\n                        'into a new background for the stage'\n    );\n    if (this.trailsLog.length) {\n        menu.addItem(\n            'svg...',\n            'exportTrailsLogAsSVG',\n            'export pen trails\\nline segments as SVG'\n        );\n    }\n    return menu;\n};\n\nStageMorph.prototype.showAll = function () {\n    this.children.forEach(m => {\n        if (m instanceof SpriteMorph) {\n            if (!m.anchor) {\n                m.show();\n                m.keepWithin(this);\n            }\n        } else {\n            m.show();\n            m.keepWithin(this);\n            if (m.fixLayout) {m.fixLayout(); }\n        }\n    });\n};\n\nStageMorph.prototype.edit = SpriteMorph.prototype.edit;\n\nStageMorph.prototype.fullImage = Morph.prototype.fullImage;\n\n// StageMorph thumbnail\n\nStageMorph.prototype.thumbnail = function (extentPoint, recycleMe) {\n    // answer a new Canvas of extentPoint dimensions containing\n    // my thumbnail representation keeping the originial aspect ratio\n    // a \"recycleMe canvas can be passed for re-use\n    return this.fancyThumbnail(extentPoint, null, false, recycleMe);\n};\n\nStageMorph.prototype.fancyThumbnail = function (\n    extentPoint,\n    excludedSprite,\n    nonRetina,\n    recycleMe\n) {\n    var src = this.getImage(),\n        scale = Math.min(\n            (extentPoint.x / src.width),\n            (extentPoint.y / src.height)\n        ),\n        trg = newCanvas(extentPoint, nonRetina, recycleMe),\n        ctx = trg.getContext('2d'),\n        fb,\n        fimg;\n\n    ctx.save();\n    ctx.scale(scale, scale);\n    ctx.drawImage(\n        src,\n        0,\n        0\n    );\n    ctx.drawImage(\n        this.penTrails(),\n        0,\n        0,\n        this.dimensions.x * this.scale,\n        this.dimensions.y * this.scale\n    );\n    if (this.projectionSource) {\n        ctx.save();\n        ctx.globalAlpha = 1 - (this.projectionTransparency / 100);\n        ctx.drawImage(\n            this.projectionLayer(),\n            0,\n            0,\n            this.dimensions.x * this.scale,\n            this.dimensions.y * this.scale\n        );\n        ctx.restore();\n    }\n    this.children.forEach(morph => {\n        if (morph.isVisible && (morph !== excludedSprite)) {\n            fb = morph.fullBounds();\n            fimg = morph.fullImage();\n            if (fimg.width && fimg.height) {\n                ctx.drawImage(\n                    morph.fullImage(),\n                    fb.origin.x - this.bounds.origin.x,\n                    fb.origin.y - this.bounds.origin.y\n                );\n            }\n        }\n    });\n    ctx.restore();\n    return trg;\n};\n\n// StageMorph - exporting the pen trails as SVG\n\nStageMorph.prototype.exportTrailsLogAsSVG = function () {\n    var ide = this.parentThatIsA(IDE_Morph);\n\n    ide.saveFileAs(\n        this.trailsLogAsSVG().src,\n        'image/svg',\n        ide.projectName || this.name\n    );\n};\n\nStageMorph.prototype.trailsLogAsSVG = function () {\n    var bottomLeft = this.trailsLog[0][0],\n        topRight = bottomLeft,\n        maxWidth = this.trailsLog[0][3],\n        shift,\n        box,\n        p1, p2,\n        svg;\n\n    // determine bounding box and max line width\n    this.trailsLog.forEach(line => {\n        bottomLeft = bottomLeft.min(line[0]);\n        bottomLeft = bottomLeft.min(line[1]);\n        topRight = topRight.max(line[0]);\n        topRight = topRight.max(line[1]);\n        maxWidth = Math.max(maxWidth, line[3]);\n    });\n    box = bottomLeft.corner(topRight).expandBy(maxWidth / 2);\n    shift = new Point(-bottomLeft.x, topRight.y).translateBy(maxWidth / 2);\n    svg = '<svg xmlns=\"http://www.w3.org/2000/svg\" ' +\n        'preserveAspectRatio=\"none\" ' +\n        'viewBox=\"0 0 ' + box.width() + ' ' + box.height() + '\" ' +\n        'width=\"' + box.width() + '\" height=\"' + box.height() + '\" ' +\n        // 'style=\"background-color:black\" ' + // for supporting backgrounds\n        '>';\n    svg += '<!-- Generated by Snap! - http://snap.berkeley.edu/ -->';\n\n    // for debugging the viewBox:\n    // svg += '<rect width=\"100%\" height=\"100%\" fill=\"black\"/>'\n\n    this.trailsLog.forEach(line => {\n        p1 = this.normalizePoint(line[0]).translateBy(shift);\n        p2 = this.normalizePoint(line[1]).translateBy(shift);\n        svg += '<line x1=\"' + p1.x + '\" y1=\"' + p1.y +\n            '\" x2=\"' + p2.x + '\" y2=\"' + p2.y + '\" ' +\n            'style=\"stroke:' + line[2].toRGBstring() + ';' +\n            'stroke-opacity:' + line[2].a + ';' +\n            'stroke-width:' + line[3] +\n            ';stroke-linecap:' + line[4] +\n            '\" />';\n    });\n    svg += '</svg>';\n    return {\n        src : svg,\n        rot : new Point(-box.origin.x, box.corner.y)\n    };\n};\n\nStageMorph.prototype.normalizePoint = function (snapPoint) {\n    return new Point(snapPoint.x, -snapPoint.y);\n};\n\n// StageMorph hiding and showing:\n\n/*\n    override the inherited behavior to recursively hide/show all\n    children.\n*/\n\nStageMorph.prototype.hide = function () {\n    this.isVisible = false;\n    this.changed();\n};\n\nStageMorph.prototype.show = function () {\n    this.isVisible = true;\n    this.changed();\n};\n\nStageMorph.prototype.reportShown = SpriteMorph.prototype.reportShown;\n\n// StageMorph cloning override\n\nStageMorph.prototype.createClone = nop;\nStageMorph.prototype.newClone = nop;\n\n// StageMorph background color setting\n\nStageMorph.prototype.setColorComponentHSVA = function (idx, num) {\n    var n = +num;\n\n    idx = +idx;\n    if (idx < 0 || idx > 3) {return; }\n    if (idx == 0) {\n        if (n < 0 || n > 100) { // wrap the hue\n            n = (n < 0 ? 100 : 0) + n % 100;\n        }\n    } else {\n        n = Math.min(100, Math.max(0, n));\n    }\n    if (idx === 3) {\n        this.color.a = 1 - n / 100;\n    } else {\n        this.cachedHSV[idx] = n / 100;\n        this.color.set_hsv.apply(this.color, this.cachedHSV);\n    }\n    this.rerender();\n};\n\nStageMorph.prototype.getColorComponentHSLA\n    = SpriteMorph.prototype.getColorComponentHSLA;\n\nStageMorph.prototype.changeColorComponentHSVA\n    = SpriteMorph.prototype.changeColorComponentHSVA;\n\nStageMorph.prototype.setColor = function (aColor) {\n    if (!this.color.eq(aColor, true)) { // observeAlpha\n        this.color = aColor.copy();\n        this.rerender();\n        this.cachedHSV = this.color.hsv();\n    }\n};\n\nStageMorph.prototype.setBackgroundColor = StageMorph.prototype.setColor;\n\nStageMorph.prototype.getPenAttribute\n    = SpriteMorph.prototype.getPenAttribute;\n\n// StageMorph printing on another sprite:\n\nStageMorph.prototype.blitOn = SpriteMorph.prototype.blitOn;\n\n// StageMorph pseudo-inherited behavior\n\nStageMorph.prototype.categories = SpriteMorph.prototype.categories;\nStageMorph.prototype.blockColor = SpriteMorph.prototype.blockColor;\nStageMorph.prototype.paletteColor = SpriteMorph.prototype.paletteColor;\nStageMorph.prototype.setName = SpriteMorph.prototype.setName;\nStageMorph.prototype.makeBlockButton = SpriteMorph.prototype.makeBlockButton;\nStageMorph.prototype.makeBlock = SpriteMorph.prototype.makeBlock;\nStageMorph.prototype.palette = SpriteMorph.prototype.palette;\nStageMorph.prototype.freshPalette = SpriteMorph.prototype.freshPalette;\nStageMorph.prototype.blocksMatching = SpriteMorph.prototype.blocksMatching;\nStageMorph.prototype.searchBlocks = SpriteMorph.prototype.searchBlocks;\nStageMorph.prototype.reporterize = SpriteMorph.prototype.reporterize;\nStageMorph.prototype.showingWatcher = SpriteMorph.prototype.showingWatcher;\nStageMorph.prototype.addVariable = SpriteMorph.prototype.addVariable;\nStageMorph.prototype.deleteVariable = SpriteMorph.prototype.deleteVariable;\n\n// StageMorph neighbor detection\n\nStageMorph.prototype.neighbors = SpriteMorph.prototype.neighbors;\nStageMorph.prototype.perimeter = SpriteMorph.prototype.perimeter;\n\n// StageMorph block rendering\n\nStageMorph.prototype.doScreenshot = SpriteMorph.prototype.doScreenshot;\nStageMorph.prototype.newCostumeName = SpriteMorph.prototype.newCostumeName;\nStageMorph.prototype.blockForSelector = SpriteMorph.prototype.blockForSelector;\n\n// StageMorph variable watchers (for palette checkbox toggling)\n\nStageMorph.prototype.findVariableWatcher\n    = SpriteMorph.prototype.findVariableWatcher;\n\nStageMorph.prototype.toggleVariableWatcher\n    = SpriteMorph.prototype.toggleVariableWatcher;\n\nStageMorph.prototype.showingVariableWatcher\n    = SpriteMorph.prototype.showingVariableWatcher;\n\nStageMorph.prototype.deleteVariableWatcher\n    = SpriteMorph.prototype.deleteVariableWatcher;\n\n// StageMorph background management\n\nStageMorph.prototype.addCostume\n    = SpriteMorph.prototype.addCostume;\n\nStageMorph.prototype.wearCostume\n    = SpriteMorph.prototype.wearCostume;\n\nStageMorph.prototype.getCostumeIdx\n    = SpriteMorph.prototype.getCostumeIdx;\n\nStageMorph.prototype.doWearNextCostume\n    = SpriteMorph.prototype.doWearNextCostume;\n\nStageMorph.prototype.doWearPreviousCostume\n    = SpriteMorph.prototype.doWearPreviousCostume;\n\nStageMorph.prototype.doSwitchToCostume\n    = SpriteMorph.prototype.doSwitchToCostume;\n\nStageMorph.prototype.reportCostumes\n    = SpriteMorph.prototype.reportCostumes;\n\n// StageMorph graphic effects\n\nStageMorph.prototype.graphicsChanged\n    = SpriteMorph.prototype.graphicsChanged;\n\nStageMorph.prototype.applyGraphicsEffects\n    = SpriteMorph.prototype.applyGraphicsEffects;\n\nStageMorph.prototype.setEffect\n    = SpriteMorph.prototype.setEffect;\n\nStageMorph.prototype.getEffect\n    = SpriteMorph.prototype.getEffect;\n\nStageMorph.prototype.getGhostEffect\n    = SpriteMorph.prototype.getGhostEffect;\n\nStageMorph.prototype.changeEffect\n    = SpriteMorph.prototype.changeEffect;\n\nStageMorph.prototype.clearEffects\n    = SpriteMorph.prototype.clearEffects;\n\n// StageMorph sound management\n\nStageMorph.prototype.addSound\n    = SpriteMorph.prototype.addSound;\n\nStageMorph.prototype.doPlaySound\n    = SpriteMorph.prototype.doPlaySound;\n\nStageMorph.prototype.stopAllActiveSounds = function () {\n    this.activeSounds.forEach(audio => audio.pause());\n    this.activeSounds = [];\n    if (this.microphone.modifier && this.microphone.isReady) {\n        this.microphone.stop();\n    }\n};\n\nStageMorph.prototype.pauseAllActiveSounds = function () {\n    this.activeSounds.forEach(audio => audio.pause());\n};\n\nStageMorph.prototype.resumeAllActiveSounds = function () {\n    this.activeSounds.forEach(audio => audio.play());\n};\n\nStageMorph.prototype.reportSounds\n    = SpriteMorph.prototype.reportSounds;\n\nStageMorph.prototype.newSoundName\n    = SpriteMorph.prototype.newSoundName;\n\n// StageMorph volume\n\nStageMorph.prototype.setVolume\n    = SpriteMorph.prototype.setVolume;\n\nStageMorph.prototype.changeVolume\n    = SpriteMorph.prototype.changeVolume;\n\nStageMorph.prototype.getVolume\n    = SpriteMorph.prototype.getVolume;\n\nStageMorph.prototype.getGainNode\n    = SpriteMorph.prototype.getGainNode;\n\nStageMorph.prototype.audioContext\n    = SpriteMorph.prototype.audioContext;\n\n// StageMorph stereo panning\n\nStageMorph.prototype.setPan\n    = SpriteMorph.prototype.setPan;\n\nStageMorph.prototype.changePan\n    = SpriteMorph.prototype.changePan;\n\nStageMorph.prototype.getPan\n    = SpriteMorph.prototype.getPan;\n\nStageMorph.prototype.getPannerNode\n    = SpriteMorph.prototype.getPannerNode;\n\n// StageMorph frequency player\n\nStageMorph.prototype.playFreq\n    = SpriteMorph.prototype.playFreq;\n\nStageMorph.prototype.stopFreq\n    = SpriteMorph.prototype.stopFreq;\n\n// StageMorph non-variable watchers\n\nStageMorph.prototype.toggleWatcher\n    = SpriteMorph.prototype.toggleWatcher;\n\nStageMorph.prototype.showingWatcher\n    = SpriteMorph.prototype.showingWatcher;\n\nStageMorph.prototype.watcherFor =\n    SpriteMorph.prototype.watcherFor;\n\nStageMorph.prototype.getLastAnswer\n    = SpriteMorph.prototype.getLastAnswer;\n\nStageMorph.prototype.reportThreadCount\n    = SpriteMorph.prototype.reportThreadCount;\n\n// StageMorph dimension getters\n\nStageMorph.prototype.xCenter = function () {\n    return 0;\n};\n\nStageMorph.prototype.yCenter = function () {\n    return 0;\n};\n\nStageMorph.prototype.xLeft = function () {\n    return this.dimensions.x * -0.5;\n};\n\nStageMorph.prototype.xRight = function () {\n   return this.dimensions.x / 2;\n};\n\nStageMorph.prototype.yTop = function () {\n    return this.dimensions.y / 2;\n};\n\nStageMorph.prototype.yBottom = function () {\n   return this.dimensions.y * -0.5;\n};\n\n// StageMorph message broadcasting\n\nStageMorph.prototype.allMessageNames\n    = SpriteMorph.prototype.allMessageNames;\n\nStageMorph.prototype.allSendersOf\n    = SpriteMorph.prototype.allSendersOf;\n\nStageMorph.prototype.allHatBlocksFor\n    = SpriteMorph.prototype.allHatBlocksFor;\n\nStageMorph.prototype.allHatBlocksForKey\n    = SpriteMorph.prototype.allHatBlocksForKey;\n\nStageMorph.prototype.allHatBlocksForInteraction\n    = SpriteMorph.prototype.allHatBlocksForInteraction;\n\nStageMorph.prototype.hasGenericHatBlocks\n    = SpriteMorph.prototype.hasGenericHatBlocks;\n\nStageMorph.prototype.allGenericHatBlocks\n    = SpriteMorph.prototype.allGenericHatBlocks;\n\nStageMorph.prototype.allScripts\n    = SpriteMorph.prototype.allScripts;\n\n// StageMorph events\n\nStageMorph.prototype.mouseClickLeft\n    = SpriteMorph.prototype.mouseClickLeft;\n\nStageMorph.prototype.mouseEnter\n    = SpriteMorph.prototype.mouseEnter;\n\nStageMorph.prototype.mouseLeave = function () {\n    this.receiveUserInteraction('mouse-departed');\n};\n\nStageMorph.prototype.mouseDownLeft\n    = SpriteMorph.prototype.mouseDownLeft;\n\nStageMorph.prototype.mouseScroll\n    = SpriteMorph.prototype.mouseScroll;\n\nStageMorph.prototype.receiveUserInteraction\n    = SpriteMorph.prototype.receiveUserInteraction;\n\n// StageMorph custom blocks\n\nStageMorph.prototype.deleteAllBlockInstances\n    = SpriteMorph.prototype.deleteAllBlockInstances;\n\nStageMorph.prototype.allBlockInstances\n    = SpriteMorph.prototype.allBlockInstances;\n\nStageMorph.prototype.allLocalBlockInstances\n    = SpriteMorph.prototype.allLocalBlockInstances;\n\nStageMorph.prototype.allEditorBlockInstances\n    = SpriteMorph.prototype.allEditorBlockInstances;\n\nStageMorph.prototype.paletteBlockInstance\n    = SpriteMorph.prototype.paletteBlockInstance;\n\nStageMorph.prototype.usesBlockInstance\n    = SpriteMorph.prototype.usesBlockInstance;\n\nStageMorph.prototype.doubleDefinitionsFor\n    = SpriteMorph.prototype.doubleDefinitionsFor;\n\nStageMorph.prototype.replaceDoubleDefinitionsFor\n    = SpriteMorph.prototype.replaceDoubleDefinitionsFor;\n\nStageMorph.prototype.allInvocationsOf\n    = SpriteMorph.prototype.allInvocationsOf;\n\nStageMorph.prototype.allIndependentInvocationsOf\n    = SpriteMorph.prototype.allInvocationsOf;\n\nStageMorph.prototype.allDependentInvocationsOf\n    = SpriteMorph.prototype.allInvocationsOf;\n\n// StageMorph inheritance support - general\n\nStageMorph.prototype.specimens = function () {\n    return [];\n};\n\nStageMorph.prototype.allSpecimens = function () {\n    return [];\n};\n\nStageMorph.prototype.shadowAttribute = nop;\n\n// StageMorph inheritance support - attributes\n\nStageMorph.prototype.inheritsAttribute = function () {\n    return false;\n};\n\n// StageMorph inheritance support - variables\n\nStageMorph.prototype.isVariableNameInUse\n    = SpriteMorph.prototype.isVariableNameInUse;\n\nStageMorph.prototype.globalVariables\n    = SpriteMorph.prototype.globalVariables;\n\nStageMorph.prototype.inheritedVariableNames = function () {\n    return [];\n};\n\nStageMorph.prototype.allLocalVariableNames\n\t= SpriteMorph.prototype.allLocalVariableNames;\n\nStageMorph.prototype.reachableGlobalVariableNames\n\t= SpriteMorph.prototype.reachableGlobalVariableNames;\n\n// StageMorph inheritance - custom blocks\n\nStageMorph.prototype.getMethod\n    = SpriteMorph.prototype.getMethod;\n\nStageMorph.prototype.getLocalMethod\n    = SpriteMorph.prototype.getLocalMethod;\n\nStageMorph.prototype.ownBlocks\n    = SpriteMorph.prototype.ownBlocks;\n\nStageMorph.prototype.allBlocks = function (valuesOnly) {\n    var dict = this.ownBlocks();\n    if (valuesOnly) {\n        return Object.keys(dict).map(key => dict[key]);\n    }\n    return dict;\n};\n\nStageMorph.prototype.inheritedBlocks = function () {\n    return [];\n};\n\n// StageMorph variable refactoring\n\nStageMorph.prototype.hasSpriteVariable\n    = SpriteMorph.prototype.hasSpriteVariable;\n\nStageMorph.prototype.refactorVariableInstances\n    = SpriteMorph.prototype.refactorVariableInstances;\n\n// StageMorph pen trails as costume\n\nStageMorph.prototype.reportPenTrailsAsCostume = function () {\n    return new Costume(\n        this.trailsCanvas,\n        this.newCostumeName(localize('Background'))\n    );\n};\n\n// StageMorph scanning global custom blocks for message sends\n\nStageMorph.prototype.globalBlocksSending = function (message, receiverName) {\n    // \"transitive hull\"\n    var all = this.globalBlocks.filter(\n            def =>def.isSending(message, receiverName)\n        );\n    this.globalBlocks.forEach(def => {\n        if (def.collectDependencies().some(dep => contains(all, dep))) {\n            all.push(def);\n        }\n    });\n    return all;\n};\n\n// SpriteBubbleMorph ////////////////////////////////////////////////////////\n\n/*\n    I am a sprite's scaleable speech bubble. I rely on SpriteMorph\n    for my preferences settings\n*/\n\n// SpriteBubbleMorph inherits from SpeechBubbleMorph:\n\nSpriteBubbleMorph.prototype = new SpeechBubbleMorph();\nSpriteBubbleMorph.prototype.constructor = SpriteBubbleMorph;\nSpriteBubbleMorph.uber = SpeechBubbleMorph.prototype;\n\n// SpriteBubbleMorph instance creation:\n\nexport function SpriteBubbleMorph(data, stage, isThought, isQuestion) {\n    this.init(data, stage, isThought, isQuestion);\n}\n\nSpriteBubbleMorph.prototype.init = function (\n    data,\n    stage,\n    isThought,\n    isQuestion\n) {\n    var sprite = SpriteMorph.prototype;\n    this.stage = stage;\n    this.scale = stage ? stage.scale : 1;\n    this.data = data;\n    this.isQuestion = isQuestion;\n\n    SpriteBubbleMorph.uber.init.call(\n        this,\n        this.data,\n        sprite.bubbleColor,\n        null,\n        null,\n        isQuestion ? sprite.blockColor.sensing : sprite.bubbleBorderColor,\n        null,\n        isThought,\n        true // no shadow\n    );\n\n    this.isCachingImage = true;\n    this.rerender();\n};\n\n\n\n\n// Costume /////////////////////////////////////////////////////////////\n\n/*\n    I am a picture that's \"wearable\" by a sprite. My rotationCenter is\n    relative to my contents position.\n*/\n\n// Costume instance creation\n\nexport function Costume(canvas, name, rotationCenter, noFit) {\n    this.contents = canvas ? normalizeCanvas(canvas, true)\n            : newCanvas(null, true);\n    if (!noFit) {this.shrinkToFit(this.maxExtent()); }\n    this.name = name || null;\n    this.rotationCenter = rotationCenter || this.center();\n    this.version = Date.now(); // for observer optimization\n    this.loaded = null; // for de-serialization only\n}\n\nCostume.prototype.maxExtent = function () {\n    return StageMorph.prototype.dimensions;\n};\n\nCostume.prototype.toString = function () {\n    return 'a Costume(' + this.name + ')';\n};\n\n// Costume dimensions - all relative\n\nCostume.prototype.extent = function () {\n    return new Point(this.contents.width, this.contents.height);\n};\n\nCostume.prototype.center = function () {\n    return this.extent().divideBy(2);\n};\n\nCostume.prototype.width = function () {\n    return this.contents.width;\n};\n\nCostume.prototype.height = function () {\n    return this.contents.height;\n};\n\nCostume.prototype.bounds = function () {\n    return new Rectangle(0, 0, this.width(), this.height());\n};\n\n// Costume shrink-wrapping\n\nCostume.prototype.shrinkWrap = function () {\n    // adjust my contents'  bounds to my visible bounding box\n    var bb = this.boundingBox(),\n        ext = bb.extent(),\n        pic = newCanvas(ext, true),\n        ctx = pic.getContext('2d');\n\n    ctx.drawImage(\n        this.contents,\n        bb.origin.x,\n        bb.origin.y,\n        ext.x,\n        ext.y,\n        0,\n        0,\n        ext.x,\n        ext.y\n    );\n    this.rotationCenter = this.rotationCenter.subtract(bb.origin);\n    this.contents = pic;\n    this.version = Date.now();\n};\n\nCostume.prototype.canvasBoundingBox = function (pic) {\n    // answer the rectangle surrounding my contents' non-transparent pixels\n    var row,\n        col,\n        w = pic.width,\n        h = pic.height,\n        ctx = pic.getContext('2d'),\n        dta = ctx.getImageData(0, 0, w, h);\n\n    function getAlpha(x, y) {\n        return dta.data[((y * w * 4) + (x * 4)) + 3];\n    }\n\n    function getLeft() {\n        for (col = 0; col < w; col += 1) {\n            for (row = 0; row < h; row += 1) {\n                if (getAlpha(col, row)) {\n                    return col;\n                }\n            }\n        }\n        return 0;\n    }\n\n    function getTop() {\n        for (row = 0; row < h; row += 1) {\n            for (col = 0; col < w; col += 1) {\n                if (getAlpha(col, row)) {\n                    return row;\n                }\n            }\n        }\n        return 0;\n    }\n\n    function getRight() {\n        for (col = w - 1; col >= 0; col -= 1) {\n            for (row = h - 1; row >= 0; row -= 1) {\n                if (getAlpha(col, row)) {\n                    return Math.min(col + 1, w);\n                }\n            }\n        }\n        return w;\n    }\n\n    function getBottom() {\n        for (row = h - 1; row >= 0; row -= 1) {\n            for (col = w - 1; col >= 0; col -= 1) {\n                if (getAlpha(col, row)) {\n                    return Math.min(row + 1, h);\n                }\n            }\n        }\n        return h;\n    }\n\n    return new Rectangle(getLeft(), getTop(), getRight(), getBottom());\n};\n\nCostume.prototype.boundingBox = function () {\n    return this.canvasBoundingBox(this.contents);\n};\n\n// Costume duplication\n\nCostume.prototype.copy = function () {\n    var canvas = newCanvas(this.extent(), true),\n        cpy,\n        ctx;\n    ctx = canvas.getContext('2d');\n    ctx.drawImage(this.contents, 0, 0);\n    cpy = new Costume(canvas, this.name ? copy(this.name) : null);\n    cpy.rotationCenter = this.rotationCenter.copy();\n    return cpy;\n};\n\n// Costume flipping & stretching\n\nCostume.prototype.flipped = function () {\n/*\n    answer a copy of myself flipped horizontally\n    (mirrored along a vertical axis), used for\n    SpriteMorph's rotation style type 2\n*/\n    var canvas = newCanvas(this.extent(), true),\n        ctx = canvas.getContext('2d'),\n        flipped;\n\n    ctx.translate(this.width(), 0);\n    ctx.scale(-1, 1);\n    ctx.drawImage(this.contents, 0, 0);\n    flipped = new Costume(\n        canvas,\n        this.name,\n        new Point(\n            this.width() - this.rotationCenter.x,\n            this.rotationCenter.y\n        )\n    );\n    return flipped;\n};\n\nCostume.prototype.stretched = function (w, h) {\n    w = (Math.sign(w) || 1) * Math.max(1, Math.abs(w));\n    h = (Math.sign(h) || 1) * Math.max(1, Math.abs(h));\n\n    var canvas = newCanvas(new Point(Math.abs(w), Math.abs(h)), true),\n        ctx = canvas.getContext('2d'),\n        xRatio = w / this.width(),\n        yRatio = h / this.height(),\n        center = this.rotationCenter.multiplyBy(new Point(xRatio, yRatio)),\n        stretched;\n\n    if (xRatio < 0) {\n        center.x = canvas.width - Math.abs(center.x);\n    }\n    if (yRatio < 0) {\n        center.y = canvas.height - Math.abs(center.y);\n    }\n\n    ctx.translate(Math.abs(Math.min(w, 0)), Math.abs(Math.min(h, 0)));\n    ctx.scale(xRatio, yRatio);\n    // first rasterize in case it's an SVG and in case it's on Firefox\n    // because Firefox prevents stretching of SVGs with locked aspect ratios\n    ctx.drawImage(this.rasterized().contents, 0, 0);\n    stretched = new Costume(\n        canvas,\n        this.name,\n        center,\n        true\n    );\n    return stretched;\n};\n\n// Costume actions\n\n// Costume.prototype.edit = function (aWorld, anIDE, isnew, oncancel, onsubmit) {\n//     var editor = new PaintEditorMorph();\n//     editor.oncancel = oncancel || nop;\n//     editor.openIn(\n//         aWorld,\n//         isnew ?\n//                 newCanvas(StageMorph.prototype.dimensions, true) :\n//                 this.contents,\n//         isnew ?\n//                 null :\n//                 this.rotationCenter,\n//         (img, rc) => {\n//             this.contents = img;\n//             this.rotationCenter = rc;\n//             this.version = Date.now();\n//             aWorld.changed();\n//             if (anIDE) {\n//                 if (anIDE.currentSprite instanceof SpriteMorph) {\n//                     // don't shrinkwrap stage costumes\n//                     this.shrinkWrap();\n//                 }\n//                 anIDE.currentSprite.wearCostume(this, true); // don't shadow\n//                 anIDE.hasChangedMedia = true;\n//             }\n//             (onsubmit || nop)();\n//         },\n//         anIDE\n//     );\n// };\n\nCostume.prototype.editRotationPointOnly = function (aWorld, anIDE) {\n    var editor = new CostumeEditorMorph(this),\n        action,\n        dialog,\n        txt;\n\n    editor.fixLayout();\n    action = () => {\n        editor.accept();\n        anIDE.currentSprite.wearCostume(this, true); // don't shadow\n    };\n    dialog = new DialogBoxMorph(this, action);\n    txt = new TextMorph(\n        localize('click or drag crosshairs to move the rotation center'),\n        dialog.fontSize,\n        dialog.fontStyle,\n        true,\n        false,\n        'center',\n        null,\n        null,\n        new Point(1, 1),\n        WHITE\n    );\n\n    dialog.labelString = 'Costume Editor';\n    dialog.createLabel();\n    dialog.setPicture(editor);\n    dialog.addBody(txt);\n    dialog.addButton('ok', 'Ok');\n    dialog.addButton('cancel', 'Cancel');\n    dialog.fixLayout();\n    dialog.popUp(aWorld);\n};\n\n// Costume thumbnail\n\nCostume.prototype.shrinkToFit = function (extentPoint) {\n    if (extentPoint.x < this.width() || (extentPoint.y < this.height())) {\n        this.contents = this.thumbnail(extentPoint, null, true);\n    }\n};\n\nCostume.prototype.thumbnail = function (extentPoint, recycleMe, noPadding) {\n    // answer a new Canvas of extentPoint dimensions containing\n    // my thumbnail representation keeping the originial aspect ratio\n    // a \"recycleMe canvas can be passed for re-use\n    // if \"noPadding\" is \"true\" the resulting thumbnail fits inside the\n    // given extentPoint without padding it, i.e. one of the dimensions\n    // is likely to be lesser than that of the extentPoint\n    var src = this.contents,\n        w = src ? src.width : 1, // could be an asynchronously loading SVG\n        h = src ? src.height : 1, // could be an asynchronously loading SVG\n        scale = Math.min(\n            (extentPoint.x / w),\n            (extentPoint.y / h)\n        ),\n        xOffset = noPadding ? 0\n            : Math.floor((extentPoint.x - (w * scale)) / 2),\n        yOffset = noPadding ? 0\n            : Math.floor((extentPoint.y - (h * scale)) / 2),\n        trg, ctx;\n\n    trg = newCanvas(\n        noPadding ? new Point(this.width() * scale, this.height() * scale)\n            : extentPoint,\n        true, // non-retina\n        recycleMe\n    );\n    if (!src || src.width + src.height === 0) {return trg; }\n    ctx = trg.getContext('2d');\n    ctx.save();\n    ctx.scale(scale, scale);\n    ctx.drawImage(\n        src,\n        Math.floor(xOffset / scale),\n        Math.floor(yOffset / scale)\n    );\n    ctx.restore();\n    return trg;\n};\n\n// Costume pixel access\n\nCostume.prototype.rasterized = function () {\n    return this;\n};\n\nCostume.prototype.pixels = function () {\n    var pixels = [],\n        src,\n        i;\n\n    if (!this.contents.width || !this.contents.height) {\n        return pixels;\n    }\n    src = this.contents.getContext('2d').getImageData(\n        0,\n        0,\n        this.contents.width,\n        this.contents.height\n    );\n    for (i = 0; i < src.data.length; i += 4) {\n        pixels.push(new List([\n            src.data[i],\n            src.data[i + 1],\n            src.data[i + 2],\n            src.data[i + 3]\n        ]));\n    }\n    return new List(pixels);\n};\n\n// Costume catching \"tainted\" canvases\n\nCostume.prototype.isTainted = function () {\n    // find out whether the canvas has been tainted by cross-origin data\n    // assumes that if reading image data throws an error it is tainted\n    try {\n        this.contents.getContext('2d').getImageData(\n            0,\n            0,\n            this.contents.width,\n            this.contents.height\n        );\n    } catch (err) {\n        return true;\n    }\n    return false;\n};\n\n// SVG_Costume /////////////////////////////////////////////////////////////\n\n/*\n    I am a costume containing an SVG image.\n*/\n\n// SVG_Costume inherits from Costume:\n\nSVG_Costume.prototype = new Costume();\nSVG_Costume.prototype.constructor = SVG_Costume;\nSVG_Costume.uber = Costume.prototype;\n\n// SVG_Costume instance creation\n\nexport function SVG_Costume(svgImage, name, rotationCenter) {\n    this.contents = svgImage;\n    this.shapes = [];\n    this.shrinkToFit(this.maxExtent());\n    this.name = name || null;\n    this.rotationCenter = rotationCenter || this.center();\n    this.version = Date.now(); // for observer optimization\n    this.loaded = null; // for de-serialization only\n}\n\nSVG_Costume.prototype.toString = function () {\n    return 'an SVG_Costume(' + this.name + ')';\n};\n\n// SVG_Costume duplication\n\nSVG_Costume.prototype.copy = function () {\n    var img = new Image(),\n        cpy;\n    img.src = this.contents.src;\n    cpy = new SVG_Costume(img, this.name ? copy(this.name) : null);\n    cpy.rotationCenter = this.rotationCenter.copy();\n    cpy.shapes = this.shapes.map(shape => shape.copy());\n    return cpy;\n};\n\n// SVG_Costume flipping\n\n/*\n    Flipping is currently inherited from Costume, which rasterizes it.\n    Therefore flipped SVG costumes may appear pixelated until we add\n    a method to either truly flip SVGs or change the Sprite's render()\n    method to scale the costume before flipping it.\n\n    Stretching, OTOH, is achieved with real scaling and thus produces\n    smooth, albeit rasterized results for vector graphics.\n*/\n\n// SVG_Costume thumbnail\n\nSVG_Costume.prototype.shrinkToFit = function (extentPoint) {\n    // overridden for unrasterized SVGs\n    nop(extentPoint);\n    return;\n};\n\nSVG_Costume.prototype.parseShapes = function () {\n    // I try to parse my SVG as an editable collection of shapes\n    var element = new XML_Element(),\n        // remove 'data:image/svg+xml, ' from src\n        contents = this.contents.src.replace(/^data:image\\/.*?, */, '');\n\n    if (this.contents.src.indexOf('base64') > -1) {\n        contents = atob(contents);\n    }\n\n    element.parseString(contents);\n\n    if (this.shapes.length === 0 && element.attributes.snap) {\n        this.shapes = element.children.map(child =>\n            window[child.attributes.prototype].fromSVG(child)\n        );\n    }\n};\n\nSVG_Costume.prototype.edit = function (\n\taWorld,\n    anIDE,\n    isnew,\n    oncancel,\n    onsubmit\n) {\n    var editor = new VectorPaintEditorMorph(),\n        myself = this;\n\n    editor.oncancel = oncancel || nop;\n    editor.openIn(\n        aWorld,\n        isnew ? newCanvas(StageMorph.prototype.dimensions) : this.contents,\n        isnew ? new Point(240, 180) : this.rotationCenter,\n        (img, rc, shapes) => {\n            myself.contents = img;\n            myself.rotationCenter = rc;\n            myself.shapes = shapes;\n            myself.version = Date.now();\n            aWorld.changed();\n            if (anIDE) {\n                if (isnew) {anIDE.currentSprite.addCostume(myself); }\n                anIDE.currentSprite.wearCostume(myself);\n                anIDE.hasChangedMedia = true;\n            }\n            (onsubmit || nop)();\n        },\n        anIDE,\n        this.shapes || []\n    );\n};\n\n// SVG_Costume pixel access\n\nSVG_Costume.prototype.rasterized = function () {\n    var canvas = newCanvas(this.extent(), true),\n        ctx = canvas.getContext('2d'),\n        rasterized;\n\n    ctx.drawImage(this.contents, 0, 0);\n    rasterized = new Costume(\n        canvas,\n        this.name,\n        this.rotationCenter.copy()\n    );\n    return rasterized;\n};\n\n// CostumeEditorMorph ////////////////////////////////////////////////////////\n\n// CostumeEditorMorph inherits from Morph:\n\nCostumeEditorMorph.prototype = new Morph();\nCostumeEditorMorph.prototype.constructor = CostumeEditorMorph;\nCostumeEditorMorph.uber = Morph.prototype;\n\n// CostumeEditorMorph preferences settings:\nCostumeEditorMorph.prototype.size = Costume.prototype.maxExtent();\n\n// CostumeEditorMorph instance creation\n\nexport function CostumeEditorMorph(costume) {\n    this.init(costume);\n}\n\nCostumeEditorMorph.prototype.init = function (costume) {\n    this.costume = costume || new Costume();\n    this.rotationCenter = this.costume.rotationCenter.copy();\n    this.margin = ZERO;\n    CostumeEditorMorph.uber.init.call(this);\n};\n\n// CostumeEditorMorph edit ops\n\nCostumeEditorMorph.prototype.accept = function () {\n    this.costume.rotationCenter = this.rotationCenter.copy();\n    this.costume.version = Date.now();\n};\n\n// CostumeEditorMorph displaying\n\nCostumeEditorMorph.prototype.fixLayout = function () {\n    this.bounds.setExtent(this.size);\n};\n\nCostumeEditorMorph.prototype.render = function (ctx) {\n    var rp;\n\n    this.margin = this.size.subtract(this.costume.extent()).divideBy(2);\n    rp = this.rotationCenter.add(this.margin);\n\n\n    // draw the background\n    if (!this.cachedTexture) {\n        this.cachedTexture = this.createTexture();\n\n    }\n    this.renderCachedTexture(ctx);\n\n    /*\n    pattern = ctx.createPattern(this.background, 'repeat');\n    ctx.fillStyle = pattern;\n    ctx.fillRect(0, 0, this.size.x, this.size.y);\n    */\n\n    // draw the costume\n    ctx.drawImage(this.costume.contents, this.margin.x, this.margin.y);\n\n    // draw crosshairs:\n    ctx.globalAlpha = 0.5;\n\n    // circle around center:\n    ctx.fillStyle = 'white';\n    ctx.beginPath();\n    ctx.arc(\n        rp.x,\n        rp.y,\n        20,\n        radians(0),\n        radians(360),\n        false\n    );\n    ctx.closePath();\n    ctx.fill();\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.arc(\n        rp.x,\n        rp.y,\n        10,\n        radians(0),\n        radians(360),\n        false\n    );\n    ctx.stroke();\n\n    // horizontal line:\n    ctx.beginPath();\n    ctx.moveTo(0, rp.y);\n    ctx.lineTo(this.costume.width() + this.margin.x * 2, rp.y);\n    ctx.stroke();\n\n    // vertical line:\n    ctx.beginPath();\n    ctx.moveTo(rp.x, 0);\n    ctx.lineTo(rp.x, this.costume.height() + this.margin.y * 2);\n    ctx.stroke();\n};\n\nCostumeEditorMorph.prototype.createTexture = function () {\n    var size = 5,\n        texture = newCanvas(new Point(size * 2, size * 2)),\n        ctx = texture.getContext('2d'),\n        grey = new Color(230, 230, 230);\n\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, size * 2, size * 2);\n    ctx.fillStyle = grey.toString();\n    ctx.fillRect(0, 0, size, size);\n    ctx.fillRect(size, size, size, size);\n    return texture;\n};\n\n\n// CostumeEditorMorph events\n\nCostumeEditorMorph.prototype.mouseDownLeft = function (pos) {\n    this.rotationCenter = pos.subtract(\n        this.position().add(this.margin)\n    );\n    this.rerender();\n};\n\nCostumeEditorMorph.prototype.mouseMove\n    = CostumeEditorMorph.prototype.mouseDownLeft;\n\n// Sound /////////////////////////////////////////////////////////////\n\n// Sound instance creation\n\nexport function Sound(audio, name) {\n    this.audio = audio; // mandatory\n    this.name = name || \"Sound\";\n\n    // cached samples, don't persist\n    this.cachedSamples = null;\n\n    // internal for decoding, don't persist\n    this.audioBuffer = null; // for decoding ops\n    this.isDecoding = false;\n\n    // internal for deserializing, don't persist\n    this.loaded = null; // for de-serialization only\n}\n\nSound.prototype.play = function () {\n    // return an instance of an audio element which can be terminated\n    // externally (i.e. by the stage)\n    // Note: only to be used by the GUI, not by scripts,\n    // because no effects like volume or panning are applied\n    var aud = document.createElement('audio');\n    aud.src = this.audio.src;\n    aud.play();\n    return aud;\n};\n\nSound.prototype.copy = function () {\n    var snd = document.createElement('audio'),\n        cpy;\n\n    snd.src = this.audio.src;\n    cpy = new Sound(snd, this.name ? copy(this.name) : null);\n    return cpy;\n};\n\nSound.prototype.toDataURL = function () {\n    return this.audio.src;\n};\n\n// Note /////////////////////////////////////////////////////////\n\n// I am a single musical note.\n// alternatively I can be used to play a frequency in hz\n\n// Note instance creation\n\nexport function Note(pitch) {\n    this.pitch = pitch === 0 ? 0 : pitch || 69;\n    this.frequency = null; // alternative for playing a non-note frequency\n    this.setupContext();\n    this.oscillator = null;\n    this.fader = null; // gain node for suppressing clicks\n    this.ended = false; // for active sounds management\n}\n\n// Note shared properties\n\nNote.prototype.audioContext = null;\n\nNote.prototype.fadeIn = new Float32Array(2);\nNote.prototype.fadeIn[0] = [0.0];\nNote.prototype.fadeIn[1] = [0.2];\n\nNote.prototype.fadeOut = new Float32Array(2);\nNote.prototype.fadeOut[0] = [0.2];\nNote.prototype.fadeOut[1] = [0.0];\n\nNote.prototype.fadeTime = 0.01;\n\n// Note audio context\n\nNote.prototype.setupContext = function () {\n    if (this.audioContext) { return; }\n    var AudioContext = (function () {\n        // cross browser some day?\n        var ctx = window.AudioContext ||\n            window.mozAudioContext ||\n            window.msAudioContext ||\n            window.oAudioContext ||\n            window.webkitAudioContext;\n        if (!ctx.prototype.createGain) {\n            ctx.prototype.createGain = ctx.prototype.createGainNode;\n        }\n        return ctx;\n    }());\n    if (!AudioContext) {\n        throw new Error('Web Audio API is not supported\\nin this browser');\n    }\n    Note.prototype.audioContext = new AudioContext();\n};\n\nNote.prototype.getAudioContext = function () {\n    // lazily initializes and shares the Note prototype's audio context\n    // to be used by all other Snap! objects requiring audio,\n    // e.g. the microphone, the sprites, etc.\n    if (!this.audioContext) {\n        this.setupContext();\n    }\n    this.audioContext.resume();\n    return this.audioContext;\n};\n\n// Note playing\n\nNote.prototype.play = function (type, gainNode, pannerNode) {\n    if (!gainNode) {\n        gainNode = this.audioContext.createGain();\n    }\n    this.fader = this.audioContext.createGain();\n    this.oscillator = this.audioContext.createOscillator();\n    if (!this.oscillator.start) {\n        this.oscillator.start = this.oscillator.noteOn;\n    }\n    if (!this.oscillator.stop) {\n        this.oscillator.stop = this.oscillator.noteOff;\n    }\n    this.setInstrument(type);\n    this.oscillator.frequency.value = isNil(this.frequency) ?\n        Math.pow(2, (this.pitch - 69) / 12) * 440 : this.frequency;\n    this.oscillator.connect(this.fader);\n    this.fader.connect(gainNode);\n    if (pannerNode) {\n        gainNode.connect(pannerNode);\n        pannerNode.connect(this.audioContext.destination);\n    } else {\n        gainNode.connect(this.audioContext.destination);\n    }\n    this.ended = false;\n    this.fader.gain.setValueCurveAtTime(\n        this.fadeIn,\n        this.audioContext.currentTime,\n        this.fadeTime\n    );\n    this.oscillator.start(0);\n};\n\nNote.prototype.setInstrument = function (type) {\n    // private - make sure the oscillator node has been initialized before\n    if (this.oscillator) {\n        this.oscillator.type = [\n            'sine',\n            'square',\n            'sawtooth',\n            'triangle'\n        ][(type || 1) - 1];\n    }\n};\n\nNote.prototype.stop = function (immediately) {\n    // set \"immediately\" to true to terminate instantly\n    // needed for widgets like the PianoKeyboard\n    var fade = !immediately;\n    if (immediately && this.oscillator) {\n        this.oscillator.stop(0);\n        return;\n    }\n    if (this.fader) {\n        try {\n            this.fader.gain.setValueCurveAtTime(\n                this.fadeOut,\n                this.audioContext.currentTime,\n                this.fadeTime\n            );\n        } catch (err) {\n            fade = false;\n        }\n    }\n    if (this.oscillator) {\n        this.oscillator.stop(\n            fade ?\n                this.audioContext.currentTime + this.fadeTime\n                : 0\n        );\n        this.oscillator = null;\n    }\n    this.ended = true;\n};\n\nNote.prototype.pause = function () {\n    // emulate a sound for active sounds mngmt\n    this.stop();\n};\n\n// Microphone /////////////////////////////////////////////////////////\n\n// I am a microphone and know about volume, note, pitch, as well as\n// signals and frequencies.\n// mostly meant to be a singleton of the stage\n// I stop when I'm not queried something for 5 seconds\n// to free up system resources\n//\n// modifying and metering output is currently experimental\n// and only fully works in Chrome. Modifiers work in Firefox, but only with\n// a significant lag, metering output is currently not supported by Firefox.\n// Safari... well, let's not talk about Safari :-)\n\nexport function Microphone() {\n    // web audio components:\n    this.audioContext = null; // shared with Note.prototype.audioContext\n    this.sourceStream = null;\n    this.processor = null;\n    this.analyser = null;\n\n    // parameters:\n    this.resolution = 2;\n    this.GOOD_ENOUGH_CORRELATION = 0.96;\n\n    // modifier\n    this.modifier = null;\n    this.compiledModifier = null;\n    this.compilerProcess = null;\n\n    // memory alloc\n    this.correlations = [];\n    this.wrapper = new List([0]);\n    this.outChannels = [];\n\n    // metered values:\n    this.volume = 0;\n    this.signals = [];\n    this.output = [];\n    this.frequencies = [];\n    this.pitch = -1;\n\n    // asynch control:\n    this.isStarted = false;\n    this.isReady = false;\n\n    // idling control:\n    this.isAutoStop = (location.protocol !== 'file:');\n    this.lastTime = Date.now();\n}\n\nMicrophone.prototype.isOn = function () {\n    if (this.isReady) {\n        this.lastTime = Date.now();\n        return true;\n    }\n    this.start();\n    return false;\n};\n\n// Microphone shared properties\n\nMicrophone.prototype.binSizes = [256, 512, 1024, 2048, 4096];\n\n// Microphone resolution\n\nMicrophone.prototype.binSize = function () {\n    return this.binSizes[this.resolution - 1];\n};\n\nMicrophone.prototype.setResolution = function (num) {\n    if (contains([1, 2, 3, 4], num)) {\n        if (this.isReady) {\n            this.stop();\n        }\n        this.resolution = num;\n    }\n};\n\n// Microphone ops\n\nMicrophone.prototype.start = function () {\n    if (this.isStarted) {return; }\n    this.isStarted = true;\n    this.isReady = false;\n    this.audioContext = Note.prototype.getAudioContext();\n\n    navigator.mediaDevices.getUserMedia(\n        {\n            \"audio\": {\n                \"mandatory\": {\n                    \"googEchoCancellation\": \"false\",\n                    \"googAutoGainControl\": \"false\",\n                    \"googNoiseSuppression\": \"false\",\n                    \"googHighpassFilter\": \"false\"\n                },\n            \"optional\": []\n            },\n        }\n    ).then(\n        stream => this.setupNodes(stream)\n    ).catch(nop);\n};\n\nMicrophone.prototype.stop = function () {\n    this.processor.onaudioprocess = null;\n    this.sourceStream.getTracks().forEach(track => track.stop());\n    this.processor.disconnect();\n    this.analyser.disconnect();\n    this.processor = null;\n    this.analyser = null;\n    this.audioContext = null;\n    this.isReady = false;\n    this.isStarted = false;\n};\n\n// Microphone initialization\n\nMicrophone.prototype.setupNodes = function (stream) {\n    this.sourceStream = stream;\n    this.createProcessor();\n    this.createAnalyser();\n    this.analyser.connect(this.processor);\n    this.processor.connect(this.audioContext.destination);\n    this.audioContext.createMediaStreamSource(stream).connect(this.analyser);\n    this.lastTime = Date.now();\n};\n\nMicrophone.prototype.createAnalyser = function () {\n    var bufLength;\n    this.analyser = this.audioContext.createAnalyser();\n    this.analyser.fftSize = this.binSizes[this.resolution];\n    bufLength = this.analyser.frequencyBinCount;\n    this.frequencies = new Uint8Array(bufLength);\n\n    // setup pitch detection correlations:\n    this.correlations = new Array(Math.floor(bufLength/2));\n};\n\nMicrophone.prototype.createProcessor = function () {\n    var myself = this;\n    this.processor = this.audioContext.createScriptProcessor(\n        this.binSizes[this.resolution - 1]\n    );\n\n    this.processor.onaudioprocess = function (event) {\n        myself.stepAudio(event);\n    };\n\n    this.processor.clipping = false;\n    this.processor.lastClip = 0;\n    this.processor.clipLevel = 0.98;\n    this.processor.averaging = 0.95;\n    this.processor.clipLag = 750;\n};\n\n// Microphone stepping\n\nMicrophone.prototype.stepAudio = function (event) {\n    var channels, i;\n    if (this.isAutoStop &&\n            ((Date.now() - this.lastTime) > 5000) &&\n            !this.modifier\n    ) {\n        this.stop();\n        return;\n    }\n\n    // signals:\n    this.signals = event.inputBuffer.getChannelData(0);\n\n    // output:\n    if (this.modifier) {\n        channels = event.outputBuffer.numberOfChannels;\n        if (this.outChannels.length !== channels) {\n            this.outChannels = new Array(channels);\n        }\n        for (i = 0; i < channels; i += 1) {\n            this.outChannels[i] = event.outputBuffer.getChannelData(i);\n        }\n        this.output = this.outChannels[0];\n    } else {\n        this.output = event.outputBuffer.getChannelData(0);\n    }\n\n    // frequency bins:\n    this.analyser.getByteFrequencyData(this.frequencies);\n\n    // pitch & volume:\n    this.pitch = this.detectPitchAndVolume(\n        this.signals,\n        this.audioContext.sampleRate\n    );\n\n    // note:\n    if (this.pitch > 0) {\n        this.note = Math.round(\n            12 * (Math.log(this.pitch / 440) / Math.log(2))\n        ) + 69;\n    }\n\n    this.isReady = true;\n    this.isStarted = false;\n};\n\nMicrophone.prototype.detectPitchAndVolume = function (buf, sampleRate) {\n    // https://en.wikipedia.org/wiki/Autocorrelation\n    // thanks to Chris Wilson:\n    // https://plus.google.com/+ChrisWilson/posts/9zHsF9PCDAL\n    // https://github.com/cwilso/PitchDetect/\n\n    var SIZE = buf.length,\n        MAX_SAMPLES = Math.floor(SIZE/2),\n        best_offset = -1,\n        best_correlation = 0,\n        rms = 0,\n        foundGoodCorrelation = false,\n        correlations = this.correlations,\n        channels = this.outChannels.length,\n        correlation,\n        lastCorrelation,\n        offset,\n        shift,\n        i,\n        k,\n        val,\n        modified;\n\n    for (i = 0; i < SIZE; i += 1) {\n        val = buf[i];\n        if (Math.abs(val) >= this.processor.clipLevel) {\n            this.processor.clipping = true;\n            this.processor.lastClip = window.performance.now();\n        }\n        rms += val * val;\n\n        // apply modifier, if any\n        if (this.modifier) {\n            this.wrapper.contents[0] = val;\n            modified = invoke(\n                this.compiledModifier,\n                this.wrapper,\n                null,\n                null,\n                null,\n                null,\n                this.compilerProcess\n            );\n            for (k = 0; k < channels; k += 1) {\n                this.outChannels[k][i] = modified;\n            }\n        }\n    }\n    rms = Math.sqrt(rms/SIZE);\n    this.volume = Math.max(rms, this.volume * this.processor.averaging);\n    if (rms < 0.01)\n        return this.pitch;\n\n    lastCorrelation = 1;\n    for (offset = 1; offset < MAX_SAMPLES; offset += 1) {\n        correlation = 0;\n\n        for (i = 0; i < MAX_SAMPLES; i += 1) {\n            correlation += Math.abs((buf[i]) - (buf[i + offset]));\n        }\n        correlation = 1 - (correlation/MAX_SAMPLES);\n        correlations[offset] = correlation;\n        if ((correlation > this.GOOD_ENOUGH_CORRELATION)\n            && (correlation > lastCorrelation)\n        ) {\n            foundGoodCorrelation = true;\n            if (correlation > best_correlation) {\n                best_correlation = correlation;\n                best_offset = offset;\n            }\n        } else if (foundGoodCorrelation) {\n            shift = (correlations[best_offset + 1] -\n                correlations[best_offset - 1]) /\n                    correlations[best_offset];\n            return sampleRate / (best_offset + (8 * shift));\n        }\n        lastCorrelation = correlation;\n    }\n    if (best_correlation > 0.01) {\n        return sampleRate / best_offset;\n    }\n    return this.pitch;\n};\n\n// CellMorph //////////////////////////////////////////////////////////\n\n/*\n    I am a spreadsheet style cell that can display either a string,\n    a Morph, a Canvas or a toString() representation of anything else.\n    I can be used in variable watchers or list view element cells.\n*/\n\n// CellMorph inherits from BoxMorph:\n\nCellMorph.prototype = new BoxMorph();\nCellMorph.prototype.constructor = CellMorph;\nCellMorph.uber = BoxMorph.prototype;\n\n// CellMorph instance creation:\n\nexport function CellMorph(contents, color, idx, parentCell) {\n    this.init(contents, color, idx, parentCell);\n}\n\nCellMorph.prototype.init = function (contents, color, idx, parentCell) {\n    this.contents = (contents === 0 ? 0\n            : contents === false ? false\n                    : contents || '');\n    this.isEditable = isNil(idx) ? false : true;\n    this.idx = idx || null; // for list watchers\n    this.parentCell = parentCell || null; // for list circularity detection\n    CellMorph.uber.init.call(\n        this,\n        SyntaxElementMorph.prototype.corner,\n        1,\n        WHITE\n    );\n    this.color = color || new Color(255, 140, 0);\n    this.isBig = false;\n    this.version = null; // only for observing sprites\n    this.fixLayout();\n};\n\n\n// WatcherMorph //////////////////////////////////////////////////////////\n\n/*\n    I am a little window which observes some value and continuously\n    updates itself accordingly.\n\n    My target can be either a SpriteMorph or a VariableFrame.\n*/\n\n// WatcherMorph inherits from BoxMorph:\n\nWatcherMorph.prototype = new BoxMorph();\nWatcherMorph.prototype.constructor = WatcherMorph;\nWatcherMorph.uber = BoxMorph.prototype;\n\n// WatcherMorph instance creation:\n\nexport function WatcherMorph(label, color, target, getter, isHidden) {\n    this.init(label, color, target, getter, isHidden);\n}\n\nWatcherMorph.prototype.init = function (\n    label,\n    color,\n    target,\n    getter,\n    isHidden\n) {\n    // additional properties\n    this.labelText = label || '';\n    this.version = null;\n    this.objName = '';\n    this.isGhosted = false; // transient, don't persist\n\n    // initialize inherited properties\n    WatcherMorph.uber.init.call(\n        this,\n        SyntaxElementMorph.prototype.rounding,\n        1.000001, // shadow bug in Chrome,\n        new Color(120, 120, 120)\n    );\n\n    // override inherited behavior\n    this.color = new Color(220, 220, 220);\n    this.readoutColor = color;\n    this.style = 'normal';\n    this.target = target || null; // target obj (Sprite) or VariableFrame\n    this.getter = getter || null; // callback or variable name (string)\n    this.currentValue = null;\n    this.labelMorph = null;\n    this.sliderMorph = null;\n    this.cellMorph = null;\n    this.isDraggable = true;\n    this.fixLayout();\n    this.update();\n    if (isHidden) { // for de-serializing\n        this.hide();\n    }\n};\n\n// WatcherMorph accessing:\n\nWatcherMorph.prototype.isTemporary = function () {\n    var stage = this.parentThatIsA(StageMorph);\n    if (this.target instanceof VariableFrame) {\n        if (stage) {\n            if (this.target === stage.variables.parentFrame) {\n                return false; // global\n            }\n        }\n        return this.target.owner === null;\n    }\n    return false;\n};\n\nWatcherMorph.prototype.object = function () {\n    // answer the actual sprite I refer to\n    return this.target instanceof VariableFrame ?\n            this.target.owner : this.target;\n};\n\nWatcherMorph.prototype.isGlobal = function (selector) {\n    return contains(\n        ['getLastAnswer', 'getLastMessage', 'getTempo', 'getTimer',\n             'reportMouseX', 'reportMouseY', 'reportThreadCount'],\n        selector\n    );\n};\n\n// WatcherMorph slider accessing:\n\nWatcherMorph.prototype.setSliderMin = function (num, noUpdate) {\n    if (this.target instanceof VariableFrame) {\n        this.sliderMorph.setSize(1, noUpdate);\n        this.sliderMorph.setStart(num, noUpdate);\n        this.sliderMorph.setSize(this.sliderMorph.rangeSize() / 5, noUpdate);\n    }\n};\n\nWatcherMorph.prototype.setSliderMax = function (num, noUpdate) {\n    if (this.target instanceof VariableFrame) {\n        this.sliderMorph.setSize(1, noUpdate);\n        this.sliderMorph.setStop(num, noUpdate);\n        this.sliderMorph.setSize(this.sliderMorph.rangeSize() / 5, noUpdate);\n    }\n};\n\n\nWatcherMorph.prototype.updateLabel = function () {\n    // check whether the target object's name has been changed\n    var obj = this.object();\n\n    if (!obj || this.isGlobal(this.getter)) { return; }\n    if (obj.version !== this.version) {\n        this.objName = obj.name ? obj.name + ' ' : ' ';\n        if (this.labelMorph) {\n            this.labelMorph.destroy();\n            this.labelMorph = null;\n            this.fixLayout();\n        }\n    }\n};\n\n// WatcherMorph layout:\n\nWatcherMorph.prototype.fixLayout = function () {\n    var fontSize = SyntaxElementMorph.prototype.fontSize, isList,\n        myself = this;\n\n    // create my parts\n    if (this.labelMorph === null) {\n        this.labelMorph = new StringMorph(\n            this.objName + this.labelText,\n            fontSize,\n            null,\n            true,\n            false,\n            false,\n            MorphicPreferences.isFlat ? new Point() : new Point(1, 1),\n            WHITE\n        );\n        this.add(this.labelMorph);\n    }\n    if (this.cellMorph === null) {\n        this.cellMorph = new CellMorph('', this.readoutColor);\n        this.add(this.cellMorph);\n    }\n    if (this.sliderMorph === null) {\n        this.sliderMorph = new SliderMorph(\n            0,\n            100,\n            0,\n            20,\n            'horizontal'\n        );\n        this.sliderMorph.alpha = 1;\n        this.sliderMorph.button.color = this.color.darker();\n        this.sliderMorph.color = this.color.lighter(60);\n        this.sliderMorph.button.highlightColor = this.color.darker();\n        this.sliderMorph.button.highlightColor.b += 50;\n        this.sliderMorph.button.pressColor = this.color.darker();\n        this.sliderMorph.button.pressColor.b += 100;\n        this.sliderMorph.setHeight(fontSize);\n        this.sliderMorph.action = function (num) {\n            myself.target.setVar(\n                myself.getter,\n                Math.round(num),\n                myself.target.owner\n            );\n        };\n        this.add(this.sliderMorph);\n    }\n\n    // adjust my layout\n    isList = this.cellMorph.contents instanceof List;\n    if (isList) { this.style = 'normal'; }\n\n    if (this.style === 'large') {\n        this.labelMorph.hide();\n        this.sliderMorph.hide();\n        this.cellMorph.big();\n        this.cellMorph.setPosition(this.position());\n        this.bounds.setExtent(this.cellMorph.extent().subtract(1));\n        return;\n    }\n\n    this.labelMorph.show();\n    this.sliderMorph.show();\n    this.cellMorph.normal();\n    this.labelMorph.setPosition(this.position().add(new Point(\n        this.edge,\n        this.border + SyntaxElementMorph.prototype.typeInPadding\n    )));\n\n    if (isList) {\n        this.cellMorph.setPosition(this.labelMorph.bottomLeft().add(\n            new Point(0, SyntaxElementMorph.prototype.typeInPadding)\n        ));\n    } else {\n        this.cellMorph.setPosition(this.labelMorph.topRight().add(new Point(\n            fontSize / 3,\n            0\n        )));\n        this.labelMorph.setTop(\n            this.cellMorph.top()\n                + (this.cellMorph.height() - this.labelMorph.height()) / 2\n        );\n    }\n\n    if (this.style === 'slider') {\n        this.sliderMorph.setPosition(new Point(\n            this.labelMorph.left(),\n            this.cellMorph.bottom()\n                + SyntaxElementMorph.prototype.typeInPadding\n        ));\n        this.sliderMorph.setWidth(this.cellMorph.right()\n            - this.labelMorph.left());\n        this.bounds.setHeight(\n            this.cellMorph.height()\n                + this.sliderMorph.height()\n                + this.border * 2\n                + SyntaxElementMorph.prototype.typeInPadding * 3\n        );\n    } else {\n        this.sliderMorph.hide();\n        this.bounds.corner.y = this.cellMorph.bottom()\n            + this.border\n            + SyntaxElementMorph.prototype.typeInPadding;\n    }\n    this.bounds.corner.x = Math.max(\n        this.cellMorph.right(),\n        this.labelMorph.right()\n    ) + this.edge\n        + SyntaxElementMorph.prototype.typeInPadding;\n};\n\n// WatcherMorph events:\n\nWatcherMorph.prototype.mouseDoubleClick = function (pos) {\n    if (List.prototype.enableTables &&\n            this.currentValue instanceof List) {\n        new TableDialogMorph(this.currentValue).popUp(this.world());\n    } else {\n        this.escalateEvent('mouseDoubleClick', pos);\n    }\n};\n\n// WatcherMorph dragging and dropping:\n\nWatcherMorph.prototype.rootForGrab = function () {\n    // prevent watchers to be dragged in presentation mode\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (ide && ide.isAppMode) {\n        return ide;\n    }\n    return this;\n};\n\n/*\n// Scratch-like watcher-toggling, commented out b/c we have a drop-down menu\n\nWatcherMorph.prototype.mouseClickLeft = function () {\n    if (this.style === 'normal') {\n        if (this.target instanceof VariableFrame) {\n            this.style = 'slider';\n        } else {\n            this.style = 'large';\n        }\n    } else if (this.style === 'slider') {\n        this.style = 'large';\n    } else {\n        this.style = 'normal';\n    }\n    this.fixLayout();\n};\n*/\n\n// WatcherMorph user menu:\n\nWatcherMorph.prototype.userMenu = function () {\n    var myself = this,\n        ide = this.parentThatIsA(IDE_Morph),\n        shiftClicked = (this.world().currentKey === 16),\n        menu = new MenuMorph(this),\n        on = '\\u25CF',\n        off = '\\u25CB',\n        vNames;\n\n    function monitor(vName) {\n        var stage = myself.parentThatIsA(StageMorph),\n            varFrame = myself.currentValue.outerContext.variables;\n        menu.addItem(\n            vName + '...',\n            function () {\n                var watcher = detect(\n                    stage.children,\n                    (morph) => morph instanceof WatcherMorph\n                        && morph.target === varFrame\n                            && morph.getter === vName\n                ),\n                    others;\n                if (watcher !== null) {\n                    watcher.show();\n                    watcher.fixLayout(); // re-hide hidden parts\n                    return;\n                }\n                watcher = new WatcherMorph(\n                    vName + ' ' + localize('(temporary)'),\n                    SpriteMorph.prototype.blockColor.variables,\n                    varFrame,\n                    vName\n                );\n                watcher.setPosition(stage.position().add(10));\n                others = stage.watchers(watcher.left());\n                if (others.length > 0) {\n                    watcher.setTop(others[others.length - 1].bottom());\n                }\n                stage.add(watcher);\n                watcher.fixLayout();\n            }\n        );\n    }\n\n    if (ide && ide.isAppMode) { // prevent context menu in app mode\n        return;\n    }\n\n    menu.addItem(\n        (this.style === 'normal' ? on : off) + ' ' + localize('normal'),\n        'styleNormal'\n    );\n    menu.addItem(\n        (this.style === 'large' ? on : off) + ' ' + localize('large'),\n        'styleLarge'\n    );\n    if (this.target instanceof VariableFrame) {\n        menu.addItem(\n            (this.style === 'slider' ? on : off) + ' ' + localize('slider'),\n            'styleSlider'\n        );\n        menu.addLine();\n        menu.addItem(\n            'slider min...',\n            'userSetSliderMin'\n        );\n        menu.addItem(\n            'slider max...',\n            'userSetSliderMax'\n        );\n        menu.addLine();\n        menu.addItem(\n            'import...',\n            'importData'\n        );\n        menu.addItem(\n            'raw data...',\n            () => this.importData(true),\n            'import without attempting to\\nparse or format data'//,\n        );\n        if (shiftClicked) {\n            if (this.currentValue instanceof List &&\n                    this.currentValue.canBeCSV()) {\n                menu.addItem(\n                    'export as CSV...',\n                    () => {\n                        var ide = this.parentThatIsA(IDE_Morph);\n                        ide.saveFileAs(\n                            this.currentValue.asCSV(),\n                            'text/csv;charset=utf-8', // RFC 4180\n                            this.getter // variable name\n                        );\n                    },\n                    null,\n                    new Color(100, 0, 0)\n                );\n            }\n            if (this.currentValue instanceof List &&\n                    this.currentValue.canBeJSON()) {\n                menu.addItem(\n                    'export as JSON...',\n                    () => {\n                        var ide = this.parentThatIsA(IDE_Morph);\n                        ide.saveFileAs(\n                            this.currentValue.asJSON(true), // guess objects\n                            'text/json;charset=utf-8',\n                            this.getter // variable name\n                        );\n                    },\n                    null,\n                    new Color(100, 0, 0)\n                );\n            }\n        }\n        if (isString(this.currentValue) || !isNaN(+this.currentValue)) {\n            if (shiftClicked) {\n                menu.addItem(\n                    'parse',\n                    'parseTxt',\n                    'try to convert\\nraw data into a list',\n                    new Color(100, 0, 0)\n                );\n            }\n            menu.addItem(\n                'export...',\n                () => {\n                    var ide = this.parentThatIsA(IDE_Morph);\n                    ide.saveFileAs(\n                        this.currentValue.toString(),\n                        'text/plain;charset=utf-8',\n                        this.getter // variable name\n                    );\n                }\n            );\n        } else if (this.currentValue instanceof List &&\n                this.currentValue.canBeCSV()) {\n            menu.addItem(\n                'export...',\n                 () => {\n                    var ide = this.parentThatIsA(IDE_Morph);\n                    ide.saveFileAs(\n                        this.currentValue.asCSV(),\n                        'text/csv;charset=utf-8', // RFC 4180\n                        this.getter // variable name\n                    );\n                }\n            );\n            if (this.currentValue.canBeJSON()) {\n                menu.addItem(\n                    'blockify',\n                    () => {\n                        var world = ide.world();\n                        this.currentValue.blockify().pickUp(world);\n                        world.hand.grabOrigin = {\n                            origin: ide.palette,\n                            position: ide.palette.center()\n                        };\n                    }\n                );\n            }\n        } else if (this.currentValue instanceof List &&\n                this.currentValue.canBeJSON()) {\n            menu.addItem(\n                'export...',\n                 () => {\n                    var ide = this.parentThatIsA(IDE_Morph);\n                    ide.saveFileAs(\n                        this.currentValue.asJSON(true), // guessObjects\n                        'text/json;charset=utf-8',\n                        this.getter // variable name\n                    );\n                }\n            );\n        } else if (this.currentValue instanceof List &&\n                this.currentValue.canBeCSV()) {\n            menu.addItem(\n                'export...',\n                function () {\n                    var ide = myself.parentThatIsA(IDE_Morph);\n                    ide.saveFileAs(\n                        myself.currentValue.asCSV(),\n                        'text/csv;charset=utf-8', // RFC 4180\n                        myself.getter // variable name\n                    );\n                }\n            );\n        } else if (this.currentValue instanceof List &&\n                this.currentValue.canBeJSON()) {\n            menu.addItem(\n                'export...',\n                function () {\n                    var ide = myself.parentThatIsA(IDE_Morph);\n                    ide.saveFileAs(\n                        myself.currentValue.asJSON(true), // guessObjects\n                        'text/json;charset=utf-8',\n                        myself.getter // variable name\n                    );\n                }\n            );\n        } else if (this.currentValue instanceof Context) {\n            vNames = this.currentValue.outerContext.variables.names();\n            if (vNames.length) {\n                menu.addLine();\n                vNames.forEach(vName => monitor(vName));\n            }\n        }\n    }\n    return menu;\n};\n\nWatcherMorph.prototype.importData = function (raw) {\n    // raw is a Boolean flag selecting to keep the data unparsed\n    var inp = document.createElement('input'),\n        ide = this.parentThatIsA(IDE_Morph),\n        myself = this;\n\n    function userImport() {\n\n        function txtOnlyMsg(ftype, anyway) {\n            ide.confirm(\n                localize(\n                    'Snap! can only import \"text\" files.\\n' +\n                        'You selected a file of type \"' +\n                        ftype +\n                        '\".'\n                ) + '\\n\\n' + localize('Open anyway?'),\n                'Unable to import',\n                anyway // callback\n            );\n        }\n\n        function readText(aFile) {\n            var frd = new FileReader(),\n                ext = aFile.name.split('.').pop().toLowerCase();\n\n            function isTextFile(aFile) {\n                // special cases for Windows\n                // check the file extension for text-like-ness\n                return aFile.type.indexOf('text') !== -1 ||\n                    contains(['txt', 'csv', 'xml', 'json', 'tsv'], ext);\n            }\n\n            function isType(aFile, string) {\n                return aFile.type.indexOf(string) !== -1 || (ext === string);\n            }\n\n            frd.onloadend = function (e) {\n                if (!raw && isType(aFile, 'csv')) {\n                    myself.target.setVar(\n                        myself.getter,\n                        Process.prototype.parseCSV(e.target.result)\n                    );\n                } else if (!raw && isType(aFile, 'json')) {\n                    myself.target.setVar(\n                        myself.getter,\n                        Process.prototype.parseJSON(e.target.result)\n                    );\n                } else {\n                    myself.target.setVar(\n                        myself.getter,\n                        e.target.result\n                    );\n                }\n            };\n\n            if (raw || isTextFile(aFile)) {\n                frd.readAsText(aFile);\n            } else {\n                // show a warning and an option\n                // letting the user load the file anyway\n                txtOnlyMsg(\n                    aFile.type,\n                    () => frd.readAsText(aFile)\n                );\n            }\n        }\n\n        document.body.removeChild(inp);\n        ide.filePicker = null;\n        if (inp.files.length > 0) {\n            readText(inp.files[inp.files.length - 1]);\n        }\n    }\n\n    if (ide.filePicker) {\n        document.body.removeChild(ide.filePicker);\n        ide.filePicker = null;\n    }\n    inp.type = 'file';\n    inp.style.color = \"transparent\";\n    inp.style.backgroundColor = \"transparent\";\n    inp.style.border = \"none\";\n    inp.style.outline = \"none\";\n    inp.style.position = \"absolute\";\n    inp.style.top = \"0px\";\n    inp.style.left = \"0px\";\n    inp.style.width = \"0px\";\n    inp.style.height = \"0px\";\n    inp.style.display = \"none\";\n    inp.addEventListener(\n        \"change\",\n        userImport,\n        false\n    );\n    document.body.appendChild(inp);\n    ide.filePicker = inp;\n    inp.click();\n};\n\nWatcherMorph.prototype.parseTxt = function () {\n    // experimental!\n    var src = this.target.vars[this.getter].value;\n    this.target.setVar(\n        this.getter,\n        src.indexOf('\\[') === 0 ?\n            Process.prototype.parseJSON(src)\n                : Process.prototype.parseCSV(src)\n    );\n};\n\nWatcherMorph.prototype.setStyle = function (style) {\n    this.style = style;\n    this.fixLayout();\n};\n\nWatcherMorph.prototype.styleNormal = function () {\n    this.setStyle('normal');\n};\n\nWatcherMorph.prototype.styleLarge = function () {\n    this.setStyle('large');\n};\n\nWatcherMorph.prototype.styleSlider = function () {\n    this.setStyle('slider');\n};\n\nWatcherMorph.prototype.userSetSliderMin = function () {\n    new DialogBoxMorph(\n        this,\n        this.setSliderMin,\n        this\n    ).prompt(\n        \"Slider minimum value\",\n        this.sliderMorph.start.toString(),\n        this.world(),\n        null, // pic\n        null, // choices\n        null, // read only\n        true // numeric\n    );\n};\n\nWatcherMorph.prototype.userSetSliderMax = function () {\n    new DialogBoxMorph(\n        this,\n        this.setSliderMax,\n        this\n    ).prompt(\n        \"Slider maximum value\",\n        this.sliderMorph.stop.toString(),\n        this.world(),\n        null, // pic\n        null, // choices\n        null, // read only\n        true // numeric\n    );\n};\n\n// WatcherMorph drawing:\n\nWatcherMorph.prototype.render = function (ctx) {\n    var gradient;\n    if (MorphicPreferences.isFlat || (this.edge === 0 && this.border === 0)) {\n        BoxMorph.uber.render.call(this, ctx);\n        return;\n    }\n    gradient = ctx.createLinearGradient(0, 0, 0, this.height());\n    gradient.addColorStop(0, this.color.lighter().toString());\n    gradient.addColorStop(1, this.color.darker().toString());\n    ctx.fillStyle = gradient;\n    ctx.beginPath();\n    this.outlinePath(\n        ctx,\n        Math.max(this.edge - this.border, 0),\n        this.border\n    );\n    ctx.closePath();\n    ctx.fill();\n    if (this.border > 0) {\n        gradient = ctx.createLinearGradient(0, 0, 0, this.height());\n        gradient.addColorStop(0, this.borderColor.lighter().toString());\n        gradient.addColorStop(1, this.borderColor.darker().toString());\n        ctx.lineWidth = this.border;\n        ctx.strokeStyle = gradient;\n        ctx.beginPath();\n        this.outlinePath(ctx, this.edge, this.border / 2);\n        ctx.closePath();\n        ctx.stroke();\n    }\n};\n\n// StagePrompterMorph ////////////////////////////////////////////////////////\n\n/*\n    I am a sensor-category-colored input box at the bottom of the stage\n    which lets the user answer to a question. If I am opened from within\n    the context of a sprite, my question can be anything that is displayable\n    in a SpeechBubble and will be, if I am opened from within the stage\n    my question will be shown as a single line of text within my label morph.\n*/\n\n// StagePrompterMorph inherits from BoxMorph:\n\nStagePrompterMorph.prototype = new BoxMorph();\nStagePrompterMorph.prototype.constructor = StagePrompterMorph;\nStagePrompterMorph.uber = BoxMorph.prototype;\n\n// StagePrompterMorph instance creation:\n\nexport function StagePrompterMorph(question) {\n    this.init(question);\n}\n\nStagePrompterMorph.prototype.init = function (question) {\n    // question is optional in case the Stage is asking\n\n    // additional properties\n    this.isDone = false;\n    if (question) {\n        this.label = new StringMorph(\n            question,\n            SpriteMorph.prototype.bubbleFontSize,\n            null, // fontStyle\n            SpriteMorph.prototype.bubbleFontIsBold,\n            false, // italic\n            'left'\n        );\n    } else {\n        this.label = null;\n    }\n    this.inputField = new InputFieldMorph();\n    this.button = new PushButtonMorph(\n        null,\n        () => this.accept(),\n        '\\u2713'\n    );\n\n    // initialize inherited properties\n    StagePrompterMorph.uber.init.call(\n        this,\n        SyntaxElementMorph.prototype.rounding,\n        SpriteMorph.prototype.bubbleBorder,\n        SpriteMorph.prototype.blockColor.sensing\n    );\n\n    // override inherited behavior\n    this.color = WHITE;\n    if (this.label) {this.add(this.label); }\n    this.add(this.inputField);\n    this.add(this.button);\n    this.setWidth(StageMorph.prototype.dimensions.x - 20);\n    this.fixLayout();\n};\n\n// StagePrompterMorph layout:\n\nStagePrompterMorph.prototype.fixLayout = function () {\n    var y = 0;\n    if (this.label) {\n        this.label.setPosition(new Point(\n            this.left() + this.edge,\n            this.top() + this.edge\n        ));\n        y = this.label.bottom() - this.top();\n    }\n    this.inputField.setPosition(new Point(\n        this.left() + this.edge,\n        this.top() + y + this.edge\n    ));\n    this.inputField.setWidth(\n        this.width()\n            - this.edge * 2\n            - this.button.width()\n            - this.border\n    );\n    this.button.setCenter(this.inputField.center());\n    this.button.setLeft(this.inputField.right() + this.border);\n    this.setHeight(\n        this.inputField.bottom()\n            - this.top()\n            + this.edge\n    );\n};\n\n// StagePrompterMorph events:\n\nStagePrompterMorph.prototype.mouseClickLeft = function () {\n    this.inputField.edit();\n};\n\nStagePrompterMorph.prototype.accept = function () {\n    this.isDone = true;\n};\n","/*\n\n    blocks.js\n\n    a programming construction kit\n    based on morphic.js\n    inspired by Scratch\n\n    written by Jens Mnig\n    jens@moenig.org\n\n    Copyright (C) 2020 by Jens Mnig\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    prerequisites:\n    --------------\n    needs morphic.js, symbols.js and widgets.js\n\n\n    hierarchy\n    ---------\n    the following tree lists all constructors hierarchically,\n    indentation indicating inheritance. Refer to this list to get a\n    contextual overview:\n\n        Morph*\n            ArrowMorph\n            BlockHighlightMorph\n            ScriptsMorph\n            SyntaxElementMorph\n                ArgMorph\n                    ArgLabelMorph\n                    BooleanSlotMorph\n                    ColorSlotMorph\n                    CommandSlotMorph\n                        CSlotMorph\n                        RingCommandSlotMorph\n                    FunctionSlotMorph\n                        ReporterSlotMorph\n                            RingReporterSlotMorph\n                    InputSlotMorph\n                        TextSlotMorph\n                    MultiArgMorph\n                    TemplateSlotMorph\n                BlockMorph\n                    CommandBlockMorph\n                        HatBlockMorph\n                    ReporterBlockMorph\n                        RingMorph\n        BoxMorph*\n            CommentMorph\n            ScriptFocusMorph\n        StringMorph*\n            BlockLabelMorph\n            InputSlotStringMorph\n            InputSlotTextMorph\n        SymbolMorph*\n            BlockSymbolMorph\n\n    * from morphic.js\n\n\n    toc\n    ---\n    the following list shows the order in which all constructors are\n    defined. Use this list to locate code in this document:\n\n        SyntaxElementMorph\n        BlockLabelMorph\n        BlockSymbolMorph\n        BlockMorph\n        CommandBlockMorph\n        HatBlockMorph\n        ReporterBlockMorph\n        RingMorph\n        ScriptsMorph\n        ArgMorph\n        CommandSlotMorph\n        RingCommandSlotMorph\n        CSlotMorph\n        InputSlotMorph\n        InputSlotStringMorph\n        InputSlotTextMorph\n        BooleanSlotMorph\n        ArrowMorph\n        TextSlotMorph\n        ColorSlotMorph\n        TemplateSlotMorph\n        BlockHighlightMorph\n        MultiArgMorph\n        ArgLabelMorph\n        FunctionSlotMorph\n        ReporterSlotMorph\n        RingReporterSlotMorph\n        CommentMorph\n\n\n    structure of syntax elements\n    ----------------------------\n    the structure of syntax elements is identical with their morphic\n    tree. There are, however, accessor methods to get (only) the\n    parts which are relevant for evaluation wherever appropriate.\n\n    In Scratch/BYOB every sprite and the stage has its own \"blocks bin\",\n    an instance of ScriptsMorph (we're going to name it differently in\n    Snap, probably just \"scripts\").\n\n    At the top most level blocks are assembled into stacks in ScriptsMorph\n    instances. A ScriptsMorph contains nothing but blocks, therefore\n    every child of a ScriptsMorph is expected to be a block.\n\n    Each block contains:\n\n        selector    - indicating the name of the function it triggers,\n\n    Its arguments are first evaluated and then passed along    as the\n    selector is called. Arguments can be either instances of ArgMorph\n    or ReporterBlockMorph. The getter method for a block's arguments is\n\n        inputs()    - gets an array of arg morphs and/or reporter blocks\n\n    in addition to inputs, command blocks also know their\n\n        nextBlock()    - gets the block attached to the receiver's bottom\n\n    and the block they're attached to - if any: Their parent.\n\n    please also refer to the high-level comment at the beginning of each\n    constructor for further details.\n*/\n\n/*global Array, BoxMorph,\nColor, ColorPaletteMorph, FrameMorph, Function, HandleMorph, Math, MenuMorph,\nMorph, MorphicPreferences, Object, Point, ScrollFrameMorph, ShadowMorph, ZERO,\nString, StringMorph, TextMorph, contains, degrees, detect, PianoMenuMorph,\ndocument, getDocumentPositionOf, isNaN, isString, newCanvas, nop, parseFloat,\nradians, useBlurredShadows, SpeechBubbleMorph, modules, StageMorph, Sound,\nfontHeight, TableFrameMorph, SpriteMorph, Context, ListWatcherMorph, Rectangle,\nDialogBoxMorph, BlockInputFragmentMorph, PrototypeHatBlockMorph, WHITE, BLACK,\nCostume, IDE_Morph, BlockDialogMorph, BlockEditorMorph, localize, isNil, CLEAR,\nisSnapObject, PushButtonMorph, SpriteIconMorph, Process, AlignmentMorph,\nCustomCommandBlockMorph, SymbolMorph, ToggleButtonMorph, DialMorph*/\n\n// Global stuff ////////////////////////////////////////////////////////\n\n\n\n\n\n\nimport {BoxMorph,\n  Color, ColorPaletteMorph, FrameMorph, HandleMorph, MenuMorph,\n  Morph, MorphicPreferences, Point, ScrollFrameMorph, ShadowMorph, ZERO,\n   StringMorph, TextMorph, contains, degrees, detect,\n   getDocumentPositionOf, isString, newCanvas, nop,\n  radians, useBlurredShadows, SpeechBubbleMorph, modules,\n  fontHeight, Rectangle,\n  localize, isNil, WHITE, BLACK, CLEAR,\n  DialMorph} from './morphic.js'\n\nimport {SymbolMorph} from './symbols.js'\n\nimport {PianoMenuMorph,  DialogBoxMorph,\n   PushButtonMorph,  AlignmentMorph,\n    ToggleButtonMorph\n} from './widgets.js'\nimport {SpriteMorph,\n   StageMorph, Sound,\n  Costume,\n  isSnapObject} from \"./objects\";\n\n// import { CustomCommandBlockMorph, BlockInputFragmentMorph,\n//   BlockDialogMorph, BlockEditorMorph, PrototypeHatBlockMorph} from './byob'\nimport {IDE_Morph} from \"./gui\";\n\nmodules.blocks = '2020-November-17';\n\n// var SyntaxElementMorph;\n// var BlockMorph;\n// var BlockLabelMorph;\n// var BlockSymbolMorph;\n// var CommandBlockMorph;\n// var ReporterBlockMorph;\n// var ScriptsMorph;\n// var ArgMorph;\n// var CommandSlotMorph;\n// var CSlotMorph;\n// var InputSlotMorph;\n// var InputSlotStringMorph;\n// var InputSlotTextMorph;\n// var BooleanSlotMorph;\n// var ArrowMorph;\n// var ColorSlotMorph;\n// var HatBlockMorph;\n// var BlockHighlightMorph;\n// var MultiArgMorph;\n// var TemplateSlotMorph;\n// var FunctionSlotMorph;\n// var ReporterSlotMorph;\n// var RingMorph;\n// var RingCommandSlotMorph;\n// var RingReporterSlotMorph;\n// var CommentMorph;\n// var ArgLabelMorph;\n// var TextSlotMorph;\n// var ScriptFocusMorph;\n\n// SyntaxElementMorph //////////////////////////////////////////////////\n\n// I am the ancestor of all blocks and input slots\n\n// SyntaxElementMorph inherits from Morph:\n\nSyntaxElementMorph.prototype = new Morph();\nSyntaxElementMorph.prototype.constructor = SyntaxElementMorph;\nSyntaxElementMorph.uber = Morph.prototype;\n\n// SyntaxElementMorph preferences settings:\n\n/*\n    the following settings govern the appearance of all syntax elements\n    (blocks and slots) where applicable:\n\n    outline:\n\n        corner      - radius of command block rounding\n        rounding    - radius of reporter block rounding\n        edge        - width of 3D-ish shading box\n        hatHeight   - additional top space for hat blocks\n        hatWidth    - minimum width for hat blocks\n        rfBorder    - pixel width of reification border (grey outline)\n        minWidth    - minimum width for any syntax element's contents\n\n    jigsaw shape:\n\n        inset       - distance from indentation to left edge\n        dent        - width of indentation bottom\n\n    paddings:\n\n        bottomPadding   - adds to the width of the bottom most c-slot\n        cSlotPadding    - adds to the width of the open \"C\" in c-slots\n        typeInPadding   - adds pixels between text and edge in input slots\n        labelPadding    - adds left/right pixels to block labels\n\n    label:\n\n        labelFontName       - <string> specific font family name\n        labelFontStyle      - <string> generic font family name, cascaded\n        fontSize            - duh\n        embossing           - <Point> offset for embossing effect\n        labelWidth          - column width, used for word wrapping\n        labelWordWrap       - <bool> if true labels can break after each word\n        dynamicInputLabels  - <bool> if true inputs can have dynamic labels\n\n    snapping:\n\n        feedbackMinHeight   - height of white line for command block snaps\n        minSnapDistance     - threshold when commands start snapping\n        reporterDropFeedbackPadding  - increases reporter drop feedback\n\n    color gradients:\n\n        contrast        - <percent int> 3D-ish shading gradient contrast\n        labelContrast   - <percent int> 3D-ish label shading contrast\n        activeHighlight - <Color> for stack highlighting when active\n        errorHighlight  - <Color> for error highlighting\n        activeBlur      - <pixels int> shadow for blurred activeHighlight\n        activeBorder    - <pixels int> unblurred activeHighlight\n        rfColor         - <Color> for reified outlines and slot backgrounds\n*/\n\nSyntaxElementMorph.prototype.contrast = 65;\n\nSyntaxElementMorph.prototype.setScale = function (num) {\n    var scale = Math.min(Math.max(num, 1), 25);\n    this.scale = scale;\n    this.corner = 3 * scale;\n    this.rounding = 9 * scale;\n    this.edge = scale;\n    this.flatEdge = scale * 0.5;\n    this.jag = 5 * scale;\n    this.inset = 6 * scale;\n    this.hatHeight = 12 * scale;\n    this.hatWidth = 70 * scale;\n    this.rfBorder = 3 * scale;\n    this.minWidth = 0;\n    this.dent = 8 * scale;\n    this.bottomPadding = 3 * scale;\n    this.cSlotPadding = 4 * scale;\n    this.typeInPadding = scale;\n    this.labelPadding = 4 * scale;\n    this.labelFontName = 'Verdana';\n    this.labelFontStyle = 'sans-serif';\n    this.fontSize = 10 * scale;\n    this.embossing = new Point(\n        -1 * Math.max(scale / 2, 1),\n        -1 * Math.max(scale / 2, 1)\n    );\n    this.labelWidth = 450 * scale;\n    this.labelWordWrap = true;\n    this.dynamicInputLabels = true;\n    this.feedbackMinHeight = 5;\n    this.minSnapDistance = 20;\n    this.reporterDropFeedbackPadding = 10 * scale;\n    this.labelContrast = 25;\n    this.activeHighlight = new Color(153, 255, 213);\n    this.errorHighlight = new Color(173, 15, 0);\n    this.activeBlur = 20;\n    this.activeBorder = 4;\n    this.rfColor = new Color(120, 120, 120);\n};\n\nSyntaxElementMorph.prototype.setScale(1);\nSyntaxElementMorph.prototype.isCachingInputs = false;\nSyntaxElementMorph.prototype.alpha = 1;\n\n// SyntaxElementMorph instance creation:\n\nexport function SyntaxElementMorph() {\n    this.init();\n}\n\nSyntaxElementMorph.prototype.init = function () {\n    this.cachedClr = null;\n    this.cachedClrBright = null;\n    this.cachedClrDark = null;\n    this.cachedNormalColor = null; // for single-stepping\n    this.isStatic = false; // if true, I cannot be exchanged\n\n    SyntaxElementMorph.uber.init.call(this);\n\n    this.defaults = [];\n    this.cachedInputs = null;\n    delete this.alpha;\n};\n\n// SyntaxElementMorph accessing:\n\nSyntaxElementMorph.prototype.isNonPartMorph = function(child) {\n    return child instanceof ShadowMorph ||\n        child instanceof BlockHighlightMorph;\n};\n\nSyntaxElementMorph.prototype.parts = function () {\n    // answer my non-crontrol submorphs\n    var nb = null, myself = this;;\n    if (this.nextBlock) { // if I am a CommandBlock or a HatBlock\n        nb = this.nextBlock();\n    }\n    return this.children.filter(child =>\n        // Edit(Thomas): use isNonPartMorph\n        (child !== nb) && !this.isNonPartMorph(child)\n    );\n};\n\nSyntaxElementMorph.prototype.inputs = function () {\n    // answer my arguments and nested reporters\n    if (isNil(this.cachedInputs) || !this.isCachingInputs) {\n        this.cachedInputs = this.parts().filter(part =>\n            part instanceof SyntaxElementMorph\n        );\n    }\n    // this.debugCachedInputs();\n    return this.cachedInputs;\n};\n\nSyntaxElementMorph.prototype.debugCachedInputs = function () {\n    // private - only used for manually debugging inputs caching\n    var realInputs, i;\n    if (!isNil(this.cachedInputs)) {\n        realInputs = this.parts().filter(part =>\n            part instanceof SyntaxElementMorph\n        );\n    }\n    if (this.cachedInputs.length !== realInputs.length) {\n        throw new Error('cached inputs size do not match: ' +\n            this.constructor.name);\n    }\n    for (i = 0; i < realInputs.length; i += 1) {\n        if (this.cachedInputs[i] !== realInputs[i]) {\n            throw new Error('cached input does not match: ' +\n                this.constructor.name +\n                ' #' +\n                i +\n                ' ' +\n                this.cachedInputs[i].constructor.name +\n                ' != ' +\n                realInputs[i].constructor.name);\n        }\n    }\n};\n\nSyntaxElementMorph.prototype.allInputs = function () {\n    // answer arguments and nested reporters of all children\n    return this.allChildren().slice(0).reverse().filter(child =>\n        (child instanceof ArgMorph) ||\n            (child instanceof ReporterBlockMorph &&\n                child !== this)\n    );\n};\n\nSyntaxElementMorph.prototype.allEmptySlots = function () {\n    // answer empty input slots of all children excluding myself,\n    // but omit those in nested rings (lambdas) and JS-Function primitives.\n    // Used by the evaluator when binding implicit formal parameters\n    // to empty input slots\n    var empty = [];\n    if (!(this instanceof RingMorph) &&\n            // disregard custom C-slots, because they should be treated as\n            // rings. Commented out for now...\n            // !(this instanceof CSlotMorph && !this.isStatic) &&\n            (this.selector !== 'reportJSFunction')) {\n        this.children.forEach(morph => {\n            if (morph.isEmptySlot && morph.isEmptySlot()) {\n                empty.push(morph);\n            } else if (morph.allEmptySlots) {\n                empty = empty.concat(morph.allEmptySlots());\n            }\n        });\n    }\n    return empty;\n};\n\nSyntaxElementMorph.prototype.tagExitBlocks = function (stopTag, isCommand) {\n    // tag 'report' and 'stop this block' blocks of all children including\n    // myself, with either a stopTag (for \"stop\" blocks) or an indicator of\n    // being inside a command block definition, but omit those in nested\n    // rings (lambdas. Used by the evaluator when entering a procedure\n    if (this.selector === 'doReport') {\n        this.partOfCustomCommand = isCommand;\n    } else if (this.selector === 'doStopThis') {\n        this.exitTag = stopTag;\n    } else {\n        if (!(this instanceof RingMorph)) {\n            this.children.forEach(morph => {\n                if (morph.tagExitBlocks) {\n                    morph.tagExitBlocks(stopTag, isCommand);\n                }\n            });\n        }\n    }\n};\n\nSyntaxElementMorph.prototype.replaceInput = function (oldArg, newArg) {\n    var scripts = this.parentThatIsA(ScriptsMorph),\n        replacement = newArg,\n        idx = this.children.indexOf(oldArg),\n        i = 0;\n\n    // try to find the ArgLabel embedding the newArg,\n    // used for the undrop() feature\n    if (idx === -1 && newArg instanceof MultiArgMorph) {\n        this.children.forEach(morph => {\n            if (morph instanceof ArgLabelMorph &&\n                morph.argMorph() === oldArg\n            ) {\n                idx = i;\n            }\n            i += 1;\n        });\n    }\n\n    if (oldArg.cachedSlotSpec) {oldArg.cachedSlotSpec = null; }\n    if (newArg.cachedSlotSpec) {newArg.cachedSlotSpec = null; }\n\n    this.changed();\n    if (newArg.parent) {\n        newArg.parent.removeChild(newArg);\n    }\n    if (oldArg instanceof MultiArgMorph) {\n        oldArg.inputs().forEach(inp => // preserve nested reporters\n            oldArg.replaceInput(inp, new InputSlotMorph())\n        );\n        if (this.dynamicInputLabels) {\n            replacement = new ArgLabelMorph(newArg);\n        }\n    }\n    replacement.parent = this;\n    this.children[idx] = replacement;\n    if (oldArg instanceof ReporterBlockMorph && scripts &&\n        !oldArg.isPrototype\n    ) {\n        if (!(oldArg instanceof RingMorph)\n                || (oldArg instanceof RingMorph && oldArg.contents())) {\n            scripts.add(oldArg);\n            oldArg.moveBy(replacement.extent());\n            oldArg.fixBlockColor();\n        }\n    }\n    if (replacement instanceof MultiArgMorph\n            || replacement instanceof ArgLabelMorph\n            || replacement.constructor === CommandSlotMorph) {\n        replacement.fixLayout();\n        if (this.fixLabelColor) { // special case for variadic continuations\n            this.fixLabelColor();\n        }\n    } else {\n        this.fixLayout();\n    }\n    this.cachedInputs = null;\n};\n\nSyntaxElementMorph.prototype.revertToDefaultInput = function (arg, noValues) {\n    var idx = this.parts().indexOf(arg),\n        inp = this.inputs().indexOf(arg),\n        deflt = new InputSlotMorph(),\n        def;\n\n    if (idx !== -1) {\n        if (this instanceof BlockMorph) {\n            deflt = this.labelPart(this.parseSpec(this.blockSpec)[idx]);\n            if (this.isCustomBlock) {\n                def = this.isGlobal ? this.definition\n                        : this.scriptTarget().getMethod(this.blockSpec);\n                if (deflt instanceof InputSlotMorph) {\n                    deflt.setChoices.apply(\n                        deflt,\n                        def.inputOptionsOfIdx(inp)\n                    );\n                }\n                if (deflt instanceof InputSlotMorph ||\n                    (deflt instanceof BooleanSlotMorph)\n                ) {\n                    deflt.setContents(\n                        def.defaultValueOfInputIdx(inp)\n                    );\n                }\n            }\n        } else if (this instanceof MultiArgMorph) {\n            deflt = this.labelPart(this.slotSpec);\n        } else if (this instanceof ReporterSlotMorph) {\n            deflt = this.emptySlot();\n        }\n    }\n    // set default value\n    if (!noValues) {\n        if (inp !== -1) {\n            if (deflt instanceof MultiArgMorph) {\n                deflt.setContents(this.defaults);\n                deflt.defaults = this.defaults;\n            } else if (!isNil(this.defaults[inp])) {\n                deflt.setContents(this.defaults[inp]);\n            }\n        }\n    }\n    if (deflt.icon || deflt instanceof BooleanSlotMorph) {\n        deflt.fixLayout();\n    }\n    this.replaceInput(arg, deflt);\n    if (deflt instanceof MultiArgMorph) {\n        deflt.refresh();\n    } else if (deflt instanceof RingMorph) {\n        deflt.fixBlockColor();\n    }\n    this.cachedInputs = null;\n};\n\nSyntaxElementMorph.prototype.isLocked = function () {\n    // answer true if I can be exchanged by a dropped reporter\n    return this.isStatic;\n};\n\n// SyntaxElementMorph enumerating:\n\nSyntaxElementMorph.prototype.topBlock = function () {\n    if (this.parent && this.parent.topBlock) {\n        return this.parent.topBlock();\n    }\n    return this;\n};\n\n// SyntaxElementMorph reachable variables\n\n// SyntaxElementMorph.prototype.getVarNamesDict = function () {\n//     var block = this.parentThatIsA(BlockMorph),\n//         rcvr,\n//         tempVars = [],\n//         dict;\n//\n//     if (!block) {\n//         return {};\n//     }\n//     rcvr = block.scriptTarget();\n//     block.allParents().forEach(morph => {\n//         if (morph instanceof PrototypeHatBlockMorph) {\n//             tempVars.push.apply(\n//                 tempVars,\n//                 morph.variableNames()\n//             );\n//             tempVars.push.apply(\n//                 tempVars,\n//                 morph.inputs()[0].inputFragmentNames()\n//             );\n//         } else if (morph instanceof BlockMorph) {\n//             morph.inputs().forEach(inp => {\n//                 inp.allChildren().forEach(child => {\n//                     if (child instanceof TemplateSlotMorph) {\n//                         tempVars.push(child.contents());\n//                     } else if (child instanceof MultiArgMorph) {\n//                         child.children.forEach(m => {\n//                             if (m instanceof TemplateSlotMorph) {\n//                                 tempVars.push(m.contents());\n//                             }\n//                         });\n//                     }\n//                 });\n//             });\n//         }\n//     });\n//     if (rcvr) {\n//         dict = rcvr.variables.allNamesDict();\n//         tempVars.forEach(name =>\n//             dict[name] = name\n//         );\n//         if (block.selector === 'doSetVar') {\n//             // add settable object attributes\n//             dict['~'] = null;\n//             dict.my = [{// wrap the submenu into a 1-item array to translate it\n//                 'anchor' : ['my anchor'],\n//                 'parent' : ['my parent'],\n//                 'name' : ['my name'],\n//                 'temporary?' : ['my temporary?'],\n//                 'dangling?' : ['my dangling?'],\n//                 'draggable?' : ['my draggable?'],\n//                 'rotation style' : ['my rotation style'],\n//                 'rotation x' : ['my rotation x'],\n//                 'rotation y' : ['my rotation y']\n//             }];\n//             if (this.world().currentKey === 16) { // shift\n//                 dict.my[0]['~'] = null; // don't forget we're inside an array...\n//                 dict.my[0]['microphone modifier'] = ['microphone modifier'];\n//             }\n//         }\n//         return dict;\n//     }\n//     return {};\n// };\n\n// Variable refactoring\n\nSyntaxElementMorph.prototype.refactorVarInStack = function (\n    oldName,\n    newName,\n    isScriptVar\n) {\n    // Rename all oldName var occurrences found in this block stack into newName\n    // taking care of not being too greedy\n\n    if ((this instanceof RingMorph && contains(this.inputNames(), oldName))\n            || (!isScriptVar && this.definesScriptVariable(oldName))) {\n        return;\n    }\n\n    if (this.selector === 'reportGetVar'\n            && this.blockSpec === oldName) {\n        this.setSpec(newName);\n        this.fullChanged();\n        this.fixLabelColor();\n    }\n\n    if (this.choices === 'getVarNamesDict'\n            && this.contents().text === oldName) {\n        this.setContents(newName);\n    }\n\n    if (this instanceof CustomCommandBlockMorph\n            && this.definition.body\n            && isNil(this.definition.declarations.get(oldName))\n            && !contains(this.definition.variableNames, oldName)) {\n        this.definition.body.expression.refactorVarInStack(oldName, newName);\n    }\n\n    this.inputs().forEach(input =>\n        input.refactorVarInStack(oldName, newName)\n    );\n\n    if (this.nextBlock) {\n        var nb = this.nextBlock();\n        if (nb) {\n            nb.refactorVarInStack(oldName, newName);\n        }\n    }\n};\n\nSyntaxElementMorph.prototype.definesScriptVariable = function (name) {\n    // Returns true if this block is defining either a script local var or\n    // an upVar called `name`\n    return (this.selector === 'doDeclareVariables' ||\n            (this.blockSpec && this.blockSpec.match('%upvar'))\n    ) && detect(\n        this.inputs()[0].allInputs(),\n            input => (input.selector === 'reportGetVar' &&\n                input.blockSpec === name)\n    );\n};\n\n// SyntaxElementMorph copy-on-write support:\n\nSyntaxElementMorph.prototype.selectForEdit = function () {\n    var scripts = this.parentThatIsA(ScriptsMorph),\n        ide = this.parentThatIsA(IDE_Morph),\n        rcvr = ide ? ide.currentSprite : null,\n        selected;\n    if (scripts && rcvr && rcvr.inheritsAttribute('scripts')) {\n        // copy on write:\n        this.selectionID = true;\n        rcvr.shadowAttribute('scripts');\n        selected = detect(\n            rcvr.scripts.allChildren(),\n            m => m.selectionID\n        );\n        delete this.selectionID;\n        delete selected.selectionID;\n        return selected;\n    }\n    return this;\n};\n\n// SyntaxElementMorph drag & drop:\n\nSyntaxElementMorph.prototype.reactToGrabOf = function (grabbedMorph) {\n    var topBlock = this.topBlock(),\n        affected;\n    if (grabbedMorph instanceof CommandBlockMorph) {\n        affected = this.parentThatIsA(CommandSlotMorph, ReporterSlotMorph);\n        if (affected) {\n            affected.fixLayout();\n        }\n    }\n    if (topBlock) {\n        topBlock.allComments().forEach(comment =>\n            comment.align(topBlock)\n        );\n        if (topBlock.getHighlight()) {\n            topBlock.addHighlight(topBlock.removeHighlight());\n        }\n    }\n};\n\n// SyntaxElementMorph 3D - border color rendering:\n\nSyntaxElementMorph.prototype.bright = function () {\n    return this.color.lighter(this.contrast).toString();\n};\n\nSyntaxElementMorph.prototype.dark = function () {\n    return this.color.darker(this.contrast).toString();\n};\n\n// SyntaxElementMorph color changing:\n\nSyntaxElementMorph.prototype.setColor = function (aColor) {\n    var block;\n    if (aColor) {\n        if (!this.color.eq(aColor)) {\n            block = this.parentThatIsA(BlockMorph);\n            this.color = aColor;\n            this.children.forEach(morph => {\n                if (block && (morph instanceof StringMorph ||\n                        morph instanceof SymbolMorph)) {\n                    morph.shadowColor = block.color.darker(\n                        block.labelContrast\n                    );\n                    morph.rerender();\n                } else if (morph instanceof CommandSlotMorph) {\n                    morph.setColor(aColor);\n                }\n            });\n            this.rerender();\n        }\n    }\n};\n\nSyntaxElementMorph.prototype.setLabelColor = function (\n    textColor,\n    shadowColor,\n    shadowOffset\n) {\n    this.children.forEach(morph => {\n        if (morph instanceof StringMorph && !morph.isProtectedLabel) {\n            morph.shadowOffset = shadowOffset || morph.shadowOffset;\n            morph.shadowColor = shadowColor || morph.shadowColor;\n            morph.setColor(textColor);\n        } else if (morph instanceof MultiArgMorph\n                || morph instanceof ArgLabelMorph\n                || (morph instanceof SymbolMorph && !morph.isProtectedLabel)\n                || (morph instanceof InputSlotMorph\n                    && morph.isReadOnly)) {\n            morph.setLabelColor(textColor, shadowColor, shadowOffset);\n        } else if (morph.isLoop) { // C-shaped slot with loop arrow symbol\n            // morph.loop().setLabelColor(textColor, shadowColor, shadowOffset); //HACK(rzhi): disable for showing hint\n        }\n    });\n};\n\nSyntaxElementMorph.prototype.flash = function () {\n    if (!this.cachedNormalColor) {\n        this.cachedNormalColor = this.color;\n        this.setColor(this.activeHighlight);\n    }\n};\n\nSyntaxElementMorph.prototype.unflash = function () {\n    if (this.cachedNormalColor) {\n        var clr = this.cachedNormalColor;\n        this.cachedNormalColor = null;\n        this.setColor(clr);\n    }\n};\n\nSyntaxElementMorph.prototype.doWithAlpha = function (alpha, callback) {\n    var current = SyntaxElementMorph.prototype.alpha,\n        result;\n    SyntaxElementMorph.prototype.alpha = alpha;\n    result = callback();\n    SyntaxElementMorph.prototype.alpha = current;\n    return result;\n};\n\n// SyntaxElementMorph zebra coloring\n\nSyntaxElementMorph.prototype.fixBlockColor = function (\n    nearestBlock,\n    isForced\n) {\n    this.children.forEach(morph => {\n        if (morph instanceof SyntaxElementMorph) {\n            morph.fixBlockColor(nearestBlock, isForced);\n        }\n    });\n};\n\n// SyntaxElementMorph label parts:\n\nSyntaxElementMorph.prototype.labelPart = function (spec) {\n    var part, tokens;\n    if (spec[0] === '%' &&\n            spec.length > 1 &&\n            (this.selector !== 'reportGetVar' ||\n                (spec === '%turtleOutline' && this.isObjInputFragment()))) {\n\n        // check for variable multi-arg-slot:\n        if ((spec.length > 5) && (spec.slice(0, 5) === '%mult')) {\n            part = new MultiArgMorph(spec.slice(5));\n            part.addInput();\n            return part;\n        }\n\n        // single-arg and specialized multi-arg slots:\n        switch (spec) {\n        case '%imgsource':\n            part = new InputSlotMorph(\n                null, // text\n                false, // non-numeric\n                {\n                    'pen trails': ['pen trails'],\n                    'stage image': ['stage image']\n                },\n                true\n            );\n            break;\n        case '%inputs':\n            part = new MultiArgMorph('%s', 'with inputs');\n            part.isStatic = false;\n            part.canBeEmpty = false;\n            break;\n        case '%scriptVars':\n            part = new MultiArgMorph('%t', null, 1, spec);\n            part.canBeEmpty = false;\n            break;\n        case '%blockVars':\n            part = new MultiArgMorph('%t', 'block variables', 0, spec);\n            part.canBeEmpty = false;\n            break;\n        case '%parms':\n            part = new MultiArgMorph('%t', 'Input Names:', 0, spec);\n            part.canBeEmpty = false;\n            break;\n        case '%ringparms':\n            part = new MultiArgMorph(\n                '%t',\n                'input names:',\n                0,\n                spec\n            );\n            break;\n        case '%cmdRing':\n            part = new RingMorph();\n            part.color = SpriteMorph.prototype.blockColor.other;\n            part.selector = 'reifyScript';\n            part.setSpec('%rc %ringparms');\n            part.isDraggable = true;\n            break;\n        case '%repRing':\n            part = new RingMorph();\n            part.color = SpriteMorph.prototype.blockColor.other;\n            part.selector = 'reifyReporter';\n            part.setSpec('%rr %ringparms');\n            part.isDraggable = true;\n            part.isStatic = true;\n            break;\n        case '%predRing':\n            part = new RingMorph(true);\n            part.color = SpriteMorph.prototype.blockColor.other;\n            part.selector = 'reifyPredicate';\n            part.setSpec('%rp %ringparms');\n            part.isDraggable = true;\n            part.isStatic = true;\n            break;\n        case '%words':\n            part = new MultiArgMorph('%s', null, 0);\n            part.addInput(); // allow for default value setting\n            part.addInput(); // allow for default value setting\n            break;\n        case '%lists':\n            part = new MultiArgMorph('%l', null, 0);\n            part.addInput();\n            part.addInput();\n            break;\n        case '%exp':\n            part = new MultiArgMorph('%s', null, 0);\n            part.addInput();\n            part.isStatic = true;\n            part.canBeEmpty = false;\n            break;\n        case '%br':\n            part = new Morph();\n            part.setExtent(ZERO);\n            part.isBlockLabelBreak = true;\n            part.getSpec = () => '%br';\n            break;\n        case '%inputName':\n            part = new ReporterBlockMorph();\n            part.category = 'variables';\n            part.color = SpriteMorph.prototype.blockColor.variables;\n            part.setSpec(localize('Input name'));\n            break;\n        case '%s':\n            part = new InputSlotMorph();\n            break;\n        case '%anyUE':\n            part = new InputSlotMorph();\n            part.isUnevaluated = true;\n            break;\n        case '%txt':\n            part = new InputSlotMorph(); // supports whitespace dots\n            // part = new TextSlotMorph(); // multi-line, no whitespace dots\n            part.minWidth = part.height() * 1.7; // \"landscape\"\n            part.fixLayout();\n            break;\n        case '%mlt':\n            part = new TextSlotMorph();\n            part.fixLayout();\n            break;\n        case '%code':\n            part = new TextSlotMorph();\n            part.contents().fontName = 'monospace';\n            part.contents().fontStyle = 'monospace';\n            part.fixLayout();\n            break;\n        case '%obj':\n            part = new ArgMorph('object');\n            break;\n        case '%n':\n            part = new InputSlotMorph(null, true);\n            break;\n        case '%dir':\n            part = new InputSlotMorph(\n                null,\n                true,\n                {\n                \t'_dir': null,\n                    '(90) right' : 90,\n                    '(-90) left' : -90,\n                    '(0) up' : 0,\n                    '(180) down' : 180,\n                    'random' : ['random']\n                }\n            );\n            break;\n        case '%note':\n            part = new InputSlotMorph(\n                null, // test\n                true, // numeric\n                'pianoKeyboardMenu',\n                false // read-only\n            );\n            break;\n        case '%inst':\n            part = new InputSlotMorph(\n                null,\n                true,\n                {\n                    '(1) sine' : 1,\n                    '(2) square' : 2,\n                    '(3) sawtooth' : 3,\n                    '(4) triangle' : 4\n                }\n            );\n            break;\n        case '%audio':\n            part = new InputSlotMorph(\n                null, // text\n                false, // numeric?\n                'audioMenu',\n                true // read-only\n            );\n            break;\n        case '%aa': // audio attributes\n            part = new InputSlotMorph(\n                null, // text\n                false, // numeric?\n                {\n                    'name' : ['name'],\n                    'duration' : ['duration'],\n                    'length' : ['length'],\n                    'number of channels' : ['number of channels'],\n                    'sample rate' : ['sample rate'],\n                    'samples' : ['samples']\n                },\n                true // read-only\n            );\n            break;\n        case '%img': // image attributes\n            part = new InputSlotMorph(\n                null, // text\n                false, // numeric?\n                {\n                    'name' : ['name'],\n                    'width' : ['width'],\n                    'height' : ['height'],\n                    'pixels' : ['pixels']\n                },\n                true // read-only\n            );\n            break;\n        case '%rate':\n            part = new InputSlotMorph(\n                null,\n                true,\n                {\n                    '22.05 kHz' : 22050,\n                    '44.1 kHz' : 44100,\n                    '48 kHz' : 48000,\n                    '88.2 kHz' : 88200,\n                    '96 kHz' : 96000\n                }\n            );\n            break;\n        case '%interaction':\n            part = new InputSlotMorph(\n                null, // text\n                false, // numeric?\n                {\n                    'clicked' : ['clicked'],\n                    'pressed' : ['pressed'],\n                    'dropped' : ['dropped'],\n                    'mouse-entered' : ['mouse-entered'],\n                    'mouse-departed' : ['mouse-departed'],\n                    'scrolled-up' : ['scrolled-up'],\n                    'scrolled-down' : ['scrolled-down'],\n                    'stopped' : ['stopped'] // experimental\n                },\n                true // read-only\n            );\n            part.isStatic = true;\n            break;\n        case '%dates':\n            part = new InputSlotMorph(\n                null, // text\n                false, // non-numeric\n                {\n                    'year' : ['year'],\n                    'month' : ['month'],\n                    'date' : ['date'],\n                    'day of week' : ['day of week'],\n                    'hour' : ['hour'],\n                    'minute' : ['minute'],\n                    'second' : ['second'],\n                    'time in milliseconds' : ['time in milliseconds']\n                },\n                true // read-only\n            );\n            break;\n        case '%delim':\n            part = new InputSlotMorph(\n                null, // text\n                false, // numeric?\n                {\n                    'letter' : ['letter'],\n                    'word' : ['word'],\n                    'line' : ['line'],\n                    'tab' : ['tab'],\n                    'cr' : ['cr'],\n                    'csv' : ['csv'],\n                    'json' : ['json']\n                    /*\n                    'csv records' : ['csv records'],\n                    'csv fields' : ['csv fields']\n                    */\n                },\n                false // read-only\n            );\n            break;\n        case '%ida':\n            part = new InputSlotMorph(\n                null,\n                true,\n                {\n                    '1' : 1,\n                    last : ['last'],\n                    '~' : null,\n                    all : ['all']\n                }\n            );\n            break;\n        case '%idx':\n            part = new InputSlotMorph(\n                null,\n                true,\n                {\n                    '1' : 1,\n                    last : ['last'],\n                    any : ['any']\n                }\n            );\n            break;\n        case '%dim':\n            part = new InputSlotMorph(\n                null,\n                true,\n                {\n                    current : ['current']\n                }\n            );\n            break;\n        case '%rel':\n            part = new InputSlotMorph(\n                null, // text\n                false, // numeric?\n                {\n                    'distance' : ['distance'],\n                    'direction' : ['direction']\n                },\n                true // read-only\n            );\n            break;\n        case '%loc': // location\n            part = new InputSlotMorph(\n                null,\n                false,\n                'locationMenu',\n                true\n            );\n            break;\n        case '%spr':\n            part = new InputSlotMorph(\n                null,\n                false,\n                'objectsMenu',\n                true\n            );\n            break;\n        case '%self':\n            part = new InputSlotMorph(\n                null,\n                false,\n                'objectsMenuWithSelf',\n                true\n            );\n            break;\n        case '%col': // collision detection\n            part = new InputSlotMorph(\n                null,\n                false,\n                'collidablesMenu',\n                true\n            );\n            break;\n        case '%dst': // distance measuring\n            part = new InputSlotMorph(\n                null,\n                false,\n                'distancesMenu',\n                true\n            );\n            break;\n        case '%cln': // clones\n            part = new InputSlotMorph(\n                null,\n                false,\n                'clonablesMenu',\n                true\n            );\n            break;\n        case '%get': // sprites, parts, speciment, clones\n            part = new InputSlotMorph(\n                null,\n                false,\n                'gettablesMenu',\n                true\n            );\n            part.isStatic = true;\n            break;\n        case '%cst':\n            part = new InputSlotMorph(\n                null,\n                false,\n                'costumesMenu',\n                true\n            );\n            break;\n        case '%eff':\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    color: ['color'],\n                    saturation: ['saturation'],\n                    brightness : ['brightness'],\n                    ghost: ['ghost'],\n                    fisheye: ['fisheye'],\n                    whirl: ['whirl'],\n                    pixelate: ['pixelate'],\n                    mosaic: ['mosaic'],\n                    negative : ['negative']\n                    // duplicate: ['duplicate'],\n                    // comic: ['comic'],\n                    // confetti: ['confetti']\n                },\n                true\n            );\n            break;\n        case '%snd':\n            part = new InputSlotMorph(\n                null,\n                false,\n                'soundsMenu',\n                true\n            );\n            break;\n        case '%key':\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    'any key' : ['any key'],\n                    'up arrow': ['up arrow'],\n                    'down arrow': ['down arrow'],\n                    'right arrow': ['right arrow'],\n                    'left arrow': ['left arrow'],\n                    space : ['space'],\n                    '+' : ['+'],\n                    '-' : ['-'],\n                    a : ['a'],\n                    b : ['b'],\n                    c : ['c'],\n                    d : ['d'],\n                    e : ['e'],\n                    f : ['f'],\n                    g : ['g'],\n                    h : ['h'],\n                    i : ['i'],\n                    j : ['j'],\n                    k : ['k'],\n                    l : ['l'],\n                    m : ['m'],\n                    n : ['n'],\n                    o : ['o'],\n                    p : ['p'],\n                    q : ['q'],\n                    r : ['r'],\n                    s : ['s'],\n                    t : ['t'],\n                    u : ['u'],\n                    v : ['v'],\n                    w : ['w'],\n                    x : ['x'],\n                    y : ['y'],\n                    z : ['z'],\n                    '0' : ['0'],\n                    '1' : ['1'],\n                    '2' : ['2'],\n                    '3' : ['3'],\n                    '4' : ['4'],\n                    '5' : ['5'],\n                    '6' : ['6'],\n                    '7' : ['7'],\n                    '8' : ['8'],\n                    '9' : ['9']\n                },\n                true\n            );\n            break;\n        case '%keyHat':\n            part = this.labelPart('%key');\n            part.isStatic = true;\n            break;\n        case '%msg':\n            part = new InputSlotMorph(\n                null,\n                false,\n                'messagesMenu',\n                true\n            );\n            break;\n        case '%msgHat':\n            part = new InputSlotMorph(\n                null,\n                false,\n                'messagesReceivedMenu',\n                true\n            );\n            part.isStatic = true;\n            break;\n        case '%att':\n            part = new InputSlotMorph(\n                null,\n                false,\n                'attributesMenu',\n                true\n            );\n            break;\n        case '%fun':\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    abs : ['abs'],\n                    // '\\u2212' : ['\\u2212'], // minus-sign\n                    neg : ['neg'],\n                    ceiling : ['ceiling'],\n                    floor : ['floor'],\n                    sqrt : ['sqrt'],\n                    sin : ['sin'],\n                    cos : ['cos'],\n                    tan : ['tan'],\n                    asin : ['asin'],\n                    acos : ['acos'],\n                    atan : ['atan'],\n                    ln : ['ln'],\n                    log : ['log'],\n                    lg : ['lg'],\n                    'e^' : ['e^'],\n                    '10^' : ['10^'],\n                    '2^' : ['2^'],\n                    id: ['id']\n                },\n                true\n            );\n            break;\n        case '%layer':\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    front : ['front'],\n                    back : ['back']\n                },\n                true\n            );\n            break;\n        case '%hsva':\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    hue : ['hue'],\n                    saturation : ['saturation'],\n                    brightness : ['brightness'],\n                    transparency : ['transparency']\n                },\n                true\n            );\n            break;\n        case '%pen':\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    size : ['size'],\n                    hue : ['hue'],\n                    saturation : ['saturation'],\n                    brightness : ['brightness'],\n                    transparency : ['transparency']\n                },\n                true\n            );\n            break;\n        case '%asp': // aspect\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    hue : ['hue'],\n                    saturation : ['saturation'],\n                    brightness : ['brightness'],\n                    transparency : ['transparency'],\n                    'r-g-b-a' : ['r-g-b-a'],\n                    '~' : null,\n                    sprites : ['sprites'],\n                },\n                true\n            );\n            break;\n        case '%layer':\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    front : ['front'],\n                    back : ['back']\n                },\n                true\n            );\n            part.setContents(['front']);\n            break;\n        case '%hsva':\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    hue : ['hue'],\n                    saturation : ['saturation'],\n                    brightness : ['brightness'],\n                    transparency : ['transparency']\n                },\n                true\n            );\n            part.setContents(['hue']);\n            break;\n        case '%asp': // aspect\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    hue : ['hue'],\n                    saturation : ['saturation'],\n                    brightness : ['brightness'],\n                    transparency : ['transparency'],\n                    '~' : null,\n                    sprites : ['sprites'],\n                },\n                true\n            );\n            part.setContents(['hue']);\n            break;\n        case '%txtfun':\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    'encode URI' : ['encode URI'],\n                    'decode URI' : ['decode URI'],\n                    'encode URI component' : ['encode URI component'],\n                    'decode URI component' : ['decode URI component'],\n                    'XML escape' : ['XML escape'],\n                    'XML unescape' : ['XML unescape'],\n                    'hex sha512 hash' : ['hex sha512 hash']\n                },\n                true\n            );\n            break;\n        case '%stopChoices':\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    'all' : ['all'],\n                    'this script' : ['this script'],\n                    'this block' : ['this block'],\n                    'all but this script' : ['all but this script'],\n                    'other scripts in sprite' : ['other scripts in sprite']\n                },\n                true\n            );\n            part.isStatic = true;\n            break;\n        case '%setting':\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    'turbo mode' : ['turbo mode'],\n                    'flat line ends' : ['flat line ends'],\n                    'log pen vectors' : ['log pen vectors'],\n                    'video capture' : ['video capture'],\n                    'mirror video' : ['mirror video']\n                },\n                true\n            );\n            part.isStatic = true;\n            break;\n        case '%typ':\n            part = new InputSlotMorph(\n                null,\n                false,\n                'typesMenu',\n                true\n            );\n            break;\n        case '%mapValue':\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    String : ['String'],\n                    Number : ['Number'],\n                    'true' : ['true'],\n                    'false' : ['false']\n                },\n                true\n            );\n            part.isStatic = true;\n            break;\n        case '%var':\n            part = new InputSlotMorph(\n                null,\n                false,\n                'getVarNamesDict',\n                true\n            );\n            part.isStatic = true;\n            break;\n        case '%shd':\n            part = new InputSlotMorph(\n                null,\n                false,\n                'shadowedVariablesMenu',\n                true\n            );\n            // part.isStatic = true;\n            break;\n        case '%codeKind':\n            part = new InputSlotMorph(\n                null,\n                false,\n                {\n                    code : ['code'],\n                    header : ['header']\n                },\n                true\n            );\n            break;\n        case '%l':\n            part = new ArgMorph('list');\n            break;\n        case '%b':\n            part = new BooleanSlotMorph();\n            break;\n        case '%boolUE':\n            part = new BooleanSlotMorph();\n            part.isUnevaluated = true;\n            break;\n        case '%bool':\n            part = new BooleanSlotMorph(true);\n            part.isStatic = true;\n            break;\n        case '%cmd':\n            part = new CommandSlotMorph();\n            break;\n        case '%rc':\n            part = new RingCommandSlotMorph();\n            part.isStatic = true;\n            break;\n        case '%rr':\n            part = new RingReporterSlotMorph();\n            part.isStatic = true;\n            break;\n        case '%rp':\n            part = new RingReporterSlotMorph(true);\n            part.isStatic = true;\n            break;\n        case '%c':\n            part = new CSlotMorph();\n            part.isStatic = true;\n            break;\n        case '%cs':\n            part = new CSlotMorph(); // non-static\n            break;\n        case '%ca':\n            part = new CSlotMorph(); // non-static\n            part.isLoop = true; // has a loop symbol\n            part.add(this.labelPart('%loopArrow'));\n            break;\n        case '%cl':\n            part = new CSlotMorph();\n            part.isStatic = true; // rejects reporter drops\n            part.isLambda = true; // auto-reifies nested script\n            break;\n        case '%cla':\n            part = new CSlotMorph();\n            part.isStatic = true; // rejects reporter drops\n            part.isLambda = true; // auto-reifies nested script\n            part.isLoop = true; // has a loop symbol\n            // part.add(this.labelPart('%loopArrow')); //HACK(rzhi): for displaying hint correctly\n            break;\n        case '%loop':\n            part = new CSlotMorph();\n            part.isStatic = true;\n            part.isLoop = true; // has a loop symbol\n            // part.add(this.labelPart('%loopArrow')); //HACK(rzhi): for displaying hint correctly\n            break;\n        case '%loopArrow':\n            // part = new BlockSymbolMorph('loop'); //HACK(rzhi): for displaying hint correctly\n            // part.size = this.fontSize * 0.7;\n            // part.color = WHITE;\n            // part.shadowColor = this.color.darker(this.labelContrast);\n            // part.shadowOffset = MorphicPreferences.isFlat ?\n            //         ZERO : this.embossing;\n            // part.isFading = true;\n            // part.fixLayout();\n            break;\n        case '%clr':\n            part = new ColorSlotMorph();\n            part.isStatic = true;\n            break;\n        case '%t':\n            part = new TemplateSlotMorph('a');\n            break;\n        case '%upvar':\n            part = new TemplateSlotMorph('\\u2191'); // up-arrow\n            break;\n        case '%f':\n            part = new FunctionSlotMorph();\n            break;\n        case '%r':\n            part = new ReporterSlotMorph();\n            break;\n        case '%p':\n            part = new ReporterSlotMorph(true);\n            break;\n\n    // code mapping (experimental)\n\n        case '%codeListPart':\n            part = new InputSlotMorph(\n                null, // text\n                false, // numeric?\n                {\n                    'list' : ['list'],\n                    'item' : ['item'],\n                    'delimiter' : ['delimiter']\n                },\n                true // read-only\n            );\n            break;\n        case '%codeListKind':\n            part = new InputSlotMorph(\n                null, // text\n                false, // numeric?\n                {\n                    'collection' : ['collection'],\n                    'variables' : ['variables'],\n                    'parameters' : ['parameters']\n                },\n                true // read-only\n            );\n            break;\n\n    // symbols:\n\n        case '%turtle':\n            part = new BlockSymbolMorph('turtle');\n            part.size = this.fontSize * 1.2;\n            part.color = WHITE;\n            part.shadowColor = this.color.darker(this.labelContrast);\n            part.shadowOffset = MorphicPreferences.isFlat ?\n                    ZERO : this.embossing;\n            part.fixLayout();\n            break;\n        case '%turtleOutline':\n            part = new BlockSymbolMorph('turtleOutline');\n            part.size = this.fontSize;\n            part.color = WHITE;\n            part.isProtectedLabel = true; // doesn't participate in zebraing\n            part.shadowColor = this.color.darker(this.labelContrast);\n            part.shadowOffset = MorphicPreferences.isFlat ?\n                    ZERO : this.embossing;\n            part.fixLayout();\n            break;\n        case '%clockwise':\n            part = new BlockSymbolMorph('turnRight');\n            part.size = this.fontSize * 1.5;\n            part.color = WHITE;\n            part.isProtectedLabel = false; // zebra colors\n            part.shadowColor = this.color.darker(this.labelContrast);\n            part.shadowOffset = MorphicPreferences.isFlat ?\n                    ZERO : this.embossing;\n            part.fixLayout();\n            break;\n        case '%counterclockwise':\n            part = new BlockSymbolMorph('turnLeft');\n            part.size = this.fontSize * 1.5;\n            part.color = WHITE;\n            part.isProtectedLabel = false; // zebra colors\n            part.shadowColor = this.color.darker(this.labelContrast);\n            part.shadowOffset = MorphicPreferences.isFlat ?\n                    ZERO : this.embossing;\n            part.fixLayout();\n            break;\n        case '%greenflag':\n            part = new BlockSymbolMorph('flag');\n            part.size = this.fontSize * 1.5;\n            part.color = new Color(0, 200, 0);\n            part.isProtectedLabel = true; // doesn't participate in zebraing\n            part.shadowColor = this.color.darker(this.labelContrast);\n            part.shadowOffset = MorphicPreferences.isFlat ?\n                    ZERO : this.embossing;\n            part.fixLayout();\n            break;\n        case '%stop':\n            part = new BlockSymbolMorph('octagon');\n            part.size = this.fontSize * 1.5;\n            part.color = new Color(200, 0, 0);\n            part.isProtectedLabel = true; // doesn't participate in zebraing\n            part.shadowColor = this.color.darker(this.labelContrast);\n            part.shadowOffset = MorphicPreferences.isFlat ?\n                    ZERO : this.embossing;\n            part.fixLayout();\n            break;\n        case '%pause':\n            part = new BlockSymbolMorph('pause');\n            part.size = this.fontSize;\n            part.color = new Color(255, 220, 0);\n            part.isProtectedLabel = true; // doesn't participate in zebraing\n            part.shadowColor = this.color.darker(this.labelContrast);\n            part.shadowOffset = MorphicPreferences.isFlat ?\n                    ZERO : this.embossing;\n            part.fixLayout();\n            break;\n        case '%blitz':\n            part = new BlockSymbolMorph('flash');\n            part.size = this.fontSize;\n            part.color = WHITE;\n            part.isProtectedLabel = false; // zebra colors\n            part.shadowColor = this.color.darker(this.labelContrast);\n            part.shadowOffset = MorphicPreferences.isFlat ?\n                    ZERO : this.embossing;\n            part.fixLayout();\n            break;\n        case '%list':\n            part = new BlockSymbolMorph('list');\n            part.size = this.fontSize;\n            part.color = WHITE;\n            part.shadowColor = this.color.darker(this.labelContrast);\n            part.shadowOffset = MorphicPreferences.isFlat ?\n                    ZERO : this.embossing;\n            part.fixLayout();\n            break;\n\n        // Video motion\n\n        case '%vid':\n            part = new InputSlotMorph(\n                null,\n                false, {\n                    'snap': ['snap'],\n                    'motion': ['motion'],\n                    'direction': ['direction']\n                },\n                true // read-only\n            );\n            break;\n        case '%on':\n            part = new InputSlotMorph(\n                null,\n                false, {\n                    'this sprite': ['this sprite'],\n                    'stage': ['stage']\n                },\n                true // read-only\n            );\n            break;\n        default:\n            nop();\n        }\n    } else if (spec[0] === '$' &&\n            spec.length > 1 &&\n            this.selector !== 'reportGetVar') {\n\n        // allow GUI symbols as label icons\n        // usage: $symbolName[-size-r-g-b], size and color values are optional\n        // If there isn't a symbol under that name, it just styles whatever is\n        // after \"$\", so you can add unicode icons to your blocks, for example\n        // \n        tokens = spec.slice(1).split('-');\n        if (!contains(SymbolMorph.prototype.names, tokens[0])) {\n            part = new StringMorph(tokens[0]);\n            part.fontName = this.labelFontName;\n            part.fontStyle = this.labelFontStyle;\n            part.fontSize = this.fontSize * (+tokens[1] || 1);\n        } else {\n            part = new BlockSymbolMorph(tokens[0]);\n            part.size = this.fontSize * (+tokens[1] || 1.2);\n        }\n        part.color = new Color(\n            +tokens[2] === 0 ? 0 : +tokens[2] || 255,\n            +tokens[3] === 0 ? 0 : +tokens[3] || 255,\n            +tokens[4] === 0 ? 0 : +tokens[4] || 255\n        );\n        part.isProtectedLabel = tokens.length > 2; // zebra colors\n        part.shadowColor = this.color.darker(this.labelContrast);\n        part.shadowOffset = MorphicPreferences.isFlat ?\n                ZERO : this.embossing;\n        part.fixLayout();\n    } else {\n        part = new BlockLabelMorph(\n            spec, // text\n            this.fontSize, // fontSize\n            this.labelFontStyle, // fontStyle\n            true, // bold\n            false, // italic\n            false, // isNumeric\n            MorphicPreferences.isFlat ?\n                    ZERO : this.embossing, // shadowOffset\n            this.color.darker(this.labelContrast), // shadowColor\n            WHITE, // color\n            this.labelFontName // fontName\n        );\n\n    }\n    return part;\n};\n\nSyntaxElementMorph.prototype.isObjInputFragment = function () {\n    // private - for displaying a symbol in a variable block template\n    return (this.selector === 'reportGetVar') &&\n        (this.getSlotSpec() === '%t') &&\n        (this.parent.fragment.type === '%obj');\n};\n\n// SyntaxElementMorph layout:\n\nSyntaxElementMorph.prototype.fixLayout = function () {\n    var nb,\n        parts = this.parts(),\n        pos = this.position(),\n        x = 0,\n        y,\n        lineHeight = 0,\n        maxX = 0,\n        blockWidth = this.minWidth,\n        blockHeight,\n        l = [],\n        lines = [],\n        space = this.isPrototype ?\n                1 : Math.floor(fontHeight(this.fontSize) / 3),\n        ico = this instanceof BlockMorph && this.hasLocationPin() ?\n        \tthis.methodIconExtent().x + space : 0,\n        bottomCorrection,\n        hasLoopCSlot = false,\n        hasLoopArrow = false;\n\n    if ((this instanceof MultiArgMorph) && (this.slotSpec !== '%cs')) {\n        blockWidth += this.arrows().width();\n    } else if (this instanceof ReporterBlockMorph) {\n        blockWidth += (this.rounding * 2) + (this.edge * 2);\n    } else {\n        blockWidth += (this.corner * 4)\n            + (this.edge * 2)\n            + (this.inset * 3)\n            + this.dent;\n    }\n\n    if (this.nextBlock) {\n        nb = this.nextBlock();\n    }\n\n    // determine lines\n    parts.forEach(part => {\n        if ((part instanceof CSlotMorph)\n                || (part.slotSpec === '%cs')) {\n            if (l.length > 0) {\n                lines.push(l);\n                lines.push([part]);\n                l = [];\n                x = 0;\n            } else {\n                lines.push([part]);\n            }\n        // Edit(Thomas): use isNonPartMorph\n        } else if (this.isNonPartMorph(part)) {\n            nop(); // should be redundant now\n            // this.fullChanged();\n            // this.removeChild(part);\n        } else {\n            if (part.isVisible) {\n                x += part.fullBounds().width() + space;\n            }\n            if ((x > this.labelWidth) || part.isBlockLabelBreak) {\n                if (l.length > 0) {\n                    lines.push(l);\n                    l = [];\n                    x = part.fullBounds().width() + space;\n                }\n            }\n            l.push(part);\n            if (part.isBlockLabelBreak) {\n                x = 0;\n            }\n        }\n    });\n    if (l.length > 0) {\n        lines.push(l);\n    }\n\n    // distribute parts on lines\n    if (this instanceof CommandBlockMorph) {\n        y = this.top() + this.corner + this.edge;\n        if (this instanceof HatBlockMorph) {\n            y += this.hatHeight;\n        }\n    } else if (this instanceof ReporterBlockMorph) {\n        y = this.top() + (this.edge * 2);\n    } else if (this instanceof MultiArgMorph\n            || this instanceof ArgLabelMorph) {\n        y = this.top();\n        if (this.slotSpec === '%cs' && this.inputs().length > 0) {\n            y -= this.rounding;\n        }\n    }\n    lines.forEach(line => {\n        if (hasLoopCSlot) {\n            hasLoopArrow = true;\n            hasLoopCSlot = false;\n        }\n        x = this.left() + ico + this.edge + this.labelPadding;\n        if (this instanceof RingMorph) {\n            x = this.left() + space; //this.labelPadding;\n        } else if (this.isPredicate) {\n            x = this.left() + ico + this.rounding;\n        } else if (this instanceof MultiArgMorph ||\n            this instanceof ArgLabelMorph\n        ) {\n            x = this.left();\n        }\n        y += lineHeight;\n        lineHeight = 0;\n        line.forEach(part => {\n            if (part.isLoop) {\n                hasLoopCSlot = true;\n            }\n            if (part instanceof CSlotMorph) {\n                x -= this.labelPadding;\n                if (this.isPredicate) {\n                    x = this.left() + ico + this.rounding;\n                }\n                part.setColor(this.color);\n                part.setPosition(new Point(x, y));\n                lineHeight = part.height();\n            } else if (part instanceof MultiArgMorph &&\n                    (part.slotSpec === '%cs')) {\n                if (this.isPredicate) {\n                    x += this.corner;\n                }\n                part.setPosition(new Point(x, y));\n                lineHeight = part.height();\n            } else if (part instanceof MultiArgMorph &&\n                    (part.slotSpec === '%cs')) {\n                if (myself.isPredicate) {\n                    x += myself.corner;\n                }\n                part.setPosition(new Point(x, y));\n                lineHeight = part.height();\n            } else {\n                part.setPosition(new Point(x, y));\n                if (!part.isBlockLabelBreak) {\n                    if (part.slotSpec === '%c' || part.slotSpec === '%loop') {\n                        x += part.width();\n                    } else if (part.isVisible) {\n                        x += part.fullBounds().width() + space;\n                    }\n                }\n                maxX = Math.max(maxX, x);\n                lineHeight = Math.max(\n                    lineHeight,\n                    part instanceof StringMorph ?\n                            part.rawHeight() : part.height()\n                );\n            }\n        });\n\n    // adjust label row below a loop-arrow C-slot to accomodate the loop icon\n    if (hasLoopArrow) {\n        x += this.fontSize * 1.5;\n        maxX = Math.max(maxX, x);\n        hasLoopArrow = false;\n    }\n\n    // center parts vertically on each line:\n        line.forEach(part => {\n            part.moveBy(new Point(\n                0,\n                Math.floor((lineHeight - part.height()) / 2)\n            ));\n        });\n    });\n\n    // determine my height:\n    y += lineHeight;\n    if (this.children.some(any => any instanceof CSlotMorph)) {\n        bottomCorrection = this.bottomPadding;\n        if (this instanceof ReporterBlockMorph && !this.isPredicate) {\n            bottomCorrection = Math.max(\n                this.bottomPadding,\n                this.rounding - this.bottomPadding\n            );\n        }\n        y += bottomCorrection;\n    }\n    if (this instanceof CommandBlockMorph) {\n        blockHeight = y - this.top() + (this.corner * 2);\n    } else if (this instanceof ReporterBlockMorph) {\n        blockHeight = y - this.top() + (this.edge * 2);\n    } else if (this instanceof MultiArgMorph\n            || this instanceof ArgLabelMorph) {\n        blockHeight = y - this.top();\n    }\n\n    // determine my width:\n    if (this.isPredicate) {\n        blockWidth = Math.max(\n            blockWidth,\n            maxX - this.left() + this.rounding\n        );\n    } else if ((this instanceof MultiArgMorph && this.slotSpec !== '%cs')\n            || this instanceof ArgLabelMorph) {\n        blockWidth = Math.max(\n            blockWidth,\n            maxX - this.left() - space\n        );\n    } else {\n        blockWidth = Math.max(\n            blockWidth,\n            maxX - this.left() + this.labelPadding - this.edge\n        );\n        // adjust right padding if rightmost input has arrows\n        if (parts[parts.length - 1] instanceof MultiArgMorph\n                && (lines.length === 1)) {\n            blockWidth -= space;\n        }\n        // adjust width to hat width\n        if (this instanceof HatBlockMorph) {\n            blockWidth = Math.max(blockWidth, this.hatWidth * 1.5);\n        }\n    }\n\n    // set my extent (silently, because we'll redraw later anyway):\n    this.bounds.setWidth(blockWidth);\n    this.bounds.setHeight(blockHeight);\n\n    // adjust CSlots and collect holes\n    this.holes = [];\n    parts.forEach(part => {\n        var adjustMultiWidth = 0;\n        if (part instanceof CSlotMorph || (part.slotSpec === '%cs')) {\n            if (this.isPredicate) {\n                part.bounds.setWidth(\n                    blockWidth -\n                        ico -\n                        this.rounding -\n                        this.inset -\n                        this.corner\n                );\n                adjustMultiWidth = this.corner;\n            } else {\n                part.bounds.setWidth(blockWidth - this.edge - ico);\n                adjustMultiWidth = this.corner + this.edge;\n            }\n            if (part.fixLoopLayout) {\n                part.fixLoopLayout();\n            }\n        }\n        if (part.slotSpec === '%cs') { // a multi-arg\n            part.inputs().forEach(slot =>\n                slot.bounds.setWidth(\n                    part.right() - slot.left() - adjustMultiWidth\n                )\n            );\n        }\n        part.fixHolesLayout();\n        this.holes.push.apply(\n            this.holes,\n            part.holes.map( hole =>\n                hole.translateBy(part.position().subtract(pos))\n            )\n        );\n    });\n\n    // position next block:\n    if (nb) {\n        nb.setPosition(\n            new Point(\n                this.left(),\n                this.bottom() - (this.corner)\n            )\n        );\n    }\n\n    // find out if one of my parents needs to be fixed\n    if (this instanceof BlockMorph && this.parent && this.parent.fixLayout) {\n        this.parent.fixLayout();\n        this.parent.changed();\n        if (this.parent instanceof SyntaxElementMorph) {\n            return;\n        }\n    }\n\n    this.fixHighlight();\n};\n\nSyntaxElementMorph.prototype.fixHighlight = function () {\n    var top = this.topBlock();\n    if (top.getHighlight && top.getHighlight()) {\n        top.addHighlight(top.removeHighlight());\n    }\n};\n\nSyntaxElementMorph.prototype.methodIconExtent = function () {\n    // answer the span of the icon for the \"local method\" indicator\n    var ico = this.fontSize * 1.2;\n    return this.hasLocationPin() ? new Point(ico * 0.66, ico)\n    \t\t: new Point(0, 0);\n};\n\n// SyntaxElementMorph evaluating:\n\nSyntaxElementMorph.prototype.evaluate = function () {\n    // responsibility of my children, default is to answer null\n    return null;\n};\n\nSyntaxElementMorph.prototype.isEmptySlot = function () {\n    // responsibility of my children, default is to answer false\n    return false;\n};\n\n// SyntaxElementMorph speech bubble feedback:\n\n// SyntaxElementMorph.prototype.showBubble = function (value, exportPic, target) {\n//     var bubble,\n//         txt,\n//         img,\n//         morphToShow,\n//         isClickable = false,\n//         ide = this.parentThatIsA(IDE_Morph),\n//         anchor = this,\n//         pos = this.rightCenter().add(new Point(2, 0)),\n//         sf = this.parentThatIsA(ScrollFrameMorph),\n//         wrrld = this.world();\n//\n//     if ((value === undefined) || !wrrld) {\n//         return null;\n//     }\n//     if (value instanceof ListWatcherMorph) {\n//         morphToShow = value;\n//         morphToShow.update(true);\n//         morphToShow.step = value.update;\n//         morphToShow.isDraggable = false;\n//         morphToShow.expand(this.parentThatIsA(ScrollFrameMorph).extent());\n//         isClickable = true;\n//     } else if (value instanceof TableFrameMorph) {\n//         morphToShow = value;\n//         morphToShow.isDraggable = false;\n//         morphToShow.expand(this.parentThatIsA(ScrollFrameMorph).extent());\n//         isClickable = true;\n//     } else if (value instanceof Morph) {\n//         if (isSnapObject(value)) {\n//             img = value.thumbnail(new Point(40, 40));\n//             morphToShow = new Morph();\n//             morphToShow.isCachingImage = true;\n//             morphToShow.bounds.setWidth(img.width);\n//             morphToShow.bounds.setHeight(img.height);\n//             morphToShow.cachedImage = img;\n//             morphToShow.version = value.version;\n//             morphToShow.step = function () {\n//                 if (this.version !== value.version) {\n//                     img = value.thumbnail(new Point(40, 40));\n//                     this.cachedImage = img;\n//                     this.version = value.version;\n//                     this.changed();\n//                 }\n//             };\n//         } else {\n//             img = value.fullImage();\n//             morphToShow = new Morph();\n//             morphToShow.isCachingImage = true;\n//             morphToShow.bounds.setWidth(img.width);\n//             morphToShow.bounds.setHeight(img.height);\n//             morphToShow.cachedImage = img;\n//         }\n//     } else if (value instanceof Costume) {\n//         img = value.thumbnail(new Point(40, 40));\n//         morphToShow = new Morph();\n//         morphToShow = new Morph();\n//         morphToShow.isCachingImage = true;\n//         morphToShow.bounds.setWidth(img.width);\n//         morphToShow.bounds.setHeight(img.height);\n//         morphToShow.cachedImage = img;\n//     } else if (value instanceof Sound) {\n//         morphToShow = new SymbolMorph('notes', 30);\n//     } else if (value instanceof Context) {\n//         img = value.image();\n//         morphToShow = new Morph();\n//         morphToShow.isCachingImage = true;\n//         morphToShow.bounds.setWidth(img.width);\n//         morphToShow.bounds.setHeight(img.height);\n//         morphToShow.cachedImage = img;\n//     } else if (typeof value === 'boolean') {\n//         morphToShow = SpriteMorph.prototype.booleanMorph.call(\n//             null,\n//             value\n//         );\n//     } else if (isString(value)) {\n//         txt  = value.length > 500 ? value.slice(0, 500) + '...' : value;\n//         morphToShow = new TextMorph(\n//             txt,\n//             this.fontSize\n//         );\n//     } else if (value === null) {\n//         morphToShow = new TextMorph(\n//             '',\n//             this.fontSize\n//         );\n//     } else if (value === 0) {\n//         morphToShow = new TextMorph(\n//             '0',\n//             this.fontSize\n//         );\n//     } else if (value.toString) {\n//         morphToShow = new TextMorph(\n//             value.toString(),\n//             this.fontSize\n//         );\n//     }\n//     if (ide && (ide.currentSprite !== target)) {\n//         if (target instanceof StageMorph) {\n//             anchor = ide.corral.stageIcon;\n//         } else if (target) {\n//         \tif (target.isTemporary) {\n//          \t\ttarget = detect(\n// \t\t\t\t\ttarget.allExemplars(),\n//      \t\t\t\teach => !each.isTemporary\n//          \t\t);\n//      \t\t}\n//             anchor = detect(\n//                 ide.corral.frame.contents.children,\n//                 icon => icon.object === target\n//             );\n//         } else {\n//         \ttarget = ide;\n//         }\n//         pos = anchor.center();\n//     }\n//     bubble = new SpeechBubbleMorph(\n//         morphToShow,\n//         null,\n//         Math.max(this.rounding - 2, 6),\n//         0\n//     );\n//     bubble.popUp(\n//         wrrld,\n//         pos,\n//         isClickable\n//     );\n//     if (exportPic) {\n//         this.exportPictureWithResult(bubble);\n//     }\n//     if (anchor instanceof SpriteIconMorph) {\n//         bubble.keepWithin(ide.corral);\n//     } else if (sf) {\n//         bubble.keepWithin(sf);\n//     }\n// };\n\nSyntaxElementMorph.prototype.exportPictureWithResult = function (aBubble) {\n    var ide = this.parentThatIsA(IDE_Morph) ||\n            this.parentThatIsA(BlockEditorMorph).target.parentThatIsA(\n                IDE_Morph\n            ),\n        scr = this.fullImage(),\n        bub = aBubble.fullImage(),\n        taller = Math.max(0, bub.height - scr.height),\n        pic = newCanvas(new Point(\n            scr.width + bub.width + 2,\n            scr.height + taller\n        )),\n        ctx = pic.getContext('2d');\n    ctx.drawImage(scr, 0, pic.height - scr.height);\n    ctx.drawImage(bub, scr.width + 2, 0);\n    // request to open pic in new window.\n    ide.saveCanvasAs(\n        pic,\n        (ide.projectName || localize('untitled')) + ' ' + localize('script pic')\n    );\n};\n\n// SyntaxElementMorph code mapping\n\n/*\n    code mapping lets you use blocks to generate arbitrary text-based\n    source code that can be exported and compiled / embedded elsewhere,\n    it's not part of Snap's evaluator and not needed for Snap itself\n*/\n\nSyntaxElementMorph.prototype.mappedCode = function (definitions) {\n    var result = this.evaluate();\n    if (result instanceof BlockMorph) {\n        return result.mappedCode(definitions);\n    }\n    return result;\n};\n\n// BlockLabelMorph ///////////////////////////////////////////////\n\n/*\n    I am a piece of single-line text written on a block. I serve as a\n    container for sharing typographic attributes among my instances\n*/\n\n// BlockLabelMorph inherits from StringMorph:\n\nBlockLabelMorph.prototype = new StringMorph();\nBlockLabelMorph.prototype.constructor = BlockLabelMorph;\nBlockLabelMorph.uber = StringMorph.prototype;\n\nexport function BlockLabelMorph(\n    text,\n    fontSize,\n    fontStyle,\n    bold,\n    italic,\n    isNumeric,\n    shadowOffset,\n    shadowColor,\n    color,\n    fontName\n) {\n    this.init(\n        text,\n        fontSize,\n        fontStyle,\n        bold,\n        italic,\n        isNumeric,\n        shadowOffset,\n        shadowColor,\n        color,\n        fontName\n    );\n}\nBlockLabelMorph.prototype.getRenderColor = function () {\n    var block = this.parentThatIsA(BlockMorph);\n    if (MorphicPreferences.isFlat) {\n        return block.alpha > 0.5 ? this.color\n            : block.color.solid().darker(Math.max(block.alpha * 200, 0.1));\n    }\n    return block.alpha > 0.5 ? this.color\n        : block.color.solid().lighter(Math.max(block.alpha * 200, 0.1));\n\n};\n\nBlockLabelMorph.prototype.getShadowRenderColor = function () {\n    return this.parentThatIsA(BlockMorph).alpha > 0.5 ?\n        this.shadowColor\n            : CLEAR;\n};\n\n// BlockSymbolMorph //////////////////////////////////////////////////////////\n\n/*\n    I am a pictogram written on a block. I serve as a\n    container for sharing typographic attributes among my instances.\n    NOTE: I have an additional attribute \".isFading\" that governs\n    my behavior when fading out the blocks I'm embedded in\n*/\n\n// BlockSymbolMorph inherits from SymbolMorph:\n\nBlockSymbolMorph.prototype = new SymbolMorph();\nBlockSymbolMorph.prototype.constructor = BlockSymbolMorph;\nBlockSymbolMorph.uber = SymbolMorph.prototype;\n\nexport function BlockSymbolMorph(name, size, color, shadowOffset, shadowColor) {\n    this.init(name, size, color, shadowOffset, shadowColor);\n}\n\nBlockSymbolMorph.prototype.getRenderColor = function () {\n    var block = this.parentThatIsA(BlockMorph);\n    if (MorphicPreferences.isFlat) {\n        if (this.isFading) {\n            return this.color.mixed(block.alpha, WHITE);\n        }\n        if (this.color.eq(WHITE)) {\n            return this.parent.alpha > 0.5 ? this.color\n                : block.color.solid().darker(Math.max(block.alpha * 200, 0.1));\n        }\n        if (this.color.eq(BLACK)) {\n            return this.parent.alpha > 0.5 ? this.color\n                : block.color.solid().darker(Math.max(block.alpha * 200, 0.1));\n        }\n        return this.color;\n    }\n    if (this.isFading) {\n        return this.color.mixed(\n            block.alpha,\n            SpriteMorph.prototype.paletteColor\n        );\n    }\n    if (this.color.eq(BLACK)) {\n        return block.alpha > 0.5 ? this.color\n            : block.color.solid().lighter(Math.max(block.alpha * 200, 0.1));\n    }\n    if (this.color.eq(WHITE)) {\n        return this.parent.alpha > 0.5 ? this.color\n            : block.color.solid().lighter(Math.max(block.alpha * 200, 0.1));\n    }\n    return this.color;\n};\n\nBlockSymbolMorph.prototype.getShadowRenderColor = function () {\n    return this.parent.alpha > 0.5 ? this.shadowColor : CLEAR;\n};\n\n// BlockMorph //////////////////////////////////////////////////////////\n\n/*\n    I am an abstraction of all blocks (commands, reporters, hats).\n\n    Aside from the visual settings inherited from Morph and\n    SyntaxElementMorph my most important attributes and public\n    accessors are:\n\n    selector        - (string) name of method to be triggered\n    scriptTarget()  - answer the object (sprite) to which I apply\n    inputs()        - answer an array with my arg slots and nested reporters\n    defaults        - an optional Array containing default input values\n    topBlock()      - answer the top block of the stack I'm attached to\n    blockSpec       - a formalized description of my label parts\n    setSpec()       - force me to change my label structure\n    evaluate()      - answer the result of my evaluation\n    isUnevaluated() - answer whether I am part of a special form\n\n    Zebra coloring provides a mechanism to alternate brightness of nested,\n    same colored blocks (of the same category). The deviation of alternating\n    brightness is set in the preferences setting:\n\n    zebraContrast - <number> percentage of brightness deviation\n\n    attribute. If the attribute is set to zero, zebra coloring is turned\n    off. If it is a positive number, nested blocks will be colored in\n    a brighter shade of the same hue and the label color (for texts)\n    alternates between white and black. If the attribute is set to a negative\n    number, nested blocks are colored in a darker shade of the same hue\n    with no alternating label colors.\n\n    Note: Some of these methods are inherited from SyntaxElementMorph\n    for technical reasons, because they are shared among Block and\n    MultiArgMorph (e.g. topBlock()).\n\n    blockSpec is a formatted string consisting of plain words and\n    reserved words starting with the percent character (%), which\n    represent the following pre-defined input slots and/or label\n    features:\n\n    arity: single\n\n    %br     - user-forced line break\n    %s      - white rectangular type-in slot (\"string-type\")\n    %txt    - white rectangular type-in slot (\"text-type\")\n    %mlt    - white rectangular type-in slot (\"multi-line-text-type\")\n    %code   - white rectangular type-in slot, monospaced font\n    %n      - white roundish type-in slot (\"numerical\")\n    %dir    - white roundish type-in slot with drop-down for directions\n    %inst   - white roundish type-in slot with drop-down for instruments\n    %ida    - white roundish type-in slot with drop-down for list indices\n    %idx    - white roundish type-in slot for indices incl. \"any\"\n    %dim    - white roundish type-in slot for dimensinos incl. \"current\"\n    %obj    - specially drawn slot for object reporters\n    %rel    - chameleon colored rectangular drop-down for relation options\n    %spr    - chameleon colored rectangular drop-down for object-names\n    %col    - chameleon colored rectangular drop-down for collidables\n    %dst    - chameleon colored rectangular drop-down for distances\n    %cst    - chameleon colored rectangular drop-down for costume-names\n    %eff    - chameleon colored rectangular drop-down for graphic effects\n    %snd    - chameleon colored rectangular drop-down for sound names\n    %key    - chameleon colored rectangular drop-down for keyboard keys\n    %msg    - chameleon colored rectangular drop-down for messages\n    %att    - chameleon colored rectangular drop-down for attributes\n    %fun    - chameleon colored rectangular drop-down for math functions\n    %typ    - chameleon colored rectangular drop-down for data types\n    %var    - chameleon colored rectangular drop-down for variable names\n    %shd    - Chameleon colored rectuangular drop-down for shadowed var names\n    %b      - chameleon colored hexagonal slot (for predicates)\n    %bool   - chameleon colored hexagonal slot (for predicates), static\n    %l      - list icon\n    %c      - C-shaped command slot, special form for primitives\n    %loop   - C-shaped with loop arrow, special form for certain primitives\n    %ca     - C-shaped with loop arrow, for custom blocks\n    %cs     - C-shaped, auto-reifying, accepts reporter drops\n    %cl     - C-shaped, auto-reifying, rejects reporters\n    %cla    - C-shaped with loop arrows, auto-reifying, rejects reporters\n    %clr    - interactive color slot\n    %t      - inline variable reporter template\n    %anyUE  - white rectangular type-in slot, unevaluated if replaced\n    %boolUE - chameleon colored hexagonal slot, unevaluated if replaced\n    %f      - round function slot, unevaluated if replaced,\n    %r      - round reporter slot\n    %p      - hexagonal predicate slot\n    %vid    - chameleon colored rectangular drop-down for video modes\n\n    rings:\n\n    %cmdRing    - command slotted ring with %ringparms\n    %repRing    - round slotted ringn with %ringparms\n    %predRing   - diamond slotted ring with %ringparms\n\n    arity: multiple\n\n    %mult%x      - where %x stands for any of the above single inputs\n    %inputs      - for an additional text label 'with inputs'\n    %words       - for an expandable list of default 2 (used in JOIN)\n    %lists       - for an expandable list of default 2 lists (CONCAT)\n    %exp         - for a static expandable list of minimum 0 (used in LIST)\n    %scriptVars  - for an expandable list of variable reporter templates\n    %parms       - for an expandable list of formal parameters\n    %ringparms   - the same for use inside Rings\n\n    special form: upvar\n\n    %upvar       - same as %t (inline variable reporter template)\n\n    special form: input name\n\n    %inputName   - variable blob (used in input type dialog)\n\n    examples:\n\n        'if %b %c else %c'        - creates Scratch's If/Else block\n        'set pen color to %clr'   - creates Scratch's Pen color block\n        'list %mult%s'            - creates BYOB's list reporter block\n        'call %n %inputs'         - creates BYOB's Call block\n        'the script %parms %c'    - creates BYOB's THE SCRIPT block\n*/\n\n// BlockMorph inherits from SyntaxElementMorph:\n\nBlockMorph.prototype = new SyntaxElementMorph();\nBlockMorph.prototype.constructor = BlockMorph;\nBlockMorph.uber = SyntaxElementMorph.prototype;\n// ID for the next BlockMorph to be created\nBlockMorph.nextId = 0;\n// Flag for whether copied BlockMorphs should also copy block IDs\n// This should default to false, but is temporarily set to true in special\n// circumstances, such as block relabeling\nBlockMorph.copyIDs = false;\n\n// BlockMorph preferences settings:\n\nBlockMorph.prototype.isCachingInputs = true;\nBlockMorph.prototype.zebraContrast = 40; // alternating color brightness\n\n// BlockMorph sound feedback:\n\nBlockMorph.prototype.snapSound = null;\n\nBlockMorph.prototype.toggleSnapSound = function () {\n    if (this.snapSound !== null) {\n        this.snapSound = null;\n    } else {\n        BlockMorph.prototype.snapSound = document.createElement('audio');\n        BlockMorph.prototype.snapSound.src = 'src/click.wav';\n    }\n    CommentMorph.prototype.snapSound = BlockMorph.prototype.snapSound;\n};\n\n// BlockMorph instance creation:\n\nexport function BlockMorph() {\n    this.init();\n}\n\nBlockMorph.prototype.init = function () {\n    this.id = BlockMorph.nextId++;\n    this.selector = null; // name of method to be triggered\n    this.blockSpec = ''; // formal description of label and arguments\n    this.comment = null; // optional \"sticky\" comment morph\n\n    // not to be persisted:\n    this.instantiationSpec = null; // spec to set upon fullCopy() of template\n    this.category = null; // for zebra coloring (non persistent)\n    this.isCorpse = false; // marked for deletion fom a custom block definition\n\n    BlockMorph.uber.init.call(this);\n    this.color = new Color(102, 102, 102);\n    this.cachedInputs = null;\n};\n\nBlockMorph.prototype.getNewID = function() {\n    this.id = BlockMorph.nextId++;\n};\n\nBlockMorph.prototype.scriptTarget = function () {\n    // answer the sprite or stage that this block acts on,\n    // if the user clicks on it.\n    // NOTE: since scripts can be shared by more than a single sprite\n    // this method only gives the desired result within the context of\n    // the user actively clicking on a block inside the IDE\n    // there is no direct relationship between a block and a sprite.\n    var scripts = this.parentThatIsA(ScriptsMorph),\n        ide;\n    if (scripts) {\n        return scripts.scriptTarget();\n    }\n    ide = this.parentThatIsA(IDE_Morph);\n    if (ide) {\n        return ide.currentSprite;\n    }\n    throw new Error('script target cannot be found for orphaned block');\n};\n\nBlockMorph.prototype.toString = function () {\n    return 'a ' +\n        (this.constructor.name ||\n            this.constructor.toString().split(' ')[1].split('(')[0]) +\n        ' (\"' +\n        this.blockSpec.slice(0, 30) + '...\")';\n};\n\nBlockMorph.prototype.blockId = function() {\n    return {\n        'selector': this.selector,\n        'id': this.id,\n        'template': this.isTemplate,\n        'spec': this.blockSpec,\n    };\n};\n\nBlockMorph.prototype.userDestroy = function() {\n    // Trace.log('Block.userDestroy', this.blockId());\n};\n\n// BlockMorph spec:\n\nBlockMorph.prototype.parseSpec = function (spec) {\n    var result = [],\n        words,\n        word = '';\n\n    words = isString(spec) ? spec.split(' ') : [];\n    if (words.length === 0) {\n        words = [spec];\n    }\n    if (this.labelWordWrap) {\n        return words;\n    }\n\n    function addWord(w) {\n        if ((w[0] === '%') && (w.length > 1)) {\n            if (word !== '') {\n                result.push(word);\n                word = '';\n            }\n            result.push(w);\n        } else {\n            if (word !== '') {\n                word += ' ' + w;\n            } else {\n                word = w;\n            }\n        }\n    }\n\n    words.forEach(each => addWord(each));\n    if (word !== '') {\n        result.push(word);\n    }\n    return result;\n};\n\nBlockMorph.prototype.setSpec = function (spec, definition) {\n    var part,\n        inputIdx = -1;\n\n    if (!spec) {return; }\n    this.parts().forEach(part =>\n        part.destroy()\n    );\n    if (this.isPrototype) {\n        this.add(this.placeHolder());\n    }\n    this.parseSpec(spec).forEach((word, idx, arr) => {\n        if (word[0] === '%' && (word !== '%br')) {\n            inputIdx += 1;\n        }\n        part = this.labelPart(word);\n        if (isNil(part)) {\n            // console.log('could not create label part', word);\n            return;\n        }\n        this.add(part);\n        if (!(part instanceof CommandSlotMorph ||\n                part instanceof StringMorph)) {\n            part.fixLayout();\n            part.rerender();\n        }\n        if (part instanceof RingMorph) {\n            part.fixBlockColor();\n        }\n        if (part instanceof MultiArgMorph ||\n                part.constructor === CommandSlotMorph ||\n                part.constructor === RingCommandSlotMorph) {\n            part.fixLayout();\n        }\n        if (this.isPrototype) {\n            this.add(this.placeHolder());\n        }\n        if (part instanceof InputSlotMorph && this.isCustomBlock) {\n            part.setChoices.apply(\n                part,\n                (definition || this.definition).inputOptionsOfIdx(inputIdx)\n            );\n        }\n    });\n    this.blockSpec = spec;\n    this.fixLayout();\n    this.rerender();\n    this.cachedInputs = null;\n};\n\nBlockMorph.prototype.userSetSpec = function (spec) {\n    var tb = this.topBlock();\n    tb.fullChanged();\n    this.setSpec(spec);\n    tb.fullChanged();\n};\n\nBlockMorph.prototype.buildSpec = function () {\n    // create my blockSpec from my parts - for demo purposes only\n    this.blockSpec = '';\n    this.parts().forEach(part => {\n        if (part instanceof StringMorph) {\n            this.blockSpec += part.text;\n        } else if (part instanceof ArgMorph) {\n            this.blockSpec += part.getSpec();\n        } else if (part.isBlockLabelBreak) {\n            this.blockSpec += part.getSpec();\n        } else {\n            this.blockSpec += '[undefined]';\n        }\n        this.blockSpec += ' ';\n    });\n    this.blockSpec = this.blockSpec.trim();\n};\n\nBlockMorph.prototype.rebuild = function (contrast) {\n    // rebuild my label fragments, for use in ToggleElementMorphs\n    this.setSpec(this.blockSpec);\n    if (contrast) {\n        this.inputs().forEach(input => {\n            if (input instanceof ReporterBlockMorph) {\n                input.setColor(input.color.lighter(contrast));\n                input.setSpec(input.blockSpec);\n            }\n        });\n    }\n};\n\n// BlockMorph menu:\n//\n// BlockMorph.prototype.userMenu = function () {\n//     var menu = new MenuMorph(this),\n//         world = this.world(),\n//         myself = this,\n//         hasLine = false,\n//         shiftClicked = world.currentKey === 16,\n//         proc = this.activeProcess(),\n//         top = this.topBlock(),\n//         vNames = proc && proc.context && proc.context.outerContext ?\n//                 proc.context.outerContext.variables.names() : [],\n//         alternatives,\n//         field,\n//         rcvr;\n//\n//     function addOption(label, toggle, test, onHint, offHint) {\n//         menu.addItem(\n//             [\n//                 test ? new SymbolMorph(\n//                     'checkedBox',\n//                     MorphicPreferences.menuFontSize * 0.75\n//                 ) : new SymbolMorph(\n//                     'rectangle',\n//                     MorphicPreferences.menuFontSize * 0.75\n//                 ),\n//                 localize(label)\n//             ],\n//             toggle,\n//             test ? onHint : offHint\n//         );\n//     }\n//\n//     function renameVar() {\n//         var blck = myself.fullCopy();\n//         blck.addShadow();\n//         new DialogBoxMorph(\n//             myself,\n//             function(arg) {\n//                 // Trace.log('Block.rename', {\n//                 //     'id': myself.blockId(),\n//                 //     'name': arg,\n//                 // });\n//                 myself.userSetSpec(arg);\n//             },\n//             myself\n//         ).prompt(\n//             \"Variable name\",\n//             myself.blockSpec,\n//             world,\n//             blck.doWithAlpha(1, () => blck.fullImage()), // pic\n//             InputSlotMorph.prototype.getVarNamesDict.call(myself)\n//         );\n//     }\n//\n//     menu.addItem(\n//         \"help...\",\n//         'showHelp'\n//     );\n//     if (this.isTemplate) {\n//         if (this.parent instanceof SyntaxElementMorph) { // in-line\n//             if (this.selector === 'reportGetVar') { // script var definition\n//                 menu.addLine();\n//                 menu.addItem(\n//                     'rename...',\n//                     () => this.refactorThisVar(true), // just the template\n//                     'rename only\\nthis reporter'\n//                 );\n//                 menu.addItem(\n//                     'rename all...',\n//                     'refactorThisVar',\n//                     'rename all blocks that\\naccess this variable'\n//                 );\n//             }\n//         } else { // in palette\n//             if (this.selector === 'reportGetVar') {\n//                 rcvr = this.scriptTarget();\n//                 if (this.isInheritedVariable(false)) { // fully inherited\n//                     addOption(\n//                         'inherited',\n//                         () => rcvr.toggleInheritedVariable(this.blockSpec),\n//                         true,\n//                         'uncheck to\\ndisinherit',\n//                         null\n//                     );\n//                 } else { // not inherited\n//                     if (this.isInheritedVariable(true)) { // shadowed\n//                         addOption(\n//                             'inherited',\n//                             () => rcvr.toggleInheritedVariable(\n//                                 this.blockSpec\n//                             ),\n//                             false,\n//                             null,\n//                             localize('check to inherit\\nfrom')\n//                                 + ' ' + rcvr.exemplar.name\n//                         );\n//                     }\n//                     addOption(\n//                         'transient',\n//                         'toggleTransientVariable',\n//                         this.isTransientVariable(),\n//                         'uncheck to save contents\\nin the project',\n//                         'check to prevent contents\\nfrom being saved'\n//                     );\n//                     menu.addLine();\n//                     menu.addItem(\n//                         'rename...',\n//                         () => this.refactorThisVar(true), // just the template\n//                         'rename only\\nthis reporter'\n//                     );\n//                     menu.addItem(\n//                         'rename all...',\n//                         'refactorThisVar',\n//                         'rename all blocks that\\naccess this variable'\n//                     );\n//                 }\n//             } else if (this.selector !== 'evaluateCustomBlock') {\n//                 menu.addItem(\n//                     \"hide\",\n//                     'hidePrimitive'\n//                 );\n//             }\n//\n//             // allow toggling inheritable attributes\n//             if (StageMorph.prototype.enableInheritance) {\n//                 rcvr = this.scriptTarget();\n//                 field = {\n//                     xPosition: 'x position',\n//                     yPosition: 'y position',\n//                     direction: 'direction',\n//                     getScale: 'size',\n//                     getCostumeIdx: 'costume #',\n//                     getVolume: 'volume',\n//                     getPan: 'balance',\n//                     reportShown: 'shown?',\n//                     getPenDown: 'pen down?'\n//                 }[this.selector];\n//                 if (field && rcvr && rcvr.exemplar) {\n//                     menu.addLine();\n//                     addOption(\n//                         'inherited',\n//                         () => rcvr.toggleInheritanceForAttribute(field),\n//                         rcvr.inheritsAttribute(field),\n//                         'uncheck to\\ndisinherit',\n//                         localize('check to inherit\\nfrom')\n//                             + ' ' + rcvr.exemplar.name\n//                     );\n//                 }\n//             }\n//\n//             if (StageMorph.prototype.enableCodeMapping) {\n//                 menu.addLine();\n//                 menu.addItem(\n//                     'header mapping...',\n//                     'mapToHeader'\n//                 );\n//                 menu.addItem(\n//                     'code mapping...',\n//                     'mapToCode'\n//                 );\n//             }\n//         }\n//         return menu;\n//     }\n//     menu.addLine();\n//     if (this.selector === 'reportGetVar') {\n//         menu.addItem(\n//             'rename...',\n//             renameVar,\n//             'rename only\\nthis reporter'\n//         );\n//     } else if (SpriteMorph.prototype.blockAlternatives[this.selector]) {\n//         menu.addItem(\n//             'relabel...',\n//             () => this.relabel(\n//                 SpriteMorph.prototype.blockAlternatives[this.selector]\n//             )\n//         );\n//     } else if (this.isCustomBlock && this.alternatives) {\n//         alternatives = this.alternatives();\n//         if (alternatives.length > 0) {\n//             menu.addItem(\n//                 'relabel...',\n//                 () => this.relabel(alternatives)\n//             );\n//         }\n//     }\n//\n//     // direct relabelling:\n//     // - JIT-compile HOFs - experimental\n//     // - vector pen trails\n//     if (\n//         contains(\n//             ['reportMap', 'reportKeep', 'reportFindFirst', 'reportCombine'],\n//             this.selector\n//         )\n//     ) {\n//         alternatives = {\n//             reportMap : 'reportAtomicMap',\n//             reportKeep : 'reportAtomicKeep',\n//             reportFindFirst: 'reportAtomicFindFirst',\n//             reportCombine : 'reportAtomicCombine'\n//         };\n//         menu.addItem(\n//             'compile',\n//             () => this.setSelector(alternatives[this.selector]),\n//             'experimental!\\nmake this reporter fast and uninterruptable\\n' +\n//                 'CAUTION: Errors in the ring\\ncan break your Snap! session!'\n//         );\n//     } else if (\n//         contains(\n//             [\n//                 'reportAtomicMap',\n//                 'reportAtomicKeep',\n//                 'reportAtomicFindFirst',\n//                 'reportAtomicCombine'\n//             ],\n//             this.selector\n//         )\n//     ) {\n//         alternatives = {\n//             reportAtomicMap : 'reportMap',\n//             reportAtomicKeep : 'reportKeep',\n//             reportAtomicFindFirst: 'reportFindFirst',\n//             reportAtomicCombine : 'reportCombine'\n//         };\n//         menu.addItem(\n//             'uncompile',\n//             () => this.setSelector(alternatives[this.selector])\n//         );\n//     } else if (\n//         contains(\n//             ['reportPenTrailsAsCostume', 'reportPentrailsAsSVG'],\n//             this.selector\n//         )\n//     ) {\n//         alternatives = {\n//             reportPenTrailsAsCostume : 'reportPentrailsAsSVG',\n//             reportPentrailsAsSVG : 'reportPenTrailsAsCostume'\n//         };\n//         menu.addItem(\n//             localize(\n//                 SpriteMorph.prototype.blocks[\n//                     alternatives[this.selector]\n//                 ].spec\n//             ),\n//             () => {\n//                 this.setSelector(alternatives[this.selector]);\n//                 this.changed();\n//             }\n//         );\n//     }\n//\n//     menu.addItem(\n//         \"duplicate\",\n//         () => {\n//             var dup = this.fullCopy(),\n//                 ide = this.parentThatIsA(IDE_Morph),\n//                 blockEditor = this.parentThatIsA(BlockEditorMorph);\n//             dup.pickUp(world);\n//             // register the drop-origin, so the block can\n//             // slide back to its former situation if dropped\n//             // somewhere where it gets rejected\n//             if (!ide && blockEditor) {\n//                 ide = blockEditor.target.parentThatIsA(IDE_Morph);\n//             }\n//             if (ide) {\n//                 world.hand.grabOrigin = {\n//                     origin: ide.palette,\n//                     position: ide.palette.center()\n//                 };\n//             }\n//         },\n//         'make a copy\\nand pick it up'\n//     );\n//     if (this instanceof CommandBlockMorph && this.nextBlock()) {\n//         menu.addItem(\n//             (proc ? this.fullCopy() : this).thumbnail(0.5, 60),\n//             () => {\n//                 var cpy = this.fullCopy(),\n//                     nb = cpy.nextBlock(),\n//                     ide = this.parentThatIsA(IDE_Morph),\n//                     blockEditor = this.parentThatIsA(BlockEditorMorph);\n//                 if (nb) {nb.destroy(); }\n//                 cpy.pickUp(world);\n//                 if (!ide && blockEditor) {\n//                     ide = blockEditor.target.parentThatIsA(IDE_Morph);\n//                 }\n//                 if (ide) {\n//                     world.hand.grabOrigin = {\n//                         origin: ide.palette,\n//                         position: ide.palette.center()\n//                     };\n//                 }\n//             },\n//             'only duplicate this block'\n//         );\n//         menu.addItem(\n//             'extract',\n//             'userExtractJustThis',\n//             'only grab this block'\n//         );\n//     }\n//     menu.addItem(\n//         \"delete\",\n//         'userDestroy'\n//     );\n//     if (isNil(this.comment)) {\n//         menu.addItem(\n//             \"add comment\",\n//             () => {\n//                 var comment = new CommentMorph();\n//                 this.comment = comment;\n//                 comment.block = this;\n//                 comment.layoutChanged();\n//\n//                 // Simulate drag/drop for better undo/redo behavior\n//                 var scripts = this.parentThatIsA(ScriptsMorph),\n//                     ide = this.parentThatIsA(IDE_Morph),\n//                     blockEditor = this.parentThatIsA(BlockEditorMorph);\n//                 if (!ide && blockEditor) {\n//                     ide = blockEditor.target.parentThatIsA(IDE_Morph);\n//                 }\n//                 if (ide) {\n//                     world.hand.grabOrigin = {\n//                         origin: ide.palette,\n//                         position: ide.palette.center()\n//                     };\n//                 }\n//                 scripts.clearDropInfo();\n//                 scripts.lastDropTarget = { element: this };\n//                 scripts.lastDroppedBlock = comment;\n//                 scripts.recordDrop(world.hand.grabOrigin);\n//             }\n//         );\n//     }\n//     menu.addItem(\n//         \"script pic...\",\n//         () => {\n//             // Trace.log('Block.scriptPic', myself.blockId());\n//             var ide = this.parentThatIsA(IDE_Morph) ||\n//                 this.parentThatIsA(BlockEditorMorph).target.parentThatIsA(\n//                     IDE_Morph\n//             );\n//             ide.saveCanvasAs(\n//                 top.scriptPic(),\n//                 (ide.projectName || localize('untitled')) + ' ' +\n//                     localize('script pic')\n//             );\n//         },\n//         'save a picture\\nof this script'\n//     );\n//     if (top instanceof ReporterBlockMorph ||\n//         (!(top instanceof PrototypeHatBlockMorph) &&\n//             top.allChildren().some((any) => any.selector === 'doReport'))\n//     ) {\n//         menu.addItem(\n//             \"result pic...\",\n//             () => top.exportResultPic(),\n//             'save a picture of both\\nthis script and its result'\n//         );\n//     }\n//     if (shiftClicked) {\n//         menu.addItem(\n//             'download script',\n//             () => {\n//                 var ide = this.parentThatIsA(IDE_Morph),\n//                     blockEditor = this.parentThatIsA(BlockEditorMorph);\n//                 if (!ide && blockEditor) {\n//                     ide = blockEditor.target.parentThatIsA(IDE_Morph);\n//                 }\n//                 if (ide) {\n//                     ide.saveXMLAs(\n//                         ide.serializer.serialize(this),\n//                         this.selector + ' script',\n//                         false);\n//                 }\n//             },\n//             'download this script\\nas an XML file',\n//             new Color(100, 0, 0)\n//         );\n//     }\n//     if (proc) {\n//         if (vNames.length) {\n//             menu.addLine();\n//             vNames.forEach(vn =>\n//                 menu.addItem(\n//                     vn + '...',\n//                     () => proc.doShowVar(vn)\n//                 )\n//             );\n//         }\n//         proc.homeContext.variables.names().forEach(vn => {\n//             if (!contains(vNames, vn)) {\n//                 menu.addItem(\n//                     vn + '...',\n//                     () => proc.doShowVar(vn)\n//                 );\n//             }\n//         });\n//         return menu;\n//     }\n//     if (this.parent.parentThatIsA(RingMorph)) {\n//         menu.addLine();\n//         menu.addItem(\"unringify\", 'unringify');\n//         if (this instanceof ReporterBlockMorph ||\n//                 (!(top instanceof HatBlockMorph))) {\n//             menu.addItem(\"ringify\", 'ringify');\n//         }\n//         return menu;\n//     }\n//     if (contains(\n//         ['doBroadcast', 'doSend', 'doBroadcastAndWait', 'receiveMessage',\n//             'receiveOnClone', 'receiveGo'],\n//         this.selector\n//     )) {\n//         hasLine = true;\n//         menu.addLine();\n//         menu.addItem(\n//             (this.selector.indexOf('receive') === 0 ?\n//                 \"senders...\" : \"receivers...\"),\n//             'showMessageUsers'\n//         );\n//     }\n//     if (this.parent instanceof ReporterSlotMorph\n//             || (this.parent instanceof CommandSlotMorph)\n//             || (this instanceof HatBlockMorph)\n//             || (this instanceof CommandBlockMorph\n//                 && (top instanceof HatBlockMorph))) {\n//         return menu;\n//     }\n//     if (!hasLine) {menu.addLine(); }\n//     menu.addItem(\"ringify\", 'ringify');\n//     if (StageMorph.prototype.enableCodeMapping) {\n//         menu.addLine();\n//         menu.addItem(\n//             'header mapping...',\n//             'mapToHeader'\n//         );\n//         menu.addItem(\n//             'code mapping...',\n//             'mapToCode'\n//         );\n//     }\n//     return menu;\n// };\n\nBlockMorph.prototype.showMessageUsers = function () {\n    var ide = this.parentThatIsA(IDE_Morph) ||\n            this.parentThatIsA(BlockEditorMorph)\n                .target.parentThatIsA(IDE_Morph),\n        corral = ide.corral,\n        getter = (this.selector.indexOf('receive') === 0) ?\n            'allSendersOf' : 'allHatBlocksFor',\n        inputs = this.inputs(),\n        message, receiverName, knownSenders;\n\n    if (this.selector === 'receiveGo') {\n        message = '__shout__go__';\n    } else if (this.selector === 'receiveOnClone') {\n        message = '__clone__init__';\n    } else if (inputs[0] instanceof InputSlotMorph) {\n        message = inputs[0].evaluate();\n    }\n\n    if (((this.selector === 'doSend') && inputs[1] instanceof InputSlotMorph)) {\n        receiverName = this.inputs()[1].evaluate();\n    } else if (this.selector.indexOf('receive') === 0) {\n        receiverName = this.scriptTarget().name;\n    }\n\n    if (message !== '') {\n        if (getter === 'allSendersOf') {\n            knownSenders = ide.stage.globalBlocksSending(message, receiverName);\n        }\n        corral.frame.contents.children.concat(corral.stageIcon).forEach(\n            icon => {\n                if (icon.object &&\n                    ((this.selector !== 'doSend' ||\n                        receiverName === icon.object.name) &&\n                    (icon.object[getter](\n                        message,\n                        receiverName,\n                        knownSenders\n                    ).length > 0))\n                ) {\n                    icon.flash();\n                }\n            }\n        );\n    }\n};\n\nBlockMorph.prototype.isSending = function (message, receiverName, known = []) {\n    if (typeof message === 'number') {\n        message = message.toString();\n    }\n    return this.allChildren().some(morph => {\n        var event, eventReceiver;\n        if (morph.isCustomBlock &&\n                morph.isGlobal &&\n                    contains(known, morph.definition)\n        ) {\n            return true;\n        }\n        if ((morph.selector) &&\n                contains(\n                    ['doBroadcast', 'doBroadcastAndWait', 'doSend'],\n                    morph.selector)\n        ) {\n            event = morph.inputs()[0].evaluate();\n            if (morph.selector === 'doSend') {\n                eventReceiver = morph.inputs()[1].evaluate();\n            }\n            return ((morph.selector !== 'doSend') ||\n                    (receiverName === eventReceiver)) &&\n                ((event === message) ||\n                    (message instanceof Array &&\n                        message[0] === 'any message'));\n        }\n        return false;\n    });\n};\n\nBlockMorph.prototype.developersMenu = function () {\n    var menu = BlockMorph.uber.developersMenu.call(this);\n    menu.addLine();\n    menu.addItem(\"delete block\", 'deleteBlock');\n    menu.addItem(\n        \"spec...\",\n        () => new DialogBoxMorph(\n            this,\n            this.userSetSpec,\n            this\n        ).prompt(\n            menu.title + '\\nspec',\n            this.blockSpec,\n            this.world()\n        )\n    );\n    return menu;\n};\n\nBlockMorph.prototype.hidePrimitive = function () {\n    var ide = this.parentThatIsA(IDE_Morph),\n        dict,\n        cat;\n    if (!ide) {return; }\n    // Trace.log('Block.hidePrimitive', this.blockId());\n    StageMorph.prototype.hiddenPrimitives[this.selector] = true;\n    dict = {\n        doWarp: 'control',\n        reifyScript: 'operators',\n        reifyReporter: 'operators',\n        reifyPredicate: 'operators',\n        doDeclareVariables: 'variables'\n    };\n    cat = dict[this.selector] || this.category;\n    if (cat === 'lists') {cat = 'variables'; }\n    ide.flushBlocksCache(cat);\n    ide.refreshPalette();\n};\n\nBlockMorph.prototype.isInheritedVariable = function (shadowedOnly) {\n    // private - only for variable getter template inside the palette\n    if (this.isTemplate &&\n            (this.selector === 'reportGetVar') &&\n            (this.parent instanceof FrameMorph)) {\n        return contains(\n            this.scriptTarget().inheritedVariableNames(shadowedOnly),\n            this.blockSpec\n        );\n    }\n    return false;\n};\n\nBlockMorph.prototype.isTransientVariable = function () {\n    // private - only for variable getter template inside the palette\n    var varFrame = this.scriptTarget().variables.silentFind(this.blockSpec);\n    return varFrame ? varFrame.vars[this.blockSpec].isTransient : false;\n};\n\nBlockMorph.prototype.toggleTransientVariable = function () {\n    // private - only for variable getter template inside the palette\n    var varFrame = this.scriptTarget().variables.silentFind(this.blockSpec);\n    if (!varFrame) {return; }\n    varFrame.vars[this.blockSpec].isTransient =\n        !(varFrame.vars[this.blockSpec].isTransient);\n    // Trace.log('Block.toggleTransientVariable',\n    //     varFrame.vars[this.blockSpec].isTransient);\n};\n\nBlockMorph.prototype.deleteBlock = function () {\n    // delete just this one block, keep inputs and next block around\n    var scripts = this.parentThatIsA(ScriptsMorph),\n        nb = this.nextBlock ? this.nextBlock() : null,\n        tobefixed,\n        isindef;\n    if (scripts) {\n        if (nb) {\n            scripts.add(nb);\n        }\n        this.inputs().forEach(inp => {\n            if (inp instanceof BlockMorph) {\n                scripts.add(inp);\n            }\n        });\n    }\n    if (this instanceof ReporterBlockMorph &&\n\t\t\t((this.parent instanceof BlockMorph)\n            \t|| (this.parent instanceof MultiArgMorph)\n            \t|| (this.parent instanceof ReporterSlotMorph))) {\n        this.parent.revertToDefaultInput(this);\n    } else { // CommandBlockMorph\n        if (this.parent && this.parent.fixLayout) {\n            tobefixed = this.parentThatIsA(ArgMorph);\n        } else { // must be in a custom block definition\n            isindef = true;\n        }\n    }\n    this.destroy();\n    if (isindef) {\n        /*\n            since the definition's body still points to this block\n            even after it has been destroyed, mark it to be deleted\n            later.\n        */\n        this.isCorpse = true;\n    }\n    if (tobefixed) {\n        tobefixed.fixLayout();\n    }\n};\n\nBlockMorph.prototype.ringify = function () {\n    // Trace.log('Block.ringify', this.blockId());\n    // wrap a Ring around me\n    var ring, top, center,\n        target = this.selectForEdit(); // copy-on-edit\n    if (target !== this) {\n        return this.ringify.call(target);\n    }\n    ring = new RingMorph();\n    top = this.topBlock();\n    center = top.fullBounds().center();\n    if (this.parent === null) {return null; }\n    top.fullChanged();\n    if (this.parent instanceof SyntaxElementMorph) {\n        if (this instanceof ReporterBlockMorph) {\n            this.parent.replaceInput(this, ring, true); // don't vanish\n            ring.embed(this, null, true); // don't vanish\n        } else if (top) { // command\n            if (top instanceof HatBlockMorph) {\n                return;\n            }\n            top.parent.add(ring);\n            ring.embed(top);\n            ring.setCenter(center);\n        }\n    } else {\n        this.parent.add(ring);\n        ring.embed(this);\n        ring.setCenter(center);\n    }\n    this.fixBlockColor(null, true);\n    top.fullChanged();\n};\n\nBlockMorph.prototype.unringify = function () {\n    // Trace.log('Block.unringify', this.blockId());\n    // remove a Ring around me, if any\n    var ring, top, center, scripts, block,\n        target = this.selectForEdit(); // copy-on-edit\n    if (target !== this) {\n        return this.unringify.call(target);\n    }\n    ring = this.parent.parentThatIsA(RingMorph);\n    top = this.topBlock();\n    scripts = this.parentThatIsA(ScriptsMorph);\n    if (ring === null) {return null; }\n    block = ring.contents();\n    center = ring.center();\n\n    top.fullChanged();\n    if (ring.parent instanceof SyntaxElementMorph) {\n        if (block instanceof ReporterBlockMorph) {\n            ring.parent.replaceInput(ring, block);\n        } else if (scripts) {\n            scripts.add(block);\n            block.setFullCenter(center);\n            block.moveBy(20);\n            ring.parent.revertToDefaultInput(ring);\n        }\n    } else {\n        ring.parent.add(block);\n        block.setFullCenter(center);\n        ring.destroy();\n    }\n    this.fixBlockColor(null, true);\n    top.fullChanged();\n};\n\nBlockMorph.prototype.relabel = function (alternativeSelectors) {\n    // morph one block into another trying to keep the inputs in place\n    // alternative Selector can either be a string representing\n    // a block selector or a 2-item array containing a string and\n    // an integer offset for restoring inputs\n    var menu, oldInputs,\n        target = this.selectForEdit(); // copy-on-edit\n    if (target !== this) {\n        return this.relabel.call(target, alternativeSelectors);\n    }\n    menu = new MenuMorph(this);\n    oldInputs = this.inputs();\n    alternativeSelectors.forEach(alternative => {\n        var block, selector, offset;\n        if (alternative instanceof Array) {\n            selector = alternative[0];\n            offset = -alternative[1];\n        } else {\n            selector = alternative;\n            offset = 0;\n        }\n        block = SpriteMorph.prototype.blockForSelector(selector, true);\n        block.restoreInputs(oldInputs, offset);\n        block.fixBlockColor(null, true);\n        block.addShadow(new Point(3, 3));\n        menu.addItem(\n            block.doWithAlpha(1, () => block.fullImage()),\n            () => {\n                this.setSelector(selector, -offset)\n                // Trace.log('Block.relabel', {\n                //     'id': this.blockId(),\n                //     'selector': sel,\n                // });\n            }\n        );\n    });\n    menu.popup(this.world(), this.bottomLeft().subtract(new Point(\n        8,\n        this instanceof CommandBlockMorph ? this.corner : 0\n    )));\n};\n\n\nBlockMorph.prototype.setSelector = function (aSelector, inputOffset = 0) {\n    // private - used only for relabel()\n    // input offset is optional and can be used to shift the inputs\n    // to be restored\n    var oldInputs = this.inputs(),\n        scripts = this.parentThatIsA(ScriptsMorph),\n        surplus,\n        info,\n        slots,\n        i;\n    info = SpriteMorph.prototype.blocks[aSelector];\n    this.setCategory(info.category);\n    this.selector = aSelector;\n    this.setSpec(localize(info.spec));\n    this.defaults = info.defaults || [];\n\n    // restore default values\n    slots = this.inputs();\n    if (slots[0] instanceof MultiArgMorph) {\n        slots[0].setContents(this.defaults);\n        slots[0].defaults = this.defaults;\n    } else {\n        for (i = 0; i < this.defaults.length; i += 1) {\n            if (this.defaults[i] !== null && slots[i].setContents) {\n                slots[i].setContents(this.defaults[i]);\n            }\n        }\n    }\n\n    // restore previous inputs\n    surplus = this.restoreInputs(oldInputs, -inputOffset);\n    this.fixLabelColor();\n\n    // place surplus blocks on scipts\n    if (scripts && surplus.length) {\n        surplus.forEach(blk => {\n            blk.moveBy(10);\n            scripts.add(blk);\n        });\n    }\n};\n\nBlockMorph.prototype.restoreInputs = function (oldInputs, offset = 0) {\n    // private - used only for relabel()\n    // try to restore my previous inputs when my spec has been changed\n    // return an Array of left-over blocks, if any\n    // optional offset parameter allows for shifting the range\n    // of inputs to be restored\n    var old, nb, i,\n        leftOver = [];\n\n    // When relabeling, copied blocks in inputs should keep their IDs\n    BlockMorph.copyIDs = true;\n\n    // gather leading surplus blocks\n    for (i = 0; i < offset; i += 1) {\n        old = oldInputs[i];\n        if (old instanceof ReporterBlockMorph) {\n            leftOver.push(old);\n        } else if (old instanceof CommandSlotMorph) {\n            nb = old.nestedBlock();\n            if (nb) {\n                leftOver.push(nb);\n            }\n        }\n    }\n\n    // restore matching inputs in their original order\n    this.inputs().forEach(inp => {\n        old = oldInputs[offset];\n        if (old instanceof RingMorph) {\n            if (old.contents()) {\n                this.replaceInput(inp, old.fullCopy());\n            }\n            // otherwise ignore the empty ring\n        } else if (old instanceof ReporterBlockMorph) {\n            if (inp instanceof TemplateSlotMorph || inp.isStatic) {\n                leftOver.push(old);\n            } else {\n                this.replaceInput(inp, old.fullCopy());\n            }\n        } else if (old && inp instanceof InputSlotMorph) {\n            // original - turns empty numberslots to 0:\n            // inp.setContents(old.evaluate());\n            // \"fix\" may be wrong b/c constants\n            if (old.contents) {\n                inp.setContents(old.contents().text);\n                if (old.constant) {\n                    inp.constant = old.constant;\n                }\n            }\n        } else if (old instanceof CSlotMorph && inp instanceof CSlotMorph) {\n            nb = old.nestedBlock();\n            if (nb) {\n                inp.nestedBlock(nb.fullCopy());\n            }\n        }\n        offset += 1;\n    });\n\n    // gather trailing surplus blocks\n    for (offset; offset < oldInputs.length; offset += 1) {\n        old = oldInputs[offset];\n        if (old instanceof ReporterBlockMorph) {\n            leftOver.push(old);\n        } else if (old instanceof CommandSlotMorph) {\n            nb = old.nestedBlock();\n            if (nb) {\n                leftOver.push(nb);\n            }\n        }\n    }\n    this.cachedInputs = null;\n    // Make sure to set copyIDs back to false when finished\n    BlockMorph.copyIDs = false;\n    return leftOver;\n};\n\nBlockMorph.prototype.showHelp = function () {\n    // Trace.log('Block.showHelp',\n        // Since some buttons duplicate the showHelp function, we can show their\n        // selector in lieu of a full blockID (so they all have a selector)\n        // (this.blockId ? this.blockId() : null) || {\n        //     selector: this.selector,\n        // });\n    var myself = this,\n        ide = this.parentThatIsA(IDE_Morph),\n        blockEditor,\n        pic = new Image(),\n        help,\n        def,\n        comment,\n        block,\n        spec,\n        ctx;\n\n    if (this.isCustomBlock) {\n        if (this.isGlobal) {\n            spec = this.definition.helpSpec();\n        } else {\n            spec = this.scriptTarget().getMethod(this.blockSpec).helpSpec();\n        }\n    } else {\n        spec = this.selector;\n    }\n\n    if (!ide) {\n        blockEditor = this.parentThatIsA(BlockEditorMorph);\n        if (blockEditor) {\n            ide = blockEditor.target.parentThatIsA(IDE_Morph);\n        }\n    }\n\n    pic.onload = function () {\n        help = newCanvas(new Point(pic.width, pic.height), true); // nonRetina\n        ctx = help.getContext('2d');\n        ctx.drawImage(pic, 0, 0);\n        new DialogBoxMorph().inform(\n            'Help',\n            null,\n            myself.world(),\n            help\n        );\n    };\n\n    if (this.isCustomBlock) {\n        def = this.isGlobal ? this.definition\n                : this.scriptTarget().getMethod(this.blockSpec);\n        comment = def.comment;\n        if (comment) {\n            block = def.blockInstance();\n            block.refreshDefaults(def);\n            comment = comment.fullCopy();\n            comment.contents.parse();\n            help = '';\n            comment.contents.lines.forEach(line =>\n                help = help + '\\n' + line\n            );\n            new DialogBoxMorph().inform(\n                'Help',\n                help.substr(1),\n                myself.world(),\n                block.doWithAlpha(\n                    1,\n                    () => {\n                        block.addShadow();\n                        return block.fullImage();\n                    }\n                )\n            );\n            return;\n        }\n    }\n    pic.src = ide.resourceURL('help', spec + '.png');\n};\n\n// BlockMorph exporting picture with result bubble\n\nBlockMorph.prototype.exportResultPic = function () {\n    var top = this.topBlock(),\n        receiver = top.scriptTarget(),\n        stage;\n    if (top !== this) {return; }\n    if (receiver) {\n        stage = receiver.parentThatIsA(StageMorph);\n        if (stage) {\n            stage.threads.stopProcess(top);\n            stage.threads.startProcess(top, receiver, false, true);\n        }\n    }\n    pic.src = ide.resourceURL('help', spec + '.png');\n};\n\n// BlockMorph code mapping\n\n/*\n    code mapping lets you use blocks to generate arbitrary text-based\n    source code that can be exported and compiled / embedded elsewhere,\n    it's not part of Snap's evaluator and not needed for Snap itself\n*/\n\nBlockMorph.prototype.mapToHeader = function () {\n    // open a dialog box letting the user map header code via the GUI\n    var key = this.selector.substr(0, 5) === 'reify' ?\n            'reify' : this.selector,\n        block = this.codeDefinitionHeader(),\n        help,\n        pic;\n    block.addShadow(new Point(3, 3));\n    pic = block.doWithAlpha(1, () => block.fullImage());\n    if (this.isCustomBlock) {\n        help = 'Enter code that corresponds to the block\\'s definition. ' +\n            'Use the formal parameter\\nnames as shown and <body> to ' +\n            'reference the definition body\\'s generated text code.';\n    } else {\n        help = 'Enter code that corresponds to the block\\'s definition. ' +\n            'Choose your own\\nformal parameter names (ignoring the ones ' +\n            'shown).';\n    }\n    new DialogBoxMorph(\n        this,\n        code => {\n            if (key === 'evaluateCustomBlock') {\n                this.definition.codeHeader = code;\n            } else {\n                StageMorph.prototype.codeHeaders[key] = code;\n            }\n        },\n        this\n    ).promptCode(\n        'Header mapping',\n        key === 'evaluateCustomBlock' ? this.definition.codeHeader || ''\n                 : StageMorph.prototype.codeHeaders[key] || '',\n        this.world(),\n        pic,\n        help\n    );\n};\n\nBlockMorph.prototype.mapToCode = function () {\n    // open a dialog box letting the user map code via the GUI\n    var key = this.selector.substr(0, 5) === 'reify' ?\n            'reify' : this.selector,\n        block = this.codeMappingHeader(),\n        pic;\n    block.addShadow(new Point(3, 3));\n    pic = block.doWithAlpha(1, () => block.fullImage());\n    new DialogBoxMorph(\n        this,\n        code => {\n            if (key === 'evaluateCustomBlock') {\n                this.definition.codeMapping = code;\n            } else {\n                StageMorph.prototype.codeMappings[key] = code;\n            }\n        },\n        this\n    ).promptCode(\n        'Code mapping',\n        key === 'evaluateCustomBlock' ? this.definition.codeMapping || ''\n                 : StageMorph.prototype.codeMappings[key] || '',\n        this.world(),\n        pic,\n        'Enter code that corresponds to the block\\'s operation ' +\n            '(usually a single\\nfunction invocation). Use <#n> to ' +\n            'reference actual arguments as shown.'\n    );\n};\n\nBlockMorph.prototype.mapHeader = function (aString, key) {\n    // primitive for programatically mapping header code\n    var sel = key || this.selector.substr(0, 5) === 'reify' ?\n            'reify' : this.selector;\n    if (aString) {\n        if (this.isCustomBlock) {\n            this.definition.codeHeader = aString;\n        } else {\n            StageMorph.prototype.codeHeaders[sel] = aString;\n        }\n    }\n};\n\nBlockMorph.prototype.mapCode = function (aString, key) {\n    // primitive for programatically mapping code\n    var sel = key || this.selector.substr(0, 5) === 'reify' ?\n            'reify' : this.selector;\n    if (aString) {\n        if (this.isCustomBlock) {\n            this.definition.codeMapping = aString;\n        } else {\n            StageMorph.prototype.codeMappings[sel] = aString;\n        }\n    }\n};\n\nBlockMorph.prototype.mappedCode = function (definitions) {\n    var key = this.selector.substr(0, 5) === 'reify' ?\n            'reify' : this.selector,\n        code,\n        codeLines,\n        count = 1,\n        header,\n        headers,\n        headerLines,\n        body,\n        bodyLines,\n        defKey = this.isCustomBlock ? this.definition.spec : key,\n        defs = definitions || {},\n        parts = [];\n    code = key === 'reportGetVar' ? this.blockSpec\n            : this.isCustomBlock ? this.definition.codeMapping || ''\n                    : StageMorph.prototype.codeMappings[key] || '';\n\n    // map header\n    if (key !== 'reportGetVar' && !defs.hasOwnProperty(defKey)) {\n        defs[defKey] = null; // create the property for recursive definitions\n        if (this.isCustomBlock) {\n            header = this.definition.codeHeader || '';\n            if (header.indexOf('<body') !== -1) { // replace with def mapping\n                body = '';\n                if (this.definition.body) {\n                    body = this.definition.body.expression.mappedCode(defs);\n                }\n                bodyLines = body.split('\\n');\n                headerLines = header.split('\\n');\n                headerLines.forEach((headerLine, idx) => {\n                    var prefix = '',\n                        indent;\n                    if (headerLine.trimLeft().indexOf('<body') === 0) {\n                        indent = headerLine.indexOf('<body');\n                        prefix = headerLine.slice(0, indent);\n                    }\n                    headerLines[idx] = headerLine.replace(\n                        new RegExp('<body>'),\n                        bodyLines.join('\\n' + prefix)\n                    );\n                    headerLines[idx] = headerLines[idx].replace(\n                        new RegExp('<body>', 'g'),\n                        bodyLines.join('\\n')\n                    );\n                });\n                header = headerLines.join('\\n');\n            }\n            defs[defKey] = header;\n        } else {\n            defs[defKey] = StageMorph.prototype.codeHeaders[defKey];\n        }\n    }\n\n    codeLines = code.split('\\n');\n    this.inputs().forEach(input =>\n        parts.push(input.mappedCode(defs).toString())\n    );\n    parts.forEach(part => {\n        var partLines = part.split('\\n'),\n            placeHolder = '<#' + count + '>',\n            rx = new RegExp(placeHolder, 'g');\n        codeLines.forEach((codeLine, idx) => {\n            var prefix = '',\n                indent;\n            if (codeLine.trimLeft().indexOf(placeHolder) === 0) {\n                indent = codeLine.indexOf(placeHolder);\n                prefix = codeLine.slice(0, indent);\n            }\n            codeLines[idx] = codeLine.replace(\n                new RegExp(placeHolder),\n                partLines.join('\\n' + prefix)\n            );\n            codeLines[idx] = codeLines[idx].replace(rx, partLines.join('\\n'));\n        });\n        count += 1;\n    });\n    code = codeLines.join('\\n');\n    if (this.nextBlock && this.nextBlock()) { // Command\n        code += ('\\n' + this.nextBlock().mappedCode(defs));\n    }\n    if (!definitions) { // top-level, add headers\n        headers = [];\n        Object.keys(defs).forEach(each => {\n            if (defs[each]) {\n                headers.push(defs[each]);\n            }\n        });\n        if (headers.length) {\n            return headers.join('\\n\\n')\n                + '\\n\\n'\n                + code;\n        }\n    }\n    return code;\n};\n\n// BlockMorph.prototype.codeDefinitionHeader = function () {\n//     var block = this.isCustomBlock ? new PrototypeHatBlockMorph(this.definition)\n//             : SpriteMorph.prototype.blockForSelector(this.selector),\n//         hat = new HatBlockMorph(),\n//         count = 1;\n//\n//     if (this.isCustomBlock) {return block; }\n//     block.inputs().forEach(input => {\n//         var part = new TemplateSlotMorph('#' + count);\n//         block.replaceInput(input, part);\n//         count += 1;\n//     });\n//     block.isPrototype = true;\n//     hat.setCategory(\"control\");\n//     hat.setSpec('%s');\n//     hat.replaceInput(hat.inputs()[0], block);\n//     if (this.category === 'control') {\n//         hat.alternateBlockColor();\n//     }\n//     return hat;\n// };\n\nBlockMorph.prototype.codeMappingHeader = function () {\n    var block = this.isCustomBlock ? this.definition.blockInstance()\n            : SpriteMorph.prototype.blockForSelector(this.selector),\n        hat = new HatBlockMorph(),\n        count = 1;\n\n    block.inputs().forEach(input => {\n        var part = new TemplateSlotMorph('<#' + count + '>');\n        block.replaceInput(input, part);\n        count += 1;\n    });\n    block.isPrototype = true;\n    hat.setCategory(\"control\");\n    hat.setSpec('%s');\n    hat.replaceInput(hat.inputs()[0], block);\n    if (this.category === 'control') {\n        hat.alternateBlockColor();\n    }\n    return hat;\n};\n\n// Variable refactoring\n\nBlockMorph.prototype.refactorThisVar = function (justTheTemplate) {\n    // Rename all occurrences of the variable this block is holding,\n    // taking care of its lexical scope\n\n    var receiver = this.scriptTarget(),\n        myself = this,\n        oldName = this.instantiationSpec || this.blockSpec,\n        cpy = this.fullCopy();\n\n    cpy.addShadow();\n\n    new DialogBoxMorph(this, renameVarTo, this).prompt(\n        'Variable name',\n        oldName,\n        this.world(),\n        cpy.doWithAlpha(1, () => cpy.fullImage()), // pic\n        InputSlotMorph.prototype.getVarNamesDict.call(this)\n    );\n\n    function renameVarTo (newName) {\n        // Trace.log('Block.refactorVar', {\n        //     'id': myself.blockId(),\n        //     'oldName': oldName,\n        //     'newName': newName,\n        // });\n        if (this.parent instanceof SyntaxElementMorph) {\n            if (this.parentThatIsA(BlockEditorMorph)) {\n                this.doRefactorBlockParameter(\n                    oldName,\n                    newName,\n                    justTheTemplate\n                );\n            } else if (this.parentThatIsA(RingMorph)) {\n                this.doRefactorRingParameter(oldName, newName, justTheTemplate);\n            } else {\n                this.doRefactorScriptVar(oldName, newName, justTheTemplate);\n            }\n        } else if (receiver.hasSpriteVariable(oldName)) {\n            this.doRefactorSpriteVar(oldName, newName, justTheTemplate);\n        } else {\n            this.doRefactorGlobalVar(oldName, newName, justTheTemplate);\n        }\n    }\n};\n\nBlockMorph.prototype.varExistsError = function (ide, where) {\n    // Trace.log('Block.refactorVarError', {\n    //     'id': this.blockId(),\n    //     'where': where,\n    // });\n    ide.inform(\n        'Variable exists',\n        'A variable with this name already exists ' +\n        (where || 'in this context') + '.'\n    );\n};\n\nBlockMorph.prototype.doRefactorBlockParameter = function (\n    oldName,\n    newName,\n    justTheTemplate\n) {\n    var fragMorph = this.parentThatIsA(BlockInputFragmentMorph),\n        fragment = fragMorph.fragment.copy(),\n        definer = fragMorph.parent,\n        editor = this.parentThatIsA(BlockEditorMorph),\n        scripts = editor.body.contents;\n\n    if (definer.anyChild(any =>\n            any.blockSpec === newName\n    )) {\n        this.varExistsError(editor.target.parentThatIsA(IDE_Morph));\n        return;\n    }\n\n    fragment.labelString = newName;\n    fragMorph.updateBlockLabel(fragment);\n\n    if (justTheTemplate) {\n        return;\n    }\n\n    scripts.children.forEach(script =>\n        script.refactorVarInStack(oldName, newName)\n    );\n};\n\nBlockMorph.prototype.doRefactorRingParameter = function (\n    oldName,\n    newName,\n    justTheTemplate\n) {\n    var ring = this.parentThatIsA(RingMorph),\n        script = ring.contents(),\n        tb = this.topBlock();\n\n    if (contains(ring.inputNames(), newName)) {\n        this.varExistsError(this.parentThatIsA(IDE_Morph));\n        return;\n    }\n\n    tb.fullChanged();\n    this.setSpec(newName);\n\n    if (justTheTemplate) {\n        tb.fullChanged();\n        return;\n    }\n\n    if (script) {\n        script.refactorVarInStack(oldName, newName);\n    }\n\n    tb.fullChanged();\n};\n\nBlockMorph.prototype.doRefactorScriptVar = function (\n    oldName,\n    newName,\n    justTheTemplate\n) {\n    var definer = this.parentThatIsA(CommandBlockMorph),\n        receiver, ide;\n\n    if (definer.definesScriptVariable(newName)) {\n        receiver = this.scriptTarget();\n        ide = receiver.parentThatIsA(IDE_Morph);\n        this.varExistsError(ide);\n        return;\n    }\n\n    this.userSetSpec(newName);\n\n    if (justTheTemplate) {\n        return;\n    }\n\n    definer.refactorVarInStack(oldName, newName, true);\n};\n\nBlockMorph.prototype.doRefactorSpriteVar = function (\n    oldName,\n    newName,\n    justTheTemplate\n) {\n    var receiver = this.scriptTarget(),\n        ide = receiver.parentThatIsA(IDE_Morph),\n        oldWatcher = receiver.findVariableWatcher(oldName),\n        oldValue, newWatcher;\n\n    if (receiver.hasSpriteVariable(newName)) {\n        this.varExistsError(ide);\n        return;\n    } else if (!isNil(ide.globalVariables.vars[newName])) {\n        this.varExistsError(ide, 'as a global variable');\n        return;\n    } else {\n        oldValue = receiver.variables.getVar(oldName);\n        receiver.deleteVariable(oldName);\n        receiver.addVariable(newName, false);\n        receiver.variables.setVar(newName, oldValue);\n\n        if (oldWatcher && oldWatcher.isVisible) {\n            newWatcher = receiver.toggleVariableWatcher(\n                newName,\n                false\n            );\n            newWatcher.setPosition(oldWatcher.position());\n        }\n\n        if (!justTheTemplate) {\n            receiver.refactorVariableInstances(\n                oldName,\n                newName,\n                false\n            );\n            receiver.customBlocks.forEach(eachBlock =>\n                eachBlock.body.expression.refactorVarInStack(\n                    oldName,\n                    newName\n                )\n            );\n        }\n    }\n\n    ide.flushBlocksCache('variables');\n    ide.refreshPalette();\n};\n\nBlockMorph.prototype.doRefactorGlobalVar = function (\n    oldName,\n    newName,\n    justTheTemplate\n) {\n    var receiver = this.scriptTarget(),\n        ide = receiver.parentThatIsA(IDE_Morph),\n        stage = ide ? ide.stage : null,\n        oldWatcher = receiver.findVariableWatcher(oldName),\n        oldValue, newWatcher;\n\n    if (!isNil(ide.globalVariables.vars[newName])) {\n        this.varExistsError(ide);\n        return;\n    } else if (detect(\n        stage.children,\n        any => any instanceof SpriteMorph &&\n            any.hasSpriteVariable(newName)\n    )) {\n        this.varExistsError(ide, 'as a sprite local variable');\n        return;\n    } else {\n        oldValue = ide.globalVariables.getVar(oldName);\n        stage.deleteVariable(oldName);\n        stage.addVariable(newName, true);\n        ide.globalVariables.setVar(newName, oldValue);\n\n        if (oldWatcher && oldWatcher.isVisible) {\n            newWatcher = receiver.toggleVariableWatcher(\n                    newName,\n                    true\n                    );\n            newWatcher.setPosition(oldWatcher.position());\n        }\n\n        if (!justTheTemplate) {\n            stage.refactorVariableInstances(\n                oldName,\n                newName,\n                true\n            );\n            stage.globalBlocks.forEach(eachBlock => {\n                if (eachBlock.body) {\n                    eachBlock.body.expression.refactorVarInStack(\n                        oldName,\n                        newName\n                    );\n                }\n            });\n            stage.forAllChildren(child => {\n                if (child instanceof SpriteMorph) {\n                    child.refactorVariableInstances(\n                        oldName,\n                        newName,\n                        true\n                    );\n                    child.customBlocks.forEach(eachBlock =>\n                        eachBlock.body.expression.refactorVarInStack(\n                            oldName,\n                            newName\n                        )\n                    );\n                }\n            });\n        }\n    }\n\n    ide.flushBlocksCache('variables');\n    ide.refreshPalette();\n};\n\n// BlockMorph thumbnail and script pic\n\nBlockMorph.prototype.thumbnail = function (scale, clipWidth) {\n    var nb = this.nextBlock(),\n        fadeout = 12,\n        ext,\n        trgt,\n        ctx,\n        gradient;\n\n    if (nb) {nb.isVisible = false; }\n    ext = this.fullBounds().extent();\n    trgt = newCanvas(new Point(\n        clipWidth ? Math.min(ext.x * scale, clipWidth) : ext.x * scale,\n        ext.y * scale\n    ));\n    ctx = trgt.getContext('2d');\n    ctx.scale(scale, scale);\n    ctx.drawImage(this.fullImage(), 0, 0);\n    // draw fade-out\n    if (clipWidth && ext.x * scale > clipWidth) {\n        gradient = ctx.createLinearGradient(\n            trgt.width / scale - fadeout,\n            0,\n            trgt.width / scale,\n            0\n        );\n        gradient.addColorStop(0, 'transparent');\n        gradient.addColorStop(1, 'black');\n        ctx.globalCompositeOperation = 'destination-out';\n        ctx.fillStyle = gradient;\n        ctx.fillRect(\n            trgt.width / scale - fadeout,\n            0,\n            trgt.width / scale,\n            trgt.height / scale\n        );\n    }\n    if (nb) {nb.isVisible = true; }\n    return trgt;\n};\n\nBlockMorph.prototype.scriptPic = function () {\n    // answer a canvas image that also includes comments\n    var scr = this.fullImage(),\n        fb = this.stackFullBounds(),\n        pic = newCanvas(fb.extent()),\n        ctx = pic.getContext('2d');\n\n    this.allComments().forEach(comment =>\n        ctx.drawImage(\n            comment.fullImage(),\n            comment.fullBounds().left() - fb.left(),\n            comment.top() - fb.top()\n        )\n    );\n    ctx.drawImage(scr, 0, 0);\n    return pic;\n};\n\nBlockMorph.prototype.fullImage = function () {\n    // answer a canvas image meant for (semi-) transparent blocks\n    // that lets the background shine through\n    var src, solid, pic, ctx;\n\n    if (this.alpha === 1) {\n        return BlockMorph.uber.fullImage.call(this);\n    }\n    this.forAllChildren(m => {\n        if (m instanceof BlockMorph) {\n            m.mouseLeaveBounds();\n        }\n    });\n    src = BlockMorph.uber.fullImage.call(this);\n    solid = this.doWithAlpha(1, () => BlockMorph.uber.fullImage.call(this));\n    pic = newCanvas(this.fullBounds().extent());\n    ctx = pic.getContext('2d');\n    ctx.fillStyle = ScriptsMorph.prototype.getRenderColor().toString();\n    ctx.fillRect(0, 0, pic.width, pic.height);\n    ctx.globalCompositeOperation = 'destination-in';\n    ctx.drawImage(solid, 0, 0);\n    ctx.globalCompositeOperation = 'source-over';\n    ctx.drawImage(src, 0, 0);\n    return pic;\n};\n\nBlockMorph.prototype.clearAlpha = function () {\n    this.forAllChildren(m => {\n        if (m instanceof BlockMorph) {\n            delete m.alpha;\n        }\n    });\n};\n\n// BlockMorph drawing\n\nBlockMorph.prototype.render = function (ctx) {\n    this.cachedClr = this.color.toString();\n    this.cachedClrBright = this.bright();\n    this.cachedClrDark = this.dark();\n\n    if (MorphicPreferences.isFlat) {\n        // draw the outline\n        ctx.fillStyle = this.cachedClrDark;\n        ctx.beginPath();\n        this.outlinePath(ctx, 0);\n        ctx.closePath();\n        ctx.fill();\n\n        // draw the inner filled shaped\n        ctx.fillStyle = this.cachedClr;\n        ctx.beginPath();\n        this.outlinePath(ctx, this.flatEdge);\n        ctx.closePath();\n        ctx.fill();\n    } else {\n        // draw the flat shape\n        ctx.fillStyle = this.cachedClr;\n        ctx.beginPath();\n        this.outlinePath(ctx, 0);\n        ctx.closePath();\n        ctx.fill();\n\n        // add 3D-Effect:\n        this.drawEdges(ctx);\n    }\n\n    // draw location pin icon if applicable\n    if (this.hasLocationPin()) {\n        this.drawMethodIcon(ctx);\n    }\n};\n\nBlockMorph.prototype.drawMethodIcon = function (ctx) {\n    var ext = this.methodIconExtent(),\n        w = ext.x,\n        h = ext.y,\n        r = w / 2,\n        x = this.edge + this.labelPadding,\n        y = this.edge,\n        isNormal =\n            this.color === SpriteMorph.prototype.blockColor[this.category];\n\n    if (this.isPredicate) {\n        x = this.rounding;\n    }\n    if (this instanceof CommandBlockMorph) {\n        y += this.corner;\n    }\n    ctx.fillStyle = isNormal ? this.cachedClrBright : this.cachedClrDark;\n\n    // pin\n    ctx.beginPath();\n    ctx.arc(x + r, y + r, r, radians(-210), radians(30), false);\n    ctx.lineTo(x + r, y + h);\n    ctx.closePath();\n    ctx.fill();\n\n    // hole\n    ctx.fillStyle = this.cachedClr;\n    ctx.beginPath();\n    ctx.arc(x + r, y + r, r * 0.4, radians(0), radians(360), false);\n    ctx.closePath();\n    ctx.fill();\n};\n\nBlockMorph.prototype.cSlots = function () {\n    var result = [];\n    this.parts().forEach(part => {\n        if (part instanceof CSlotMorph) {\n            result.push(part);\n        } else if (part instanceof MultiArgMorph) {\n            part.parts().forEach(slot => {\n                if (slot instanceof CSlotMorph) {\n                    result.push(slot);\n                }\n            });\n        }\n    });\n    return result;\n};\n\nBlockMorph.prototype.hasLocationPin = function () {\n\treturn (this.isCustomBlock && !this.isGlobal) || this.isLocalVarTemplate;\n};\n\n// BlockMorph highlighting\n\nBlockMorph.prototype.addHighlight = function (oldHighlight) {\n    var isHidden = !this.isVisible,\n        highlight;\n\n    if (isHidden) {this.show(); }\n    if (SyntaxElementMorph.prototype.alpha < 1) {\n        this.clearAlpha();\n    }\n    highlight = this.highlight(\n        oldHighlight ? oldHighlight.color : this.activeHighlight,\n        this.activeBlur,\n        this.activeBorder\n    );\n    this.addBack(highlight);\n    this.fullChanged();\n    if (isHidden) {this.hide(); }\n    return highlight;\n};\n\nBlockMorph.prototype.addErrorHighlight = function () {\n    var isHidden = !this.isVisible,\n        highlight;\n\n    if (isHidden) {this.show(); }\n    this.removeHighlight();\n    highlight = this.highlight(\n        this.errorHighlight,\n        this.activeBlur,\n        this.activeBorder\n    );\n    this.addBack(highlight);\n    this.fullChanged();\n    if (isHidden) {this.hide(); }\n    return highlight;\n};\n\nBlockMorph.prototype.removeHighlight = function () {\n    var highlight = this.getHighlight();\n    if (highlight !== null) {\n        this.fullChanged();\n        this.removeChild(highlight);\n    }\n    return highlight;\n};\n\nBlockMorph.prototype.toggleHighlight = function () {\n    if (this.getHighlight()) {\n        this.removeHighlight();\n    } else {\n        this.addHighlight();\n    }\n};\n\nBlockMorph.prototype.highlight = function (color, blur, border) {\n    var highlight = new BlockHighlightMorph(),\n        fb = this.fullBounds(),\n        edge = useBlurredShadows && !MorphicPreferences.isFlat ?\n                blur : border;\n    highlight.bounds.setExtent(fb.extent().add(edge * 2));\n    highlight.holes = [highlight.bounds]; // make the highlight untouchable\n    highlight.color = color;\n    highlight.cachedImage = useBlurredShadows && !MorphicPreferences.isFlat ?\n            this.highlightImageBlurred(color, blur)\n                : this.highlightImage(color, border);\n    highlight.setPosition(fb.origin.subtract(new Point(edge, edge)));\n    return highlight;\n};\n\nBlockMorph.prototype.highlightImage = function (color, border) {\n    var fb, img, hi, ctx, out;\n    fb = this.fullBounds().extent();\n    this.doWithAlpha(1, () => img = this.fullImage());\n\n    hi = newCanvas(fb.add(border * 2));\n    ctx = hi.getContext('2d');\n\n    ctx.drawImage(img, 0, 0);\n    ctx.drawImage(img, border, 0);\n    ctx.drawImage(img, border * 2, 0);\n    ctx.drawImage(img, border * 2, border);\n    ctx.drawImage(img, border * 2, border * 2);\n    ctx.drawImage(img, border, border * 2);\n    ctx.drawImage(img, 0, border * 2);\n    ctx.drawImage(img, 0, border);\n\n    ctx.globalCompositeOperation = 'destination-out';\n    ctx.drawImage(img, border, border);\n\n    out = newCanvas(fb.add(border * 2));\n    ctx = out.getContext('2d');\n    ctx.drawImage(hi, 0, 0);\n    ctx.globalCompositeOperation = 'source-atop';\n    ctx.fillStyle = color.toString();\n    ctx.fillRect(0, 0, out.width, out.height);\n\n    return out;\n};\n\nBlockMorph.prototype.highlightImageBlurred = function (color, blur) {\n    var fb, img, hi, ctx;\n    fb = this.fullBounds().extent();\n    this.doWithAlpha(1, () => img = this.fullImage());\n\n    hi = newCanvas(fb.add(blur * 2));\n    ctx = hi.getContext('2d');\n    ctx.shadowBlur = blur;\n    ctx.shadowColor = color.toString();\n    ctx.drawImage(img, blur, blur);\n\n    ctx.shadowBlur = 0;\n    ctx.globalCompositeOperation = 'destination-out';\n    ctx.drawImage(img, blur, blur);\n    return hi;\n};\n\nBlockMorph.prototype.getHighlight = function () {\n    var highlights;\n    highlights = this.children.slice(0).reverse().filter(child =>\n        child instanceof BlockHighlightMorph\n    );\n    if (highlights.length !== 0) {\n        return highlights[0];\n    }\n    return null;\n};\n\nBlockMorph.prototype.outline = function (color, border) {\n    var highlight = new BlockHighlightMorph(),\n        fb = this.fullBounds(),\n        edge = border;\n    highlight.bounds.setExtent(fb.extent().add(edge * 2));\n    highlight.color = color;\n    highlight.cachedImage = this.highlightImage(color, border);\n    highlight.setPosition(fb.origin.subtract(new Point(edge, edge)));\n    return highlight;\n};\n\n// BlockMorph zebra coloring\n\nBlockMorph.prototype.fixBlockColor = function (nearestBlock, isForced) {\n    var nearest = nearestBlock,\n        clr,\n        cslot;\n\n    if (!this.zebraContrast && !isForced) {\n        return;\n    }\n    if (!this.zebraContrast && isForced) {\n        return this.forceNormalColoring(true);\n    }\n\n    if (!nearest) {\n        if (this.parent) {\n            if (this.isPrototype) {\n                nearest = null; // this.parent; // the PrototypeHatBlockMorph\n            } else if (this instanceof ReporterBlockMorph) {\n                nearest = this.parent.parentThatIsA(BlockMorph);\n            } else { // command\n                cslot = this.parentThatIsA(CommandSlotMorph, ReporterSlotMorph);\n                if (cslot) {\n                    nearest = cslot.parentThatIsA(BlockMorph);\n                }\n            }\n        }\n    }\n    if (!nearest) { // top block\n        clr = SpriteMorph.prototype.blockColor[this.category];\n        if (!this.color.eq(clr)) {\n            this.alternateBlockColor();\n        }\n    } else if (nearest.category === this.category) {\n        if (nearest.color.eq(this.color)) {\n            this.alternateBlockColor();\n        }\n    } else if (this.category && !this.color.eq(\n            SpriteMorph.prototype.blockColor[this.category]\n        )) {\n        this.alternateBlockColor();\n    }\n    if (isForced) {\n        this.fixChildrensBlockColor(true);\n    }\n};\n\nBlockMorph.prototype.forceNormalColoring = function () {\n    var clr = SpriteMorph.prototype.blockColor[this.category];\n    this.setColor(clr);\n    this.setLabelColor(\n        WHITE,\n        clr.darker(this.labelContrast),\n        MorphicPreferences.isFlat ? ZERO : this.embossing\n    );\n    this.fixChildrensBlockColor(true);\n};\n\nBlockMorph.prototype.alternateBlockColor = function () {\n    var clr = SpriteMorph.prototype.blockColor[this.category];\n\n    if (this.color.eq(clr)) {\n        this.setColor(\n            this.zebraContrast < 0 ? clr.darker(Math.abs(this.zebraContrast))\n                : clr.lighter(this.zebraContrast),\n            this.hasLabels() // silently\n        );\n    } else {\n        this.setColor(clr, this.hasLabels()); // silently\n    }\n    this.fixLabelColor();\n    this.fixChildrensBlockColor(true); // has issues if not forced\n};\n\nBlockMorph.prototype.ghost = function () {\n    this.setColor(\n        SpriteMorph.prototype.blockColor[this.category].lighter(35)\n    );\n};\n\nBlockMorph.prototype.fixLabelColor = function () {\n    if (this.zebraContrast > 0 && this.category) {\n        var clr = SpriteMorph.prototype.blockColor[this.category];\n        if (this.color.eq(clr)) {\n            this.setLabelColor(\n                WHITE,\n                clr.darker(this.labelContrast),\n                MorphicPreferences.isFlat ? null : this.embossing\n            );\n        } else {\n            this.setLabelColor(\n                BLACK,\n                clr.lighter(this.zebraContrast)\n                    .lighter(this.labelContrast * 2),\n                MorphicPreferences.isFlat ? null : this.embossing.neg()\n            );\n        }\n    }\n};\n\nBlockMorph.prototype.fixChildrensBlockColor = function (isForced) {\n    this.children.forEach(morph => {\n        if (morph instanceof CommandBlockMorph) {\n            morph.fixBlockColor(null, isForced);\n        } else if (morph instanceof SyntaxElementMorph) {\n            morph.fixBlockColor(this, isForced);\n            if (morph instanceof BooleanSlotMorph) {\n                morph.fixLayout();\n            }\n        }\n    });\n};\n\nBlockMorph.prototype.setCategory = function (aString) {\n    this.category = aString;\n    this.fixBlockColor();\n};\n\nBlockMorph.prototype.hasLabels = function () {\n    return this.children.some(any => any instanceof StringMorph);\n};\n\n// BlockMorph copying\n\n// Override copy so that coppied Blocks get new IDs unless copyIDs is true\nBlockMorph.prototype.copy = function() {\n    var copy = BlockMorph.uber.copy.call(this);\n    if (!BlockMorph.copyIDs) copy.id = BlockMorph.nextId++;\n    return copy;\n};\n\nBlockMorph.prototype.fullCopy = function () {\n    var ans = BlockMorph.uber.fullCopy.call(this);\n    ans.removeHighlight();\n    ans.isDraggable = true;\n    if (this.instantiationSpec) {\n        ans.setSpec(this.instantiationSpec);\n    }\n    ans.allChildren().filter(block => {\n        if (block instanceof SyntaxElementMorph) {\n            block.cachedInputs = null;\n            if (block.isCustomBlock) {\n                block.initializeVariables();\n            }\n        }\n        return !isNil(block.comment);\n    }).forEach(block => {\n        var cmnt = block.comment.fullCopy();\n        block.comment = cmnt;\n        cmnt.block = block;\n    });\n    ans.cachedInputs = null;\n    return ans;\n};\n\nBlockMorph.prototype.reactToTemplateCopy = function () {\n    // Trace.log('Block.created', this.blockId());\n    if (this.isLocalVarTemplate) {\n    \tthis.isLocalVarTemplate = null;\n        this.fixLayout();\n    }\n    this.forceNormalColoring();\n};\n\nBlockMorph.prototype.hasBlockVars = function () {\n    return this.anyChild(any =>\n        any.isCustomBlock &&\n            any.isGlobal &&\n                any.definition.variableNames.length\n    );\n};\n\nBlockMorph.prototype.pickUp = function (wrrld) {\n    // used when duplicating and grabbing a block via its context menu\n    // position the duplicate's top-left corner at the mouse pointer\n    var world = wrrld || this.world();\n    this.setPosition(world.hand.position().subtract(this.rounding));\n    world.hand.grab(this);\n};\n\n// BlockMorph events\n\n// BlockMorph.prototype.mouseClickLeft = function () {\n//     var top = this.topBlock(),\n//         receiver = top.scriptTarget(),\n//         shiftClicked = this.world().currentKey === 16,\n//         stage;\n//     if (shiftClicked && !this.isTemplate) {\n//         return this.selectForEdit().focus(); // enable coopy-on-edit\n//     }\n//     if (top instanceof PrototypeHatBlockMorph) {\n//         return; // top.mouseClickLeft();\n//     }\n//     if (receiver) {\n//         stage = receiver.parentThatIsA(StageMorph);\n//         if (stage) {\n//             var process = stage.threads.findProcess(top);\n//             if (process && !process.readyToTerminate) {\n//                 // Trace.log('Block.clickStopRun', top.blockId());\n//             } else {\n//                 // Trace.log('Block.clickRun', top.blockId());\n//             }\n//             // Useful for debugging\n//             window.lastRun = top;\n//             stage.threads.toggleProcess(top, receiver);\n//         }\n//     }\n// };\n\nBlockMorph.prototype.focus = function () {\n    var scripts = this.parentThatIsA(ScriptsMorph),\n        world = this.world(),\n        focus;\n    if (!scripts || !ScriptsMorph.prototype.enableKeyboard) {return; }\n    if (scripts.focus) {scripts.focus.stopEditing(); }\n    world.stopEditing();\n    focus = new ScriptFocusMorph(scripts, this);\n    scripts.focus = focus;\n    focus.getFocus(world);\n    if (this instanceof HatBlockMorph) {\n        focus.nextCommand();\n    }\n};\n\n// BlockMorph.prototype.activeProcess = function () {\n//     var top = this.topBlock(),\n//         receiver = top.scriptTarget(),\n//         stage;\n//     if (top instanceof PrototypeHatBlockMorph) {\n//         return null;\n//     }\n//     if (receiver) {\n//         stage = receiver.parentThatIsA(StageMorph);\n//         if (stage) {\n//             return stage.threads.findProcess(top, receiver);\n//         }\n//     }\n//     return null;\n// };\n\nBlockMorph.prototype.mouseEnterBounds = function (dragged) {\n    if (!dragged && this.alpha < 1) {\n        this.alpha = Math.min(this.alpha + 0.2, 1);\n        this.rerender();\n    }\n};\n\nBlockMorph.prototype.mouseLeaveBounds = function (dragged) {\n    if (SyntaxElementMorph.prototype.alpha < 1) {\n        delete this.alpha;\n        this.rerender();\n    }\n};\n\n// BlockMorph dragging and dropping\n\nBlockMorph.prototype.rootForGrab = function () {\n    return this;\n};\n\n/*\n    for demo purposes, allows you to drop arg morphs onto\n    blocks and forces a layout update. This section has\n    no relevance in end user mode.\n*/\n\nBlockMorph.prototype.wantsDropOf = function (aMorph) {\n    // override the inherited method\n    return (aMorph instanceof ArgMorph\n        || aMorph instanceof StringMorph\n        || aMorph instanceof TextMorph\n    ) && !this.isTemplate;\n};\n\nBlockMorph.prototype.reactToDropOf = function (droppedMorph) {\n    droppedMorph.isDraggable = false;\n    droppedMorph.fixLayout();\n    this.fixLayout();\n    this.buildSpec();\n};\n\nBlockMorph.prototype.situation = function () {\n    // answer a dictionary specifying where I am right now, so\n    // I can slide back to it if I'm dropped somewhere else\n    // NOTE: We can also add more key-value pairs to the situation\n    // dictionary to support non-standard modes of user-interaction,\n    // such as extracting single commands from within a stack\n    // see recordDrop() and userExtractJustThis()\n    if (!(this.parent instanceof TemplateSlotMorph)) {\n        var scripts = this.parentThatIsA(ScriptsMorph);\n        if (scripts) {\n            return {\n                origin: scripts,\n                position: this.position().subtract(scripts.position())\n            };\n        }\n    }\n    return BlockMorph.uber.situation.call(this);\n};\n\n// BlockMorph sticky comments\n\nBlockMorph.prototype.prepareToBeGrabbed = function (hand) {\n    // Trace.log('Block.grabbed', {\n    //     'id': this.blockId(),\n    //     'origin': this.bounds.origin\n    // });\n    var wrld = hand ? hand.world : this.world();\n    this.allInputs().forEach(input =>\n        delete input.bindingID\n    );\n    this.allComments().forEach(comment =>\n        comment.startFollowing(this, wrld)\n    );\n};\n\nBlockMorph.prototype.justDropped = function () {\n    delete this.alpha;\n    this.allComments().forEach(comment =>\n        comment.stopFollowing()\n    );\n};\n\nBlockMorph.prototype.allComments = function () {\n    return this.allChildren().filter(block =>\n        !isNil(block.comment)\n    ).map(block =>\n        block.comment\n    );\n};\n\nBlockMorph.prototype.destroy = function (justThis) {\n    // private - use IDE_Morph.removeBlock() to first stop all my processes\n    if (justThis) {\n        if (!isNil(this.comment)) {\n            this.comment.destroy();\n        }\n    } else {\n        this.allComments().forEach(comment =>\n            comment.destroy()\n        );\n    }\n    BlockMorph.uber.destroy.call(this);\n};\n\nBlockMorph.prototype.stackHeight = function () {\n    var fb = this.fullBounds(),\n        commentsBottom = Math.max(this.allComments().map(comment =>\n            comment.bottom()\n        )) || this.bottom();\n    return Math.max(fb.bottom(), commentsBottom) - fb.top();\n};\n\nBlockMorph.prototype.stackFullBounds = function () {\n    var fb = this.fullBounds();\n    this.allComments().forEach(comment =>\n        fb.mergeWith(comment.bounds)\n    );\n    return fb;\n};\n\nBlockMorph.prototype.stackWidth = function () {\n    var fb = this.fullBounds(),\n        commentsRight = Math.max(this.allComments().map(comment =>\n            comment.right()\n        )) || this.right();\n    return Math.max(fb.right(), commentsRight) - fb.left();\n};\n\nBlockMorph.prototype.snap = function () {\n    // Trace.log('Block.snapped', {\n    //     'id': this.blockId(),\n    //     'origin': this.bounds.origin,\n    // });\n    var top = this.topBlock(),\n        receiver,\n        stage,\n        ide;\n    top.allComments().forEach(comment =>\n        comment.align(top)\n    );\n    // fix highlights, if any\n    if (this.getHighlight() && (this !== top)) {\n        this.removeHighlight();\n    }\n    if (top.getHighlight()) {\n        top.addHighlight(top.removeHighlight());\n    }\n    // register generic hat blocks\n    if (this.selector === 'receiveCondition') {\n        receiver = top.scriptTarget();\n        if (receiver) {\n            stage = receiver.parentThatIsA(StageMorph);\n            if (stage) {\n                stage.enableCustomHatBlocks = true;\n                stage.threads.pauseCustomHatBlocks = false;\n                ide = stage.parentThatIsA(IDE_Morph);\n                if (ide) {\n                    ide.controlBar.stopButton.refresh();\n                }\n            }\n        }\n    }\n};\n\n// CommandBlockMorph ///////////////////////////////////////////////////\n\n/*\n    I am a stackable jigsaw-shaped block.\n\n    I inherit from BlockMorph adding the following most important\n    public accessors:\n\n        nextBlock()       - set / get the block attached to my bottom\n        bottomBlock()     - answer the bottom block of my stack\n        blockSequence()   - answer an array of blocks starting with myself\n\n    and the following \"lexical awareness\" indicators:\n\n        partOfCustomCommand - temporary bool set by the evaluator\n        exitTag           - temporary string or number set by the evaluator\n*/\n\n// CommandBlockMorph inherits from BlockMorph:\n\nCommandBlockMorph.prototype = new BlockMorph();\nCommandBlockMorph.prototype.constructor = CommandBlockMorph;\nCommandBlockMorph.uber = BlockMorph.prototype;\n\n// CommandBlockMorph instance creation:\n\nexport function CommandBlockMorph() {\n    this.init();\n}\n\nCommandBlockMorph.prototype.init = function () {\n    CommandBlockMorph.uber.init.call(this);\n\n    this.bounds.setExtent(new Point(60, 24).multiplyBy(this.scale));\n    this.fixLayout();\n    this.rerender();\n\n    this.partOfCustomCommand = false;\n    this.exitTag = null;\n};\n\n// CommandBlockMorph enumerating:\n\nCommandBlockMorph.prototype.blockSequence = function () {\n    var nb = this.nextBlock(),\n        result = [this];\n    if (nb) {\n        result = result.concat(nb.blockSequence());\n    }\n    return result;\n};\n\nCommandBlockMorph.prototype.bottomBlock = function () {\n    // topBlock() also exists - inherited from SyntaxElementMorph\n    if (this.nextBlock()) {\n        return this.nextBlock().bottomBlock();\n    }\n    return this;\n};\n\nCommandBlockMorph.prototype.nextBlock = function (block) {\n    // set / get the block attached to my bottom\n    if (block) {\n        var nb = this.nextBlock(),\n            affected = this.parentThatIsA(CommandSlotMorph, ReporterSlotMorph);\n        this.add(block);\n        if (nb) {\n            block.bottomBlock().nextBlock(nb);\n        }\n        block.setPosition(\n            new Point(\n                this.left(),\n                this.bottom() - (this.corner)\n            )\n        );\n        if (affected) {\n            affected.fixLayout();\n        }\n    } else {\n        return detect(\n            this.children,\n            child => child instanceof CommandBlockMorph && !child.isPrototype\n        );\n    }\n};\n\n// CommandBlockMorph attach targets:\n\nCommandBlockMorph.prototype.topAttachPoint = function () {\n    return new Point(\n        this.dentCenter(),\n        this.top()\n    );\n};\n\nCommandBlockMorph.prototype.bottomAttachPoint = function () {\n    return new Point(\n        this.dentCenter(),\n        this.bottom()\n    );\n};\n\nCommandBlockMorph.prototype.wrapAttachPoint = function () {\n    var cslot = detect( // could be a method making uses of caching...\n        this.inputs(), // ... although these already are cached\n        each => each instanceof CSlotMorph\n    );\n    if (cslot && !cslot.nestedBlock()) {\n        return new Point(\n            cslot.left() + (cslot.inset * 2) + cslot.corner,\n            cslot.top() + (cslot.corner * 2)\n        );\n    }\n    return null;\n};\n\nCommandBlockMorph.prototype.dentLeft = function () {\n    return this.left()\n        + this.corner\n        + this.inset;\n};\n\nCommandBlockMorph.prototype.dentCenter = function () {\n    return this.dentLeft()\n        + this.corner\n        + (this.dent * 0.5);\n};\n\nCommandBlockMorph.prototype.attachTargets = function () {\n    var answer = [],\n        tp;\n    if (!(this instanceof HatBlockMorph)) {\n        tp = this.topAttachPoint();\n        if (!(this.parent instanceof SyntaxElementMorph)) {\n            answer.push({\n                point: tp,\n                element: this,\n                loc: 'top',\n                type: 'block'\n            });\n        }\n        if (ScriptsMorph.prototype.enableNestedAutoWrapping ||\n                !this.parentThatIsA(CommandSlotMorph)) {\n            answer.push({\n                point: tp,\n                element: this,\n                loc: 'wrap',\n                type: 'block'\n            });\n        }\n    }\n    if (!this.isStop()) {\n        answer.push({\n            point: this.bottomAttachPoint(),\n            element: this,\n            loc: 'bottom',\n            type: 'block'\n        });\n    }\n    return answer;\n};\n\nCommandBlockMorph.prototype.allAttachTargets = function (newParent) {\n    var target = newParent || this.parent,\n        answer = [],\n        topBlocks;\n\n    if (this instanceof HatBlockMorph && newParent.rejectsHats) {\n        return answer;\n    }\n    topBlocks = target.children.filter(child =>\n        (child !== this) &&\n            child instanceof SyntaxElementMorph &&\n                !child.isTemplate\n    );\n    topBlocks.forEach(block =>\n        block.forAllChildren(child => {\n            if (child.attachTargets) {\n                child.attachTargets().forEach(at =>\n                    answer.push(at)\n                );\n            }\n        })\n    );\n    return answer;\n};\n\nCommandBlockMorph.prototype.closestAttachTarget = function (newParent) {\n    var target = newParent || this.parent,\n        bottomBlock = this.bottomBlock(),\n        answer = null,\n        thresh = Math.max(\n            this.corner * 2 + this.dent,\n            this.minSnapDistance\n        ),\n        dist,\n        ref = [],\n        minDist = 1000,\n        wrap;\n\n    if (!(this instanceof HatBlockMorph)) {\n        ref.push(\n            {\n                point: this.topAttachPoint(),\n                loc: 'top'\n            }\n        );\n        wrap = this.wrapAttachPoint();\n        if (wrap) {\n            ref.push(\n                {\n                    point: wrap,\n                    loc: 'wrap'\n                }\n            );\n        }\n    }\n    if (!bottomBlock.isStop()) {\n        ref.push(\n            {\n                point: bottomBlock.bottomAttachPoint(),\n                loc: 'bottom'\n            }\n        );\n    }\n    this.allAttachTargets(target).forEach(eachTarget =>\n        ref.forEach(eachRef => {\n            // match: either both locs are 'wrap' or both are different,\n            // none being 'wrap' (can this be expressed any better?)\n            if ((eachRef.loc === 'wrap' && (eachTarget.loc === 'wrap')) ||\n                ((eachRef.loc !== eachTarget.loc) &&\n                    (eachRef.loc !== 'wrap') && (eachTarget.loc !== 'wrap'))\n            ) {\n                dist = eachRef.point.distanceTo(eachTarget.point);\n                if ((dist < thresh) && (dist < minDist)) {\n                    minDist = dist;\n                    answer = eachTarget;\n                }\n            }\n        })\n    );\n    return answer;\n};\n\nCommandBlockMorph.prototype.snap = function (hand) {\n    var target = this.closestAttachTarget(),\n        scripts = this.parentThatIsA(ScriptsMorph),\n        before,\n        next,\n        offsetY,\n        cslot,\n        affected;\n\n    scripts.clearDropInfo();\n    scripts.lastDroppedBlock = this;\n    if (target === null) {\n        this.fixBlockColor();\n        CommandBlockMorph.uber.snap.call(this); // align stuck comments\n        if (hand) {\n            scripts.recordDrop(hand.grabOrigin);\n        }\n        return;\n    }\n\n    scripts.lastDropTarget = target;\n\n    if (target.loc === 'bottom') {\n        if (target.type === 'slot') {\n            this.removeHighlight();\n            scripts.lastNextBlock = target.element.nestedBlock();\n            target.element.nestedBlock(this);\n        } else {\n            scripts.lastNextBlock = target.element.nextBlock();\n            target.element.nextBlock(this);\n        }\n        if (this.isStop()) {\n            next = this.nextBlock();\n            if (next) {\n                scripts.add(next);\n                next.moveBy(this.extent().floorDivideBy(2));\n                affected = this.parentThatIsA(\n                    CommandSlotMorph,\n                    ReporterSlotMorph\n                );\n                if (affected) {\n                    affected.fixLayout();\n                }\n            }\n        }\n    } else if (target.loc === 'top') {\n        target.element.removeHighlight();\n        offsetY = this.bottomBlock().bottom() - this.bottom();\n        this.setBottom(target.element.top() + this.corner - offsetY);\n        this.setLeft(target.element.left());\n        this.bottomBlock().nextBlock(target.element);\n    } else if (target.loc === 'wrap') {\n        // Trace.log('CommandBlock.wrap', {\n        //     'id': this.blockId(),\n        //     'target': target.element.blockId ? target.element.blockId() : null,\n        // });\n\n        cslot = detect( // this should be a method making use of caching\n            this.inputs(), // these are already cached, so maybe it's okay\n            each => each instanceof CSlotMorph\n        );\n        // assume the cslot is (still) empty, was checked determining the target\n        before = (target.element.parent);\n        scripts.lastWrapParent = before;\n\n        // adjust position of wrapping block\n        this.moveBy(target.point.subtract(cslot.slotAttachPoint()));\n\n        // wrap c-slot around target\n        cslot.nestedBlock(target.element);\n        if (before instanceof CommandBlockMorph) {\n            before.nextBlock(this);\n        } else if (before instanceof CommandSlotMorph) {\n            before.nestedBlock(this);\n        } else if (before instanceof RingReporterSlotMorph) {\n            before.add(this);\n            before.fixLayout();\n        }\n\n        // fix zebra coloring.\n        // this could probably be generalized into the fixBlockColor mechanism\n        target.element.blockSequence().forEach(cmd =>\n            cmd.fixBlockColor()\n        );\n    }\n    this.fixBlockColor();\n    CommandBlockMorph.uber.snap.call(this); // align stuck comments\n    if (hand) {\n        scripts.recordDrop(hand.grabOrigin);\n    }\n    if (this.snapSound) {\n        this.snapSound.play();\n    }\n};\n\nCommandBlockMorph.prototype.prepareToBeGrabbed = function (handMorph) {\n    // check whether the shift-key is held down and if I can be \"extracted\"\n    if (handMorph && handMorph.world.currentKey === 16 && this.nextBlock()) {\n        this.extract(); // NOTE: no infinite recursion, because extract()\n                        // doesn't call this again with a hand\n        handMorph.grabOrigin.action = 'extract'; // ???\n        return;\n    }\n\n    var oldPos = this.position();\n\n    if (this.parent instanceof RingReporterSlotMorph) {\n        this.parent.revertToDefaultInput(this);\n        this.setPosition(oldPos);\n    }\n    CommandBlockMorph.uber.prepareToBeGrabbed.call(this, handMorph);\n};\n\nCommandBlockMorph.prototype.isStop = function () {\n    var choice;\n    if (this.selector === 'doStopThis') { // this could be cached...\n        choice = this.inputs()[0].evaluate();\n        return choice instanceof Array && choice[0].length < 12;\n    }\n    return ([\n        'doForever',\n        'doReport',\n        'removeClone'\n    ].indexOf(this.selector) > -1);\n};\n\n// CommandBlockMorph deleting\n\nCommandBlockMorph.prototype.userDestroy = function () {\n    CommandBlockMorph.uber.userDestroy.call(this);\n    var target = this.selectForEdit(); // enable copy-on-edit\n    if (target !== this) {\n        return this.userDestroy.call(target);\n    }\n    if (this.nextBlock()) {\n        this.userDestroyJustThis();\n        return;\n    }\n\n    var scripts = this.parentThatIsA(ScriptsMorph),\n        ide = this.parentThatIsA(IDE_Morph),\n        parent = this.parentThatIsA(SyntaxElementMorph),\n        cslot = this.parentThatIsA(CSlotMorph);\n\n    // for undrop / redrop\n    if (scripts) {\n        scripts.clearDropInfo();\n        scripts.lastDroppedBlock = this;\n        scripts.recordDrop(this.situation());\n        scripts.dropRecord.action = 'delete';\n    }\n\n    this.prepareToBeGrabbed(); // fix outer ring reporter slot\n\n    if (ide) {\n        // also stop all active processes hatted by this block\n        ide.removeBlock(this);\n    } else {\n        this.destroy();\n    }\n    if (cslot) {\n        cslot.fixLayout();\n    }\n    if (parent) {\n        parent.reactToGrabOf(this); // fix highlight\n    }\n};\n\nCommandBlockMorph.prototype.userDestroyJustThis = function () {\n    // delete just this one block, reattach next block to the previous one,\n    var scripts = this.parentThatIsA(ScriptsMorph),\n        nb = this.nextBlock();\n\n    // for undrop / redrop\n    if (scripts) {\n        scripts.clearDropInfo();\n        scripts.lastDroppedBlock = this;\n        scripts.recordDrop(this.situation());\n        scripts.dropRecord.lastNextBlock = nb;\n        scripts.dropRecord.action = 'delete';\n    }\n\n    this.extract();\n};\n\nCommandBlockMorph.prototype.userExtractJustThis = function () {\n    // extract just this one block, reattach next block to the previous one,\n    var situation = this.situation();\n    situation.action = \"extract\"; // record how this block was retrieved\n    this.extract();\n    this.pickUp(situation.origin.world());\n    this.parent.grabOrigin = situation;\n};\n\nCommandBlockMorph.prototype.extract = function () {\n    // private: extract just this one block\n    // reattach next block to the previous one,\n    var scripts = this.parentThatIsA(ScriptsMorph),\n        ide = this.parentThatIsA(IDE_Morph),\n        cs = this.parentThatIsA(CommandSlotMorph, RingReporterSlotMorph),\n        pb,\n        nb = this.nextBlock(),\n        above,\n        parent = this.parentThatIsA(SyntaxElementMorph),\n        cslot = this.parentThatIsA(CSlotMorph, RingReporterSlotMorph);\n\n    this.topBlock().fullChanged();\n    if (this.parent) {\n        pb = this.parent.parentThatIsA(CommandBlockMorph);\n    }\n    if (pb && (pb.nextBlock() === this)) {\n        above = pb;\n    } else if (cs && (cs.nestedBlock() === this)) {\n        above = cs;\n        this.prepareToBeGrabbed(); // restore ring reporter slot, if any\n    }\n    if (ide) {\n        // also stop all active processes hatted by this block\n        ide.removeBlock(this, true); // just this block\n    } else {\n        this.destroy(true); // just this block\n    }\n    if (nb) {\n        if (above instanceof CommandSlotMorph ||\n            above instanceof RingReporterSlotMorph\n        ) {\n            above.nestedBlock(nb);\n        } else if (above instanceof CommandBlockMorph) {\n            above.nextBlock(nb);\n        } else {\n            scripts.add(nb);\n        }\n    } else if (cslot) {\n        cslot.fixLayout();\n    }\n    if (parent) {\n        parent.reactToGrabOf(this); // fix highlight\n    }\n};\n\n// CommandBlockMorph drawing:\n\nCommandBlockMorph.prototype.outlinePath = function(ctx, inset) {\n    var indent = this.corner * 2 + this.inset,\n        bottom = this.height() - this.corner,\n        bottomCorner = this.height() - this.corner * 2,\n        radius = Math.max(this.corner - inset, 0),\n        pos = this.position();\n\n    // top left:\n    ctx.arc(\n        this.corner,\n        this.corner,\n        radius,\n        radians(-180),\n        radians(-90),\n        false\n    );\n\n    // top dent:\n    ctx.lineTo(this.corner + this.inset, inset);\n    ctx.lineTo(indent, this.corner + inset);\n    ctx.lineTo(indent + this.dent, this.corner + inset);\n    ctx.lineTo(this.corner * 3 + this.inset + this.dent, inset);\n    ctx.lineTo(this.width() - this.corner, inset);\n\n    // top right:\n    ctx.arc(\n        this.width() - this.corner,\n        this.corner,\n        radius,\n        radians(-90),\n        radians(-0),\n        false\n    );\n\n    // C-Slots\n    this.cSlots().forEach(slot => {\n        slot.outlinePath(ctx, inset, slot.position().subtract(pos));\n    });\n\n    // bottom right:\n    ctx.arc(\n        this.width() - this.corner,\n        bottomCorner,\n        radius,\n        radians(0),\n        radians(90),\n        false\n    );\n\n    if (!this.isStop()) {\n        ctx.lineTo(this.width() - this.corner, bottom - inset);\n        ctx.lineTo(this.corner * 3 + this.inset + this.dent, bottom - inset);\n        ctx.lineTo(indent + this.dent, bottom + this.corner - inset);\n        ctx.lineTo(indent, bottom + this.corner - inset);\n        ctx.lineTo(this.corner + this.inset, bottom - inset);\n    }\n\n    // bottom left:\n    ctx.arc(\n        this.corner,\n        bottomCorner,\n        radius,\n        radians(90),\n        radians(180),\n        false\n    );\n};\n\nCommandBlockMorph.prototype.drawEdges = function (ctx) {\n    this.drawTopDentEdge(ctx, 0, 0);\n    this.drawBottomDentEdge(ctx, 0, this.height() - this.corner);\n    this.drawLeftEdge(ctx);\n    this.drawRightEdge(ctx);\n    this.drawTopLeftEdge(ctx);\n    this.drawBottomRightEdge(ctx);\n};\n\nCommandBlockMorph.prototype.drawTopDentEdge = function (ctx, x, y) {\n    var shift = this.edge * 0.5,\n        indent = x + this.corner * 2 + this.inset,\n        upperGradient,\n        lowerGradient,\n        leftGradient,\n        lgx;\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    upperGradient = ctx.createLinearGradient(\n        0,\n        y,\n        0,\n        y + this.edge\n    );\n    upperGradient.addColorStop(0, this.cachedClrBright);\n    upperGradient.addColorStop(1, this.cachedClr);\n\n    ctx.strokeStyle = upperGradient;\n    ctx.beginPath();\n    ctx.moveTo(this.corner, y + shift);\n    ctx.lineTo(x + this.corner + this.inset, y + shift);\n    ctx.stroke();\n\n    ctx.strokeStyle = upperGradient;\n    ctx.beginPath();\n    ctx.moveTo(\n        x + this.corner * 3 + this.inset + this.dent + shift,\n        y + shift\n    );\n    ctx.lineTo(this.width() - this.corner, y + shift);\n    ctx.stroke();\n\n    lgx = x + this.corner + this.inset;\n    leftGradient = ctx.createLinearGradient(\n        lgx - this.edge,\n        y + this.edge,\n        lgx,\n        y\n    );\n    leftGradient.addColorStop(0, this.cachedClr);\n    leftGradient.addColorStop(1, this.cachedClrBright);\n\n    ctx.strokeStyle = leftGradient;\n    ctx.beginPath();\n    ctx.moveTo(x + this.corner + this.inset, y + shift);\n    ctx.lineTo(indent, y + this.corner + shift);\n    ctx.stroke();\n\n    lowerGradient = ctx.createLinearGradient(\n        0,\n        y + this.corner,\n        0,\n        y + this.corner + this.edge\n    );\n    lowerGradient.addColorStop(0, this.cachedClrBright);\n    lowerGradient.addColorStop(1, this.cachedClr);\n\n    ctx.strokeStyle = lowerGradient;\n    ctx.beginPath();\n    ctx.moveTo(indent, y + this.corner + shift);\n    ctx.lineTo(indent + this.dent, y + this.corner + shift);\n    ctx.stroke();\n};\n\nCommandBlockMorph.prototype.drawBottomDentEdge = function (ctx, x, y) {\n    var shift = this.edge * 0.5,\n        indent = x + this.corner * 2 + this.inset,\n        upperGradient,\n        lowerGradient,\n        rightGradient;\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    upperGradient = ctx.createLinearGradient(\n        0,\n        y - this.edge,\n        0,\n        y\n    );\n    upperGradient.addColorStop(0, this.cachedClr);\n    upperGradient.addColorStop(1, this.cachedClrDark);\n\n    ctx.strokeStyle = upperGradient;\n    ctx.beginPath();\n    ctx.moveTo(this.corner, y - shift);\n    if (this.isStop()) {\n        ctx.lineTo(this.width() - this.corner, y - shift);\n    } else {\n        ctx.lineTo(x + this.corner + this.inset - shift, y - shift);\n    }\n    ctx.stroke();\n\n    if (this.isStop()) {    // draw straight bottom edge\n        return null;\n    }\n\n    lowerGradient = ctx.createLinearGradient(\n        0,\n        y + this.corner - this.edge,\n        0,\n        y + this.corner\n    );\n    lowerGradient.addColorStop(0, this.cachedClr);\n    lowerGradient.addColorStop(1, this.cachedClrDark);\n\n    ctx.strokeStyle = lowerGradient;\n    ctx.beginPath();\n    ctx.moveTo(indent + shift, y + this.corner - shift);\n    ctx.lineTo(indent + this.dent, y + this.corner - shift);\n    ctx.stroke();\n\n    rightGradient = ctx.createLinearGradient(\n        x + indent + this.dent - this.edge,\n        y + this.corner - this.edge,\n        x + indent + this.dent,\n        y + this.corner\n    );\n    rightGradient.addColorStop(0, this.cachedClr);\n    rightGradient.addColorStop(1, this.cachedClrDark);\n\n    ctx.strokeStyle = rightGradient;\n    ctx.beginPath();\n    ctx.moveTo(x + indent + this.dent, y + this.corner - shift);\n    ctx.lineTo(\n        x + this.corner * 3 + this.inset + this.dent,\n        y - shift\n    );\n    ctx.stroke();\n\n    ctx.strokeStyle = upperGradient;\n    ctx.beginPath();\n    ctx.moveTo(\n        x + this.corner * 3 + this.inset + this.dent,\n        y - shift\n    );\n    ctx.lineTo(this.width() - this.corner, y - shift);\n    ctx.stroke();\n};\n\nCommandBlockMorph.prototype.drawFlatBottomDentEdge = function (ctx) {\n    if (!this.isStop()) {\n        ctx.fillStyle = this.color.darker(this.contrast / 2).toString();\n        ctx.beginPath();\n        this.drawDent(ctx, 0, this.height() - this.corner);\n        ctx.closePath();\n        ctx.fill();\n    }\n};\n\nCommandBlockMorph.prototype.drawLeftEdge = function (ctx) {\n    var shift = this.edge * 0.5,\n        gradient = ctx.createLinearGradient(0, 0, this.edge, 0);\n\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(shift, this.corner);\n    ctx.lineTo(shift, this.height() - this.corner * 2 - shift);\n    ctx.stroke();\n};\n\nCommandBlockMorph.prototype.drawRightEdge = function (ctx) {\n    var shift = this.edge * 0.5,\n        cslots = this.cSlots(),\n        top = this.top(),\n        x = this.width(),\n        y,\n        gradient;\n\n    gradient = ctx.createLinearGradient(x - this.edge, 0, x, 0);\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrDark);\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n    ctx.strokeStyle = gradient;\n\n    if (cslots.length) {\n        ctx.beginPath();\n        ctx.moveTo(x - shift, this.corner + shift);\n        cslots.forEach(slot => {\n            y = slot.top() - top;\n            ctx.lineTo(x - shift, y);\n            ctx.stroke();\n            ctx.beginPath();\n            ctx.moveTo(x - shift, y + slot.height());\n        });\n    } else {\n        ctx.beginPath();\n        ctx.moveTo(x - shift, this.corner + shift);\n    }\n    ctx.lineTo(x - shift, this.height() - this.corner * 2);\n    ctx.stroke();\n};\n\nCommandBlockMorph.prototype.drawTopLeftEdge = function (ctx) {\n    var shift = this.edge * 0.5,\n        gradient;\n\n    gradient = ctx.createRadialGradient(\n        this.corner,\n        this.corner,\n        this.corner,\n        this.corner,\n        this.corner,\n        this.corner - this.edge\n    );\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    ctx.strokeStyle = gradient;\n\n    ctx.beginPath();\n    ctx.arc(\n        this.corner,\n        this.corner,\n        this.corner - shift,\n        radians(-180),\n        radians(-90),\n        false\n    );\n    ctx.stroke();\n};\n\nCommandBlockMorph.prototype.drawBottomRightEdge = function (ctx) {\n    var shift = this.edge * 0.5,\n        x = this.width() - this.corner,\n        y = this.height() - this.corner * 2,\n        gradient;\n\n    gradient = ctx.createRadialGradient(\n        x,\n        y,\n        this.corner,\n        x,\n        y,\n        this.corner - this.edge\n    );\n    gradient.addColorStop(0, this.cachedClrDark);\n    gradient.addColorStop(1, this.cachedClr);\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    ctx.strokeStyle = gradient;\n\n    ctx.beginPath();\n    ctx.arc(\n        x,\n        y,\n        this.corner - shift,\n        radians(90),\n        radians(0),\n        true\n    );\n    ctx.stroke();\n};\n\n// HatBlockMorph ///////////////////////////////////////////////////////\n\n/*\n    I am a script's top most block. I can attach command blocks at my\n    bottom, but not on top.\n\n*/\n\n// HatBlockMorph inherits from CommandBlockMorph:\n\nHatBlockMorph.prototype = new CommandBlockMorph();\nHatBlockMorph.prototype.constructor = HatBlockMorph;\nHatBlockMorph.uber = CommandBlockMorph.prototype;\n\n// HatBlockMorph instance creation:\n\nexport function HatBlockMorph() {\n    this.init();\n}\n\nHatBlockMorph.prototype.init = function () {\n    HatBlockMorph.uber.init.call(this);\n    this.bounds.setExtent(new Point(120, 36).multiplyBy(this.scale));\n    this.fixLayout();\n    this.rerender();\n};\n\n// HatBlockMorph enumerating:\n\nHatBlockMorph.prototype.blockSequence = function () {\n    // override my inherited method so that I am not part of my sequence\n    var result = HatBlockMorph.uber.blockSequence.call(this);\n    result.shift();\n    return result;\n};\n\n// HatBlockMorph drawing:\n\nHatBlockMorph.prototype.outlinePath = function(ctx, inset) {\n    var indent = this.corner * 2 + this.inset,\n        bottom = this.height() - this.corner,\n        bottomCorner = this.height() - this.corner * 2,\n        radius = Math.max(this.corner - inset, 0),\n        s = this.hatWidth,\n        h = this.hatHeight,\n        r = ((4 * h * h) + (s * s)) / (8 * h),\n        a = degrees(4 * Math.atan(2 * h / s)),\n        sa = a / 2,\n        sp = Math.min(s * 1.7, this.width() - this.corner);\n\n    // top arc:\n    ctx.moveTo(inset, h + this.corner);\n    ctx.arc(\n        s / 2,\n        r,\n        r,\n        radians(-sa - 90),\n        radians(-90),\n        false\n    );\n    ctx.bezierCurveTo(\n        s,\n        0,\n        s,\n        h,\n        sp,\n        h\n    );\n\n    // top right:\n    ctx.arc(\n        this.width() - this.corner,\n        h + this.corner,\n        radius,\n        radians(-90),\n        radians(-0),\n        false\n    );\n\n    // bottom right:\n    ctx.arc(\n        this.width() - this.corner,\n        bottomCorner,\n        radius,\n        radians(0),\n        radians(90),\n        false\n    );\n\n    if (!this.isStop()) {\n        ctx.lineTo(this.width() - this.corner, bottom - inset);\n        ctx.lineTo(this.corner * 3 + this.inset + this.dent, bottom - inset);\n        ctx.lineTo(indent + this.dent, bottom + this.corner - inset);\n        ctx.lineTo(indent, bottom + this.corner - inset);\n        ctx.lineTo(this.corner + this.inset, bottom - inset);\n    }\n\n    // bottom left:\n    ctx.arc(\n        this.corner,\n        bottomCorner,\n        radius,\n        radians(90),\n        radians(180),\n        false\n    );\n};\n\nHatBlockMorph.prototype.drawLeftEdge = function (ctx) {\n    var shift = this.edge * 0.5,\n        gradient = ctx.createLinearGradient(0, 0, this.edge, 0);\n\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(shift, this.hatHeight + shift);\n    ctx.lineTo(shift, this.height() - this.corner * 2 - shift);\n    ctx.stroke();\n};\n\nHatBlockMorph.prototype.drawRightEdge = function (ctx) {\n    var shift = this.edge * 0.5,\n        x = this.width(),\n        gradient;\n\n    gradient = ctx.createLinearGradient(x - this.edge, 0, x, 0);\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrDark);\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(x - shift, this.corner + this.hatHeight + shift);\n    ctx.lineTo(x - shift, this.height() - this.corner * 2);\n    ctx.stroke();\n};\n\nHatBlockMorph.prototype.drawTopDentEdge = nop;\n\nHatBlockMorph.prototype.drawTopLeftEdge = function (ctx) {\n    var shift = this.edge * 0.5,\n        s = this.hatWidth,\n        h = this.hatHeight,\n        r = ((4 * h * h) + (s * s)) / (8 * h),\n        a = degrees(4 * Math.atan(2 * h / s)),\n        sa = a / 2,\n        sp = Math.min(s * 1.7, this.width() - this.corner),\n        gradient;\n\n    gradient = ctx.createRadialGradient(\n        s / 2,\n        r,\n        r - this.edge,\n        s / 2,\n        r,\n        r\n    );\n    gradient.addColorStop(1, this.cachedClrBright);\n    gradient.addColorStop(0, this.cachedClr);\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(\n        Math.round(s / 2),\n        r,\n        r - shift,\n        radians(-sa - 90),\n        radians(-90),\n        false\n    );\n    ctx.moveTo(s / 2, shift);\n    ctx.bezierCurveTo(\n        s,\n        shift,\n        s,\n        h + shift,\n        sp,\n        h + shift\n    );\n    ctx.lineTo(this.width() - this.corner, h + shift);\n    ctx.stroke();\n};\n\n// ReporterBlockMorph //////////////////////////////////////////////////\n\n/*\n    I am a block with a return value, either round-ish or diamond shaped\n    I inherit all my important accessors from BlockMorph\n*/\n\n// ReporterBlockMorph inherits from BlockMorph:\n\nReporterBlockMorph.prototype = new BlockMorph();\nReporterBlockMorph.prototype.constructor = ReporterBlockMorph;\nReporterBlockMorph.uber = BlockMorph.prototype;\n\n// ReporterBlockMorph instance creation:\n\nexport function ReporterBlockMorph(isPredicate) {\n    this.init(isPredicate);\n}\n\nReporterBlockMorph.prototype.init = function (isPredicate) {\n    ReporterBlockMorph.uber.init.call(this);\n    this.isPredicate = isPredicate || false;\n\n    this.bounds.setExtent(new Point(50, 22).multiplyBy(this.scale));\n    this.fixLayout();\n    this.rerender();\n\n    this.cachedSlotSpec = null; // don't serialize\n    this.isLocalVarTemplate = null; // don't serialize\n};\n\n// ReporterBlockMorph drag & drop:\n\nReporterBlockMorph.prototype.snap = function (hand) {\n    // passing the hand is optional (for when blocks are dragged & dropped)\n    var scripts = this.parent,\n        nb,\n        target;\n\n    this.cachedSlotSpec = null;\n    if (!(scripts instanceof ScriptsMorph)) {\n        return null;\n    }\n\n    scripts.clearDropInfo();\n    scripts.lastDroppedBlock = this;\n\n    target = scripts.closestInput(this, hand);\n    if (target !== null) {\n        scripts.lastReplacedInput = target;\n        scripts.lastDropTarget = target.parent;\n        if (target instanceof MultiArgMorph) {\n            scripts.lastPreservedBlocks = target.inputs();\n            scripts.lastReplacedInput = target.fullCopy();\n        } else if (target instanceof CommandSlotMorph) {\n            scripts.lastReplacedInput = target;\n            nb = target.nestedBlock();\n            if (nb) {\n                nb = nb.fullCopy();\n                scripts.add(nb);\n                nb.moveBy(nb.extent());\n                nb.fixBlockColor();\n                scripts.lastPreservedBlocks = [nb];\n            }\n        }\n        target.parent.replaceInput(target, this);\n        if (this.snapSound) {\n            this.snapSound.play();\n        }\n    }\n    this.fixBlockColor();\n    ReporterBlockMorph.uber.snap.call(this);\n    if (hand) {\n        scripts.recordDrop(hand.grabOrigin);\n    }\n};\n\nReporterBlockMorph.prototype.prepareToBeGrabbed = function (handMorph) {\n    var oldPos = this.position();\n\n    if ((this.parent instanceof BlockMorph)\n            || (this.parent instanceof MultiArgMorph)\n            || (this.parent instanceof ReporterSlotMorph)) {\n        this.parent.revertToDefaultInput(this);\n        this.setPosition(oldPos);\n    }\n    ReporterBlockMorph.uber.prepareToBeGrabbed.call(this, handMorph);\n    handMorph.alpha = this.alpha < 1 ? 1 : 0.85;\n    this.cachedSlotSpec = null;\n};\n\n// ReporterBlockMorph enumerating\n\nReporterBlockMorph.prototype.blockSequence = function () {\n    // reporters don't have a sequence, answer myself\n    return this;\n};\n\n// ReporterBlockMorph evaluating\n\nReporterBlockMorph.prototype.isUnevaluated = function () {\n    // answer whether my parent block's slot is designated to be of an\n    // 'unevaluated' kind, denoting a spedial form\n    var spec = this.getSlotSpec();\n    return spec === '%anyUE' ||\n        spec === '%boolUE' ||\n        spec === '%f';\n};\n\nReporterBlockMorph.prototype.isLocked = function () {\n    // answer true if I can be exchanged by a dropped reporter\n    return this.isStatic || (this.getSlotSpec() === '%t');\n};\n\nReporterBlockMorph.prototype.getSlotSpec = function () {\n    // answer the spec of the slot I'm in, if any\n    // cached for performance\n    if (!this.cachedSlotSpec) {\n        this.cachedSlotSpec = this.determineSlotSpec();\n    /*\n    } else {\n        // debug slot spec caching\n        var real = this.determineSlotSpec();\n        if (real !== this.cachedSlotSpec) {\n            throw new Error(\n                'cached slot spec ' +\n                this.cachedSlotSpec +\n                ' does not match: ' +\n                real\n            );\n        }\n    */\n    }\n    return this.cachedSlotSpec;\n};\n\nReporterBlockMorph.prototype.determineSlotSpec = function () {\n    // private - answer the spec of the slot I'm in, if any\n    var parts, idx;\n    if (this.parent instanceof BlockMorph) {\n        parts = this.parent.parts().filter(part =>\n            // Edit(Thomas) use isNonPartMorph\n            !this.isNonPartMorph(part)\n        );\n        idx = parts.indexOf(this);\n        if (idx !== -1) {\n            if (this.parent.blockSpec) {\n                return this.parseSpec(this.parent.blockSpec)[idx];\n            }\n        }\n    }\n    if (this.parent instanceof MultiArgMorph) {\n        return this.parent.slotSpec;\n    }\n    if (this.parent instanceof TemplateSlotMorph) {\n        return this.parent.getSpec();\n    }\n    return null;\n};\n\n// ReporterBlockMorph events\n\n// ReporterBlockMorph.prototype.mouseClickLeft = function (pos) {\n//     var label,\n//         myself = this;\n//     if (this.parent instanceof BlockInputFragmentMorph) {\n//         return this.parent.mouseClickLeft();\n//     }\n//     if (this.parent instanceof TemplateSlotMorph) {\n//         if (this.parent.parent && this.parent.parent.parent &&\n//                 this.parent.parent.parent instanceof RingMorph) {\n//             label = \"Input name\";\n//         } else if (this.parent.parent.elementSpec === '%blockVars') {\n//             label = \"Block variable name\";\n//         } else {\n//             label = \"Script variable name\";\n//         }\n//         new DialogBoxMorph(\n//             this,\n//             function(arg) {\n//                 // Trace.log('TemplateArg.rename', {\n//                 //     'id': myself.parent.argId(),\n//                 //     'name': arg,\n//                 // });\n//                 myself.userSetSpec(arg);\n//             },\n//             this\n//         ).prompt(\n//             label,\n//             this.blockSpec,\n//             this.world()\n//         );\n//     } else {\n//         ReporterBlockMorph.uber.mouseClickLeft.call(this, pos);\n//     }\n// };\n\n// ReporterBlockMorph deleting\n\nReporterBlockMorph.prototype.userDestroy = function () {\n    ReporterBlockMorph.uber.userDestroy.call(this);\n    // make sure to restore default slot of parent block\n    var target = this.selectForEdit(); // enable copy-on-edit\n    if (target !== this) {\n        return this.userDestroy.call(target);\n    }\n\n    // for undrop / redrop\n    var scripts = this.parentThatIsA(ScriptsMorph);\n    if (scripts) {\n        scripts.clearDropInfo();\n        scripts.lastDroppedBlock = this;\n        scripts.recordDrop(this.situation());\n        scripts.dropRecord.action = 'delete';\n    }\n\n    this.topBlock().fullChanged();\n    this.prepareToBeGrabbed(this.world().hand);\n    this.destroy();\n};\n\n// ReporterBlockMorph drawing:\n\nReporterBlockMorph.prototype.outlinePath = function (ctx, inset) {\n    if (this.isPredicate) {\n        this.outlinePathDiamond(ctx, inset);\n    } else {\n        this.outlinePathOval(ctx, inset);\n    }\n};\n\nReporterBlockMorph.prototype.outlinePathOval = function (ctx, inset) {\n    // draw the 'flat' shape\n    var h = this.height(),\n        r = Math.min(this.rounding, h / 2),\n        radius = Math.max(r - inset, 0),\n        w = this.width(),\n        pos = this.position();\n\n    // top left:\n    ctx.arc(\n        r,\n        r,\n        radius,\n        radians(-180),\n        radians(-90),\n        false\n    );\n\n    // top right:\n    ctx.arc(\n        w - r,\n        r,\n        radius,\n        radians(-90),\n        radians(-0),\n        false\n    );\n\n    // C-Slots\n    this.cSlots().forEach(slot => {\n        slot.outlinePath(ctx, inset, slot.position().subtract(pos));\n    });\n\n    // bottom right:\n    ctx.arc(\n        w - r,\n        h - r,\n        radius,\n        radians(0),\n        radians(90),\n        false\n    );\n\n    // bottom left:\n    ctx.arc(\n        r,\n        h - r,\n        radius,\n        radians(90),\n        radians(180),\n        false\n    );\n\n    ctx.lineTo(r - radius, r); // close the path so we can clip it for rings\n};\n\nReporterBlockMorph.prototype.outlinePathDiamond = function (ctx, inset) {\n    // draw the 'flat' shape:\n    var w = this.width(),\n        h = this.height(),\n        h2 = Math.floor(h / 2),\n        r = this.rounding,\n        right = w - r,\n        pos = this.position(),\n        cslots = this.cSlots();\n\n    ctx.moveTo(inset, h2);\n    ctx.lineTo(r, inset);\n    ctx.lineTo(right - inset, inset);\n\n    if (cslots.length) {\n        this.cSlots().forEach(slot => {\n            slot.outlinePath(ctx, inset, slot.position().subtract(pos));\n        });\n    } else {\n        ctx.lineTo(w - inset, h2);\n    }\n\n    ctx.lineTo(right - inset, h - inset);\n    ctx.lineTo(r, h - inset);\n};\n\nReporterBlockMorph.prototype.drawEdges = function (ctx) {\n    if (this.isPredicate) {\n        this.drawEdgesDiamond(ctx);\n    } else {\n        this.drawEdgesOval(ctx);\n    }\n};\n\nReporterBlockMorph.prototype.drawEdgesOval = function (ctx) {\n    // add 3D-Effect\n    var h = this.height(),\n        r = Math.max(Math.min(this.rounding, h / 2), this.edge),\n        w = this.width(),\n        shift = this.edge / 2,\n        y,\n        top = this.top(),\n        cslots = this.cSlots(),\n        gradient;\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    // half-tone edges\n    // bottem left corner\n    gradient = ctx.createRadialGradient(\n        r,\n        h - r,\n        r - this.edge,\n        r,\n        h - r,\n        r + this.edge\n    );\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(\n        r,\n        h - r,\n        r - shift,\n        radians(90),\n        radians(180),\n        false\n    );\n    ctx.stroke();\n\n    // top right corner\n    gradient = ctx.createRadialGradient(\n        w - r,\n        r,\n        r - this.edge,\n        w - r,\n        r,\n        r + this.edge\n    );\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrDark);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(\n        w - r,\n        r,\n        r - shift,\n        radians(-90),\n        radians(0),\n        false\n    );\n    ctx.stroke();\n\n    // normal gradient edges\n\n    // top edge: straight line\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        0,\n        this.edge\n    );\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r - shift, shift);\n    ctx.lineTo(w - r + shift, shift);\n    ctx.stroke();\n\n    // top edge: left corner\n    gradient = ctx.createRadialGradient(\n        r,\n        r,\n        r - this.edge,\n        r,\n        r,\n        r\n    );\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(\n        r,\n        r,\n        r - shift,\n        radians(180),\n        radians(270),\n        false\n    );\n    ctx.stroke();\n\n    // bottom edge: right corner\n    gradient = ctx.createRadialGradient(\n        w - r,\n        h - r,\n        r - this.edge,\n        w - r,\n        h - r,\n        r\n    );\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrDark);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(\n        w - r,\n        h - r,\n        r - shift,\n        radians(0),\n        radians(90),\n        false\n    );\n    ctx.stroke();\n\n    // bottom edge: straight line\n    gradient = ctx.createLinearGradient(\n        0,\n        h - this.edge,\n        0,\n        h\n    );\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrDark);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r - shift, h - shift);\n    ctx.lineTo(w - r + shift, h - shift);\n    ctx.stroke();\n\n    // left edge: straight vertical line\n    gradient = ctx.createLinearGradient(0, 0, this.edge, 0);\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(shift, r);\n    ctx.lineTo(shift, h - r);\n    ctx.stroke();\n\n    // right edge: straight vertical line\n    gradient = ctx.createLinearGradient(w - this.edge, 0, w, 0);\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrDark);\n    ctx.strokeStyle = gradient;\n\n    if (cslots.length) {\n        ctx.beginPath();\n        ctx.moveTo(w - shift, r + shift);\n        cslots.forEach(slot => {\n            y = slot.top() - top;\n            ctx.lineTo(w - shift, y);\n            ctx.stroke();\n            ctx.beginPath();\n            ctx.moveTo(w - shift, y + slot.height());\n        });\n    } else {\n        ctx.beginPath();\n        ctx.moveTo(w - shift, r + shift);\n    }\n\n    ctx.lineTo(w - shift, h - r);\n    ctx.stroke();\n};\n\nReporterBlockMorph.prototype.drawEdgesDiamond = function (ctx) {\n    // add 3D-Effec\n    var w = this.width(),\n        h = this.height(),\n        h2 = Math.floor(h / 2),\n        r = this.rounding,\n        shift = this.edge / 2,\n        cslots = this.cSlots(),\n        top = this.top(),\n        y,\n        gradient;\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    // half-tone edges\n    // bottom left corner\n    gradient = ctx.createLinearGradient(\n        -r,\n        0,\n        r,\n        0\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(shift, h2);\n    ctx.lineTo(r, h - shift);\n    ctx.closePath();\n    ctx.stroke();\n\n    // normal gradient edges\n    // top edge: left corner\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        r,\n        0\n    );\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(shift, h2);\n    ctx.lineTo(r, shift);\n    ctx.closePath();\n    ctx.stroke();\n\n    // top edge: straight line\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        0,\n        this.edge\n    );\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r, shift);\n\n    // right edge\n    if (cslots.length) {\n        // end of top edge\n        ctx.lineTo(w - r - shift, shift);\n        ctx.closePath();\n        ctx.stroke();\n\n        // right vertical edge\n        gradient = ctx.createLinearGradient(w - r - this.edge, 0, w - r, 0);\n        gradient.addColorStop(0, this.cachedClr);\n        gradient.addColorStop(1, this.cachedClrDark);\n\n        ctx.lineWidth = this.edge;\n        ctx.lineJoin = 'round';\n        ctx.lineCap = 'round';\n        ctx.strokeStyle = gradient;\n\n        ctx.beginPath();\n        ctx.moveTo(w - r - shift, this.edge + shift);\n        cslots.forEach(slot => {\n            y = slot.top() - top;\n            ctx.lineTo(w - r - shift, y);\n            ctx.stroke();\n            ctx.beginPath();\n            ctx.moveTo(w - r - shift, y + slot.height());\n        });\n        ctx.lineTo(w - r - shift, h - shift);\n        ctx.stroke();\n    } else {\n        // end of top edge\n        ctx.lineTo(w - r, shift);\n        ctx.closePath();\n        ctx.stroke();\n\n        // top diagonal slope right\n        gradient = ctx.createLinearGradient(\n            w - r,\n            0,\n            w + r,\n            0\n        );\n        gradient.addColorStop(0, this.cachedClr);\n        gradient.addColorStop(1, this.cachedClrDark);\n        ctx.strokeStyle = gradient;\n        ctx.beginPath();\n        ctx.moveTo(w - shift, h2);\n        ctx.lineTo(w - r, shift);\n        ctx.closePath();\n        ctx.stroke();\n\n        // bottom diagonal slope right\n        gradient = ctx.createLinearGradient(\n            w - r,\n            0,\n            w,\n            0\n        );\n        gradient.addColorStop(0, this.cachedClr);\n        gradient.addColorStop(1, this.cachedClrDark);\n        ctx.strokeStyle = gradient;\n        ctx.beginPath();\n        ctx.moveTo(w - r, h - shift);\n        ctx.lineTo(w - shift, h2);\n        ctx.closePath();\n        ctx.stroke();\n    }\n\n    // bottom edge: straight line\n    gradient = ctx.createLinearGradient(\n        0,\n        h - this.edge,\n        0,\n        h\n    );\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrDark);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r + shift, h - shift);\n    ctx.lineTo(w - r - shift, h - shift);\n    ctx.closePath();\n    ctx.stroke();\n};\n\n// RingMorph /////////////////////////////////////////////////////////////\n\n/*\n    I am a reporter block which reifies its contents, my outer shape is\n    always roundish (never diamond)\n*/\n\n// RingMorph inherits from ReporterBlockMorph:\n\nRingMorph.prototype = new ReporterBlockMorph();\nRingMorph.prototype.constructor = RingMorph;\nRingMorph.uber = ReporterBlockMorph.prototype;\n\n// RingMorph preferences settings:\n\nRingMorph.prototype.isCachingInputs = false;\n// RingMorph.prototype.edge = 2;\n// RingMorph.prototype.rounding = 9;\n// RingMorph.prototype.alpha = 0.8;\n// RingMorph.prototype.contrast = 85;\n\n// RingMorph instance creation:\n\nexport function RingMorph() {\n    this.init();\n}\n\nRingMorph.prototype.init = function () {\n    RingMorph.uber.init.call(this);\n    this.category = 'other';\n    this.contrast = RingMorph.prototype.contrast;\n    this.setExtent(new Point(200, 80));\n};\n\n// RingMorph drawing\n\nRingMorph.prototype.render = function (ctx) {\n    var slot = this.inputs()[0],\n        pos = this.position();\n\n    this.cachedClr = this.color.toString();\n    this.cachedClrBright = this.bright();\n    this.cachedClrDark = this.dark();\n\n    if (MorphicPreferences.isFlat) {\n        // draw the outer filled shape\n        // draw the outline\n        ctx.fillStyle = this.cachedClrDark;\n        ctx.beginPath();\n        this.outlinePath(ctx, 0);\n\n        // render the hole:\n        slot.outlinePath(ctx, slot.position().subtract(pos));\n\n        // ctx.closePath();\n        ctx.clip('evenodd');\n        ctx.fillRect(0, 0, this.width(), this.height());\n\n        // draw the inner filled shaped\n        // draw the outline\n        ctx.fillStyle = this.cachedClr;\n        ctx.beginPath();\n        this.outlinePath(ctx, this.flatEdge);\n\n        // render the hole:\n        slot.outlinePath(ctx, slot.position().subtract(pos));\n\n        // ctx.closePath();\n        ctx.clip('evenodd');\n        ctx.fillRect(0, 0, this.width(), this.height());\n    } else {\n        // draw the flat shape\n        // draw the outline\n        ctx.fillStyle = this.cachedClr;\n        ctx.beginPath();\n        this.outlinePath(ctx, 0);\n\n        // render the hole:\n        slot.outlinePath(ctx, slot.position().subtract(pos));\n\n        // ctx.closePath();\n        ctx.clip('evenodd');\n        ctx.fillRect(0, 0, this.width(), this.height());\n\n        // add 3D-Effect:\n        this.drawEdges(ctx);\n    }\n};\n\n// RingMorph dragging and dropping\n\nRingMorph.prototype.rootForGrab = function () {\n    if (this.isDraggable) {\n        return this;\n    }\n    return BlockMorph.uber.rootForGrab.call(this);\n};\n\n// RingMorph ops - Note: these assume certain layouts defined elsewhere -\n\nRingMorph.prototype.embed = function (aBlock, inputNames, noVanish) {\n    var slot;\n\n    // set my color\n    this.color = SpriteMorph.prototype.blockColor.other;\n    this.isDraggable = true;\n\n    // set my type, selector, and nested block:\n    if (aBlock instanceof CommandBlockMorph) {\n        this.isStatic = false;\n        this.setSpec('%rc %ringparms');\n        this.selector = 'reifyScript';\n        slot = this.parts()[0];\n        slot.nestedBlock(aBlock);\n    } else if (aBlock.isPredicate) {\n        this.isStatic = true;\n        this.setSpec('%rp %ringparms');\n        this.selector = 'reifyPredicate';\n        slot = this.parts()[0];\n        slot.replaceInput(slot.contents(), aBlock);\n    } else if (aBlock instanceof BooleanSlotMorph) {\n        this.isStatic = false;\n        this.setSpec('%rp %ringparms');\n        this.selector = 'reifyPredicate';\n        slot = this.parts()[0];\n        slot.replaceInput(slot.contents(), aBlock);\n    } else { // reporter or input slot)\n        this.isStatic = false;\n        this.setSpec('%rr %ringparms');\n        this.selector = 'reifyReporter';\n        slot = this.parts()[0];\n        slot.replaceInput(slot.contents(), aBlock, noVanish);\n    }\n\n    // set my inputs, if any\n    slot = this.parts()[1];\n    if (inputNames) {\n        inputNames.forEach(name =>\n            slot.addInput(name)\n        );\n    }\n\n    // ensure zebra coloring\n    this.fixBlockColor(null, true);\n};\n\nRingMorph.prototype.vanishForSimilar = function () {\n    // let me disappear if I am nesting a variable getter or Ring\n    // but only if I'm not already inside another ring\n    var slot = this.parts()[0],\n        block = slot.nestedBlock();\n\n    if (!block) {return null; }\n    if (!(this.parent instanceof SyntaxElementMorph)) {return null; }\n    if (this.parent instanceof RingReporterSlotMorph\n            || (this.parent instanceof RingCommandSlotMorph)) {\n        return null;\n    }\n    if ((block.selector === 'reportGetVar' &&\n            !contains(this.inputNames(), block.blockSpec)) ||\n        // block.selector === 'reportListItem' ||\n        block.selector === 'reportJSFunction' ||\n        block.selector === 'reportAttributeOf' ||\n        block.selector === 'reportCompiled' ||\n        (block instanceof RingMorph)\n    ) {\n        this.parent.replaceInput(this, block);\n    }\n};\n\nRingMorph.prototype.contents = function () {\n    return this.parts()[0].nestedBlock();\n};\n\nRingMorph.prototype.inputNames = function () {\n    return this.parts()[1].evaluate();\n};\n\nRingMorph.prototype.dataType = function () {\n    switch (this.selector) {\n    case 'reifyScript':\n        return 'command';\n    case 'reifyPredicate':\n        return 'predicate';\n    default:\n        return 'reporter';\n    }\n};\n\n// RingMorph zebra coloring\n\nRingMorph.prototype.fixBlockColor = function (nearest, isForced) {\n    var slot = this.parts()[0];\n    RingMorph.uber.fixBlockColor.call(this, nearest, isForced);\n    slot.fixLayout();\n};\n\n// ScriptsMorph ////////////////////////////////////////////////////////\n\n/*\n    I give feedback about possible drop targets and am in charge\n    of actually snapping blocks together.\n\n    My children are the top blocks of scripts.\n\n    I store a back-pointer to my owner, i.e. the object (sprite)\n    to whom my scripts apply.\n*/\n\n// ScriptsMorph inherits from FrameMorph:\n\nScriptsMorph.prototype = new FrameMorph();\nScriptsMorph.prototype.constructor = ScriptsMorph;\nScriptsMorph.uber = FrameMorph.prototype;\n\n// ScriptsMorph preference settings\n\nScriptsMorph.prototype.cleanUpMargin = 20;\nScriptsMorph.prototype.cleanUpSpacing = 15;\nScriptsMorph.prototype.isPreferringEmptySlots = true;\nScriptsMorph.prototype.enableKeyboard = true;\nScriptsMorph.prototype.enableNestedAutoWrapping = true;\nScriptsMorph.prototype.feedbackColor = WHITE;\n\n// ScriptsMorph instance creation:\n\nexport function ScriptsMorph() {\n    this.init();\n}\n\nScriptsMorph.prototype.init = function () {\n    this.feedbackMorph = new BoxMorph();\n    this.rejectsHats = false;\n\n    // \"undrop\" attributes:\n    this.lastDroppedBlock = null;\n    this.lastReplacedInput = null;\n    this.lastDropTarget = null;\n    this.lastPreservedBlocks = null;\n    this.lastNextBlock = null;\n    this.lastWrapParent = null;\n\n    // keyboard editing support:\n    this.focus = null;\n\n    ScriptsMorph.uber.init.call(this);\n    this.setColor(new Color(70, 70, 70));\n\n    // initialize \"undrop\" queue\n    this.isAnimating = false;\n    this.dropRecord = null;\n    this.recordDrop();\n};\n\n// ScriptsMorph deep copying:\n\nScriptsMorph.prototype.fullCopy = function () {\n    var cpy = new ScriptsMorph(),\n        pos = this.position(),\n        child;\n    if (this.focus) {\n        this.focus.stopEditing();\n    }\n    this.children.forEach(morph => {\n        if (!morph.block) { // omit anchored comments\n            child = morph.fullCopy();\n            cpy.add(child);\n            child.setPosition(morph.position().subtract(pos));\n            if (child instanceof BlockMorph) {\n                child.allComments().forEach(comment =>\n                    comment.align(child)\n                );\n            }\n        }\n    });\n    cpy.adjustBounds();\n    return cpy;\n};\n\n// ScriptsMorph rendering:\n\nScriptsMorph.prototype.render = function (aContext) {\n    aContext.fillStyle = this.getRenderColor().toString();\n    aContext.fillRect(0, 0, this.width(), this.height());\n    if (this.cachedTexture) {\n        this.renderCachedTexture(aContext);\n    } else if (this.texture) {\n        this.renderTexture(this.texture, aContext);\n    }\n};\n\nScriptsMorph.prototype.getRenderColor = function () {\n    if (MorphicPreferences.isFlat ||\n            SyntaxElementMorph.prototype.alpha > 0.85) {\n        return this.color;\n    }\n    return this.color.mixed(\n        Math.max(SyntaxElementMorph.prototype.alpha - 0.15, 0),\n        SpriteMorph.prototype.paletteColor\n    );\n};\n\nScriptsMorph.prototype.renderCachedTexture = function (ctx) {\n    // support blocks-to-text slider\n    if (SyntaxElementMorph.prototype.alpha > 0.8) {\n        ScriptsMorph.uber.renderCachedTexture.call(this, ctx);\n    }\n};\n\n// ScriptsMorph stepping:\n\nScriptsMorph.prototype.step = function () {\n    var world = this.world(),\n        hand = world.hand,\n        block;\n\n    if (this.feedbackMorph.parent) {\n        this.feedbackMorph.destroy();\n        this.feedbackMorph.parent = null;\n    }\n    if (this.focus && (!world.keyboardFocus ||\n            world.keyboardFocus instanceof StageMorph)) {\n        this.focus.getFocus(world);\n    }\n    if (hand.children.length === 0) {\n        return null;\n    }\n    if (!this.bounds.containsPoint(hand.bounds.origin)) {\n        return null;\n    }\n    block = hand.children[0];\n    if (!(block instanceof BlockMorph) && !(block instanceof CommentMorph)) {\n        return null;\n    }\n    if (!contains(hand.morphAtPointer().allParents(), this)) {\n        return null;\n    }\n    if (block instanceof CommentMorph) {\n        this.showCommentDropFeedback(block, hand);\n    } else if (block instanceof ReporterBlockMorph) {\n        this.showReporterDropFeedback(block, hand);\n    } else {\n        this.showCommandDropFeedback(block);\n    }\n};\n\nScriptsMorph.prototype.showReporterDropFeedback = function (block, hand) {\n    var target = this.closestInput(block, hand);\n    this.showReporterDropFeedbackFromTarget(block, target);\n};\n\nScriptsMorph.prototype.showReporterDropFeedbackFromTarget = function (block,\n        target) {\n    if (target === null) {\n        return null;\n    }\n    this.feedbackMorph.bounds = target.fullBounds()\n        .expandBy(Math.max(\n            block.edge * 2,\n            block.reporterDropFeedbackPadding\n        ));\n    this.feedbackMorph.edge = SyntaxElementMorph.prototype.rounding;\n    this.feedbackMorph.border = Math.max(\n        SyntaxElementMorph.prototype.edge,\n        3\n    );\n    this.add(this.feedbackMorph);\n    if (target instanceof MultiArgMorph) {\n        this.feedbackMorph.color =\n            SpriteMorph.prototype.blockColor.lists.copy();\n        this.feedbackMorph.borderColor =\n            SpriteMorph.prototype.blockColor.lists;\n    } else {\n        this.feedbackMorph.color = this.feedbackColor.copy();\n        this.feedbackMorph.borderColor = this.feedbackColor;\n    }\n    this.feedbackMorph.color.a = 0.5;\n    this.feedbackMorph.rerender();\n};\n\nScriptsMorph.prototype.showCommandDropFeedback = function (block) {\n    var y, target;\n\n    target = block.closestAttachTarget(this);\n    if (!target) {\n        return null;\n    }\n    if (target.loc === 'wrap') {\n        this.showCSlotWrapFeedback(block, target.element);\n        return;\n    }\n    this.add(this.feedbackMorph);\n    this.feedbackMorph.border = 0;\n    this.feedbackMorph.edge = 0;\n    this.feedbackMorph.alpha = 1;\n    this.feedbackMorph.bounds.setWidth(target.element.width());\n    this.feedbackMorph.bounds.setHeight(Math.max(\n            SyntaxElementMorph.prototype.corner,\n            SyntaxElementMorph.prototype.feedbackMinHeight\n        )\n    );\n    this.feedbackMorph.color = this.feedbackColor;\n    y = target.point.y;\n    if (target.loc === 'bottom') {\n        if (target.type === 'block') {\n            if (target.element.nextBlock()) {\n                y -= SyntaxElementMorph.prototype.corner;\n            }\n        } else if (target.type === 'slot') {\n            if (target.element.nestedBlock()) {\n                y -= SyntaxElementMorph.prototype.corner;\n            }\n        }\n    }\n    this.feedbackMorph.setPosition(new Point(\n        target.element.left(),\n        y\n    ));\n};\n\nScriptsMorph.prototype.showCommentDropFeedback = function (comment, hand) {\n    var target = this.closestBlock(comment, hand);\n    if (!target) {\n        return null;\n    }\n\n    this.feedbackMorph.bounds = target.bounds\n        .expandBy(Math.max(\n            BlockMorph.prototype.edge * 2,\n            BlockMorph.prototype.reporterDropFeedbackPadding\n        ));\n    this.feedbackMorph.edge = SyntaxElementMorph.prototype.rounding;\n    this.feedbackMorph.border = Math.max(\n        SyntaxElementMorph.prototype.edge,\n        3\n    );\n    this.add(this.feedbackMorph);\n    this.feedbackMorph.color = comment.color.copy();\n    this.feedbackMorph.color.a = 0.25;\n    this.feedbackMorph.borderColor = comment.titleBar.color;\n    this.feedbackMorph.rerender();\n};\n\nScriptsMorph.prototype.showCSlotWrapFeedback = function (srcBlock, trgBlock) {\n    var clr;\n    this.feedbackMorph.bounds = trgBlock.fullBounds()\n        .expandBy(BlockMorph.prototype.corner);\n    this.feedbackMorph.edge = SyntaxElementMorph.prototype.corner;\n    this.feedbackMorph.border = Math.max(\n        SyntaxElementMorph.prototype.edge,\n        3\n    );\n    this.add(this.feedbackMorph);\n    clr = srcBlock.color.lighter(40);\n    this.feedbackMorph.color = clr.copy();\n    this.feedbackMorph.color.a = 0.1;\n    this.feedbackMorph.borderColor = clr;\n    this.feedbackMorph.rerender();\n};\n//\n// ScriptsMorph.prototype.closestInput = function (reporter, hand) {\n//     // passing the hand is optional (when dragging reporters)\n//     var fb = reporter.fullBoundsNoShadow(),\n//         stacks = this.children.filter(child =>\n//             (child instanceof BlockMorph) &&\n//                 (child.fullBounds().intersects(fb))\n//         ),\n//         blackList = reporter.allInputs(),\n//         handPos,\n//         target,\n//         all;\n//\n//     all = [];\n//     stacks.forEach(stack =>\n//         all = all.concat(stack.allInputs())\n//     );\n//     if (all.length === 0) {return null; }\n//\n//     function touchingVariadicArrowsIfAny(inp, point) {\n//         if (inp instanceof MultiArgMorph) {\n//             if (point) {\n//                 return inp.arrows().bounds.containsPoint(point);\n//             }\n//             return inp.arrows().bounds.intersects(fb);\n//         }\n//         return true;\n//     }\n//\n//     if (this.isPreferringEmptySlots) {\n//         if (hand) {\n//             handPos = hand.position();\n//             target = detect(\n//                 all,\n//                 input => (input instanceof InputSlotMorph ||\n//                         (input instanceof ArgMorph &&\n//                             !(input instanceof CommandSlotMorph) &&\n//                             !(input instanceof MultiArgMorph)\n//                         ) ||\n//                         (input instanceof RingMorph && !input.contents()) ||\n//                         input.isEmptySlot()\n//                     ) &&\n//                         !input.isLocked() &&\n//                             input.bounds.containsPoint(handPos) &&\n//                                 !contains(blackList, input)\n//             );\n//             if (target) {\n//                 return target;\n//             }\n//         }\n//         target = detect(\n//             all,\n//             input => (input instanceof InputSlotMorph ||\n//                     input instanceof ArgMorph ||\n//                     (input instanceof RingMorph && !input.contents()) ||\n//                     input.isEmptySlot()\n//                 ) &&\n//                     !input.isLocked() &&\n//                         input.bounds.intersects(fb) &&\n//                             !contains(blackList, input) &&\n//                                 touchingVariadicArrowsIfAny(input, handPos)\n//         );\n//         if (target) {\n//             return target;\n//         }\n//     }\n//\n//     if (hand) {\n//         handPos = hand.position();\n//         target = detect(\n//             all,\n//             input => (input !== reporter) &&\n//                 !input.isLocked() &&\n//                     input.bounds.containsPoint(handPos) &&\n//                         !(input.parent instanceof PrototypeHatBlockMorph) &&\n//                             !contains(blackList, input) &&\n//                                 touchingVariadicArrowsIfAny(input, handPos)\n//         );\n//         if (target) {\n//             return target;\n//         }\n//     }\n//     return detect(\n//         all,\n//         input => (input !== reporter) &&\n//             !input.isLocked() &&\n//                 input.fullBounds().intersects(fb) &&\n//                     !(input.parent instanceof PrototypeHatBlockMorph) &&\n//                         !contains(blackList, input) &&\n//                             touchingVariadicArrowsIfAny(input)\n//     );\n// };\n\nScriptsMorph.prototype.closestBlock = function (comment, hand) {\n    // passing the hand is optional (when dragging comments)\n    var fb = comment.bounds,\n        stacks = this.children.filter(child =>\n            (child instanceof BlockMorph) &&\n                (child.fullBounds().intersects(fb))\n        ),\n        handPos,\n        target,\n        all;\n\n    all = [];\n    stacks.forEach(stack => {\n        all = all.concat(stack.allChildren().slice(0).reverse().filter(\n            child => child instanceof BlockMorph && !child.isTemplate\n        ));\n    });\n    if (all.length === 0) {return null; }\n\n    if (hand) {\n        handPos = hand.position();\n        target = detect(\n            all,\n            block => !block.comment &&\n                !block.isPrototype &&\n                    block.bounds.containsPoint(handPos)\n        );\n        if (target) {\n            return target;\n        }\n    }\n    return detect(\n        all,\n        block => !block.comment &&\n            !block.isPrototype &&\n                block.bounds.intersects(fb)\n    );\n};\n\n// ScriptsMorph user menu\n\nScriptsMorph.prototype.userMenu = function () {\n    var menu = new MenuMorph(this),\n        ide = this.parentThatIsA(IDE_Morph),\n        shiftClicked = this.world().currentKey === 16,\n        blockEditor,\n        obj = this.scriptTarget(),\n        hasUndropQueue,\n        stage = obj.parentThatIsA(StageMorph);\n\n    function addOption(label, toggle, test, onHint, offHint) {\n        menu.addItem(\n            [\n                test ? new SymbolMorph(\n                    'checkedBox',\n                    MorphicPreferences.menuFontSize * 0.75\n                ) : new SymbolMorph(\n                    'rectangle',\n                    MorphicPreferences.menuFontSize * 0.75\n                ),\n                localize(label)\n            ],\n            toggle,\n            test ? onHint : offHint\n        );\n    }\n\n    if (!ide) {\n        blockEditor = this.parentThatIsA(BlockEditorMorph);\n        if (blockEditor) {\n            ide = blockEditor.target.parentThatIsA(IDE_Morph);\n        }\n    }\n\n    if (this.dropRecord) {\n        if (this.dropRecord.lastRecord) {\n            hasUndropQueue = true;\n            menu.addPair(\n                [\n                    new SymbolMorph(\n                        'turnBack',\n                        MorphicPreferences.menuFontSize\n                    ),\n                    localize('undrop')\n                ],\n                'undrop',\n                '^Z',\n                'undo the last\\nblock drop\\nin this pane'\n            );\n        }\n        if (this.dropRecord.nextRecord) {\n            hasUndropQueue = true;\n            menu.addPair(\n                [\n                    new SymbolMorph(\n                        'turnForward',\n                        MorphicPreferences.menuFontSize\n                    ),\n                    localize('redrop')\n                ],\n                'redrop',\n                '^Y',\n                'redo the last undone\\nblock drop\\nin this pane'\n            );\n        }\n        if (hasUndropQueue) {\n            if (shiftClicked) {\n                menu.addItem(\n                    \"clear undrop queue\",\n                    () => {\n                        this.dropRecord = null;\n                        this.clearDropInfo();\n                        this.recordDrop();\n                    },\n                    'forget recorded block drops\\non this pane',\n                    new Color(100, 0, 0)\n                );\n            }\n            menu.addLine();\n        }\n    }\n\n    menu.addItem('clean up', 'cleanUp', 'arrange scripts\\nvertically');\n    menu.addItem('add comment', 'addComment');\n    menu.addItem(\n        'scripts pic...',\n        'exportScriptsPicture',\n        'save a picture\\nof all scripts'\n    );\n    if (ide) {\n        menu.addLine();\n        if (!blockEditor && obj.exemplar) {\n            addOption(\n                'inherited',\n                () => obj.toggleInheritanceForAttribute('scripts'),\n                obj.inheritsAttribute('scripts'),\n                'uncheck to\\ndisinherit',\n                localize('check to inherit\\nfrom')\n                    + ' ' + obj.exemplar.name\n            );\n        }\n        menu.addItem(\n            'make a block...',\n            () => new BlockDialogMorph(\n                null,\n                definition => {\n                    if (definition.spec !== '') {\n                        if (definition.isGlobal) {\n                            stage.globalBlocks.push(definition);\n                        } else {\n                            obj.customBlocks.push(definition);\n                        }\n                        ide.flushPaletteCache();\n                        ide.refreshPalette();\n                        new BlockEditorMorph(definition, obj).popUp();\n                    }\n                },\n                this\n            ).prompt(\n                'Make a block',\n                null,\n                this.world()\n            )\n        );\n    }\n    return menu;\n};\n\n// ScriptsMorph user menu features:\n\n// ScriptsMorph.prototype.cleanUp = function (silently) {\n//     if (!silently) {\n//         // Trace.log('Scripts.cleanUp');\n//     }\n//     var target = this.selectForEdit(), // enable copy-on-edit\n//         origin = target.topLeft(),\n//         y = target.cleanUpMargin;\n//     target.children.sort((a, b) =>\n//         // make sure the prototype hat block always stays on top\n//         a instanceof PrototypeHatBlockMorph ? 0 : a.top() - b.top()\n//     ).forEach(child => {\n//         if (child instanceof CommentMorph && child.block) {\n//             return; // skip anchored comments\n//         }\n//         child.setPosition(origin.add(new Point(target.cleanUpMargin, y)));\n//         if (child instanceof BlockMorph) {\n//             child.allComments().forEach(comment =>\n//                 comment.align(child, true) // ignore layer\n//             );\n//         }\n//         y += child.stackHeight() + target.cleanUpSpacing;\n//     });\n//     if (target.parent) {\n//         target.setPosition(target.parent.topLeft());\n//     }\n//     target.adjustBounds();\n// };\n\nScriptsMorph.prototype.exportScriptsPicture = function () {\n    // Trace.log('Scripts.exportPicture');\n    var pic = this.scriptsPicture(),\n        ide = this.world().children[0];\n    if (pic) {\n        ide.saveCanvasAs(\n            pic,\n            (ide.projectName || localize('untitled')) + ' ' +\n                localize('script pic')\n        );\n    }\n};\n\nScriptsMorph.prototype.scriptsPicture = function () {\n    // private - answer a canvas containing the pictures of all scripts\n    var boundingBox, pic, ctx;\n    if (this.children.length === 0) {return; }\n    boundingBox = this.children[0].fullBounds();\n    this.children.forEach(child => {\n        if (child.isVisible) {\n            boundingBox = boundingBox.merge(child.fullBounds());\n        }\n    });\n    pic = newCanvas(boundingBox.extent());\n    ctx = pic.getContext('2d');\n    this.children.forEach(child => {\n        var pos = child.fullBounds().origin;\n        if (child.isVisible) {\n            ctx.drawImage(\n                child.fullImage(),\n                pos.x - boundingBox.origin.x,\n                pos.y - boundingBox.origin.y\n            );\n        }\n    });\n    return pic;\n};\n\nScriptsMorph.prototype.addComment = function () {\n    var ide = this.parentThatIsA(IDE_Morph),\n        blockEditor = this.parentThatIsA(BlockEditorMorph),\n        world = this.world();\n    new CommentMorph().pickUp(world);\n    // register the drop-origin, so the element can\n    // slide back to its former situation if dropped\n    // somewhere where it gets rejected\n    if (!ide && blockEditor) {\n        ide = blockEditor.target.parentThatIsA(IDE_Morph);\n    }\n    if (ide) {\n        world.hand.grabOrigin = {\n            origin: ide.palette,\n            position: ide.palette.center()\n        };\n    }\n};\n\n// ScriptsMorph undrop / redrop\n\nScriptsMorph.prototype.undrop = function () {\n    if (this.isAnimating) {return; }\n    if (!this.dropRecord || !this.dropRecord.lastRecord) {return; }\n    // Trace.log('Scripts.undrop', {\n    //     'action': this.dropRecord.action,\n    //     'block': this.dropRecord.lastDroppedBlock.blockId()\n    // });\n    if (!this.dropRecord.situation) {\n        this.dropRecord.situation =\n            this.dropRecord.lastDroppedBlock.situation();\n    }\n    this.isAnimating = true;\n    this.dropRecord.lastDroppedBlock.slideBackTo(\n        this.dropRecord.lastOrigin,\n        null,\n        this.recoverLastDrop(),\n        () => {\n            this.updateToolbar();\n            this.isAnimating = false;\n        }\n    );\n    this.dropRecord = this.dropRecord.lastRecord;\n};\n\nScriptsMorph.prototype.redrop = function () {\n    if (this.isAnimating) {return; }\n    if (!this.dropRecord || !this.dropRecord.nextRecord) {return; }\n    this.dropRecord = this.dropRecord.nextRecord;\n    // Trace.log('Scripts.redrop', {\n    //     'action': this.dropRecord.action,\n    //     'block': this.dropRecord.lastDroppedBlock.blockId()\n    // });\n    if (this.dropRecord.action === 'delete') {\n        this.recoverLastDrop(true);\n        this.dropRecord.lastDroppedBlock.destroy();\n        this.updateToolbar();\n    } else {\n        this.isAnimating = true;\n        if (this.dropRecord.action === 'extract') {\n            this.dropRecord.lastDroppedBlock.extract();\n        }\n        this.dropRecord.lastDroppedBlock.slideBackTo(\n            this.dropRecord.situation,\n            null,\n            this.recoverLastDrop(true),\n            () => {\n                this.updateToolbar();\n                this.isAnimating = false;\n            }\n        );\n    }\n};\n\nScriptsMorph.prototype.recoverLastDrop = function (forRedrop) {\n    // retrieve the block last touched by the user and answer a function\n    // to be called after the animation that moves it back right before\n    // dropping it into its former situation\n    var rec = this.dropRecord,\n        dropped,\n        onBeforeDrop,\n        parent;\n\n    if (!rec || !rec.lastDroppedBlock) {\n        throw new Error('nothing to undrop');\n    }\n    dropped = rec.lastDroppedBlock;\n    parent = dropped.parent;\n    if (dropped instanceof CommandBlockMorph) {\n        if (rec.lastNextBlock) {\n            if (rec.action === 'delete') {\n                if (forRedrop) {\n                    this.add(rec.lastNextBlock);\n                }\n            } else {\n                this.add(rec.lastNextBlock);\n            }\n        }\n        if (rec.lastDropTarget) {\n            if (rec.lastDropTarget.loc === 'bottom') {\n                if (rec.lastDropTarget.type === 'slot') {\n                    if (rec.lastNextBlock) {\n                        rec.lastDropTarget.element.nestedBlock(\n                            rec.lastNextBlock\n                        );\n                    }\n                } else { // 'block'\n                    if (rec.lastNextBlock) {\n                        rec.lastDropTarget.element.nextBlock(\n                            rec.lastNextBlock\n                        );\n                    }\n                }\n            } else if (rec.lastDropTarget.loc === 'top') {\n                this.add(rec.lastDropTarget.element);\n            } else if (rec.lastDropTarget.loc === 'wrap') {\n                var cslot = detect( // could be cached...\n                    rec.lastDroppedBlock.inputs(), // ...although these are\n                    each => each instanceof CSlotMorph\n                );\n                if (rec.lastWrapParent instanceof CommandBlockMorph) {\n                    if (forRedrop) {\n                        onBeforeDrop = () =>\n                            cslot.nestedBlock(rec.lastDropTarget.element);\n                    } else {\n                        rec.lastWrapParent.nextBlock(\n                            rec.lastDropTarget.element\n                        );\n                    }\n                } else if (rec.lastWrapParent instanceof CommandSlotMorph) {\n                    if (forRedrop) {\n                        onBeforeDrop = () =>\n                            cslot.nestedBlock(rec.lastDropTarget.element);\n                    } else {\n                        rec.lastWrapParent.nestedBlock(\n                            rec.lastDropTarget.element\n                        );\n                    }\n                } else {\n                    this.add(rec.lastDropTarget.element);\n                }\n\n                // fix zebra coloring.\n                // this could be generalized into the fixBlockColor mechanism\n                rec.lastDropTarget.element.blockSequence().forEach(cmd =>\n                    cmd.fixBlockColor()\n                );\n                cslot.fixLayout();\n            }\n        }\n    } else if (dropped instanceof ReporterBlockMorph) {\n        if (rec.lastDropTarget) {\n            if (forRedrop) {\n                rec.lastDropTarget.replaceInput(\n                    rec.lastReplacedInput,\n                    rec.lastDroppedBlock\n                );\n            } else {\n                rec.lastDropTarget.replaceInput(\n                    rec.lastDroppedBlock,\n                    rec.lastReplacedInput\n                );\n            }\n            rec.lastDropTarget.fixBlockColor(null, true);\n            if (rec.lastPreservedBlocks) {\n                rec.lastPreservedBlocks.forEach(morph =>\n                    morph.destroy()\n                );\n            }\n        }\n    } else if (dropped instanceof CommentMorph) {\n        if (forRedrop && rec.lastDropTarget) {\n            onBeforeDrop = () => {\n                rec.lastDropTarget.element.comment = dropped;\n                dropped.block = rec.lastDropTarget.element;\n                dropped.align();\n            };\n        }\n    } else {\n        throw new Error('unsupported action for ' + dropped);\n    }\n    this.clearDropInfo();\n    dropped.prepareToBeGrabbed(this.world().hand);\n    if (dropped instanceof CommentMorph) {\n        dropped.removeShadow();\n    }\n    this.add(dropped);\n    parent.reactToGrabOf(dropped);\n    if (dropped instanceof ReporterBlockMorph && parent instanceof BlockMorph) {\n        parent.changed();\n    }\n    if (rec.action === 'delete') {\n        if (forRedrop && rec.lastNextBlock) {\n            if (parent instanceof CommandBlockMorph) {\n                parent.nextBlock(rec.lastNextBlock);\n            } else if (parent instanceof CommandSlotMorph) {\n                parent.nestedBlock(rec.lastNextBlock);\n            }\n        }\n\n        // animate \"undelete\"\n        if (!forRedrop) {\n            dropped.moveBy(new Point(-100, -20));\n        }\n    }\n    return onBeforeDrop;\n};\n\nScriptsMorph.prototype.clearDropInfo = function () {\n    this.lastDroppedBlock = null;\n    this.lastReplacedInput = null;\n    this.lastDropTarget = null;\n    this.lastPreservedBlocks = null;\n    this.lastNextBlock = null;\n    this.lastWrapParent = null;\n};\n\nScriptsMorph.prototype.recordDrop = function (lastGrabOrigin) {\n    // support for \"undrop\" / \"redrop\"\n     var record = {\n        lastDroppedBlock: this.lastDroppedBlock,\n        lastReplacedInput: this.lastReplacedInput,\n        lastDropTarget: this.lastDropTarget,\n        lastPreservedBlocks: this.lastPreservedBlocks,\n        lastNextBlock: this.lastNextBlock,\n        lastWrapParent: this.lastWrapParent,\n        lastOrigin: lastGrabOrigin,\n\n        // for special gestures, e.g. deleting or extracting single commands:\n        action: lastGrabOrigin ? lastGrabOrigin.action || null : null,\n\n        situation: null,\n        lastRecord: this.dropRecord,\n        nextRecord: null\n    };\n    if (this.dropRecord) {\n        this.dropRecord.nextRecord = record;\n    }\n    this.dropRecord = record;\n    this.updateToolbar();\n};\n\nScriptsMorph.prototype.addToolbar = function () {\n    var toolBar = new AlignmentMorph(),\n        shade = new Color(140, 140, 140);\n\n    toolBar.respectHiddens = true;\n    toolBar.undoButton = new PushButtonMorph(\n        this,\n        \"undrop\",\n        new SymbolMorph(\"turnBack\", 12)\n    );\n    toolBar.undoButton.alpha = 0.2;\n    toolBar.undoButton.padding = 4;\n    // toolBar.undoButton.hint = 'undo the last\\nblock drop\\nin this pane';\n    toolBar.undoButton.labelShadowColor = shade;\n    toolBar.undoButton.edge = 0;\n    toolBar.undoButton.fixLayout();\n    toolBar.add(toolBar.undoButton);\n\n    toolBar.redoButton = new PushButtonMorph(\n        this,\n        \"redrop\",\n        new SymbolMorph(\"turnForward\", 12)\n    );\n    toolBar.redoButton.alpha = 0.2;\n    toolBar.redoButton.padding = 4;\n    // toolBar.redoButton.hint = 'redo the last undone\\nblock drop\\nin this pane';\n    toolBar.redoButton.labelShadowColor = shade;\n    toolBar.redoButton.edge = 0;\n    toolBar.redoButton.fixLayout();\n    toolBar.add(toolBar.redoButton);\n\n    toolBar.keyboardButton = new ToggleButtonMorph(\n    \tnull, // colors\n        this, // target\n        \"toggleKeyboardEntry\",\n        [\n            new SymbolMorph('keyboard', 12),\n            new SymbolMorph('keyboardFilled', 12)\n        ],\n\t\t() => !isNil(this.focus) // query\n    );\n    toolBar.keyboardButton.alpha = 0.2;\n    toolBar.keyboardButton.padding = 4;\n    toolBar.keyboardButton.edge = 0;\n    toolBar.keyboardButton.hint = 'use the keyboard\\nto enter blocks';\n    //toolBar.keyboardButton.pressColor = new Color(40, 40, 40);\n    toolBar.keyboardButton.labelShadowColor = shade;\n    toolBar.keyboardButton.fixLayout();\n    toolBar.add(toolBar.keyboardButton);\n\n    return toolBar;\n};\n\nScriptsMorph.prototype.updateToolbar = function () {\n    var sf = this.parentThatIsA(ScrollFrameMorph);\n    if (!sf) {return; }\n    if (!sf.toolBar) {\n        sf.toolBar = this.addToolbar();\n        sf.add(sf.toolBar);\n    }\n    if (this.enableKeyboard) {\n    \tsf.toolBar.keyboardButton.show();\n    \tsf.toolBar.keyboardButton.refresh();\n    } else {\n        sf.toolBar.keyboardButton.hide();\n    }\n    if (this.dropRecord) {\n        if (this.dropRecord.lastRecord) {\n            if (!sf.toolBar.undoButton.isVisible) {\n                sf.toolBar.undoButton.show();\n            }\n        } else {\n            if (sf.toolBar.undoButton.isVisible) {\n                sf.toolBar.undoButton.hide();\n            }\n        }\n        if (this.dropRecord.nextRecord) {\n            if (!sf.toolBar.redoButton.isVisible) {\n                sf.toolBar.redoButton.show();\n                sf.toolBar.undoButton.mouseLeave();\n            }\n        } else {\n            if (sf.toolBar.redoButton.isVisible) {\n                sf.toolBar.redoButton.hide();\n            }\n        }\n    }\n\tif (detect(\n\t\t\tsf.toolBar.children,\n            each => each.isVisible\n    )) {\n\t    sf.toolBar.fixLayout();\n\t    sf.adjustToolBar();\n\t}\n};\n\n// ScriptsMorph sorting blocks and comments\n\n// ScriptsMorph.prototype.sortedElements = function () {\n//     // return all scripts and unattached comments\n//     var scripts = this.children.filter(each =>\n//         each instanceof CommentMorph ? !each.block : true\n//     );\n//     scripts.sort((a, b) =>\n//         // make sure the prototype hat block always stays on top\n//         a instanceof PrototypeHatBlockMorph ? 0 : a.top() - b.top()\n//     );\n//     return scripts;\n// };\n\n// ScriptsMorph blocks layout fix\n\nScriptsMorph.prototype.fixMultiArgs = function () {\n    this.forAllChildren(morph => {\n        if (morph instanceof MultiArgMorph) {\n            morph.fixLayout();\n        }\n    });\n};\n\n// ScriptsMorph drag & drop:\n\nScriptsMorph.prototype.wantsDropOf = function (aMorph) {\n    // override the inherited method\n    if (aMorph instanceof HatBlockMorph) {\n        return !this.rejectsHats;\n    }\n    return aMorph instanceof SyntaxElementMorph ||\n        aMorph instanceof CommentMorph;\n};\n\nScriptsMorph.prototype.reactToDropOf = function (droppedMorph, hand) {\n    if (droppedMorph instanceof BlockMorph ||\n            droppedMorph instanceof CommentMorph) {\n        droppedMorph.snap(hand);\n    }\n    this.adjustBounds();\n};\n\n// ScriptsMorph events\n\nScriptsMorph.prototype.mouseClickLeft = function (pos) {\n    var shiftClicked = this.world().currentKey === 16;\n    if (shiftClicked) {\n        return this.edit(pos);\n    }\n    if (this.focus) {this.focus.stopEditing(); }\n};\n\nScriptsMorph.prototype.selectForEdit = function () {\n    var ide = this.parentThatIsA(IDE_Morph),\n        rcvr = ide ? ide.currentSprite : null;\n    if (rcvr && rcvr.inheritsAttribute('scripts')) {\n        // copy on write:\n        this.feedbackMorph.destroy();\n        rcvr.shadowAttribute('scripts');\n        return rcvr.scripts;\n    }\n    return this;\n};\n\n// ScriptsMorph keyboard support\n\nScriptsMorph.prototype.edit = function (pos) {\n    var target,\n\t\tworld = this.world();\n    if (this.focus) {this.focus.stopEditing(); }\n    world.stopEditing();\n    if (!ScriptsMorph.prototype.enableKeyboard) {return; }\n    target = this.selectForEdit(); // enable copy-on-edit\n    target.focus = new ScriptFocusMorph(target, target, pos);\n    target.focus.getFocus(world);\n};\n\nScriptsMorph.prototype.toggleKeyboardEntry = function () {\n\t// when the user clicks the keyboard button in the toolbar\n    var target, sorted,\n        world = this.world();\n    if (this.focus) {\n    \tthis.focus.stopEditing();\n        return;\n    }\n    world.stopEditing();\n    if (!ScriptsMorph.prototype.enableKeyboard) {return; }\n    target = this.selectForEdit(); // enable copy-on-edit\n    target.focus = new ScriptFocusMorph(target, target, target.position());\n    target.focus.getFocus(world);\n    sorted = target.focus.sortedScripts();\n    if (sorted.length) {\n        target.focus.element = sorted[0];\n        if (target.focus.element instanceof HatBlockMorph) {\n            target.focus.nextCommand();\n        }\n    } else {\n        target.focus.moveBy(new Point(50, 50));\n    }\n    target.focus.fixLayout();\n};\n\n// ScriptsMorph context - scripts target\n\nScriptsMorph.prototype.scriptTarget = function () {\n    // answer the sprite or stage that this script editor acts on,\n    // if the user clicks on a block.\n    // NOTE: since scripts can be shared by more than a single sprite\n    // this method only gives the desired result within the context of\n    // the user actively clicking on a block inside the IDE\n    // there is no direct relationship between a block or a scripts editor\n    //  and a sprite.\n    var editor = this.parentThatIsA(IDE_Morph);\n    if (editor) {\n        return editor.currentSprite;\n    }\n    editor = this.parentThatIsA(BlockEditorMorph);\n    if (editor) {\n        return editor.target;\n    }\n    throw new Error('script target cannot be found for orphaned scripts');\n};\n\n\n// ArgMorph //////////////////////////////////////////////////////////\n\n/*\n    I am a syntax element and the ancestor of all block inputs.\n    I am present in block labels.\n    Usually I am just a receptacle for inherited methods and attributes,\n    however, if my 'type' attribute is set to one of the following\n    values, I act as an iconic slot myself:\n\n        'list'      - a list symbol\n        'object'    - a turtle symbol\n*/\n\n// ArgMorph inherits from SyntaxElementMorph:\n\nArgMorph.prototype = new SyntaxElementMorph();\nArgMorph.prototype.constructor = ArgMorph;\nArgMorph.uber = SyntaxElementMorph.prototype;\n\n// ArgMorph instance creation:\n\nexport function ArgMorph(type) {\n    this.init(type);\n}\n\nArgMorph.prototype.init = function (type) {\n    this.type = type || null;\n    this.icon = null;\n    ArgMorph.uber.init.call(this);\n    this.color = new Color(0, 17, 173);\n    this.createIcon();\n    if (type === 'list') {\n        this.alpha = 1;\n    }\n};\n\n// Get a unique ID for the input slot represented by this ArgMorph\nArgMorph.prototype.argId = function() {\n    var block = this.parentThatIsA(BlockMorph);\n    if (!block) return null;\n    // Get the index of this arg out of all the parent's args\n    var index = this.parent.children.filter(function(child) {\n        return child instanceof ArgMorph;\n    }).indexOf(this);\n    var id = block.blockId();\n    id.argIndex = index;\n    return id;\n};\n\n// ArgMorph preferences settings:\n\nArgMorph.prototype.executeOnSliderEdit = false;\n\n// ArgMorph events:\n\n// ArgMorph.prototype.reactToSliderEdit = function () {\n// /*\n//     directly execute the stack of blocks I'm part of if my\n//     \"executeOnSliderEdit\" setting is turned on, obeying the stage's\n//     thread safety setting. This feature allows for \"Bret Victor\" style\n//     interactive coding.\n// */\n//     var block, top, receiver, stage;\n//     if (!this.executeOnSliderEdit) {return; }\n//     block = this.parentThatIsA(BlockMorph);\n//     if (block) {\n//         top = block.topBlock();\n//         receiver = top.scriptTarget();\n//         if (top instanceof PrototypeHatBlockMorph) {\n//             return;\n//         }\n//         if (receiver) {\n//             stage = receiver.parentThatIsA(StageMorph);\n//             if (stage && (stage.isThreadSafe ||\n//                     Process.prototype.enableSingleStepping)) {\n//                 stage.threads.startProcess(top, receiver, stage.isThreadSafe);\n//             } else {\n//                 top.mouseClickLeft();\n//             }\n//         }\n//     }\n// };\n\n// ArgMorph drag & drop: for demo puposes only\n\nArgMorph.prototype.justDropped = function () {\n    if (!(this instanceof CommandSlotMorph)) {\n        this.fixLayout();\n        this.rerender();\n    }\n};\n\n// ArgMorph spec extrapolation (for demo purposes)\n\nArgMorph.prototype.getSpec = function () {\n    return '%s'; // default\n};\n\n// ArgMorph drawing\n\nArgMorph.prototype.createIcon = function () {\n    switch (this.type) {\n    case 'list':\n        this.icon = this.labelPart('%list');\n        this.add(this.icon);\n        break;\n    case 'object':\n        this.icon = this.labelPart('%turtle');\n        this.add(this.icon);\n        break;\n    default:\n        nop(); // no icon\n    }\n};\n\nArgMorph.prototype.fixLayout = function () {\n    if (this.icon) {\n        this.icon.setPosition(this.position());\n        this.bounds.setExtent(this.icon.extent());\n    } else {\n        ArgMorph.uber.fixLayout.call(this);\n    }\n};\n\nArgMorph.prototype.render = function (ctx) {\n    // make sure my icon's shadow color matches my block's color\n    var block;\n    if (this.icon) {\n        block = this.parentThatIsA(BlockMorph);\n        if (block) {\n            this.icon.shadowColor = block.color.darker(this.labelContrast);\n        }\n        switch (this.type) {\n        case 'list':\n            this.color = new Color(255, 140, 0); // list color\n            break;\n        default:\n            return; // don't draw anything except the icon\n        }\n    }\n    ArgMorph.uber.render.call(this, ctx);\n};\n\n// ArgMorph evaluation\n\nArgMorph.prototype.isEmptySlot = function () {\n    return this.type !== null;\n};\n\n// CommandSlotMorph ////////////////////////////////////////////////////\n\n/*\n    I am a CommandBlock-shaped input slot. I can nest command blocks\n    and also accept    reporters (containing reified scripts).\n\n    my most important accessor is\n\n    nestedBlock()    - answer the command block I encompass, if any\n\n    My command spec is %cmd\n\n    evaluate() returns my nested block or null\n*/\n\n// CommandSlotMorph inherits from ArgMorph:\n\nCommandSlotMorph.prototype = new ArgMorph();\nCommandSlotMorph.prototype.constructor = CommandSlotMorph;\nCommandSlotMorph.uber = ArgMorph.prototype;\n\n// CommandSlotMorph instance creation:\n\nexport function CommandSlotMorph() {\n    this.init();\n}\n\nCommandSlotMorph.prototype.init = function () {\n    CommandSlotMorph.uber.init.call(this);\n    this.color = new Color(0, 17, 173);\n    this.setExtent(\n        new Point(230, this.corner * 4 + this.cSlotPadding)\n    );\n};\n\nCommandSlotMorph.prototype.getSpec = function () {\n    return '%cmd';\n};\n\n// CommandSlotMorph enumerating:\n\nCommandSlotMorph.prototype.topBlock = function () {\n    if (this.parent.topBlock) {\n        return this.parent.topBlock();\n    }\n    return this.nestedBlock();\n};\n\n// CommandSlotMorph nesting:\n\nCommandSlotMorph.prototype.nestedBlock = function (block) {\n    if (block) {\n        var nb = this.nestedBlock();\n        this.add(block);\n        if (nb) {\n            block.bottomBlock().nextBlock(nb);\n        }\n        this.fixLayout();\n    } else {\n        return detect(\n            this.children,\n            child => child instanceof CommandBlockMorph\n        );\n    }\n};\n\n// CommandSlotMorph attach targets:\n\nCommandSlotMorph.prototype.slotAttachPoint = function () {\n    return new Point(\n        this.dentCenter(),\n        this.top() + this.corner * 2\n    );\n};\n\nCommandSlotMorph.prototype.dentLeft = function () {\n    return this.left()\n        + this.corner\n        + this.inset * 2;\n};\n\nCommandSlotMorph.prototype.dentCenter = function () {\n    return this.dentLeft()\n        + this.corner\n        + (this.dent * 0.5);\n};\n\nCommandSlotMorph.prototype.attachTargets = function () {\n    var answer = [];\n    answer.push({\n        point: this.slotAttachPoint(),\n        element: this,\n        loc: 'bottom',\n        type: 'slot'\n    });\n    return answer;\n};\n\n// CommandSlotMorph layout:\n\nCommandSlotMorph.prototype.fixLayout = function () {\n    var nb = this.nestedBlock();\n    if (this.parent) {\n        if (!this.color.eq(this.parent.color)) {\n            this.setColor(this.parent.color);\n        }\n    }\n    if (nb) {\n        nb.setPosition(\n            new Point(\n                this.left() + this.edge + this.rfBorder,\n                this.top() + this.edge + this.rfBorder\n            )\n        );\n        this.bounds.setWidth(nb.fullBounds().width()\n            + (this.edge + this.rfBorder) * 2\n            );\n        this.bounds.setHeight(nb.fullBounds().height()\n            + this.edge + (this.rfBorder * 2) - (this.corner - this.edge)\n            );\n    } else {\n        this.bounds.setHeight(this.corner * 4);\n        this.bounds.setWidth(\n            this.corner * 4\n                + this.inset\n                + this.dent\n        );\n    }\n    if (this.parent && this.parent.fixLayout) {\n        this.parent.fixLayout();\n    }\n};\n\n// CommandSlotMorph evaluating:\n\nCommandSlotMorph.prototype.evaluate = function () {\n    return this.nestedBlock();\n};\n\nCommandSlotMorph.prototype.isEmptySlot = function () {\n    return !this.isStatic && (this.nestedBlock() === null);\n};\n\n// CommandSlotMorph context menu ops\n\nCommandSlotMorph.prototype.attach = function () {\n    // for context menu demo and testing purposes\n    // override inherited version to adjust new owner's layout\n    var choices = this.overlappedMorphs(),\n        menu = new MenuMorph(this, 'choose new parent:');\n\n    choices.forEach(each =>\n        menu.addItem(\n            each.toString().slice(0, 50),\n            () => {\n                each.add(this);\n                this.isDraggable = false;\n                if (each.fixLayout) {\n                    each.fixLayout();\n                }\n            }\n        )\n    );\n    if (choices.length > 0) {\n        menu.popUpAtHand(this.world());\n    }\n};\n\n// CommandSlotMorph drawing:\n\nCommandSlotMorph.prototype.render = function (ctx) {\n    this.cachedClr = this.color.toString();\n    this.cachedClrBright = this.bright();\n    this.cachedClrDark = this.dark();\n    ctx.fillStyle = this.cachedClr;\n    ctx.fillRect(0, 0, this.width(), this.height());\n\n    // draw the 'flat' shape:\n    ctx.fillStyle = this.rfColor.toString();\n    this.drawFlat(ctx);\n\n    if (MorphicPreferences.isFlat) {return; }\n\n    // add 3D-Effect:\n    this.drawEdges(ctx);\n};\n\nCommandSlotMorph.prototype.drawFlat = function (ctx) {\n    var isFilled = this.nestedBlock() !== null,\n        ins = (isFilled ? this.inset : this.inset / 2),\n        dent = (isFilled ? this.dent : this.dent / 2),\n        indent = this.corner * 2 + ins,\n        edge = this.edge,\n        rf = (isFilled ? this.rfBorder : 0),\n        y = this.height() - this.corner - edge;\n\n    ctx.beginPath();\n\n    // top left:\n    ctx.arc(\n        this.corner + edge,\n        this.corner + edge,\n        this.corner,\n        radians(-180),\n        radians(-90),\n        false\n    );\n\n    // dent:\n    ctx.lineTo(this.corner + ins + edge + rf * 2, edge);\n    ctx.lineTo(indent + edge + rf * 2, this.corner + edge);\n    ctx.lineTo(\n        indent + edge  + rf * 2 + (dent - rf * 2),\n        this.corner + edge\n    );\n    ctx.lineTo(\n        indent + edge  + rf * 2 + (dent - rf * 2) + this.corner,\n        edge\n    );\n    ctx.lineTo(this.width() - this.corner - edge, edge);\n\n    // top right:\n    ctx.arc(\n        this.width() - this.corner - edge,\n        this.corner + edge,\n        this.corner,\n        radians(-90),\n        radians(-0),\n        false\n    );\n\n    // bottom right:\n    ctx.arc(\n        this.width() - this.corner - edge,\n        y,\n        this.corner,\n        radians(0),\n        radians(90),\n        false\n    );\n\n    // bottom left:\n    ctx.arc(\n        this.corner + edge,\n        y,\n        this.corner,\n        radians(90),\n        radians(180),\n        false\n    );\n\n    ctx.closePath();\n    ctx.fill();\n\n};\n\nCommandSlotMorph.prototype.drawEdges = function (ctx) {\n    var isFilled = this.nestedBlock() !== null,\n        ins = (isFilled ? this.inset : this.inset / 2),\n        dent = (isFilled ? this.dent : this.dent / 2),\n        indent = this.corner * 2 + ins,\n        edge = this.edge,\n        rf = (isFilled ? this.rfBorder : 0),\n        shift = this.edge * 0.5,\n        gradient,\n        upperGradient,\n        lowerGradient,\n        rightGradient;\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n\n    // bright:\n    // bottom horizontal line\n    gradient = ctx.createLinearGradient(\n        0,\n        this.height(),\n        0,\n        this.height() - this.edge\n    );\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrBright);\n\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(this.corner + edge, this.height() - shift);\n    ctx.lineTo(\n        this.width() - this.corner - edge,\n        this.height() - shift\n    );\n    ctx.stroke();\n\n    // bottom right corner\n    gradient = ctx.createRadialGradient(\n        this.width() - (this.corner + edge),\n        this.height() - (this.corner + edge),\n        this.corner,\n        this.width() - (this.corner + edge),\n        this.height() - (this.corner + edge),\n        this.corner + edge\n    );\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(\n        this.width() - (this.corner + edge),\n        this.height() - (this.corner + edge),\n        this.corner + shift,\n        radians(0),\n        radians(90),\n        false\n    );\n    ctx.stroke();\n\n    // right vertical line\n    gradient = ctx.createLinearGradient(\n        this.width(),\n        0,\n        this.width() - this.edge,\n        0\n    );\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrBright);\n\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(\n        this.width() - shift,\n        this.height() - this.corner - this.edge\n    );\n    ctx.lineTo(this.width() - shift, edge + this.corner);\n    ctx.stroke();\n\n    if (useBlurredShadows) {\n        ctx.shadowOffsetY = shift;\n        ctx.shadowBlur = this.edge;\n        ctx.shadowColor = this.rfColor.darker(80).toString();\n    }\n\n    // left vertical side\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        edge,\n        0\n    );\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrDark);\n\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(shift, edge + this.corner);\n    ctx.lineTo(shift, this.height() - edge - this.corner);\n    ctx.stroke();\n\n    // upper left corner\n    gradient = ctx.createRadialGradient(\n        this.corner + edge,\n        this.corner + edge,\n        this.corner,\n        this.corner + edge,\n        this.corner + edge,\n        this.corner + edge\n    );\n    gradient.addColorStop(0, this.cachedClrDark);\n    gradient.addColorStop(1, this.cachedClr);\n\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(\n        this.corner + edge,\n        this.corner + edge,\n        this.corner + shift,\n        radians(-180),\n        radians(-90),\n        false\n    );\n    ctx.stroke();\n\n    // upper edge (left side)\n    upperGradient = ctx.createLinearGradient(\n        0,\n        0,\n        0,\n        this.edge\n    );\n    upperGradient.addColorStop(0, this.cachedClr);\n    upperGradient.addColorStop(1, this.cachedClrDark);\n\n    ctx.strokeStyle = upperGradient;\n    ctx.beginPath();\n    ctx.moveTo(this.corner + edge, shift);\n    ctx.lineTo(\n        this.corner + ins + edge + rf * 2 - shift,\n        shift\n    );\n    ctx.stroke();\n\n    // dent bottom\n    lowerGradient = ctx.createLinearGradient(\n        0,\n        this.corner,\n        0,\n        this.corner + edge\n    );\n    lowerGradient.addColorStop(0, this.cachedClr);\n    lowerGradient.addColorStop(1, this.cachedClrDark);\n\n    ctx.strokeStyle = lowerGradient;\n    ctx.beginPath();\n    ctx.moveTo(indent + edge + rf * 2 + shift, this.corner + shift);\n    ctx.lineTo(\n        indent + edge  + rf * 2 + (dent - rf * 2),\n        this.corner + shift\n    );\n    ctx.stroke();\n\n    // dent right edge\n    rightGradient = ctx.createLinearGradient(\n        indent + edge  + rf * 2 + (dent - rf * 2) - shift,\n        this.corner,\n        indent + edge  + rf * 2 + (dent - rf * 2) + shift * 0.7,\n        this.corner + shift + shift * 0.7\n    );\n    rightGradient.addColorStop(0, this.cachedClr);\n    rightGradient.addColorStop(1, this.cachedClrDark);\n\n    ctx.strokeStyle = rightGradient;\n    ctx.beginPath();\n    ctx.moveTo(\n        indent + edge  + rf * 2 + (dent - rf * 2),\n        this.corner + shift\n    );\n    ctx.lineTo(\n        indent + edge  + rf * 2 + (dent - rf * 2) + this.corner,\n        shift\n    );\n    ctx.stroke();\n\n    // upper edge (right side)\n    ctx.strokeStyle = upperGradient;\n    ctx.beginPath();\n    ctx.moveTo(\n        indent + edge  + rf * 2 + (dent - rf * 2) + this.corner,\n        shift\n    );\n    ctx.lineTo(this.width() - this.corner - edge, shift);\n    ctx.stroke();\n};\n\n// RingCommandSlotMorph ///////////////////////////////////////////////////\n\n/*\n    I am a CommandBlock-shaped input slot for use in RingMorphs.\n    I can only nest command blocks, not reporters.\n\n    My command spec is %rc\n\n    evaluate() returns my nested block or null\n    (inherited from CommandSlotMorph)\n*/\n\n// RingCommandSlotMorph inherits from CommandSlotMorph:\n\nRingCommandSlotMorph.prototype = new CommandSlotMorph();\nRingCommandSlotMorph.prototype.constructor = RingCommandSlotMorph;\nRingCommandSlotMorph.uber = CommandSlotMorph.prototype;\n\n// RingCommandSlotMorph preferences settings\n\nRingCommandSlotMorph.prototype.rfBorder = 0;\nRingCommandSlotMorph.prototype.edge = RingMorph.prototype.edge;\n\n// RingCommandSlotMorph instance creation:\n\nexport function RingCommandSlotMorph() {\n    this.init();\n}\n\nRingCommandSlotMorph.prototype.init = function () {\n    RingCommandSlotMorph.uber.init.call(this);\n    this.color = new Color(0, 17, 173);\n    this.contrast = RingMorph.prototype.contrast;\n};\n\nRingCommandSlotMorph.prototype.getSpec = function () {\n    return '%rc';\n};\n\n// RingCommandSlotMorph drawing:\n\nRingCommandSlotMorph.prototype.render = function (ctx) {\n    if (MorphicPreferences.isFlat) {return; }\n\n    // init\n    this.cachedClr = this.color.toString();\n    this.cachedClrBright = this.bright();\n    this.cachedClrDark = this.dark();\n    ctx.fillStyle = this.cachedClr;\n\n    // only add 3D-Effect here, rendering of the flat shape happens at the\n    // encompassing block level\n    this.drawEdges(ctx);\n};\n\nRingCommandSlotMorph.prototype.outlinePath = function (ctx, offset) {\n    var ox = offset.x,\n        oy = offset.y,\n        isFilled = this.nestedBlock() !== null,\n        ins = (isFilled ? this.inset : this.inset / 2),\n        dent = (isFilled ? this.dent : this.dent / 2),\n        indent = this.corner * 2 + ins,\n        edge = this.edge,\n        w = this.width(),\n        h = this.height(),\n        rf = (isFilled ? this.rfBorder : 0),\n        y = h - this.corner - edge;\n\n    // top left:\n    ctx.arc(\n        this.corner + edge + ox,\n        this.corner + edge + oy,\n        this.corner,\n        radians(-180),\n        radians(-90),\n        false\n    );\n\n    // dent:\n    ctx.lineTo(this.corner + ins + edge + rf * 2 + ox, edge + oy);\n    ctx.lineTo(indent + edge + rf * 2 + ox, this.corner + edge + oy);\n    ctx.lineTo(\n        indent + edge  + rf * 2 + (dent - rf * 2) + ox,\n        this.corner + edge + oy\n    );\n    ctx.lineTo(\n        indent + edge  + rf * 2 + (dent - rf * 2) + this.corner + ox,\n        edge + oy\n    );\n    ctx.lineTo(this.width() - this.corner - edge + ox, edge + oy);\n\n    // top right:\n    ctx.arc(\n        w - this.corner - edge + ox,\n        this.corner + edge + oy,\n        this.corner,\n        radians(-90),\n        radians(-0),\n        false\n    );\n\n    // bottom right:\n    ctx.arc(\n        this.width() - this.corner - edge + ox,\n        y + oy,\n        this.corner,\n        radians(0),\n        radians(90),\n        false\n    );\n\n    // bottom left:\n    ctx.arc(\n        this.corner + edge + ox,\n        y + oy,\n        this.corner,\n        radians(90),\n        radians(180),\n        false\n    );\n\n    // close the path, so we can clip it:\n    ctx.lineTo(\n        this.corner + edge + ox - this.corner, // this needs to be adjusted\n        this.corner + edge + oy\n    );\n\n};\n\n// CSlotMorph ////////////////////////////////////////////////////\n\n/*\n    I am a C-shaped input slot. I can nest command blocks and also accept\n    reporters (containing reified scripts).\n\n    my most important accessor is\n\n    nestedBlock()    - the command block I encompass, if any (inherited)\n\n    My command spec is %c\n\n    evaluate() returns my nested block or null\n*/\n\n// CSlotMorph inherits from CommandSlotMorph:\n\nCSlotMorph.prototype = new CommandSlotMorph();\nCSlotMorph.prototype.constructor = CSlotMorph;\nCSlotMorph.uber = CommandSlotMorph.prototype;\n\n// CSlotMorph instance creation:\n\nexport function CSlotMorph() {\n    this.init();\n}\n\nCSlotMorph.prototype.init = function () {\n    CommandSlotMorph.uber.init.call(this);\n    this.isLambda = false; // see Process.prototype.evaluateInput\n    this.isLoop = false; // has a loop arrow symbol\n    this.color = new Color(0, 17, 173);\n    this.setExtent(new Point(230, this.corner * 4 + this.cSlotPadding));\n};\n\nCSlotMorph.prototype.getSpec = function () {\n    return this.isLoop? '%loop' : '%c';\n};\n\nCSlotMorph.prototype.mappedCode = function (definitions) {\n    var code = StageMorph.prototype.codeMappings.reify || '<#1>',\n        codeLines = code.split('\\n'),\n        nested = this.nestedBlock(),\n        part = nested ? nested.mappedCode(definitions) : '',\n        partLines = (part.toString()).split('\\n'),\n        rx = new RegExp('<#1>', 'g');\n\n    codeLines.forEach((codeLine, idx) => {\n        var prefix = '',\n            indent;\n        if (codeLine.trimLeft().indexOf('<#1>') === 0) {\n            indent = codeLine.indexOf('<#1>');\n            prefix = codeLine.slice(0, indent);\n        }\n        codeLines[idx] = codeLine.replace(\n            new RegExp('<#1>'),\n            partLines.join('\\n' + prefix)\n        );\n        codeLines[idx] = codeLines[idx].replace(rx, partLines.join('\\n'));\n    });\n\n    return codeLines.join('\\n');\n};\n\n// CSlotMorph layout:\n\nCSlotMorph.prototype.fixLayout = function () {\n    var nb = this.nestedBlock();\n    if (nb) {\n        nb.setPosition(\n            new Point(\n                this.left() + this.inset,\n                this.top() + this.corner\n            )\n        );\n        this.bounds.setHeight(nb.fullBounds().height() + this.corner);\n        this.bounds. setWidth(\n            nb.fullBounds().width() + (this.cSlotPadding * 2)\n        );\n    } else {\n        this.bounds.setHeight(this.corner * 4  + this.cSlotPadding); // default\n        this.bounds.setWidth(\n            this.corner * 4\n                + (this.inset * 2)\n                + this.dent\n                + (this.cSlotPadding * 2)\n        );\n    }\n\n    if (this.parent && this.parent.fixLayout) {\n        this.parent.fixLayout();\n    }\n};\n\nCSlotMorph.prototype.fixLoopLayout = function () {\n    var loop;\n    if (this.isLoop) {\n        loop = this.loop();\n        if (loop) {\n            loop.setRight(this.right() - this.corner);\n            loop.setBottom(this.bottom() + this.cSlotPadding + this.edge);\n        }\n    }\n};\n\nCSlotMorph.prototype.loop = function () {\n    if (this.isLoop) {\n        return detect(\n            this.children,\n            child => child instanceof SymbolMorph\n        );\n    }\n    return null;\n};\n\nCSlotMorph.prototype.fixHolesLayout = function () {\n    this.holes = [\n        new Rectangle(\n            this.inset,\n            this.corner,\n            this.width(),\n            this.height() - this.corner\n        )\n    ];\n};\n\nCSlotMorph.prototype.isLocked = function () {\n    return this.isStatic || this.parent instanceof MultiArgMorph;\n};\n\n// CSlotMorph drawing:\n\nCSlotMorph.prototype.render = function (ctx) {\n    if (MorphicPreferences.isFlat) {return; }\n\n    // init\n    this.cachedClr = this.color.toString();\n    this.cachedClrBright = this.bright();\n    this.cachedClrDark = this.dark();\n    ctx.fillStyle = this.cachedClr;\n\n    // only add 3D-Effect here, rendering of the flat shape happens at the\n    // encompassing block level\n    this.drawTopRightEdge(ctx);\n    this.drawTopEdge(ctx, this.inset, this.corner);\n    this.drawTopLeftEdge(ctx);\n    this.drawBottomEdge(ctx);\n    this.drawRightEdge(ctx);\n};\n\nCSlotMorph.prototype.outlinePath = function (ctx, inset, offset) {\n    var ox = offset.x,\n        oy = offset.y,\n        radius = Math.max(this.corner - inset, 0);\n\n    // top corner:\n    ctx.lineTo(this.width() + ox - inset, oy);\n\n    // top right:\n    ctx.arc(\n        this.width() - this.corner + ox,\n        oy,\n        radius,\n        radians(90),\n        radians(0),\n        true\n    );\n\n    // jigsaw shape:\n    ctx.lineTo(\n        this.width() - this.corner + ox,\n        this.corner + oy - inset\n    );\n    ctx.lineTo(\n        (this.inset * 2) + (this.corner * 3) + this.dent + ox,\n        this.corner + oy - inset\n    );\n    ctx.lineTo(\n        (this.inset * 2) + (this.corner * 2) + this.dent + ox,\n        this.corner * 2 + oy - inset\n    );\n    ctx.lineTo(\n        (this.inset * 2) + (this.corner * 2) + ox,\n        this.corner * 2 + oy - inset\n    );\n    ctx.lineTo(\n        (this.inset * 2) + this.corner + ox,\n        this.corner + oy - inset\n    );\n    ctx.lineTo(\n        this.inset + this.corner + ox,\n        this.corner + oy - inset\n    );\n    ctx.arc(\n        this.inset + this.corner + ox,\n        this.corner * 2 + oy,\n        this.corner + inset,\n        radians(270),\n        radians(180),\n        true\n    );\n\n    // bottom:\n    ctx.lineTo(\n        this.inset + ox - inset,\n        this.height() - (this.corner * 2) + oy\n    );\n    ctx.arc(\n        this.inset + this.corner  + ox,\n        this.height() - (this.corner * 2) + oy,\n        this.corner + inset,\n        radians(180),\n        radians(90),\n        true\n    );\n    ctx.lineTo(\n        this.width() - this.corner + ox,\n        this.height() - this.corner + oy + inset\n    );\n    ctx.arc(\n        this.width() - this.corner + ox,\n        this.height() + oy,\n        radius,\n        radians(-90),\n        radians(-0),\n        false\n    );\n};\n\nCSlotMorph.prototype.drawTopRightEdge = function (ctx) {\n    var shift = this.edge * 0.5,\n        x = this.width() - this.corner,\n        y = 0,\n        gradient;\n\n    gradient = ctx.createRadialGradient(\n        x,\n        y,\n        this.corner,\n        x,\n        y,\n        this.corner - this.edge\n    );\n    gradient.addColorStop(0, this.cachedClrDark);\n    gradient.addColorStop(1, this.cachedClr);\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    ctx.strokeStyle = gradient;\n\n    ctx.beginPath();\n    ctx.arc(\n        x,\n        y,\n        this.corner - shift,\n        radians(90),\n        radians(0),\n        true\n    );\n    ctx.stroke();\n};\n\nCSlotMorph.prototype.drawTopEdge = function (ctx, x, y) {\n    var shift = this.edge * 0.5,\n        indent = x + this.corner * 2 + this.inset,\n        upperGradient,\n        lowerGradient,\n        rightGradient;\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    upperGradient = ctx.createLinearGradient(\n        0,\n        y - this.edge,\n        0,\n        y\n    );\n    upperGradient.addColorStop(0, this.cachedClr);\n    upperGradient.addColorStop(1, this.cachedClrDark);\n\n    ctx.strokeStyle = upperGradient;\n    ctx.beginPath();\n    ctx.moveTo(x + this.corner, y - shift);\n    ctx.lineTo(x + this.corner + this.inset - shift, y - shift);\n    ctx.stroke();\n\n    lowerGradient = ctx.createLinearGradient(\n        0,\n        y + this.corner - this.edge,\n        0,\n        y + this.corner\n    );\n    lowerGradient.addColorStop(0, this.cachedClr);\n    lowerGradient.addColorStop(1, this.cachedClrDark);\n\n    ctx.strokeStyle = lowerGradient;\n    ctx.beginPath();\n    ctx.moveTo(indent + shift, y + this.corner - shift);\n    ctx.lineTo(indent + this.dent, y + this.corner - shift);\n    ctx.stroke();\n\n    rightGradient = ctx.createLinearGradient(\n        (x + this.inset + (this.corner * 2) + this.dent) - shift,\n        (y + this.corner - shift) - shift,\n        (x + this.inset + (this.corner * 2) + this.dent) + (shift * 0.7),\n        (y + this.corner - shift) + (shift * 0.7)\n    );\n    rightGradient.addColorStop(0, this.cachedClr);\n    rightGradient.addColorStop(1, this.cachedClrDark);\n\n\n    ctx.strokeStyle = rightGradient;\n    ctx.beginPath();\n    ctx.moveTo(\n        x + this.inset + (this.corner * 2) + this.dent,\n        y + this.corner - shift\n    );\n    ctx.lineTo(\n        x + this.corner * 3 + this.inset + this.dent,\n        y - shift\n    );\n    ctx.stroke();\n\n    ctx.strokeStyle = upperGradient;\n    ctx.beginPath();\n    ctx.moveTo(\n        x + this.corner * 3 + this.inset + this.dent,\n        y - shift\n    );\n    ctx.lineTo(this.width() - this.corner, y - shift);\n    ctx.stroke();\n};\n\nCSlotMorph.prototype.drawTopLeftEdge = function (ctx) {\n    var shift = this.edge * 0.5,\n        gradient;\n\n    gradient = ctx.createRadialGradient(\n        this.corner + this.inset,\n        this.corner * 2,\n        this.corner,\n        this.corner + this.inset,\n        this.corner * 2,\n        this.corner + this.edge\n    );\n    gradient.addColorStop(0, this.cachedClrDark);\n    gradient.addColorStop(1, this.cachedClr);\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    ctx.strokeStyle = gradient;\n\n    ctx.beginPath();\n    ctx.arc(\n        this.corner + this.inset,\n        this.corner * 2,\n        this.corner + shift,\n        radians(-180),\n        radians(-90),\n        false\n    );\n    ctx.stroke();\n};\n\nCSlotMorph.prototype.drawRightEdge = function (ctx) {\n    var shift = this.edge * 0.5,\n        x = this.inset,\n        gradient;\n\n    gradient = ctx.createLinearGradient(x - this.edge, 0, x, 0);\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrDark);\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(x - shift, this.corner * 2);\n    ctx.lineTo(x - shift, this.height() - this.corner * 2);\n    ctx.stroke();\n};\n\nCSlotMorph.prototype.drawBottomEdge = function (ctx) {\n    var shift = this.edge * 0.5,\n        gradient,\n        upperGradient;\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    upperGradient = ctx.createRadialGradient(\n        this.corner + this.inset,\n        this.height() - (this.corner * 2),\n        this.corner, /*- this.edge*/ // uncomment for half-tone\n        this.corner + this.inset,\n        this.height() - (this.corner * 2),\n        this.corner + this.edge\n    );\n    upperGradient.addColorStop(0, this.cachedClrBright);\n    upperGradient.addColorStop(1, this.cachedClr);\n    ctx.strokeStyle = upperGradient;\n    ctx.beginPath();\n    ctx.arc(\n        this.corner + this.inset,\n        this.height() - (this.corner * 2),\n        this.corner + shift,\n        radians(180),\n        radians(90),\n        true\n    );\n    ctx.stroke();\n\n    gradient = ctx.createLinearGradient(\n        0,\n        this.height() - this.corner,\n        0,\n        this.height() - this.corner + this.edge\n    );\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(\n        this.inset + this.corner,\n        this.height() - this.corner + shift\n    );\n    ctx.lineTo(\n        this.width() - this.corner,\n        this.height() - this.corner + shift\n    );\n\n    ctx.stroke();\n};\n\n// InputSlotMorph //////////////////////////////////////////////////////\n\n/*\n    I am an editable text input slot. I can be either rectangular or\n    rounded, and can have an optional drop-down menu. If I'm set to\n    read-only I must have a drop-down menu and will assume a darker\n    shade of my parent's color.\n\n    my most important public attributes and accessors are:\n\n    setContents(str/float)    - display the argument (string or float)\n    contents().text            - get the displayed string\n    choices                    - a key/value list for my optional drop-down\n    isReadOnly                - governs whether I am editable or not\n    isNumeric                - governs my outer shape (round or rect)\n\n    my block specs are:\n\n    %s        - string input, rectangular\n    %n        - numerical input, semi-circular vertical edges\n    %anyUE    - any unevaluated\n\n    evaluate() returns my displayed string, cast to float if I'm numerical\n\n    there are also a number of specialized drop-down menu presets, refer\n    to BlockMorph for details.\n*/\n\n// InputSlotMorph inherits from ArgMorph:\n\nInputSlotMorph.prototype = new ArgMorph();\nInputSlotMorph.prototype.constructor = InputSlotMorph;\nInputSlotMorph.uber = ArgMorph.prototype;\n\n// InputSlotMorph instance creation:\n\nexport function InputSlotMorph(text, isNumeric, choiceDict, isReadOnly) {\n    this.init(text, isNumeric, choiceDict, isReadOnly);\n}\n\nInputSlotMorph.prototype.init = function (\n    text,\n    isNumeric,\n    choiceDict,\n    isReadOnly\n) {\n    var contents = new InputSlotStringMorph(''),\n        arrow = new ArrowMorph(\n            'down',\n            0,\n            Math.max(Math.floor(this.fontSize / 6), 1),\n            BLACK,\n            true\n        );\n\n    contents.fontSize = this.fontSize;\n    contents.isShowingBlanks = true;\n\n\tthis.selectedBlock = null;\n\n    this.isUnevaluated = false;\n    this.choices = choiceDict || null; // object, function or selector\n    this.oldContentsExtent = contents.extent();\n    this.isNumeric = isNumeric || false;\n    this.isReadOnly = isReadOnly || false;\n    this.minWidth = 0; // can be chaged for text-type inputs (\"landscape\")\n    this.constant = null;\n\n    InputSlotMorph.uber.init.call(this, null, true);\n    this.color = WHITE;\n    this.add(contents);\n    this.add(arrow);\n    contents.isEditable = true;\n    contents.isDraggable = false;\n    contents.enableSelecting();\n    this.setContents(text);\n};\n\n// InputSlotMorph accessing:\n\nInputSlotMorph.prototype.getSpec = function () {\n    if (this.isNumeric) {\n        return '%n';\n    }\n    return '%s'; // default\n};\n\nInputSlotMorph.prototype.contents = function () {\n    return detect(\n        this.children,\n        child => child instanceof StringMorph\n    );\n};\n\nInputSlotMorph.prototype.arrow = function () {\n    return detect(\n        this.children,\n        child => child instanceof ArrowMorph\n    );\n};\n\nInputSlotMorph.prototype.setContents = function (data) {\n\t// data can be a String, Float, or \"wish\" Block\n    var cnts = this.contents(),\n        dta = data,\n        isConstant = dta instanceof Array;\n\n\tif (this.selectedBlock) {\n   \t\tthis.selectedBlock = null;\n\t}\n\n    if (isConstant) {\n        dta = localize(dta[0]);\n        cnts.isItalic = !this.isReadOnly;\n    } else if (dta instanceof BlockMorph) {\n    \tthis.selectedBlock = dta;\n      \tdta = ''; // make sure the contents text emptied\n    } else { // assume dta is a localizable choice if it's a key in my choices\n        cnts.isItalic = false;\n        if (!isNil(this.choices) && this.choices[dta] instanceof Array) {\n            return this.setContents(this.choices[dta]);\n        }\n    }\n    cnts.text = dta;\n    if (isNil(dta)) {\n        cnts.text = '';\n    } else if (dta.toString) {\n        cnts.text = dta.toString();\n    }\n    if (this.isReadOnly && !MorphicPreferences.isFlat) {\n        cnts.shadowOffset = new Point(1, 1); // correct initial dimensions\n    }\n    cnts.fixLayout();\n\n    // remember the constant, if any\n    this.constant = isConstant ? data : null;\n\n    // adjust to zebra coloring:\n    if (this.isReadOnly && (this.parent instanceof BlockMorph)) {\n        this.parent.fixLabelColor();\n    }\n};\n\nInputSlotMorph.prototype.userSetContents = function (aStringOrFloat) {\n    // enable copy-on-edit for inherited scripts\n    this.selectForEdit().setContents(aStringOrFloat);\n};\n\n// InputSlotMorph drop-down menu:\n\nInputSlotMorph.prototype.dropDownMenu = function (enableKeyboard) {\n    var menu = this.menuFromDict(this.choices, null, enableKeyboard);\n    if (!menu) { // has already happened\n        return;\n    }\n    if (menu.items.length > 0) {\n        if (enableKeyboard) {\n            menu.popup(this.world(), this.bottomLeft());\n            menu.getFocus();\n        } else {\n            menu.popUpAtHand(this.world());\n        }\n    }\n};\n\nInputSlotMorph.prototype.menuFromDict = function (\n    choices,\n    noEmptyOption,\n    enableKeyboard)\n{\n    var key, dial, flag,\n    \tmyself = this,\n        menu = new MenuMorph(\n            this.userSetContents,\n            null,\n            this,\n            this.fontSize\n        );\n\n\tfunction update(num) {\n    \tmyself.setContents(num);\n        myself.reactToSliderEdit();\n \t}\n\n    function getImg(block) {\n        return () => block.fullImage();\n    }\n\n    if (choices instanceof Function) {\n        choices = choices.call(this);\n    } else if (isString(choices)) {\n        choices = this[choices](enableKeyboard);\n        if (!choices) { // menu has already happened\n            return;\n        }\n    }\n    if (!noEmptyOption) {\n        menu.addItem(' ', function() {\n            // Trace.log('InputSlot.menuItemSelected', {\n            //     'id': myself.argId(),\n            //     'item': ' ',\n            // });\n            return ' ';\n        });\n    }\n    for (key in choices) {\n        if (Object.prototype.hasOwnProperty.call(choices, key)) {\n            if (key[0] === '~') {\n                menu.addLine();\n            } else if (key.indexOf('_def') === 0) {\n                menu.addItem(\n                    this.doWithAlpha(1, getImg(choices[key])),\n                    choices[key]\n                );\n            } else if (key.indexOf('_dir') === 0) {\n\t\t\t    dial = new DialMorph();\n    \t\t\tdial.rootForGrab = function () {return this; };\n    \t\t\tdial.target = this;\n       \t\t\tdial.action = update;\n       \t\t\tdial.fillColor = this.parent.color;\n          \t\tdial.setRadius(this.fontSize * 3);\n\t\t\t\tdial.setValue(+this.evaluate(), false, true);\n       \t\t\tmenu.addLine();\n\t\t\t    menu.items.push(dial);\n            \tmenu.addLine();\n            } else if (key.indexOf('_') === 0) {\n                // prefixing a key with '_' only makes the menu item\n                // appear when the user holds down the shift-key\n                // use with care because mobile devices might only\n                // have a \"soft\" keyboard that isn't always there\n                if (this.world().currentKey === 16) { // shift\n                    menu.addItem(\n                        key.slice(2),\n                        choices[key],\n                        null, // hint\n                        null, // color\n                        null, // bold\n                        true, // italic\n                        null, // doubleClickAction\n                        null, // shortcut\n                        !(choices[key] instanceof Array) &&\n                            typeof choices[key] !== 'function' // verbatim?\n                    );\n                }\n            } else if (key === '__shout__go__') {\n                // show the green flag symbol\n                flag = new SymbolMorph('flag');\n                flag.size = this.fontSize * 1.5;\n                flag.setColor(new Color(0, 200, 0));\n                flag.fixLayout();\n                menu.addItem(flag, ['__shout__go__']);\n            } else if (choices[key] instanceof Object &&\n                    !(choices[key] instanceof Array) &&\n                    (typeof choices[key] !== 'function')) {\n                menu.addMenu(\n                    key,\n                    this.menuFromDict(choices[key],true),\n                    null,  // indicator\n                    true   // verbatim? - don't translate\n                );\n            } else if (choices[key] instanceof Array &&\n                    choices[key][0] instanceof Object &&\n                    typeof choices[key][0] !== 'function') {\n                menu.addMenu(\n                    key,\n                    this.menuFromDict(choices[key][0],true),\n                    null,  // indicator\n                    false  // verbatim? - do translate, if inside an array\n                );\n            } else {\n                // capture the key in a function call to avoid closure nonsense\n                (function (fKey) {\n                    menu.addItem(\n                        fKey,\n                        function() {\n                            // Trace.log('InputSlot.menuItemSelected', {\n                            //     'id': myself.argId(),\n                            //     'item': fKey,\n                            // });\n                            var choice = choices[fKey];\n                            if (choice instanceof Function) return choice();\n                            return choice;\n                        },\n                        null, // hint\n                        null, // color\n                        null, // bold\n                        null, // italic\n                        null, // doubleClickAction\n                        null, // shortcut\n                        !(choices[fKey] instanceof Array) &&\n                            typeof choices[fKey] !== 'function' &&\n                                typeof(choices[fKey]) !== 'number' // verbatim?\n                    );\n                })(key);\n            }\n        }\n    }\n    return menu;\n};\n\nInputSlotMorph.prototype.messagesMenu = function () {\n    var dict = {},\n        rcvr = this.parentThatIsA(BlockMorph).scriptTarget(),\n        stage = rcvr.parentThatIsA(StageMorph),\n        allNames = [];\n\n    stage.children.concat(stage).forEach(morph => {\n        if (isSnapObject(morph)) {\n            allNames = allNames.concat(morph.allMessageNames());\n        }\n    });\n    allNames.sort().forEach(name =>\n        dict[name] = name\n    );\n    if (this.world().currentKey === 16) { // shift\n        dict.__shout__go__ = ['__shout__go__'];\n    }\n    if (allNames.length > 0) {\n        dict['~'] = null;\n    }\n    dict['new...'] = () =>\n        new DialogBoxMorph(\n            this,\n            this.setContents,\n            this\n        ).prompt(\n            'Message name',\n            null,\n            this.world()\n        );\n    return dict;\n};\n\nInputSlotMorph.prototype.messagesReceivedMenu = function () {\n    var dict = {'any message': ['any message']},\n        rcvr = this.parentThatIsA(BlockMorph).scriptTarget(),\n        stage = rcvr.parentThatIsA(StageMorph),\n        allNames = [];\n\n    stage.children.concat(stage).forEach(morph => {\n        if (isSnapObject(morph)) {\n            allNames = allNames.concat(morph.allMessageNames());\n        }\n    });\n    allNames.sort().forEach(name => {\n        if (name !== '__shout__go__') {\n            dict[name] = name;\n        }\n    });\n    dict['~'] = null;\n    dict['new...'] = () =>\n        new DialogBoxMorph(\n            this,\n            this.setContents,\n            this\n        ).prompt(\n            'Message name',\n            null,\n            this.world()\n        );\n    return dict;\n};\n\nInputSlotMorph.prototype.collidablesMenu = function () {\n    var dict = {\n            'mouse-pointer' : ['mouse-pointer'],\n            edge : ['edge'],\n            'pen trails' : ['pen trails']\n        },\n        rcvr = this.parentThatIsA(BlockMorph).scriptTarget(),\n        stage = rcvr.parentThatIsA(StageMorph),\n        allNames = [];\n\n    stage.children.forEach(morph => {\n        if (morph instanceof SpriteMorph && !morph.isTemporary) {\n            if (morph.name !== rcvr.name) {\n                allNames = allNames.concat(morph.name);\n            }\n        }\n    });\n    if (allNames.length > 0) {\n        dict['~'] = null;\n        allNames.forEach(name =>\n            dict[name] = name\n        );\n    }\n    return dict;\n};\n\nInputSlotMorph.prototype.locationMenu = function () {\n    var dict = {\n            'mouse-pointer' : ['mouse-pointer'],\n            'myself' : ['myself']\n        },\n        rcvr = this.parentThatIsA(BlockMorph).scriptTarget(),\n        stage = rcvr.parentThatIsA(StageMorph),\n        allNames = [];\n\n    stage.children.forEach(morph => {\n        if (morph instanceof SpriteMorph && !morph.isTemporary) {\n            if (morph.name !== rcvr.name) {\n                allNames = allNames.concat(morph.name);\n            }\n        }\n    });\n    if (allNames.length > 0) {\n        dict['~'] = null;\n        allNames.forEach(name =>\n            dict[name] = name\n        );\n    }\n    return dict;\n};\n\nInputSlotMorph.prototype.distancesMenu = function () {\n\tvar block = this.parentThatIsA(BlockMorph),\n        dict = {},\n        rcvr = this.parentThatIsA(BlockMorph).scriptTarget(),\n        stage = rcvr.parentThatIsA(StageMorph),\n        allNames = [];\n\n\tif (block && (block.selector !== 'reportRelationTo')) {\n\t    dict['random position'] = ['random position'];\n \t}\n\tdict['mouse-pointer'] = ['mouse-pointer'];\n    dict.center = ['center'];\n\n    stage.children.forEach(morph => {\n        if (morph instanceof SpriteMorph && !morph.isTemporary) {\n            if (morph.name !== rcvr.name) {\n                allNames = allNames.concat(morph.name);\n            }\n        }\n    });\n    if (allNames.length > 0) {\n        dict['~'] = null;\n        allNames.forEach(name =>\n            dict[name] = name\n        );\n    }\n    return dict;\n};\n\nInputSlotMorph.prototype.distancesMenu = function () {\n\tvar block = this.parentThatIsA(BlockMorph),\n        dict = {},\n        rcvr = this.parentThatIsA(BlockMorph).scriptTarget(),\n        stage = rcvr.parentThatIsA(StageMorph),\n        allNames = [];\n\n\tif (block && (block.selector !== 'reportRelationTo')) {\n\t    dict['random position'] = ['random position'];\n \t}\n\tdict['mouse-pointer'] = ['mouse-pointer'];\n    dict.center = ['center'];\n\n    stage.children.forEach(function (morph) {\n        if (morph instanceof SpriteMorph && !morph.isTemporary) {\n            if (morph.name !== rcvr.name) {\n                allNames = allNames.concat(morph.name);\n            }\n        }\n    });\n    if (allNames.length > 0) {\n        dict['~'] = null;\n        allNames.forEach(function (name) {\n            dict[name] = name;\n        });\n    }\n    return dict;\n};\n\nInputSlotMorph.prototype.clonablesMenu = function () {\n    var dict = {},\n        rcvr = this.parentThatIsA(BlockMorph).scriptTarget(),\n        stage = rcvr.parentThatIsA(StageMorph),\n        allNames = [];\n\n    if (rcvr instanceof SpriteMorph) {\n        dict.myself = ['myself'];\n    }\n    stage.children.forEach(morph => {\n        if (morph instanceof SpriteMorph && !morph.isTemporary) {\n            allNames = allNames.concat(morph.name);\n        }\n    });\n    if (allNames.length > 0) {\n        dict['~'] = null;\n        allNames.forEach(name =>\n            dict[name] = name\n        );\n    }\n    return dict;\n};\n\nInputSlotMorph.prototype.objectsMenuWithSelf = function () {\n    return this.objectsMenu(true);\n};\n\nInputSlotMorph.prototype.objectsMenu = function (includeMyself) {\n    var rcvr = this.parentThatIsA(BlockMorph).scriptTarget(),\n        stage = rcvr.parentThatIsA(StageMorph),\n        dict = {},\n        allNames = [];\n\n    if (includeMyself) {\n        dict.myself = ['myself'];\n    }\n    dict[stage.name] = stage.name;\n    stage.children.forEach(morph => {\n        if (morph instanceof SpriteMorph && !morph.isTemporary) {\n            allNames.push(morph.name);\n        }\n    });\n    if (allNames.length > 0) {\n        dict['~'] = null;\n        allNames.forEach(name =>\n            dict[name] = name\n        );\n    }\n    return dict;\n};\n\nInputSlotMorph.prototype.typesMenu = function () {\n    var dict = {\n        number : ['number'],\n        text : ['text'],\n        Boolean : ['Boolean'],\n        list : ['list']\n    };\n    if (SpriteMorph.prototype.enableFirstClass) {\n        dict.sprite = ['sprite'];\n    }\n    dict.costume = ['costume'];\n    dict.sound = ['sound'];\n    dict.command = ['command'];\n    dict.reporter = ['reporter'];\n    dict.predicate = ['predicate'];\n    return dict;\n};\n\nInputSlotMorph.prototype.gettablesMenu = function () {\n    var dict = {},\n        nest = SpriteMorph.prototype.enableNesting,\n        oop = StageMorph.prototype.enableInheritance;\n\n    dict.neighbors = ['neighbors'];\n    dict.self = ['self'];\n    dict['other sprites'] = ['other sprites'];\n    dict.clones = ['clones'];\n    dict['other clones'] = ['other clones'];\n    if (nest) {\n        dict.parts = ['parts'];\n        dict.anchor = ['anchor'];\n    }\n    dict.stage = ['stage'];\n    if (oop) {\n        dict.children = ['children'];\n        dict.parent = ['parent'];\n        dict['temporary?'] = ['temporary?'];\n    }\n    dict.name = ['name'];\n    dict.costume = ['costume'];\n    dict.costumes = ['costumes'];\n    dict.sounds = ['sounds'];\n    dict['dangling?'] = ['dangling?'];\n    dict['draggable?'] = ['draggable?'];\n    dict.width = ['width'];\n    dict.height = ['height'];\n    dict.left = ['left'];\n    dict.right = ['right'];\n    dict.top = ['top'];\n    dict.bottom = ['bottom'];\n    dict['rotation style'] = ['rotation style'];\n    dict['rotation x'] = ['rotation x'];\n    dict['rotation y'] = ['rotation y'];\n    dict['center x'] = ['center x'];\n    dict['center y'] = ['center y'];\n    return dict;\n};\n\nInputSlotMorph.prototype.attributesMenu = function () {\n    var block = this.parentThatIsA(BlockMorph),\n        objName = block.inputs()[1].evaluate(),\n        rcvr = block.scriptTarget(),\n        stage = rcvr.parentThatIsA(StageMorph),\n        obj,\n        dict = {},\n        varNames = [];\n\n    if (objName === stage.name) {\n        obj = stage;\n    } else {\n        obj = detect(\n            stage.children,\n            morph => morph.name === objName\n        );\n    }\n    if (!obj) {\n        return dict;\n    }\n    if (obj instanceof SpriteMorph) {\n        dict = {\n            'x position' : ['x position'],\n            'y position' : ['y position'],\n            'direction' : ['direction'],\n            'costume #' : ['costume #'],\n            'costume name' : ['costume name'],\n            'size' : ['size'],\n            'width': ['width'],\n            'height': ['height'],\n            'left' : ['left'],\n            'right' : ['right'],\n            'top' : ['top'],\n            'bottom' : ['bottom'],\n            'volume' : ['volume'],\n            'balance' : ['balance']\n        };\n    } else { // the stage\n        dict = {\n            'costume #' : ['costume #'],\n            'costume name' : ['costume name'],\n            'volume' : ['volume'],\n            'balance' : ['balance'],\n            'width': ['width'],\n            'height': ['height'],\n            'left' : ['left'],\n            'right' : ['right'],\n            'top' : ['top'],\n            'bottom' : ['bottom']\n        };\n    }\n    varNames = obj.variables.names();\n    if (varNames.length > 0) {\n        dict['~'] = null;\n        varNames.forEach(name =>\n            dict[name] = name\n        );\n    }\n    obj.allBlocks(true).forEach((def, i) =>\n        dict['_def' + i] = def.blockInstance(true) // include translations\n    );\n    return dict;\n};\n\nInputSlotMorph.prototype.costumesMenu = function () {\n    var block = this.parentThatIsA(BlockMorph),\n        rcvr = block.scriptTarget(),\n        dict,\n        allNames = [];\n    if (rcvr instanceof SpriteMorph) {\n        dict = {Turtle : ['Turtle']};\n    } else { // stage\n        dict = {Empty : ['Empty']};\n    }\n    if (block.selector !== 'doSwitchToCostume') {\n        dict.current = ['current'];\n    }\n    rcvr.costumes.asArray().forEach(costume =>\n        allNames = allNames.concat(costume.name)\n    );\n    if (allNames.length > 0) {\n        dict['~'] = null;\n        allNames.forEach(name =>\n            dict[name] = name\n        );\n    }\n    return dict;\n};\n\nInputSlotMorph.prototype.soundsMenu = function () {\n    var rcvr = this.parentThatIsA(BlockMorph).scriptTarget(),\n        allNames = [],\n        dict = {};\n\n    rcvr.sounds.asArray().forEach(sound =>\n        allNames = allNames.concat(sound.name)\n    );\n    if (allNames.length > 0) {\n        allNames.sort().forEach(name =>\n            dict[name] = name\n        );\n    }\n    return dict;\n};\n\nInputSlotMorph.prototype.shadowedVariablesMenu = function () {\n    var block = this.parentThatIsA(BlockMorph),\n        vars,\n        attribs,\n        rcvr,\n        dict = {};\n\n    if (!block) {return dict; }\n    rcvr = block.scriptTarget();\n    if (this.parentThatIsA(RingMorph) ||\n            this.topBlock().selector === 'receiveOnClone') {\n    \t// show own local vars and attributes, because this is likely to be\n     \t// inside TELL, ASK or OF or when initializing a new clone\n        vars = rcvr.variables.names();\n        vars.forEach(name =>\n            dict[name] = name\n        );\n        attribs = rcvr.attributes;\n        /*\n        if (vars.length && attribs.length) {\n            dict['~'] = null; // add line\n        }\n        */\n        attribs.forEach(name =>\n            dict[name] = [name]\n        );\n    } else if (rcvr && rcvr.exemplar) {\n    \t// only show shadowed vars and attributes\n        vars = rcvr.inheritedVariableNames(true);\n        vars.forEach(name =>\n            dict[name] = name\n        );\n        attribs = rcvr.shadowedAttributes();\n        /*\n        if (vars.length && attribs.length) {\n            dict['~'] = null; // add line\n        }\n        */\n        attribs.forEach(name =>\n            dict[name] = [name]\n        );\n    }\n    return dict;\n};\n\nInputSlotMorph.prototype.pianoKeyboardMenu = function () {\n    var menu, block, instrument;\n    block = this.parentThatIsA(BlockMorph);\n    if (block) {\n        instrument = block.scriptTarget().instrument;\n    }\n    menu = new PianoMenuMorph(\n        this.setContents,\n        this,\n        this.fontSize,\n        instrument\n    );\n    menu.popup(this.world(), new Point(\n        this.right() - (menu.width() / 2),\n        this.bottom()\n    ));\n    menu.selectKey(+this.evaluate());\n};\n\nInputSlotMorph.prototype.directionDialMenu = function () {\n    return {'_dir': null};\n};\n\nInputSlotMorph.prototype.audioMenu = function () {\n    var dict = {\n        'volume' : ['volume'],\n        'note' : ['note'],\n        'frequency' : ['frequency'],\n        'samples' : ['samples'],\n        'sample rate' : ['sample rate'],\n        'spectrum' : ['spectrum'],\n        'resolution' : ['resolution']\n    };\n    if (this.world().currentKey === 16) { // shift\n        dict['~'] = null;\n        dict.modifier = ['modifier'];\n        dict.output = ['output'];\n    }\n    return dict;\n};\n\nInputSlotMorph.prototype.setChoices = function (dict, readonly) {\n    // externally specify choices and read-only status,\n    // used for custom blocks\n    var cnts = this.contents();\n    this.choices = dict;\n    this.isReadOnly = readonly || false;\n    if (this.parent instanceof BlockMorph) {\n        this.parent.fixLabelColor();\n        if (!readonly) {\n            cnts.shadowOffset = ZERO;\n            cnts.shadowColor = null;\n            cnts.setColor(BLACK);\n        }\n    }\n    this.fixLayout();\n};\n\n// InputSlotMorph layout:\n\nInputSlotMorph.prototype.fixLayout = function () {\n    var width, height, arrowWidth,\n        contents = this.contents(),\n        arrow = this.arrow(),\n        tp = this.topBlock();\n\n    contents.isNumeric = this.isNumeric;\n    contents.isEditable = (!this.isReadOnly);\n    if (this.isReadOnly) {\n        contents.disableSelecting();\n        contents.color = WHITE;\n    } else {\n        contents.enableSelecting();\n        contents.color = BLACK;\n    }\n\n    if (this.choices) {\n        arrow.setSize(this.fontSize);\n        arrow.show();\n    } else {\n        arrow.hide();\n    }\n    arrowWidth = arrow.isVisible ? arrow.width() : 0;\n\n\t// determine slot dimensions\n    if (this.selectedBlock) { // a \"wish\" in the OF-block's left slot\n        height = this.selectedBlock.height() + this.edge * 2;\n         width = this.selectedBlock.width()\n            + arrowWidth\n            + this.edge * 2\n            + this.typeInPadding * 2;\n     } else {\n    \theight = contents.height() + this.edge * 2; // + this.typeInPadding * 2\n        if (this.isNumeric) {\n            width = contents.width()\n                + Math.floor(arrowWidth * 0.5)\n                + height\n                + this.typeInPadding * 2;\n        } else {\n            width = Math.max(\n                contents.width()\n                    + arrowWidth\n                    + this.edge * 2\n                    + this.typeInPadding * 2,\n                contents.rawHeight ? // single vs. multi-line contents\n                            contents.rawHeight() + arrowWidth\n                                    : fontHeight(contents.fontSize) / 1.3\n                                        + arrowWidth,\n                this.minWidth // for text-type slots\n            );\n        }\n    }\n    this.bounds.setExtent(new Point(width, height));\n\n    if (this.isNumeric) {\n        contents.setPosition(new Point(\n            Math.floor(height / 2),\n            this.edge\n        ).add(new Point(this.typeInPadding, 0)).add(this.position()));\n    } else {\n        contents.setPosition(new Point(\n            this.edge,\n            this.edge\n        ).add(new Point(this.typeInPadding, 0)).add(this.position()));\n    }\n\n    if (arrow.isVisible) {\n        arrow.setPosition(new Point(\n            this.right() - arrowWidth - this.edge,\n            contents.top()\n        ));\n    }\n\n    if (this.parent && this.parent.fixLayout) {\n        tp.fullChanged();\n        this.parent.fixLayout();\n        tp.fullChanged();\n    }\n};\n\n// InputSlotMorph events:\n\nInputSlotMorph.prototype.mouseDownLeft = function (pos) {\n    if (this.isReadOnly || this.arrow().bounds.containsPoint(pos)) {\n        this.escalateEvent('mouseDownLeft', pos);\n    } else {\n        this.selectForEdit().contents().edit();\n    }\n};\n\nInputSlotMorph.prototype.mouseClickLeft = function (pos) {\n    if (this.arrow().bounds.containsPoint(pos)) {\n        this.dropDownMenu();\n    } else if (this.isReadOnly) {\n        this.dropDownMenu();\n    } else {\n        this.contents().edit();\n    }\n};\n\nInputSlotMorph.prototype.reactToKeystroke = function () {\n    var cnts;\n    if (this.constant) {\n        cnts = this.contents();\n        this.constant = null;\n        cnts.isItalic = false;\n        cnts.rerender();\n    }\n};\n\nInputSlotMorph.prototype.reactToEdit = function () {\n    // Trace.log('InputSlot.edited', {\n    //     'id': this.argId(),\n    //     'text': this.contents().text,\n    // });\n    this.contents().clearSelection();\n};\n\nInputSlotMorph.prototype.freshTextEdit = function (aStringOrTextMorph) {\n    this.onNextStep = () => aStringOrTextMorph.selectAll();\n};\n\n// InputSlotMorph menu:\n\nInputSlotMorph.prototype.userMenu = function () {\n    var menu = new MenuMorph(this);\n    if (!StageMorph.prototype.enableCodeMapping) {\n        return this.parent.userMenu();\n    }\n    if (this.isNumeric) {\n        menu.addItem(\n            'code number mapping...',\n            'mapNumberToCode'\n        );\n    } else {\n        menu.addItem(\n            'code string mapping...',\n            'mapStringToCode'\n        );\n    }\n    return menu;\n};\n\n// InputSlotMorph code mapping\n\n/*\n    code mapping lets you use blocks to generate arbitrary text-based\n    source code that can be exported and compiled / embedded elsewhere,\n    it's not part of Snap's evaluator and not needed for Snap itself\n*/\n\nInputSlotMorph.prototype.mapStringToCode = function () {\n    // private - open a dialog box letting the user map code via the GUI\n    new DialogBoxMorph(\n        this,\n        code => StageMorph.prototype.codeMappings.string = code,\n        this\n    ).promptCode(\n        'Code mapping - String <#1>',\n        StageMorph.prototype.codeMappings.string || '',\n        this.world()\n    );\n};\n\nInputSlotMorph.prototype.mapNumberToCode = function () {\n    // private - open a dialog box letting the user map code via the GUI\n    new DialogBoxMorph(\n        this,\n        code => StageMorph.prototype.codeMappings.number = code,\n        this\n    ).promptCode(\n        'Code mapping - Number <#1>',\n        StageMorph.prototype.codeMappings.number || '',\n        this.world()\n    );\n};\n\nInputSlotMorph.prototype.mappedCode = function () {\n    var block = this.parentThatIsA(BlockMorph),\n        val = this.evaluate(),\n        code;\n\n    if (this.isNumeric) {\n        code = StageMorph.prototype.codeMappings.number || '<#1>';\n        return code.replace(/<#1>/g, val);\n    }\n    if (!isNaN(parseFloat(val))) {return val; }\n    if (!isString(val)) {return val; }\n    if (block && contains(\n            ['doSetVar', 'doChangeVar', 'doShowVar', 'doHideVar'],\n            block.selector\n        )) {\n        return val;\n    }\n    code = StageMorph.prototype.codeMappings.string || '<#1>';\n    return code.replace(/<#1>/g, val);\n};\n\n// InputSlotMorph evaluating:\n\nInputSlotMorph.prototype.evaluate = function () {\n/*\n    answer my contents, which can be a \"wish\", i.e. a block that refers to\n    another sprite's local method, or a text string. If I am numerical convert\n    that string to a number. If the conversion fails answer the string\n    (e.g. for special choices like 'any', 'all' or 'last') otherwise\n    the numerical value.\n*/\n    var num, contents;\n\n \tif (this.selectedBlock) {\n  \t\treturn this.selectedBlock;\n  \t}\n    if (this.constant) {\n        return this.constant;\n    }\n    contents = this.contents();\n    if (this.isNumeric) {\n        num = parseFloat(contents.text || '0');\n        if (!isNaN(num)) {\n            return num;\n        }\n    }\n    return contents.text;\n};\n\nInputSlotMorph.prototype.isEmptySlot = function () {\n    return this.contents().text === '' && !this.selectedBlock;\n};\n\n// InputSlotMorph single-stepping:\n\nInputSlotMorph.prototype.flash = function () {\n    // don't redraw the label b/c zebra coloring\n    if (!this.cachedNormalColor) {\n        this.cachedNormalColor = this.color;\n        this.color = this.activeHighlight;\n        this.rerender();\n    }\n};\n\nInputSlotMorph.prototype.unflash = function () {\n    // don't redraw the label b/c zebra coloring\n    if (this.cachedNormalColor) {\n        var clr = this.cachedNormalColor;\n        this.cachedNormalColor = null;\n        this.color = clr;\n        this.rerender();\n    }\n};\n\n// InputSlotMorph drawing:\n\nInputSlotMorph.prototype.render = function (ctx) {\n    var borderColor, r;\n\n    // initialize my surface property\n    if (this.cachedNormalColor) { // if flashing\n        borderColor = this.color;\n    } else if (this.parent) {\n        borderColor = this.parent.color;\n    } else {\n        borderColor = new Color(120, 120, 120);\n    }\n    ctx.fillStyle = this.color.toString();\n    if (this.isReadOnly && !this.cachedNormalColor) { // unless flashing\n        ctx.fillStyle = borderColor.darker().toString();\n    }\n\n    // cache my border colors\n    this.cachedClr = borderColor.toString();\n    this.cachedClrBright = borderColor.lighter(this.contrast)\n        .toString();\n    this.cachedClrDark = borderColor.darker(this.contrast).toString();\n\n    if (!this.isNumeric) {\n        ctx.fillRect(\n            this.edge,\n            this.edge,\n            this.width() - this.edge * 2,\n            this.height() - this.edge * 2\n        );\n        if (!MorphicPreferences.isFlat) {\n            this.drawRectBorder(ctx);\n        }\n    } else {\n        r = Math.max((this.height() - (this.edge * 2)) / 2, 0);\n        ctx.beginPath();\n        ctx.arc(\n            r + this.edge,\n            r + this.edge,\n            r,\n            radians(90),\n            radians(-90),\n            false\n        );\n        ctx.arc(\n            this.width() - r - this.edge,\n            r + this.edge,\n            r,\n            radians(-90),\n            radians(90),\n            false\n        );\n        ctx.closePath();\n        ctx.fill();\n        if (!MorphicPreferences.isFlat) {\n            this.drawRoundBorder(ctx);\n        }\n    }\n\n\t// draw my \"wish\" block, if any\n\tif (this.selectedBlock) {\n \t\tctx.drawImage(\n        \tthis.doWithAlpha(1, () => this.selectedBlock.fullImage()),\n            this.edge + this.typeInPadding,\n            this.edge\n        );\n \t}\n\n};\n\nInputSlotMorph.prototype.drawRectBorder = function (ctx) {\n    var shift = this.edge * 0.5,\n        gradient;\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    if (useBlurredShadows) {\n        ctx.shadowOffsetY = shift;\n        ctx.shadowBlur = this.edge;\n        ctx.shadowColor = this.color.darker(80).toString();\n    }\n\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        0,\n        this.edge\n    );\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrDark);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(this.edge, shift);\n    ctx.lineTo(this.width() - this.edge - shift, shift);\n    ctx.stroke();\n\n    ctx.shadowOffsetY = 0;\n\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        this.edge,\n        0\n    );\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrDark);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(shift, this.edge);\n    ctx.lineTo(shift, this.height() - this.edge - shift);\n    ctx.stroke();\n\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 0;\n    ctx.shadowBlur = 0;\n\n    gradient = ctx.createLinearGradient(\n        0,\n        this.height() - this.edge,\n        0,\n        this.height()\n    );\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(this.edge, this.height() - shift);\n    ctx.lineTo(this.width() - this.edge, this.height() - shift);\n    ctx.stroke();\n\n    gradient = ctx.createLinearGradient(\n        this.width() - this.edge,\n        0,\n        this.width(),\n        0\n    );\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(this.width() - shift, this.edge);\n    ctx.lineTo(this.width() - shift, this.height() - this.edge);\n    ctx.stroke();\n\n};\n\nInputSlotMorph.prototype.drawRoundBorder = function (ctx) {\n    var shift = this.edge * 0.5,\n        r = Math.max((this.height() - (this.edge * 2)) / 2, 0),\n        start,\n        end,\n        gradient;\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    // straight top edge:\n    start = r + this.edge;\n    end = this.width() - r - this.edge;\n    if (end > start) {\n\n        if (useBlurredShadows) {\n            ctx.shadowOffsetX = shift;\n            ctx.shadowOffsetY = shift;\n            ctx.shadowBlur = this.edge;\n            ctx.shadowColor = this.color.darker(80).toString();\n        }\n\n        gradient = ctx.createLinearGradient(\n            0,\n            0,\n            0,\n            this.edge\n        );\n        gradient.addColorStop(0, this.cachedClr);\n        gradient.addColorStop(1, this.cachedClrDark);\n        ctx.strokeStyle = gradient;\n        ctx.beginPath();\n\n        ctx.moveTo(start, shift);\n        ctx.lineTo(end, shift);\n        ctx.stroke();\n\n        ctx.shadowOffsetX = 0;\n        ctx.shadowOffsetY = 0;\n        ctx.shadowBlur = 0;\n    }\n\n    // straight bottom edge:\n    gradient = ctx.createLinearGradient(\n        0,\n        this.height() - this.edge,\n        0,\n        this.height()\n    );\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r + this.edge, this.height() - shift);\n    ctx.lineTo(this.width() - r - this.edge, this.height() - shift);\n    ctx.stroke();\n\n    r = Math.max(this.height() / 2, this.edge);\n\n    if (useBlurredShadows) {\n        ctx.shadowOffsetX = shift;\n        ctx.shadowOffsetY = shift;\n        ctx.shadowBlur = this.edge;\n        ctx.shadowColor = this.color.darker(80).toString();\n    }\n\n    // top edge: left corner\n    gradient = ctx.createRadialGradient(\n        r,\n        r,\n        r - this.edge,\n        r,\n        r,\n        r\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrDark);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(\n        r,\n        r,\n        r - shift,\n        radians(180),\n        radians(270),\n        false\n    );\n\n    ctx.stroke();\n\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 0;\n    ctx.shadowBlur = 0;\n\n    // bottom edge: right corner\n    gradient = ctx.createRadialGradient(\n        this.width() - r,\n        r,\n        r - this.edge,\n        this.width() - r,\n        r,\n        r\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(\n        this.width() - r,\n        r,\n        r - shift,\n        radians(0),\n        radians(90),\n        false\n    );\n    ctx.stroke();\n};\n\n// InputSlotStringMorph ///////////////////////////////////////////////\n\n/*\n    I am a piece of single-line text inside an input slot block. I serve as a\n    container for sharing typographic attributes among my instances\n*/\n\n// InputSlotStringMorph inherits from StringMorph:\n\nInputSlotStringMorph.prototype = new StringMorph();\nInputSlotStringMorph.prototype.constructor = InputSlotStringMorph;\nInputSlotStringMorph.uber = StringMorph.prototype;\n\nexport function InputSlotStringMorph(\n    text,\n    fontSize,\n    fontStyle,\n    bold,\n    italic,\n    isNumeric,\n    shadowOffset,\n    shadowColor,\n    color,\n    fontName\n) {\n    this.init(\n        text,\n        fontSize,\n        fontStyle,\n        bold,\n        italic,\n        isNumeric,\n        shadowOffset,\n        shadowColor,\n        color,\n        fontName\n    );\n}\n\nInputSlotStringMorph.prototype.getRenderColor = function () {\n    if (MorphicPreferences.isFlat) {\n        if (this.isEditable) {\n            return this.color;\n        }\n        return this.parent.alpha > 0.5 ? this.color : BLACK;\n    }\n    return this.parent.alpha > 0.25 ? this.color : WHITE;\n};\n\nInputSlotStringMorph.prototype.getShadowRenderColor = function () {\n    return this.parent.alpha > 0.25 ? this.shadowColor : CLEAR;\n};\n\n// InputSlotTextMorph ///////////////////////////////////////////////\n\n/*\n    I am a piece of multi-line text inside an input slot block. I serve as a\n    container for sharing typographic attributes among my instances\n*/\n\n// InputSlotTextMorph inherits from TextMorph:\n\nInputSlotTextMorph.prototype = new TextMorph();\nInputSlotTextMorph.prototype.constructor = InputSlotTextMorph;\nInputSlotTextMorph.uber = StringMorph.prototype;\n\nexport function InputSlotTextMorph(\n    text,\n    fontSize,\n    fontStyle,\n    bold,\n    italic,\n    alignment,\n    width,\n    fontName,\n    shadowOffset,\n    shadowColor\n) {\n    this.init(text,\n        fontSize,\n        fontStyle,\n        bold,\n        italic,\n        alignment,\n        width,\n        fontName,\n        shadowOffset,\n        shadowColor);\n}\n\nInputSlotTextMorph.prototype.getRenderColor =\n    InputSlotStringMorph.prototype.getRenderColor;\n\nInputSlotTextMorph.prototype.getShadowRenderColor =\n    InputSlotStringMorph.prototype.getShadowRenderColor;\n\n// TemplateSlotMorph ///////////////////////////////////////////////////\n\n/*\n    I am a reporter block template sitting on a pedestal.\n    My block spec is\n\n    %t        - template\n\n    evaluate returns the embedded reporter template's label string\n*/\n\n// TemplateSlotMorph inherits from ArgMorph:\n\nTemplateSlotMorph.prototype = new ArgMorph();\nTemplateSlotMorph.prototype.constructor = TemplateSlotMorph;\nTemplateSlotMorph.uber = ArgMorph.prototype;\n\n// TemplateSlotMorph instance creation:\n\nexport function TemplateSlotMorph(name) {\n    this.init(name);\n}\n\nTemplateSlotMorph.prototype.init = function (name) {\n    var template = new ReporterBlockMorph();\n    this.labelString = name || '';\n    template.isDraggable = false;\n    template.isTemplate = true;\n    if (modules.objects !== undefined) {\n        template.color = SpriteMorph.prototype.blockColor.variables;\n        template.category = 'variables';\n    } else {\n        template.color = new Color(243, 118, 29);\n        template.category = null;\n    }\n    template.setSpec(this.labelString);\n    template.selector = 'reportGetVar';\n    TemplateSlotMorph.uber.init.call(this);\n    this.add(template);\n    this.fixLayout();\n    this.isDraggable = false;\n    this.isStatic = true; // I cannot be exchanged\n};\n\n// TemplateSlotMorph accessing:\n\nTemplateSlotMorph.prototype.getSpec = function () {\n    return '%t';\n};\n\nTemplateSlotMorph.prototype.template = function () {\n    return this.children[0];\n};\n\nTemplateSlotMorph.prototype.contents = function () {\n    return this.template().blockSpec;\n};\n\nTemplateSlotMorph.prototype.setContents = function (aString) {\n    var tmp = this.template();\n    tmp.setSpec(aString);\n    tmp.fixBlockColor(); // fix zebra coloring\n    tmp.fixLabelColor();\n};\n\n// TemplateSlotMorph evaluating:\n\nTemplateSlotMorph.prototype.evaluate = function () {\n    return this.contents();\n};\n\n// TemplateSlotMorph layout:\n\nTemplateSlotMorph.prototype.fixLayout = function () {\n    var template = this.template();\n    this.bounds.setExtent(template.extent().add(this.edge * 2 + 2));\n    template.setPosition(this.position().add(this.edge + 1));\n    if (this.parent) {\n        if (this.parent.fixLayout) {\n            this.parent.fixLayout();\n        }\n    }\n};\n\n// TemplateSlotMorph drop behavior:\n\nTemplateSlotMorph.prototype.wantsDropOf = function (aMorph) {\n    return aMorph.selector === 'reportGetVar';\n};\n\nTemplateSlotMorph.prototype.reactToDropOf = function (droppedMorph) {\n    if (droppedMorph.selector === 'reportGetVar') {\n        droppedMorph.destroy();\n    }\n};\n\n// TemplateSlotMorph drawing:\n\nTemplateSlotMorph.prototype.render = function (ctx) {\n    if (this.parent instanceof Morph) {\n        this.color = this.parent.color.copy();\n    }\n    BlockMorph.prototype.render.call(this, ctx);\n};\n\nTemplateSlotMorph.prototype.outlinePath =\n    ReporterBlockMorph.prototype.outlinePathOval;\n\nTemplateSlotMorph.prototype.outlinePath =\n    ReporterBlockMorph.prototype.outlinePathOval;\n\nTemplateSlotMorph.prototype.drawEdges = ReporterBlockMorph\n    .prototype.drawEdgesOval;\n\nTemplateSlotMorph.prototype.hasLocationPin = function () {\n    return false;\n};\n\nTemplateSlotMorph.prototype.cSlots = function () {\n    return [];\n};\n\n// TemplateSlotMorph single-stepping\n\nTemplateSlotMorph.prototype.flash = function () {\n    this.template().flash();\n};\n\nTemplateSlotMorph.prototype.unflash = function () {\n    this.template().unflash();\n};\n\n// BooleanSlotMorph ////////////////////////////////////////////////////\n\n/*\n    I am a diamond-shaped argument slot.\n    My block spec is\n\n    %b         - Boolean\n    %boolUE    - Boolean unevaluated\n\n    I can be directly edited. When the user clicks on me I toggle\n    between <true>, <false> and <null> values.\n\n    evaluate() returns my value.\n\n    my most important public attributes and accessors are:\n\n    value                      - user editable contents (Boolean or null)\n    setContents(Boolean/null)  - display the argument (Boolean or null)\n*/\n\n// BooleanSlotMorph inherits from ArgMorph:\n\nBooleanSlotMorph.prototype = new ArgMorph();\nBooleanSlotMorph.prototype.constructor = BooleanSlotMorph;\nBooleanSlotMorph.uber = ArgMorph.prototype;\n\n// BooleanSlotMorph preferences settings\n\nBooleanSlotMorph.prototype.isTernary = false;\n\n// BooleanSlotMorph instance creation:\n\nexport function BooleanSlotMorph(initialValue) {\n    this.init(initialValue);\n}\n\nBooleanSlotMorph.prototype.init = function (initialValue) {\n    this.value = (typeof initialValue === 'boolean') ? initialValue : null;\n    this.isUnevaluated = false;\n    this.progress = 0; // for animation state, not persisted\n    BooleanSlotMorph.uber.init.call(this);\n    this.alpha = 1;\n    this.fixLayout();\n};\n\nBooleanSlotMorph.prototype.getSpec = function () {\n    return this.isUnevaluated ? '%boolUE' : '%b';\n};\n\n// BooleanSlotMorph accessing:\n\nBooleanSlotMorph.prototype.evaluate = function () {\n    return this.value;\n};\n\nBooleanSlotMorph.prototype.isEmptySlot = function () {\n    return this.value === null;\n};\n\nBooleanSlotMorph.prototype.isBinary = function () {\n    return !this.isTernary &&\n        isNil(this.parentThatIsA(RingMorph)) &&\n        !isNil(this.parentThatIsA(ScriptsMorph));\n};\n\nBooleanSlotMorph.prototype.setContents = function (boolOrNull) {\n    this.value = (typeof boolOrNull === 'boolean') ? boolOrNull : null;\n    this.rerender();\n};\n\nBooleanSlotMorph.prototype.toggleValue = function () {\n    var target = this.selectForEdit(),\n        ide;\n    if (target !== this) {\n        return this.toggleValue.call(target);\n    }\n    ide = this.parentThatIsA(IDE_Morph);\n    this.value = this.nextValue();\n    if (ide && !ide.isAnimating) {\n        this.rerender();\n        return;\n    }\n    this.progress = 3;\n    this.rerender();\n    this.nextSteps ([\n        () => {\n            this.progress = 2;\n            this.rerender();\n        },\n        () => {\n            this.progress = 1;\n            this.rerender();\n        },\n        () => {\n            this.progress = 0;\n            this.rerender();\n        },\n    ]);\n};\n\nBooleanSlotMorph.prototype.nextValue = function () {\n    if (this.isStatic || this.isBinary()) {\n        return !this.value;\n    }\n    switch (this.value) {\n    case true:\n        return false;\n    case false:\n        return null;\n    default:\n        return true;\n    }\n};\n\n// BooleanSlotMorph events:\n\nBooleanSlotMorph.prototype.mouseClickLeft = function () {\n    this.toggleValue();\n    if (isNil(this.value)) {return; }\n    this.reactToSliderEdit();\n};\n\nBooleanSlotMorph.prototype.mouseEnter = function () {\n    if (this.isStatic) {return; }\n    if (this.nextValue() === null) {\n        this.progress = -1; // 'fade'\n    } else {\n        this.progress = 1;\n    }\n    this.rerender();\n};\n\nBooleanSlotMorph.prototype.mouseLeave = function () {\n    if (this.isStatic) {return; }\n    this.progress = 0;\n    this.rerender();\n};\n\n// BooleanSlotMorph menu:\n\nBooleanSlotMorph.prototype.userMenu = function () {\n    var menu = new MenuMorph(this);\n    if (!StageMorph.prototype.enableCodeMapping) {\n        return this.parent.userMenu();\n    }\n    if (this.evaluate() === true) {\n        menu.addItem(\n            'code true mapping...',\n            'mapTrueToCode'\n        );\n    } else {\n        menu.addItem(\n            'code false mapping...',\n            'mapFalseToCode'\n        );\n    }\n    return menu;\n};\n\n// BooleanSlotMorph code mapping\n\n/*\n    code mapping lets you use blocks to generate arbitrary text-based\n    source code that can be exported and compiled / embedded elsewhere,\n    it's not part of Snap's evaluator and not needed for Snap itself\n*/\n\nBooleanSlotMorph.prototype.mapTrueToCode = function () {\n    // private - open a dialog box letting the user map code via the GUI\n    new DialogBoxMorph(\n        this,\n        code => StageMorph.prototype.codeMappings['true'] = code,\n        this\n    ).promptCode(\n        'Code mapping - true',\n        StageMorph.prototype.codeMappings['true'] || 'true',\n        this.world()\n    );\n};\n\nBooleanSlotMorph.prototype.mapFalseToCode = function () {\n    // private - open a dialog box letting the user map code via the GUI\n    new DialogBoxMorph(\n        this,\n        code => StageMorph.prototype.codeMappings['false'] = code,\n        this\n    ).promptCode(\n        'Code mapping - false',\n        StageMorph.prototype.codeMappings['false'] || 'false',\n        this.world()\n    );\n};\n\nBooleanSlotMorph.prototype.mappedCode = function () {\n    if (this.evaluate() === true) {\n        return StageMorph.prototype.codeMappings.boolTrue || 'true';\n    }\n    return StageMorph.prototype.codeMappings.boolFalse || 'false';\n};\n\n// BooleanSlotMorph layout:\n\nBooleanSlotMorph.prototype.fixLayout = function () {\n    // determine my extent\n    var text, h;\n    if (this.isStatic) {\n        text = this.textLabelExtent();\n        h = text.y + (this.edge * 3);\n        this.bounds.setWidth(text.x + (h * 1.5) + (this.edge * 2));\n        this.bounds.setHeight(h);\n    } else {\n        this.bounds.setWidth((this.fontSize + this.edge * 2) * 2);\n        this.bounds.setHeight(this.fontSize + this.edge * 2);\n    }\n};\n\n// BooleanSlotMorph drawing:\n\nBooleanSlotMorph.prototype.render = function (ctx) {\n    if (!(this.cachedNormalColor)) { // unless flashing\n        this.color = this.parent ?\n                this.parent.color : new Color(200, 200, 200);\n    }\n    this.cachedClr = this.color.toString();\n    this.cachedClrBright = this.bright();\n    this.cachedClrDark = this.dark();\n    this.drawDiamond(ctx, this.progress);\n    this.drawLabel(ctx);\n    this.drawKnob(ctx, this.progress);\n};\n\nBooleanSlotMorph.prototype.drawDiamond = function (ctx, progress) {\n    var w = this.width(),\n        h = this.height(),\n        r = h / 2,\n        w2 = w / 2,\n        shift = this.edge / 2,\n        gradient;\n\n    // draw the 'flat' shape:\n    if (this.cachedNormalColor) { // if flashing\n        ctx.fillStyle = this.color.toString();\n    } else if (progress < 0 ) { // 'fade'\n        ctx.fillStyle = this.color.darker(25).toString();\n    } else {\n        switch (this.value) {\n        case true:\n            ctx.fillStyle = 'rgb(0, 200, 0)';\n            break;\n        case false:\n            ctx.fillStyle = 'rgb(200, 0, 0)';\n            break;\n        default:\n            ctx.fillStyle = this.color.darker(25).toString();\n        }\n    }\n\n    if (progress > 0 && !this.isEmptySlot()) {\n        // left half:\n        ctx.fillStyle = 'rgb(0, 200, 0)';\n        ctx.beginPath();\n        ctx.moveTo(0, r);\n        ctx.lineTo(r, 0);\n        ctx.lineTo(w2, 0);\n        ctx.lineTo(w2, h);\n        ctx.lineTo(r, h);\n        ctx.closePath();\n        ctx.fill();\n\n        // right half:\n        ctx.fillStyle = 'rgb(200, 0, 0)';\n        ctx.beginPath();\n        ctx.moveTo(w2, 0);\n        ctx.lineTo(w - r, 0);\n        ctx.lineTo(w, r);\n        ctx.lineTo(w - r, h);\n        ctx.lineTo(w2, h);\n        ctx.closePath();\n        ctx.fill();\n    } else {\n        ctx.beginPath();\n        ctx.moveTo(0, r);\n        ctx.lineTo(r, 0);\n        ctx.lineTo(w - r, 0);\n        ctx.lineTo(w, r);\n        ctx.lineTo(w - r, h);\n        ctx.lineTo(r, h);\n        ctx.closePath();\n        ctx.fill();\n    }\n\n    if (MorphicPreferences.isFlat) {return; }\n\n    // add 3D-Effect:\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    if (useBlurredShadows) {\n        ctx.shadowOffsetX = shift;\n        ctx.shadowBlur = shift;\n        ctx.shadowColor = 'black';\n    }\n\n    // top edge: left corner\n    gradient = ctx.createLinearGradient(\n        0,\n        r,\n        this.edge * 0.6,\n        r + (this.edge * 0.6)\n    );\n    gradient.addColorStop(1, this.cachedClrDark);\n    gradient.addColorStop(0, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(shift, r);\n    ctx.lineTo(r, shift);\n    ctx.closePath();\n    ctx.stroke();\n\n    // top edge: straight line\n    if (useBlurredShadows) {\n        ctx.shadowOffsetX = 0;\n        ctx.shadowOffsetY = shift;\n        ctx.shadowBlur = this.edge;\n    }\n\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        0,\n        this.edge\n    );\n    gradient.addColorStop(1, this.cachedClrDark);\n    gradient.addColorStop(0, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r, shift);\n    ctx.lineTo(w - r, shift);\n    ctx.closePath();\n    ctx.stroke();\n\n    ctx.shadowOffsetY = 0;\n    ctx.shadowBlur = 0;\n\n    // bottom edge: right corner\n    gradient = ctx.createLinearGradient(\n        w - r - (this.edge * 0.6),\n        h - (this.edge * 0.6),\n        w - r,\n        h\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(w - r, h - shift);\n    ctx.lineTo(w - shift, r);\n    ctx.closePath();\n    ctx.stroke();\n\n    // bottom edge: straight line\n    gradient = ctx.createLinearGradient(\n        0,\n        h - this.edge,\n        0,\n        h\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r, h - shift);\n    ctx.lineTo(w - r - shift, h - shift);\n    ctx.closePath();\n    ctx.stroke();\n};\n\nBooleanSlotMorph.prototype.drawLabel = function (ctx) {\n    var w = this.width(),\n        r = this.height() / 2 - this.edge,\n        r2 = r / 2,\n        shift = this.edge / 2,\n        text,\n        x,\n        y = this.height() / 2;\n\n    if (this.isEmptySlot() || this.progress < 0) {\n        return;\n    }\n\n    if (this.isStatic) { // draw the full text label\n        text = this.textLabelExtent();\n        y = this.height() - (this.height() - text.y) / 2;\n        if (this.value) {\n            x = this.height() / 2;\n        } else {\n            x = this.width() - (this.height() / 2) - text.x;\n        }\n        ctx.save();\n        if (!MorphicPreferences.isFlat && useBlurredShadows) {\n            ctx.shadowOffsetX = -shift;\n            ctx.shadowOffsetY = -shift;\n            ctx.shadowBlur = shift;\n            ctx.shadowColor = this.value ? 'rgb(0, 100, 0)' : 'rgb(100, 0, 0)';\n        }\n        ctx.font = new StringMorph(null, this.fontSize, null, true).font();\n        ctx.textAlign = 'left';\n        ctx.textBaseline = 'bottom';\n        ctx.fillStyle = 'rgb(255, 255, 255';\n        ctx.fillText(\n            localize(this.value ? 'true' : 'false'),\n            x,\n            y\n        );\n        ctx.restore();\n        return;\n    }\n\n    // \"tick:\"\n    x = r + (this.edge * 2) + shift;\n    if (!MorphicPreferences.isFlat && useBlurredShadows) {\n        ctx.shadowOffsetX = -shift;\n        ctx.shadowOffsetY = -shift;\n        ctx.shadowBlur = shift;\n        ctx.shadowColor = 'rgb(0, 100, 0)';\n    }\n    ctx.strokeStyle = 'white';\n    ctx.lineWidth = this.edge + shift;\n    ctx.lineCap = 'round';\n    ctx.lineJoin = 'miter';\n    ctx.beginPath();\n    ctx.moveTo(x - r2, y);\n    ctx.lineTo(x, y + r2);\n    ctx.lineTo(x + r2, r2 + this.edge);\n    ctx.stroke();\n\n    // \"cross:\"\n    x = w - y - (this.edge * 2);\n    if (!MorphicPreferences.isFlat && useBlurredShadows) {\n        ctx.shadowOffsetX = -shift;\n        ctx.shadowOffsetY = -shift;\n        ctx.shadowBlur = shift;\n        ctx.shadowColor = 'rgb(100, 0, 0)';\n    }\n    ctx.strokeStyle = 'white';\n    ctx.lineWidth = this.edge;\n    ctx.lineCap = 'butt';\n    ctx.beginPath();\n    ctx.moveTo(x - r2, y - r2);\n    ctx.lineTo(x + r2, y + r2);\n    ctx.moveTo(x - r2, y + r2);\n    ctx.lineTo(x + r2, y - r2);\n    ctx.stroke();\n};\n\nBooleanSlotMorph.prototype.drawKnob = function (ctx, progress) {\n    var w = this.width(),\n        r = this.height() / 2,\n        shift = this.edge / 2,\n        slideStep = (this.width() - this.height()) / 4 * Math.max(0, (progress || 0)),\n        gradient,\n        x,\n        y = r,\n        outline = PushButtonMorph.prototype.outline / 2,\n        outlineColor = PushButtonMorph.prototype.outlineColor,\n        color = PushButtonMorph.prototype.color,\n        contrast = PushButtonMorph.prototype.contrast,\n        topColor = color.lighter(contrast),\n        bottomColor = color.darker(contrast);\n\n    // draw the 'flat' shape:\n    switch (this.value) {\n    case false:\n        x = r + slideStep;\n        if (!MorphicPreferences.isFlat && useBlurredShadows) {\n            ctx.shadowOffsetX = shift;\n            ctx.shadowOffsetY = 0;\n            ctx.shadowBlur = shift;\n            ctx.shadowColor = 'black';\n        }\n        if (progress < 0) {\n            ctx.globalAlpha = 0.6;\n        }\n        break;\n    case true:\n        x = w - r - slideStep;\n        if (!MorphicPreferences.isFlat) {\n            ctx.shadowOffsetX = 0;\n            ctx.shadowOffsetY = 0;\n            ctx.shadowBlur = 0;\n        }\n        break;\n    default:\n        if (!progress) {return; }\n        x = r;\n        if (!MorphicPreferences.isFlat && useBlurredShadows) {\n            ctx.shadowOffsetX = shift;\n            ctx.shadowOffsetY = 0;\n            ctx.shadowBlur = shift;\n            ctx.shadowColor = 'black';\n        }\n        ctx.globalAlpha = 0.6;\n    }\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    ctx.arc(x, y, r, radians(0), radians(360));\n    ctx.closePath();\n    ctx.fill();\n\n    if (MorphicPreferences.isFlat) {\n        ctx.globalAlpha = 1;\n        return;\n    }\n\n    // add 3D-Effect\n    // outline:\n    ctx.shadowOffsetX = 0;\n    ctx.shadowBlur = 0;\n    ctx.shadowColor = 'black';\n    ctx.lineWidth = outline;\n    ctx.strokeStyle = outlineColor.toString();\n    ctx.beginPath();\n    ctx.arc(x, y, r - (outline / 2), radians(0), radians(360));\n    ctx.stroke();\n\n    if (r < outline + this.edge) {\n        return;\n    }\n\n    // top-left:\n    gradient = ctx.createRadialGradient(\n        x,\n        y,\n        r - outline - this.edge,\n        x,\n        y,\n        r - outline\n    );\n    gradient.addColorStop(1, topColor.toString());\n    gradient.addColorStop(0, color.toString());\n\n    ctx.strokeStyle = gradient;\n    ctx.lineCap = 'round';\n    ctx.lineWidth = this.edge;\n    ctx.beginPath();\n    ctx.arc(\n        x,\n        y,\n        r - outline - this.edge / 2,\n        radians(180),\n        radians(270),\n        false\n    );\n    ctx.stroke();\n\n    // bottom-right:\n    gradient = ctx.createRadialGradient(\n        x,\n        y,\n        r - outline - this.edge,\n        x,\n        y,\n        r - outline\n    );\n    gradient.addColorStop(1, bottomColor.toString());\n    gradient.addColorStop(0, color.toString());\n\n    ctx.strokeStyle = gradient;\n    ctx.lineCap = 'round';\n    ctx.lineWidth = this.edge;\n    ctx.beginPath();\n    ctx.arc(\n        x,\n        y,\n        r - outline - this.edge / 2,\n        radians(0),\n        radians(90),\n        false\n    );\n    ctx.stroke();\n    ctx.globalAlpha = 1;\n};\n\nBooleanSlotMorph.prototype.textLabelExtent = function () {\n    var t, f;\n    t = new StringMorph(\n        localize('true'),\n        this.fontSize,\n        null,\n        true // bold\n    );\n    f = new StringMorph(\n        localize('false'),\n        this.fontSize,\n        null,\n        true // bold\n    );\n    return new Point(Math.max(t.width(), f.width()), t.height());\n};\n\n// ArrowMorph //////////////////////////////////////////////////////////\n\n/*\n    I am a triangular arrow shape, for use in drop-down menus etc.\n    My orientation is governed by my 'direction' property, which can be\n    'down', 'up', 'left' or 'right'.\n*/\n\n// ArrowMorph inherits from Morph:\n\nArrowMorph.prototype = new Morph();\nArrowMorph.prototype.constructor = ArrowMorph;\nArrowMorph.uber = Morph.prototype;\n\n// ArrowMorph instance creation:\n\nexport function ArrowMorph(direction, size, padding, color, isBlockLabel) {\n    this.init(direction, size, padding, color, isBlockLabel);\n}\n\nArrowMorph.prototype.init = function (direction, size, padding, color, isLbl) {\n    this.direction = direction || 'down';\n    this.size = size || ((size === 0) ? 0 : 50);\n    this.padding = padding || 0;\n    this.isBlockLabel = isLbl || false;\n\n    ArrowMorph.uber.init.call(this);\n    this.color = color || BLACK;\n    this.bounds.setWidth(this.size);\n    this.bounds.setHeight(this.size);\n    this.rerender();\n};\n\nArrowMorph.prototype.setSize = function (size) {\n    var min = Math.max(size, 1);\n    this.size = size;\n    this.changed();\n    this.bounds.setWidth(min);\n    this.bounds.setHeight(min);\n    this.rerender();\n};\n\n// ArrowMorph displaying:\n\nArrowMorph.prototype.render = function (ctx) {\n    // initialize my surface property\n    var pad = this.padding,\n        h = this.height(),\n        h2 = Math.floor(h / 2),\n        w = this.width(),\n        w2 = Math.floor(w / 2);\n\n    ctx.fillStyle = this.getRenderColor().toString();\n    ctx.beginPath();\n    if (this.direction === 'down') {\n        ctx.moveTo(pad, h2);\n        ctx.lineTo(w - pad, h2);\n        ctx.lineTo(w2, h - pad);\n    } else if (this.direction === 'up') {\n        ctx.moveTo(pad, h2);\n        ctx.lineTo(w - pad, h2);\n        ctx.lineTo(w2, pad);\n    } else if (this.direction === 'left') {\n        ctx.moveTo(pad, h2);\n        ctx.lineTo(w2, pad);\n        ctx.lineTo(w2, h - pad);\n    } else { // 'right'\n        ctx.moveTo(w2, pad);\n        ctx.lineTo(w - pad, h2);\n        ctx.lineTo(w2, h - pad);\n    }\n    ctx.closePath();\n    ctx.fill();\n};\n\nArrowMorph.prototype.getRenderColor = function () {\n    if (this.isBlockLabel) {\n        if (MorphicPreferences.isFlat) {\n            return this.color;\n        }\n        return SyntaxElementMorph.prototype.alpha > 0.5 ? this.color : WHITE;\n    }\n    return this.color;\n};\n\n// TextSlotMorph //////////////////////////////////////////////////////\n\n/*\n    I am a multi-line input slot, primarily used in Snap's code-mapping\n    blocks.\n*/\n\n// TextSlotMorph inherits from InputSlotMorph:\n\nTextSlotMorph.prototype = new InputSlotMorph();\nTextSlotMorph.prototype.constructor = TextSlotMorph;\nTextSlotMorph.uber = InputSlotMorph.prototype;\n\n// TextSlotMorph instance creation:\n\nexport function TextSlotMorph(text, isNumeric, choiceDict, isReadOnly) {\n    this.init(text, isNumeric, choiceDict, isReadOnly);\n}\n\nTextSlotMorph.prototype.init = function (\n    text,\n    isNumeric,\n    choiceDict,\n    isReadOnly\n) {\n    var contents = new InputSlotTextMorph(''),\n        arrow = new ArrowMorph(\n            'down',\n            0,\n            Math.max(Math.floor(this.fontSize / 6), 1),\n            BLACK,\n            true\n        );\n\n    contents.fontSize = this.fontSize;\n    contents.fixLayout();\n\n    this.isUnevaluated = false;\n    this.choices = choiceDict || null; // object, function or selector\n    this.oldContentsExtent = contents.extent();\n    this.isNumeric = isNumeric || false;\n    this.isReadOnly = isReadOnly || false;\n    this.minWidth = 0; // can be chaged for text-type inputs (\"landscape\")\n    this.constant = null;\n\n    InputSlotMorph.uber.init.call(this, null, null, null, null, true); // sil.\n    this.color = WHITE;\n    this.add(contents);\n    this.add(arrow);\n    contents.isEditable = true;\n    contents.isDraggable = false;\n    contents.enableSelecting();\n    this.setContents(text);\n\n};\n\n// TextSlotMorph accessing:\n\nTextSlotMorph.prototype.getSpec = function () {\n    if (this.isNumeric) {\n        return '%mlt';\n    }\n    return '%mlt'; // default\n};\n\nTextSlotMorph.prototype.contents = function () {\n    return detect(\n        this.children,\n        child => child instanceof TextMorph\n    );\n};\n\n// TextSlotMorph events:\n\nTextSlotMorph.prototype.layoutChanged = function () {\n    this.fixLayout();\n};\n\n// ColorSlotMorph //////////////////////////////////////////////////////\n\n/*\n    I am an editable input slot for a color. Users can edit my color by\n    clicking on me, in which case a display a color gradient palette\n    and let the user select another color. Note that the user isn't\n    restricted to selecting a color from the palette, any color from\n    anywhere within the World can be chosen.\n\n    my block spec is %clr\n\n    evaluate() returns my color\n*/\n\n// ColorSlotMorph  inherits from ArgMorph:\n\nColorSlotMorph.prototype = new ArgMorph();\nColorSlotMorph.prototype.constructor = ColorSlotMorph;\nColorSlotMorph.uber = ArgMorph.prototype;\n\n// ColorSlotMorph  instance creation:\n\nexport function ColorSlotMorph(clr) {\n    this.init(clr);\n}\n\nColorSlotMorph.prototype.init = function (clr) {\n    ColorSlotMorph.uber.init.call(this);\n    this.alpha = 1;\n    this.setColor(clr || new Color(145, 26, 68));\n};\n\nColorSlotMorph.prototype.getSpec = function () {\n    return '%clr';\n};\n\n// ColorSlotMorph  color sensing:\n\nColorSlotMorph.prototype.getUserColor = function () {\n    var myself = this,\n        world = this.world(),\n        hand = world.hand,\n        posInDocument = getDocumentPositionOf(world.worldCanvas),\n        mouseMoveBak = hand.processMouseMove,\n        mouseDownBak = hand.processMouseDown,\n        mouseUpBak = hand.processMouseUp,\n        pal = new ColorPaletteMorph(null, new Point(\n            this.fontSize * 16,\n            this.fontSize * 10\n        ));\n    world.add(pal);\n    pal.setPosition(this.bottomLeft().add(new Point(0, this.edge)));\n\n    hand.processMouseMove = function (event) {\n        var clr = world.getGlobalPixelColor(hand.position());\n        hand.setPosition(new Point(\n            event.pageX - posInDocument.x,\n            event.pageY - posInDocument.y\n        ));\n        if (!clr.a) {\n            // ignore transparent,\n            // needed for retina-display support\n            return;\n        }\n        myself.setColor(clr);\n    };\n\n    hand.processMouseDown = nop;\n\n    hand.processMouseUp = function () {\n        // Trace.log('ColorArg.changeColor', {\n        //     'id': myself.argId(),\n        //     'color': myself.color,\n        // });\n        pal.destroy();\n        hand.processMouseMove = mouseMoveBak;\n        hand.processMouseDown = mouseDownBak;\n        hand.processMouseUp = mouseUpBak;\n    };\n};\n\n// ColorSlotMorph events:\n\nColorSlotMorph.prototype.mouseClickLeft = function () {\n    this.selectForEdit().getUserColor();\n};\n\n// ColorSlotMorph evaluating:\n\nColorSlotMorph.prototype.evaluate = function () {\n    return this.color;\n};\n\n// ColorSlotMorph drawing:\n\nColorSlotMorph.prototype.fixLayout = function () {\n    // determine my extent\n    var side = this.fontSize + this.edge * 2 + this.typeInPadding * 2;\n    this.bounds.setWidth(side);\n    this.bounds.setHeight(side);\n};\n\nColorSlotMorph.prototype.render = function (ctx) {\n    var borderColor;\n\n    if (this.parent) {\n        borderColor = this.parent.color;\n    } else {\n        borderColor = new Color(120, 120, 120);\n    }\n    ctx.fillStyle = this.color.toString();\n\n    // cache my border colors\n    this.cachedClr = borderColor.toString();\n    this.cachedClrBright = borderColor.lighter(this.contrast)\n        .toString();\n    this.cachedClrDark = borderColor.darker(this.contrast).toString();\n\n    ctx.fillRect(\n        this.edge,\n        this.edge,\n        this.width() - this.edge * 2,\n        this.height() - this.edge * 2\n    );\n    if (!MorphicPreferences.isFlat) {\n        this.drawRectBorder(ctx);\n    }\n};\n\nColorSlotMorph.prototype.drawRectBorder =\n    InputSlotMorph.prototype.drawRectBorder;\n\n// BlockHighlightMorph /////////////////////////////////////////////////\n\n/*\n    I am a glowing halo around a block or stack of blocks indicating that\n    a script is currently active or has encountered an error.\n    I halso have an optional readout that can display a thread count\n    if more than one process shares the same script\n*/\n\n// BlockHighlightMorph inherits from Morph:\n\nBlockHighlightMorph.prototype = new Morph();\nBlockHighlightMorph.prototype.constructor = BlockHighlightMorph;\nBlockHighlightMorph.uber = Morph.prototype;\n\n// BlockHighlightMorph instance creation:\n\nexport function BlockHighlightMorph() {\n    this.threadCount = 0;\n    this.init();\n}\n\nBlockHighlightMorph.prototype.init = function () {\n    BlockHighlightMorph.uber.init.call(this);\n    this.isCachingImage = true;\n};\n\n// BlockHighlightMorph thread count readout\n\nBlockHighlightMorph.prototype.readout = function () {\n    return this.children.length ? this.children[0] : null;\n};\n\nBlockHighlightMorph.prototype.updateReadout = function () {\n    var readout = this.readout(),\n        inset = useBlurredShadows && !MorphicPreferences.isFlat ?\n            SyntaxElementMorph.prototype.activeBlur * 0.4\n                : SyntaxElementMorph.prototype.activeBorder * -2;\n    if (this.threadCount < 2) {\n        if (readout) {\n            readout.destroy();\n        }\n        return;\n    }\n    if (readout) {\n        readout.changed();\n        readout.contents = this.threadCount.toString();\n        readout.fixLayout();\n        readout.rerender();\n    } else {\n        readout = new SpeechBubbleMorph(\n            this.threadCount.toString(),\n            this.color, // color,\n            null, // edge,\n            null, // border,\n            this.color.darker(), // borderColor,\n            null, // padding,\n            1, // isThought - don't draw a hook\n            true // no shadow - faster\n        );\n        this.add(readout);\n    }\n    readout.setPosition(this.position().add(inset));\n};\n\n// MultiArgMorph ///////////////////////////////////////////////////////\n\n/*\n    I am an arity controlled list of input slots\n\n    my block specs are\n\n        %mult%x - where x is any single input slot\n        %inputs - for an additional text label 'with inputs'\n\n    evaluation is handles by the interpreter\n*/\n\n// MultiArgMorph inherits from ArgMorph:\n\nMultiArgMorph.prototype = new ArgMorph();\nMultiArgMorph.prototype.constructor = MultiArgMorph;\nMultiArgMorph.uber = ArgMorph.prototype;\n\n// MultiArgMorph instance creation:\n\nexport function MultiArgMorph(\n    slotSpec,\n    labelTxt,\n    min,\n    eSpec,\n    arrowColor,\n    labelColor,\n    shadowColor,\n    shadowOffset,\n    isTransparent\n) {\n    this.init(\n        slotSpec,\n        labelTxt,\n        min,\n        eSpec,\n        arrowColor,\n        labelColor,\n        shadowColor,\n        shadowOffset,\n        isTransparent\n    );\n}\n\nMultiArgMorph.prototype.init = function (\n    slotSpec,\n    labelTxt,\n    min,\n    eSpec,\n    arrowColor,\n    labelColor,\n    shadowColor,\n    shadowOffset,\n    isTransparent\n) {\n    var label,\n        arrows = new FrameMorph(),\n        leftArrow,\n        rightArrow,\n        i;\n\n    this.slotSpec = slotSpec || '%s';\n    this.labelText = localize(labelTxt || '');\n    this.minInputs = min || 0;\n    this.elementSpec = eSpec || null;\n    this.labelColor = labelColor || null;\n    this.shadowColor = shadowColor || null;\n    this.shadowOffset = shadowOffset || null;\n\n    this.canBeEmpty = true;\n    MultiArgMorph.uber.init.call(this);\n\n    // MultiArgMorphs are transparent by default b/c of zebra coloring\n    this.alpha = isTransparent === false ? 1 : 0;\n    arrows.alpha = isTransparent === false ? 1 : 0;\n\n    // label text:\n    if (this.labelText || (this.slotSpec === '%cs')) {\n        label = this.labelPart(this.labelText);\n        this.add(label);\n        label.hide();\n    }\n\n    // left arrow:\n    leftArrow = new ArrowMorph(\n        'left',\n        this.fontSize,\n        Math.max(Math.floor(this.fontSize / 6), 1),\n        arrowColor,\n        true\n    );\n\n    // right arrow:\n    rightArrow = new ArrowMorph(\n        'right',\n        this.fontSize,\n        Math.max(Math.floor(this.fontSize / 6), 1),\n        arrowColor,\n        true\n    );\n\n    // control panel:\n    arrows.add(leftArrow);\n    arrows.add(rightArrow);\n    arrows.rerender();\n    arrows.acceptsDrops = false;\n\n    this.add(arrows);\n\n    // create the minimum number of inputs\n    for (i = 0; i < this.minInputs; i += 1) {\n        this.addInput();\n    }\n};\n\nMultiArgMorph.prototype.label = function () {\n    return this.labelText ? this.children[0] : null;\n};\n\nMultiArgMorph.prototype.arrows = function () {\n    return this.children[this.children.length - 1];\n};\n\nMultiArgMorph.prototype.getSpec = function () {\n    return '%mult' + this.slotSpec;\n};\n\n// MultiArgMorph defaults:\n\nMultiArgMorph.prototype.setContents = function (anArray) {\n    var inputs = this.inputs(), i;\n    for (i = 0; i < anArray.length; i += 1) {\n        if (anArray[i] !== null && (inputs[i])) {\n            inputs[i].setContents(anArray[i]);\n        }\n    }\n};\n\n// MultiArgMorph hiding and showing:\n\n/*\n    override the inherited behavior to recursively hide/show all\n    children, so that my instances get restored correctly when\n    switching back out of app mode.\n*/\n\nMultiArgMorph.prototype.hide = function () {\n    this.isVisible = false;\n    this.changed();\n};\n\nMultiArgMorph.prototype.show = function () {\n    this.isVisible = true;\n    this.changed();\n};\n\n// MultiArgMorph coloring:\n\nMultiArgMorph.prototype.setLabelColor = function (\n    textColor,\n    shadowColor,\n    shadowOffset\n) {\n    this.textColor = textColor;\n    this.shadowColor = shadowColor;\n    this.shadowOffset = shadowOffset;\n    MultiArgMorph.uber.setLabelColor.call(\n        this,\n        textColor,\n        shadowColor,\n        shadowOffset\n    );\n};\n\n// MultiArgMorph layout:\n\nMultiArgMorph.prototype.fixLayout = function () {\n    var label, shadowColor, shadowOffset;\n    if (this.slotSpec === '%t') {\n        this.isStatic = true; // in this case I cannot be exchanged\n    }\n    if (this.parent) {\n        label = this.label();\n        this.color = this.parent.color;\n        this.arrows().color = this.color;\n        if (label) {\n            shadowColor = this.shadowColor ||\n                this.parent.color.darker(this.labelContrast);\n            shadowOffset = this.shadowOffset ||\n                (label ? label.shadowOffset : null);\n            if (!label.shadowColor.eq(shadowColor)) {\n                label.shadowColor = shadowColor;\n                label.shadowOffset = shadowOffset;\n                label.fixLayout();\n                label.rerender();\n            }\n        }\n\n    }\n    this.fixArrowsLayout();\n    MultiArgMorph.uber.fixLayout.call(this);\n    if (this.parent) {\n        this.parent.fixLayout();\n    }\n};\n\nMultiArgMorph.prototype.fixArrowsLayout = function () {\n    var label = this.label(),\n        arrows = this.arrows(),\n        leftArrow = arrows.children[0],\n        rightArrow = arrows.children[1],\n        inpCount = this.inputs().length,\n        dim = new Point(rightArrow.width() / 2, rightArrow.height());\n    if (inpCount < (this.minInputs + 1)) { // hide left arrow\n        if (label) {\n            label.hide();\n        }\n        leftArrow.hide();\n        rightArrow.setPosition(\n            arrows.position().subtract(new Point(dim.x, 0))\n        );\n        arrows.setExtent(dim);\n    } else if (this.is3ArgRingInHOF() && inpCount > 2) { // hide right arrow\n        rightArrow.hide();\n        arrows.setExtent(dim);\n    } else {\n        if (label) {\n            label.show();\n        }\n        leftArrow.show();\n        rightArrow.show();\n        rightArrow.setPosition(leftArrow.topCenter());\n        arrows.bounds.corner = rightArrow.bottomRight().copy();\n    }\n    arrows.rerender();\n};\n\nMultiArgMorph.prototype.fixHolesLayout = function () {\n    var pos;\n    this.holes = [];\n    if (this.slotSpec === '%cs') {\n        pos = this.position();\n        this.inputs().forEach(slot => {\n            if (slot instanceof CSlotMorph) {\n                slot.fixHolesLayout();\n                this.holes.push(\n                    slot.holes[0].translateBy(slot.position().subtract(pos))\n                );\n            }\n        });\n    }\n};\n\nMultiArgMorph.prototype.refresh = function () {\n    this.inputs().forEach(input => {\n        input.fixLayout();\n        input.rerender();\n    });\n};\n\n// MultiArgMorph arity control:\n\nMultiArgMorph.prototype.addInput = function (contents) {\n    var i, name,\n        newPart = this.labelPart(this.slotSpec),\n        idx = this.children.length - 1;\n    if (contents) {\n        newPart.setContents(contents);\n    } else if (this.elementSpec === '%scriptVars' ||\n            this.elementSpec === '%blockVars') {\n        name = '';\n        i = idx;\n        if (this.elementSpec === '%scriptVars') {\n            // compensate for missing label element\n            i += 1;\n        }\n        while (i > 0) {\n            name = String.fromCharCode(97 + (i - 1) % 26) + name;\n            i = Math.floor((i - 1) / 26);\n        }\n        newPart.setContents(name);\n    } else if (contains(['%parms', '%ringparms'], this.elementSpec)) {\n        if (this.is3ArgRingInHOF() && idx < 4) {\n            newPart.setContents([\n                localize('value'),\n                localize('index'),\n                localize('list')\n            ][idx - 1]);\n        } else {\n            newPart.setContents('#' + idx);\n        }\n    }\n    newPart.parent = this;\n    this.children.splice(idx, 0, newPart);\n    newPart.fixLayout();\n    this.fixLayout();\n    return newPart;\n};\n\nMultiArgMorph.prototype.removeInput = function () {\n    var oldPart, scripts;\n    if (this.children.length > 1) {\n        oldPart = this.children[this.children.length - 2];\n        this.removeChild(oldPart);\n        if (oldPart instanceof BlockMorph &&\n                !(oldPart instanceof RingMorph && !oldPart.contents())) {\n            scripts = this.parentThatIsA(ScriptsMorph);\n            if (scripts) {\n                scripts.add(oldPart);\n            }\n        }\n    }\n    this.fixLayout();\n};\n\nMultiArgMorph.prototype.is3ArgRingInHOF = function () {\n    // answer true if I am embedded into a ring inside a HOF block\n    // that supports 3 parameters (\"item, idx, data\")\n    // of which there are currently only MAP, KEEP and FIND\n    // and their atomic counterparts\n    var ring = this.parent,\n        block;\n    if (ring) {\n        block = ring.parent;\n        if (block instanceof ReporterBlockMorph) {\n            return block.inputs()[0] === ring &&\n                contains(\n                    [\n                        'reportMap',\n                        'reportAtomicMap',\n                        'reportKeep',\n                        'reportAtomicKeep',\n                        'reportFindFirst',\n                        'reportAtomicFindFirst'\n                    ],\n                    block.selector\n                );\n        }\n    }\n    return false;\n};\n\n// MultiArgMorph events:\n\nMultiArgMorph.prototype.mouseClickLeft = function (pos) {\n    // prevent expansion in the palette\n    // (because it can be hard or impossible to collapse again)\n    if (!this.parentThatIsA(ScriptsMorph)) {\n        this.escalateEvent('mouseClickLeft', pos);\n        return;\n    }\n    // if the <shift> key is pressed, repeat action 3 times\n    var target = this.selectForEdit(),\n        arrows = target.arrows(),\n        leftArrow = arrows.children[0],\n        rightArrow = arrows.children[1],\n        repetition = target.world().currentKey === 16 ? 3 : 1,\n        i;\n\n    if (rightArrow.bounds.containsPoint(pos)) {\n        for (i = 0; i < repetition; i += 1) {\n            if (rightArrow.isVisible) {\n                // Trace.log('MultiArg.addInput', this.argId());\n                target.addInput();\n            }\n        }\n    } else if (\n        leftArrow.bounds.expandBy(this.fontSize / 3).containsPoint(pos)\n    ) {\n        for (i = 0; i < repetition; i += 1) {\n            if (leftArrow.isVisible) {\n                // Trace.log('MultiArg.removeInput', this.argId());\n                target.removeInput();\n            }\n        }\n    } else {\n        target.escalateEvent('mouseClickLeft', pos);\n    }\n};\n\n// MultiArgMorph menu:\n\nMultiArgMorph.prototype.userMenu = function () {\n    var menu = new MenuMorph(this),\n        block = this.parentThatIsA(BlockMorph),\n        key = '';\n    if (!StageMorph.prototype.enableCodeMapping) {\n        return this.parent.userMenu();\n    }\n    if (block) {\n        if (block instanceof RingMorph) {\n            key = 'parms_';\n        } else if (block.selector === 'doDeclareVariables') {\n            key = 'tempvars_';\n        }\n    }\n    menu.addItem(\n        'code list mapping...',\n        () => this.mapCodeList(key)\n    );\n    menu.addItem(\n        'code item mapping...',\n        () => this.mapCodeItem(key)\n    );\n    menu.addItem(\n        'code delimiter mapping...',\n        () => this.mapCodeDelimiter(key)\n    );\n    return menu;\n};\n\n// MultiArgMorph code mapping\n\n/*\n    code mapping lets you use blocks to generate arbitrary text-based\n    source code that can be exported and compiled / embedded elsewhere,\n    it's not part of Snap's evaluator and not needed for Snap itself\n*/\n\nMultiArgMorph.prototype.mapCodeDelimiter = function (key) {\n    this.mapToCode(key + 'delim', 'list item delimiter');\n};\n\nMultiArgMorph.prototype.mapCodeList = function (key) {\n    this.mapToCode(key + 'list', 'list contents <#1>');\n};\n\nMultiArgMorph.prototype.mapCodeItem = function (key) {\n    this.mapToCode(key + 'item', 'list item <#1>');\n};\n\nMultiArgMorph.prototype.mapToCode = function (key, label) {\n    // private - open a dialog box letting the user map code via the GUI\n    new DialogBoxMorph(\n        this,\n        code => StageMorph.prototype.codeMappings[key] = code,\n        this\n    ).promptCode(\n        'Code mapping - ' + label,\n        StageMorph.prototype.codeMappings[key] || '',\n        this.world()\n    );\n};\n\nMultiArgMorph.prototype.mappedCode = function (definitions) {\n    var block = this.parentThatIsA(BlockMorph),\n        key = '',\n        code,\n        items = '',\n        itemCode,\n        delim,\n        count = 0,\n        parts = [];\n\n    if (block) {\n        if (block instanceof RingMorph) {\n            key = 'parms_';\n        } else if (block.selector === 'doDeclareVariables') {\n            key = 'tempvars_';\n        }\n    }\n\n    code = StageMorph.prototype.codeMappings[key + 'list'] || '<#1>';\n    itemCode = StageMorph.prototype.codeMappings[key + 'item'] || '<#1>';\n    delim = StageMorph.prototype.codeMappings[key + 'delim'] || ' ';\n\n    this.inputs().forEach(input =>\n        parts.push(itemCode.replace(/<#1>/g, input.mappedCode(definitions)))\n    );\n    parts.forEach(part => {\n        if (count) {\n            items += delim;\n        }\n        items += part;\n        count += 1;\n    });\n    code = code.replace(/<#1>/g, items);\n    return code;\n};\n\n// MultiArgMorph arity evaluating:\n\nMultiArgMorph.prototype.evaluate = function () {\n    // this is usually overridden by the interpreter. This method is only\n    // called (and needed) for the variables menu.\n\n    var result = [];\n    this.inputs().forEach(slot =>\n        result.push(slot.evaluate())\n    );\n    return result;\n};\n\nMultiArgMorph.prototype.isEmptySlot = function () {\n    return this.canBeEmpty ? this.inputs().length === 0 : false;\n};\n\n// ArgLabelMorph ///////////////////////////////////////////////////////\n\n/*\n    I am a label string that is wrapped around an ArgMorph, usually\n    a MultiArgMorph, so to indicate that it has been replaced entirely\n    for an embedded reporter block\n\n    I don't have a block spec, I get embedded automatically by the parent\n    block's argument replacement mechanism\n\n    My evaluation method is the identity function, i.e. I simply pass my\n    input's value along.\n*/\n\n// ArgLabelMorph inherits from ArgMorph:\n\nArgLabelMorph.prototype = new ArgMorph();\nArgLabelMorph.prototype.constructor = ArgLabelMorph;\nArgLabelMorph.uber = ArgMorph.prototype;\n\n// MultiArgMorph instance creation:\n\nexport function ArgLabelMorph(argMorph, labelTxt) {\n    this.init(argMorph, labelTxt);\n}\n\nArgLabelMorph.prototype.init = function (argMorph, labelTxt) {\n    var label;\n\n    this.labelText = localize(labelTxt || 'input list:');\n    ArgLabelMorph.uber.init.call(this);\n\n    this.isStatic = true; // I cannot be exchanged\n\n    // ArgLabelMorphs are transparent\n    this.alpha = 0;\n\n    // label text:\n    label = this.labelPart(this.labelText);\n    this.add(label);\n\n    // argMorph\n    this.add(argMorph);\n};\n\nArgLabelMorph.prototype.label = function () {\n    return this.children[0];\n};\n\nArgLabelMorph.prototype.argMorph = function () {\n    return this.children[1];\n};\n\n// ArgLabelMorph layout:\n\nArgLabelMorph.prototype.fixLayout = function () {\n    var label = this.label(),\n        shadowColor,\n        shadowOffset;\n\n    if (this.parent) {\n        this.color = this.parent.color;\n        shadowOffset = label.shadowOffset || ZERO;\n\n        // determine the shadow color for zebra coloring:\n        if (shadowOffset.x < 0) {\n            shadowColor = this.parent.color.darker(this.labelContrast);\n        } else {\n            shadowColor = this.parent.color.lighter(this.labelContrast);\n        }\n\n        if (this.labelText !== '') {\n            if (!label.shadowColor.eq(shadowColor)) {\n                label.shadowColor = shadowColor;\n                label.shadowOffset = shadowOffset;\n                label.rerender();\n            }\n        }\n    }\n    ArgLabelMorph.uber.fixLayout.call(this);\n    if (this.parent) {\n        this.parent.fixLayout();\n    }\n};\n\nArgLabelMorph.prototype.refresh = function () {\n    this.inputs().forEach(input => {\n        input.fixLayout();\n        input.rerender();\n    });\n};\n\n// ArgLabelMorph label color:\n\nArgLabelMorph.prototype.setLabelColor = function (\n    textColor,\n    shadowColor,\n    shadowOffset\n) {\n    if (this.labelText !== '') {\n        var label = this.label();\n        label.color = textColor;\n        label.shadowColor = shadowColor;\n        label.shadowOffset = shadowOffset;\n        label.rerender();\n    }\n};\n\n// ArgLabelMorph events:\n\nArgLabelMorph.prototype.reactToGrabOf = function () {\n    if (this.parent instanceof SyntaxElementMorph) {\n        this.parent.revertToDefaultInput(this);\n    }\n};\n\n// ArgLabelMorph evaluating:\n\nArgLabelMorph.prototype.evaluate = function () {\n    // this is usually overridden by the interpreter. This method is only\n    // called (and needed) for the variables menu.\n\n    return this.argMorph().evaluate();\n};\n\nArgLabelMorph.prototype.isEmptySlot = function () {\n    return false;\n};\n\n// FunctionSlotMorph ///////////////////////////////////////////////////\n\n/*\n    I am an unevaluated, non-editable, rf-colored, rounded or diamond\n    input slot. My current (only) use is in the THE BLOCK block.\n\n    My command spec is %f\n*/\n\n// FunctionSlotMorph inherits from ArgMorph:\n\nFunctionSlotMorph.prototype = new ArgMorph();\nFunctionSlotMorph.prototype.constructor = FunctionSlotMorph;\nFunctionSlotMorph.uber = ArgMorph.prototype;\n\n// FunctionSlotMorph instance creation:\n\nexport function FunctionSlotMorph(isPredicate) {\n    this.init(isPredicate);\n}\n\nFunctionSlotMorph.prototype.init = function (isPredicate) {\n    FunctionSlotMorph.uber.init.call(this);\n    this.isPredicate = isPredicate || false;\n    this.color = this.rfColor;\n};\n\nFunctionSlotMorph.prototype.getSpec = function () {\n    return '%f';\n};\n\n// FunctionSlotMorph drawing:\n\nFunctionSlotMorph.prototype.render = function (ctx) {\n    var borderColor;\n\n    if (this.parent) {\n        borderColor = this.parent.color;\n    } else {\n        borderColor = new Color(120, 120, 120);\n    }\n\n    // cache my border colors\n    this.cachedClr = borderColor.toString();\n    this.cachedClrBright = borderColor.lighter(this.contrast)\n        .toString();\n    this.cachedClrDark = borderColor.darker(this.contrast).toString();\n\n    if (this.isPredicate) {\n        this.drawDiamond(ctx);\n    } else {\n        this.drawRounded(ctx);\n    }\n};\n\nFunctionSlotMorph.prototype.drawRounded = function (ctx) {\n    var h = this.height(),\n        r = Math.min(this.rounding, h / 2),\n        w = this.width(),\n        shift = this.edge / 2,\n        gradient;\n\n    // draw the 'flat' shape:\n    ctx.fillStyle = this.color.toString();\n    ctx.beginPath();\n\n    // top left:\n    ctx.arc(\n        r,\n        r,\n        r,\n        radians(-180),\n        radians(-90),\n        false\n    );\n\n    // top right:\n    ctx.arc(\n        w - r,\n        r,\n        r,\n        radians(-90),\n        radians(-0),\n        false\n    );\n\n    // bottom right:\n    ctx.arc(\n        w - r,\n        h - r,\n        r,\n        radians(0),\n        radians(90),\n        false\n    );\n\n    // bottom left:\n    ctx.arc(\n        r,\n        h - r,\n        r,\n        radians(90),\n        radians(180),\n        false\n    );\n\n    ctx.closePath();\n    ctx.fill();\n\n    if (MorphicPreferences.isFlat) {return; }\n\n    // add 3D-Effect:\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    // bottom left corner\n    ctx.strokeStyle = this.cachedClr; //gradient;\n    ctx.beginPath();\n    ctx.arc(\n        r,\n        h - r,\n        r - shift,\n        radians(90),\n        radians(180),\n        false\n    );\n    ctx.stroke();\n\n    // top right corner\n    ctx.strokeStyle = this.cachedClr; //gradient;\n    ctx.beginPath();\n    ctx.arc(\n        w - r,\n        r,\n        r - shift,\n        radians(-90),\n        radians(0),\n        false\n    );\n    ctx.stroke();\n\n    // normal gradient edges\n\n    if (useBlurredShadows) {\n        ctx.shadowOffsetX = shift;\n        ctx.shadowOffsetY = shift;\n        ctx.shadowBlur = this.edge;\n        ctx.shadowColor = this.color.darker(80).toString();\n    }\n\n    // top edge: straight line\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        0,\n        this.edge\n    );\n    gradient.addColorStop(1, this.cachedClrDark);\n    gradient.addColorStop(0, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r - shift, shift);\n    ctx.lineTo(w - r + shift, shift);\n    ctx.stroke();\n\n    // top edge: left corner\n    gradient = ctx.createRadialGradient(\n        r,\n        r,\n        r - this.edge,\n        r,\n        r,\n        r\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrDark);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(\n        r,\n        r,\n        r - shift,\n        radians(180),\n        radians(270),\n        false\n    );\n    ctx.stroke();\n\n    // left edge: straight vertical line\n    gradient = ctx.createLinearGradient(0, 0, this.edge, 0);\n    gradient.addColorStop(1, this.cachedClrDark);\n    gradient.addColorStop(0, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(shift, r);\n    ctx.lineTo(shift, h - r);\n    ctx.stroke();\n\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 0;\n    ctx.shadowBlur = 0;\n\n    // bottom edge: right corner\n    gradient = ctx.createRadialGradient(\n        w - r,\n        h - r,\n        r - this.edge,\n        w - r,\n        h - r,\n        r\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(\n        w - r,\n        h - r,\n        r - shift,\n        radians(0),\n        radians(90),\n        false\n    );\n    ctx.stroke();\n\n    // bottom edge: straight line\n    gradient = ctx.createLinearGradient(\n        0,\n        h - this.edge,\n        0,\n        h\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r - shift, h - shift);\n    ctx.lineTo(w - r + shift, h - shift);\n    ctx.stroke();\n\n    // right edge: straight vertical line\n    gradient = ctx.createLinearGradient(w - this.edge, 0, w, 0);\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(w - shift, r + shift);\n    ctx.lineTo(w - shift, h - r);\n    ctx.stroke();\n\n};\n\nFunctionSlotMorph.prototype.drawDiamond = function (ctx) {\n    var w = this.width(),\n        h = this.height(),\n        h2 = Math.floor(h / 2),\n        r = Math.min(this.rounding, h2),\n        shift = this.edge / 2,\n        gradient;\n\n    // draw the 'flat' shape:\n    ctx.fillStyle = this.color.toString();\n    ctx.beginPath();\n\n    ctx.moveTo(0, h2);\n    ctx.lineTo(r, 0);\n    ctx.lineTo(w - r, 0);\n    ctx.lineTo(w, h2);\n    ctx.lineTo(w - r, h);\n    ctx.lineTo(r, h);\n\n    ctx.closePath();\n    ctx.fill();\n\n    if (MorphicPreferences.isFlat) {return; }\n\n    // add 3D-Effect:\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    // half-tone edges\n    // bottom left corner\n    ctx.strokeStyle = this.cachedClr;\n    ctx.beginPath();\n    ctx.moveTo(shift, h2);\n    ctx.lineTo(r, h - shift);\n    ctx.stroke();\n\n    // top right corner\n    ctx.strokeStyle = this.cachedClr;\n    ctx.beginPath();\n    ctx.moveTo(w - shift, h2);\n    ctx.lineTo(w - r, shift);\n    ctx.stroke();\n\n    // normal gradient edges\n    // top edge: left corner\n\n    if (useBlurredShadows) {\n        ctx.shadowOffsetX = shift;\n        ctx.shadowOffsetY = shift;\n        ctx.shadowBlur = this.edge;\n        ctx.shadowColor = this.color.darker(80).toString();\n    }\n\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        r,\n        0\n    );\n    gradient.addColorStop(1, this.cachedClrDark);\n    gradient.addColorStop(0, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(shift, h2);\n    ctx.lineTo(r, shift);\n    ctx.stroke();\n\n    // top edge: straight line\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        0,\n        this.edge\n    );\n    gradient.addColorStop(1, this.cachedClrDark);\n    gradient.addColorStop(0, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r, shift);\n    ctx.lineTo(w - r, shift);\n    ctx.stroke();\n\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 0;\n    ctx.shadowBlur = 0;\n\n    // bottom edge: right corner\n    gradient = ctx.createLinearGradient(\n        w - r,\n        0,\n        w,\n        0\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(w - r, h - shift);\n    ctx.lineTo(w - shift, h2);\n    ctx.stroke();\n\n    // bottom edge: straight line\n    gradient = ctx.createLinearGradient(\n        0,\n        h - this.edge,\n        0,\n        h\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r + shift, h - shift);\n    ctx.lineTo(w - r - shift, h - shift);\n    ctx.stroke();\n};\n\n// ReporterSlotMorph ///////////////////////////////////////////////////\n\n/*\n    I am a ReporterBlock-shaped input slot. I can nest as well as\n    accept reporter blocks (containing reified scripts).\n\n    my most important accessor is\n\n    nestedBlock()    - answer the reporter block I encompass, if any\n\n    My command spec is %r for reporters (round) and %p for\n    predicates (diamond)\n\n    evaluate() returns my nested block or null\n*/\n\n// ReporterSlotMorph inherits from FunctionSlotMorph:\n\nReporterSlotMorph.prototype = new FunctionSlotMorph();\nReporterSlotMorph.prototype.constructor = ReporterSlotMorph;\nReporterSlotMorph.uber = FunctionSlotMorph.prototype;\n\n// ReporterSlotMorph instance creation:\n\nexport function ReporterSlotMorph(isPredicate) {\n    this.init(isPredicate);\n}\n\nReporterSlotMorph.prototype.init = function (isPredicate) {\n    ReporterSlotMorph.uber.init.call(this, isPredicate, true);\n    this.add(this.emptySlot());\n    this.fixLayout();\n};\n\nReporterSlotMorph.prototype.emptySlot = function () {\n    var empty = new ArgMorph(),\n        shrink = this.rfBorder * 2 + this.edge * 2;\n    empty.color = this.rfColor;\n    empty.alpha = 0;\n    empty.bounds.setExtent(new Point(\n        (this.fontSize + this.edge * 2) * 2 - shrink,\n        this.fontSize + this.edge * 2 - shrink\n    ));\n    return empty;\n};\n\n// ReporterSlotMorph accessing:\n\nReporterSlotMorph.prototype.getSpec = function () {\n    return '%r';\n};\n\nReporterSlotMorph.prototype.contents = function () {\n    return this.children[0];\n};\n\nReporterSlotMorph.prototype.nestedBlock = function () {\n    var contents = this.contents();\n    return contents instanceof ReporterBlockMorph ? contents : null;\n};\n\n// ReporterSlotMorph evaluating:\n\nReporterSlotMorph.prototype.evaluate = function () {\n    return this.nestedBlock();\n};\n\nReporterSlotMorph.prototype.isEmptySlot = function () {\n    return this.nestedBlock() === null;\n};\n\n// ReporterSlotMorph layout:\n\nReporterSlotMorph.prototype.fixLayout = function () {\n    var contents = this.contents();\n    this.bounds.setExtent(contents.extent().add(\n        this.edge * 2 + this.rfBorder * 2\n    ));\n    contents.setCenter(this.center());\n    if (this.parent) {\n        if (this.parent.fixLayout) {\n            this.parent.fixLayout();\n        }\n    }\n};\n\n// RingReporterSlotMorph ///////////////////////////////////////////////////\n\n/*\n    I am a ReporterBlock-shaped input slot for use in RingMorphs.\n    I can nest reporter blocks (both round and diamond) as well\n    as command blocks (jigsaw shaped).\n\n    My command spec is %rr for reporters (round) and %rp for\n    predicates (diamond)\n\n    evaluate() returns my nested block or null\n    (inherited from ReporterSlotMorph\n*/\n\n// ReporterSlotMorph inherits from FunctionSlotMorph:\n\nRingReporterSlotMorph.prototype = new ReporterSlotMorph();\nRingReporterSlotMorph.prototype.constructor = RingReporterSlotMorph;\nRingReporterSlotMorph.uber = ReporterSlotMorph.prototype;\n\n// ReporterSlotMorph preferences settings:\n\nRingReporterSlotMorph.prototype.rfBorder\n    = RingCommandSlotMorph.prototype.rfBorder;\n\nRingReporterSlotMorph.prototype.edge\n    = RingCommandSlotMorph.prototype.edge;\n\nRingReporterSlotMorph.prototype.enableCommandDrops = true;\n\n// RingReporterSlotMorph instance creation:\n\nexport function RingReporterSlotMorph(isPredicate) {\n    this.init(isPredicate);\n}\n\nRingReporterSlotMorph.prototype.init = function (isPredicate) {\n    RingReporterSlotMorph.uber.init.call(this, isPredicate, true);\n    this.contrast = RingMorph.prototype.contrast;\n};\n\n// RingReporterSlotMorph accessing:\n\nRingReporterSlotMorph.prototype.getSpec = function () {\n    return '%rr';\n};\n\nRingReporterSlotMorph.prototype.replaceInput = function (\n    source,\n    target,\n    noVanish\n) {\n    RingReporterSlotMorph.uber.replaceInput.call(this, source, target);\n    if (this.parent instanceof RingMorph && !noVanish) {\n        this.parent.vanishForSimilar();\n    }\n};\n\n// RingReporterSlotMorph attach targets for commands:\n\nRingReporterSlotMorph.prototype.slotAttachPoint =\n    CommandSlotMorph.prototype.slotAttachPoint;\n\nRingReporterSlotMorph.prototype.dentLeft =\n    CommandSlotMorph.prototype.dentLeft;\n\nRingReporterSlotMorph.prototype.dentCenter =\n    CommandSlotMorph.prototype.dentCenter;\n\nRingReporterSlotMorph.prototype.attachTargets = function () {\n    if (!RingReporterSlotMorph.prototype.enableCommandDrops ||\n        this.contents() instanceof ReporterBlockMorph\n    ) {\n        // don't let commands \"kick out\" embedded reporters\n        return [];\n    }\n    return CommandSlotMorph.prototype.attachTargets.call(this);\n};\n\n// RingReporterSlotMorph nesting for commands:\n\nRingReporterSlotMorph.prototype.nestedBlock = function (block) {\n    if (block) {\n        var nb = this.nestedBlock();\n        this.replaceInput(this.children[0], block);\n        if (nb) {\n            block.bottomBlock().nextBlock(nb);\n        }\n        this.fixLayout();\n    } else {\n        return detect(\n            this.children,\n            child => child instanceof BlockMorph\n        );\n    }\n};\n\n// RingReporterSlotMorph layout:\n\nRingReporterSlotMorph.prototype.fixLayout = function () {\n    if (this.contents() instanceof CommandBlockMorph) {\n        CommandSlotMorph.prototype.fixLayout.call(this);\n    } else {\n        RingReporterSlotMorph.uber.fixLayout.call(this);\n    }\n};\n\n// RingReporterSlotMorph drawing:\n\nRingReporterSlotMorph.prototype.render = function (ctx) {\n    if (MorphicPreferences.isFlat) {return; }\n\n    // init\n    this.cachedClr = this.color.toString();\n    this.cachedClrBright = this.bright();\n    this.cachedClrDark = this.dark();\n    ctx.fillStyle = this.cachedClr;\n\n    // only add 3D-Effect here, rendering of the flat shape happens at the\n    // encompassing block level\n    if (this.isPredicate) {\n        this.drawEdgesDiamond(ctx);\n    } else {\n        this.drawEdgesOval(ctx);\n    }\n};\n\nRingReporterSlotMorph.prototype.outlinePath = function (ctx, offset) {\n    if (this.isPredicate) {\n        this.outlinePathDiamond(ctx, offset);\n    } else {\n        this.outlinePathOval(ctx, offset);\n    }\n};\n\nRingReporterSlotMorph.prototype.outlinePathOval = function (ctx, offset) {\n    var ox = offset.x,\n        oy = offset.y,\n        w = this.width(),\n        h = this.height(),\n        r = Math.min(this.rounding, h / 2);\n\n    // top left:\n    ctx.arc(\n        r + this.edge + ox,\n        r + this.edge + oy,\n        r,\n        radians(-180),\n        radians(-90),\n        false\n    );\n\n    // top right:\n    ctx.arc(\n        w - r - this.edge + ox,\n        r + this.edge + oy,\n        r,\n        radians(-90),\n        radians(-0),\n        false\n    );\n\n    // bottom right:\n    ctx.arc(\n        w - r - this.edge + ox,\n        h - r - this.edge + oy,\n        r,\n        radians(0),\n        radians(90),\n        false\n    );\n\n    // bottom left:\n    ctx.arc(\n        r + this.edge + ox,\n        h - r - this.edge + oy,\n        r,\n        radians(90),\n        radians(180),\n        false\n    );\n\n    // \"close\" the path\n    ctx.lineTo(this.edge + ox, r + this.edge + oy);\n};\n\nRingReporterSlotMorph.prototype.drawEdgesOval = function (ctx) {\n    var h = this.height(),\n        r = Math.min(this.rounding, h / 2),\n        w = this.width(),\n        shift = this.edge / 2,\n        gradient;\n\n\n    // add 3D-Effect:\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    // bottom left corner\n    ctx.strokeStyle = this.cachedClr;\n    ctx.beginPath();\n    ctx.arc(\n        r,\n        h - r,\n        r - shift,\n        radians(90),\n        radians(180),\n        false\n    );\n    ctx.stroke();\n\n    // top right corner\n    ctx.strokeStyle = this.cachedClr;\n    ctx.beginPath();\n    ctx.arc(\n        w - r,\n        r,\n        r - shift,\n        radians(-90),\n        radians(0),\n        false\n    );\n    ctx.stroke();\n\n    // normal gradient edges\n\n    if (useBlurredShadows) {\n        ctx.shadowOffsetX = shift;\n        ctx.shadowOffsetY = shift;\n        ctx.shadowBlur = this.edge;\n        ctx.shadowColor = this.color.darker(80).toString();\n    }\n\n    // top edge: straight line\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        0,\n        this.edge\n    );\n    gradient.addColorStop(1, this.cachedClrDark);\n    gradient.addColorStop(0, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r - shift, shift);\n    ctx.lineTo(w - r + shift, shift);\n    ctx.stroke();\n\n    // top edge: left corner\n    gradient = ctx.createRadialGradient(\n        r,\n        r,\n        r - this.edge,\n        r,\n        r,\n        r\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrDark);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(\n        r,\n        r,\n        r - shift,\n        radians(180),\n        radians(270),\n        false\n    );\n    ctx.stroke();\n\n    // left edge: straight vertical line\n    gradient = ctx.createLinearGradient(0, 0, this.edge, 0);\n    gradient.addColorStop(1, this.cachedClrDark);\n    gradient.addColorStop(0, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(shift, r);\n    ctx.lineTo(shift, h - r);\n    ctx.stroke();\n\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 0;\n    ctx.shadowBlur = 0;\n\n    // bottom edge: right corner\n    gradient = ctx.createRadialGradient(\n        w - r,\n        h - r,\n        r - this.edge,\n        w - r,\n        h - r,\n        r\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.arc(\n        w - r,\n        h - r,\n        r - shift,\n        radians(0),\n        radians(90),\n        false\n    );\n    ctx.stroke();\n\n    // bottom edge: straight line\n    gradient = ctx.createLinearGradient(\n        0,\n        h - this.edge,\n        0,\n        h\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r - shift, h - shift);\n    ctx.lineTo(w - r + shift, h - shift);\n    ctx.stroke();\n\n    // right edge: straight vertical line\n    gradient = ctx.createLinearGradient(w - this.edge, 0, w, 0);\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(w - shift, r + shift);\n    ctx.lineTo(w - shift, h - r);\n    ctx.stroke();\n};\n\nRingReporterSlotMorph.prototype.outlinePathDiamond = function (ctx, offset) {\n    var ox = offset.x,\n        oy = offset.y,\n        w = this.width(),\n        h = this.height(),\n        h2 = Math.floor(h / 2),\n        r = Math.min(this.rounding, h2);\n\n    ctx.moveTo(ox + this.edge, h2 + oy);\n    ctx.lineTo(r + this.edge + ox, this.edge + oy);\n    ctx.lineTo(w - r - this.edge + ox, this.edge + oy);\n    ctx.lineTo(w - this.edge + ox, h2 + oy);\n    ctx.lineTo(w - r - this.edge + ox, h - this.edge + oy);\n    ctx.lineTo(r + this.edge + ox, h - this.edge + oy);\n    ctx.lineTo(ox + this.edge, h2 + oy);\n};\n\nRingReporterSlotMorph.prototype.drawEdgesDiamond = function (ctx) {\n    var w = this.width(),\n        h = this.height(),\n        h2 = Math.floor(h / 2),\n        r = Math.min(this.rounding, h2),\n        shift = this.edge / 2,\n        gradient;\n\n    // add 3D-Effect:\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    // half-tone edges\n    // bottom left corner\n    ctx.strokeStyle = this.cachedClr;\n    ctx.beginPath();\n    ctx.moveTo(shift, h2);\n    ctx.lineTo(r, h - shift);\n    ctx.stroke();\n\n    // top right corner\n    ctx.strokeStyle = this.cachedClr;\n    ctx.beginPath();\n    ctx.moveTo(w - shift, h2);\n    ctx.lineTo(w - r, shift);\n    ctx.stroke();\n\n    // normal gradient edges\n    // top edge: left corner\n\n    if (useBlurredShadows) {\n        ctx.shadowOffsetX = shift;\n        ctx.shadowOffsetY = shift;\n        ctx.shadowBlur = this.edge;\n        ctx.shadowColor = this.color.darker(80).toString();\n    }\n\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        r,\n        0\n    );\n    gradient.addColorStop(1, this.cachedClrDark);\n    gradient.addColorStop(0, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(shift, h2);\n    ctx.lineTo(r, shift);\n    ctx.stroke();\n\n    // top edge: straight line\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        0,\n        this.edge\n    );\n    gradient.addColorStop(1, this.cachedClrDark);\n    gradient.addColorStop(0, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r, shift);\n    ctx.lineTo(w - r, shift);\n    ctx.stroke();\n\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 0;\n    ctx.shadowBlur = 0;\n\n    // bottom edge: right corner\n    gradient = ctx.createLinearGradient(\n        w - r,\n        0,\n        w,\n        0\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(w - r, h - shift);\n    ctx.lineTo(w - shift, h2);\n    ctx.stroke();\n\n    // bottom edge: straight line\n    gradient = ctx.createLinearGradient(\n        0,\n        h - this.edge,\n        0,\n        h\n    );\n    gradient.addColorStop(1, this.cachedClr);\n    gradient.addColorStop(0, this.cachedClrBright);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(r + shift, h - shift);\n    ctx.lineTo(w - r - shift, h - shift);\n    ctx.stroke();\n};\n\n// CommentMorph //////////////////////////////////////////////////////////\n\n/*\n    I am an editable, multi-line non-scrolling text window. I can be collapsed\n    to a single abbreviated line or expanded to full. My width can be adjusted\n    by the user, by height is determined by the size of my text body. I can be\n    either placed in a scripting area or \"stuck\" to a block.\n*/\n\n// CommentMorph inherits from BoxMorph:\n\nCommentMorph.prototype = new BoxMorph();\nCommentMorph.prototype.constructor = CommentMorph;\nCommentMorph.uber = BoxMorph.prototype;\n\n// CommentMorph preferences settings (pseudo-inherited from SyntaxElement):\n\nCommentMorph.prototype.refreshScale = function () {\n    CommentMorph.prototype.fontSize = SyntaxElementMorph.prototype.fontSize;\n    CommentMorph.prototype.padding = 5 * SyntaxElementMorph.prototype.scale;\n    CommentMorph.prototype.rounding = 8 * SyntaxElementMorph.prototype.scale;\n};\n\nCommentMorph.prototype.refreshScale();\n\n// CommentMorph instance creation:\n\nexport function CommentMorph(contents) {\n    this.init(contents);\n}\n\nCommentMorph.prototype.init = function (contents) {\n    var scale = SyntaxElementMorph.prototype.scale;\n\n    this.block = null; // optional anchor block\n    this.stickyOffset = null; // not to be persisted\n    this.isCollapsed = false;\n    this.titleBar = new BoxMorph(\n        this.rounding,\n        scale,\n        new Color(255, 255, 180)\n    );\n    this.titleBar.color = new Color(255, 255, 180);\n    this.titleBar.setHeight(fontHeight(this.fontSize) + this.padding);\n    this.title = null;\n    this.arrow = new ArrowMorph(\n        'down',\n        this.fontSize\n    );\n    this.arrow.mouseClickLeft = () => this.toggleExpand();\n    this.contents = new TextMorph(\n        contents || localize('add comment here...'),\n        this.fontSize\n    );\n    this.contents.isEditable = true;\n    this.contents.enableSelecting();\n    this.contents.maxWidth = 90 * scale;\n    this.contents.fixLayout();\n    this.handle = new HandleMorph(\n        this.contents,\n        80,\n        this.fontSize * 2,\n        -2,\n        -2\n    );\n    this.handle.setExtent(new Point(11 * scale, 11 * scale));\n    this.anchor = null;\n\n    CommentMorph.uber.init.call(\n        this,\n        this.rounding,\n        scale,\n        new Color(255, 255, 180)\n    );\n    this.color = new Color(255, 255, 220);\n    this.isDraggable = true;\n    this.add(this.titleBar);\n    this.add(this.arrow);\n    this.add(this.contents);\n    this.add(this.handle);\n\n    this.fixLayout();\n};\n\n// CommentMorph ops:\n\nCommentMorph.prototype.fullCopy = function () {\n    var cpy = new CommentMorph(this.contents.text);\n    cpy.isCollapsed = this.isCollapsed;\n    cpy.setTextWidth(this.textWidth());\n    if (this.selectionID) { // for copy on write\n        cpy.selectionID = true;\n    }\n    return cpy;\n};\n\nCommentMorph.prototype.setTextWidth = function (pixels) {\n    this.contents.maxWidth = pixels;\n    this.contents.fixLayout();\n    this.fixLayout();\n};\n\nCommentMorph.prototype.textWidth = function () {\n    return this.contents.maxWidth;\n};\n\nCommentMorph.prototype.text = function () {\n    return this.contents.text;\n};\n\nCommentMorph.prototype.toggleExpand = function () {\n    this.isCollapsed = !this.isCollapsed;\n    this.fixLayout();\n    this.align();\n    if (!this.isCollapsed) {\n        this.comeToFront();\n    }\n};\n\nCommentMorph.prototype.comeToFront = function () {\n    if (this.parent) {\n        this.parent.add(this);\n        this.changed();\n    }\n};\n\n// CommentMorph events:\n\nCommentMorph.prototype.mouseClickLeft = function () {\n    this.comeToFront();\n};\n\n// CommentMorph layout:\n\nCommentMorph.prototype.layoutChanged = function () {\n    // react to a change of the contents area\n    this.fixLayout();\n    this.align();\n    this.comeToFront();\n};\n\nCommentMorph.prototype.fixLayout = function () {\n    var label,\n        tw = this.contents.width() + 2 * this.padding;\n\n    if (this.title) {\n        this.title.destroy();\n        this.title = null;\n    }\n    if (this.isCollapsed) {\n        this.contents.hide();\n        this.title = new FrameMorph();\n        this.title.alpha = 0;\n        this.title.acceptsDrops = false;\n        label = new StringMorph(\n            this.contents.text,\n            this.fontSize,\n            null, // style (sans-serif)\n            true // bold\n        );\n        label.rootForGrab = () => this;\n        this.title.add(label);\n        this.title.setHeight(label.height());\n        this.title.setWidth(\n            tw - this.arrow.width() - this.padding * 2 - this.rounding\n        );\n        this.add(this.title);\n    } else {\n        this.contents.show();\n    }\n    this.titleBar.setWidth(tw);\n    this.contents.setLeft(this.titleBar.left() + this.padding);\n    this.contents.setTop(this.titleBar.bottom() + this.padding);\n    this.arrow.direction = this.isCollapsed ? 'right' : 'down';\n    this.arrow.rerender();\n    this.arrow.setCenter(this.titleBar.center());\n    this.arrow.setLeft(this.titleBar.left() + this.padding);\n    if (this.title) {\n        this.title.setPosition(\n            this.arrow.topRight().add(new Point(this.padding, 0))\n        );\n    }\n    this.changed();\n    this.bounds.setHeight(\n        this.titleBar.height()\n            + (this.isCollapsed ? 0 :\n                    this.padding\n                        + this.contents.height()\n                        + this.padding)\n    );\n    this.bounds.setWidth(this.titleBar.width());\n    this.rerender();\n    this.handle.fixLayout();\n};\n\n// CommentMorph menu:\n\nCommentMorph.prototype.userMenu = function () {\n    var menu = new MenuMorph(this);\n\n    menu.addItem(\n        \"duplicate\",\n        () => {\n            var dup = this.fullCopy(),\n                ide = this.parentThatIsA(IDE_Morph),\n                blockEditor = this.parentThatIsA(BlockEditorMorph),\n                world = this.world();\n            dup.pickUp(world);\n            // register the drop-origin, so the comment can\n            // slide back to its former situation if dropped\n            // somewhere where it gets rejected\n            if (!ide && blockEditor) {\n                ide = blockEditor.target.parentThatIsA(IDE_Morph);\n            }\n            if (ide) {\n                world.hand.grabOrigin = {\n                    origin: ide.palette,\n                    position: ide.palette.center()\n                };\n            }\n        },\n        'make a copy\\nand pick it up'\n    );\n    menu.addItem(\"delete\", 'userDestroy');\n    menu.addItem(\n        \"comment pic...\",\n        () => {\n            var ide = this.parentThatIsA(IDE_Morph);\n            ide.saveCanvasAs(\n                this.fullImage(),\n                (ide.projectName || localize('untitled')) + ' ' +\n                    localize('comment pic')\n            );\n        },\n        'save a picture\\nof this comment'\n    );\n    return menu;\n};\n\nCommentMorph.prototype.userDestroy = function () {\n    this.selectForEdit().destroy(); // enable copy-on-edit\n};\n\n// CommentMorph hiding and showing:\n\n/*\n    override the inherited behavior to recursively hide/show all\n    children, so that my instances get restored correctly when\n    switching back out of app mode.\n*/\n\nCommentMorph.prototype.hide = function () {\n    this.isVisible = false;\n    this.changed();\n};\n\nCommentMorph.prototype.show = function () {\n    this.isVisible = true;\n    this.changed();\n};\n\n// CommentMorph dragging & dropping\n\nCommentMorph.prototype.prepareToBeGrabbed = function (hand) {\n    // disassociate from the block I'm posted to\n    if (this.block) {\n        this.block.comment = null;\n        this.block = null;\n    }\n    if (this.anchor) {\n        this.anchor.destroy();\n        this.anchor = null;\n    }\n};\n\nCommentMorph.prototype.selectForEdit =\n    SyntaxElementMorph.prototype.selectForEdit;\n\nCommentMorph.prototype.snap = function (hand) {\n    // passing the hand is optional (for when blocks are dragged & dropped)\n    var scripts = this.parent,\n        target;\n\n    if (!(scripts instanceof ScriptsMorph)) {\n        return null;\n    }\n    scripts.clearDropInfo();\n    target = scripts.closestBlock(this, hand);\n    if (target !== null) {\n        target.comment = this;\n        this.block = target;\n        if (this.snapSound) {\n            this.snapSound.play();\n        }\n        scripts.lastDropTarget = {element: target};\n    }\n    this.align();\n    scripts.lastDroppedBlock = this;\n    if (hand) {\n        scripts.recordDrop(hand.grabOrigin);\n    }\n\n};\n\n// CommentMorph sticking to blocks\n\nCommentMorph.prototype.align = function (topBlock, ignoreLayer) {\n    if (this.block) {\n        var top = topBlock || this.block.topBlock(),\n            affectedBlocks,\n            tp,\n            bottom,\n            rightMost,\n            scripts = top.parentThatIsA(ScriptsMorph);\n        this.setTop(this.block.top() + this.block.corner);\n        tp = this.top();\n        bottom = this.bottom();\n        affectedBlocks = top.allChildren().filter(child =>\n            child instanceof BlockMorph &&\n                child.bottom() > tp &&\n                    child.top() < bottom\n        );\n        rightMost = Math.max.apply(\n            null,\n            affectedBlocks.map(block => block.right())\n        );\n\n        this.setLeft(rightMost + 5);\n        if (!ignoreLayer && scripts) {\n            scripts.addBack(this); // push to back and show\n        }\n\n        if (!this.anchor) {\n            this.anchor = new Morph();\n            this.anchor.color = this.titleBar.color;\n        }\n        this.anchor.setPosition(new Point(\n            this.block.right(),\n            this.top() + this.edge\n        ));\n        this.anchor.bounds.corner = new Point(\n            this.left(),\n            this.top() + this.edge + 1\n        );\n        this.anchor.rerender();\n        this.addBack(this.anchor);\n    }\n};\n\nCommentMorph.prototype.startFollowing = function (topBlock, world) {\n    this.align(topBlock);\n    world.add(this);\n    this.addShadow();\n    this.stickyOffset = this.position().subtract(this.block.position());\n    this.step = () => {\n        if (!this.block) { // kludge - only needed for \"redo\"\n            this.stopFollowing();\n            return;\n        }\n        this.setPosition(this.block.position().add(this.stickyOffset));\n    };\n};\n\nCommentMorph.prototype.stopFollowing = function () {\n    this.removeShadow();\n    delete this.step;\n};\n\nCommentMorph.prototype.destroy = function () {\n    if (this.block) {\n        this.block.comment = null;\n    }\n    CommentMorph.uber.destroy.call(this);\n};\n\nCommentMorph.prototype.stackHeight = function () {\n    return this.height();\n};\n\n// ScriptFocusMorph //////////////////////////////////////////////////////////\n\n/*\n    I offer keyboard navigation for syntax elements, blocks and scripts:\n\n    activate:\n      - shift + click on a scripting pane's background\n      - shift + click on any block\n      - shift + enter in the IDE's edit mode\n\n    stop editing:\n      - left-click on scripting pane's background\n      - esc\n\n    navigate among scripts:\n      - tab: next script\n      - backtab (shift + tab): last script\n\n    start editing a new script:\n      - shift + enter\n\n    navigate among commands within a script:\n      - down arrow: next command\n      - up arrow: last command\n\n    navigate among all elements within a script:\n      - right arrow: next element (block or input)\n      - left arrow: last element\n\n    move the currently edited script (stack of blocks):\n      - shift + arrow keys (left, right, up, down)\n\n    editing scripts:\n\n      - backspace:\n        * delete currently focused reporter\n        * delete command above current insertion mark (blinking)\n        * collapse currently focused variadic input by one element\n\n      - enter:\n        * edit currently focused input slot\n        * expand currently focused variadic input by one element\n\n      - space:\n        * activate currently focused input slot's pull-down menu, if any\n        * show a menu of reachable variables for the focused input or reporter\n\n      - any other key:\n        start searching for insertable matching blocks\n\n      - in menus triggered by this feature:\n        * navigate with up / down arrow keys\n        * trigger selection with enter\n        * cancel menu with esc\n\n      - in the search bar triggered b this feature:\n        * keep typing / deleting to narrow and update matches\n        * navigate among shown matches with up / down arrow keys\n        * insert selected match at the focus' position with enter\n        * cancel searching and inserting with esc\n\n    running the currently edited script:\n        * shift+ctrl+enter simulates clicking the edited script with the mouse\n*/\n\n// ScriptFocusMorph inherits from BoxMorph:\n\nScriptFocusMorph.prototype = new BoxMorph();\nScriptFocusMorph.prototype.constructor = ScriptFocusMorph;\nScriptFocusMorph.uber = BoxMorph.prototype;\n\n// ScriptFocusMorph instance creation:\n\nexport function ScriptFocusMorph(editor, initialElement, position) {\n    this.init(editor, initialElement, position);\n}\n\nScriptFocusMorph.prototype.init = function (\n    editor,\n    initialElement,\n    position\n) {\n    this.editor = editor; // a ScriptsMorph\n    this.element = initialElement;\n    this.atEnd = false;\n    ScriptFocusMorph.uber.init.call(this);\n    if (this.element instanceof ScriptsMorph) {\n        this.setPosition(position);\n    }\n};\n\n// ScriptFocusMorph keyboard focus:\n\nScriptFocusMorph.prototype.getFocus = function (world) {\n    if (!world) {world = this.world(); }\n    if (world && world.keyboardFocus !== this) {\n        world.stopEditing();\n    }\n    world.keyboardFocus = this;\n    this.fixLayout();\n    this.editor.updateToolbar();\n};\n\n// ScriptFocusMorph layout:\n\nScriptFocusMorph.prototype.fixLayout = function () {\n    this.changed();\n    if (this.element instanceof CommandBlockMorph ||\n            this.element instanceof CommandSlotMorph ||\n            this.element instanceof ScriptsMorph) {\n        this.manifestStatement();\n    } else {\n        this.manifestExpression();\n    }\n    this.editor.add(this); // come to front\n    this.scrollIntoView();\n    this.changed();\n};\n\nScriptFocusMorph.prototype.manifestStatement = function () {\n    var newScript = this.element instanceof ScriptsMorph,\n        y = this.element.top();\n    this.border = 0;\n    this.edge = 0;\n    this.alpha = 1;\n    this.color = this.editor.feedbackColor;\n    this.bounds.setExtent(new Point(\n        newScript ?\n                SyntaxElementMorph.prototype.hatWidth : this.element.width(),\n        Math.max(\n            SyntaxElementMorph.prototype.corner,\n            SyntaxElementMorph.prototype.feedbackMinHeight\n        )\n    ));\n    if (this.element instanceof CommandSlotMorph) {\n        y += SyntaxElementMorph.prototype.corner;\n    } else if (this.atEnd) {\n        y = this.element.bottom();\n    }\n    if (!newScript) {\n        this.setPosition(new Point(\n            this.element.left(),\n            y\n        ));\n    }\n    this.fps = 2;\n    this.show();\n    this.step = function () {\n        this.toggleVisibility();\n    };\n};\n\nScriptFocusMorph.prototype.manifestExpression = function () {\n    this.edge = SyntaxElementMorph.prototype.rounding;\n    this.border = Math.max(\n        SyntaxElementMorph.prototype.edge,\n        3\n    );\n    this.color = this.editor.feedbackColor.copy();\n    this.color.a = 0.5;\n    this.borderColor = this.editor.feedbackColor;\n\n    this.bounds = this.element.fullBounds()\n        .expandBy(Math.max(\n            SyntaxElementMorph.prototype.edge * 2,\n            SyntaxElementMorph.prototype.reporterDropFeedbackPadding\n        ));\n    this.rerender();\n    delete this.fps;\n    delete this.step;\n    this.show();\n};\n\n// ScriptFocusMorph editing\n\nScriptFocusMorph.prototype.trigger = function () {\n    var current = this.element;\n    if (current instanceof MultiArgMorph) {\n        if (current.arrows().children[1].isVisible) {\n            current.addInput();\n            this.fixLayout();\n        }\n        return;\n    }\n    if (current.parent instanceof TemplateSlotMorph) {\n        current.mouseClickLeft();\n        return;\n    }\n    if (current instanceof BooleanSlotMorph) {\n        current.toggleValue();\n        return;\n    }\n    if (current instanceof InputSlotMorph) {\n        if (!current.isReadOnly) {\n            delete this.fps;\n            delete this.step;\n            this.hide();\n            this.world().onNextStep = () => {\n                current.contents().edit();\n                current.contents().selectAll();\n            };\n        } else if (current.choices) {\n            current.dropDownMenu(true);\n            delete this.fps;\n            delete this.step;\n            this.hide();\n        }\n    }\n};\n\nScriptFocusMorph.prototype.menu = function () {\n    var current = this.element;\n    if (current instanceof InputSlotMorph && current.choices) {\n        current.dropDownMenu(true);\n        delete this.fps;\n        delete this.step;\n        this.hide();\n    } else {\n        this.insertVariableGetter();\n    }\n};\n\nScriptFocusMorph.prototype.deleteLastElement = function () {\n    var current = this.element;\n    if (current.parent instanceof ScriptsMorph) {\n        if (this.atEnd || current instanceof ReporterBlockMorph) {\n            current.destroy();\n            this.element = this.editor;\n            this.atEnd = false;\n        }\n    } else if (current instanceof MultiArgMorph) {\n        if (current.arrows().children[0].isVisible) {\n            current.removeInput();\n        }\n    } else if (current instanceof BooleanSlotMorph) {\n        if (!current.isStatic) {\n            current.setContents(null);\n        }\n    } else if (current instanceof ReporterBlockMorph) {\n        if (!current.isTemplate) {\n            this.lastElement();\n            current.prepareToBeGrabbed();\n            current.destroy();\n        }\n    } else if (current instanceof CommandBlockMorph) {\n        if (this.atEnd) {\n            this.element = current.parent;\n            current.userDestroy();\n        } else {\n            if (current.parent instanceof CommandBlockMorph) {\n                current.parent.userDestroy();\n            }\n        }\n    }\n    this.editor.adjustBounds();\n    this.fixLayout();\n};\n\nScriptFocusMorph.prototype.insertBlock = function (block) {\n    // insert the block after a short gliding animation\n    this.world().add(block);\n    block.glideTo(\n        this.position(),\n        null,\n        null,\n        () => this.fillInBlock(block)\n    );\n};\n\nScriptFocusMorph.prototype.fillInBlock = function (block) {\n    var pb, stage, ide, rcvr;\n    block.isTemplate = false;\n    block.isDraggable = true;\n\n    if (block.snapSound) {\n        block.snapSound.play();\n    }\n\n    if (this.element instanceof ScriptsMorph) {\n        this.editor.add(block);\n        this.element = block;\n        if (block instanceof CommandBlockMorph) {\n            block.setLeft(this.left());\n            if (block.isStop()) {\n                block.setTop(this.top());\n            } else {\n                block.setBottom(this.top());\n                this.atEnd = true;\n            }\n        } else {\n            block.setCenter(this.center());\n            block.setLeft(this.left());\n        }\n    } else if (this.element instanceof CommandBlockMorph) {\n        if (this.atEnd) {\n            this.element.nextBlock(block);\n            this.element = block;\n            this.fixLayout();\n        } else {\n            // to be done: special case if block.isStop()\n            pb = this.element.parent;\n            if (pb instanceof ScriptsMorph) { // top block\n                block.setLeft(this.element.left());\n                block.setBottom(this.element.top() + this.element.corner);\n                this.editor.add(block);\n                block.nextBlock(this.element);\n                this.fixLayout();\n            } else if (pb instanceof CommandSlotMorph) {\n                pb.nestedBlock(block);\n            } else if (pb instanceof RingReporterSlotMorph) {\n                block.nextBlock(pb.nestedBlock());\n                pb.add(block);\n                pb.fixLayout();\n            } else if (pb instanceof CommandBlockMorph) {\n                pb.nextBlock(block);\n            }\n        }\n    } else if (this.element instanceof CommandSlotMorph) {\n        // to be done: special case if block.isStop()\n        this.element.nestedBlock(block);\n        this.element = block;\n        this.atEnd = true;\n    } else {\n        pb = this.element.parent;\n        if (pb instanceof ScriptsMorph) {\n            this.editor.add(block);\n            block.setPosition(this.element.position());\n            this.element.destroy();\n        } else {\n            pb.replaceInput(this.element, block);\n        }\n        this.element = block;\n    }\n    block.fixBlockColor();\n    this.editor.adjustBounds();\n    // block.scrollIntoView();\n    this.fixLayout();\n\n    // register generic hat blocks\n    if (block.selector === 'receiveCondition') {\n        rcvr = this.editor.scriptTarget();\n        if (rcvr) {\n            stage = rcvr.parentThatIsA(StageMorph);\n            if (stage) {\n                stage.enableCustomHatBlocks = true;\n                stage.threads.pauseCustomHatBlocks = false;\n                ide = stage.parentThatIsA(IDE_Morph);\n                if (ide) {\n                    ide.controlBar.stopButton.refresh();\n                }\n            }\n        }\n    }\n\n    // experimental: if the inserted block has inputs, go to the first one\n    if (block.inputs && block.inputs().length) {\n        this.element = block;\n        this.atEnd = false;\n        this.nextElement();\n    }\n};\n\nScriptFocusMorph.prototype.insertVariableGetter = function () {\n    var types = this.blockTypes(),\n        vars,\n        menu = new MenuMorph();\n    if (!types || !contains(types, 'reporter')) {\n        return;\n    }\n    vars = InputSlotMorph.prototype.getVarNamesDict.call(this.element);\n    Object.keys(vars).forEach(vName => {\n        var block = SpriteMorph.prototype.variableBlock(vName);\n        block.addShadow(new Point(3, 3));\n        menu.addItem(\n            block,\n            () => {\n                block.removeShadow();\n                this.insertBlock(block);\n            }\n        );\n    });\n    if (menu.items.length > 0) {\n        menu.popup(this.world(), this.element.bottomLeft());\n        menu.getFocus();\n    }\n};\n\nScriptFocusMorph.prototype.stopEditing = function () {\n    this.editor.focus = null;\n    this.editor.updateToolbar();\n    this.world().keyboardFocus = null;\n    this.destroy();\n};\n\n// ScriptFocusMorph navigation\n\nScriptFocusMorph.prototype.lastElement = function () {\n    var items = this.items(),\n        idx;\n    if (!items.length) {\n        this.shiftScript(new Point(-50, 0));\n        return;\n    }\n    if (this.atEnd) {\n        this.element = items[items.length - 1];\n        this.atEnd = false;\n    } else {\n        idx = items.indexOf(this.element) - 1;\n        if (idx < 0) {idx = items.length - 1; }\n        this.element = items[idx];\n    }\n    if (this.element instanceof CommandSlotMorph &&\n            this.element.nestedBlock()) {\n        this.lastElement();\n    } else if (this.element instanceof HatBlockMorph) {\n        if (items.length > 1) {\n            this.lastElement();\n        } else {\n            this.atEnd = true;\n        }\n    }\n    this.fixLayout();\n};\n\nScriptFocusMorph.prototype.nextElement = function () {\n    var items = this.items(), idx, nb;\n    if (!items.length) {\n        this.shiftScript(new Point(50, 0));\n        return;\n    }\n    idx = items.indexOf(this.element) + 1;\n    if (idx >= items.length) {\n        idx = 0;\n    }\n    this.atEnd = false;\n    this.element = items[idx];\n    if (this.element instanceof CommandSlotMorph) {\n        nb = this.element.nestedBlock();\n        if (nb) {this.element = nb; }\n    } else if (this.element instanceof HatBlockMorph) {\n        if (items.length === 1) {\n            this.atEnd = true;\n        } else {\n            this.nextElement();\n        }\n    }\n    this.fixLayout();\n};\n\nScriptFocusMorph.prototype.lastCommand = function () {\n    var cm = this.element.parentThatIsA(CommandBlockMorph),\n        pb;\n    if (!cm) {\n        if (this.element instanceof ScriptsMorph) {\n            this.shiftScript(new Point(0, -50));\n        }\n        return;\n    }\n    if (this.element instanceof CommandBlockMorph) {\n        if (this.atEnd) {\n            this.atEnd = false;\n        } else {\n            pb = cm.parent.parentThatIsA(CommandBlockMorph);\n            if (pb) {\n                this.element = pb;\n            } else {\n                pb = cm.topBlock().bottomBlock();\n                if (pb) {\n                    this.element = pb;\n                    this.atEnd = true;\n                }\n            }\n        }\n    } else {\n        this.element = cm;\n        this.atEnd = false;\n    }\n    if (this.element instanceof HatBlockMorph && !this.atEnd) {\n        this.lastCommand();\n    }\n    this.fixLayout();\n};\n\nScriptFocusMorph.prototype.nextCommand = function () {\n    var cm = this.element,\n        tb,\n        nb,\n        cs;\n    if (cm instanceof ScriptsMorph) {\n        this.shiftScript(new Point(0, 50));\n        return;\n    }\n    while (!(cm instanceof CommandBlockMorph)) {\n        cm = cm.parent;\n        if (cm instanceof ScriptsMorph) {\n            return;\n        }\n    }\n    if (this.atEnd) {\n        cs = cm.parentThatIsA(CommandSlotMorph);\n        if (cs) {\n            this.element = cs.parentThatIsA(CommandBlockMorph);\n            this.atEnd = false;\n            this.nextCommand();\n        } else {\n            tb = cm.topBlock().parentThatIsA(CommandBlockMorph);\n            if (tb) {\n                this.element = tb;\n                this.atEnd = false;\n                if (this.element instanceof HatBlockMorph) {\n                    this.nextCommand();\n                }\n            }\n        }\n    } else {\n        nb = cm.nextBlock();\n        if (nb) {\n            this.element = nb;\n        } else {\n            this.element = cm;\n            this.atEnd = true;\n        }\n    }\n    this.fixLayout();\n};\n\nScriptFocusMorph.prototype.nextScript = function () {\n    var scripts = this.sortedScripts(),\n        idx;\n    if (scripts.length < 1) {return; }\n    if (this.element instanceof ScriptsMorph) {\n        this.element = scripts[0];\n    }\n    idx = scripts.indexOf(this.element.topBlock()) + 1;\n    if (idx >= scripts.length) {idx = 0; }\n    this.element = scripts[idx];\n    this.element.scrollIntoView();\n    this.atEnd = false;\n    if (this.element instanceof HatBlockMorph) {\n        return this.nextElement();\n    }\n    this.fixLayout();\n};\n\nScriptFocusMorph.prototype.lastScript = function () {\n    var scripts = this.sortedScripts(),\n        idx;\n    if (scripts.length < 1) {return; }\n    if (this.element instanceof ScriptsMorph) {\n        this.element = scripts[0];\n    }\n    idx = scripts.indexOf(this.element.topBlock()) - 1;\n    if (idx < 0) {idx = scripts.length - 1; }\n    this.element = scripts[idx];\n    this.element.scrollIntoView();\n    this.atEnd = false;\n    if (this.element instanceof HatBlockMorph) {\n        return this.nextElement();\n    }\n    this.fixLayout();\n};\n\n// ScriptFocusMorph.prototype.shiftScript = function (deltaPoint) {\n//     var tb;\n//     if (this.element instanceof ScriptsMorph) {\n//         this.moveBy(deltaPoint);\n//     } else {\n//         tb = this.element.topBlock();\n//         if (tb && !(tb instanceof PrototypeHatBlockMorph)) {\n//             tb.moveBy(deltaPoint);\n//         }\n//     }\n//     this.editor.adjustBounds();\n//     this.fixLayout();\n// };\n\nScriptFocusMorph.prototype.newScript = function () {\n    var pos = this.position();\n    if (!(this.element instanceof ScriptsMorph)) {\n        pos = this.element.topBlock().fullBounds().bottomLeft().add(\n            new Point(0, 50)\n        );\n    }\n    this.setPosition(pos);\n    this.element = this.editor;\n    this.editor.adjustBounds();\n    this.fixLayout();\n};\n\nScriptFocusMorph.prototype.runScript = function () {\n    if (this.element instanceof ScriptsMorph) {return; }\n    this.element.topBlock().mouseClickLeft();\n};\n\nScriptFocusMorph.prototype.items = function () {\n    if (this.element instanceof ScriptsMorph) {return []; }\n    var script = this.element.topBlock();\n    return script.allChildren().filter(each =>\n        each instanceof SyntaxElementMorph &&\n            !(each instanceof TemplateSlotMorph) &&\n                (!each.isStatic ||\n                    each.choices ||\n                    each instanceof BooleanSlotMorph ||\n                    each instanceof RingMorph ||\n                    each instanceof MultiArgMorph ||\n                    each instanceof CommandSlotMorph\n                )\n    );\n};\n//\n// ScriptFocusMorph.prototype.sortedScripts = function () {\n//     var scripts = this.editor.children.filter(each =>\n//         each instanceof BlockMorph\n//     );\n//     scripts.sort((a, b) =>\n//         // make sure the prototype hat block always stays on top\n//         a instanceof PrototypeHatBlockMorph ? 0 : a.top() - b.top()\n//     );\n//     return scripts;\n// };\n\n// ScriptFocusMorph undo / redo\n\nScriptFocusMorph.prototype.undrop = function () {\n    this.editor.undrop();\n};\n\nScriptFocusMorph.prototype.redrop = function () {\n    this.editor.redrop();\n};\n\n// ScriptFocusMorph block types\n\nScriptFocusMorph.prototype.blockTypes = function () {\n    // answer an array of possible block types that fit into\n    // the current situation, NULL if no block can be inserted\n\n    if (this.element.isTemplate) {return null; }\n    if (this.element instanceof ScriptsMorph) {\n        return ['hat', 'command', 'reporter', 'predicate', 'ring'];\n    }\n    if (this.element instanceof HatBlockMorph ||\n            this.element instanceof CommandSlotMorph) {\n        return ['command'];\n    }\n    if (this.element instanceof CommandBlockMorph) {\n        if (this.atEnd && this.element.isStop()) {\n            return null;\n        }\n        if (this.element.parent instanceof ScriptsMorph) {\n            return ['hat', 'command'];\n        }\n        return ['command'];\n    }\n    if (this.element instanceof ReporterBlockMorph) {\n        if (this.element.getSlotSpec() === '%n') {\n            return ['reporter'];\n        }\n        return ['reporter', 'predicate', 'ring'];\n    }\n    if (this.element.getSpec() === '%n') {\n        return ['reporter'];\n    }\n    if (this.element.isStatic) {\n        return null;\n    }\n    return ['reporter', 'predicate', 'ring'];\n};\n\n\n// ScriptFocusMorph keyboard events\n\nScriptFocusMorph.prototype.processKeyDown = function (event) {\n    this.processKeyEvent(\n        event,\n        this.reactToKeyEvent\n    );\n};\n\nScriptFocusMorph.prototype.processKeyUp = function (event) {\n    nop(event);\n};\n\nScriptFocusMorph.prototype.processKeyPress = function (event) {\n    nop(event);\n};\n\n\nScriptFocusMorph.prototype.processKeyEvent = function (event, action) {\n    var keyName, ctrl, shift;\n\n    //console.log(event.keyCode);\n    this.world().hand.destroyTemporaries(); // remove result bubbles, if any\n    switch (event.keyCode) {\n    case 8:\n        keyName = 'backspace';\n        break;\n    case 9:\n        keyName = 'tab';\n        break;\n    case 13:\n        keyName = 'enter';\n        break;\n    case 16:\n    case 17:\n    case 18:\n        return;\n    case 27:\n        keyName = 'esc';\n        break;\n    case 32:\n        keyName = 'space';\n        break;\n    case 37:\n        keyName = 'left arrow';\n        break;\n    case 39:\n        keyName = 'right arrow';\n        break;\n    case 38:\n        keyName = 'up arrow';\n        break;\n    case 40:\n        keyName = 'down arrow';\n        break;\n    default:\n        keyName = String.fromCharCode(event.keyCode || event.charCode);\n    }\n    ctrl = (event.ctrlKey || event.metaKey) ? 'ctrl ' : '';\n    shift = event.shiftKey ? 'shift ' : '';\n    keyName = ctrl + shift + keyName;\n    action.call(this, keyName);\n};\n\nScriptFocusMorph.prototype.reactToKeyEvent = function (key) {\n    var evt = key.toLowerCase(),\n        shift = 50,\n        types,\n        vNames;\n\n    // console.log(evt);\n    switch (evt) {\n    case 'esc':\n        return this.stopEditing();\n    case 'enter':\n        return this.trigger();\n    case 'shift enter':\n        return this.newScript();\n    case 'ctrl shift enter':\n        return this.runScript();\n    case 'space':\n        return this.menu();\n    case 'left arrow':\n        return this.lastElement();\n    case 'shift left arrow':\n        return this.shiftScript(new Point(-shift, 0));\n    case 'right arrow':\n        return this.nextElement();\n    case 'shift right arrow':\n        return this.shiftScript(new Point(shift, 0));\n    case 'up arrow':\n        return this.lastCommand();\n    case 'shift up arrow':\n        return this.shiftScript(new Point(0, -shift));\n    case 'down arrow':\n        return this.nextCommand();\n    case 'shift down arrow':\n        return this.shiftScript(new Point(0, shift));\n    case 'tab':\n        return this.nextScript();\n    case 'shift tab':\n        return this.lastScript();\n    case 'backspace':\n        return this.deleteLastElement();\n    case 'ctrl z':\n        return this.undrop();\n    case 'ctrl y':\n    case 'ctrl shift z':\n        return this.redrop();\n    case 'ctrl [': // ignore the first press of the Mac cmd key\n        return;\n    default:\n        types = this.blockTypes();\n        if (!(this.element instanceof ScriptsMorph) &&\n                types && contains(types, 'reporter')) {\n            vNames = Object.keys(this.element.getVarNamesDict());\n        }\n        if (types) {\n            delete this.fps;\n            delete this.step;\n            this.show();\n            this.editor.scriptTarget().searchBlocks(\n                key,\n                types,\n                vNames,\n                this\n            );\n        }\n    }\n};\n\n\n/*\n// register examples with the World demo menu\n// comment out to shave off a millisecond loading speed ;-)\n\n(function () {\n    var h, b, c, ci, cb, cm, cd, co, cl, cu, cs, cmd, rings, rc, scripts;\n    // SyntaxElementMorph.prototype.setScale(2.5);\n\n    h = new HatBlockMorph();\n    h.setSpec('When %greenflag pressed');\n\n    b = new ReporterBlockMorph(true);\n    b.setSpec('%bool');\n\n    c = new CommandBlockMorph();\n    c.setSpec('this is a test $globe');\n\n    ci = new CommandBlockMorph();\n    ci.setSpec('block with input %s unit %mult%n number');\n\n    cb = new CommandBlockMorph();\n    cb.setSpec('bool %b ?');\n\n    cd = new CommandBlockMorph();\n    cd.setSpec('direction %dir degrees');\n\n    co = new CommandBlockMorph();\n    co.setSpec('object %obj');\n\n    cl = new CommandBlockMorph();\n    cl.setSpec('list %l');\n\n    cu = new CommandBlockMorph();\n    cu.setSpec('list %upvar');\n\n    cs = new CommandBlockMorph();\n    cs.setSpec('control %b %ca');\n\n    cmd = new CommandBlockMorph();\n    cmd.setSpec('command %cmdRing');\n\n    rings = new CommandBlockMorph();\n    rings.setSpec('reporter %repRing predicate %predRing');\n\n    rc = new ReporterBlockMorph();\n    rc.setSpec('color %clr');\n\n    scripts = new ScriptsMorph();\n\n    BlockMorph.prototype.addToDemoMenu([\n        'Syntax',\n        [\n            [h, 'hat'],\n            [b, 'predicate'],\n            [c, 'with label text'],\n            [ci, 'editable input slots'],\n            [cb, 'Boolean slot'],\n            [cm, 'menu input'],\n            [cd, 'direction input'],\n            [co, 'object input'],\n            [cl, 'list input'],\n            [cu, 'upvar input'],\n            [cs, 'loop input'],\n            [cmd, 'cmd ring input'],\n            [rings, 'reporter rings input'],\n            [rc, 'color input'],\n            [scripts, 'scripts']\n        ]\n    ]);\n})();\n*/\n","/*\n\n    widgets.js\n\n    additional GUI elements for morphic.js\n\n    written by Jens Mnig\n    jens@moenig.org\n\n    Copyright (C) 2020 by Jens Mnig\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    prerequisites:\n    --------------\n    needs blocks.js and objects.js\n\n\n    credits\n    -------\n    Lucas Karahadian contributed a first prototype of the piano keyboard\n\n\n    I. hierarchy\n    -------------\n    the following tree lists all constructors hierarchically,\n    indentation indicating inheritance. Refer to this list to get a\n    contextual overview:\n\n    Morph*\n        AlignmentMorph\n        DialogBoxMorph\n        InputFieldMorph\n    TriggerMorph*\n        MenuItemMorph*\n            PianoKeyMorph\n        PushButtonMorph\n            ToggleButtonMorph\n                TabMorph\n            ToggleMorph\n        ToggleElementMorph\n    MenuMorph*\n        PianoMenuMorph\n\n    * from Morphic.js\n\n\n    II. toc\n    -------\n    the following list shows the order in which all constructors are\n    defined. Use this list to locate code in this document:\n\n    PushButtonMorph\n    ToggleButtonMorph\n    TabMorph\n    ToggleMorph\n    ToggleElementMorph\n    DialogBoxMorph\n    AlignmentMorph\n    InputFieldMorph\n    PianoMenuMorph\n    PianoKeyMorph\n\n*/\n\n// Global settings /////////////////////////////////////////////////////\n\n/*global TriggerMorph, modules, Color, Point, BoxMorph, radians, ZERO,\nStringMorph, Morph, TextMorph, nop, detect, StringFieldMorph, BLACK, WHITE,\nHTMLCanvasElement, fontHeight, SymbolMorph, localize, SpeechBubbleMorph,\nArrowMorph, MenuMorph, isString, isNil, SliderMorph, MorphicPreferences,\nScrollFrameMorph, MenuItemMorph, Note, useBlurredShadows*/\n\nimport { TriggerMorph, modules, Color, Point, BoxMorph, radians, ZERO,\n  StringMorph, Morph, TextMorph, nop, detect, StringFieldMorph, BLACK, WHITE,\n   fontHeight, localize, SpeechBubbleMorph,\n   MenuMorph, isString, isNil, SliderMorph, MorphicPreferences,\n  ScrollFrameMorph, MenuItemMorph, useBlurredShadows} from './morphic';\n\nimport {SymbolMorph} from \"./symbols\";\nimport {ArrowMorph} from \"./blocks\";\n\nmodules.widgets = '2020-October-06';\n\n// var PushButtonMorph;\n// var ToggleButtonMorph;\n// var TabMorph;\n// var ToggleMorph;\n// var ToggleElementMorph;\n// var DialogBoxMorph;\n// var AlignmentMorph;\n// var InputFieldMorph;\n// var PianoMenuMorph;\n// var PianoKeyMorph;\n\n// PushButtonMorph /////////////////////////////////////////////////////\n\n// I am a Button with rounded corners and 3D-ish graphical effects\n\n// PushButtonMorph inherits from TriggerMorph:\n\nPushButtonMorph.prototype = new TriggerMorph();\nPushButtonMorph.prototype.constructor = PushButtonMorph;\nPushButtonMorph.uber = TriggerMorph.prototype;\n\n// PushButtonMorph preferences settings:\n\nPushButtonMorph.prototype.fontSize = 10;\nPushButtonMorph.prototype.fontStyle = 'sans-serif';\nPushButtonMorph.prototype.labelColor = BLACK;\nPushButtonMorph.prototype.labelShadowColor = WHITE;\nPushButtonMorph.prototype.labelShadowOffset = new Point(1, 1);\n\nPushButtonMorph.prototype.color = new Color(220, 220, 220);\nPushButtonMorph.prototype.pressColor = new Color(115, 180, 240);\nPushButtonMorph.prototype.highlightColor\n    = PushButtonMorph.prototype.pressColor.lighter(50);\nPushButtonMorph.prototype.outlineColor = new Color(30, 30, 30);\nPushButtonMorph.prototype.outlineGradient = false;\nPushButtonMorph.prototype.contrast = 60;\n\nPushButtonMorph.prototype.edge = 2;\nPushButtonMorph.prototype.corner = 5;\nPushButtonMorph.prototype.outline = 1;\nPushButtonMorph.prototype.padding = 3;\n\n// PushButtonMorph instance creation:\n\nexport function PushButtonMorph(\n    target,\n    action,\n    labelString,\n    environment,\n    hint\n) {\n    this.init(\n        target,\n        action,\n        labelString,\n        environment,\n        hint\n    );\n}\n\nPushButtonMorph.prototype.init = function (\n    target,\n    action,\n    labelString,\n    environment,\n    hint\n) {\n    // additional properties:\n    this.is3D = false; // for \"flat\" design exceptions\n    this.target = target || null;\n    this.action = action || null;\n    this.environment = environment || null;\n    this.labelString = labelString || null;\n    this.label = null;\n    this.labelMinExtent = ZERO;\n    this.hint = hint || null;\n    this.isDisabled = false;\n\n    // initialize inherited properties:\n    TriggerMorph.uber.init.call(this);\n\n    // override inherited properites:\n    this.color = PushButtonMorph.prototype.color;\n    this.createLabel();\n    this.fixLayout();\n    this.rerender();\n};\n\n// PushButtonMorph layout:\n\nPushButtonMorph.prototype.fixLayout = function () {\n    // make sure I at least encompass my label\n    if (this.label !== null) {\n        this.updateLabelColors();\n        var padding = this.padding * 2 + this.outline * 2 + this.edge * 2;\n        this.bounds.setWidth(\n            Math.max(this.label.width(), this.labelMinExtent.x) + padding\n        );\n        this.bounds.setHeight(\n            Math.max(\n                this.label instanceof StringMorph ?\n                    this.label.rawHeight() : this.label.height(),\n                this.labelMinExtent.y\n            ) + padding\n        );\n        this.label.setCenter(this.center());\n    }\n};\n\n// PushButtonMorph events\n\nPushButtonMorph.prototype.mouseDownLeft = function () {\n    PushButtonMorph.uber.mouseDownLeft.call(this);\n    if (this.label) {\n        this.label.setCenter(this.center().add(1));\n    }\n};\n\nPushButtonMorph.prototype.mouseClickLeft = function () {\n    if (this.isDisabled) {return; }\n    PushButtonMorph.uber.mouseClickLeft.call(this);\n    if (this.label) {\n        this.label.setCenter(this.center());\n    }\n};\n\nPushButtonMorph.prototype.mouseLeave = function () {\n    PushButtonMorph.uber.mouseLeave.call(this);\n    if (this.label) {\n        this.label.setCenter(this.center());\n    }\n};\n\n// PushButtonMorph drawing:\n\nPushButtonMorph.prototype.render = function (ctx) {\n    if (this.userState === 'highlight') {\n        this.drawOutline(ctx);\n        this.drawBackground(ctx, this.highlightColor);\n        this.drawEdges(\n            ctx,\n            this.highlightColor,\n            this.highlightColor.lighter(this.contrast),\n            this.highlightColor.darker(this.contrast)\n        );\n    } else if (this.userState === 'pressed') {\n        this.drawOutline(ctx);\n        this.drawBackground(ctx, this.pressColor);\n        this.drawEdges(\n            ctx,\n            this.pressColor,\n            this.pressColor.darker(this.contrast),\n            this.pressColor.lighter(this.contrast)\n        );\n    } else {\n        this.drawOutline(ctx);\n        this.drawBackground(ctx, this.color);\n        this.drawEdges(\n            ctx,\n            this.color,\n            this.color.lighter(this.contrast),\n            this.color.darker(this.contrast)\n        );\n    }\n};\n\nPushButtonMorph.prototype.drawOutline = function (ctx) {\n    var outlineStyle,\n        isFlat = MorphicPreferences.isFlat && !this.is3D;\n\n    if (!this.outline || isFlat) {return null; }\n    if (this.outlineGradient) {\n        outlineStyle = ctx.createLinearGradient(\n            0,\n            0,\n            0,\n            this.height()\n        );\n        outlineStyle.addColorStop(0, this.outlineColor.darker().toString());\n        outlineStyle.addColorStop(1, 'white');\n    } else {\n        outlineStyle = this.outlineColor.toString();\n    }\n    ctx.fillStyle = outlineStyle;\n    ctx.beginPath();\n    this.outlinePath(\n        ctx,\n        isFlat ? 0 : this.corner,\n        0\n    );\n    ctx.closePath();\n    ctx.fill();\n};\n\nPushButtonMorph.prototype.drawBackground = function (ctx, color) {\n    var isFlat = MorphicPreferences.isFlat && !this.is3D;\n\n    ctx.fillStyle = color.toString();\n    ctx.beginPath();\n    this.outlinePath(\n        ctx,\n        isFlat ? 0 : Math.max(this.corner - this.outline, 0),\n        this.outline\n    );\n    ctx.closePath();\n    ctx.fill();\n    ctx.lineWidth = this.outline;\n};\n\nPushButtonMorph.prototype.drawEdges = function (\n    ctx,\n    color,\n    topColor,\n    bottomColor\n) {\n    if (MorphicPreferences.isFlat && !this.is3D) {return; }\n    var minInset = Math.max(this.corner, this.outline + this.edge),\n        w = this.width(),\n        h = this.height(),\n        gradient;\n\n    // top:\n    gradient = ctx.createLinearGradient(\n        0,\n        this.outline,\n        0,\n        this.outline + this.edge\n    );\n    gradient.addColorStop(0, topColor.toString());\n    gradient.addColorStop(1, color.toString());\n\n    ctx.strokeStyle = gradient;\n    ctx.lineCap = 'round';\n    ctx.lineWidth = this.edge;\n    ctx.beginPath();\n    ctx.moveTo(minInset, this.outline + this.edge / 2);\n    ctx.lineTo(w - minInset, this.outline + this.edge / 2);\n    ctx.stroke();\n\n    // top-left corner:\n    gradient = ctx.createRadialGradient(\n        this.corner,\n        this.corner,\n        Math.max(this.corner - this.outline - this.edge, 0),\n        this.corner,\n        this.corner,\n        Math.max(this.corner - this.outline, 0)\n    );\n    gradient.addColorStop(0, color.toString());\n    gradient.addColorStop(1, topColor.toString());\n\n    ctx.strokeStyle = gradient;\n    ctx.lineCap = 'round';\n    ctx.lineWidth = this.edge;\n    ctx.beginPath();\n    ctx.arc(\n        this.corner,\n        this.corner,\n        Math.max(this.corner - this.outline - this.edge / 2, 0),\n        radians(180),\n        radians(270),\n        false\n    );\n    ctx.stroke();\n\n    // left:\n    gradient = ctx.createLinearGradient(\n        this.outline,\n        0,\n        this.outline + this.edge,\n        0\n    );\n    gradient.addColorStop(0, topColor.toString());\n    gradient.addColorStop(1, color.toString());\n\n    ctx.strokeStyle = gradient;\n    ctx.lineCap = 'round';\n    ctx.lineWidth = this.edge;\n    ctx.beginPath();\n    ctx.moveTo(this.outline + this.edge / 2, minInset);\n    ctx.lineTo(this.outline + this.edge / 2, h - minInset);\n    ctx.stroke();\n\n    // bottom:\n    gradient = ctx.createLinearGradient(\n        0,\n        h - this.outline,\n        0,\n        h - this.outline - this.edge\n    );\n    gradient.addColorStop(0, bottomColor.toString());\n    gradient.addColorStop(1, color.toString());\n\n    ctx.strokeStyle = gradient;\n    ctx.lineCap = 'round';\n    ctx.lineWidth = this.edge;\n    ctx.beginPath();\n    ctx.moveTo(minInset, h - this.outline - this.edge / 2);\n    ctx.lineTo(w - minInset, h - this.outline - this.edge / 2);\n    ctx.stroke();\n\n    // bottom-right corner:\n    gradient = ctx.createRadialGradient(\n        w - this.corner,\n        h - this.corner,\n        Math.max(this.corner - this.outline - this.edge, 0),\n        w - this.corner,\n        h - this.corner,\n        Math.max(this.corner - this.outline, 0)\n    );\n    gradient.addColorStop(0, color.toString());\n    gradient.addColorStop(1, bottomColor.toString());\n\n    ctx.strokeStyle = gradient;\n    ctx.lineCap = 'round';\n    ctx.lineWidth = this.edge;\n    ctx.beginPath();\n    ctx.arc(\n        w - this.corner,\n        h - this.corner,\n        Math.max(this.corner - this.outline - this.edge / 2, 0),\n        radians(0),\n        radians(90),\n        false\n    );\n    ctx.stroke();\n\n    // right:\n    gradient = ctx.createLinearGradient(\n        w - this.outline,\n        0,\n        w - this.outline - this.edge,\n        0\n    );\n    gradient.addColorStop(0, bottomColor.toString());\n    gradient.addColorStop(1, color.toString());\n\n    ctx.strokeStyle = gradient;\n    ctx.lineCap = 'round';\n    ctx.lineWidth = this.edge;\n    ctx.beginPath();\n    ctx.moveTo(w - this.outline - this.edge / 2, minInset);\n    ctx.lineTo(w - this.outline - this.edge / 2, h - minInset);\n    ctx.stroke();\n};\n\nPushButtonMorph.prototype.outlinePath = BoxMorph.prototype.outlinePath;\n\nPushButtonMorph.prototype.createLabel = function () {\n    var shading = !MorphicPreferences.isFlat || this.is3D;\n\n    if (this.label !== null) {\n        this.label.destroy();\n    }\n    if (this.labelString instanceof SymbolMorph) {\n        this.label = this.labelString.fullCopy();\n        if (shading) {\n            this.label.shadowOffset = this.labelShadowOffset;\n            this.label.shadowColor = this.labelShadowColor;\n        }\n        this.label.color = this.labelColor;\n    } else {\n        this.label = new StringMorph(\n            localize(this.labelString),\n            this.fontSize,\n            this.fontStyle,\n            true,\n            false,\n            false,\n            shading ? this.labelShadowOffset : null,\n            this.labelShadowColor,\n            this.labelColor\n        );\n    }\n    this.add(this.label);\n};\n\nPushButtonMorph.prototype.updateLabelColors = function () {\n    var shading = !MorphicPreferences.isFlat || this.is3D;\n    if (this.label) {\n        this.label.color = this.labelColor;\n        this.label.fontSize = this.fontSize;\n        if (shading) {\n            this.label.shadowOffset = this.labelShadowOffset;\n            this.label.shadowColor = this.labelShadowColor;\n        }\n        this.label.fixLayout(true); // just me\n    }\n};\n\n// PushButtonMorph states\n\nPushButtonMorph.prototype.disable = function () {\n    this.isDisabled = true;\n    this.forAllChildren(child =>\n        child.alpha = 0.3\n    );\n    this.rerender();\n};\n\nPushButtonMorph.prototype.enable = function () {\n    this.isDisabled = false;\n    this.forAllChildren(child =>\n        child.alpha = 1\n    );\n    this.rerender();\n};\n\n// ToggleButtonMorph ///////////////////////////////////////////////////////\n\n/*\n    I am a two-state PushButton. When my state is \"true\" I keep my \"pressed\"\n    background color. I can also be set to not auto-layout my bounds, in\n    which case my label will left-align.\n*/\n\n// ToggleButtonMorph inherits from PushButtonMorph:\n\nToggleButtonMorph.prototype = new PushButtonMorph();\nToggleButtonMorph.prototype.constructor = ToggleButtonMorph;\nToggleButtonMorph.uber = PushButtonMorph.prototype;\n\n// ToggleButton settings\n\nToggleButtonMorph.prototype.contrast = 30;\nToggleButtonMorph.prototype.labelPressColor = null;\n\n// ToggleButtonMorph instance creation:\n\nexport function ToggleButtonMorph(\n    colors, // color overrides, <array>: [normal, highlight, pressed]\n    target,\n    action, // a toggle function\n    labelString,\n    query, // predicate/selector\n    environment,\n    hint,\n    minWidth, // <num> optional, if specified label will left-align\n    hasPreview, // <bool> show press color on left edge (e.g. category)\n    isPicture // treat label as picture, i.e. don't apply typography\n) {\n    this.init(\n        colors,\n        target,\n        action,\n        labelString,\n        query,\n        environment,\n        hint,\n        minWidth,\n        hasPreview,\n        isPicture\n    );\n}\n\nToggleButtonMorph.prototype.init = function (\n    colors,\n    target,\n    action,\n    labelString,\n    query,\n    environment,\n    hint,\n    minWidth,\n    hasPreview,\n    isPicture\n) {\n    // additional properties:\n    this.state = false;\n    this.query = query || (() => true);\n    this.minWidth = minWidth || null;\n    this.hasPreview = hasPreview || false;\n    this.isPicture = isPicture || false;\n    this.hasNeutralBackground = false;\n    this.trueStateLabel = null;\n\n    // initialize inherited properties:\n    ToggleButtonMorph.uber.init.call(\n        this,\n        target,\n        action,\n        labelString,\n        environment,\n        hint\n    );\n\n    // override default colors if others are specified\n    if (colors) {\n        this.color = colors[0];\n        this.highlightColor = colors[1];\n        this.pressColor = colors[2];\n    }\n\n    this.refresh();\n    this.rerender();\n};\n\n// ToggleButtonMorph events\n\nToggleButtonMorph.prototype.mouseEnter = function () {\n    var contents = this.hint instanceof Function ? this.hint() : this.hint;\n    if (!this.state || this.hasNeutralBackground) {\n        this.userState = 'highlight';\n        this.rerender();\n    }\n    if (contents) {\n        this.bubbleHelp(contents);\n    }\n};\n\nToggleButtonMorph.prototype.mouseLeave = function () {\n    if (!this.state || this.hasNeutralBackground) {\n        this.userState = 'normal';\n        this.rerender();\n    }\n    if (this.schedule) {\n        this.schedule.isActive = false;\n    }\n    if (this.hint) {\n        this.world().hand.destroyTemporaries();\n    }\n};\n\nToggleButtonMorph.prototype.mouseDownLeft = function () {\n    if (!this.state) {\n        this.userState = 'pressed';\n        this.rerender();\n    }\n};\n\nToggleButtonMorph.prototype.mouseClickLeft = function () {\n    if (!this.state) {\n        this.userState = 'highlight';\n        this.rerender();\n    }\n    this.trigger(); // allow me to be triggered again to force-update others\n};\n\n// ToggleButtonMorph action\n\nToggleButtonMorph.prototype.trigger = function () {\n    ToggleButtonMorph.uber.trigger.call(this);\n    this.refresh();\n};\n\nToggleButtonMorph.prototype.refresh = function () {\n/*\n    if query is a function:\n    execute the query with target as environment (can be null)\n    for lambdafied (inline) actions\n\n    else if query is a String:\n    treat it as function property of target and execute it\n    for selector-like queries\n*/\n    if (typeof this.query === 'function') {\n        this.state = this.query.call(this.target);\n    } else { // assume it's a String\n        this.state = this.target[this.query]();\n    }\n    if (this.state) {\n        this.userState = 'pressed';\n        if (this.labelPressColor) {\n            this.label.setColor(this.labelPressColor);\n        }\n        if (this.trueStateLabel) {\n            this.label.hide();\n            this.trueStateLabel.show();\n        }\n    } else {\n        this.userState = 'normal';\n        if (this.labelPressColor) {\n            this.label.setColor(this.labelColor);\n        }\n        if (this.trueStateLabel) {\n            this.label.show();\n            this.trueStateLabel.hide();\n        }\n    }\n    this.rerender();\n};\n\n// ToggleButtonMorph layout:\n\nToggleButtonMorph.prototype.fixLayout = function () {\n    if (this.label !== null) {\n        var padding = this.padding * 2 + this.outline * 2 + this.edge * 2,\n            lw;\n\n        this.updateLabelColors();\n        lw = Math.max(this.label.width(), this.labelMinExtent.x);\n        this.bounds.setWidth(this.minWidth ?\n                Math.max(this.minWidth, lw) + padding\n                    : lw + padding\n        );\n        this.bounds.setHeight(\n            Math.max(this.label instanceof StringMorph ?\n                    this.label.rawHeight() :\n                        this.label.height(), this.labelMinExtent.y) + padding\n        );\n        this.label.setCenter(this.center());\n        if (this.trueStateLabel) {\n            this.trueStateLabel.setCenter(this.center());\n        }\n        if (this.minWidth) { // left-align along my corner\n            this.label.setLeft(\n                this.left()\n                    + this.outline\n                    + this.edge\n                    + this.corner\n                    + this.padding\n            );\n        }\n    }\n};\n\n// ToggleButtonMorph drawing\n\nToggleButtonMorph.prototype.render = function (ctx) {\n/*\n    basically the same as inherited from PushButtonMorph, except for\n    not inverting the pressed 3D-ish border (because it stays that way),\n    and optionally coloring the left edge in the press-color, previewing\n    the selection color (e.g. in the case of Snap palette-category\n    selector. the latter is done in the drawEdges() method.\n*/\n    switch (this.userState) {\n    case 'highlight':\n        this.drawOutline(ctx);\n        this.drawBackground(ctx, this.highlightColor);\n        this.drawEdges(\n            ctx,\n            this.highlightColor,\n            this.highlightColor.lighter(this.contrast),\n            this.highlightColor.darker(this.contrast)\n        );\n        break;\n    case 'pressed':\n        // note: don't invert the 3D-ish edges for 'pressed' state, because\n        // it will stay that way, and should not look inverted (or should it?)\n        this.drawOutline(ctx);\n        this.drawBackground(ctx, this.getPressRenderColor());\n        this.drawEdges(\n            ctx,\n            this.pressColor,\n            this.pressColor.lighter(40),\n            this.pressColor.darker(40)\n        );\n        break;\n    default:\n        this.drawOutline(ctx);\n        this.drawBackground(ctx, this.color);\n        this.drawEdges(\n            ctx,\n            this.color,\n            this.color.lighter(this.contrast),\n            this.color.darker(this.contrast)\n        );\n    }\n};\n\nToggleButtonMorph.prototype.getPressRenderColor = function () {\n    // can be overridden by my children\n    return this.pressColor;\n};\n\nToggleButtonMorph.prototype.drawEdges = function (\n    ctx,\n    color,\n    topColor,\n    bottomColor\n) {\n    var gradient;\n\n    ToggleButtonMorph.uber.drawEdges.call(\n        this,\n        ctx,\n        color,\n        topColor,\n        bottomColor\n    );\n\n    if (this.hasPreview) { // indicate the possible selection color\n        if (MorphicPreferences.isFlat && !this.is3D) {\n            ctx.fillStyle = this.pressColor.toString();\n            ctx.fillRect(\n                this.outline,\n                this.outline,\n                this.corner,\n                this.height() - this.outline * 2\n            );\n            return;\n        }\n        gradient = ctx.createLinearGradient(\n            0,\n            0,\n            this.corner,\n            0\n        );\n        gradient.addColorStop(0, this.pressColor.lighter(40).toString());\n        gradient.addColorStop(1, this.pressColor.darker(40).toString());\n        ctx.fillStyle = gradient; // this.pressColor.toString();\n        ctx.beginPath();\n        this.previewPath(\n            ctx,\n            Math.max(this.corner - this.outline, 0),\n            this.outline\n        );\n        ctx.closePath();\n        ctx.fill();\n    }\n};\n\nToggleButtonMorph.prototype.previewPath = function (ctx, radius, inset) {\n    var offset = radius + inset,\n        h = this.height();\n\n    // top left:\n    ctx.arc(\n        offset,\n        offset,\n        radius,\n        radians(-180),\n        radians(-90),\n        false\n    );\n    // bottom left:\n    ctx.arc(\n        offset,\n        h - offset,\n        radius,\n        radians(90),\n        radians(180),\n        false\n    );\n};\n\nToggleButtonMorph.prototype.createLabel = function () {\n    var shading = !MorphicPreferences.isFlat || this.is3D;\n\n    if (this.label !== null) {\n        this.label.destroy();\n    }\n    if (this.trueStateLabel !== null) {\n        this.trueStateLabel.destroy();\n    }\n    if (this.labelString instanceof Array && this.labelString.length === 2) {\n        if (this.labelString[0] instanceof SymbolMorph) {\n            this.label = this.labelString[0].fullCopy();\n            this.trueStateLabel = this.labelString[1].fullCopy();\n            if (!this.isPicture) {\n                this.label.shadowOffset = shading ?\n                        this.labelShadowOffset : ZERO;\n                this.label.shadowColor = this.labelShadowColor;\n                this.label.color = this.labelColor;\n                this.label.fixLayout();\n                this.label.rerender();\n\n                this.trueStateLabel.shadowOffset = shading ?\n                        this.labelShadowOffset : ZERO;\n                this.trueStateLabel.shadowColor = this.labelShadowColor;\n                this.trueStateLabel.color = this.labelColor;\n                this.trueStateLabel.fixLayout();\n                this.trueStateLabel.rerender();\n            }\n        } else if (this.labelString[0] instanceof Morph) {\n            this.label = this.labelString[0].fullCopy();\n            this.trueStateLabel = this.labelString[1].fullCopy();\n        } else {\n            this.label = new StringMorph(\n                localize(this.labelString[0]),\n                this.fontSize,\n                this.fontStyle,\n                true,\n                false,\n                false,\n                shading ? this.labelShadowOffset : null,\n                this.labelShadowColor,\n                this.labelColor\n            );\n            this.trueStateLabel = new StringMorph(\n                localize(this.labelString[1]),\n                this.fontSize,\n                this.fontStyle,\n                true,\n                false,\n                false,\n                shading ? this.labelShadowOffset : null,\n                this.labelShadowColor,\n                this.labelColor\n            );\n        }\n    } else {\n        if (this.labelString instanceof SymbolMorph) {\n            this.label = this.labelString.fullCopy();\n            if (!this.isPicture) {\n                this.label.shadowOffset = shading ?\n                        this.labelShadowOffset : ZERO;\n                this.label.shadowColor = this.labelShadowColor;\n                this.label.color = this.labelColor;\n                this.label.fixLayout();\n                this.label.rerender();\n            }\n        } else if (this.labelString instanceof Morph) {\n            this.label = this.labelString.fullCopy();\n        } else {\n            this.label = new StringMorph(\n                localize(this.labelString),\n                this.fontSize,\n                this.fontStyle,\n                true,\n                false,\n                false,\n                shading ? this.labelShadowOffset : ZERO,\n                this.labelShadowColor,\n                this.labelColor\n            );\n        }\n    }\n    this.add(this.label);\n    if (this.trueStateLabel) {\n        this.add(this.trueStateLabel);\n    }\n};\n\nToggleButtonMorph.prototype.updateLabelColors = function () {\n    var shading = !MorphicPreferences.isFlat || this.is3D;\n    ToggleButtonMorph.uber.updateLabelColors.call(this);\n    if (this.trueStateLabel) {\n        this.trueStateLabel.color = this.labelColor;\n        if (shading) {\n            this.trueStateLabel.shadowOffset = this.labelShadowOffset;\n            this.trueStateLabel.shadowColor = this.labelShadowColor;\n        }\n        this.trueStateLabel.fixLayout(true); // just me\n    }\n};\n\n// TabMorph ///////////////////////////////////////////////////////\n\n// TabMorph inherits from ToggleButtonMorph:\n\nTabMorph.prototype = new ToggleButtonMorph();\nTabMorph.prototype.constructor = TabMorph;\nTabMorph.uber = ToggleButtonMorph.prototype;\n\n// TabMorph instance creation:\n\nexport function TabMorph(\n    colors, // color overrides, <array>: [normal, highlight, pressed]\n    target,\n    action, // a toggle function\n    labelString,\n    query, // predicate/selector\n    environment,\n    hint\n) {\n    this.init(\n        colors,\n        target,\n        action,\n        labelString,\n        query,\n        environment,\n        hint\n    );\n}\n\n// TabMorph layout:\n\nTabMorph.prototype.fixLayout = function () {\n    if (this.label !== null) {\n        this.updateLabelColors();\n        this.setExtent(new Point(\n            this.label.width()\n                + this.padding * 2\n                + this.corner * 3\n                + this.edge * 2,\n            (this.label instanceof StringMorph ?\n                        this.label.rawHeight() : this.label.height())\n                + this.padding * 2\n                + this.edge\n        ));\n        this.label.setCenter(this.center());\n    }\n};\n\n// TabMorph action:\n\nTabMorph.prototype.refresh = function () {\n    if (this.state) { // bring to front\n        if (this.parent) {\n            this.parent.add(this);\n        }\n    }\n    TabMorph.uber.refresh.call(this);\n};\n\n// TabMorph drawing:\n\nTabMorph.prototype.drawBackground = function (context, color) {\n    var w = this.width(),\n        h = this.height(),\n        c = this.corner;\n\n    context.fillStyle = color.toString();\n    context.beginPath();\n    context.moveTo(0, h);\n    context.bezierCurveTo(c, h, c, 0, c * 2, 0);\n    context.lineTo(w - c * 2, 0);\n    context.bezierCurveTo(w - c, 0, w - c, h, w, h);\n    context.closePath();\n    context.fill();\n};\n\nTabMorph.prototype.drawOutline = function () {\n    nop();\n};\n\nTabMorph.prototype.drawEdges = function (\n    context,\n    color,\n    topColor,\n    bottomColor\n) {\n    if (MorphicPreferences.isFlat && !this.is3D) {return; }\n\n    var w = this.width(),\n        h = this.height(),\n        c = this.corner,\n        e = this.edge,\n        eh = e / 2,\n        gradient;\n\n    nop(color); // argument not needed here\n\n    gradient = context.createLinearGradient(0, 0, w, 0);\n    gradient.addColorStop(0, topColor.toString());\n    gradient.addColorStop(1, bottomColor.toString());\n\n    context.strokeStyle = gradient;\n    context.lineCap = 'round';\n    context.lineWidth = e;\n\n    context.beginPath();\n    context.moveTo(0, h + eh);\n    context.bezierCurveTo(c, h, c, 0, c * 2, eh);\n    context.lineTo(w - c * 2, eh);\n    context.bezierCurveTo(w - c, 0, w - c, h, w, h + eh);\n    context.stroke();\n};\n\n// ToggleMorph ///////////////////////////////////////////////////////\n\n/*\n    I am a PushButton which toggles a check mark (becoming check box)\n    or a bullet (becoming a radio button). I can have both or either an\n    additional label and an additional pictogram, whereas the pictogram\n    can be either an instance of (any) Morph, in which case the pictogram\n    will be an interactive toggle itself or a Canvas, in which case it\n    is just going to be a picture.\n*/\n\n// ToggleMorph inherits from PushButtonMorph:\n\nToggleMorph.prototype = new PushButtonMorph();\nToggleMorph.prototype.constructor = ToggleMorph;\nToggleMorph.uber = PushButtonMorph.prototype;\n\n// ToggleMorph instance creation:\n\nexport function ToggleMorph(\n    style, // 'checkbox' or 'radiobutton'\n    target,\n    action, // a toggle function\n    labelString,\n    query, // predicate/selector\n    environment,\n    hint,\n    element, // optional Morph or Canvas to display\n    builder // method which constructs the element (only for Morphs)\n) {\n    this.init(\n        style,\n        target,\n        action,\n        labelString,\n        query,\n        environment,\n        hint,\n        element,\n        builder\n    );\n}\n\nToggleMorph.prototype.init = function (\n    style,\n    target,\n    action,\n    labelString,\n    query,\n    environment,\n    hint,\n    element,\n    builder\n) {\n    // additional properties:\n    this.padding = 1;\n    style = style || 'checkbox';\n    this.corner = (style === 'checkbox' ?\n            0 : fontHeight(this.fontSize) / 2 + this.outline + this.padding);\n    this.state = false;\n    this.query = query || (() => true);\n    this.tick = null;\n    this.captionString = labelString || null;\n    this.labelAlignment = 'right';\n    this.element = element || null;\n    this.builder = builder || null;\n    this.toggleElement = null;\n\n    // initialize inherited properties:\n    ToggleMorph.uber.init.call(\n        this,\n        target,\n        action,\n        (style === 'checkbox' ? '\\u2713' : '\\u25CF'),\n        environment,\n        hint\n    );\n    this.fixLayout();\n    this.refresh();\n};\n\n// ToggleMorph layout:\n\nToggleMorph.prototype.fixLayout = function () {\n    var padding = this.padding * 2 + this.outline * 2,\n        y;\n    if (this.tick !== null) {\n        this.bounds.setHeight(this.tick.rawHeight() + padding);\n        this.bounds.setWidth(this.tick.width() + padding);\n        this.bounds.setWidth(Math.max(this.width(), this.height()));\n        this.bounds.setHeight(Math.max(this.width(), this.height()));\n        this.tick.setCenter(this.center());\n    }\n    if (this.state) {\n        this.tick.show();\n    } else {\n        this.tick.hide();\n    }\n    if (this.toggleElement && (this.labelAlignment === 'right')) {\n        y = this.top() + (this.height() - this.toggleElement.height()) / 2;\n        this.toggleElement.setPosition(new Point(\n            this.right() + padding,\n            y\n        ));\n    }\n    if (this.label !== null) {\n        y = this.top() + (this.height() - this.label.height()) / 2;\n        if (this.labelAlignment === 'right') {\n            this.label.setPosition(new Point(\n                this.toggleElement ?\n                        this.toggleElement instanceof ToggleElementMorph ?\n                                this.toggleElement.right()\n                                : this.toggleElement.right() + padding\n                        : this.right() + padding,\n                y\n            ));\n        } else {\n            this.label.setPosition(new Point(\n                this.left() - this.label.width() - padding,\n                y\n            ));\n        }\n    }\n};\n\nToggleMorph.prototype.createLabel = function () {\n    var shading = !MorphicPreferences.isFlat || this.is3D;\n\n    if (this.label === null) {\n        if (this.captionString) {\n            this.label = new TextMorph(\n                localize(this.captionString),\n                this.fontSize,\n                this.fontStyle,\n                true\n            );\n            this.add(this.label);\n        }\n    }\n    if (this.tick === null) {\n        this.tick = new StringMorph(\n            localize(this.labelString),\n            this.fontSize,\n            this.fontStyle,\n            true,\n            false,\n            false,\n            shading ? new Point(1, 1) : null,\n            new Color(240, 240, 240)\n        );\n        this.add(this.tick);\n    }\n    if (this.toggleElement === null) {\n        if (this.element) {\n            if (this.element instanceof Morph) {\n                this.toggleElement = new ToggleElementMorph(\n                    this.target,\n                    this.action,\n                    this.element,\n                    this.query,\n                    this.environment,\n                    this.hint,\n                    this.builder\n                );\n            } else if (this.element instanceof HTMLCanvasElement) {\n                this.toggleElement = new Morph();\n                this.toggleElement.isCachingImage = true;\n                this.toggleElement.bounds.setExtent(new Point(\n                    this.element.width,\n                    this.element.height\n                ));\n                this.toggleElement.cachedImage = this.element;\n            }\n            this.add(this.toggleElement);\n        }\n    }\n};\n\n// ToggleMorph action:\n\nToggleMorph.prototype.trigger = function () {\n    ToggleMorph.uber.trigger.call(this);\n    this.refresh();\n};\n\nToggleMorph.prototype.refresh = function () {\n    /*\n    if query is a function:\n    execute the query with target as environment (can be null)\n    for lambdafied (inline) actions\n\n    else if query is a String:\n    treat it as function property of target and execute it\n    for selector-like queries\n    */\n    if (typeof this.query === 'function') {\n        this.state = this.query.call(this.target);\n    } else { // assume it's a String\n        this.state = this.target[this.query]();\n    }\n    if (this.state) {\n        this.tick.show();\n    } else {\n        this.tick.hide();\n    }\n    if (this.toggleElement && this.toggleElement.refresh) {\n        this.toggleElement.refresh();\n    }\n};\n\n// ToggleMorph events\n\nToggleMorph.prototype.mouseDownLeft = function () {\n    PushButtonMorph.uber.mouseDownLeft.call(this);\n    if (this.tick) {\n        this.tick.setCenter(this.center().add(1));\n    }\n};\n\nToggleMorph.prototype.mouseClickLeft = function () {\n    PushButtonMorph.uber.mouseClickLeft.call(this);\n    if (this.tick) {\n        this.tick.setCenter(this.center());\n    }\n};\n\nToggleMorph.prototype.mouseLeave = function () {\n    PushButtonMorph.uber.mouseLeave.call(this);\n    if (this.tick) {\n        this.tick.setCenter(this.center());\n    }\n};\n\n// ToggleElementMorph /////////////////////////////////////////////////////\n/*\n    I am a picture of a Morph (\"element\") which acts as a toggle button.\n    I am different from ToggleButton in that I neither create a label nor\n    draw button outlines. Instead I display my element morph in specified\n    contrasts of a given color, symbolizing whether it is selected or not\n*/\n\n// ToggleElementMorph inherits from TriggerMorph:\n\nToggleElementMorph.prototype = new TriggerMorph();\nToggleElementMorph.prototype.constructor = ToggleElementMorph;\nToggleElementMorph.uber = TriggerMorph.prototype;\n\n// ToggleElementMorph preferences settings\n\nToggleElementMorph.prototype.contrast = 50;\nToggleElementMorph.prototype.shadowOffset = new Point(2, 2);\nToggleElementMorph.prototype.shadowAlpha = 0.6;\nToggleElementMorph.prototype.fontSize = 10; // only for (optional) labels\nToggleElementMorph.prototype.inactiveColor = new Color(180, 180, 180);\n\n// ToggleElementMorph instance creation:\n\nexport function ToggleElementMorph(\n    target,\n    action,\n    element,\n    query,\n    environment,\n    hint,\n    builder,\n    labelString\n) {\n    this.init(\n        target,\n        action,\n        element,\n        query,\n        environment,\n        hint,\n        builder,\n        labelString\n    );\n}\n\nToggleElementMorph.prototype.init = function (\n    target,\n    action,\n    element, // mandatory\n    query,\n    environment,\n    hint,\n    builder, // optional function name that rebuilds the element\n    labelString\n) {\n    // additional properties:\n    this.target = target || null;\n    this.action = action || null;\n    this.element = element;\n    this.query = query || (() => true);\n    this.environment = environment || null;\n    this.hint = hint || null;\n    this.builder = builder || 'nop';\n    this.captionString = labelString || null;\n    this.labelAlignment = 'right';\n    this.state = false;\n\n    // initialize inherited properties:\n    TriggerMorph.uber.init.call(this);\n\n    // override inherited properties:\n    this.color = element.color;\n    this.createLabel();\n};\n\n// ToggleElementMorph drawing:\n\nToggleElementMorph.prototype.render = function (ctx) {\n    var shading = !MorphicPreferences.isFlat || this.is3D,\n        shadow = () => {\n            if (shading) {\n                this.element.addShadow(\n                    this.shadowOffset,\n                    this.userState === 'normal' ? 0 : this.shadowAlpha\n                );\n            }\n        };\n\n    this.color = this.element.color;\n    this.element.removeShadow();\n    this.element[this.builder]();\n    if (this.userState !== 'pressed') {\n        this.element.removeShadow();\n        this.element.setColor(this.inactiveColor);\n        this.element[this.builder](this.contrast);\n        if (this.userState === 'highlight') {\n            this.element.removeShadow();\n            this.element.setColor(this.color.lighter(this.contrast));\n            this.element[this.builder](this.contrast);\n        }\n    }\n    if (this.element.doWithAlpha) {\n        ctx.drawImage(\n            this.element.doWithAlpha(\n                1,\n                () => {\n                    shadow();\n                    return this.element.fullImage();\n                }\n            ),\n            0,\n            0\n        );\n    } else {\n        shadow();\n        ctx.drawImage(this.element.fullImage(), 0, 0);\n    }\n\n    // reset element\n    this.element.removeShadow();\n    this.element.setColor(this.color);\n    this.element[this.builder]();\n};\n\nToggleElementMorph.prototype.setColor = function (aColor) {\n    this.element.setColor(aColor);\n    this.fixLayout();\n    this.refresh();\n};\n\n// ToggleElementMorph layout:\n\nToggleElementMorph.prototype.fixLayout = function () {\n    this.element.fixLayout();\n    this.bounds.setExtent(\n        this.element.fullBounds().extent().add(\n            this.shadowBlur * 2\n        )\n    );\n};\n\nToggleElementMorph.prototype.createLabel = function () {\n    var y;\n    if (this.captionString) {\n        this.label = new StringMorph(\n            this.captionString,\n            this.fontSize,\n            this.fontStyle,\n            true\n        );\n        this.add(this.label);\n        y = this.top() + (this.height() - this.label.height()) / 2;\n        if (this.labelAlignment === 'right') {\n            this.label.setPosition(new Point(\n                this.right(),\n                y\n            ));\n        } else {\n            this.label.setPosition(new Point(\n                this.left() - this.label.width(),\n                y\n            ));\n        }\n    }\n};\n\n// ToggleElementMorph action\n\nToggleElementMorph.prototype.trigger\n    = ToggleButtonMorph.prototype.trigger;\n\nToggleElementMorph.prototype.refresh\n    = ToggleButtonMorph.prototype.refresh;\n\n// ToggleElementMorph events\n\nToggleElementMorph.prototype.mouseEnter\n    = ToggleButtonMorph.prototype.mouseEnter;\n\nToggleElementMorph.prototype.mouseLeave\n    = ToggleButtonMorph.prototype.mouseLeave;\n\nToggleElementMorph.prototype.mouseDownLeft\n    = ToggleButtonMorph.prototype.mouseDownLeft;\n\nToggleElementMorph.prototype.mouseClickLeft\n    = ToggleButtonMorph.prototype.mouseClickLeft;\n\n// DialogBoxMorph /////////////////////////////////////////////////////\n\n/*\n    I am a DialogBox frame.\n\n    Note:\n    -----\n    my key property keeps track of my purpose to prevent multiple instances\n    on the same or similar objects\n*/\n\n// DialogBoxMorph inherits from Morph:\n\nDialogBoxMorph.prototype = new Morph();\nDialogBoxMorph.prototype.constructor = DialogBoxMorph;\nDialogBoxMorph.uber = Morph.prototype;\n\n// DialogBoxMorph preferences settings:\n\nDialogBoxMorph.prototype.fontSize = 12;\nDialogBoxMorph.prototype.titleFontSize = 14;\nDialogBoxMorph.prototype.fontStyle = 'sans-serif';\n\nDialogBoxMorph.prototype.color = PushButtonMorph.prototype.color;\nDialogBoxMorph.prototype.titleTextColor = WHITE;\nDialogBoxMorph.prototype.titleBarColor\n    = PushButtonMorph.prototype.pressColor;\n\nDialogBoxMorph.prototype.contrast = 40;\n\nDialogBoxMorph.prototype.corner = 12;\nDialogBoxMorph.prototype.padding = 14;\nDialogBoxMorph.prototype.titlePadding = 6;\n\nDialogBoxMorph.prototype.buttonContrast = 50;\nDialogBoxMorph.prototype.buttonFontSize = 12;\nDialogBoxMorph.prototype.buttonCorner = 12;\nDialogBoxMorph.prototype.buttonEdge = 6;\nDialogBoxMorph.prototype.buttonPadding = 0;\nDialogBoxMorph.prototype.buttonOutline = 3;\nDialogBoxMorph.prototype.buttonOutlineColor\n    = PushButtonMorph.prototype.color;\nDialogBoxMorph.prototype.buttonOutlineGradient = true;\n\nDialogBoxMorph.prototype.instances = {}; // prevent multiple instances\n\n// DialogBoxMorph instance creation:\n\nexport function DialogBoxMorph(target, action, environment) {\n    this.init(target, action, environment);\n}\n\nDialogBoxMorph.prototype.init = function (target, action, environment) {\n    // additional properties:\n    this.is3D = false; // for \"flat\" design exceptions\n    this.target = target || null;\n    this.action = action || null;\n    this.environment = environment || null;\n    this.key = null; // keep track of my purpose to prevent mulitple instances\n\n    this.labelString = null;\n    this.label = null;\n    this.head = null;\n    this.body = null;\n    this.buttons = null;\n\n    // initialize inherited properties:\n    DialogBoxMorph.uber.init.call(this);\n\n    // override inherited properites:\n    this.isDraggable = true;\n    this.noDropShadow = true;\n    this.fullShadowSource = false;\n    this.color = PushButtonMorph.prototype.color;\n    this.createLabel();\n    this.createButtons();\n    this.setExtent(new Point(300, 150));\n};\n\n// DialogBoxMorph ops\nDialogBoxMorph.prototype.inform = function (\n    title,\n    textString,\n    world,\n    pic\n) {\n    var txt = new TextMorph(\n        textString,\n        this.fontSize,\n        this.fontStyle,\n        true,\n        false,\n        'center',\n        null,\n        null,\n        MorphicPreferences.isFlat ? null : new Point(1, 1),\n        WHITE\n    );\n\n    if (!this.key) {\n        this.key = 'inform' + title + textString;\n    }\n\n    txt.enableLinks = true; // let the user click on URLs to open in new tab\n    this.labelString = title;\n    this.createLabel();\n    if (pic) {this.setPicture(pic); }\n    if (textString) {\n        this.addBody(txt);\n    }\n    this.addButton('ok', 'OK');\n    this.fixLayout();\n    this.popUp(world);\n};\n\nDialogBoxMorph.prototype.askYesNo = function (\n    title,\n    textString,\n    world,\n    pic\n) {\n    var txt = new TextMorph(\n        textString,\n        this.fontSize,\n        this.fontStyle,\n        true,\n        false,\n        'center',\n        null,\n        null,\n        MorphicPreferences.isFlat ? null : new Point(1, 1),\n        WHITE\n    );\n\n    if (!this.key) {\n        this.key = 'decide' + title + textString;\n    }\n\n    this.labelString = title;\n    this.createLabel();\n    if (pic) {this.setPicture(pic); }\n    this.addBody(txt);\n    this.addButton('ok', 'Yes');\n    this.addButton('cancel', 'No');\n    this.fixLayout();\n    this.popUp(world);\n};\n\nDialogBoxMorph.prototype.prompt = function (\n    title,\n    defaultString,\n    world,\n    pic,\n    choices, // optional dictionary for drop-down of choices\n    isReadOnly, // optional when using choices\n    isNumeric, // optional\n    sliderMin, // optional for numeric sliders\n    sliderMax, // optional for numeric sliders\n    sliderAction, // optional single-arg function for numeric slider\n    decimals = 2 // optional number of decimal digits\n) {\n    var sld,\n        head,\n        precision = Math.pow(10, decimals),\n        txt = new InputFieldMorph(\n            defaultString,\n            isNumeric || false, // numeric?\n            choices || null, // drop-down dict, optional\n            choices ? isReadOnly || false : false\n        );\n    txt.setWidth(250);\n    if (isNumeric) {\n        if (pic) {\n            head = new AlignmentMorph('column', this.padding);\n            pic.setPosition(head.position());\n            head.add(pic);\n        }\n        if (!isNil(sliderMin) && !isNil(sliderMax)) {\n            sld = new SliderMorph(\n                sliderMin * precision,\n                sliderMax * precision,\n                parseFloat(defaultString) * precision,\n                (sliderMax - sliderMin) / 10 * precision, // knob size\n                'horizontal'\n            );\n            sld.alpha = 1;\n            sld.color = this.color.lighter(50);\n            sld.setHeight(txt.height() * 0.7);\n            sld.setWidth(txt.width());\n            sld.action = num => {\n                if (sliderAction) {\n                    sliderAction(num / precision);\n                }\n                txt.setContents(num / precision);\n                txt.edit();\n            };\n            if (!head) {\n                head = new AlignmentMorph('column', this.padding);\n            }\n            head.add(sld);\n        }\n        if (head) {\n            head.fixLayout();\n            this.setPicture(head);\n            head.fixLayout();\n        }\n    } else {\n        if (pic) {this.setPicture(pic); }\n    }\n\n    this.reactToChoice = function (inp) {\n        if (sld) {\n            sld.value = inp * precision;\n            sld.fixLayout();\n            sld.rerender();\n        }\n        if (sliderAction) {\n            sliderAction(inp);\n        }\n    };\n\n    txt.reactToInput = function () {\n        var inp = txt.getValue();\n        if (sld) {\n            inp = Math.max(inp, sliderMin);\n            sld.value = inp * precision;\n            sld.fixLayout();\n            sld.rerender();\n        }\n        if (sliderAction) {\n            sliderAction(inp);\n        }\n    };\n\n    this.labelString = title;\n    this.createLabel();\n\n    if (!this.key) {\n        this.key = 'prompt' + title + defaultString;\n    }\n\n    this.addBody(txt);\n    txt.fixLayout();\n    this.addButton('ok', 'OK');\n    this.addButton('cancel', 'Cancel');\n    this.fixLayout();\n    this.popUp(world);\n};\n\nDialogBoxMorph.prototype.promptCode = function (\n    title,\n    defaultString,\n    world,\n    pic,\n    instructions\n) {\n    var frame = new ScrollFrameMorph(),\n        text = new TextMorph(defaultString || ''),\n        bdy = new AlignmentMorph('column', this.padding),\n        size = pic ? Math.max(pic.width, 400) : 400;\n\n    this.getInput = function () {\n        return text.text;\n    };\n\n    function remarkText(string) {\n        return new TextMorph(\n            localize(string),\n            10,\n            null, // style\n            false, // bold\n            null, // italic\n            null, // alignment\n            null, // width\n            null, // font name\n            MorphicPreferences.isFlat ? null : new Point(1, 1),\n            WHITE // shadowColor\n        );\n    }\n\n    frame.padding = 6;\n    frame.setWidth(size);\n    frame.acceptsDrops = false;\n    frame.contents.acceptsDrops = false;\n\n    text.fontName = 'monospace';\n    text.fontStyle = 'monospace';\n    text.fontSize = 11;\n    text.setPosition(frame.topLeft().add(frame.padding));\n    text.enableSelecting();\n    text.isEditable = true;\n\n    frame.setHeight(size / 4);\n    frame.fixLayout = nop;\n    frame.edge = InputFieldMorph.prototype.edge;\n    frame.fontSize = InputFieldMorph.prototype.fontSize;\n    frame.typeInPadding = InputFieldMorph.prototype.typeInPadding;\n    frame.contrast = InputFieldMorph.prototype.contrast;\n    frame.render = InputFieldMorph.prototype.render;\n    frame.drawRectBorder = InputFieldMorph.prototype.drawRectBorder;\n\n    frame.addContents(text);\n    text.fixLayout();\n\n    if (pic) {this.setPicture(pic); }\n\n    this.labelString = title;\n    this.createLabel();\n\n    if (!this.key) {\n        this.key = 'promptCode' + title + defaultString;\n    }\n\n    bdy.setColor(this.color);\n    bdy.add(frame);\n    if (instructions) {\n        bdy.add(remarkText(instructions));\n    }\n    bdy.fixLayout();\n    this.addBody(bdy);\n\n    this.addButton('ok', 'OK');\n    this.addButton('cancel', 'Cancel');\n    this.fixLayout();\n    this.popUp(world);\n    text.edit();\n};\n\nDialogBoxMorph.prototype.promptVector = function (\n    title,\n    point,\n    deflt,\n    xLabel,\n    yLabel,\n    world,\n    pic,\n    msg\n) {\n    var vec = new AlignmentMorph('row', 4),\n        xInp = new InputFieldMorph(point.x.toString(), true),\n        yInp = new InputFieldMorph(point.y.toString(), true),\n        xCol = new AlignmentMorph('column', 2),\n        yCol = new AlignmentMorph('column', 2),\n        inp = new AlignmentMorph('column', 2),\n        bdy = new AlignmentMorph('column', this.padding);\n\n    function labelText(string) {\n        return new TextMorph(\n            localize(string),\n            10,\n            null, // style\n            false, // bold\n            null, // italic\n            null, // alignment\n            null, // width\n            null, // font name\n            MorphicPreferences.isFlat ? null : new Point(1, 1),\n            WHITE // shadowColor\n        );\n    }\n\n    inp.alignment = 'left';\n    inp.setColor(this.color);\n    bdy.setColor(this.color);\n    xCol.alignment = 'left';\n    xCol.setColor(this.color);\n    yCol.alignment = 'left';\n    yCol.setColor(this.color);\n\n    xCol.add(labelText(xLabel));\n    xCol.add(xInp);\n    yCol.add(labelText(yLabel));\n    yCol.add(yInp);\n    vec.add(xCol);\n    vec.add(yCol);\n    inp.add(vec);\n\n    if (msg) {\n        bdy.add(labelText(msg));\n    }\n\n    bdy.add(inp);\n\n    vec.fixLayout();\n    xCol.fixLayout();\n    yCol.fixLayout();\n    inp.fixLayout();\n    bdy.fixLayout();\n\n    this.labelString = title;\n    this.createLabel();\n    if (pic) {this.setPicture(pic); }\n\n    this.addBody(bdy);\n\n    this.addButton('ok', 'OK');\n\n    if (deflt instanceof Point) {\n        this.addButton(\n            () => {\n                xInp.setContents(deflt.x.toString());\n                yInp.setContents(deflt.y.toString());\n            },\n            'Default'\n\n        );\n    }\n\n    this.addButton('cancel', 'Cancel');\n    this.fixLayout();\n\n    this.edit = function () {\n        xInp.edit();\n    };\n\n    this.getInput = function () {\n        return new Point(xInp.getValue(), yInp.getValue());\n    };\n\n    if (!this.key) {\n        this.key = 'vector' + title;\n    }\n\n    this.popUp(world);\n};\n\nDialogBoxMorph.prototype.promptCredentials = function (\n    title,\n    purpose,\n    tosURL,\n    tosLabel,\n    prvURL,\n    prvLabel,\n    checkBoxLabel,\n    world,\n    pic,\n    msg\n) {\n    var usr = new InputFieldMorph(),\n        bmn,\n        byr,\n        emlLabel,\n        eml = new InputFieldMorph(),\n        pw1 = new InputFieldMorph(),\n        pw2 = new InputFieldMorph(),\n        opw = new InputFieldMorph(),\n        agree = false,\n        chk,\n        dof = new AlignmentMorph('row', 4),\n        mCol = new AlignmentMorph('column', 2),\n        yCol = new AlignmentMorph('column', 2),\n        inp = new AlignmentMorph('column', 2),\n        lnk = new AlignmentMorph('row', 4),\n        bdy = new AlignmentMorph('column', this.padding),\n        years = {},\n        currentYear = new Date().getFullYear(),\n        firstYear = currentYear - 20,\n        myself = this;\n\n    function labelText(string) {\n        return new TextMorph(\n            localize(string),\n            10,\n            null, // style\n            false, // bold\n            null, // italic\n            null, // alignment\n            null, // width\n            null, // font name\n            MorphicPreferences.isFlat ? null : new Point(1, 1),\n            WHITE // shadowColor\n        );\n    }\n\n    function linkButton(label, url) {\n        var btn = new PushButtonMorph(\n            myself,\n            () => window.open(url),\n            '  ' + localize(label) + '  '\n        );\n        btn.fontSize = 10;\n        btn.corner = myself.buttonCorner;\n        btn.edge = myself.buttonEdge;\n        btn.outline = myself.buttonOutline;\n        btn.outlineColor = myself.buttonOutlineColor;\n        btn.outlineGradient = myself.buttonOutlineGradient;\n        btn.padding = myself.buttonPadding;\n        btn.contrast = myself.buttonContrast;\n        btn.fixLayout();\n        return btn;\n    }\n\n    function age() {\n        var today = new Date().getFullYear() + new Date().getMonth() / 12,\n            year = +byr.getValue() || 0,\n            monthName = bmn.getValue(),\n            month,\n            birthday;\n        if (monthName instanceof Array) { // translatable\n            monthName = monthName[0];\n        }\n        if (isNaN(year)) {\n            year = 0;\n        }\n        month = [\n            'January',\n            'February',\n            'March',\n            'April',\n            'May',\n            'June',\n            'July',\n            'August',\n            'September',\n            'October',\n            'November',\n            'December'\n        ].indexOf(monthName);\n        if (isNaN(month)) {\n            month = 0;\n        }\n        birthday = year + month / 12;\n        return today - birthday;\n    }\n\n    bmn = new InputFieldMorph(\n        null, // text\n        false, // numeric?\n        {\n            'January' : ['January'],\n            'February' : ['February'],\n            'March' : ['March'],\n            'April' : ['April'],\n            'May' : ['May'],\n            'June' : ['June'],\n            'July' : ['July'],\n            'August' : ['August'],\n            'September' : ['September'],\n            'October' : ['October'],\n            'November' : ['November'],\n            'December' : ['December']\n        },\n        true // read-only\n    );\n    for (currentYear; currentYear > firstYear; currentYear -= 1) {\n        years[currentYear.toString() + ' '] = currentYear;\n    }\n    years[firstYear + ' ' + localize('or before')] = '< ' + currentYear;\n    byr = new InputFieldMorph(\n        null, // text\n        false, // numeric?\n        years,\n        true // read-only\n    );\n\n    inp.alignment = 'left';\n    inp.setColor(this.color);\n    bdy.setColor(this.color);\n\n    mCol.alignment = 'left';\n    mCol.setColor(this.color);\n    yCol.alignment = 'left';\n    yCol.setColor(this.color);\n\n    usr.setWidth(200);\n    bmn.setWidth(100);\n    byr.contents().minWidth = 80;\n    byr.setWidth(80);\n    eml.setWidth(200);\n    pw1.setWidth(200);\n    pw2.setWidth(200);\n    opw.setWidth(200);\n    pw1.contents().text.toggleIsPassword();\n    pw2.contents().text.toggleIsPassword();\n    opw.contents().text.toggleIsPassword();\n\n    if (purpose === 'login') {\n        inp.add(labelText('User name:'));\n        inp.add(usr);\n    }\n\n    if (purpose === 'signup') {\n        inp.add(labelText('User name:'));\n        inp.add(usr);\n        mCol.add(labelText('Birth date:'));\n        mCol.add(bmn);\n        yCol.add(labelText('year:'));\n        yCol.add(byr);\n        dof.add(mCol);\n        dof.add(yCol);\n        inp.add(dof);\n        emlLabel = labelText('foo');\n        inp.add(emlLabel);\n        inp.add(eml);\n        inp.add(labelText('Password:'));\n        inp.add(pw1);\n        inp.add(labelText('Repeat Password:'));\n        inp.add(pw2);\n    }\n\n    if (purpose === 'login') {\n        inp.add(labelText('Password:'));\n        inp.add(pw1);\n    }\n\n    if (purpose === 'changePassword') {\n        inp.add(labelText('Old password:'));\n        inp.add(opw);\n        inp.add(labelText('New password:'));\n        inp.add(pw1);\n        inp.add(labelText('Repeat new password:'));\n        inp.add(pw2);\n    }\n\n    if (purpose === 'resetPassword' || purpose === 'resendVerification') {\n        inp.add(labelText('User name:'));\n        inp.add(usr);\n    }\n\n    if (msg) {\n        bdy.add(labelText(msg));\n    }\n\n    bdy.add(inp);\n\n    if (tosURL || prvURL) {\n        bdy.add(lnk);\n    }\n    if (tosURL) {\n        lnk.add(linkButton(tosLabel, tosURL));\n    }\n    if (prvURL) {\n        lnk.add(linkButton(prvLabel, prvURL));\n    }\n\n    if (checkBoxLabel) {\n        chk = new ToggleMorph(\n            'checkbox',\n            this,\n            () => agree = !agree, // action,\n            checkBoxLabel,\n            () => agree //query\n        );\n        chk.edge = this.buttonEdge / 2;\n        chk.outline = this.buttonOutline / 2;\n        chk.outlineColor = this.buttonOutlineColor;\n        chk.outlineGradient = this.buttonOutlineGradient;\n        chk.contrast = this.buttonContrast;\n        chk.fixLayout();\n        bdy.add(chk);\n    }\n\n    dof.fixLayout();\n    mCol.fixLayout();\n    yCol.fixLayout();\n    inp.fixLayout();\n    lnk.fixLayout();\n    bdy.fixLayout();\n\n    this.labelString = title;\n    this.createLabel();\n    if (pic) {this.setPicture(pic); }\n\n    this.addBody(bdy);\n\n    this.addButton('ok', 'OK');\n    this.addButton('cancel', 'Cancel');\n    this.fixLayout();\n\n    function validInputs() {\n        var checklist,\n            empty,\n            em = eml.getValue();\n\n        function indicate(morph, string) {\n            var bubble = new SpeechBubbleMorph(localize(string));\n            bubble.isPointingRight = false;\n            bubble.fixLayout();\n            bubble.popUp(\n                world,\n                morph.leftCenter().subtract(new Point(bubble.width() + 2, 0))\n            );\n            if (morph.edit) {\n                morph.edit();\n            }\n        }\n\n        if (purpose === 'login') {\n            checklist = [usr, pw1];\n        } else if (purpose === 'signup') {\n            checklist = [usr, bmn, byr, eml, pw1, pw2];\n        } else if (purpose === 'changePassword') {\n            checklist = [opw, pw1, pw2];\n        } else if (purpose === 'resetPassword' ||\n                purpose === 'resendVerification') {\n            checklist = [usr];\n        }\n\n        empty = detect(\n            checklist,\n            inp => !inp.getValue()\n        );\n        if (empty) {\n            indicate(empty, 'please fill out\\nthis field');\n            return false;\n        }\n        if (purpose === 'signup') {\n            if (usr.getValue().length < 4) {\n                indicate(usr, 'User name must be four\\ncharacters or longer');\n                return false;\n            }\n            if (em.indexOf(' ') > -1 || em.indexOf('@') === -1\n                    || em.indexOf('.') === -1 || em.length < 5) {\n                indicate(eml, 'please provide a valid\\nemail address');\n                return false;\n            }\n        }\n        if (purpose === 'changePassword' || purpose === 'signup') {\n            if (pw1.getValue().length < 6) {\n                indicate(pw1, 'password must be six\\ncharacters or longer');\n                return false;\n            }\n            if (pw1.getValue() !== pw2.getValue()) {\n                indicate(pw2, 'passwords do\\nnot match');\n                return false;\n            }\n        }\n        if (purpose === 'signup') {\n            if (!agree) {\n                indicate(chk, 'please agree to\\nthe TOS');\n                return false;\n            }\n        }\n        return true;\n    }\n\n    this.accept = function () {\n        if (validInputs()) {\n            DialogBoxMorph.prototype.accept.call(myself);\n        }\n    };\n\n    this.edit = function () {\n        if (purpose === 'changePassword') {\n            opw.edit();\n        } else { // 'signup', 'login', 'resetPassword', 'resendVerification'\n            usr.edit();\n        }\n    };\n\n    this.getInput = function () {\n        return {\n            username: usr.getValue(),\n            email: eml.getValue(),\n            oldpassword: opw.getValue(),\n            password: pw1.getValue(),\n            passwordRepeat: pw2.getValue(),\n            choice: agree\n        };\n    };\n\n    this.reactToChoice = function () {\n        if (purpose === 'signup') {\n            emlLabel.changed();\n            emlLabel.text = age() <= 13 ?\n                    'E-mail address of parent or guardian:'\n                        : 'E-mail address:';\n            emlLabel.text = localize(emlLabel.text);\n            emlLabel.fixLayout();\n            emlLabel.rerender();\n        }\n    };\n\n    this.reactToChoice(); // initialize e-mail label\n\n    if (!this.key) {\n        this.key = 'credentials' + title + purpose;\n    }\n\n    this.popUp(world);\n};\n\nDialogBoxMorph.prototype.accept = function () {\n    /*\n    if target is a function, use it as callback:\n    execute target as callback function with action as argument\n    in the environment as optionally specified.\n    Note: if action is also a function, instead of becoming\n    the argument itself it will be called to answer the argument.\n    for selections, Yes/No Choices etc:\n\n    else (if target is not a function):\n\n        if action is a function:\n        execute the action with target as environment (can be null)\n        for lambdafied (inline) actions\n\n        else if action is a String:\n        treat it as function property of target and execute it\n        for selector-like actions\n    */\n    if (this.action) {\n        if (typeof this.target === 'function') {\n            if (typeof this.action === 'function') {\n                this.target.call(this.environment, this.action.call());\n            } else {\n                this.target.call(this.environment, this.action);\n            }\n        } else {\n            if (typeof this.action === 'function') {\n                this.action.call(this.target, this.getInput());\n            } else { // assume it's a String\n                this.target[this.action](this.getInput());\n            }\n        }\n    }\n    this.destroy();\n};\n\nDialogBoxMorph.prototype.withKey = function (key) {\n    this.key = key;\n    return this;\n};\n\nDialogBoxMorph.prototype.popUp = function (world) {\n    if (world) {\n        if (this.key) {\n            if (this.instances[world.stamp]) {\n                if (this.instances[world.stamp][this.key]) {\n                    this.instances[world.stamp][this.key].destroy();\n                }\n                this.instances[world.stamp][this.key] = this;\n            } else {\n                this.instances[world.stamp] = {};\n                this.instances[world.stamp][this.key] = this;\n            }\n        }\n        world.add(this);\n        world.keyboardFocus = this;\n        this.setCenter(world.center());\n        this.edit();\n    }\n};\n\nDialogBoxMorph.prototype.destroy = function () {\n    DialogBoxMorph.uber.destroy.call(this);\n    if (this.key) {\n        delete this.instances[this.key];\n    }\n};\n\nDialogBoxMorph.prototype.ok = function () {\n    this.accept();\n};\n\nDialogBoxMorph.prototype.cancel = function () {\n    this.destroy();\n};\n\nDialogBoxMorph.prototype.edit = function () {\n    this.children.forEach(c => {\n        if (c.edit) {\n            c.edit();\n        }\n    });\n};\n\nDialogBoxMorph.prototype.getInput = function () {\n    if (this.body instanceof InputFieldMorph) {\n        return this.body.getValue();\n    }\n    return null;\n};\n\nDialogBoxMorph.prototype.justDropped = function (hand) {\n    hand.world.keyboardFocus = this;\n    this.edit();\n};\n\nDialogBoxMorph.prototype.destroy = function () {\n    var world = this.world();\n    world.keyboardFocus = null;\n    world.hand.destroyTemporaries();\n    DialogBoxMorph.uber.destroy.call(this);\n};\n\nDialogBoxMorph.prototype.normalizeSpaces = function (string) {\n    var ans = '', i, c, flag = false;\n\n    for (i = 0; i < string.length; i += 1) {\n        c = string[i];\n        if (c === ' ') {\n            if (flag) {\n                ans += c;\n                flag = false;\n            }\n        } else {\n            ans += c;\n            flag = true;\n        }\n    }\n    return ans.trim();\n};\n\n// DialogBoxMorph submorph construction\n\nDialogBoxMorph.prototype.createLabel = function () {\n    var shading = !MorphicPreferences.isFlat || this.is3D;\n\n    if (this.label) {\n        this.label.destroy();\n    }\n    if (this.labelString) {\n        this.label = new StringMorph(\n            localize(this.labelString),\n            this.titleFontSize,\n            this.fontStyle,\n            true,\n            false,\n            false,\n            shading ? new Point(2, 1) : null,\n            this.titleBarColor.darker(this.contrast)\n        );\n        this.label.color = this.titleTextColor;\n        this.label.fixLayout();\n        this.add(this.label);\n    }\n};\n\nDialogBoxMorph.prototype.createButtons = function () {\n    if (this.buttons) {\n        this.buttons.destroy();\n    }\n    this.buttons = new AlignmentMorph('row', this.padding);\n    this.add(this.buttons);\n};\n\nDialogBoxMorph.prototype.addButton = function (action, label) {\n    var button = new PushButtonMorph(\n        this,\n        action || 'ok',\n        '  ' + localize((label || 'OK')) + '  '\n    );\n    button.fontSize = this.buttonFontSize;\n    button.corner = this.buttonCorner;\n    button.edge = this.buttonEdge;\n    button.outline = this.buttonOutline;\n    button.outlineColor = this.buttonOutlineColor;\n    button.outlineGradient = this.buttonOutlineGradient;\n    button.padding = this.buttonPadding;\n    button.contrast = this.buttonContrast;\n    button.fixLayout();\n    this.buttons.add(button);\n    return button;\n};\n\nDialogBoxMorph.prototype.setPicture = function (aMorphOrCanvas) {\n    var morph;\n    if (aMorphOrCanvas instanceof Morph) {\n        morph = aMorphOrCanvas;\n    } else {\n        morph = new Morph();\n        morph.isCachingImage = true;\n        morph.cachedImage = aMorphOrCanvas;\n        morph.bounds.setWidth(aMorphOrCanvas.width);\n        morph.bounds.setHeight(aMorphOrCanvas.height);\n    }\n    this.addHead(morph);\n};\n\nDialogBoxMorph.prototype.addHead = function (aMorph) {\n    if (this.head) {\n        this.head.destroy();\n    }\n    this.head = aMorph;\n    this.add(this.head);\n};\n\nDialogBoxMorph.prototype.addBody = function (aMorph) {\n    if (this.body) {\n        this.body.destroy();\n    }\n    this.body = aMorph;\n    this.add(this.body);\n};\n\n// DialogBoxMorph layout\n\nDialogBoxMorph.prototype.fixLayout = function () {\n    // determine by extent and arrange my components\n    var th = fontHeight(this.titleFontSize) + this.titlePadding * 2, w;\n\n    if (this.head) {\n        this.head.setPosition(this.position().add(new Point(\n            this.padding,\n            th + this.padding\n        )));\n        this.bounds.setWidth(this.head.width() + this.padding * 2);\n        this.bounds.setHeight(\n            this.head.height()\n                + this.padding * 2\n                + th\n        );\n    }\n\n    if (this.body) {\n        if (this.head) {\n            this.body.setPosition(this.head.bottomLeft().add(new Point(\n                0,\n                this.padding\n            )));\n            this.bounds.setWidth(Math.max(\n                this.width(),\n                this.body.width() + this.padding * 2\n            ));\n            this.bounds.setHeight(\n                this.height()\n                    + this.body.height()\n                    + this.padding\n            );\n            w = this.width();\n            this.head.setLeft(\n                this.left()\n                    + Math.round((w - this.head.width()) / 2)\n            );\n            this.body.setLeft(\n                this.left()\n                    + Math.round((w - this.body.width()) / 2)\n            );\n        } else {\n            this.body.setPosition(this.position().add(new Point(\n                this.padding,\n                th + this.padding\n            )));\n            this.bounds.setWidth(this.body.width() + this.padding * 2);\n            this.bounds.setHeight(\n                this.body.height()\n                    + this.padding * 2\n                    + th\n            );\n        }\n    }\n\n    if (this.label) {\n        this.label.setCenter(this.center());\n        this.label.setTop(this.top() + (th - this.label.height()) / 2);\n    }\n\n    if (this.buttons && (this.buttons.children.length > 0)) {\n        this.buttons.fixLayout();\n        this.bounds.setHeight(\n            this.height()\n                    + this.buttons.height()\n                    + this.padding\n        );\n        this.bounds.setWidth(Math.max(\n                this.width(),\n                this.buttons.width()\n                        + (2 * this.padding)\n            )\n        );\n        this.buttons.setCenter(this.center());\n        this.buttons.setBottom(this.bottom() - this.padding);\n    }\n\n    // refresh a shallow shadow\n    this.removeShadow();\n    this.addShadow();\n};\n\n// DialogBoxMorph keyboard events\n\nDialogBoxMorph.prototype.processKeyPress = nop;\n\nDialogBoxMorph.prototype.processKeyDown = function (event) {\n    // this.inspectKeyEvent(event);\n    switch (event.keyCode) {\n    case 13:\n        this.ok();\n        break;\n    case 27:\n        this.cancel();\n        break;\n    default:\n        nop();\n        // this.inspectKeyEvent(event);\n    }\n};\n\n// DialogBoxMorph drawing\n\nDialogBoxMorph.prototype.render = function (ctx) {\n    var gradient,\n        w = this.width(),\n        h = this.height(),\n        th = Math.floor(\n            fontHeight(this.titleFontSize) + this.titlePadding * 2\n        ),\n        shift = this.corner / 2,\n        x,\n        y,\n        isFlat = MorphicPreferences.isFlat && !this.is3D;\n\n    // this.alpha = isFlat ? 0.9 : 1;\n\n    // title bar\n    if (isFlat) {\n        ctx.fillStyle = this.titleBarColor.toString();\n    } else {\n        gradient = ctx.createLinearGradient(0, 0, 0, th);\n        gradient.addColorStop(\n            0,\n            this.titleBarColor.lighter(this.contrast / 2).toString()\n        );\n        gradient.addColorStop(\n            1,\n            this.titleBarColor.darker(this.contrast).toString()\n        );\n        ctx.fillStyle = gradient;\n    }\n    ctx.beginPath();\n    this.outlinePathTitle(\n        ctx,\n        isFlat ? 0 : this.corner\n    );\n    ctx.closePath();\n    ctx.fill();\n\n    // flat shape\n    // body\n    ctx.fillStyle = this.color.toString();\n    ctx.beginPath();\n    this.outlinePathBody(\n        ctx,\n        isFlat ? 0 : this.corner\n    );\n    ctx.closePath();\n    ctx.fill();\n\n    if (isFlat) {\n        return;\n    }\n\n    // 3D-effect\n    // bottom left corner\n    gradient = ctx.createLinearGradient(\n        0,\n        h - this.corner,\n        0,\n        h\n    );\n    gradient.addColorStop(0, this.color.toString());\n    gradient.addColorStop(1, this.color.darker(this.contrast.toString()));\n\n    ctx.lineWidth = this.corner;\n    ctx.lineCap = 'round';\n    ctx.strokeStyle = gradient;\n\n    ctx.beginPath();\n    ctx.moveTo(this.corner, h - shift);\n    ctx.lineTo(this.corner + 1, h - shift);\n    ctx.stroke();\n\n    // bottom edge\n    gradient = ctx.createLinearGradient(\n        0,\n        h - this.corner,\n        0,\n        h\n    );\n    gradient.addColorStop(0, this.color.toString());\n    gradient.addColorStop(1, this.color.darker(this.contrast.toString()));\n\n    ctx.lineWidth = this.corner;\n    ctx.lineCap = 'butt';\n    ctx.strokeStyle = gradient;\n\n    ctx.beginPath();\n    ctx.moveTo(this.corner, h - shift);\n    ctx.lineTo(w - this.corner, h - shift);\n    ctx.stroke();\n\n    // right body edge\n    gradient = ctx.createLinearGradient(\n        w - this.corner,\n        0,\n        w,\n        0\n    );\n    gradient.addColorStop(0, this.color.toString());\n    gradient.addColorStop(1, this.color.darker(this.contrast).toString());\n\n    ctx.lineWidth = this.corner;\n    ctx.lineCap = 'butt';\n    ctx.strokeStyle = gradient;\n\n    ctx.beginPath();\n    ctx.moveTo(w - shift, th);\n    ctx.lineTo(w - shift, h - this.corner);\n    ctx.stroke();\n\n    // bottom right corner\n    x = w - this.corner;\n    y = h - this.corner;\n\n    gradient = ctx.createRadialGradient(\n        x,\n        y,\n        0,\n        x,\n        y,\n        this.corner\n    );\n    gradient.addColorStop(0, this.color.toString());\n    gradient.addColorStop(1, this.color.darker(this.contrast.toString()));\n\n    ctx.lineCap = 'butt';\n\n    ctx.strokeStyle = gradient;\n\n    ctx.beginPath();\n    ctx.arc(\n        x,\n        y,\n        shift,\n        radians(90),\n        radians(0),\n        true\n    );\n    ctx.stroke();\n\n    // left body edge\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        this.corner,\n        0\n    );\n    gradient.addColorStop(\n        0,\n        this.color.lighter(this.contrast).toString()\n    );\n    gradient.addColorStop(1, this.color.toString());\n\n    ctx.lineCap = 'butt';\n    ctx.strokeStyle = gradient;\n\n    ctx.beginPath();\n    ctx.moveTo(shift, th);\n    ctx.lineTo(shift, h - this.corner * 2);\n    ctx.stroke();\n\n    // left vertical bottom corner\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        this.corner,\n        0\n    );\n    gradient.addColorStop(\n        0,\n        this.color.lighter(this.contrast).toString()\n    );\n    gradient.addColorStop(1, this.color.toString());\n\n    ctx.lineCap = 'round';\n    ctx.strokeStyle = gradient;\n\n    ctx.beginPath();\n    ctx.moveTo(shift, h - this.corner * 2);\n    ctx.lineTo(shift, h - this.corner - shift);\n    ctx.stroke();\n};\n\nDialogBoxMorph.prototype.outlinePathTitle = function (ctx, radius) {\n    var w = this.width(),\n        h = Math.ceil(fontHeight(this.titleFontSize)) + this.titlePadding * 2;\n\n    // top left:\n    ctx.arc(\n        radius,\n        radius,\n        radius,\n        radians(-180),\n        radians(-90),\n        false\n    );\n    // top right:\n    ctx.arc(\n        w - radius,\n        radius,\n        radius,\n        radians(-90),\n        radians(-0),\n        false\n    );\n    // bottom right:\n    ctx.lineTo(w, h);\n\n    // bottom left:\n    ctx.lineTo(0, h);\n};\n\nDialogBoxMorph.prototype.outlinePathBody = function (ctx, radius) {\n    var w = this.width(),\n        h = this.height(),\n        th = Math.floor(fontHeight(this.titleFontSize)) +\n            this.titlePadding * 2;\n\n    // top left:\n    ctx.moveTo(0, th);\n\n    // top right:\n    ctx.lineTo(w, th);\n\n    // bottom right:\n    ctx.arc(\n        w - radius,\n        h - radius,\n        radius,\n        radians(0),\n        radians(90),\n        false\n    );\n    // bottom left:\n    ctx.arc(\n        radius,\n        h - radius,\n        radius,\n        radians(90),\n        radians(180),\n        false\n    );\n};\n\n// AlignmentMorph /////////////////////////////////////////////////////\n\n// I am a reified layout, either a row or a column of submorphs\n\n// AlignmentMorph inherits from Morph:\n\nAlignmentMorph.prototype = new Morph();\nAlignmentMorph.prototype.constructor = AlignmentMorph;\nAlignmentMorph.uber = Morph.prototype;\n\n// AlignmentMorph instance creation:\n\nexport function AlignmentMorph(orientation, padding) {\n    this.init(orientation, padding);\n}\n\nAlignmentMorph.prototype.init = function (orientation, padding) {\n    // additional properties:\n    this.orientation = orientation || 'row'; // or 'column'\n    this.alignment = 'center'; // or 'left' in a column\n    this.padding = padding || 0;\n    this.respectHiddens = false;\n\n    // initialize inherited properties:\n    AlignmentMorph.uber.init.call(this);\n\n    // override inherited properites:\n};\n\n// AlignmentMorph displaying and layout\n\nAlignmentMorph.prototype.render = function (ctx) {\n    // override to not draw anything, as alignments are just containers\n    // for layout of their components\n    nop(ctx);\n};\n\nAlignmentMorph.prototype.fixLayout = function () {\n    var last = null,\n        newBounds;\n    if (this.children.length === 0) {\n        return null;\n    }\n    this.children.forEach(c => {\n        var cfb = c.fullBounds(),\n            lfb;\n        if (c.isVisible || this.respectHiddens) {\n            if (last) {\n                lfb = last.fullBounds();\n                if (this.orientation === 'row') {\n                    c.setPosition(\n                        lfb.topRight().add(new Point(\n                            this.padding,\n                            (lfb.height() - cfb.height()) / 2\n                        ))\n                    );\n                } else { // orientation === 'column'\n                    c.setPosition(\n                        lfb.bottomLeft().add(new Point(\n                            this.alignment === 'center' ?\n                                    (lfb.width() - cfb.width()) / 2\n                                            : 0,\n                            this.padding\n                        ))\n                    );\n                }\n                cfb = c.fullBounds();\n                newBounds = newBounds.merge(cfb);\n            } else {\n                newBounds = cfb;\n            }\n            last = c;\n        }\n    });\n    this.bounds = newBounds;\n};\n\n// InputFieldMorph //////////////////////////////////////////////////////\n\n// InputFieldMorph inherits from Morph:\n\nInputFieldMorph.prototype = new Morph();\nInputFieldMorph.prototype.constructor = InputFieldMorph;\nInputFieldMorph.uber = Morph.prototype;\n\n// InputFieldMorph settings\n\nInputFieldMorph.prototype.edge = 2;\nInputFieldMorph.prototype.fontSize = 12;\nInputFieldMorph.prototype.typeInPadding = 2;\nInputFieldMorph.prototype.contrast = 65;\n\n// InputFieldMorph instance creation:\n\nexport function InputFieldMorph(text, isNumeric, choiceDict, isReadOnly) {\n    this.init(text, isNumeric, choiceDict, isReadOnly);\n}\n\nInputFieldMorph.prototype.init = function (\n    text,\n    isNumeric,\n    choiceDict,\n    isReadOnly\n) {\n    var contents = new StringFieldMorph(\n            text || '',\n            null, null, null, null, null,\n            isNumeric || false\n        ),\n        arrow = new ArrowMorph(\n            'down',\n            0,\n            Math.max(Math.floor(this.fontSize / 6), 1)\n        );\n\n    this.choices = choiceDict || null; // object, function or selector\n    this.isReadOnly = isReadOnly || false;\n    this.isNumeric = isNumeric || false;\n\n    contents.alpha = 0;\n    contents.fontSize = this.fontSize;\n    contents.fixLayout();\n\n    this.oldContentsExtent = contents.extent();\n\n    InputFieldMorph.uber.init.call(this);\n    this.color = WHITE;\n    this.add(contents);\n    this.add(arrow);\n    contents.isDraggable = false;\n    this.fixLayout();\n};\n\n// InputFieldMorph accessing:\n\nInputFieldMorph.prototype.contents = function () {\n    return detect(\n        this.children,\n        child => child instanceof StringFieldMorph\n    );\n};\n\nInputFieldMorph.prototype.arrow = function () {\n    return detect(\n        this.children,\n        child => child instanceof ArrowMorph\n    );\n};\n\nInputFieldMorph.prototype.setChoice = function (aStringOrFloat) {\n    this.setContents(aStringOrFloat);\n    this.escalateEvent('reactToChoice', aStringOrFloat);\n};\n\nInputFieldMorph.prototype.setContents = function (aStringOrFloat) {\n    var cnts = this.contents();\n    cnts.text.text = aStringOrFloat;\n    if (aStringOrFloat === undefined) {\n        return null;\n    }\n    if (aStringOrFloat === null) {\n        cnts.text.text = '';\n    } else if (aStringOrFloat.toString) {\n        cnts.text.text = aStringOrFloat.toString();\n    }\n    cnts.text.fixLayout();\n    cnts.changed();\n    cnts.fixLayout();\n    cnts.rerender();\n};\n\nInputFieldMorph.prototype.edit = function () {\n    var c = this.contents();\n    c.text.edit();\n    c.text.selectAll();\n};\n\nInputFieldMorph.prototype.setIsNumeric = function (bool) {\n    var value;\n\n    this.isNumeric = bool;\n    this.contents().isNumeric = bool;\n    this.contents().text.isNumeric = bool;\n\n    // adjust my shown value to conform with the numeric flag\n    value = this.getValue();\n    if (this.isNumeric) {\n        value = parseFloat(value);\n        if (isNaN(value)) {\n            value = null;\n        }\n    }\n    this.setContents(value);\n};\n\n// InputFieldMorph drop-down menu:\n\nInputFieldMorph.prototype.dropDownMenu = function () {\n    var choices = this.choices,\n        key,\n        menu = new MenuMorph(\n            this.setChoice,\n            null,\n            this,\n            this.fontSize\n        );\n\n    if (choices instanceof Function) {\n        choices = choices.call(this);\n    } else if (isString(choices)) {\n        choices = this[choices]();\n    }\n    if (!choices) {\n        return null;\n    }\n    menu.addItem(' ', null);\n    if (choices instanceof Array) {\n        choices.forEach(choice => menu.addItem(choice[0], choice[1]));\n    } else { // assuming a dictionary\n        for (key in choices) {\n            if (Object.prototype.hasOwnProperty.call(choices, key)) {\n                if (key[0] === '~') {\n                    menu.addLine();\n                } else {\n                    menu.addItem(key, choices[key]);\n                }\n            }\n        }\n    }\n    if (menu.items.length > 0) {\n        menu.popUpAtHand(this.world());\n    } else {\n        return null;\n    }\n};\n\n// InputFieldMorph layout:\n\nInputFieldMorph.prototype.fixLayout = function () {\n    var contents = this.contents(),\n        arrow = this.arrow();\n\n    if (!contents) {return null; }\n    contents.isNumeric = this.isNumeric;\n    contents.isEditable = (!this.isReadOnly);\n    if (this.choices) {\n        arrow.setSize(this.fontSize);\n        arrow.show();\n    } else {\n        arrow.setSize(0);\n        arrow.hide();\n    }\n    this.bounds.setHeight(\n        contents.height()\n            + this.edge * 2\n            + this.typeInPadding * 2\n    );\n    this.bounds.setWidth(Math.max(\n        contents.minWidth\n            + this.edge * 2\n            + this.typeInPadding * 2,\n        this.width()\n    ));\n\n    contents.setWidth(\n        this.width() - this.edge - this.typeInPadding -\n            (this.choices ? arrow.width() + this.typeInPadding : 0)\n    );\n\n    contents.setPosition(new Point(\n        this.edge,\n        this.edge\n    ).add(this.typeInPadding).add(this.position()));\n\n    arrow.setPosition(new Point(\n        this.right() - arrow.width() - this.edge,\n        contents.top()\n    ));\n\n};\n\n// InputFieldMorph events:\n\nInputFieldMorph.prototype.mouseClickLeft = function (pos) {\n    if (this.arrow().bounds.containsPoint(pos)) {\n        this.dropDownMenu();\n    } else if (this.isReadOnly) {\n        this.dropDownMenu();\n    } else {\n        this.escalateEvent('mouseClickLeft', pos);\n    }\n};\n\n// InputFieldMorph retrieving:\n\nInputFieldMorph.prototype.getValue = function () {\n/*\n    answer my content's text string. If I am numerical convert that\n    string to a number. If the conversion fails answer the string\n    otherwise the numerical value.\n*/\n    var num,\n        contents = this.contents();\n    if (this.isNumeric) {\n        num = parseFloat(contents.text);\n        if (!isNaN(num)) {\n            return num;\n        }\n    }\n    return this.normalizeSpaces(contents.string());\n};\n\nInputFieldMorph.prototype.normalizeSpaces\n    = DialogBoxMorph.prototype.normalizeSpaces;\n\n// InputFieldMorph drawing:\n\nInputFieldMorph.prototype.render = function (ctx) {\n    var borderColor;\n\n    if (this.parent) {\n        if (this.parent.color.eq(WHITE)) {\n            this.color = this.parent.color.darker(this.contrast * 0.1);\n        } else {\n            this.color = this.parent.color.lighter(this.contrast * 0.75);\n        }\n        borderColor = this.parent.color;\n    } else {\n        borderColor = new Color(120, 120, 120);\n    }\n    ctx.fillStyle = this.color.toString();\n\n    // cache my border colors\n    this.cachedClr = borderColor.toString();\n    this.cachedClrBright = borderColor.lighter(this.contrast)\n        .toString();\n    this.cachedClrDark = borderColor.darker(this.contrast).toString();\n\n    ctx.fillRect(\n        this.edge,\n        this.edge,\n        this.width() - this.edge * 2,\n        this.height() - this.edge * 2\n    );\n\n    this.drawRectBorder(ctx);\n};\n\nInputFieldMorph.prototype.drawRectBorder = function (ctx) {\n    var shift = this.edge * 0.5,\n        gradient;\n\n    if (MorphicPreferences.isFlat && !this.is3D) {return; }\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    if (useBlurredShadows) {\n        ctx.shadowOffsetY = shift;\n        ctx.shadowBlur = this.edge * 4;\n        ctx.shadowColor = this.cachedClrDark;\n    }\n\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        0,\n        this.edge\n    );\n\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrDark);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(this.edge, shift);\n    ctx.lineTo(this.width() - this.edge - shift, shift);\n    ctx.stroke();\n\n    ctx.shadowOffsetY = 0;\n\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        this.edge,\n        0\n    );\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrDark);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(shift, this.edge);\n    ctx.lineTo(shift, this.height() - this.edge - shift);\n    ctx.stroke();\n\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 0;\n    ctx.shadowBlur = 0;\n\n    gradient = ctx.createLinearGradient(\n        0,\n        this.height() - this.edge,\n        0,\n        this.height()\n    );\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(this.edge, this.height() - shift);\n    ctx.lineTo(this.width() - this.edge, this.height() - shift);\n    ctx.stroke();\n\n    gradient = ctx.createLinearGradient(\n        this.width() - this.edge,\n        0,\n        this.width(),\n        0\n    );\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(this.width() - shift, this.edge);\n    ctx.lineTo(this.width() - shift, this.height() - this.edge);\n    ctx.stroke();\n};\n\n// PianoMenuMorph //////////////////////////////////////////////////////\n/*\n    I am a menu that looks like a piano keyboard.\n*/\n\n// PianoMenuMorph inherits from MenuMorph\n\nPianoMenuMorph.prototype = new MenuMorph();\nPianoMenuMorph.prototype.constructor = PianoMenuMorph;\nPianoMenuMorph.uber = MenuMorph.prototype;\n\n// PianoMenuMorph instance creation:\n\nexport function PianoMenuMorph(target, environment, fontSize, soundType) {\n    this.init(target, environment, fontSize, soundType);\n}\n\nPianoMenuMorph.prototype.init = function (\n    target,\n    environment,\n    fontSize,\n    soundType // number 1 - 4: 'sine', 'square', 'sawtooth' or 'triangle'\n) {\n    var choices, key;\n    this.soundType = soundType;\n    PianoMenuMorph.uber.init.call(this, target, null, environment, fontSize);\n    choices = {\n        'C (48)' : 48,\n        'D (50)' : 50,\n        'C# (49)' : 49,\n        'E (52)' : 52,\n        'Eb (51)' : 51,\n        'F (53)' : 53,\n        'G (55)' : 55,\n        'F# (54)' : 54,\n        'A (57)' : 57,\n        'G# (56)' : 56,\n        'B (59)' : 59,\n        'Bb (58)' : 58,\n        'C (60)' : 60,\n        'D (62)' : 62,\n        'C# (61)' : 61,\n        'E (64)' : 64,\n        'Eb (63)' : 63,\n        'F (65)' : 65,\n        'G (67)' : 67,\n        'F# (66)' : 66,\n        'A (69)' : 69,\n        'G# (68)' : 68,\n        'B (71)' : 71,\n        'Bb (70)' : 70,\n        'C (72)' : 72\n    };\n    for (key in choices) {\n        if (Object.prototype.hasOwnProperty.call(choices, key)) {\n            this.addItem(key, choices[key]);\n        }\n    }\n};\n\nPianoMenuMorph.prototype.createItems = function () {\n    var item,\n        fb,\n        x,\n        y,\n        label,\n        blackkey,\n        key,\n        keycolor,\n        keywidth,\n        keyheight,\n        keyposition;\n\n    this.children.forEach(m => m.destroy());\n    this.children = [];\n    if (!this.isListContents) {\n        this.edge = MorphicPreferences.isFlat ? 0 : 5;\n        this.border = MorphicPreferences.isFlat ? 1 : 2;\n    }\n    this.color = WHITE;\n    this.borderColor = new Color(60, 60, 60);\n    this.bounds.setExtent(ZERO);\n\n    x = this.left() + 1;\n    y = this.top() + (this.fontSize * 1.5) + 2;\n    label = new StringMorph('', this.fontSize);\n    this.items.forEach(tuple => {\n        blackkey = tuple[0][1] !== \" \";\n        key = new BoxMorph(1, 1);\n        if (blackkey) {\n            keycolor = BLACK;\n            keywidth = this.fontSize; // 9;\n            keyheight = this.fontSize * 2.5;\n            keyposition = new Point(x + 2 - (this.fontSize * 2), y);\n        } else {\n            keycolor = WHITE;\n            keywidth = this.fontSize * 1.5;\n            keyheight = this.fontSize * 4;\n            keyposition = new Point(x + 1, y);\n            x += keywidth - 1;\n        }\n        key.setColor(keycolor);\n        key.setWidth(keywidth);\n        key.setHeight(keyheight);\n        item = new PianoKeyMorph(\n            this.target,\n            tuple[1],\n            [key, tuple[0]],\n            this.fontSize || MorphicPreferences.menuFontSize,\n            MorphicPreferences.menuFontName,\n            this.environment,\n            tuple[2], // bubble help hint\n            tuple[3], // color\n            tuple[4], // bold\n            tuple[5], // italic\n            tuple[6], // doubleclick action\n            label     // String to change\n        );\n        item.setPosition(keyposition);\n        this.add(item);\n    });\n    fb = this.fullBounds();\n    label.setPosition(new Point((fb.width() / 2) - this.fontSize, 2));\n    this.add(label);\n    fb = this.fullBounds();\n    this.bounds.setExtent(fb.extent().add(2));\n};\n\n// PianoMenuMorph keyboard selecting a key:\n\nPianoMenuMorph.prototype.select = function(aPianoKeyItem) {\n    this.unselectAllItems();\n    aPianoKeyItem.mouseEnter();\n    this.selection = aPianoKeyItem;\n    this.world.keyboardFocus = this;\n    this.hasFocus = true;\n};\n\nPianoMenuMorph.prototype.unselectAllItems = function () {\n    this.children.forEach(item => {\n        if (item instanceof MenuItemMorph) {\n            item.mouseLeave();\n        }\n    });\n    this.changed();\n};\n\nPianoMenuMorph.prototype.selectKey = function (midiNum) {\n    var key;\n    if (isNil(midiNum)) {\n        return;\n    }\n    key = detect(\n        this.children,\n        each => each.action === midiNum\n    );\n    if (key) {\n        this.select(key);\n    } else {\n        this.selectKey(48);\n    }\n};\n\n// PianoMenuMorph keyboard navigation & entry:\n\nPianoMenuMorph.prototype.processKeyDown = function (event) {\n    // console.log(event.keyCode);\n    switch (event.keyCode) {\n    case 13: // 'enter'\n    case 32: // 'space'\n        if (this.selection) {\n            this.selection.mouseClickLeft();\n        }\n        return;\n    case 27: // 'esc'\n        return this.destroy();\n    case 37: // 'left arrow'\n    case 40: // 'down arrow'\n    case 189: // -\n        return this.selectDown();\n    case 38: // 'up arrow'\n    case 39: // 'right arrow'\n    case 187: // +\n    case 220: // #\n        return this.selectUp();\n    default:\n        switch(event.key) {\n        case 'C':\n            return this.selectKey(48);\n        case 'c':\n            return this.selectKey(60);\n        case 'D':\n            return this.selectKey(50);\n        case 'd':\n            return this.selectKey(62);\n        case 'E':\n            return this.selectKey(52);\n        case 'e':\n            return this.selectKey(64);\n        case 'F':\n            return this.selectKey(53);\n        case 'f':\n            return this.selectKey(65);\n        case 'G':\n            return this.selectKey(55);\n        case 'g':\n            return this.selectKey(67);\n        case 'A':\n            return this.selectKey(57);\n        case 'a':\n            return this.selectKey(69);\n        case 'B':\n        case 'H':\n            return this.selectKey(59);\n        case 'b':\n        case 'h':\n            return this.selectKey(71);\n        default:\n            nop();\n        }\n    }\n};\n\nPianoMenuMorph.prototype.selectUp = function () {\n    var next = 48;\n    if (this.selection) {\n        next = this.selection.action + 1;\n        if (next > 72) {\n            next = 48;\n        }\n    }\n    this.selectKey(next);\n};\n\nPianoMenuMorph.prototype.selectDown = function () {\n    var next = 48;\n    if (this.selection) {\n        next = this.selection.action - 1;\n        if (next < 48) {\n            next = 72;\n        }\n    }\n    this.selectKey(next);\n};\n\nPianoMenuMorph.prototype.destroy = function () {\n    this.children.forEach(key => {\n        if (key.note) {\n            key.note.stop();\n        }\n    });\n    PianoMenuMorph.uber.destroy.call(this);\n};\n\n\n// PianoKeyMorph ///////////////////////////////////////////////////////\n\nPianoKeyMorph.prototype = new MenuItemMorph();\nPianoKeyMorph.prototype.constructor = PianoKeyMorph;\nPianoKeyMorph.uber = MenuItemMorph.prototype;\n\nexport function PianoKeyMorph(\n    target,\n    action,\n    labelString, // can also be a Morph or a Canvas or a tuple: [icon, string]\n    fontSize,\n    fontStyle,\n    environment,\n    hint,\n    color,\n    bold,\n    italic,\n    doubleClickAction, // optional when used as list morph item\n    label\n) {\n    this.init(\n        target,\n        action,\n        labelString,\n        fontSize,\n        fontStyle,\n        environment,\n        hint,\n        color,\n        bold,\n        italic,\n        doubleClickAction,\n        label\n    );\n    this.feedback = label;\n}\n\nPianoKeyMorph.prototype.init = function (\n    target,\n    action,\n    labelString,\n    fontSize,\n    fontStyle,\n    environment,\n    hint,\n    color,\n    bold,\n    italic,\n    doubleClickAction,\n    label\n) {\n    // additional \"note\" property for sound output:\n    this.note = new Note(action);\n    PianoKeyMorph.uber.init.call(\n        this,\n        target,\n        action,\n        labelString,\n        fontSize,\n        fontStyle,\n        environment,\n        hint,\n        color,\n        bold,\n        italic,\n        doubleClickAction,\n        label\n    );\n};\n\nPianoKeyMorph.prototype.createLabel = function () {\n    var icon;\n    if (this.label !== null) {\n        this.label.destroy();\n    }\n    // assume its pattern is: [icon, string]\n    this.label = new Morph();\n    icon = this.createIcon(this.labelString[0]);\n    this.label.add(icon);\n    this.bounds.setExtent(icon.extent());\n    this.label.bounds = this.position().extent(this.label.extent());\n    this.label.bounds.setExtent(ZERO);\n    this.add(this.label);\n};\n\nPianoKeyMorph.prototype.mouseEnter = function () {\n    var piano = this.parentThatIsA(PianoMenuMorph),\n        soundType = piano ? piano.soundType : 1;\n    if (piano) {\n        piano.unselectAllItems();\n        piano.selection = this;\n        piano.world.keyboardFocus = piano;\n        piano.hasFocus = true;\n    }\n    this.label.children[0].hide();\n    this.userState = 'highlight';\n    this.rerender();\n    this.feedback.text = this.labelString[1];\n    this.feedback.fixLayout();\n    this.note.play(soundType);\n    setTimeout(\n        () => this.note.stop(true),\n        400\n    );\n};\n\nPianoKeyMorph.prototype.mouseLeave = function () {\n    this.note.stop(true);\n    this.label.children[0].show();\n    this.userState = 'normal';\n    this.rerender();\n};\n","/*\n\n    byob.js\n\n    \"build your own blocks\" for Snap!\n    based on morphic.js, widgets.js blocks.js, threads.js and objects.js\n    inspired by Scratch\n\n    written by Jens Mnig\n    jens@moenig.org\n\n    Copyright (C) 2020 by Jens Mnig\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    prerequisites:\n    --------------\n    needs blocks.js, threads.js, objects.js, widgets.js and morphic.js\n\n\n    hierarchy\n    ---------\n    the following tree lists all constructors hierarchically,\n    indentation indicating inheritance. Refer to this list to get a\n    contextual overview:\n\n    BlockLabelFragment\n    CustomBlockDefinition\n\n    CommandBlockMorph***\n        CustomCommandBlockMorph\n        HatBlockMorph***\n            PrototypeHatBlockMorph\n\n    DialogBoxMorph**\n        BlockDialogMorph\n        BlockEditorMorph\n        BlockExportDialogMorph\n        BlockImportDialogMorph\n        BlockRemovalDialogMorph\n        InputSlotDialogMorph\n        VariableDialogMorph\n\n    ReporterBlockMorph***\n        CustomReporterBlockMorph\n        JaggedBlockMorph\n\n\n    StringMorph*\n        BlockLabelFragmentMorph\n        BlockLabelPlaceHolderMorph\n\n    TemplateSlotMorph***\n        BlockInputFragmentMorph\n\n    * from morphic.js\n    ** from widgets.js\n    *** from blocks.js\n\n\n    toc\n    ---\n    the following list shows the order in which all constructors are\n    defined. Use this list to locate code in this document:\n\n    CustomBlockDefinition\n    CustomCommandBlockMorph\n    CustomReporterBlockMorph\n    JaggedBlockMorph\n    BlockDialogMorph\n    BlockEditorMorph\n    PrototypeHatBlockMorph\n    BlockLabelFragmentMorph\n    BlockLabelPlaceHolderMorph\n    BlockInputFragmentMorph\n    InputSlotDialogMorph\n    VariableDialogMorph\n    BlockExportDialogMorph\n    BlockImportDialogMorph\n    BlockRemovalDialogMorph\n\n*/\n\n/*global modules, CommandBlockMorph, SpriteMorph, TemplateSlotMorph, Map,\nStringMorph, Color, DialogBoxMorph, ScriptsMorph, ScrollFrameMorph, WHITE,\nPoint, HandleMorph, HatBlockMorph, BlockMorph, detect, List, Process,\nAlignmentMorph, ToggleMorph, InputFieldMorph, ReporterBlockMorph, StringMorph,\nnop, radians, BoxMorph, ArrowMorph, PushButtonMorph, contains, InputSlotMorph,\nToggleButtonMorph, IDE_Morph, MenuMorph, copy, ToggleElementMorph, fontHeight,\nStageMorph, SyntaxElementMorph, CommentMorph, localize, CSlotMorph,\nMorphicPreferences, SymbolMorph, isNil, CursorMorph, VariableFrame,\nWatcherMorph, Variable, BooleanSlotMorph, XML_Serializer, SnapTranslator*/\n\n// Global stuff ////////////////////////////////////////////////////////\nimport {modules, Morph, Color,\n  StringMorph, Point, MenuMorph,\n  contains, ScrollFrameMorph,\n   nop, detect,\n  MorphicPreferences, isNil, fontHeight,  localize\n  , HandleMorph, WHITE,\n   BoxMorph} from './morphic'\n\nimport {SymbolMorph} from './symbols'\n\nimport {\n  DialogBoxMorph, ToggleButtonMorph, PushButtonMorph,\n  InputFieldMorph, AlignmentMorph, ToggleMorph, ToggleElementMorph\n} from './widgets'\n\nimport { SyntaxElementMorph, BlockMorph, ScriptsMorph, CommentMorph, CommandBlockMorph\n  , BooleanSlotMorph, TemplateSlotMorph,\n  HatBlockMorph,  ReporterBlockMorph, ArrowMorph,  InputSlotMorph} from './blocks'\nimport { VariableFrame, Process} from './threads'\nimport {SpriteMorph, StageMorph, WatcherMorph, isSnapObject,Note\n} from './objects'\nimport {ListWatcherMorph, List} from './lists'\nmodules.byob = '2020-October-07';\n\n// Declarations\n\n// export var CustomBlockDefinition;\n// var CustomCommandBlockMorph;\n// var CustomReporterBlockMorph;\n// var BlockDialogMorph;\n// var BlockEditorMorph;\n// var PrototypeHatBlockMorph;\n// export var BlockLabelFragment;\n// var BlockLabelFragmentMorph;\n// var BlockInputFragmentMorph;\n// var BlockLabelPlaceHolderMorph;\n// var InputSlotDialogMorph;\n// var VariableDialogMorph;\n// var JaggedBlockMorph;\n// var BlockExportDialogMorph;\n// var BlockImportDialogMorph;\n// var BlockRemovalDialogMorph;\n\n// CustomBlockDefinition ///////////////////////////////////////////////\n\n// CustomBlockDefinition instance creation:\n\nexport function CustomBlockDefinition(spec, receiver) {\n    this.body = null; // a Context (i.e. a reified top block)\n    this.scripts = [];\n    this.category = null;\n    this.isGlobal = false;\n    this.type = 'command';\n    this.spec = spec || '';\n    this.declarations = new Map();\n        // key: inputName\n        // value: [type, default, options, isReadOnly]\n    this.variableNames = [];\n    this.comment = null;\n    this.codeMapping = null; // experimental, generate text code\n    this.codeHeader = null; // experimental, generate text code\n    this.translations = {}; // experimental, format: {lang : spec}\n\n    // don't serialize (not needed for functionality):\n    this.receiver = receiver || null; // for serialization only (pointer)\n    this.editorDimensions = null; // a rectangle, last bounds of the editor\n    this.cachedIsRecursive = null; // for automatic yielding\n    this.cachedTranslation = null; // for localized block specs\n\n\t// transient - for \"wishes\"\n    this.storedSemanticSpec = null;\n\n    // this.guid = newGuid();\n    this.guid = \"snap-module\";\n    this.isImported = false;\n}\n\n// CustomBlockDefinition instantiating blocks\n\nCustomBlockDefinition.prototype.blockInstance = function (storeTranslations) {\n    var block;\n    if (this.type === 'command') {\n        block = new CustomCommandBlockMorph(this);\n    } else {\n        block = new CustomReporterBlockMorph(\n            this,\n            this.type === 'predicate'\n        );\n    }\n    block.isDraggable = true;\n    if (storeTranslations) { // only for \"wishes\"\n    \tblock.storedTranslations = this.translationsAsText();\n    }\n    return block;\n};\n\nCustomBlockDefinition.prototype.templateInstance = function () {\n    var block;\n    block = this.blockInstance();\n    block.refreshDefaults(this);\n    block.isDraggable = false;\n    block.isTemplate = true;\n    return block;\n};\n\nCustomBlockDefinition.prototype.prototypeInstance = function () {\n    var block, slot;\n\n    // make a new block instance and mark it as prototype\n    if (this.type === 'command') {\n        block = new CustomCommandBlockMorph(this, true);\n    } else {\n        block = new CustomReporterBlockMorph(\n            this,\n            this.type === 'predicate',\n            true\n        );\n    }\n\n    // assign slot declarations to prototype inputs\n    block.parts().forEach(part => {\n        if (part instanceof BlockInputFragmentMorph) {\n            slot = this.declarations.get(part.fragment.labelString);\n            if (slot) {\n                part.fragment.type = slot[0];\n                part.fragment.defaultValue = slot[1];\n                part.fragment.options = slot[2];\n                part.fragment.isReadOnly = slot[3] || false;\n            }\n        }\n    });\n\n    return block;\n};\n\n// CustomBlockDefinition duplicating\n\nCustomBlockDefinition.prototype.copyAndBindTo = function (sprite, headerOnly) {\n    var c = copy(this);\n\n    delete c[XML_Serializer.prototype.idProperty];\n    c.receiver = sprite; // only for (kludgy) serialization\n\n    // copy declarations\n    c.declarations = new Map();\n    for (var [key, val] of this.declarations) {\n        c.declarations.set(key, val);\n    }\n\n    if (headerOnly) { // for serializing inherited method signatures\n        c.body = null;\n        return c;\n    }\n    if (c.body) {\n        c.body = Process.prototype.reify.call(\n            null,\n            this.body.expression,\n            new List(this.inputNames())\n        );\n        c.body.outerContext = null;\n    }\n    return c;\n};\n\n// CustomBlockDefinition accessing\n\nCustomBlockDefinition.prototype.blockSpec = function () {\n\tif (this.storedSemanticSpec) {\n \t\treturn this.storedSemanticSpec; // for \"wishes\"\n \t}\n\n    var ans = [],\n        parts = this.parseSpec(this.spec),\n        spec;\n    parts.forEach(part => {\n        if (part[0] === '%' && part.length > 1) {\n            spec = this.typeOf(part.slice(1));\n        } else if (part === '$nl') {\n            spec = '%br';\n        } else {\n            spec = part;\n        }\n        ans.push(spec);\n        ans.push(' ');\n    });\n    return ''.concat.apply('', ans).trim();\n};\n\nCustomBlockDefinition.prototype.helpSpec = function () {\n    var ans = [],\n        parts = this.parseSpec(this.spec);\n    parts.forEach(part => {\n        if (part[0] !== '%') {\n            ans.push(part);\n        }\n    });\n    return ''.concat.apply('', ans).replace(/\\?/g, '');\n};\n\nCustomBlockDefinition.prototype.typeOf = function (inputName) {\n    if (this.declarations.has(inputName)) {\n        return this.declarations.get(inputName)[0];\n    }\n    return '%s';\n};\n\nCustomBlockDefinition.prototype.defaultValueOf = function (inputName) {\n    if (this.declarations.has(inputName)) {\n        return this.declarations.get(inputName)[1];\n    }\n    return '';\n};\n\nCustomBlockDefinition.prototype.defaultValueOfInputIdx = function (idx) {\n    var inputName = this.inputNames()[idx];\n    return this.defaultValueOf(inputName);\n};\n\nCustomBlockDefinition.prototype.dropDownMenuOfInputIdx = function (idx) {\n    var inputName = this.inputNames()[idx];\n    return this.dropDownMenuOf(inputName);\n};\n\nCustomBlockDefinition.prototype.isReadOnlyInputIdx = function (idx) {\n    var inputName = this.inputNames()[idx];\n    return this.isReadOnlyInput(inputName);\n};\n\nCustomBlockDefinition.prototype.inputOptionsOfIdx = function (idx) {\n    var inputName = this.inputNames()[idx];\n    return this.inputOptionsOf(inputName);\n};\n\nCustomBlockDefinition.prototype.dropDownMenuOf = function (inputName) {\n    var fname;\n    if (this.declarations.has(inputName) &&\n            this.declarations.get(inputName)[2]) {\n        if ((this.declarations.get(inputName)[2].indexOf('_') === 0)) {\n            fname = this.declarations.get(inputName)[2].slice(2);\n            if (contains(\n                [\n                    'messagesMenu',\n                    'messagesReceivedMenu',    //for backward (5.0.0 - 5.0.3) support\n                    'objectsMenu',\n                    'costumesMenu',\n                    'soundsMenu',\n                    'getVarNamesDict',\n                    'pianoKeyboardMenu',\n                    'directionDialMenu'\n                ],\n                fname\n            )) {\n                return fname;\n            }\n        }\n        return this.parseChoices(this.declarations.get(inputName)[2]);\n    }\n    return null;\n};\n\nCustomBlockDefinition.prototype.parseChoices = function (string) {\n    var dict = {},\n        stack = [dict],\n        params, body;\n    if (string.match(/^function\\s*\\(.*\\)\\s*{.*\\n/)) {\n        // It's a JS function definition.\n        // Let's extract its params and body, and return a Function out of them.\n        // if (!this.enableJS) {\n        //     throw new Error('JavaScript is not enabled');\n        // }\n        params = string.match(/^function\\s*\\((.*)\\)/)[1].split(',');\n        body = string.split('\\n').slice(1,-1).join('\\n');\n        return Function.apply(null, params.concat([body]));\n    }\n    string.split('\\n').forEach(line => {\n        var pair = line.split('=');\n        if (pair[0] === '}') {\n            stack.pop();\n            dict = stack[stack.length - 1];\n        } else if (pair[1] === '{') {\n            dict = {};\n            stack[stack.length - 1][pair[0]] = dict;\n            stack.push(dict);\n        } else {\n            dict[pair[0]] = isNil(pair[1]) ? pair[0] : pair[1];\n        }\n    });\n    return dict;\n};\n\nCustomBlockDefinition.prototype.isReadOnlyInput = function (inputName) {\n    return this.declarations.has(inputName) &&\n        this.declarations.get(inputName)[3] === true;\n};\n\nCustomBlockDefinition.prototype.inputOptionsOf = function (inputName) {\n    return [\n        this.dropDownMenuOf(inputName),\n        this.isReadOnlyInput(inputName)\n    ];\n};\n\nCustomBlockDefinition.prototype.inputNames = function () {\n    var vNames = [],\n        parts = this.parseSpec(this.spec);\n    parts.forEach(part => {\n        if (part[0] === '%' && part.length > 1) {\n            vNames.push(part.slice(1));\n        }\n    });\n    return vNames;\n};\n\nCustomBlockDefinition.prototype.parseSpec = function (spec) {\n    // private\n    var parts = [], word = '', i, quoted = false, c;\n    for (i = 0; i < spec.length; i += 1) {\n        c = spec[i];\n        if (c === \"'\") {\n            quoted = !quoted;\n        } else if (c === ' ' && !quoted) {\n            parts.push(word);\n            word = '';\n        } else {\n            word = word.concat(c);\n        }\n    }\n    parts.push(word);\n    return parts;\n};\n\nCustomBlockDefinition.prototype.isDirectlyRecursive = function () {\n    var myspec;\n    if (this.cachedIsRecursive !== null) {\n        return this.cachedIsRecursive;\n    }\n    if (!this.body) {\n        this.cachedIsRecursive = false;\n    } else {\n        myspec = this.blockSpec();\n        this.cachedIsRecursive = this.body.expression.anyChild(\n            function (morph) {\n                return morph.isCustomBlock &&\n                    morph.blockSpec === myspec;\n            }\n        );\n    }\n    return this.cachedIsRecursive;\n};\n\n// CustomBlockDefinition localizing, highly experimental\n\nCustomBlockDefinition.prototype.localizedSpec = function () {\n\tif (this.cachedTranslation) {return this.cachedTranslation; }\n\n\tvar loc = this.translations[SnapTranslator.language],\n\t\tsem = this.blockSpec(),\n        locParts,\n  \t\tinputs,\n    \ti = -1;\n\n\tfunction isInput(str) {\n    \treturn (str.length > 1) && (str[0] === '%');\n \t}\n\n    if (isNil(loc)) {return sem; }\n    inputs = BlockMorph.prototype.parseSpec(sem).filter(str => isInput(str));\n\tlocParts = BlockMorph.prototype.parseSpec(loc);\n\n\t// perform a bunch of sanity checks on the localized spec\n\tif (locParts.some(str => isInput(str)) ||\n \t\t\t(locParts.filter(str => str === '_').length !== inputs.length)\n    ) {\n \t\tthis.cachedTranslation = sem;\n    } else {\n\t\t// substitute each input place holder with its semantic spec part\n\t\tlocParts = locParts.map(str => {\n\t\t\tif (str === '_') {\n  \t\t\t\ti += 1;\n  \t\t\t\treturn inputs[i];\n  \t\t\t}\n    \t\treturn str;\n\t\t});\n \t\tthis.cachedTranslation = locParts.join(' ');\n   \t}\n  \treturn this.cachedTranslation;\n};\n\nCustomBlockDefinition.prototype.abstractBlockSpec = function () {\n\t// answer the semantic block spec substituting each input\n \t// with an underscore\n    return BlockMorph.prototype.parseSpec(this.blockSpec()).map(str =>\n        (str.length > 1 && (str[0]) === '%') ? '_' : str\n    ).join(' ');\n};\n\nCustomBlockDefinition.prototype.translationsAsText = function () {\n\tvar txt = '';\n\tObject.keys(this.translations).forEach(lang =>\n \t\ttxt += (lang + ':' + this.translations[lang] + '\\n')\n    );\n    return txt;\n};\n\nCustomBlockDefinition.prototype.updateTranslations = function (text) {\n\tvar lines = text.split('\\n').filter(txt => txt.length);\n\tthis.translations = {};\n \tlines.forEach(txt => {\n  \t\tvar idx = txt.indexOf(':'),\n    \t\tkey = txt.slice(0, idx).trim(),\n      \t\tval = txt.slice(idx + 1).trim();\n    \tif (idx) {\n     \t\tthis.translations[key] = val;\n     \t}\n    });\n};\n\n// CustomBlockDefinition picturing\n\nCustomBlockDefinition.prototype.scriptsPicture = function () {\n    return this.scriptsModel().scriptsPicture();\n};\n\nCustomBlockDefinition.prototype.sortedElements = function () {\n    return this.scriptsModel().sortedElements();\n};\n\nCustomBlockDefinition.prototype.scriptsModel = function () {\n    // answer a restored scripting area for the sake\n    // of creating script pictures\n    var scripts, proto, block, comment, template;\n\n    scripts = new ScriptsMorph();\n    scripts.cleanUpMargin = 10;\n    proto = new PrototypeHatBlockMorph(this);\n    proto.setPosition(scripts.position().add(10));\n    if (this.comment !== null) {\n        comment = this.comment.fullCopy();\n        proto.comment = comment;\n        comment.block = proto;\n    }\n    if (this.body !== null) {\n        proto.nextBlock(this.body.expression.fullCopy());\n    }\n    scripts.add(proto);\n    proto.fixBlockColor(null, true);\n    this.scripts.forEach(element => {\n        block = element.fullCopy();\n        block.setPosition(scripts.position().add(element.position()));\n        scripts.add(block);\n        if (block instanceof BlockMorph) {\n            block.allComments().forEach(comment =>\n                comment.align(block)\n            );\n        }\n    });\n    proto.allComments().forEach(comment =>\n        comment.align(proto)\n    );\n    template = proto.parts()[0];\n    template.fixLayout();\n    template.forceNormalColoring();\n    template.fixBlockColor(proto, true);\n    scripts.fixMultiArgs();\n    return scripts;\n};\n\n// CustomBlockDefinition purging deleted blocks\n\nCustomBlockDefinition.prototype.purgeCorpses = function () {\n    // remove blocks that have been marked for deletion\n    if (this.body && this.body.expression.isCorpse) {\n        this.body = null;\n    }\n    this.scripts = this.scripts.filter(topBlock =>\n        !topBlock.isCorpse\n    );\n};\n\n// CustomBlockDefinition dependencies\n\nCustomBlockDefinition.prototype.collectDependencies = function (\n    excluding = [],\n    result = []\n) {\n    if (!this.isGlobal) {\n        throw new Error('collecting dependencies is only supported\\n' +\n            'for global custom blocks');\n    }\n    excluding.push(this);\n    this.scripts.concat(\n        this.body ? [this.body.expression] : []\n    ).forEach(script => {\n        script.forAllChildren(morph => {\n            if (morph.isCustomBlock &&\n                morph.isGlobal &&\n                !contains(excluding, morph.definition) &&\n                !contains(result, morph.definition)\n            ) {\n                result.push(morph.definition);\n                morph.definition.collectDependencies(excluding, result);\n            }\n        });\n    });\n    return result;\n};\n\nCustomBlockDefinition.prototype.isSending = function (message, receiverName) {\n    return this.scripts.concat(\n        this.body ? [this.body.expression] : []\n    ).some(script => script.isSending(message, receiverName));\n};\n\n// CustomCommandBlockMorph /////////////////////////////////////////////\n\n// CustomCommandBlockMorph inherits from CommandBlockMorph:\n\nCustomCommandBlockMorph.prototype = new CommandBlockMorph();\nCustomCommandBlockMorph.prototype.constructor = CustomCommandBlockMorph;\nCustomCommandBlockMorph.uber = CommandBlockMorph.prototype;\n\n// CustomCommandBlockMorph shared settings:\n\nCustomCommandBlockMorph.prototype.isCustomBlock = true;\n\n// CustomCommandBlockMorph instance creation:\n\nexport function CustomCommandBlockMorph(definition, isProto) {\n    this.init(definition, isProto);\n}\n\nCustomCommandBlockMorph.prototype.init = function (definition, isProto) {\n    this.definition = definition; // mandatory\n    this.semanticSpec = '';\n    this.isGlobal = definition ? definition.isGlobal : false;\n    this.isPrototype = isProto || false; // optional\n    CustomCommandBlockMorph.uber.init.call(this);\n    this.category = definition.category;\n    this.selector = 'evaluateCustomBlock';\n    this.variables = null;\n\tthis.storedTranslations = null; // transient - only for \"wishes\"\n    this.initializeVariables();\n    if (definition) { // needed for de-serializing\n        this.refresh();\n    }\n};\n\nCustomCommandBlockMorph.prototype.initializeVariables = function (oldVars) {\n    this.variables = new VariableFrame();\n    if (!this.isGlobal) {\n        return;\n    }\n    this.definition.variableNames.forEach(name => {\n        var v = oldVars ? oldVars[name] : null;\n        this.variables.addVar(\n            name,\n            v instanceof Variable ? v.value : null\n        );\n    });\n};\n\nCustomCommandBlockMorph.prototype.refresh = function (aDefinition) {\n    var def = aDefinition || this.definition,\n        newSpec = this.isPrototype ?\n                def.spec : def.localizedSpec(),\n        oldInputs;\n\n\tthis.semanticSpec = def.blockSpec();\n\n    // make sure local custom blocks don't hold on to a method.\n    // future performance optimization plan:\n    // null out the definition for local blocks here,\n    // and then cache them again when invoking them\n    if (!this.isGlobal && !this.isPrototype) {\n        this.definition = null;\n    }\n\n    this.setCategory(def.category);\n    if (this.blockSpec !== newSpec) {\n        oldInputs = this.inputs();\n        if (!this.zebraContrast) {\n            this.forceNormalColoring();\n        } else {\n            this.fixBlockColor();\n        }\n        this.setSpec(newSpec, def);\n        this.fixLabelColor();\n        this.restoreInputs(oldInputs);\n    } else { // update all input slots' drop-downs\n        this.inputs().forEach((inp, i) => {\n            if (inp instanceof InputSlotMorph) {\n                inp.setChoices.apply(inp, def.inputOptionsOfIdx(i));\n            }\n        });\n    }\n\n    // find unnamed upvars and label them\n    // to their internal definition (default)\n    this.cachedInputs = null;\n    this.inputs().forEach((inp, idx) => {\n        if (inp instanceof TemplateSlotMorph && inp.contents() === '\\u2191') {\n            inp.setContents(def.inputNames()[idx]);\n        }\n    });\n\n    // initialize block vars\n    // preserve values of unchanged variable names\n    if (this.isGlobal) {\n        this.initializeVariables(this.variables.vars);\n    }\n\n    // make (double) sure I'm colored correctly\n    this.forceNormalColoring();\n    this.fixBlockColor(null, true);\n};\n\nCustomCommandBlockMorph.prototype.restoreInputs = function (oldInputs) {\n    // try to restore my previous inputs when my spec has been changed\n    var i = 0,\n        old;\n    if (this.isPrototype) {return; }\n    this.cachedInputs = null;\n    this.inputs().forEach(inp => {\n        old = oldInputs[i];\n        if (old instanceof ReporterBlockMorph &&\n                (!(inp instanceof TemplateSlotMorph))) {\n            this.replaceInput(inp, old.fullCopy());\n        } else if (old instanceof InputSlotMorph\n                && inp instanceof InputSlotMorph) {\n            if (old.isEmptySlot()) {\n                inp.setContents('');\n            } else {\n                inp.setContents(old.evaluate());\n            }\n        } else if (old instanceof BooleanSlotMorph\n                && inp instanceof BooleanSlotMorph) {\n            inp.setContents(old.evaluate());\n        } else if (old instanceof BooleanSlotMorph\n                && inp instanceof BooleanSlotMorph) {\n            inp.setContents(old.evaluate());\n        } else if (old instanceof TemplateSlotMorph\n                && inp instanceof TemplateSlotMorph) {\n            inp.setContents(old.evaluate());\n        } else if (old instanceof CSlotMorph\n                && inp instanceof CSlotMorph) {\n            inp.nestedBlock(old.evaluate());\n        }\n        i += 1;\n    });\n    this.cachedInputs = null;\n};\n\nCustomCommandBlockMorph.prototype.refreshDefaults = function (definition) {\n    // fill my editable slots with the defaults specified in my definition\n    var inputs = this.inputs(),\n        idx = 0;\n\n    inputs.forEach(inp => {\n        if (inp instanceof InputSlotMorph || inp instanceof BooleanSlotMorph) {\n            inp.setContents(\n                (definition || this.definition).defaultValueOfInputIdx(idx)\n            );\n        }\n        idx += 1;\n    });\n    this.cachedInputs = null;\n};\n\nCustomCommandBlockMorph.prototype.refreshPrototype = function () {\n    // create my label parts from my (edited) fragments only\n    var hat,\n        protoSpec,\n        frags = [],\n        myself = this, // CAUTION: myself changes its value in this method\n        words,\n        newFrag,\n        i = 0;\n\n    if (!this.isPrototype) {return null; }\n\n    hat = this.parentThatIsA(PrototypeHatBlockMorph);\n\n    // remember the edited fragments\n    this.parts().forEach(part => {\n        if (!part.fragment.isDeleted) {\n            // take into consideration that a fragment may spawn others\n            // if it isn't an input label consisting of several words\n            if (part.fragment.type) { // marked as input, take label as is\n                frags.push(part.fragment);\n            } else { // not an input, devide into several non-input fragments\n                words = myself.definition.parseSpec(\n                    part.fragment.labelString\n                );\n                words.forEach(word => {\n                    newFrag = part.fragment.copy();\n                    newFrag.labelString = word;\n                    frags.push(newFrag);\n                });\n            }\n        }\n    });\n\n    // remember the edited prototype spec,\n    // and prevent removing the last one\n    protoSpec = this.specFromFragments() || this.blockSpec;\n\n    // update the prototype's type\n    // and possibly exchange 'this' for 'myself'\n    if (this instanceof CustomCommandBlockMorph\n            && ((hat.type === 'reporter') || (hat.type === 'predicate'))) {\n        myself = new CustomReporterBlockMorph(\n            this.definition,\n            hat.type === 'predicate',\n            true\n        );\n        hat.replaceInput(this, myself);\n    } else if (this instanceof CustomReporterBlockMorph) {\n        if (hat.type === 'command') {\n            myself = new CustomCommandBlockMorph(\n                this.definition,\n                true\n            );\n            hat.replaceInput(this, myself);\n        } else {\n            this.isPredicate = (hat.type === 'predicate');\n            this.fixLayout();\n            this.rerender();\n        }\n    }\n    myself.setCategory(hat.blockCategory || 'other');\n    hat.fixBlockColor();\n\n    // update the (new) prototype's appearance\n    myself.setSpec(protoSpec);\n\n    // update the (new) prototype's (new) fragments\n    // with the previously edited ones\n\n    myself.parts().forEach(part => {\n        if (!(part instanceof BlockLabelPlaceHolderMorph)) {\n            if (frags[i]) { // don't delete the default fragment\n                part.fragment = frags[i];\n            }\n            i += 1;\n        }\n    });\n\n    // refresh slot type indicators\n    this.refreshPrototypeSlotTypes();\n\n    hat.fixLayout();\n};\n\nCustomCommandBlockMorph.prototype.refreshPrototypeSlotTypes = function () {\n    this.parts().forEach(part => {\n        if (part instanceof BlockInputFragmentMorph) {\n            part.template().instantiationSpec = part.contents();\n            part.setContents(part.fragment.defTemplateSpecFragment());\n        }\n    });\n    this.fixBlockColor(null, true); // enforce zebra coloring of templates\n};\n\n\nCustomCommandBlockMorph.prototype.inputFragmentNames = function () {\n    // for the variable name slot drop-down menu (in the block editor)\n    var ans = [];\n\n    this.parts().forEach(part => {\n        if (!part.fragment.isDeleted && (part.fragment.type)) {\n            ans.push(part.fragment.labelString);\n        }\n    });\n    return ans;\n};\n\nCustomCommandBlockMorph.prototype.upvarFragmentNames = function () {\n    // for the variable name slot drop-down menu (in the block editor)\n    var ans = [];\n\n    this.parts().forEach(part => {\n        if (!part.fragment.isDeleted && (part.fragment.type === '%upvar')) {\n            ans.push(part.fragment.labelString);\n        }\n    });\n    return ans;\n};\n\nCustomCommandBlockMorph.prototype.upvarFragmentName = function (idx) {\n    // for block prototypes while they are being edited\n    return this.upvarFragmentNames()[idx] || '\\u2191';\n};\n\nCustomCommandBlockMorph.prototype.specFromFragments = function () {\n    // for block prototypes while they are being edited\n    var ans = '';\n\n    this.parts().forEach(part => {\n        if (!part.fragment.isDeleted) {\n            ans = ans + part.fragment.defSpecFragment() + ' ';\n        }\n    });\n    return ans.trim();\n};\n\nCustomCommandBlockMorph.prototype.blockSpecFromFragments = function () {\n    // for block instances while their prototype is being edited\n    var ans = '';\n\n    this.parts().forEach(part => {\n        if (!part.fragment.isDeleted) {\n            ans = ans + part.fragment.blockSpecFragment() + ' ';\n        }\n    });\n    return ans.trim();\n};\n\nCustomCommandBlockMorph.prototype.declarationsFromFragments = function () {\n    // returns a Map object for type declarations:\n    //     key: inputName\n    //     value: [type, default, options, isReadOnly]\n    var ans = new Map();\n\n    this.parts().forEach(part => {\n        if (part instanceof BlockInputFragmentMorph) {\n            ans.set(\n                part.fragment.labelString,\n                [\n                    part.fragment.type,\n                    part.fragment.defaultValue,\n                    part.fragment.options,\n                    part.fragment.isReadOnly\n                ]\n            );\n        }\n    });\n    return ans;\n};\n\nCustomCommandBlockMorph.prototype.parseSpec = function (spec) {\n    if (!this.isPrototype) {\n        return CustomCommandBlockMorph.uber.parseSpec.call(this, spec);\n    }\n    return CustomBlockDefinition.prototype.parseSpec(spec);\n};\n\nCustomCommandBlockMorph.prototype.mouseClickLeft = function () {\n    if (!this.isPrototype) {\n        return CustomCommandBlockMorph.uber.mouseClickLeft.call(this);\n    }\n    this.edit();\n};\n\n// CustomCommandBlockMorph.prototype.edit = function () {\n//     var def = this.definition,\n//         editor, block,\n//         hat,\n//         rcvr;\n//\n//     if (this.isPrototype) {\n//         block = this.definition.blockInstance();\n//         block.addShadow();\n//         hat = this.parentThatIsA(PrototypeHatBlockMorph);\n//         new BlockDialogMorph(\n//             null,\n//             (definition) => {\n//                 if (definition) { // temporarily update everything\n//                     // Trace.log('BlockEditor.changeType', this.getDefinitionID());\n//                     hat.blockCategory = definition.category;\n//                     hat.type = definition.type;\n//                     this.refreshPrototype();\n//                 }\n//             },\n//             this\n//         ).openForChange(\n//             'Change block',\n//             hat.blockCategory,\n//             hat.type,\n//             this.world(),\n//             block.doWithAlpha(1, () => block.fullImage()),\n//             this.isInUse()\n//         );\n//     } else {\n//         // check for local custom block inheritance\n//         rcvr = this.scriptTarget();\n//         if (!this.isGlobal) {\n//             if (contains(\n//                     Object.keys(rcvr.inheritedBlocks()),\n//                     this.blockSpec\n//                 )\n//             ) {\n//                 this.duplicateBlockDefinition();\n//                 return;\n//             }\n//             def = rcvr.getMethod(this.semanticSpec);\n//         }\n//         editor = new BlockEditorMorph(def, rcvr);\n//         editor.popUp();\n//         editor.changed();\n//     }\n// };\n\nCustomCommandBlockMorph.prototype.labelPart = function (spec) {\n    var part;\n\n    if (!this.isPrototype) {\n        return CustomCommandBlockMorph.uber.labelPart.call(this, spec);\n    }\n    if ((spec[0] === '%') && (spec.length > 1)) {\n        // part = new BlockInputFragmentMorph(spec.slice(1));\n        part = new BlockInputFragmentMorph(spec.replace(/%/g, ''));\n    } else {\n        part = new BlockLabelFragmentMorph(spec);\n        part.fontSize = this.fontSize;\n        part.color = WHITE;\n        part.isBold = true;\n        part.shadowColor = this.color.darker(this.labelContrast);\n        part.shadowOffset = this.embossing;\n        part.fixLayout();\n        part.rerender();\n    }\n    return part;\n};\n\nCustomCommandBlockMorph.prototype.placeHolder = function () {\n    var part;\n\n    part = new BlockLabelPlaceHolderMorph();\n    part.fontSize = this.fontSize * 1.4;\n    part.color = new Color(45, 45, 45);\n    part.fixLayout();\n    return part;\n};\n\nCustomCommandBlockMorph.prototype.attachTargets = function () {\n    if (this.isPrototype) {\n        return [];\n    }\n    return CustomCommandBlockMorph.uber.attachTargets.call(this);\n};\n\n// CustomCommandBlockMorph.prototype.isInUse = function () {\n//     // answer true if an instance of my definition is found\n//     // in any of my receiver's scripts or block definitions\n//     // NOTE: for sprite-local blocks only to be used in a situation\n//     // where the user actively clicks on a block in the IDE,\n//     // e.g. to edit it (and change its type)\n//     var def = this.definition,\n//         rcvr = this.scriptTarget(),\n//         ide = rcvr.parentThatIsA(IDE_Morph);\n//     if (def.isGlobal && ide) {\n//         return ide.sprites.asArray().concat([ide.stage]).some((any, idx) =>\n//             any.usesBlockInstance(def, false, idx)\n//         );\n//     }\n//     return rcvr.allDependentInvocationsOf(this.blockSpec).length > 0;\n// };\n\n// CustomCommandBlockMorph menu:\n\n// CustomCommandBlockMorph.prototype.userMenu = function () {\n//     var hat = this.parentThatIsA(PrototypeHatBlockMorph),\n//         rcvr = this.scriptTarget(),\n//         myself = this,\n//         // shiftClicked = this.world().currentKey === 16,\n//         menu;\n//\n//     function addOption(label, toggle, test, onHint, offHint) {\n//         var on = '\\u2611 ',\n//             off = '\\u2610 ';\n//         menu.addItem(\n//             (test ? on : off) + localize(label),\n//             toggle,\n//             test ? onHint : offHint\n//         );\n//     }\n//\n//    function monitor(vName) {\n//         var stage = rcvr.parentThatIsA(StageMorph),\n//             varFrame = myself.variables;\n//         menu.addItem(\n//             vName + '...',\n//             function () {\n//                 var watcher = detect(\n//                     stage.children,\n//                     function (morph) {\n//                         return morph instanceof WatcherMorph\n//                             && morph.target === varFrame\n//                             && morph.getter === vName;\n//                     }\n//                 ),\n//                     others;\n//                 if (watcher !== null) {\n//                     watcher.show();\n//                     watcher.fixLayout(); // re-hide hidden parts\n//                     return;\n//                 }\n//                 watcher = new WatcherMorph(\n//                     vName + ' ' + localize('(temporary)'),\n//                     SpriteMorph.prototype.blockColor.variables,\n//                     varFrame,\n//                     vName\n//                 );\n//                 watcher.setPosition(stage.position().add(10));\n//                 others = stage.watchers(watcher.left());\n//                 if (others.length > 0) {\n//                     watcher.setTop(others[others.length - 1].bottom());\n//                 }\n//                 stage.add(watcher);\n//                 watcher.fixLayout();\n//             }\n//         );\n//     }\n//\n//     if (this.isPrototype) {\n//         menu = new MenuMorph(this);\n//         menu.addItem(\n//             \"script pic...\",\n//             function () {\n//                 var ide = this.world().children[0];\n//                 ide.saveCanvasAs(\n//                     this.topBlock().scriptPic(),\n//                     (ide.projectName || localize('untitled')) + ' ' +\n//                         localize('script pic')\n//                 );\n//             },\n//             'open a new window\\nwith a picture of this script'\n//         );\n//         menu.addItem(\n//             \"translations...\",\n//             function () {\n//                 hat.parentThatIsA(BlockEditorMorph).editTranslations();\n//             },\n//             'experimental -\\nunder construction'\n//         );\n//         if (this.isGlobal) {\n//             if (hat.inputs().length < 2) {\n//                 menu.addItem(\n//                     \"block variables...\",\n//                     function () {\n//                         hat.enableBlockVars();\n//                     },\n//                     'experimental -\\nunder construction'\n//                 );\n//             } else {\n//                 menu.addItem(\n//                     \"remove block variables...\",\n//                     function () {\n//                         hat.enableBlockVars(false);\n//                     },\n//                     'experimental -\\nunder construction'\n//                 );\n//             }\n//         }\n//     } else {\n//         menu = this.constructor.uber.userMenu.call(this);\n//         if (!menu) {\n//             menu = new MenuMorph(this);\n//         } else {\n//             menu.addLine();\n//         }\n//         if (this.isTemplate) { // inside the palette\n//             if (this.isGlobal) {\n//                 menu.addItem(\n//                     \"delete block definition...\",\n//                     'deleteBlockDefinition'\n//                 );\n//             } else { // local method\n//                 if (contains(\n//                         Object.keys(rcvr.inheritedBlocks()),\n//                         this.blockSpec\n//                 )) {\n//                     // inherited\n//                     addOption(\n//                         'inherited',\n//                         function () {\n//                             var ide = myself.parentThatIsA(IDE_Morph);\n//                             rcvr.customBlocks.push(\n//                                 rcvr.getMethod(\n//                                     myself.blockSpec\n//                                 ).copyAndBindTo(rcvr)\n//                             );\n//                             if (ide) {\n//                                 ide.flushPaletteCache();\n//                                 ide.refreshPalette();\n//                             }\n//                         },\n//                         true,\n//                         'uncheck to\\ndisinherit',\n//                         null\n//                     );\n//                 } else if (rcvr.exemplar &&\n//                     rcvr.exemplar.getMethod(this.blockSpec\n//                 )) {\n//                     // shadowed\n//                     addOption(\n//                         'inherited',\n//                         'deleteBlockDefinition',\n//                         false,\n//                         null,\n//                         localize('check to inherit\\nfrom')\n//                             + ' ' + rcvr.exemplar.name\n//                     );\n//                 } else {\n//                     // own block\n//                     menu.addItem(\n//                         \"delete block definition...\",\n//                         'deleteBlockDefinition'\n//                     );\n//                 }\n//             }\n//             menu.addItem(\n//                 \"duplicate block definition...\",\n//                 'duplicateBlockDefinition'\n//             );\n//             if (this.isGlobal) {\n//                 menu.addItem(\n//                     \"export block definition...\",\n//                     'exportBlockDefinition',\n//                     'including dependencies'\n//                 );\n//             }\n//         } else { // inside a script\n//             // if global or own method - let the user delete the definition\n//             if (this.isGlobal ||\n//                 contains(\n//                     Object.keys(rcvr.ownBlocks()),\n//                     this.blockSpec\n//                 )\n//             ) {\n//                 menu.addItem(\n//                     \"delete block definition...\",\n//                     'deleteBlockDefinition'\n//                 );\n//             }\n//         }\n//\n//         this.variables.names().forEach(vName =>\n//             monitor(vName)\n//         );\n//     }\n//     menu.addItem(\"edit...\", 'edit'); // works also for prototypes\n//     return menu;\n// };\n//\n// CustomCommandBlockMorph.prototype.exportBlockDefinition = function () {\n//     var ide = this.parentThatIsA(IDE_Morph);\n//     new BlockExportDialogMorph(\n//         ide.serializer,\n//         [this.definition].concat(this.definition.collectDependencies())\n//     ).popUp(this.world());\n// };\n\n// CustomCommandBlockMorph.prototype.duplicateBlockDefinition = function () {\n//     var rcvr = this.scriptTarget(),\n//         ide = this.parentThatIsA(IDE_Morph),\n//         def = this.isGlobal ? this.definition : rcvr.getMethod(this.blockSpec),\n//         dup = def.copyAndBindTo(rcvr),\n//         spec = dup.spec,\n//         count = 1;\n//\n//     if (this.isGlobal) {\n//         ide.stage.globalBlocks.push(dup);\n//     } else {\n//         rcvr.customBlocks.push(dup);\n//     }\n//\n//     // find a unique spec\n//     while (rcvr.doubleDefinitionsFor(dup).length > 0) {\n//         count += 1;\n//         dup.spec = spec + ' (' + count + ')';\n//     }\n//\n//     ide.flushPaletteCache();\n//     ide.refreshPalette();\n//     new BlockEditorMorph(dup, rcvr).popUp();\n// };\n//\n// CustomCommandBlockMorph.prototype.deleteBlockDefinition = function () {\n//     var idx, stage, ide, method, block,\n//         rcvr = this.scriptTarget();\n//     if (this.isPrototype) {\n//         return null; // under construction...\n//     }\n//     method = this.isGlobal? this.definition\n//             : rcvr.getLocalMethod(this.blockSpec);\n//     block = method.blockInstance();\n//     new DialogBoxMorph(\n//         this,\n//         () => {\n//             // Trace.log('IDE.deleteCustomBlock', this.definition ? {\n//             //     'spec': this.definition.spec,\n//             //     'category': this.definition.category,\n//             //     'type': this.definition.type,\n//             //     'guid': this.definition.guid,\n//             // } : null);\n//             rcvr.deleteAllBlockInstances(method);\n//             if (method.isGlobal) {\n//                 stage = rcvr.parentThatIsA(StageMorph);\n//                 idx = stage.globalBlocks.indexOf(method);\n//                 if (idx !== -1) {\n//                     stage.globalBlocks.splice(idx, 1);\n//                 }\n//             } else {\n//                 // delete local definition\n//                 idx = rcvr.customBlocks.indexOf(method);\n//                 if (idx !== -1) {\n//                     rcvr.customBlocks.splice(idx, 1);\n//                 }\n//                 // refresh instances of inherited method, if any\n//                 method = rcvr.getMethod(this.blockSpec);\n//                 if (method) {\n//                     rcvr.allDependentInvocationsOf(this.blockSpec).forEach(\n//                         block => block.refresh(method)\n//                     );\n//                 }\n//             }\n//             ide = rcvr.parentThatIsA(IDE_Morph);\n//             if (ide) {\n//                 ide.flushPaletteCache();\n//                 ide.refreshPalette();\n//             }\n//         },\n//         this\n//     ).askYesNo(\n//         'Delete Custom Block',\n//         localize('block deletion dialog text'), // long string lookup\n//         this.world(),\n//         block.doWithAlpha(\n//             1,\n//             () => {\n//                 block.addShadow();\n//                 return block.fullImage();\n//             }\n//         )\n//     );\n// };\n\n// CustomCommandBlockMorph relabelling\n\nCustomCommandBlockMorph.prototype.relabel = function (alternatives) {\n    var menu = new MenuMorph(this),\n        oldInputs = this.inputs().map(each => each.fullCopy());\n    alternatives.forEach(def => {\n        var block = def.blockInstance();\n        block.restoreInputs(oldInputs);\n        block.fixBlockColor(null, true);\n        block.addShadow(new Point(3, 3));\n        menu.addItem(\n            block.doWithAlpha(1, () => block.fullImage()),\n            () => {\n                this.definition = def;\n                this.refresh();\n            }\n        );\n    });\n    menu.popup(this.world(), this.bottomLeft().subtract(new Point(\n        8,\n        this instanceof CommandBlockMorph ? this.corner : 0\n    )));\n};\n\nCustomCommandBlockMorph.prototype.alternatives = function () {\n    var rcvr = this.scriptTarget(),\n        stage = rcvr.parentThatIsA(StageMorph),\n        allDefs = rcvr.customBlocks.concat(stage.globalBlocks),\n        type = this instanceof CommandBlockMorph ? 'command'\n            : (this.isPredicate ? 'predicate' : 'reporter');\n    return allDefs.filter(each =>\n        each !== this.definition && each.type === type\n    );\n};\n\n// CustomReporterBlockMorph ////////////////////////////////////////////\n\n// CustomReporterBlockMorph inherits from ReporterBlockMorph:\n\nCustomReporterBlockMorph.prototype = new ReporterBlockMorph();\nCustomReporterBlockMorph.prototype.constructor = CustomReporterBlockMorph;\nCustomReporterBlockMorph.uber = ReporterBlockMorph.prototype;\n\n// CustomReporterBlockMorph shared settings:\n\nCustomReporterBlockMorph.prototype.isCustomBlock = true;\n\n// CustomReporterBlockMorph instance creation:\n\nexport function CustomReporterBlockMorph(definition, isPredicate, isProto) {\n    this.init(definition, isPredicate, isProto);\n}\n\nCustomReporterBlockMorph.prototype.init = function (\n    definition,\n    isPredicate,\n    isProto\n) {\n    this.definition = definition; // mandatory\n    this.semanticSpec = ''; // used for translations\n    this.isGlobal = definition ? definition.isGlobal : false;\n    this.isPrototype = isProto || false; // optional\n    CustomReporterBlockMorph.uber.init.call(this, isPredicate, true); // sil.\n    this.category = definition.category;\n    this.storedTranslations = null; // transient - only for \"wishes\"\n    this.variables = new VariableFrame();\n    this.initializeVariables();\n    this.selector = 'evaluateCustomBlock';\n    if (definition) { // needed for de-serializing\n        this.refresh();\n    }\n};\n\nCustomReporterBlockMorph.prototype.initializeVariables =\n    CustomCommandBlockMorph.prototype.initializeVariables;\n\nCustomReporterBlockMorph.prototype.refresh = function (aDefinition) {\n    var def = aDefinition || this.definition;\n    CustomCommandBlockMorph.prototype.refresh.call(this, aDefinition, true);\n    if (!this.isPrototype) {\n        this.isPredicate = (def.type === 'predicate');\n    }\n    if (this.parent instanceof SyntaxElementMorph) {\n        this.parent.cachedInputs = null;\n    }\n    this.fixLayout();\n};\n\nCustomReporterBlockMorph.prototype.mouseClickLeft = function () {\n    if (!this.isPrototype) {\n        return CustomReporterBlockMorph.uber.mouseClickLeft.call(this);\n    }\n    this.edit();\n};\n\nCustomReporterBlockMorph.prototype.placeHolder\n    = CustomCommandBlockMorph.prototype.placeHolder;\n\nCustomReporterBlockMorph.prototype.parseSpec\n    = CustomCommandBlockMorph.prototype.parseSpec;\n\nCustomReporterBlockMorph.prototype.edit\n    = CustomCommandBlockMorph.prototype.edit;\n\nCustomReporterBlockMorph.prototype.labelPart\n    = CustomCommandBlockMorph.prototype.labelPart;\n\nCustomReporterBlockMorph.prototype.upvarFragmentNames\n    = CustomCommandBlockMorph.prototype.upvarFragmentNames;\n\nCustomReporterBlockMorph.prototype.upvarFragmentName\n    = CustomCommandBlockMorph.prototype.upvarFragmentName;\n\nCustomReporterBlockMorph.prototype.inputFragmentNames\n    = CustomCommandBlockMorph.prototype.inputFragmentNames;\n\nCustomReporterBlockMorph.prototype.specFromFragments\n    = CustomCommandBlockMorph.prototype.specFromFragments;\n\nCustomReporterBlockMorph.prototype.blockSpecFromFragments\n    = CustomCommandBlockMorph.prototype.blockSpecFromFragments;\n\nCustomReporterBlockMorph.prototype.declarationsFromFragments\n    = CustomCommandBlockMorph.prototype.declarationsFromFragments;\n\nCustomReporterBlockMorph.prototype.refreshPrototype\n    = CustomCommandBlockMorph.prototype.refreshPrototype;\n\nCustomReporterBlockMorph.prototype.refreshPrototypeSlotTypes\n    = CustomCommandBlockMorph.prototype.refreshPrototypeSlotTypes;\n\nCustomReporterBlockMorph.prototype.restoreInputs\n    = CustomCommandBlockMorph.prototype.restoreInputs;\n\nCustomReporterBlockMorph.prototype.refreshDefaults\n    = CustomCommandBlockMorph.prototype.refreshDefaults;\n\nCustomReporterBlockMorph.prototype.isInUse\n    = CustomCommandBlockMorph.prototype.isInUse;\n\n// CustomReporterBlockMorph menu:\n\nCustomReporterBlockMorph.prototype.userMenu\n    = CustomCommandBlockMorph.prototype.userMenu;\n\nCustomReporterBlockMorph.prototype.duplicateBlockDefinition\n    = CustomCommandBlockMorph.prototype.duplicateBlockDefinition;\n\nCustomReporterBlockMorph.prototype.deleteBlockDefinition\n    = CustomCommandBlockMorph.prototype.deleteBlockDefinition;\n\nCustomReporterBlockMorph.prototype.exportBlockDefinition\n    = CustomCommandBlockMorph.prototype.exportBlockDefinition;\n\n// CustomReporterBlockMorph events:\n\n// hover help - commented out for now\n/*\nCustomReporterBlockMorph.prototype.mouseEnter\n    = CustomCommandBlockMorph.prototype.mouseEnter;\n\nCustomReporterBlockMorph.prototype.mouseLeave\n    = CustomCommandBlockMorph.prototype.mouseLeave;\n*/\n\n// CustomReporterBlockMorph bubble help:\n\nCustomReporterBlockMorph.prototype.bubbleHelp\n    = CustomCommandBlockMorph.prototype.bubbleHelp;\n\nCustomReporterBlockMorph.prototype.popUpbubbleHelp\n    = CustomCommandBlockMorph.prototype.popUpbubbleHelp;\n\n// CustomReporterBlockMorph relabelling\n\nCustomReporterBlockMorph.prototype.relabel\n    = CustomCommandBlockMorph.prototype.relabel;\n\nCustomReporterBlockMorph.prototype.alternatives\n    = CustomCommandBlockMorph.prototype.alternatives;\n\n// JaggedBlockMorph ////////////////////////////////////////////////////\n\n/*\n    I am a reporter block with jagged left and right edges conveying the\n    appearance of having the broken out of a bigger block. I am used to\n    display input types in the long form input dialog.\n*/\n\n// JaggedBlockMorph inherits from ReporterBlockMorph:\n\nJaggedBlockMorph.prototype = new ReporterBlockMorph();\nJaggedBlockMorph.prototype.constructor = JaggedBlockMorph;\nJaggedBlockMorph.uber = ReporterBlockMorph.prototype;\n\n// JaggedBlockMorph instance creation:\n\nexport function JaggedBlockMorph(spec) {\n    this.init(spec);\n}\n\nJaggedBlockMorph.prototype.init = function (spec) {\n    JaggedBlockMorph.uber.init.call(this);\n    if (spec) {this.setSpec(spec); }\n    if (spec === '%cs' || (spec === '%ca')) {\n        this.minWidth = 25;\n        this.fixLayout();\n    }\n};\n\n// JaggedBlockMorph drawing:\n\nJaggedBlockMorph.prototype.outlinePath = function (ctx, inset) {\n    var w = this.width(),\n        h,\n        jags,\n        delta,\n        pos = this.position(),\n        y = 0,\n        i;\n\n    ctx.moveTo(inset, inset);\n    ctx.lineTo(w - inset, inset);\n\n    // C-Slots\n    this.cSlots().forEach(slot => {\n        slot.outlinePath(ctx, inset, slot.position().subtract(pos));\n        y += slot.height();\n    });\n\n    h = this.height() - y - inset;\n    jags = Math.round(h / this.jag);\n    delta = h / jags;\n\n    // y = 0;\n    for (i = 0; i < jags; i += 1) {\n        y += delta / 2;\n        ctx.lineTo(w - this.jag / 2 - inset, y);\n        y += delta / 2;\n        ctx.lineTo(w - inset, y);\n    }\n\n    h = this.height() - inset;\n    jags = Math.round(h / this.jag);\n    delta = h / jags;\n\n    ctx.lineTo(inset, h - inset);\n    y = h;\n    for (i = 0; i < jags; i += 1) {\n        y -= delta / 2;\n        ctx.lineTo(this.jag / 2 + inset, y);\n        y -= delta / 2;\n        ctx.lineTo(inset, y);\n    }\n};\n\nJaggedBlockMorph.prototype.drawEdges = function (ctx) {\n    var w = this.width(),\n        h = this.height(),\n        jags = Math.round(h / this.jag),\n        delta = h / jags,\n        shift = this.edge / 2,\n        gradient,\n        i,\n        y;\n\n    ctx.lineWidth = this.edge;\n    ctx.lineJoin = 'round';\n    ctx.lineCap = 'round';\n\n    gradient = ctx.createLinearGradient(\n        0,\n        0,\n        0,\n        this.edge\n    );\n    gradient.addColorStop(0, this.cachedClrBright);\n    gradient.addColorStop(1, this.cachedClr);\n    ctx.strokeStyle = gradient;\n\n    ctx.beginPath();\n    ctx.moveTo(shift, shift);\n    ctx.lineTo(w - shift, shift);\n    ctx.stroke();\n\n    if (!this.cSlots().length) { // omit right jagged outline for c-slots\n        y = 0;\n        for (i = 0; i < jags; i += 1) {\n            ctx.strokeStyle = this.cachedClrDark;\n            ctx.beginPath();\n            ctx.moveTo(w - shift, y);\n            y += delta / 2;\n            ctx.lineTo(w - this.jag / 2 - shift, y);\n            ctx.stroke();\n            y += delta / 2;\n        }\n    }\n\n    gradient = ctx.createLinearGradient(\n        0,\n        h - this.edge,\n        0,\n        h\n    );\n    gradient.addColorStop(0, this.cachedClr);\n    gradient.addColorStop(1, this.cachedClrDark);\n    ctx.strokeStyle = gradient;\n    ctx.beginPath();\n    ctx.moveTo(w - shift, h - shift);\n    ctx.lineTo(shift, h - shift);\n    ctx.stroke();\n\n    y = h;\n    for (i = 0; i < jags; i += 1) {\n        ctx.strokeStyle = this.cachedClrBright;\n        ctx.beginPath();\n        ctx.moveTo(shift, y);\n        y -= delta / 2;\n        ctx.lineTo(this.jag / 2 + shift, y);\n        ctx.stroke();\n        y -= delta / 2;\n    }\n};\n\n// BlockDialogMorph ////////////////////////////////////////////////////\n\n// BlockDialogMorph inherits from DialogBoxMorph:\n\nBlockDialogMorph.prototype = new DialogBoxMorph();\nBlockDialogMorph.prototype.constructor = BlockDialogMorph;\nBlockDialogMorph.uber = DialogBoxMorph.prototype;\n\n// BlockDialogMorph instance creation:\n\nexport function BlockDialogMorph(target, action, environment) {\n    this.init(target, action, environment);\n}\n\nBlockDialogMorph.prototype.init = function (target, action, environment) {\n    // additional properties:\n    this.blockType = 'command';\n    this.category = 'other';\n    this.isGlobal = true;\n    this.types = null;\n    this.categories = null;\n\n    // initialize inherited properties:\n    BlockDialogMorph.uber.init.call(\n        this,\n        target,\n        action,\n        environment\n    );\n\n    // override inherited properites:\n    this.key = 'makeABlock';\n\n    this.types = new AlignmentMorph('row', this.padding);\n    this.add(this.types);\n    this.scopes = new AlignmentMorph('row', this.padding);\n    this.add(this.scopes);\n\n    this.categories = new BoxMorph();\n    this.categories.color = SpriteMorph.prototype.paletteColor.lighter(8);\n    this.categories.borderColor = this.categories.color.lighter(40);\n    this.createCategoryButtons();\n    this.fixCategoriesLayout();\n    this.add(this.categories);\n\n    this.createTypeButtons();\n    this.createScopeButtons();\n    this.fixLayout();\n};\n\nBlockDialogMorph.prototype.prompt = function() {\n    // Trace.log('BlockTypeDialog.newBlock');\n    BlockDialogMorph.uber.prompt.apply(this, arguments);\n};\n\nBlockDialogMorph.prototype.ok = function() {\n    // Trace.log('BlockTypeDialog.ok');\n    BlockDialogMorph.uber.ok.apply(this, arguments);\n};\n\nBlockDialogMorph.prototype.cancel = function() {\n    // Trace.log('BlockTypeDialog.cancel');\n    BlockDialogMorph.uber.cancel.apply(this, arguments);\n};\n\nBlockDialogMorph.prototype.openForChange = function (\n    title,\n    category,\n    type,\n    world,\n    pic,\n    preventTypeChange // <bool>\n) {\n    // Trace.log('BlockTypeDialog.changeBlockType');\n\n    var clr = SpriteMorph.prototype.blockColor[category];\n    this.key = 'changeABlock';\n    this.category = category;\n    this.blockType = type;\n\n    this.categories.children.forEach(each =>\n        each.refresh()\n    );\n    this.types.children.forEach(each => {\n        each.setColor(clr);\n        each.refresh();\n    });\n\n    this.labelString = title;\n    this.createLabel();\n    if (pic) {this.setPicture(pic); }\n    this.addButton('ok', 'OK');\n    this.addButton('cancel', 'Cancel');\n    if (preventTypeChange) {\n        this.types.destroy();\n        this.types = null;\n    }\n    this.scopes.destroy();\n    this.scopes = null;\n    this.fixLayout();\n    this.rerender();\n    this.popUp(world);\n};\n\n// category buttons\n\nBlockDialogMorph.prototype.createCategoryButtons = function () {\n    SpriteMorph.prototype.categories.forEach(cat =>\n        this.addCategoryButton(cat)\n    );\n};\n\n// BlockDialogMorph.prototype.addCategoryButton = function (category) {\n//     var labelWidth = 75,\n//         colors = [\n//             IDE_Morph.prototype.frameColor,\n//             IDE_Morph.prototype.frameColor.darker(MorphicPreferences.isFlat ? 5 : 50),\n//             SpriteMorph.prototype.blockColor[category]\n//         ],\n//         button;\n//\n//     button = new ToggleButtonMorph(\n//         colors,\n//         this, // this block dialog box is the target\n//         () => {\n//             this.category = category;\n//             this.categories.children.forEach(each =>\n//                 each.refresh()\n//             );\n//             if (this.types) {\n//                 this.types.children.forEach(each =>\n//                     each.setColor(colors[2])\n//                 );\n//             }\n//             this.edit();\n//         },\n//         category[0].toUpperCase().concat(category.slice(1)), // UCase label\n//         () => this.category === category, // query\n//         null, // env\n//         null, // hint\n//         labelWidth, // minWidth\n//         true // has preview\n//     );\n//\n//     button.corner = 8;\n//     button.padding = 0;\n//     button.labelShadowOffset = new Point(-1, -1);\n//     button.labelShadowColor = colors[1];\n//     button.labelColor = IDE_Morph.prototype.buttonLabelColor;\n//         if (MorphicPreferences.isFlat) {\n//             button.labelPressColor = WHITE;\n//         }\n//     button.contrast = this.buttonContrast;\n//     button.fixLayout();\n//     button.refresh();\n//     this.categories.add(button);\n//     return button;\n// };\n\nBlockDialogMorph.prototype.fixCategoriesLayout = function () {\n    var buttonWidth = this.categories.children[0].width(), // all the same\n        buttonHeight = this.categories.children[0].height(), // all the same\n        xPadding = 15,\n        yPadding = 2,\n        border = 10, // this.categories.border,\n        rows =  Math.ceil((this.categories.children.length) / 2),\n        l = this.categories.left(),\n        t = this.categories.top(),\n        i = 0,\n        row,\n        col;\n\n    this.categories.children.forEach(button => {\n        i += 1;\n        row = Math.ceil(i / 2);\n        col = 2 - (i % 2);\n        button.setPosition(new Point(\n            l + (col * xPadding + ((col - 1) * buttonWidth)),\n            t + (row * yPadding + ((row - 1) * buttonHeight) + border)\n        ));\n    });\n\n    if (MorphicPreferences.isFlat) {\n        this.categories.corner = 0;\n        this.categories.border = 0;\n        this.categories.edge = 0;\n    }\n    this.categories.setExtent(new Point(\n        3 * xPadding + 2 * buttonWidth,\n        (rows + 1) * yPadding + rows * buttonHeight + 2 * border\n    ));\n};\n\n// type radio buttons\n\nBlockDialogMorph.prototype.createTypeButtons = function () {\n    var block,\n        clr = SpriteMorph.prototype.blockColor[this.category];\n\n\n    block = new CommandBlockMorph();\n    block.setColor(clr);\n    block.setSpec(localize('Command'));\n    this.addBlockTypeButton(\n        () => this.setType('command'),\n        block,\n        () => this.blockType === 'command'\n    );\n\n    block = new ReporterBlockMorph();\n    block.setColor(clr);\n    block.setSpec(localize('Reporter'));\n    this.addBlockTypeButton(\n        () => this.setType('reporter'),\n        block,\n        () => this.blockType === 'reporter'\n    );\n\n    block = new ReporterBlockMorph(true);\n    block.setColor(clr);\n    block.setSpec(localize('Predicate'));\n    this.addBlockTypeButton(\n        () => this.setType('predicate'),\n        block,\n        () => this.blockType === 'predicate'\n    );\n};\n\nBlockDialogMorph.prototype.addBlockTypeButton = function (\n    action,\n    element,\n    query\n) {\n    var button = new ToggleElementMorph(\n        this,\n        action,\n        element,\n        query,\n        null,\n        null,\n        'rebuild'\n    );\n    button.refresh();\n    button.fixLayout();\n    this.types.add(button);\n    return button;\n};\n\nBlockDialogMorph.prototype.addTypeButton = function (action, label, query) {\n    var button = new ToggleMorph(\n        'radiobutton',\n        this,\n        action,\n        label,\n        query\n    );\n    button.edge = this.buttonEdge / 2;\n    button.outline = this.buttonOutline / 2;\n    button.outlineColor = this.buttonOutlineColor;\n    button.outlineGradient = this.buttonOutlineGradient;\n    button.contrast = this.buttonContrast;\n\n    button.fixLayout();\n    this.types.add(button);\n    return button;\n};\n\nBlockDialogMorph.prototype.setType = function (blockType) {\n    this.blockType = blockType || this.blockType;\n    this.types.children.forEach(c => c.refresh());\n    this.edit();\n};\n\n// scope radio buttons\n\nBlockDialogMorph.prototype.createScopeButtons = function () {\n    this.addScopeButton(\n        () => this.setScope('global'),\n        \"for all sprites\",\n        () => this.isGlobal\n    );\n    this.addScopeButton(\n        () => this.setScope('local'),\n        \"for this sprite only\",\n        () => !this.isGlobal\n    );\n};\n\nBlockDialogMorph.prototype.addScopeButton = function (action, label, query) {\n    var button = new ToggleMorph(\n        'radiobutton',\n        this,\n        action,\n        label,\n        query\n    );\n    button.edge = this.buttonEdge / 2;\n    button.outline = this.buttonOutline / 2;\n    button.outlineColor = this.buttonOutlineColor;\n    button.outlineGradient = this.buttonOutlineGradient;\n    button.contrast = this.buttonContrast;\n\n    button.fixLayout();\n    this.scopes.add(button);\n    return button;\n};\n\n\nBlockDialogMorph.prototype.setScope = function (varType) {\n    this.isGlobal = (varType === 'global');\n    this.scopes.children.forEach(c => c.refresh());\n    this.edit();\n};\n\n// other ops\n\nBlockDialogMorph.prototype.getInput = function () {\n    var spec, def, body;\n    if (this.body instanceof InputFieldMorph) {\n        spec = this.normalizeSpaces(this.body.getValue());\n    }\n    def = new CustomBlockDefinition(spec);\n    def.type = this.blockType;\n    def.category = this.category;\n    def.isGlobal = this.isGlobal;\n    if (def.type === 'reporter' || def.type === 'predicate') {\n        body = Process.prototype.reify.call(\n            null,\n            SpriteMorph.prototype.blockForSelector('doReport'),\n            new List(),\n            true // ignore empty slots for custom block reification\n        );\n        body.outerContext = null;\n        def.body = body;\n    }\n    return def;\n};\n\nBlockDialogMorph.prototype.fixLayout = function () {\n    var th = fontHeight(this.titleFontSize) + this.titlePadding * 2;\n\n    if (this.body) {\n        this.body.setPosition(this.position().add(new Point(\n            this.padding,\n            th + this.padding\n        )));\n        this.bounds.setWidth(this.body.width() + this.padding * 2);\n        this.bounds.setHeight(\n            this.body.height()\n                + this.padding * 2\n                + th\n        );\n        if (this.categories) {\n            this.categories.setCenter(this.body.center());\n            this.categories.setTop(this.body.top());\n            this.body.setTop(this.categories.bottom() + this.padding);\n            this.bounds.setHeight(\n                this.height()\n                    + this.categories.height()\n                    + this.padding\n            );\n        }\n    } else if (this.head) { // when changing an existing prototype\n        if (this.types) {\n            this.types.fixLayout();\n            this.bounds.setWidth(\n                Math.max(this.types.width(), this.head.width())\n                    + this.padding * 2\n            );\n        } else {\n            this.bounds.setWidth(\n                Math.max(this.categories.width(), this.head.width())\n                    + this.padding * 2\n            );\n        }\n        this.head.setCenter(this.center());\n        this.head.setTop(th + this.padding);\n        this.bounds.setHeight(\n            this.head.height()\n                + this.padding * 2\n                + th\n        );\n        if (this.categories) {\n            this.categories.setCenter(this.center());\n            this.categories.setTop(this.head.bottom() + this.padding);\n            this.bounds.setHeight(\n                this.height()\n                    + this.categories.height()\n                    + this.padding\n            );\n        }\n    }\n\n    if (this.label) {\n        this.label.setCenter(this.center());\n        this.label.setTop(this.top() + (th - this.label.height()) / 2);\n    }\n\n    if (this.types) {\n        this.types.fixLayout();\n        this.bounds.setHeight(\n            this.height()\n                    + this.types.height()\n                    + this.padding\n        );\n        this.bounds.setWidth(Math.max(\n            this.width(),\n            this.types.width() + this.padding * 2\n        ));\n        this.types.setCenter(this.center());\n        if (this.body) {\n            this.types.setTop(this.body.bottom() + this.padding);\n        } else if (this.categories) {\n            this.types.setTop(this.categories.bottom() + this.padding);\n        }\n    }\n\n    if (this.scopes) {\n        this.scopes.fixLayout();\n        this.bounds.setHeight(\n            this.height()\n                    + this.scopes.height()\n                    + (this.padding / 3)\n        );\n        this.bounds.setWidth(Math.max(\n            this.width(),\n            this.scopes.width() + this.padding * 2\n        ));\n        this.scopes.setCenter(this.center());\n        if (this.types) {\n            this.scopes.setTop(this.types.bottom() + (this.padding / 3));\n        }\n    }\n\n    if (this.buttons && (this.buttons.children.length > 0)) {\n        this.buttons.fixLayout();\n        this.bounds.setHeight(\n            this.height()\n                    + this.buttons.height()\n                    + this.padding\n        );\n        this.buttons.setCenter(this.center());\n        this.buttons.setBottom(this.bottom() - this.padding);\n    }\n\n    // refresh a shallow shadow\n    this.removeShadow();\n    this.addShadow();\n};\n\nBlockDialogMorph.prototype.accept = function () {\n    if ((this.body instanceof InputFieldMorph) &&\n            (this.normalizeSpaces(this.body.getValue()) === '')) {\n        this.edit();\n    } else {\n        BlockDialogMorph.uber.accept.call(this);\n    }\n};\n\n// BlockEditorMorph ////////////////////////////////////////////////////\n\n// BlockEditorMorph inherits from DialogBoxMorph:\n//\n// BlockEditorMorph.prototype = new DialogBoxMorph();\n// BlockEditorMorph.prototype.constructor = BlockEditorMorph;\n// BlockEditorMorph.uber = DialogBoxMorph.prototype;\n//\n// // Keep track of the currently showing block editors\n// BlockEditorMorph.showing = [];\n//\n// // BlockEditorMorph instance creation:\n//\n// export function BlockEditorMorph(definition, target) {\n//     this.init(definition, target);\n// }\n//\n// BlockEditorMorph.prototype.ok = function() {\n//     // Trace.log('BlockEditor.ok', this.getDefinitionJSON());\n//     BlockEditorMorph.uber.ok.apply(this, arguments);\n// };\n//\n// BlockEditorMorph.prototype.destroy = function() {\n//     BlockEditorMorph.uber.destroy.apply(this, arguments);\n//     var index = BlockEditorMorph.showing.indexOf(this);\n//     if (index >= 0) {\n//         BlockEditorMorph.showing.splice(index, 1);\n//     }\n// };\n//\n// BlockEditorMorph.defaultHatBlockMargin = new Point(10, 10);\n//\n// BlockEditorMorph.prototype.getDefinitionJSON = function() {\n//     var definition = this.definition;\n//     return definition ? {\n//         'spec': definition.spec,\n//         'category': definition.category,\n//         'type': definition.type,\n//         'guid': definition.guid,\n//     } : null;\n// };\n//\n// BlockEditorMorph.prototype.init = function (definition, target) {\n//     var scripts, proto, scriptsFrame, block, comment,\n//         isLive = Process.prototype.enableLiveCoding ||\n//             Process.prototype.enableSingleStepping;\n//\n//     // additional properties:\n//     this.definition = definition;\n//     this.translations = definition.translationsAsText();\n//     this.handle = null;\n//\n//     // Trace.log('BlockEditor.start', this.getDefinitionJSON());\n//\n//     // initialize inherited properties:\n//     BlockEditorMorph.uber.init.call(\n//         this,\n//         target,\n//         () => this.updateDefinition(),\n//         target\n//     );\n//\n//     // override inherited properites:\n//     this.key = 'editBlock' + definition.spec;\n//     this.labelString = this.definition.isGlobal ? 'Block Editor'\n//     \t\t: 'Method Editor';\n//     this.createLabel();\n//\n//     // Copy IDs when copying blocks, rather than making new block IDs\n//     // as we would do for duplicating a block\n//     BlockMorph.copyIDs = true;\n//\n//     // create scripting area\n//     scripts = new ScriptsMorph();\n//     scripts.rejectsHats = true;\n//     scripts.isDraggable = false;\n//     scripts.color = IDE_Morph.prototype.groupColor;\n//     scripts.cachedTexture = IDE_Morph.prototype.scriptsPaneTexture;\n//     scripts.cleanUpMargin = 10;\n//\n//     proto = new PrototypeHatBlockMorph(this.definition);\n//     proto.setPosition(scripts.position().add(\n//         BlockEditorMorph.defaultHatBlockMargin));\n//     if (definition.comment !== null) {\n//         comment = definition.comment.fullCopy();\n//         proto.comment = comment;\n//         comment.block = proto;\n//     }\n//     if (definition.body !== null) {\n//         proto.nextBlock(isLive ? definition.body.expression\n//                 : definition.body.expression.fullCopy()\n//         );\n//     }\n//     scripts.add(proto);\n//     proto.fixBlockColor(null, true);\n//\n//     this.definition.scripts.forEach(element => {\n//         block = element.fullCopy();\n//         block.setPosition(scripts.position().add(element.position()));\n//         scripts.add(block);\n//         if (block instanceof BlockMorph) {\n//             block.allComments().forEach(comment =>\n//                 comment.align(block)\n//             );\n//         }\n//     });\n//     proto.allComments().forEach(comment =>\n//         comment.align(proto)\n//     );\n//\n//     // Make sure to disable block ID copying\n//     BlockMorph.copyIDs = false;\n//\n//     scriptsFrame = new ScrollFrameMorph(scripts);\n//     scriptsFrame.padding = 10;\n//     scriptsFrame.growth = 50;\n//     scriptsFrame.isDraggable = false;\n//     scriptsFrame.acceptsDrops = false;\n//     scriptsFrame.contents.acceptsDrops = true;\n//     scripts.scrollFrame = scriptsFrame;\n//     scripts.updateToolbar();\n//\n//     this.addBody(scriptsFrame);\n//     this.addButton('ok', 'OK');\n//     if (!isLive) {\n//         this.addButton('updateDefinition', 'Apply');\n//         this.addButton('cancel', 'Cancel');\n//     }\n//\n//     this.setExtent(new Point(400, 350).add(\n//         BlockEditorMorph.defaultHatBlockMargin)); // normal initial extent\n//     this.fixLayout();\n//     scripts.fixMultiArgs();\n//\n//     block = proto.parts()[0];\n//     block.forceNormalColoring();\n//     block.fixBlockColor(proto, true);\n// };\n//\n// BlockEditorMorph.prototype.popUp = function () {\n//     var world = this.target.world();\n//\n//     // Add this to the list of showing blockEditorMorphs\n//     BlockEditorMorph.showing.push(this);\n//\n//     if (world) {\n//         BlockEditorMorph.uber.popUp.call(this, world);\n//         this.setInitialDimensions();\n//         this.handle = new HandleMorph(\n//             this,\n//             280,\n//             220,\n//             this.corner,\n//             this.corner\n//         );\n//         world.keyboardFocus = null;\n//     }\n// };\n//\n// BlockEditorMorph.prototype.justDropped = function () {\n//     // override the inherited default behavior, which is to\n//     // give keyboard focus to dialog boxes, as in this case\n//     // we want Snap-global keyboard-shortcuts like ctrl-f\n//     // to still work\n//     nop();\n// };\n//\n// // BlockEditorMorph ops\n//\n// BlockEditorMorph.prototype.accept = function (origin) {\n//     // check DialogBoxMorph comment for accept()\n//     if (origin instanceof CursorMorph) {return; }\n//     if (this.action) {\n//         if (typeof this.target === 'function') {\n//             if (typeof this.action === 'function') {\n//                 this.target.call(this.environment, this.action.call());\n//             } else {\n//                 this.target.call(this.environment, this.action);\n//             }\n//         } else {\n//             if (typeof this.action === 'function') {\n//                 this.action.call(this.target, this.getInput());\n//             } else { // assume it's a String\n//                 this.target[this.action](this.getInput());\n//             }\n//         }\n//     }\n//     this.close();\n// };\n//\n// BlockEditorMorph.prototype.cancel = function (origin) {\n//     if (origin instanceof CursorMorph) {return; }\n//     // Trace.log('BlockEditor.cancel', this.getDefinitionJSON());\n//     //this.refreshAllBlockInstances();\n//     this.close();\n// };\n//\n// BlockEditorMorph.prototype.close = function () {\n//     var doubles, block;\n//\n//     // assert that no scope conflicts exists, i.e. that a global\n//     // definition doesn't contain any local custom blocks, as they\n//     // will be rendered \"Obsolete!\" when reloading the project\n//     if (this.definition.isGlobal) {\n//         block = detect(\n//             this.body.contents.allChildren(),\n//             morph => morph.isCustomBlock && !morph.isGlobal\n//         );\n//         if (block) {\n//             block = block.scriptTarget()\n//                 .getMethod(block.semanticSpec)\n//                 .blockInstance();\n//             block.addShadow();\n//             new DialogBoxMorph().inform(\n//                 'Local Block(s) in Global Definition',\n//                 'This global block definition contains one or more\\n'\n//                     + 'local custom blocks which must be removed first.',\n//                 this.world(),\n//                 block.doWithAlpha(1, () => block.fullImage())\n//             );\n//             return;\n//         }\n//     }\n//\n//     // allow me to disappear only when name collisions\n//     // have been resolved\n//     doubles = this.target.doubleDefinitionsFor(this.definition);\n//     if (doubles.length > 0) {\n//         block = doubles[0].blockInstance();\n//         block.addShadow();\n//         new DialogBoxMorph(this, 'consolidateDoubles', this).askYesNo(\n//             'Same Named Blocks',\n//             'Another custom block with this name exists.\\n'\n//                 + 'Would you like to replace it?',\n//             this.world(),\n//             block.doWithAlpha(1, () => block.fullImage())\n//         );\n//         return;\n//     }\n//\n//     this.destroy();\n//     this.deduplicateBlockIDs();\n// };\n//\n// BlockEditorMorph.prototype.consolidateDoubles = function () {\n//     this.target.replaceDoubleDefinitionsFor(this.definition);\n//     this.deduplicateBlockIDs();\n//     this.destroy();\n// };\n//\n// BlockEditorMorph.prototype.refreshAllBlockInstances = function (oldSpec) {\n//     var def = this.definition,\n//         template = this.target.paletteBlockInstance(def);\n//\n//     if (this.definition.isGlobal) {\n//         this.target.allBlockInstances(this.definition).reverse().forEach(\n//             block => block.refresh()\n//         );\n//     } else {\n//         this.target.allDependentInvocationsOf(oldSpec).reverse().forEach(\n//             block => block.refresh(def)\n//         );\n//     }\n//     if (template) {\n//         template.refreshDefaults();\n//     }\n// };\n//\n// // It is possible for blocks to get duplicated by dragging them out of a block\n// // editor and then cancelling the edit. This checks for any duplicate block IDs\n// // in the just-closed block definition and then assigns new IDs to those blocks.\n// BlockEditorMorph.prototype.deduplicateBlockIDs = function() {\n//     var definition = this.definition;\n//     function findBlockIDs(root, array) {\n//         array = array || [];\n//         // Ignore any children of this definition\n//         if (root == definition || root == null) return array;\n//         if (root instanceof BlockMorph) array.push(root.id);\n//         // Include custom block definitions in Sprites and the Stage\n//         if (root instanceof SpriteMorph) findBlockIDs(root.customBlocks);\n//         if (root instanceof StageMorph) findBlockIDs(root.globalBlocks);\n//         var children = root.children || root;\n//         if (!(children instanceof Array)) return array;\n//         children.forEach(function(child) {\n//             if (child instanceof Morph) {\n//                 findBlockIDs(child, array);\n//             }\n//         });\n//         return array;\n//     }\n//     var blockIDs = findBlockIDs(this.root());\n//\n//     var scripts = definition.scripts.slice();\n//     if (this.definition.body) scripts.push(this.definition.body.expression);\n//     scripts.forEach(function(script) {\n//         if (script == null || !script.allChildren) return;\n//         script.allChildren().forEach(function(block) {\n//             if (!(block instanceof BlockMorph)) return;\n//             if (blockIDs.includes(block.id)) block.getNewID();\n//         });\n//     });\n// };\n//\n// BlockEditorMorph.prototype.updateDefinition = function () {\n//     // Trace.log('BlockEditor.apply', this.getDefinitionJSON());\n//     var oldSpec = this.definition.blockSpec();\n//     this.applyToDefinition(this.definition);\n//     this.refreshAllBlockInstances(oldSpec);\n//     ide = this.target.parentThatIsA(IDE_Morph);\n//     ide.flushPaletteCache();\n//     ide.refreshPalette();\n// };\n//\n// // We want to be able to apply the edits represented in this editor to an\n// // arbitrary block definition (e.g. a copy of the original), mainly for\n// // logging purposes.\n// BlockEditorMorph.prototype.applyToDefinition = function (definition) {\n//     var head,\n//         pos = this.body.contents.position(),\n//         count = 1,\n//         element;\n//\n//     // Copy IDs when copying blocks, rather than making new block IDs\n//     // as we would do for duplicating a block\n//     BlockMorph.copyIDs = true;\n//\n//     definition.receiver = this.target; // only for serialization\n//     definition.spec = this.prototypeSpec();\n//     definition.declarations = this.prototypeSlots();\n//     definition.variableNames = this.variableNames();\n//     definition.scripts = [];\n//     definition.updateTranslations(this.translations);\n//     definition.cachedTranslation = null;\n//     definition.editorDimensions = this.bounds.copy();\n//     definition.cachedIsRecursive = null; // flush the cache, don't update\n//\n//     this.body.contents.children.forEach(morph => {\n//         if (morph instanceof PrototypeHatBlockMorph) {\n//             head = morph;\n//         } else if (morph instanceof BlockMorph ||\n//                 (morph instanceof CommentMorph && !morph.block)) {\n//             element = morph.fullCopy();\n//             element.parent = null;\n//             element.setPosition(morph.position().subtract(pos));\n//             definition.scripts.push(element);\n//         }\n//     });\n//\n//     if (head) {\n//         if (definition.category !== head.blockCategory) {\n//             this.target.shadowAttribute('scripts');\n//         }\n//         definition.category = head.blockCategory;\n//         definition.type = head.type;\n//         if (head.comment) {\n//             definition.comment = head.comment.fullCopy();\n//             definition.comment.block = true; // serialize in short form\n//         } else {\n//             definition.comment = null;\n//         }\n//     }\n//\n//     definition.body = this.context(head);\n//\n//     // Make sure to turn copying IDs off when finished\n//     BlockMorph.copyIDs = false;\n//\n//     // make sure the spec is unique\n//     while (this.target.doubleDefinitionsFor(this.definition).length > 0) {\n//         count += 1;\n//         this.definition.spec = this.definition.spec + ' (' + count + ')';\n//     }\n// };\n//\n// BlockEditorMorph.prototype.context = function (prototypeHat) {\n//     // answer my script reified for deferred execution\n//     // if no prototypeHat is given, my body is scanned\n//     var head, topBlock, stackFrame;\n//\n//     head = prototypeHat || detect(\n//         this.body.contents.children,\n//         c => c instanceof PrototypeHatBlockMorph\n//     );\n//     topBlock = head.nextBlock();\n//     if (topBlock === null) {\n//         return null;\n//     }\n//     topBlock.allChildren().forEach(c => {\n//         if (c instanceof BlockMorph) {c.cachedInputs = null; }\n//     });\n//     stackFrame = Process.prototype.reify.call(\n//         null,\n//         topBlock,\n//         new List(this.definition.inputNames()),\n//         true // ignore empty slots for custom block reification\n//     );\n//     stackFrame.outerContext = null;\n//     return stackFrame;\n// };\n//\n// BlockEditorMorph.prototype.prototypeSpec = function () {\n//     // answer the spec represented by my (edited) block prototype\n//     return detect(\n//         this.body.contents.children,\n//         c => c instanceof PrototypeHatBlockMorph\n//     ).parts()[0].specFromFragments();\n// };\n//\n// BlockEditorMorph.prototype.prototypeSlots = function () {\n//     // answer the slot declarations from my (edited) block prototype\n//     return detect(\n//         this.body.contents.children,\n//         c => c instanceof PrototypeHatBlockMorph\n//     ).parts()[0].declarationsFromFragments();\n// };\n//\n// BlockEditorMorph.prototype.variableNames = function () {\n//     // answer the variable declarations from my prototype hat\n//     return detect(\n//         this.body.contents.children,\n//         c => c instanceof PrototypeHatBlockMorph\n//     ).variableNames();\n// };\n//\n// // BlockEditorMorph translation\n//\n// BlockEditorMorph.prototype.editTranslations = function () {\n//     var block = this.definition.blockInstance();\n//     block.addShadow(new Point(3, 3));\n//     new DialogBoxMorph(\n//         this,\n//         text => this.translations = text,\n//         this\n//     ).promptCode(\n//         'Custom Block Translations',\n//         this.translations,\n//         this.world(),\n//         block.doWithAlpha(1, () => block.fullImage()),\n//         this.definition.abstractBlockSpec() +\n//             '\\n\\n' +\n//             localize('Enter one translation per line. ' +\n//                 'use colon (\":\") as lang/spec delimiter\\n' +\n//                 'and underscore (\"_\") as placeholder for an input, ' +\n//                 'e.g.:\\n\\nen:say _ for _ secs')\n//     );\n// };\n//\n// // BlockEditorMorph layout\n//\n// BlockEditorMorph.prototype.setInitialDimensions = function () {\n//     var world = this.world(),\n//         mex = world.extent().subtract(new Point(this.padding, this.padding)),\n//         th = fontHeight(this.titleFontSize) + this.titlePadding * 2,\n//         bh = this.buttons.height();\n//\n//     if (this.definition.editorDimensions) {\n//         this.setPosition(this.definition.editorDimensions.origin);\n//         this.setExtent(this.definition.editorDimensions.extent().min(mex));\n//         this.keepWithin(world);\n//         return;\n//     }\n//     this.setExtent(\n//         this.body.contents.extent().add(\n//             new Point(this.padding, this.padding + th + bh)\n//         ).min(mex)\n//     );\n//     this.setCenter(this.world().center());\n// };\n//\n// BlockEditorMorph.prototype.fixLayout = function () {\n//     var th = fontHeight(this.titleFontSize) + this.titlePadding * 2;\n//\n//     if (this.buttons && (this.buttons.children.length > 0)) {\n//         this.buttons.fixLayout();\n//     }\n//\n//     if (this.body) {\n//         this.body.setPosition(this.position().add(new Point(\n//             this.padding,\n//             th + this.padding\n//         )));\n//         this.body.setExtent(new Point(\n//             this.width() - this.padding * 2,\n//             this.height() - this.padding * 3 - th - this.buttons.height()\n//         ));\n//     }\n//\n//     if (this.label) {\n//         this.label.setCenter(this.center());\n//         this.label.setTop(this.top() + (th - this.label.height()) / 2);\n//     }\n//\n//     if (this.buttons && (this.buttons.children.length > 0)) {\n//         this.buttons.setCenter(this.center());\n//         this.buttons.setBottom(this.bottom() - this.padding);\n//     }\n//\n//     // refresh a shallow shadow\n//     this.removeShadow();\n//     this.addShadow();\n// };\n\n// PrototypeHatBlockMorph /////////////////////////////////////////////\n\n// PrototypeHatBlockMorph inherits from HatBlockMorph:\n\nPrototypeHatBlockMorph.prototype = new HatBlockMorph();\nPrototypeHatBlockMorph.prototype.constructor = PrototypeHatBlockMorph;\nPrototypeHatBlockMorph.uber = HatBlockMorph.prototype;\n\n// PrototypeHatBlockMorph instance creation:\n\nexport function PrototypeHatBlockMorph(definition) {\n    this.init(definition);\n}\n\nPrototypeHatBlockMorph.prototype.init = function (definition) {\n    var proto = definition.prototypeInstance(),\n        vars;\n\n    this.definition = definition;\n\n    // additional attributes to store edited data\n    this.blockCategory = definition ? definition.category : null;\n    this.type = definition ? definition.type : null;\n\n    // init inherited stuff\n    HatBlockMorph.uber.init.call(this);\n    this.color = SpriteMorph.prototype.blockColor.control;\n    this.category = 'control';\n    this.add(proto);\n    if (definition.variableNames.length) {\n        vars = this.labelPart('%blockVars');\n        this.add(this.labelPart('%br'));\n        this.add(vars);\n        definition.variableNames.forEach(name =>\n            vars.addInput(name)\n        );\n    }\n    proto.refreshPrototypeSlotTypes(); // show slot type indicators\n    this.fixLayout();\n    proto.fixBlockColor(this, true);\n};\n\nPrototypeHatBlockMorph.prototype.mouseClickLeft = function () {\n    // relay the mouse click to my prototype block to\n    // pop-up a Block Dialog, unless the shift key\n    // is pressed, in which case initiate keyboard\n    // editing support\n\n    if (this.world().currentKey === 16) { // shift-clicked\n        return this.focus();\n    }\n    this.parts()[0].mouseClickLeft();\n};\n\nPrototypeHatBlockMorph.prototype.userMenu = function () {\n    return this.parts()[0].userMenu();\n};\n\n// PrototypeHatBlockMorph zebra coloring\n\nPrototypeHatBlockMorph.prototype.fixBlockColor = function (\n    nearestBlock,\n    isForced\n) {\n    var nearest = this.parts()[0] || nearestBlock;\n\n    if (!this.zebraContrast && !isForced) {\n        return;\n    }\n    if (!this.zebraContrast && isForced) {\n        return this.forceNormalColoring();\n    }\n\n    if (nearest.category === this.category) {\n        if (nearest.color.eq(this.color)) {\n            this.alternateBlockColor();\n        }\n    } else if (this.category && !this.color.eq(\n            SpriteMorph.prototype.blockColor[this.category]\n        )) {\n        this.alternateBlockColor();\n    }\n    if (isForced) {\n        this.fixChildrensBlockColor(true);\n    }\n};\n\n// PrototypeHatBlockMorph block instance variables\n\nPrototypeHatBlockMorph.prototype.variableNames = function (choice) {\n    var parts = this.parts();\n    if (parts.length < 3) {return []; }\n    return parts[2].evaluate();\n};\n\nPrototypeHatBlockMorph.prototype.enableBlockVars = function (choice) {\n    var prot = this.parts()[0];\n    if (choice === false) {\n        this.setSpec('%s', true);\n    } else {\n        this.setSpec('%s %br %blockVars', true);\n    }\n    this.replaceInput(this.parts()[0], prot);\n    this.spec = null;\n};\n\n// BlockLabelFragment //////////////////////////////////////////////////\n\n// BlockLabelFragment instance creation:\n\nexport function BlockLabelFragment(labelString) {\n    this.labelString = labelString || '';\n    this.type = '%s';    // null for label, a spec for an input\n    this.defaultValue = '';\n    this.options = '';\n    this.isReadOnly = false; // for input slots\n    this.isDeleted = false;\n}\n\n// accessing\n\nBlockLabelFragment.prototype.defSpecFragment = function () {\n    // answer a string representing my prototype's spec\n    var pref = this.type ? '%\\'' : '';\n    return this.isDeleted ?\n            '' : pref + this.labelString + (this.type ? '\\'' : '');\n};\n\nBlockLabelFragment.prototype.defTemplateSpecFragment = function () {\n    // answer a string representing my prototype's spec\n    // which also indicates my type, default value or arity\n    var suff = '';\n    if (!this.type) {return this.defSpecFragment(); }\n    if (this.isUpvar()) {\n        suff = ' \\u2191';\n    } else if (this.isMultipleInput()) {\n        suff = '...';\n    } else if (this.type === '%cs' || this.type === '%ca') {\n        suff = ' \\u03BB'; // ' [\\u03BB'\n    } else if (this.type === '%b') {\n        suff = ' ?';\n    } else if (this.type === '%l') {\n        suff = ' \\uFE19';\n    } else if (this.type === '%obj') {\n        suff = ' %turtleOutline';\n    } else if (contains(\n            ['%cmdRing', '%repRing', '%predRing', '%anyUE', '%boolUE'],\n            this.type\n        )) {\n        suff = ' \\u03BB';\n    } else if (this.defaultValue) {\n        if (this.type === '%n') {\n            suff = ' # = ' + this.defaultValue.toString();\n        } else if (contains(['%mlt', '%code'], this.type)) {\n            suff = ' \\u00B6 = ' + this.defaultValue.toString(); // pilcrow\n        } else { // 'any' or 'text'\n            suff = ' = ' + this.defaultValue.toString();\n        }\n    } else if (this.type === '%n') {\n        suff = ' #';\n    } else if (contains(['%mlt', '%code'], this.type)) {\n        suff = ' \\u00B6'; // pilcrow\n    }\n    return this.labelString + suff;\n};\n\nBlockLabelFragment.prototype.blockSpecFragment = function () {\n    // answer a string representing my block spec\n    return this.isDeleted ? '' : this.type || this.labelString;\n};\n\nBlockLabelFragment.prototype.copy = function () {\n    var ans = new BlockLabelFragment(this.labelString);\n    ans.type = this.type;\n    ans.defaultValue = this.defaultValue;\n    ans.options = this.options;\n    ans.isReadOnly = this.isReadOnly;\n    return ans;\n};\n\n// options and special drop-down menus\n\nBlockLabelFragment.prototype.hasOptions = function () {\n    return this.options !== '' && !this.hasSpecialMenu();\n};\n\nBlockLabelFragment.prototype.hasSpecialMenu = function () {\n    return contains(\n        [\n            '_messagesMenu',\n            '_messagesReceivedMenu',    //for backward (5.0.0 - 5.0.3) support\n            '_objectsMenu',\n            '_costumesMenu',\n            '_soundsMenu',\n            '_getVarNamesDict',\n            '_pianoKeyboardMenu',\n            '_directionDialMenu'\n        ],\n        this.options\n    );\n};\n\n// arity\n\nBlockLabelFragment.prototype.isSingleInput = function () {\n    return !this.isMultipleInput() &&\n        (this.type !== '%upvar');\n};\n\nBlockLabelFragment.prototype.isMultipleInput = function () {\n    // answer true if the type begins with '%mult'\n    if (!this.type) {\n        return false; // not an input at all\n    }\n    return this.type.indexOf('%mult') > -1;\n};\n\nBlockLabelFragment.prototype.isUpvar = function () {\n    if (!this.type) {\n        return false; // not an input at all\n    }\n    return this.type === '%upvar';\n};\n\nBlockLabelFragment.prototype.setToSingleInput = function () {\n    if (!this.type) {return null; } // not an input at all\n    if (this.type === '%upvar') {\n        this.type = '%s';\n    } else {\n        this.type = this.singleInputType();\n    }\n};\n\nBlockLabelFragment.prototype.setToMultipleInput = function () {\n    if (!this.type) {return null; } // not an input at all\n    if (this.type === '%upvar') {\n        this.type = '%s';\n    } else if (this.type === '%ca') {\n        this.type = '%cs';\n    }\n    this.type = '%mult'.concat(this.singleInputType());\n};\n\nBlockLabelFragment.prototype.setToUpvar = function () {\n    if (!this.type) {return null; } // not an input at all\n    this.type = '%upvar';\n};\n\nBlockLabelFragment.prototype.singleInputType = function () {\n    // answer the type of my input withtou any preceding '%mult'\n    if (!this.type) {\n        return null; // not an input at all\n    }\n    if (this.isMultipleInput()) {\n        return this.type.substr(5); // everything following '%mult'\n    }\n    return this.type;\n};\n\nBlockLabelFragment.prototype.setSingleInputType = function (type) {\n    if (!this.type || !this.isMultipleInput()) {\n        this.type = type;\n    } else {\n        this.type = '%mult'.concat(type);\n    }\n};\n\n// BlockLabelFragmentMorph ///////////////////////////////////////////////\n\n/*\n    I am a single word in a custom block prototype's label. I can be clicked\n    to edit my contents and to turn me into an input placeholder.\n*/\n\n// BlockLabelFragmentMorph inherits from StringMorph:\n\nBlockLabelFragmentMorph.prototype = new StringMorph();\nBlockLabelFragmentMorph.prototype.constructor = BlockLabelFragmentMorph;\nBlockLabelFragmentMorph.uber = StringMorph.prototype;\n\n// BlockLabelFragmentMorph instance creation:\n\nexport function BlockLabelFragmentMorph(text) {\n    this.init(text);\n}\n\nBlockLabelFragmentMorph.prototype.init = function (text) {\n    this.fragment = new BlockLabelFragment(text);\n    this.fragment.type = null;\n    this.sO = null; // temporary backup for shadowOffset\n    BlockLabelFragmentMorph.uber.init.call(\n        this,\n        text,\n        null, // font size\n        SyntaxElementMorph.prototype.labelFontStyle,\n        null, // bold\n        null, // italic\n        null, // numeric\n        null, // shadow offset\n        null, // shadow color\n        null, // color\n        SyntaxElementMorph.prototype.labelFontName\n    );\n};\n\n// BlockLabelFragmentMorph events:\n\nBlockLabelFragmentMorph.prototype.mouseEnter = function () {\n    this.sO = this.shadowOffset;\n    this.shadowOffset = this.sO.neg();\n    this.fixLayout();\n    this.rerender();\n};\n\nBlockLabelFragmentMorph.prototype.mouseLeave = function () {\n    this.shadowOffset = this.sO;\n    this.fixLayout();\n    this.rerender();\n};\n\nBlockLabelFragmentMorph.prototype.mouseClickLeft = function () {\n/*\n    make a copy of my fragment object and open an InputSlotDialog on it.\n    If the user acknowledges the DialogBox, assign the - edited - copy\n    of the fragment object to be my new fragment object and update the\n    custom block'label (the prototype in the block editor). Do not yet update\n    the definition and every block instance, as this happens only after\n    the user acknowledges and closes the block editor\n*/\n    var frag = this.fragment.copy(),\n        isPlaceHolder = this instanceof BlockLabelPlaceHolderMorph,\n        isOnlyElement = this.parent.parseSpec(this.parent.blockSpec).length\n            < 2;\n\n    new InputSlotDialogMorph(\n        frag,\n        null,\n        () => this.updateBlockLabel(frag),\n        this,\n        this.parent.definition.category\n    ).open(\n        this instanceof BlockLabelFragmentMorph ?\n                'Edit label fragment' :\n                isPlaceHolder ? 'Create input name' : 'Edit input name',\n        frag.labelString,\n        this.world(),\n        null,\n        isPlaceHolder || isOnlyElement\n    );\n};\n\nBlockLabelFragmentMorph.prototype.updateBlockLabel = function (newFragment) {\n    // Trace.log('BlockEditor.updateBlockLabel', newFragment);\n    var prot = this.parentThatIsA(BlockMorph);\n    this.fragment = newFragment;\n    if (prot) {\n        prot.refreshPrototype();\n    }\n};\n\nBlockLabelFragmentMorph.prototype.userMenu = function () {\n    // show a menu of built-in special symbols\n    var symbolColor = new Color(100, 100, 130),\n        menu = new MenuMorph(\n            (string) => {\n                var tuple = this.text.split('-');\n                this.changed();\n                tuple[0] = '$' + string;\n                this.text = tuple.join('-');\n                this.fragment.labelString = this.text;\n                this.parent.parent.changed();\n                this.fixLayout();\n                this.parent.parent.fixLayout();\n                this.parent.parent.changed();\n            },\n            null,\n            this,\n            this.fontSize\n        );\n    SymbolMorph.prototype.names.forEach(name =>\n        menu.addItem(\n            [new SymbolMorph(name, menu.fontSize, symbolColor), localize(name)],\n            name\n        )\n    );\n    menu.addLine();\n    menu.addItem('\\u23CE ' + localize('new line'), 'nl');\n    return menu;\n};\n\n// BlockLabelPlaceHolderMorph ///////////////////////////////////////////////\n\n/*\n    I am a space between words or inputs in a custom block prototype's label.\n    When I am moused over I display a plus sign on a colored background\n    circle. I can be clicked to add a new word or input to the prototype.\n*/\n\n// BlockLabelPlaceHolderMorph inherits from StringMorph:\n\nBlockLabelPlaceHolderMorph.prototype = new StringMorph();\nBlockLabelPlaceHolderMorph.prototype.constructor = BlockLabelPlaceHolderMorph;\nBlockLabelPlaceHolderMorph.uber = StringMorph.prototype;\n\n// BlockLabelPlaceHolderMorph preferences settings\n\nBlockLabelPlaceHolderMorph.prototype.plainLabel = false; // always show (+)\n\n// BlockLabelPlaceHolderMorph instance creation:\n\nexport function BlockLabelPlaceHolderMorph() {\n    this.init();\n}\n\nBlockLabelPlaceHolderMorph.prototype.init = function () {\n    this.fragment = new BlockLabelFragment('');\n    this.fragment.type = '%s';\n    this.fragment.isDeleted = true;\n    this.isHighlighted = false;\n    this.isProtectedLabel = true; // doesn't participate in zebra coloring\n    BlockLabelFragmentMorph.uber.init.call(this, '+');\n};\n\n// BlockLabelPlaceHolderMorph drawing\n\nBlockLabelPlaceHolderMorph.prototype.fixLayout = function () {\n    // set my text contents depending on the \"plainLabel\" flag\n    if (this.plainLabel) {\n        this.text = this.isHighlighted ? ' + ' : '';\n    }\n\n    // determine my extent\n    this.measureCtx.font = this.font();\n    this.bounds.corner = this.bounds.origin.add(\n        new Point(\n            Math.max(\n                this.measureCtx.measureText(this.text).width,\n                SyntaxElementMorph.prototype.scale\n            ),\n            fontHeight(this.fontSize)\n        )\n    );\n\n    // notify my parent of layout change - move to fixLayout()\n    if (this.parent) {\n        if (this.parent.fixLayout) {\n            this.parent.fixLayout();\n        }\n        if (this.parent.parent instanceof PrototypeHatBlockMorph) {\n            this.parent.parent.fixLayout();\n        }\n    }\n};\n\nBlockLabelPlaceHolderMorph.prototype.render = function (ctx) {\n    var cx, cy;\n\n    // draw background, if any\n    if (this.isHighlighted) {\n        cx = this.width() / 2;\n        cy = this.height() / 2;\n        ctx.fillStyle = this.color.toString();\n        ctx.beginPath();\n        ctx.arc(\n            cx,\n            cy * 1.2,\n            Math.min(cx, cy),\n            radians(0),\n            radians(360),\n            false\n        );\n        ctx.closePath();\n        ctx.fill();\n    }\n\n    // prepare context for drawing text\n    ctx.font = this.font();\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'bottom';\n\n    // now draw the actual text\n    ctx.fillStyle = this.isHighlighted ? 'white' : this.color.toString();\n    ctx.fillText(this.text, 0, fontHeight(this.fontSize));\n};\n\n// BlockLabelPlaceHolderMorph events:\n\nBlockLabelPlaceHolderMorph.prototype.mouseEnter = function () {\n    var hat = this.parentThatIsA(PrototypeHatBlockMorph);\n    this.isHighlighted = true;\n    if (this.plainLabel && hat) {\n        hat.changed();\n        this.fixLayout();\n        hat.changed();\n    } else {\n        this.fixLayout();\n        this.rerender();\n    }\n};\n\nBlockLabelPlaceHolderMorph.prototype.mouseLeave = function () {\n    var hat = this.parentThatIsA(PrototypeHatBlockMorph);\n    this.isHighlighted = false;\n    if (this.plainLabel && hat) {\n        hat.changed();\n        this.fixLayout();\n        hat.changed();\n    } else {\n        this.fixLayout();\n        this.rerender();\n    }\n};\n\nBlockLabelPlaceHolderMorph.prototype.mouseClickLeft\n    = BlockLabelFragmentMorph.prototype.mouseClickLeft;\n\nBlockLabelPlaceHolderMorph.prototype.updateBlockLabel\n    = BlockLabelFragmentMorph.prototype.updateBlockLabel;\n\n// BlockInputFragmentMorph ///////////////////////////////////////////////\n\n/*\n    I am a variable blob in a custom block prototype's label. I can be clicked\n    to edit my contents and to turn me into an part of the block's label text.\n*/\n\n// BlockInputFragmentMorph inherits from TemplateSlotMorph:\n\nBlockInputFragmentMorph.prototype = new TemplateSlotMorph();\nBlockInputFragmentMorph.prototype.constructor = BlockInputFragmentMorph;\nBlockInputFragmentMorph.uber = TemplateSlotMorph.prototype;\n\n// BlockInputFragmentMorph instance creation:\n\nexport function BlockInputFragmentMorph(text) {\n    this.init(text);\n}\n\nBlockInputFragmentMorph.prototype.init = function (text) {\n    this.fragment = new BlockLabelFragment(text);\n    this.fragment.type = '%s';\n    BlockInputFragmentMorph.uber.init.call(this, text);\n};\n\n// BlockInputFragmentMorph events:\n\nBlockInputFragmentMorph.prototype.mouseClickLeft\n    = BlockLabelFragmentMorph.prototype.mouseClickLeft;\n\nBlockInputFragmentMorph.prototype.updateBlockLabel\n    = BlockLabelFragmentMorph.prototype.updateBlockLabel;\n\n// InputSlotDialogMorph ////////////////////////////////////////////////\n\n// ... \"inherits\" some methods from BlockDialogMorph\n\n// InputSlotDialogMorph inherits from DialogBoxMorph:\n\nInputSlotDialogMorph.prototype = new DialogBoxMorph();\nInputSlotDialogMorph.prototype.constructor = InputSlotDialogMorph;\nInputSlotDialogMorph.uber = DialogBoxMorph.prototype;\n\n// InputSlotDialogMorph preferences settings:\n\n// if \"isLaunchingExpanded\" is true I always open in the long form\nInputSlotDialogMorph.prototype.isLaunchingExpanded = false;\n\n// InputSlotDialogMorph instance creation:\n\nexport function InputSlotDialogMorph(\n    fragment,\n    target,\n    action,\n    environment,\n    category\n) {\n    this.init(fragment, target, action, environment, category);\n}\n\nInputSlotDialogMorph.prototype.init = function (\n    fragment,\n    target,\n    action,\n    environment,\n    category\n) {\n    var scale = SyntaxElementMorph.prototype.scale,\n        fh = fontHeight(10) / 1.2 * scale; // \"raw height\"\n\n    // additional properties:\n    this.fragment = fragment || new BlockLabelFragment();\n    this.textfield = null;\n    this.types = null;\n    this.slots = null;\n    this.isExpanded = false;\n    this.category = category || 'other';\n    this.noDelete = false;\n\n    // initialize inherited properties:\n    BlockDialogMorph.uber.init.call(\n        this,\n        target,\n        action,\n        environment\n    );\n\n    // override inherited properites:\n    this.types = new AlignmentMorph('row', this.padding);\n    this.types.respectHiddens = true; // prevent the arrow from flipping\n    this.add(this.types);\n    this.slots = new BoxMorph();\n    this.slots.color = new Color(55, 55, 55); // same as palette\n    this.slots.borderColor = this.slots.color.lighter(50);\n    this.slots.setExtent(new Point((fh + 10) * 24, (fh + 10 * scale) * 10.4));\n    this.add(this.slots);\n    this.createSlotTypeButtons();\n    this.fixSlotsLayout();\n    this.addSlotsMenu();\n    this.createTypeButtons();\n    this.fixLayout();\n};\n\nInputSlotDialogMorph.prototype.createTypeButtons = function () {\n    var block,\n        arrow,\n        clr = SpriteMorph.prototype.blockColor[this.category];\n\n\n    block = new JaggedBlockMorph(localize('Title text'));\n    block.setColor(clr);\n    this.addBlockTypeButton(\n        () => this.setType(null),\n        block,\n        () => this.fragment.type === null\n    );\n\n    block = new JaggedBlockMorph('%inputName');\n    block.setColor(clr);\n    this.addBlockTypeButton(\n        () => this.setType('%s'),\n        block,\n        () => this.fragment.type !== null\n    );\n\n    // add an arrow button for long form/short form toggling\n    arrow = new ArrowMorph(\n        'right',\n        PushButtonMorph.prototype.fontSize + 4,\n        2\n    );\n    arrow.noticesTransparentClick = true;\n    this.types.add(arrow);\n    this.types.fixLayout();\n\n    // configure arrow button\n    arrow.refresh = () => {\n        if (this.fragment.type === null) {\n            this.isExpanded = false;\n            arrow.hide();\n        } else {\n            arrow.show();\n            if (this.isExpanded) {\n                arrow.direction = 'down';\n            } else {\n                arrow.direction = 'right';\n            }\n            arrow.fixLayout();\n            arrow.rerender();\n        }\n    };\n\n    arrow.mouseClickLeft = () => {\n        if (arrow.isVisible) {\n            this.isExpanded = !this.isExpanded;\n            this.types.children.forEach(c => c.refresh());\n            this.changed();\n            this.fixLayout();\n            this.rerender();\n            this.edit();\n        }\n    };\n\n    arrow.refresh();\n};\n\nInputSlotDialogMorph.prototype.addTypeButton\n    = BlockDialogMorph.prototype.addTypeButton;\n\nInputSlotDialogMorph.prototype.addBlockTypeButton\n    = BlockDialogMorph.prototype.addBlockTypeButton;\n\nInputSlotDialogMorph.prototype.setType = function (fragmentType) {\n    this.textfield.choices = fragmentType ? null : this.symbolMenu;\n    this.textfield.fixLayout();\n    this.fragment.type = fragmentType || null;\n    this.types.children.forEach(c => c.refresh());\n    this.slots.children.forEach(c => c.refresh());\n    if (isNil(fragmentType)) {\n        this.isExpanded = false;\n        this.types.children.forEach(c => c.refresh());\n        this.changed();\n        this.fixLayout();\n        this.rerender();\n    }\n    this.edit();\n};\n\nInputSlotDialogMorph.prototype.getInput = function () {\n    var lbl;\n    if (this.body instanceof InputFieldMorph) {\n        lbl = this.normalizeSpaces(this.body.getValue());\n    }\n    if (lbl) {\n        this.fragment.labelString = lbl;\n        if (contains(['%b', '%boolUE'], this.fragment.type)) {\n            this.fragment.defaultValue =\n                this.slots.defaultSwitch.evaluate();\n        } else {\n            this.fragment.defaultValue =\n                this.slots.defaultInputField.getValue();\n        }\n        return lbl;\n    }\n    // otherwise remove the fragment\n    this.fragment.isDeleted = true;\n    return null;\n};\n\nInputSlotDialogMorph.prototype.fixLayout = function () {\n    var maxWidth,\n        left = this.left(),\n        th = fontHeight(this.titleFontSize) + this.titlePadding * 2;\n\n    if (!this.isExpanded) {\n        if (this.slots) {\n            this.slots.hide();\n        }\n        return BlockDialogMorph.prototype.fixLayout.call(this);\n    }\n\n    this.slots.show();\n    maxWidth = this.slots.width();\n\n    // arrange panes :\n    // body (input field)\n    this.body.setPosition(this.position().add(new Point(\n        this.padding + (maxWidth - this.body.width()) / 2,\n        th + this.padding\n    )));\n\n    // label\n    this.label.setLeft(\n        left + this.padding + (maxWidth - this.label.width()) / 2\n    );\n    this.label.setTop(this.top() + (th - this.label.height()) / 2);\n\n    // types\n    this.types.fixLayout();\n    this.types.setTop(this.body.bottom() + this.padding);\n    this.types.setLeft(\n        left + this.padding + (maxWidth - this.types.width()) / 2\n    );\n\n    // slots\n    this.slots.setPosition(new Point(\n        this.left() + this.padding,\n        this.types.bottom() + this.padding\n    ));\n    this.slots.children.forEach(c => c.refresh());\n\n    // buttons\n    this.buttons.fixLayout();\n    this.buttons.setTop(this.slots.bottom() + this.padding);\n    this.buttons.setLeft(\n        left + this.padding + (maxWidth - this.buttons.width()) / 2\n    );\n\n    // set dialog box dimensions:\n    this.bounds.setHeight(this.buttons.bottom() - this.top() + this.padding);\n    this.bounds.setWidth(this.slots.right() - this.left() + this.padding);\n\n    // refresh a shallow shadow\n    this.removeShadow();\n    this.addShadow();\n};\n\nInputSlotDialogMorph.prototype.open = function (\n    title,\n    defaultString,\n    world,\n    pic,\n    noDeleteButton\n) {\n    var txt = new InputFieldMorph(defaultString);\n\n    if (!this.fragment.type) {\n        txt.choices = this.symbolMenu;\n    }\n    this.isExpanded = this.isLaunchingExpanded;\n    txt.setWidth(250);\n    this.labelString = title;\n    this.createLabel();\n    if (pic) {this.setPicture(pic); }\n    this.addBody(txt);\n    this.textfield = txt;\n    this.addButton('ok', 'OK');\n    if (!noDeleteButton) {\n        this.addButton('deleteFragment', 'Delete');\n    } else {\n        this.noDelete = true;\n    }\n    this.addButton('cancel', 'Cancel');\n    this.fixLayout();\n    this.popUp(world);\n    this.add(this.types); // make the types come to front\n    this.changed();\n};\n\nInputSlotDialogMorph.prototype.symbolMenu = function () {\n    var symbols = [],\n        symbolColor = new Color(100, 100, 130);\n    SymbolMorph.prototype.names.forEach(sym =>\n        symbols.push([\n            [\n                new SymbolMorph(sym, this.fontSize, symbolColor),\n                localize(sym)\n            ],\n            '$' + sym\n        ])\n    );\n    symbols.push(['\\u23CE ' + localize('new line'), '$nl']);\n    return symbols;\n};\n\nInputSlotDialogMorph.prototype.deleteFragment = function () {\n    this.fragment.isDeleted = true;\n    this.accept();\n};\n\nInputSlotDialogMorph.prototype.createSlotTypeButtons = function () {\n    // populate my 'slots' area with radio buttons, labels and input fields\n    var defLabel, defInput, defSwitch, loopArrow, settingsButton;\n\n    // slot types\n    this.addSlotTypeButton('Object', '%obj');\n    this.addSlotTypeButton('Text', '%txt');\n    this.addSlotTypeButton('List', '%l');\n    this.addSlotTypeButton('Number', '%n');\n    this.addSlotTypeButton('Any type', '%s');\n    this.addSlotTypeButton('Boolean (T/F)', '%b');\n    this.addSlotTypeButton('Command\\n(inline)', '%cmdRing'); //'%cmd');\n    this.addSlotTypeButton('Reporter', '%repRing'); //'%r');\n    this.addSlotTypeButton('Predicate', '%predRing'); //'%p');\n    this.addSlotTypeButton('Command\\n(C-shape)', ['%cs', '%ca']);\n    this.addSlotTypeButton('Any\\n(unevaluated)', '%anyUE');\n    this.addSlotTypeButton('Boolean\\n(unevaluated)', '%boolUE');\n\n    // arity and upvars\n    this.slots.radioButtonSingle = this.addSlotArityButton(\n        () => this.setSlotArity('single'),\n        \"Single input.\",\n        () => this.fragment.isSingleInput()\n    );\n    this.addSlotArityButton(\n        () => this.setSlotArity('multiple'),\n        \"Multiple inputs (value is list of inputs)\",\n        () => this.fragment.isMultipleInput()\n    );\n    this.addSlotArityButton(\n        () => this.setSlotArity('upvar'),\n        \"Upvar - make internal variable visible to caller\",\n        () => this.fragment.isUpvar()\n    );\n\n    // default values\n    defLabel = new StringMorph(localize('Default Value:'));\n    defLabel.fontSize = this.slots.radioButtonSingle.fontSize;\n    defLabel.setColor(WHITE);\n    defLabel.refresh = () => {\n        if (this.isExpanded && contains(\n                [\n                    '%s', '%n', '%txt', '%anyUE', '%b', '%boolUE',\n                    '%mlt', '%code'\n                ],\n                this.fragment.type\n            )) {\n            defLabel.show();\n        } else {\n            defLabel.hide();\n        }\n    };\n    this.slots.defaultInputLabel = defLabel;\n    this.slots.add(defLabel);\n\n    defInput = new InputFieldMorph(this.fragment.defaultValue);\n    defInput.contents().fontSize = defLabel.fontSize;\n    defInput.contrast = 90;\n    defInput.setWidth(50);\n    defInput.refresh = () => {\n        if (this.isExpanded && contains(\n            ['%s', '%n', '%txt', '%anyUE', '%mlt', '%code'],\n            this.fragment.type\n        )) {\n            defInput.show();\n            if (this.fragment.type === '%n') {\n                defInput.setIsNumeric(true);\n            } else {\n                defInput.setIsNumeric(false);\n            }\n        } else {\n            defInput.hide();\n        }\n    };\n    this.slots.defaultInputField = defInput;\n    this.slots.add(defInput);\n\n    defSwitch = new BooleanSlotMorph(this.fragment.defaultValue);\n    defSwitch.refresh = () => {\n        if (this.isExpanded && contains(\n            ['%b', '%boolUE'],\n            this.fragment.type\n        )) {\n            defSwitch.show();\n        } else {\n            defSwitch.hide();\n        }\n    };\n    this.slots.defaultSwitch = defSwitch;\n    this.slots.add(defSwitch);\n\n    // loop arrow checkbox //\n    loopArrow = new ToggleMorph(\n        'checkbox',\n        this, // target\n        () => { // action\n            if (this.fragment.type === '%ca') {\n                this.setType('%cs');\n            } else {\n                this.setType('%ca');\n            }\n        },\n        null, // label string\n        () => this.fragment.type === '%ca',\n        null, // environment\n        null, // hint\n        new SymbolMorph(\n            'loop',\n            this.fontSize * 0.7,\n            WHITE\n        ).getImage(),\n        null // builder method that constructs the element morph\n    );\n    loopArrow.refresh = () => {\n        ToggleMorph.prototype.refresh.call(loopArrow);\n        if (this.isExpanded && contains(\n                ['%cs', '%ca'],\n                this.fragment.type\n            )) {\n            loopArrow.show();\n        } else {\n            loopArrow.hide();\n        }\n    };\n    this.slots.loopArrow = loopArrow;\n    this.slots.add(loopArrow);\n\n    // settings button\n    settingsButton = new PushButtonMorph(\n        this.slots,\n        () => this.slots.userMenu().popUpAtHand(this.world()),\n        new SymbolMorph('gearPartial', this.fontSize * 1.5)\n    );\n    settingsButton.padding = 0;\n    settingsButton.fixLayout();\n    settingsButton.refresh = nop;\n    this.slots.settingsButton = settingsButton;\n    this.slots.add(settingsButton);\n\n};\n\nInputSlotDialogMorph.prototype.setSlotType = function (type) {\n    this.fragment.setSingleInputType(type);\n    this.slots.children.forEach(c => c.refresh());\n    this.edit();\n};\n\nInputSlotDialogMorph.prototype.setSlotArity = function (arity) {\n    if (arity === 'single') {\n        this.fragment.setToSingleInput();\n    } else if (arity === 'multiple') {\n        this.fragment.setToMultipleInput();\n    } else if (arity === 'upvar') {\n        this.fragment.setToUpvar();\n        // hide other options - under construction\n    }\n    this.slots.children.forEach(c => c.refresh());\n    this.edit();\n};\n\nInputSlotDialogMorph.prototype.setSlotOptions = function (text) {\n    this.fragment.options = text;\n};\n\nInputSlotDialogMorph.prototype.addSlotTypeButton = function (\n    label,\n    spec // slot spec or array of specs (I *hate* the arrow symbol, -Jens)\n) {\n/*\n    this method produces a radio button with a picture of the\n    slot type indicated by \"spec\" and the \"label\" text to\n    its right.\n    Note that you can make the slot picture interactive (turn\n    it into a ToggleElementMorph by changing the\n\n        element.fullImage()\n\n    line to just\n\n        element\n\n    I've opted for the simpler representation because it reduces\n    the duration of time it takes for the InputSlotDialog to load\n    and show. But in the future computers and browsers may be\n    faster.\n*/\n    var action = () => {\n            this.setSlotType(spec instanceof Array ? spec[0] : spec);\n        },\n        query,\n        element = new JaggedBlockMorph(spec instanceof Array ? spec[0] : spec),\n        button;\n\n    query = () => {\n        return spec instanceof Array ?\n            contains(spec, this.fragment.singleInputType())\n            : this.fragment.singleInputType() === spec;\n    };\n    element.setCategory(this.category);\n    element.rebuild();\n    button = new ToggleMorph(\n        'radiobutton',\n        this,\n        action,\n        label,\n        query,\n        null,\n        null,\n        element.doWithAlpha(1, () => element.fullImage()),\n        'rebuild'\n    );\n    button.edge = this.buttonEdge / 2;\n    button.outline = this.buttonOutline / 2;\n    button.outlineColor = this.buttonOutlineColor;\n    button.outlineGradient = this.buttonOutlineGradient;\n    button.fixLayout();\n    button.label.isBold = false;\n    button.label.setColor(WHITE);\n    this.slots.add(button);\n    return button;\n};\n\nInputSlotDialogMorph.prototype.addSlotArityButton = function (\n    action,\n    label,\n    query\n) {\n    var button = new ToggleMorph(\n        'radiobutton',\n        this,\n        action,\n        label,\n        query,\n        null,\n        null\n    );\n    button.edge = this.buttonEdge / 2;\n    button.outline = this.buttonOutline / 2;\n    button.outlineColor = this.buttonOutlineColor;\n    button.outlineGradient = this.buttonOutlineGradient;\n\n    button.fixLayout();\n    // button.label.isBold = false;\n    button.label.setColor(WHITE);\n    this.slots.add(button);\n    return button;\n};\n\nInputSlotDialogMorph.prototype.fixSlotsLayout = function () {\n    var slots = this.slots,\n        scale = SyntaxElementMorph.prototype.scale,\n        xPadding = 10 * scale,\n        ypadding = 14 * scale,\n        bh = (fontHeight(10) / 1.2 + 15) * scale, // slot type button height\n        ah = (fontHeight(10) / 1.2 + 10) * scale, // arity button height\n        size = 12, // number slot type radio buttons\n        cols = [\n            slots.left() + xPadding,\n            slots.left() + slots.width() / 3,\n            slots.left() + slots.width() * 2 / 3\n        ],\n        rows = [\n            slots.top() + ypadding,\n            slots.top() + ypadding + bh,\n            slots.top() + ypadding + bh * 2,\n            slots.top() + ypadding + bh * 3,\n            slots.top() + ypadding + bh * 4,\n            slots.top() + ypadding + bh * 5,\n\n            slots.top() + ypadding + bh * 5 + ah,\n            slots.top() + ypadding + bh * 5 + ah * 2\n        ],\n        idx,\n        row = -1,\n        col;\n\n    // slot types:\n\n    for (idx = 0; idx < size; idx += 1) {\n        col = idx % 3;\n        if (idx % 3 === 0) {row += 1; }\n        slots.children[idx].setPosition(new Point(\n            cols[col],\n            rows[row]\n        ));\n    }\n\n    // arity:\n\n    col = 0;\n    row = 5;\n    for (idx = size; idx < size + 3; idx += 1) {\n        slots.children[idx].setPosition(new Point(\n            cols[col],\n            rows[row + idx - size]\n        ));\n    }\n\n    // default input\n\n    this.slots.defaultInputLabel.setPosition(\n        this.slots.radioButtonSingle.label.topRight().add(new Point(5, 0))\n    );\n    this.slots.defaultInputField.setCenter(\n        this.slots.defaultInputLabel.center().add(new Point(\n            this.slots.defaultInputField.width() / 2\n                + this.slots.defaultInputLabel.width() / 2 + 5,\n            0\n        ))\n    );\n    this.slots.defaultSwitch.setCenter(\n        this.slots.defaultInputLabel.center().add(new Point(\n            this.slots.defaultSwitch.width() / 2\n                + this.slots.defaultInputLabel.width() / 2 + 5,\n            0\n        ))\n    );\n\n    // loop arrow\n\n    this.slots.loopArrow.setPosition(this.slots.defaultInputLabel.position());\n    this.slots.settingsButton.setPosition(\n        this.slots.bottomRight().subtract(\n            this.slots.settingsButton.extent().add(\n                this.padding + this.slots.border\n            )\n        )\n    );\n\n    this.slots.changed();\n};\n\nInputSlotDialogMorph.prototype.addSlotsMenu = function () {\n    this.slots.userMenu = () => {\n        if (contains(\n            ['%s', '%n', '%txt', '%anyUE', '%mlt', '%code'],\n            this.fragment.type)\n        ) {\n            var menu = new MenuMorph(this),\n                on = '\\u2611 ',\n                off = '\\u2610 ';\n            menu.addItem(\n                (this.fragment.hasOptions() ? on : off) +\n                    localize('options') +\n                    '...',\n                'editSlotOptions'\n            );\n            menu.addItem(\n                (this.fragment.isReadOnly ? on : off) +\n                    localize('read-only'),\n                () => this.fragment.isReadOnly = !this.fragment.isReadOnly\n            );\n            menu.addLine();\n            menu.addMenu(\n                (this.fragment.hasSpecialMenu() ? on : off) +\n                    localize('menu'),\n                this.specialOptionsMenu()\n            );\n            menu.addMenu(\n                (contains(['%mlt', '%code'], this.fragment.type) ?\n                    on : off) +\n                localize('special'),\n                this.specialSlotsMenu()\n            );\n            return menu;\n        }\n        return this.specialSlotsMenu();\n    };\n};\n\nInputSlotDialogMorph.prototype.editSlotOptions = function () {\n    new DialogBoxMorph(\n        this,\n        options => this.fragment.options = options.trim(),\n        this\n    ).promptCode(\n        'Input Slot Options',\n        this.fragment.options,\n        this.world(),\n        null,\n        localize('Enter one option per line.\\n' +\n            'Optionally use \"=\" as key/value delimiter ' +\n            'and {} for submenus. ' +\n            'e.g.\\n   the answer=42')\n    );\n};\n\nInputSlotDialogMorph.prototype.specialSlotsMenu = function () {\n    var menu = new MenuMorph(this.setSlotType, null, this),\n        myself = this,\n        on = '\\u26AB ',\n        off = '\\u26AA ';\n\n    function addSpecialSlotType(label, spec) {\n        menu.addItem(\n            (myself.fragment.type === spec ? on : off) + localize(label),\n            spec\n        );\n    }\n\n    addSpecialSlotType('multi-line', '%mlt');\n    addSpecialSlotType('code', '%code');\n    return menu;\n};\n\nInputSlotDialogMorph.prototype.specialOptionsMenu = function () {\n    var menu = new MenuMorph(this.setSlotOptions, null, this),\n        myself = this,\n        on = '\\u26AB ',\n        off = '\\u26AA ';\n\n    function addSpecialOptions(label, selector) {\n        menu.addItem(\n            (myself.fragment.options === selector ?\n                    on : off) + localize(label),\n            selector\n        );\n    }\n\n    addSpecialOptions('(none)', '');\n    addSpecialOptions('messages', '_messagesMenu');\n    addSpecialOptions('objects', '_objectsMenu');\n    // addSpecialOptions('data types', '_typesMenu');\n    addSpecialOptions('costumes', '_costumesMenu');\n    addSpecialOptions('sounds', '_soundsMenu');\n    addSpecialOptions('variables', '_getVarNamesDict');\n    addSpecialOptions('piano keyboard', '_pianoKeyboardMenu');\n    addSpecialOptions('360 dial', '_directionDialMenu');\n    return menu;\n};\n\n// InputSlotDialogMorph hiding and showing:\n\n/*\n    override the inherited behavior to recursively hide/show all\n    children, so that my instances get restored correctly when\n    hiding/showing my parent.\n*/\n\nInputSlotDialogMorph.prototype.hide = function () {\n    this.isVisible = false;\n    this.changed();\n};\n\nInputSlotDialogMorph.prototype.show = function () {\n    this.isVisible = true;\n    this.changed();\n};\n\n// VariableDialogMorph ////////////////////////////////////////////////////\n//\n// VariableDialogMorph inherits from DialogBoxMorph:\n\nVariableDialogMorph.prototype = new DialogBoxMorph();\nVariableDialogMorph.prototype.constructor = VariableDialogMorph;\nVariableDialogMorph.uber = DialogBoxMorph.prototype;\n\n// ... and some behavior from BlockDialogMorph\n\n// VariableDialogMorph instance creation:\n\nexport function VariableDialogMorph(target, action, environment) {\n    this.init(target, action, environment);\n}\n\nVariableDialogMorph.prototype.init = function (target, action, environment) {\n    // additional properties:\n    this.types = null;\n    this.isGlobal = true;\n\n    // initialize inherited properties:\n    BlockDialogMorph.uber.init.call(\n        this,\n        target,\n        action,\n        environment\n    );\n\n    // override inherited properites:\n    this.types = new AlignmentMorph('row', this.padding);\n    this.add(this.types);\n    this.createTypeButtons();\n};\n\nVariableDialogMorph.prototype.createTypeButtons = function () {\n    this.addTypeButton(\n        () => this.setType('global'),\n        \"for all sprites\",\n        () => this.isGlobal\n    );\n    this.addTypeButton(\n        () => this.setType('local'),\n        \"for this sprite only\",\n        () => !this.isGlobal\n    );\n};\n\nVariableDialogMorph.prototype.addTypeButton\n    = BlockDialogMorph.prototype.addTypeButton;\n\nVariableDialogMorph.prototype.setType = function (varType) {\n    this.isGlobal = (varType === 'global');\n    this.types.children.forEach(c => c.refresh());\n    this.edit();\n};\n\nVariableDialogMorph.prototype.getInput = function () {\n    // answer a tuple: [varName, isGlobal]\n    var name = this.normalizeSpaces(this.body.getValue());\n    return name ? [name, this.isGlobal] : null;\n};\n\nVariableDialogMorph.prototype.fixLayout = function () {\n    var th = fontHeight(this.titleFontSize) + this.titlePadding * 2;\n\n    if (this.body) {\n        this.body.setPosition(this.position().add(new Point(\n            this.padding,\n            th + this.padding\n        )));\n        this.bounds.setWidth(this.body.width() + this.padding * 2);\n        this.bounds.setHeight(\n            this.body.height()\n                + this.padding * 2\n                + th\n        );\n    }\n\n    if (this.label) {\n        this.label.setCenter(this.center());\n        this.label.setTop(this.top() + (th - this.label.height()) / 2);\n    }\n\n    if (this.types) {\n        this.types.fixLayout();\n        this.bounds.setHeight(\n            this.height()\n                    + this.types.height()\n                    + this.padding\n        );\n        this.bounds.setWidth(Math.max(\n            this.width(),\n            this.types.width() + this.padding * 2\n        ));\n        this.types.setCenter(this.center());\n        if (this.body) {\n            this.types.setTop(this.body.bottom() + this.padding);\n        } else if (this.categories) {\n            this.types.setTop(this.categories.bottom() + this.padding);\n        }\n    }\n\n    if (this.buttons && (this.buttons.children.length > 0)) {\n        this.buttons.fixLayout();\n        this.bounds.setHeight(\n            this.height()\n                    + this.buttons.height()\n                    + this.padding\n        );\n        this.buttons.setCenter(this.center());\n        this.buttons.setBottom(this.bottom() - this.padding);\n    }\n\n    // refresh a shallow shadow\n    this.removeShadow();\n    this.addShadow();\n};\n\n// BlockExportDialogMorph ////////////////////////////////////////////////////\n\n// BlockExportDialogMorph inherits from DialogBoxMorph:\n\nBlockExportDialogMorph.prototype = new DialogBoxMorph();\nBlockExportDialogMorph.prototype.constructor = BlockExportDialogMorph;\nBlockExportDialogMorph.uber = DialogBoxMorph.prototype;\n\n// BlockExportDialogMorph constants:\n\nBlockExportDialogMorph.prototype.key = 'blockExport';\n\n// BlockExportDialogMorph instance creation:\n\nexport function BlockExportDialogMorph(serializer, blocks) {\n    this.init(serializer, blocks);\n}\n\nBlockExportDialogMorph.prototype.init = function (serializer, blocks) {\n    // additional properties:\n    this.serializer = serializer;\n    this.blocks = blocks.slice(0);\n    this.handle = null;\n\n    // initialize inherited properties:\n    BlockExportDialogMorph.uber.init.call(\n        this,\n        null, // target\n        () => this.exportBlocks(),\n        null // environment\n    );\n\n    // override inherited properites:\n    this.labelString = 'Export blocks';\n    this.createLabel();\n\n    // build contents\n    this.buildContents();\n};\n\nBlockExportDialogMorph.prototype.buildContents = function () {\n    var palette, x, y, block, checkBox, lastCat,\n        padding = 4;\n\n    // create plaette\n    palette = new ScrollFrameMorph(\n        null,\n        null,\n        SpriteMorph.prototype.sliderColor\n    );\n    palette.color = SpriteMorph.prototype.paletteColor;\n    palette.padding = padding;\n    palette.isDraggable = false;\n    palette.acceptsDrops = false;\n    palette.contents.acceptsDrops = false;\n\n    // populate palette\n    x = palette.left() + padding;\n    y = palette.top() + padding;\n    SpriteMorph.prototype.categories.forEach(category => {\n        this.blocks.forEach(definition => {\n            if (definition.category === category) {\n                if (lastCat && (category !== lastCat)) {\n                    y += padding;\n                }\n                lastCat = category;\n                block = definition.templateInstance();\n                checkBox = new ToggleMorph(\n                    'checkbox',\n                    this,\n                    () => {\n                        var idx = this.blocks.indexOf(definition);\n                        if (idx > -1) {\n                            this.blocks.splice(idx, 1);\n                        } else {\n                            this.blocks.push(definition);\n                        }\n                    },\n                    null,\n                    () => contains(this.blocks, definition),\n                    null,\n                    null,\n                    block.fullImage()\n                );\n                checkBox.setPosition(new Point(\n                    x,\n                    y + (checkBox.top() - checkBox.toggleElement.top())\n                ));\n                palette.addContents(checkBox);\n                y += checkBox.fullBounds().height() + padding;\n            }\n        });\n    });\n\n    palette.scrollX(padding);\n    palette.scrollY(padding);\n    this.addBody(palette);\n\n    this.addButton('ok', 'OK');\n    this.addButton('cancel', 'Cancel');\n\n    this.setExtent(new Point(220, 300));\n    this.fixLayout();\n};\n\nBlockExportDialogMorph.prototype.popUp = function (wrrld) {\n    var world = wrrld || this.target.world();\n    if (world) {\n        BlockExportDialogMorph.uber.popUp.call(this, world);\n        this.handle = new HandleMorph(\n            this,\n            200,\n            220,\n            this.corner,\n            this.corner\n        );\n    }\n};\n\n// BlockExportDialogMorph menu\n\nBlockExportDialogMorph.prototype.userMenu = function () {\n    var menu = new MenuMorph(this, 'select');\n    menu.addItem('all', 'selectAll');\n    menu.addItem('none', 'selectNone');\n    return menu;\n};\n\nBlockExportDialogMorph.prototype.selectAll = function () {\n    this.body.contents.children.forEach(checkBox => {\n        if (!checkBox.state) {\n            checkBox.trigger();\n        }\n    });\n};\n\nBlockExportDialogMorph.prototype.selectNone = function () {\n    this.blocks = [];\n    this.body.contents.children.forEach(checkBox => {\n        checkBox.refresh();\n    });\n};\n\n// BlockExportDialogMorph ops\n\nBlockExportDialogMorph.prototype.exportBlocks = function () {\n    var str = this.serializer.serialize(this.blocks, true), // for library\n        ide = this.world().children[0];\n\n    if (this.blocks.length > 0) {\n        str = '<blocks app=\"'\n            + this.serializer.app\n            + '\" version=\"'\n            + this.serializer.version\n            + '\">'\n            + str\n            + '</blocks>';\n        ide.saveXMLAs(\n            str,\n            (ide.projectName || localize('untitled')) + ' ' + localize('blocks')\n        );\n    } else {\n        new DialogBoxMorph().inform(\n            'Export blocks',\n            'no blocks were selected',\n            this.world()\n        );\n    }\n};\n\n// BlockExportDialogMorph layout\n//\n// BlockExportDialogMorph.prototype.fixLayout\n//     = BlockEditorMorph.prototype.fixLayout;\n\n// BlockImportDialogMorph ////////////////////////////////////////////////////\n\n// BlockImportDialogMorph inherits from DialogBoxMorph\n// and pseudo-inherits from BlockExportDialogMorph:\n\nBlockImportDialogMorph.prototype = new DialogBoxMorph();\nBlockImportDialogMorph.prototype.constructor = BlockImportDialogMorph;\nBlockImportDialogMorph.uber = DialogBoxMorph.prototype;\n\n// BlockImportDialogMorph constants:\n\nBlockImportDialogMorph.prototype.key = 'blockImport';\n\n// BlockImportDialogMorph instance creation:\n\nexport function BlockImportDialogMorph(blocks, target, name) {\n    this.init(blocks, target, name);\n}\n\nBlockImportDialogMorph.prototype.init = function (blocks, target, name) {\n    // additional properties:\n    this.blocks = blocks.slice(0);\n    this.handle = null;\n\n    // initialize inherited properties:\n    BlockExportDialogMorph.uber.init.call(\n        this,\n        target,\n        () => this.importBlocks(name),\n        null // environment\n    );\n\n    // override inherited properites:\n    this.labelString = localize('Import blocks')\n        + (name ? ': ' : '')\n        + name || '';\n    this.createLabel();\n\n    // build contents\n    this.buildContents();\n};\n\nBlockImportDialogMorph.prototype.buildContents\n    = BlockExportDialogMorph.prototype.buildContents;\n\nBlockImportDialogMorph.prototype.popUp\n    = BlockExportDialogMorph.prototype.popUp;\n\n// BlockImportDialogMorph menu\n\nBlockImportDialogMorph.prototype.userMenu\n    = BlockExportDialogMorph.prototype.userMenu;\n\nBlockImportDialogMorph.prototype.selectAll\n    = BlockExportDialogMorph.prototype.selectAll;\n\nBlockImportDialogMorph.prototype.selectNone\n    = BlockExportDialogMorph.prototype.selectNone;\n\n// BlockImportDialogMorph ops\n\n// BlockImportDialogMorph.prototype.importBlocks = function (name) {\n//     var ide = this.target.parentThatIsA(IDE_Morph);\n//     if (!ide) {return; }\n//     if (this.blocks.length > 0) {\n//         this.blocks.forEach(def => {\n//             def.receiver = ide.stage;\n//             ide.stage.globalBlocks.push(def);\n//             ide.stage.replaceDoubleDefinitionsFor(def);\n//         });\n//         ide.flushPaletteCache();\n//         ide.refreshPalette();\n//         ide.showMessage(\n//             'Imported Blocks Module' + (name ? ': ' + name : '') + '.',\n//             2\n//         );\n//     } else {\n//         new DialogBoxMorph().inform(\n//             'Import blocks',\n//             'no blocks were selected',\n//             this.world()\n//         );\n//     }\n// };\n\n// BlockImportDialogMorph layout\n//\n// BlockImportDialogMorph.prototype.fixLayout\n//     = BlockEditorMorph.prototype.fixLayout;\n\n// BlockRemovalDialogMorph ///////////////////////////////////////////////////\n\n// BlockRemovalDialogMorph inherits from DialogBoxMorph\n// and pseudo-inherits from BlockExportDialogMorph:\n\nBlockRemovalDialogMorph.prototype = new DialogBoxMorph();\nBlockRemovalDialogMorph.prototype.constructor = BlockImportDialogMorph;\nBlockRemovalDialogMorph.uber = DialogBoxMorph.prototype;\n\n// BlockRemovalDialogMorph constants:\n\nBlockRemovalDialogMorph.prototype.key = 'blockRemove';\n\n// BlockRemovalDialogMorph instance creation:\n\nexport function BlockRemovalDialogMorph(blocks, target) {\n    this.init(blocks, target);\n}\n\nBlockRemovalDialogMorph.prototype.init = function (blocks, target) {\n    // additional properties:\n    this.blocks = blocks.slice(0);\n    this.handle = null;\n\n    // initialize inherited properties:\n    BlockExportDialogMorph.uber.init.call(\n        this,\n        target,\n        () => this.removeBlocks(),\n        null // environment\n    );\n\n    // override inherited properites:\n    this.labelString = localize('Remove unused blocks')\n        + (name ? ': ' : '')\n        + name || '';\n    this.createLabel();\n\n    // build contents\n    this.buildContents();\n};\n\nBlockRemovalDialogMorph.prototype.buildContents\n    = BlockExportDialogMorph.prototype.buildContents;\n\nBlockRemovalDialogMorph.prototype.popUp\n    = BlockExportDialogMorph.prototype.popUp;\n\n// BlockRemovalDialogMorph menu\n\nBlockRemovalDialogMorph.prototype.userMenu\n    = BlockExportDialogMorph.prototype.userMenu;\n\nBlockRemovalDialogMorph.prototype.selectAll\n    = BlockExportDialogMorph.prototype.selectAll;\n\nBlockRemovalDialogMorph.prototype.selectNone\n    = BlockExportDialogMorph.prototype.selectNone;\n\n// BlockRemovalDialogMorph ops\n\nBlockRemovalDialogMorph.prototype.removeBlocks = function () {\n    var ide = this.target.parentThatIsA(IDE_Morph);\n    if (!ide) {return; }\n    if (this.blocks.length > 0) {\n        this.blocks.forEach(def => {\n            var idx = ide.stage.globalBlocks.indexOf(def);\n            if (idx !== -1) {\n                ide.stage.globalBlocks.splice(idx, 1);\n            }\n        });\n        ide.flushPaletteCache();\n        ide.refreshPalette();\n        ide.showMessage(\n            this.blocks.length + ' ' + localize('unused block(s) removed'),\n            2\n        );\n    } else {\n        new DialogBoxMorph().inform(\n            'Remove unused blocks',\n            'no blocks were selected',\n            this.world()\n        );\n    }\n};\n\n// BlockRemovalDialogMorph layout\n\n// BlockRemovalDialogMorph.prototype.fixLayout\n//     = BlockEditorMorph.prototype.fixLayout;\n","/*\n\n    tables.js\n\n    basic spreadsheet elements for Snap!\n\n    written by Jens Mnig\n    jens@moenig.org\n\n    Copyright (C) 2020 by Jens Mnig\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    prerequisites:\n    --------------\n    needs morphic.js, list.js, widgets.js, byob.js, threads\n\n\n    I. hierarchy\n    -------------\n    the following tree lists all constructors hierarchically,\n    indentation indicating inheritance. Refer to this list to get a\n    contextual overview:\n\n    DialogBoxMorph**\n        TableDialogMorph\n    Morph*\n        FrameMorph*\n            TableMorph\n        TableCellMorph\n        TableFrameMorph\n    Table\n\n    * from morphic.js\n    ** from widgets.js\n\n\n    II. toc\n    -------\n    the following list shows the order in which all constructors are\n    defined. Use this list to locate code in this document:\n\n    Table\n    TableCellMorph\n    TableMorph\n    TableFrameMorph\n    TableDialogMorph\n\n*/\n\n// Global settings /////////////////////////////////////////////////////\n\n/*global modules, Point, Morph, fontHeight, SliderMorph, isString, detect, List,\nMorphicPreferences, FrameMorph, HandleMorph, DialogBoxMorph, StringMorph, isNil,\nSpriteMorph, Context, Costume, BlockEditorMorph, SymbolMorph, IDE_Morph, Sound,\nSyntaxElementMorph, MenuMorph, SpriteBubbleMorph, SpeechBubbleMorph, CellMorph,\nListWatcherMorph, BoxMorph, Variable, isSnapObject, useBlurredShadows*/\nimport {modules, Morph,\n  StringMorph, Point, MenuMorph,\n   detect,\n  MorphicPreferences, isNil, fontHeight\n  , HandleMorph,\n  BoxMorph,\n   SliderMorph, isString, FrameMorph,\n SpeechBubbleMorph, useBlurredShadows\n} from './morphic'\n\nimport {SymbolMorph} from './symbols'\n\nimport {DialogBoxMorph,\n} from './widgets'\n\nimport { SyntaxElementMorph\n} from './blocks'\n\nimport {Variable} from \"./threads\";\n\nimport {SpriteMorph, isSnapObject, Costume,  Sound, CellMorph\n} from './objects'\nimport {ListWatcherMorph, List} from './lists'\n\n\nmodules.tables = '2020-October-06';\n\n// export var Table;\n// var TableCellMorph;\n// var TableMorph;\n// var TableFrameMorph;\n\n// Table /////////////////////////////////////////////////////////////\n\n/*\n    Observable 2D data collections accessible by rows, columns and cells\n    with indices starting at 1.\n    currently only used for testing TableViews in Snap, because Snap\n    automatically displays 2D lists as tables.\n*/\n\nexport function Table(cols, rows) {\n    this.colCount = +cols;\n    this.rowCount = +rows;\n    this.colNames = [];\n    this.rowNames = [];\n    this.contents = new Array(+rows);\n    for (var i = 0; i < rows; i += 1) {\n        this.contents[i] = new Array(+cols);\n    }\n    this.lastChanged = Date.now();\n}\n\n// Table testing:\n\nTable.prototype.demo = function(aWorld) {\n    // new Table(50, 10000).demo(world)\n    var dlg;\n    this.fillWithTestData();\n    dlg = new TableDialogMorph(this);\n    dlg.popUp (aWorld);\n};\n\n// Table updating:\n\nTable.prototype.changed = function () {\n    this.lastChanged = Date.now();\n};\n\n// Table querying:\n\nTable.prototype.get = function (col, row) {\n    if (!col) {\n        if (!row) {return [this.rowCount]; }\n        return this.rowName(row);\n    } else if (!row) {\n        return this.colName(col);\n    }\n    if (col > this.colCount || row > this.rowCount) {return null; }\n    return (this.contents[row - 1] || [])[col - 1];\n};\n\nTable.prototype.row = function(row) {\n    return this.contents[row - 1];\n};\n\nTable.prototype.col = function(col) {\n    var dta = [],\n        c = col - 1,\n        i;\n    for (i = 0; i < this.rowCount; i += 1) {\n        dta.push(this.contents[i][c]);\n    }\n    return dta;\n};\n\nTable.prototype.colName = function (col) {\n    // answer the specified name or a capital letter A-Z\n    // repeated accordingly\n    if (col > this.colCount) {return null; }\n    var name = this.colNames[col - 1];\n    if (name !== undefined) {return name; }\n    return String.fromCharCode(64 + ((col % 26) || 26)).repeat(\n        Math.floor((col - 1) / 26) + 1\n    );\n};\n\nTable.prototype.rowName = function (row) {\n    // answer the specified name or row number\n    if (row > this.rowCount) {return null; }\n    return this.rowNames[row - 1] || row;\n};\n\nTable.prototype.rows = function () {\n    return this.rowCount;\n};\n\nTable.prototype.cols = function () {\n    return this.colCount;\n};\n\nTable.prototype.columnNames = function () {\n    return this.colNames;\n};\n\n// Table setting:\n\nTable.prototype.set = function (data, col, row) {\n    this.contents[row - 1][col - 1] = data;\n    this.changed();\n};\n\nTable.prototype.setRows = function (rowsArray, colNames, rowNames) {\n    this.contents = rowsArray;\n    if (colNames) {this.colNames = colNames; }\n    if (rowNames) {this.rowNames = rowNames; }\n    this.changed();\n};\n\nTable.prototype.setCols = function (colsArray, colNames, rowNames) {\n    var r, c;\n    for (c = 0; c < this.colCount; c += 1) {\n        for (r = 0; r < this.rowCount; r += 1) {\n            this.contents[r][c] = colsArray[c][r];\n        }\n    }\n    if (colNames) {this.colNames = colNames; }\n    if (rowNames) {this.rowNames = rowNames; }\n    this.changed();\n};\n\nTable.prototype.setColNames = function (array) {\n    this.colNames = array || [];\n    this.changed();\n};\n\nTable.prototype.setRowNames = function (array) {\n    this.rowNames = array || [];\n    this.changed();\n};\n\nTable.prototype.setColName = function (col, name) {\n    this.colNames[col + 1] = name;\n    this.changed();\n};\n\nTable.prototype.setRowName = function (row, name) {\n    this.rowNames[row + 1] = name;\n    this.changed();\n};\n\n// Table growing:\n\nTable.prototype.addRow = function (array, name) {\n    if (array) {\n        this.contents[this.rowCount] = array;\n    } else {\n        this.contents[this.rowCount] = new Array(this.rowCount);\n    }\n    this.rowNames[this.rowCount] = name;\n    this.rowCount += 1;\n    this.changed();\n};\n\nTable.prototype.addCol = function (array, name) {\n    var i;\n    if (array) {\n        for (i = 0; i < this.col; i += 1) {\n            this.contents[i][this.colCount] = array[i];\n        }\n    }\n    this.colNames[this.colCount] = name;\n    this.colCount += 1;\n    this.changed();\n};\n\n// Table converting:\n\nTable.prototype.toList = function () {\n    return new List(\n        this.contents.map(eachRow => new List(eachRow))\n    );\n};\n\n// Table testing\n\nTable.prototype.fillWithTestData = function () {\n    var c, r;\n    for (c = 1; c <= this.colCount; c += 1) {\n        for (r = 1; r <= this.rowCount; r += 1) {\n            this.set (this.colName(c) + this.rowName(r), c, r);\n        }\n    }\n};\n\n// TableCellMorph /////////////////////////////////////////////////////////\n\n// basic fast data view, currently constrained to a single line of text\n\n// TableCellMorph inherits from Morph:\n\nTableCellMorph.prototype = new Morph();\nTableCellMorph.prototype.constructor = TableCellMorph;\nTableCellMorph.uber = Morph.prototype;\n\n// TableCellMorph global setting:\n\nTableCellMorph.prototype.cachedListSymbol = null;\n\nTableCellMorph.prototype.listSymbol = function () {\n    if (!this.cachedListSymbol || this.cachedListSymbol.height() !==\n            SyntaxElementMorph.prototype.fontSize) {\n        this.cachedListSymbol = new SymbolMorph(\n            'list',\n            SyntaxElementMorph.prototype.fontSize,\n            SpriteMorph.prototype.blockColor.lists.darker(50)\n        );\n    }\n    return this.cachedListSymbol.getImage();\n};\n\n// TableCellMorph instance creation:\n\nexport function TableCellMorph(data, extent, isLabel) {\n    this.init(data, extent, isLabel);\n}\n\nTableCellMorph.prototype.init = function (data, extent, isLabel) {\n    // additional properties:\n    this.data = data;\n    this.isLabel = isLabel || false;\n    this.labelString = null;\n\n    // initialize inherited properties:\n    TableCellMorph.uber.init.call(this, true);\n\n    // override inherited properites:\n    if (extent) {this.bounds.setExtent(extent); }\n    this.fixLayout();\n};\n\nTableCellMorph.prototype.setData = function (data, extent) {\n    this.data = data;\n    if (extent && (!extent.eq(this.extent()))) {\n        this.bounds.setExtent(extent);\n    }\n    this.rerender();\n};\n\nTableCellMorph.prototype.getData = function () {\n    return this.data instanceof Array ? this.data[0] : this.data;\n};\n\nTableCellMorph.prototype.render = function (ctx) {\n    var dta = this.labelString || this.dataRepresentation(this.data),\n        fontSize = SyntaxElementMorph.prototype.fontSize,\n        empty = TableMorph.prototype.highContrast ? 'rgb(220, 220, 220)'\n                : 'transparent',\n        orphaned = 'rgb(217, 77, 17)',\n        fontStyle = this.isLabel ?\n                (this.data instanceof Array ? 'italic'  : '')\n                        : this.shouldBeList() ? 'bold' : '',\n        font = fontStyle + ' ' + fontSize + 'px Helvetica, Arial, sans-serif',\n        background = this.labelString ? 'rgb(220, 220, 250)'\n            : (this.isLabel ? empty\n                : (this.shouldBeList() ? orphaned\n                        : (this.isOvershooting() ? 'white'\n                                : (isNil(this.data) ? empty : 'white')))),\n        foreground = !this.isLabel && this.shouldBeList()? 'white' : 'black',\n        width = this.width(),\n        height = this.height(),\n        txtWidth,\n        txtHeight,\n        x,\n        y;\n\n    ctx.fillStyle = background;\n    if (this.shouldBeList()) {\n        BoxMorph.prototype.outlinePath.call(\n            this, ctx, SyntaxElementMorph.prototype.corner + 1, 0\n        );\n        ctx.fill();\n    } else if (this.isOvershooting()) {\n        this.raggedBoxPath(ctx);\n        ctx.fill();\n    } else {\n        ctx.fillRect(0, 0, width, height);\n    }\n\n    if (!dta) {return; }\n    if (dta instanceof HTMLCanvasElement) {\n        x = Math.max((width - dta.width) / 2, 0);\n        y = Math.max((height - dta.height) / 2, 0);\n        if (useBlurredShadows) {\n            ctx.shadowOffsetX = 4;\n            ctx.shadowOffsetY = 4;\n            ctx.shadowBlur = 4;\n            ctx.shadowColor = 'lightgray';\n        }\n        ctx.drawImage(dta, x, y);\n    } else { // text\n        ctx.font = font;\n        ctx.textAlign = 'left';\n        ctx.textBaseline = 'bottom';\n        txtWidth = ctx.measureText(dta).width;\n        txtHeight = fontHeight(fontSize);\n        ctx.fillStyle = foreground;\n        x = Math.max((width - txtWidth) / 2, 0);\n        y = Math.max((height - txtHeight) / 2, 0);\n        ctx.fillText(dta, x, txtHeight + y);\n    }\n};\n\nTableCellMorph.prototype.dataRepresentation = function (dta) {\n    if (dta instanceof Morph) {\n        if (isSnapObject(dta)) {\n            return dta.thumbnail(new Point(40, 40));\n        } else {\n            return dta.fullImage();\n        }\n    } else if (isString(dta)) {\n        return dta.length > 100 ? dta.slice(0, 100) + '...' : dta;\n    } else if (typeof dta === 'number') {\n        return dta.toString();\n    } else if (typeof dta === 'boolean') {\n        return SpriteMorph.prototype.booleanMorph.call(\n            null,\n            dta\n        ).fullImage();\n    } else if (dta instanceof Array) {\n        return this.dataRepresentation(dta[0]);\n    } else if (dta instanceof Variable) {\n        return this.dataRepresentation(dta.value);\n    } else if (dta instanceof HTMLCanvasElement) {\n        return dta;\n    } else if (dta instanceof Context) {\n        return dta.image();\n    } else if (dta instanceof Costume) {\n        return dta.thumbnail(new Point(40, 40));\n    } else if (dta instanceof Sound) {\n        return new SymbolMorph(\n            'notes', SyntaxElementMorph.prototype.fontSize\n        ).getImage();\n    } else if (dta instanceof List) {\n        return this.listSymbol();\n    } else {\n        return dta ? dta.toString() : (dta === 0 ? '0' : null);\n    }\n};\n\nTableCellMorph.prototype.raggedBoxPath = function (context) {\n    var width = this.width(),\n        height = this.height(),\n        x = width * 0.75,\n        step = height / 6,\n        y = 0;\n    context.beginPath();\n    context.moveTo(0, 0);\n    context.lineTo(width, 0);\n    for (y = 0; y < height; y += (step * 2)) {\n        context.lineTo(x, y + step);\n        context.lineTo(width, y + (step * 2));\n    }\n    context.lineTo(width, height);\n    context.lineTo(0, height);\n    context.closePath();\n};\n\nTableCellMorph.prototype.shouldBeList = function () {\n    return this.data instanceof Array;\n};\n\nTableCellMorph.prototype.isOvershooting = function () {\n    return this.data instanceof Variable;\n};\n\n// TableCellMorph events:\n\nTableCellMorph.prototype.mouseDoubleClick = function (pos) {\n    if (this.data instanceof Table || this.data instanceof List) {\n        new TableDialogMorph(this.data).popUp(this.world());\n    } else if (this.data instanceof Array && this.data[0] instanceof List) {\n        new TableDialogMorph(this.data[0]).popUp(this.world());\n    } else {\n        this.escalateEvent('mouseDoubleClick', pos);\n    }\n};\n\nTableCellMorph.prototype.mouseEnter = function () {\n    var tm, x, c;\n    if (this.isLabel) {\n        tm = this.parentThatIsA(TableMorph);\n        x = tm.world().hand.left() - tm.left();\n        c = tm.columnAt(x);\n        if (c > 0) {\n            this.labelString = c;\n            this.rerender();\n        }\n    }\n};\n\nTableCellMorph.prototype.mouseLeave = function () {\n    if (this.isLabel) {\n        this.labelString = null;\n        this.rerender();\n    }\n};\n\n// TableMorph //////////////////////////////////////////////////////////\n\n// TableMorph inherits from FrameMorph:\n\nTableMorph.prototype = new FrameMorph();\nTableMorph.prototype.constructor = TableMorph;\nTableMorph.uber = FrameMorph.prototype;\n\n// TableMorph preferences settings:\n\nTableMorph.prototype.highContrast = false;\n\n// TableMorph instance creation:\n\nexport function TableMorph(\n    table,\n    // optional parameters below this line\n    scrollBarSize,\n    extent,\n    startRow,\n    startCol,\n    globalColWidth,\n    colWidths,\n    rowHeight,\n    colLabelHeight,\n    padding\n) {\n    this.init(\n        table,\n        scrollBarSize,\n        extent,\n        startRow,\n        startCol,\n        globalColWidth,\n        colWidths,\n        rowHeight,\n        colLabelHeight,\n        padding\n    );\n}\n\nTableMorph.prototype.init = function (\n    table,\n    scrollBarSize,\n    extent,\n    startRow,\n    startCol,\n    globalColWidth,\n    colWidths,\n    rowHeight,\n    colLabelHeight,\n    padding\n) {\n    // additional properties:\n    this.table = table;\n    this.scrollBarSize = scrollBarSize || MorphicPreferences.scrollBarSize;\n    this.startRow = startRow || 1;\n    this.startCol = startCol || 1;\n    this.textHeight = Math.ceil(\n        fontHeight(SyntaxElementMorph.prototype.fontSize) * 1.3\n    );\n    this.rowHeight = rowHeight || this.textHeight;\n    this.colWidths = colWidths || [];\n    this.globalColWidth = globalColWidth || Math.ceil(this.textHeight * 3.5);\n    this.colLabelHeight = colLabelHeight || this.textHeight;\n    this.padding = padding || SyntaxElementMorph.prototype.scale; //1;\n    this.tableVersion = this.table.lastChanged;\n\n    // scroll bars:\n    this.hBar = null;\n    this.vBar = null;\n\n    // cached properties (do not persist):\n    this.rowLabelWidth = 0;\n    this.columns = []; // relative left positions\n    this.rows = 0;\n\n    // cached properties for scrolling and resizing (do not persist):\n    this.maxStartRow = null;\n    this.maxStartCol = null;\n    this.dragAnchor = null;\n    this.resizeAnchor = null;\n    this.resizeCol = null;\n    this.resizeRow = null;\n\n    // cached property for updating (don not persist):\n    this.wantsUpdate = false;\n\n    // initialize inherited properties:\n    // make sure not to draw anything just yet\n    // therefore omit FrameMorph's properties (not needed here)\n    // and only initialize properties inherited from Morph:\n    Morph.prototype.init.call(this, true);\n\n    // override inherited properites:\n    // this.fps = 3; // this will slow down the sliders (!)\n    if (extent) {this.bounds.setExtent(extent); }\n    this.initScrollBars();\n    this.fixLayout();\n};\n\nTableMorph.prototype.initScrollBars = function () {\n    var myself = this;\n\n    // horizontal scroll bar - scrolls columns\n    this.hBar = new SliderMorph(\n        1, // start\n        null, // stop\n        null, // value\n        null, // size\n        'horizontal'\n    );\n    this.hBar.setHeight(this.scrollBarSize);\n    this.hBar.action = function (num) {\n        myself.showData(num, null, true);\n    };\n    this.hBar.isDraggable = false;\n    this.add(this.hBar);\n\n    // vertical scroll bar - scrolls rows\n    this.vBar = new SliderMorph(\n        1, // start\n        null, // stop\n        null, // value\n        null, // size\n        'vertical'\n    );\n    this.vBar.setWidth(this.scrollBarSize);\n    this.vBar.action = function (num) {\n        myself.showData(null, num, true);\n    };\n    this.vBar.isDraggable = false;\n    this.add(this.vBar);\n};\n\nTableMorph.prototype.updateScrollBars = function () {\n    if (this.maxStartCol === 1) {\n        this.hBar.hide();\n    } else {\n        this.hBar.show();\n        this.hBar.stop = this.maxStartCol;\n        this.hBar.value = this.startCol;\n        this.hBar.size = Math.max(\n            this.hBar.rangeSize() * this.columns.length / this.table.cols(),\n            this.hBar.rangeSize() / 10\n        );\n        this.hBar.fixLayout();\n    }\n\n    this.vBar.stop = this.maxStartRow;\n    this.vBar.value = this.startRow;\n    if (this.maxStartRow === 1) {\n        this.vBar.hide();\n    } else {\n        this.vBar.show();\n        this.vBar.size = Math.max(\n            this.vBar.rangeSize() * this.rows / this.table.rows(),\n            this.vBar.rangeSize() / 10\n        );\n        this.vBar.fixLayout();\n    }\n};\n\nTableMorph.prototype.fixLayout = function () {\n    TableMorph.uber.fixLayout.call(this);\n\n    // determine and cache layout information\n    this.rowLabelWidth = this.rowLabelsWidth();\n    this.columns = this.columnsLayout();\n    this.rows = this.visibleRows();\n\n    this.buildCells();\n\n    // fix scroll bars layout\n    this.hBar.setWidth(this.width() - this.vBar.width());\n    this.hBar.setLeft(this.left());\n    this.hBar.setBottom(this.bottom());\n    this.vBar.setHeight(this.height() - this.hBar.height());\n    this.vBar.setRight(this.right());\n    this.vBar.setTop(this.top());\n};\n\nTableMorph.prototype.render = function (ctx) {\n    var w, i;\n    ctx.fillStyle = 'rgb(220, 220, 220)';\n    BoxMorph.prototype.outlinePath.call(\n        this,\n        ctx, SyntaxElementMorph.prototype.corner + 1,\n        0\n    );\n    ctx.fill();\n\n    // optionally draw grid\n    if (this.highContrast && this.table.cols() > 1) {\n        w = this.padding;\n        for (i = this.startCol; i <= this.table.cols(); i += 1) {\n            w += (this.colWidth(i) + this.padding);\n        }\n        ctx.fillStyle = 'darkGray';\n        ctx.fillRect(\n            this.padding + this.rowLabelWidth,\n            this.padding + this.colLabelHeight,\n            w,\n            (this.rowHeight + this.padding) *\n                (this.table.rows() + 1 - this.startRow) +\n                this.padding\n        );\n    }\n};\n\nTableMorph.prototype.buildCells = function () {\n    // also populate cells with the correct data and\n    // arrange the layout of cells all in one pass\n    var cell, r, c,\n        pos = this.position();\n\n    // delete all existing cells\n    this.children = [];\n\n    // create cells\n    for (c = 0; c <= this.columns.length; c += 1) {\n        for (r = 0; r <= this.rows; r += 1) {\n            cell = new TableCellMorph(\n                this.table.get(\n                    !c ? c : c + this.startCol - 1,\n                    !r ? r : r + this.startRow - 1\n                ),\n                new Point(\n                    !c ? this.rowLabelWidth\n                            : this.colWidth(c + this.startCol - 1),\n                    !r ? this.colLabelHeight : this.rowHeight\n                ),\n                !(r && c), // isLabel\n                false // should be list\n            );\n            cell.setPosition(\n                new Point(\n                    !c ? this.padding\n                            : this.columns[c - 1],\n                    !r ? this.padding :\n                            this.padding * 2 + this.colLabelHeight +\n                                ((r - 1) * (this.rowHeight + this.padding))\n                ).add(pos)\n            );\n            this.add(cell);\n            if (isSnapObject(cell.getData())) {\n                this.wantsUpdate = true;\n            }\n        }\n    }\n    this.add(this.hBar);\n    this.add(this.vBar);\n    this.updateScrollBars();\n};\n\nTableMorph.prototype.drawData = function (noScrollUpdate) {\n    // redraw all cells with their current data or label\n    var cell, cellIdx = 0, r, c;\n    for (c = 0; c <= this.columns.length; c += 1) {\n        for (r = 0; r <= this.rows; r += 1) {\n            cell = this.children[cellIdx];\n            cellIdx += 1;\n            cell.setData(\n                this.table.get(\n                    !c ? c : c + this.startCol - 1,\n                    !r ? r : r + this.startRow - 1\n                )\n            );\n            if (isSnapObject(cell.getData())) {\n                this.wantsUpdate = true;\n            }\n        }\n    }\n    if (!noScrollUpdate) {this.updateScrollBars(); }\n    this.changed();\n};\n\n// TableMorph scrolling\n\nTableMorph.prototype.scroll = function (xSteps, ySteps) {\n    this.showData(\n        Math.min(\n            this.maxStartCol,\n            Math.max(1, this.startCol + Math.round(xSteps))\n        ),\n        Math.min(\n            this.maxStartRow,\n            Math.max(1, this.startRow + Math.round(ySteps))\n        )\n    );\n    this.updateScrollBars();\n};\n\nTableMorph.prototype.showData = function (startCol, startRow, noScrollUpdate) {\n    var c = startCol || this.startCol,\n        r = startRow || this.startRow;\n    if (c === this.startCol) {\n        if (r === this.startRow) {return; } // no change\n        this.startRow = r;\n        this.rows = this.visibleRows();\n        this.drawData(noScrollUpdate);\n    } else {\n        this.startCol = c;\n        this.startRow = r;\n        this.rows = this.visibleRows();\n        if (this.colWidths.length) {\n            this.columns = this.columnsLayout();\n            this.buildCells();\n        } else {\n            this.drawData(noScrollUpdate);\n        }\n    }\n};\n\n// TableMorph stepping\n\nTableMorph.prototype.step = function () {\n    if (this.dragAnchor) {\n        this.shiftCells(this.world().hand.position());\n    } else if (this.resizeAnchor) {\n        this.resizeCells(this.world().hand.position());\n    }\n    this.update();\n};\n\nTableMorph.prototype.update = function () {\n    var oldCols, oldRows,\n        version = this.table instanceof List ?\n            this.table.version(\n                this.startRow,\n                this.rows,\n                this.startCol,\n                this.columns.length\n            ) : this.table.lastChanged;\n    if (this.tableVersion === version && !this.wantsUpdate) {\n        return;\n    }\n    this.wantsUpdate = false;\n    if (this.table instanceof List) {\n        oldCols = this.columns.length;\n        oldRows = this.rows;\n        this.rowLabelWidth = this.rowLabelsWidth();\n        this.columns = this.columnsLayout();\n        this.rows = this.visibleRows();\n        if (this.columns.length !== oldCols || (this.rows !== oldRows)) {\n            this.buildCells();\n        } else {\n            this.drawData();\n        }\n    } else { // Table\n        this.drawData();\n    }\n    this.tableVersion = version;\n};\n\n// TableMorph layout helpers (all private):\n\nTableMorph.prototype.rowLabelsWidth = function () {\n    var ctx = StringMorph.prototype.measureCtx;\n    ctx.font = 'italic ' + SyntaxElementMorph.prototype.fontSize +\n        'px Helvetica, Arial, sans-serif';\n    return Math.max(\n        0,\n        Math.max.apply(\n            null,\n            this.table.columnNames().map(\n                name => name ? ctx.measureText(name).width : 0\n            )\n        )\n    ) || ctx.measureText(this.table.rows().toString()).width +\n            (6 * SyntaxElementMorph.prototype.scale);\n};\n\nTableMorph.prototype.columnsLayout = function () {\n    // determines and maxStartCol and\n    // modifies startCol if needed\n    var c = [],\n        x = this.padding * 2 + this.rowLabelWidth,\n        colNum,\n        w;\n\n    // determine maxStartCol\n    colNum = this.table.cols();\n    w = x;\n    while (w < this.width() && colNum > 0) {\n        w += this.colWidth(colNum);\n        colNum -= 1;\n    }\n    if (colNum === 0 && (w < this.width())) {\n        this.maxStartCol = 1;\n    } else {\n        this.maxStartCol = Math.min(colNum + 2, this.table.cols());\n    }\n\n    // determine the left position of every shown column\n    this.startCol = Math.min(this.startCol, this.maxStartCol);\n    colNum = this.startCol;\n    while (x < this.width() &&\n        (colNum < (this.table.cols() + this.startCol))\n    ) {\n        w = this.colWidth(colNum);\n        c.push(x);\n        x += w;\n        x += this.padding;\n        colNum += 1;\n    }\n    return c;\n};\n\nTableMorph.prototype.colWidth = function (col) {\n    return this.colWidths[col - 1] || this.globalColWidth;\n};\n\nTableMorph.prototype.visibleRows = function () {\n    // determines maxStartRow and\n    // modifies startRow if needed\n    var rest = this.height() - this.colLabelHeight - this.padding,\n        possible;\n    if (rest < 0) {return 0; }\n    possible = Math.ceil(rest / (this.rowHeight + this.padding));\n    this.maxStartRow = Math.max(1, this.table.rows() - possible + 2);\n    this.startRow = Math.min(this.startRow, this.maxStartRow);\n    return Math.min(this.table.rows(), possible);\n};\n\nTableMorph.prototype.globalExtent = function () {\n    var i,\n        w = this.rowLabelsWidth() + 2,\n        cols = this.table.cols();\n    for (i = 0; i < cols; i += 1) {\n        w += this.colWidth(i + 1);\n        w += this.padding;\n    }\n    if (cols === 1) {\n        w += this.scrollBarSize;\n        w += this.padding * 2;\n    }\n    return new Point(\n        w + this.padding,\n        this.colLabelHeight + (this.padding * 2) +\n            ((this.rowHeight + this.padding) * this.table.rows())\n    );\n};\n\n// TableMorph events:\n\nTableMorph.prototype.mouseScroll = function (y, x) {\n    this.scroll(\n        -(+x * MorphicPreferences.mouseScrollAmount / 4),\n        -(+y * MorphicPreferences.mouseScrollAmount)\n    );\n};\n\nTableMorph.prototype.mouseDownLeft = function (pos) {\n    var rel = pos.subtract(this.position());\n    if (rel.x <= this.rowLabelWidth || (rel.y <= this.colLabelHeight)) {\n        // resize cells\n        if (this.world().currentKey === 16) { // shiftClicked\n            this.resizeCol = 0;\n        } else {\n            this.resizeCol = this.columnAt(rel.x);\n        }\n        this.resizeRow = (rel.y > (this.colLabelHeight));\n        this.resizeAnchor = pos;\n    } else {\n        // shift the viewed portion\n        this.resizeRow = null;\n        this.dragAnchor = pos;\n    }\n};\n\nTableMorph.prototype.mouseClickLeft = function (pos) {\n    this.dragAnchor = null;\n    this.resizeAnchor = null;\n        this.resizeRow = null;\n};\n\nTableMorph.prototype.mouseLeaveDragging = function (pos) {\n    this.dragAnchor = null;\n    this.resizeAnchor = null;\n        this.resizeRow = null;\n};\n\nTableMorph.prototype.mouseDoubleClick = function (pos) {\n    if (this.parentThatIsA(TableDialogMorph)) {\n        this.escalateEvent('mouseDoubleClick', pos);\n    } else {\n        new TableDialogMorph(\n            this.table,\n            this.globalColWidth,\n            this.colWidths,\n            this.rowHeight\n        ).popUp(this.world());\n    }\n};\n\n// TableMorph scrolling and resizing cells by \"hand\"\n\nTableMorph.prototype.shiftCells = function (pos) {\n    var delta = this.dragAnchor.subtract(pos),\n        scrollX = Math.round(delta.x / this.globalColWidth),\n        scrollY = Math.round(delta.y / this.rowHeight);\n    if (scrollX || scrollY) {\n        this.scroll(scrollX, scrollY);\n        this.dragAnchor = pos;\n    }\n};\n\nTableMorph.prototype.resizeCells = function (pos) {\n    var delta = pos.subtract(this.resizeAnchor),\n        i;\n\n    if (this.resizeCol) {\n        this.colWidths[this.resizeCol - 1] = Math.max(\n            16,\n            (this.colWidths[this.resizeCol - 1] || this.globalColWidth) +\n                delta.x\n        );\n    } else if (this.resizeRow) {\n        this.rowHeight = Math.max(16, this.rowHeight + delta.y);\n    } else {\n        this.globalColWidth = Math.max(16, this.globalColWidth + delta.x);\n        for (i = 0; i < this.colWidths.length; i += 1) {\n            if (this.colWidths[i]) {\n                this.colWidths[i] = Math.max(\n                    16,\n                    this.colWidths[i] + delta.x\n                );\n            }\n        }\n    }\n    this.rowLabelWidth = this.rowLabelsWidth();\n    this.columns = this.columnsLayout();\n    this.rows = this.visibleRows();\n    this.buildCells();\n    this.resizeAnchor = pos;\n    this.changed();\n};\n\nTableMorph.prototype.columnAt = function (relativeX) {\n    var c = 0;\n    if (relativeX < (this.columns[0])) {\n        return 0;\n    }\n    while (relativeX > this.columns[c]) {\n        c += 1;\n    }\n    return c + this.startCol - 1;\n};\n\n// TableMorph context menu\n\nTableMorph.prototype.userMenu = function () {\n    var menu = new MenuMorph(this);\n    if (this.parentThatIsA(TableDialogMorph)) {\n        if (this.colWidths.length) {\n            menu.addItem('reset columns', 'resetColumns');\n            menu.addLine();\n        }\n        if (this.table instanceof List && this.table.canBeJSON()) {\n            menu.addItem(\n                'blockify',\n                () => {\n                    var world = this.world(),\n                        ide = detect(\n                            world.children,\n                            m => m instanceof IDE_Morph\n                        );\n                    this.table.blockify().pickUp(world);\n                    world.hand.grabOrigin = {\n                        origin: ide.palette,\n                        position: ide.palette.center()\n                    };\n                }\n            );\n        }\n        menu.addItem('open in another dialog...', 'openInDialog');\n        return menu;\n    }\n\n    if (this.colWidths.length) {\n        menu.addItem('reset columns', 'resetColumns');\n    }\n    menu.addItem('list view...', 'showListView');\n    if (this.table instanceof List && this.table.canBeJSON()) {\n        menu.addItem(\n            'blockify',\n            () => {\n                var world = this.world(),\n                    ide = detect(world.children, m => m instanceof IDE_Morph);\n                this.table.blockify().pickUp(world);\n                world.hand.grabOrigin = {\n                    origin: ide.palette,\n                    position: ide.palette.center()\n                };\n            }\n        );\n    }\n    menu.addLine();\n    menu.addItem('open in dialog...', 'openInDialog');\n    return menu;\n};\n\nTableMorph.prototype.resetColumns = function () {\n    this.colWidths = [];\n    this.rowLabelWidth = this.rowLabelsWidth();\n    this.columns = this.columnsLayout();\n    this.rows = this.visibleRows();\n    this.buildCells();\n    this.changed();\n};\n\nTableMorph.prototype.openInDialog = function () {\n    new TableDialogMorph(\n        this.table,\n        this.globalColWidth,\n        this.colWidths,\n        this.rowHeight\n    ).popUp(this.world());\n};\n\nTableMorph.prototype.showListView = function () {\n    var view = this.parentThatIsA(\n        SpriteBubbleMorph,\n        SpeechBubbleMorph,\n        CellMorph\n    );\n    if (!view) {return; }\n    if (view instanceof SpriteBubbleMorph) {\n        view.changed();\n        view.contentsMorph.destroy();\n        view.contentsMorph = new ListWatcherMorph(this.table);\n        view.contentsMorph.step = view.contents.update;\n        view.contentsMorph.expand(this.extent());\n        view.parent.positionTalkBubble();\n    } else if (view instanceof SpeechBubbleMorph) {\n        view.contents = new ListWatcherMorph(this.table);\n        view.contents.step = view.contents.update;\n        view.contents.expand(this.extent());\n    } else { // watcher cell\n        view.changed();\n        view.contentsMorph.destroy();\n        view.contentsMorph = new ListWatcherMorph(this.table);\n        view.add(view.contentsMorph);\n        view.contentsMorph.setPosition(this.position());\n        view.contentsMorph.expand(this.extent());\n    }\n    view.fixLayout();\n    view.rerender();\n};\n\n// TableMorph updating:\n\nTableMorph.prototype.show = function () {\n    TableMorph.uber.show.call(this);\n    this.updateScrollBars();\n};\n\n// TableFrameMorph /////////////////////////////////////////////////////////\n\n// a UI for table morphs, for re-sizing tables and their columns\n\n// TableFrameMorph inherits from Morph:\n\nTableFrameMorph.prototype = new Morph();\nTableFrameMorph.prototype.constructor = TableFrameMorph;\nTableFrameMorph.uber = Morph.prototype;\n\n// TableFrameMorph instance creation:\n\nexport function TableFrameMorph(tableMorph, noResize) {\n    this.init(tableMorph, noResize);\n}\n\nTableFrameMorph.prototype.init = function (tableMorph, noResize) {\n    // additional properties:\n    this.tableMorph = tableMorph;\n    this.handle = null;\n\n    // initialize inherited properties:\n    TableFrameMorph.uber.init.call(this, true);\n\n    // override inherited properites:\n    this.color = 'transparent';\n    this.bounds = this.tableMorph.bounds.copy();\n    this.add(this.tableMorph);\n\n    if (!noResize) {\n        this.handle = new HandleMorph(\n            this, // target\n            80, // minX\n            25, // minY\n            null, // insetX\n            null // insetY\n        );\n    }\n\n    this.fixLayout();\n};\n\nTableFrameMorph.prototype.fixLayout = function () {\n    var ext = this.extent();\n    if (this.tableMorph.extent().eq(ext)) {return; }\n    this.tableMorph.setExtent(this.extent());\n    if (this.parent) {\n        this.parent.changed();\n        this.parent.fixLayout();\n        this.parent.rerender();\n   }\n};\n\n// TableFrameMorph result / speech balloon support:\n\nTableFrameMorph.prototype.expand = function (maxExtent) {\n    var ext = this.tableMorph.globalExtent();\n    if (maxExtent) {\n        ext = ext.min(maxExtent);\n    }\n    this.setExtent(ext);\n    this.handle.setRight(this.right());\n    this.handle.setBottom(this.bottom());\n};\n\n// TableDialogMorph inherits from DialogBoxMorph:\n\nTableDialogMorph.prototype = new DialogBoxMorph();\nTableDialogMorph.prototype.constructor = TableDialogMorph;\nTableDialogMorph.uber = DialogBoxMorph.prototype;\n\n// TableDialogMorph instance creation:\n\nexport function TableDialogMorph(data, globalColWidth, colWidths, rowHeight) {\n    this.init(data, globalColWidth, colWidths, rowHeight);\n}\n\nTableDialogMorph.prototype.init = function (\n    data,\n    globalColWidth,\n    colWidths,\n    rowHeight\n) {\n    // additional properties:\n    this.handle = null;\n    this.data = data;\n    this.tableView = null;\n\n    // initialize inherited properties:\n    TableDialogMorph.uber.init.call(this);\n\n    // override inherited properites:\n    this.labelString = 'Table view';\n    this.createLabel();\n\n    // build contents\n    this.buildContents(data, globalColWidth, colWidths, rowHeight);\n};\n\nTableDialogMorph.prototype.buildContents = function (\n    data,\n    globalColWidth,\n    colWidths,\n    rowHeight\n) {\n    this.tableView = new TableMorph(\n        data,\n        null, // scrollBarSize\n        null, // extent\n        null, // startRow\n        null, // startCol\n        globalColWidth,\n        colWidths,\n        rowHeight,\n        null, // colLabelHeight\n        null // padding\n    );\n    this.addBody(new TableFrameMorph(this.tableView, true));\n    this.addButton('ok', 'OK');\n};\n\nTableDialogMorph.prototype.setInitialDimensions = function () {\n    var world = this.world(),\n        mex = world.extent().subtract(new Point(this.padding, this.padding)),\n        th = fontHeight(this.titleFontSize) + this.titlePadding * 3, // hm...\n        bh = this.buttons.height();\n    this.setExtent(\n        this.tableView.globalExtent().add(\n            new Point(this.padding * 2, this.padding * 2 + th + bh)\n        ).min(mex).max(new Point(100, 100))\n    );\n    this.setCenter(this.world().center());\n};\n\nTableDialogMorph.prototype.popUp = function (world) {\n    if (world) {\n        TableDialogMorph.uber.popUp.call(this, world);\n        this.setInitialDimensions();\n        this.handle = new HandleMorph(\n            this,\n            100,\n            100,\n            this.corner,\n            this.corner\n        );\n    }\n};\n\n// TableDialogMorph.prototype.fixLayout =\n//     BlockEditorMorph.prototype.fixLayout;\n","import {Costume, isSnapObject, Sound, SpriteMorph, StageMorph} from \"./objects\";\nimport {\n  ArgMorph,\n  BlockMorph, CommandBlockMorph,\n  CommandSlotMorph,\n  CommentMorph, HatBlockMorph,\n  InputSlotMorph,\n  MultiArgMorph, ReporterBlockMorph, ReporterSlotMorph,\n  RingMorph, ScriptFocusMorph,\n  ScriptsMorph, SyntaxElementMorph, TemplateSlotMorph\n} from \"./blocks\";\nimport {BlockInputFragmentMorph, PrototypeHatBlockMorph} from \"./byob\";\nimport {\n  Color,\n  contains,\n  detect,\n  isNil, isString,\n  localize,\n  MenuMorph, Morph,\n  MorphicPreferences,\n  Point,\n  ScrollFrameMorph, SpeechBubbleMorph, TextMorph\n} from \"./morphic\";\nimport {SymbolMorph} from \"./symbols\";\nimport {DialogBoxMorph} from \"./widgets\";\nimport {IDE_Morph, SpriteIconMorph} from \"./gui\";\nimport {Context, Process} from \"./threads\";\nimport {ListWatcherMorph} from \"./lists\";\nimport {TableFrameMorph} from \"./tables\";\n\nBlockMorph.prototype.mouseClickLeft = function () {\n  var top = this.topBlock(),\n    receiver = top.scriptTarget(),\n    shiftClicked = this.world().currentKey === 16,\n    stage;\n  if (shiftClicked && !this.isTemplate) {\n    return this.selectForEdit().focus(); // enable coopy-on-edit\n  }\n  if (top instanceof PrototypeHatBlockMorph) {\n    return; // top.mouseClickLeft();\n  }\n  if (receiver) {\n    stage = receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      var process = stage.threads.findProcess(top);\n      if (process && !process.readyToTerminate) {\n        // Trace.log('Block.clickStopRun', top.blockId());\n      } else {\n        // Trace.log('Block.clickRun', top.blockId());\n      }\n      // Useful for debugging\n      window.lastRun = top;\n      stage.threads.toggleProcess(top, receiver);\n    }\n  }\n};\n\nBlockMorph.prototype.activeProcess = function () {\n  var top = this.topBlock(),\n    receiver = top.scriptTarget(),\n    stage;\n  if (top instanceof PrototypeHatBlockMorph) {\n    return null;\n  }\n  if (receiver) {\n    stage = receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      return stage.threads.findProcess(top, receiver);\n    }\n  }\n  return null;\n};\n\n\nScriptsMorph.prototype.closestInput = function (reporter, hand) {\n  // passing the hand is optional (when dragging reporters)\n  var fb = reporter.fullBoundsNoShadow(),\n    stacks = this.children.filter(child =>\n      (child instanceof BlockMorph) &&\n      (child.fullBounds().intersects(fb))\n    ),\n    blackList = reporter.allInputs(),\n    handPos,\n    target,\n    all;\n\n  all = [];\n  stacks.forEach(stack =>\n    all = all.concat(stack.allInputs())\n  );\n  if (all.length === 0) {return null; }\n\n  function touchingVariadicArrowsIfAny(inp, point) {\n    if (inp instanceof MultiArgMorph) {\n      if (point) {\n        return inp.arrows().bounds.containsPoint(point);\n      }\n      return inp.arrows().bounds.intersects(fb);\n    }\n    return true;\n  }\n\n  if (this.isPreferringEmptySlots) {\n    if (hand) {\n      handPos = hand.position();\n      target = detect(\n        all,\n        input => (input instanceof InputSlotMorph ||\n            (input instanceof ArgMorph &&\n              !(input instanceof CommandSlotMorph) &&\n              !(input instanceof MultiArgMorph)\n            ) ||\n            (input instanceof RingMorph && !input.contents()) ||\n            input.isEmptySlot()\n          ) &&\n          !input.isLocked() &&\n          input.bounds.containsPoint(handPos) &&\n          !contains(blackList, input)\n      );\n      if (target) {\n        return target;\n      }\n    }\n    target = detect(\n      all,\n      input => (input instanceof InputSlotMorph ||\n          input instanceof ArgMorph ||\n          (input instanceof RingMorph && !input.contents()) ||\n          input.isEmptySlot()\n        ) &&\n        !input.isLocked() &&\n        input.bounds.intersects(fb) &&\n        !contains(blackList, input) &&\n        touchingVariadicArrowsIfAny(input, handPos)\n    );\n    if (target) {\n      return target;\n    }\n  }\n\n  if (hand) {\n    handPos = hand.position();\n    target = detect(\n      all,\n      input => (input !== reporter) &&\n        !input.isLocked() &&\n        input.bounds.containsPoint(handPos) &&\n        !(input.parent instanceof PrototypeHatBlockMorph) &&\n        !contains(blackList, input) &&\n        touchingVariadicArrowsIfAny(input, handPos)\n    );\n    if (target) {\n      return target;\n    }\n  }\n  return detect(\n    all,\n    input => (input !== reporter) &&\n      !input.isLocked() &&\n      input.fullBounds().intersects(fb) &&\n      !(input.parent instanceof PrototypeHatBlockMorph) &&\n      !contains(blackList, input) &&\n      touchingVariadicArrowsIfAny(input)\n  );\n};\n\nScriptsMorph.prototype.cleanUp = function (silently) {\n  if (!silently) {\n    // Trace.log('Scripts.cleanUp');\n  }\n  var target = this.selectForEdit(), // enable copy-on-edit\n    origin = target.topLeft(),\n    y = target.cleanUpMargin;\n  target.children.sort((a, b) =>\n    // make sure the prototype hat block always stays on top\n    a instanceof PrototypeHatBlockMorph ? 0 : a.top() - b.top()\n  ).forEach(child => {\n    if (child instanceof CommentMorph && child.block) {\n      return; // skip anchored comments\n    }\n    child.setPosition(origin.add(new Point(target.cleanUpMargin, y)));\n    if (child instanceof BlockMorph) {\n      child.allComments().forEach(comment =>\n        comment.align(child, true) // ignore layer\n      );\n    }\n    y += child.stackHeight() + target.cleanUpSpacing;\n  });\n  if (target.parent) {\n    target.setPosition(target.parent.topLeft());\n  }\n  target.adjustBounds();\n};\n\nScriptsMorph.prototype.sortedElements = function () {\n  // return all scripts and unattached comments\n  var scripts = this.children.filter(each =>\n    each instanceof CommentMorph ? !each.block : true\n  );\n  scripts.sort((a, b) =>\n    // make sure the prototype hat block always stays on top\n    a instanceof PrototypeHatBlockMorph ? 0 : a.top() - b.top()\n  );\n  return scripts;\n};\n\nArgMorph.prototype.reactToSliderEdit = function () {\n  /*\n      directly execute the stack of blocks I'm part of if my\n      \"executeOnSliderEdit\" setting is turned on, obeying the stage's\n      thread safety setting. This feature allows for \"Bret Victor\" style\n      interactive coding.\n  */\n  var block, top, receiver, stage;\n  if (!this.executeOnSliderEdit) {return; }\n  block = this.parentThatIsA(BlockMorph);\n  if (block) {\n    top = block.topBlock();\n    receiver = top.scriptTarget();\n    if (top instanceof PrototypeHatBlockMorph) {\n      return;\n    }\n    if (receiver) {\n      stage = receiver.parentThatIsA(StageMorph);\n      if (stage && (stage.isThreadSafe ||\n        Process.prototype.enableSingleStepping)) {\n        stage.threads.startProcess(top, receiver, stage.isThreadSafe);\n      } else {\n        top.mouseClickLeft();\n      }\n    }\n  }\n};\n\nScriptFocusMorph.prototype.shiftScript = function (deltaPoint) {\n  var tb;\n  if (this.element instanceof ScriptsMorph) {\n    this.moveBy(deltaPoint);\n  } else {\n    tb = this.element.topBlock();\n    if (tb && !(tb instanceof PrototypeHatBlockMorph)) {\n      tb.moveBy(deltaPoint);\n    }\n  }\n  this.editor.adjustBounds();\n  this.fixLayout();\n};\n\n\nScriptFocusMorph.prototype.sortedScripts = function () {\n  var scripts = this.editor.children.filter(each =>\n    each instanceof BlockMorph\n  );\n  scripts.sort((a, b) =>\n    // make sure the prototype hat block always stays on top\n    a instanceof PrototypeHatBlockMorph ? 0 : a.top() - b.top()\n  );\n  return scripts;\n};\n\nSyntaxElementMorph.prototype.getVarNamesDict = function () {\n  var block = this.parentThatIsA(BlockMorph),\n    rcvr,\n    tempVars = [],\n    dict;\n\n  if (!block) {\n    return {};\n  }\n  rcvr = block.scriptTarget();\n  block.allParents().forEach(morph => {\n    if (morph instanceof PrototypeHatBlockMorph) {\n      tempVars.push.apply(\n        tempVars,\n        morph.variableNames()\n      );\n      tempVars.push.apply(\n        tempVars,\n        morph.inputs()[0].inputFragmentNames()\n      );\n    } else if (morph instanceof BlockMorph) {\n      morph.inputs().forEach(inp => {\n        inp.allChildren().forEach(child => {\n          if (child instanceof TemplateSlotMorph) {\n            tempVars.push(child.contents());\n          } else if (child instanceof MultiArgMorph) {\n            child.children.forEach(m => {\n              if (m instanceof TemplateSlotMorph) {\n                tempVars.push(m.contents());\n              }\n            });\n          }\n        });\n      });\n    }\n  });\n  if (rcvr) {\n    dict = rcvr.variables.allNamesDict();\n    tempVars.forEach(name =>\n      dict[name] = name\n    );\n    if (block.selector === 'doSetVar') {\n      // add settable object attributes\n      dict['~'] = null;\n      dict.my = [{// wrap the submenu into a 1-item array to translate it\n        'anchor' : ['my anchor'],\n        'parent' : ['my parent'],\n        'name' : ['my name'],\n        'temporary?' : ['my temporary?'],\n        'dangling?' : ['my dangling?'],\n        'draggable?' : ['my draggable?'],\n        'rotation style' : ['my rotation style'],\n        'rotation x' : ['my rotation x'],\n        'rotation y' : ['my rotation y']\n      }];\n      if (this.world().currentKey === 16) { // shift\n        dict.my[0]['~'] = null; // don't forget we're inside an array...\n        dict.my[0]['microphone modifier'] = ['microphone modifier'];\n      }\n    }\n    return dict;\n  }\n  return {};\n};\n\nBlockMorph.prototype.codeDefinitionHeader = function () {\n  var block = this.isCustomBlock ? new PrototypeHatBlockMorph(this.definition)\n    : SpriteMorph.prototype.blockForSelector(this.selector),\n    hat = new HatBlockMorph(),\n    count = 1;\n\n  if (this.isCustomBlock) {return block; }\n  block.inputs().forEach(input => {\n    var part = new TemplateSlotMorph('#' + count);\n    block.replaceInput(input, part);\n    count += 1;\n  });\n  block.isPrototype = true;\n  hat.setCategory(\"control\");\n  hat.setSpec('%s');\n  hat.replaceInput(hat.inputs()[0], block);\n  if (this.category === 'control') {\n    hat.alternateBlockColor();\n  }\n  return hat;\n};\n\n\nReporterBlockMorph.prototype.mouseClickLeft = function (pos) {\n  var label,\n    myself = this;\n  if (this.parent instanceof BlockInputFragmentMorph) {\n    return this.parent.mouseClickLeft();\n  }\n  if (this.parent instanceof TemplateSlotMorph) {\n    if (this.parent.parent && this.parent.parent.parent &&\n      this.parent.parent.parent instanceof RingMorph) {\n      label = \"Input name\";\n    } else if (this.parent.parent.elementSpec === '%blockVars') {\n      label = \"Block variable name\";\n    } else {\n      label = \"Script variable name\";\n    }\n    new DialogBoxMorph(\n      this,\n      function(arg) {\n        // Trace.log('TemplateArg.rename', {\n        //     'id': myself.parent.argId(),\n        //     'name': arg,\n        // });\n        myself.userSetSpec(arg);\n      },\n      this\n    ).prompt(\n      label,\n      this.blockSpec,\n      this.world()\n    );\n  } else {\n    ReporterBlockMorph.uber.mouseClickLeft.call(this, pos);\n  }\n};\n\n\nexport {BlockMorph, ReporterBlockMorph};\n","/*\n\n    locale.js\n\n    spoken language translation for SNAP!\n\n    written by Jens Mnig\n\n    Copyright (C) 2020 by Jens Mnig\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    Attention Translators!\n    ----------------------\n    Please refer to the documentation in the file\n\n        lang-de.js\n\n    or to the section titled\n\n        Translating Snap!\n\n    in the file\n\n        Contributing.md\n\n    (same contents) if you would like to contribute.\n\n*/\n\n// Global settings /////////////////////////////////////////////////////\n\n/*global modules, contains*/\nimport {modules, contains} from './morphic.js'\nmodules.locale = '2020-November-20';\n\n// Global stuff\n\n// export var Localizer;\nexport var SnapTranslator = new Localizer();\n\nexport function localize(string) {\n    return SnapTranslator.translate(string);\n}\n\n// Localizer /////////////////////////////////////////////////////////////\n\nexport function Localizer(language, dict) {\n    this.language = language || 'en';\n    this.dict = dict || {};\n}\n\nLocalizer.prototype.translate = function (string) {\n    return Object.prototype.hasOwnProperty.call(\n        this.dict[this.language],\n        string\n    ) ? this.dict[this.language][string] : string;\n};\n\nLocalizer.prototype.languages = function () {\n    var property, arr = [];\n    for (property in this.dict) {\n        if (Object.prototype.hasOwnProperty.call(this.dict, property)) {\n            arr.push(property);\n        }\n    }\n    return arr.sort();\n};\n\nLocalizer.prototype.languageName = function (lang) {\n    return this.dict[lang].language_name || lang;\n};\n\nLocalizer.prototype.credits = function () {\n    var txt = '';\n    this.languages().forEach(lang => {\n        txt = txt + '\\n'\n            + this.languageName(lang)\n            + ' (' + lang + ') - '\n            + this.dict[lang].language_translator\n            + ' - ' + this.dict[lang].last_changed;\n    });\n    return txt;\n};\n\nLocalizer.prototype.unload = function () {\n    var dict,\n        keep = ['language_name', 'language_translator', 'last_changed'];\n    this.languages().forEach(lang => {\n        var key;\n        if (lang !== 'en') {\n            dict = this.dict[lang];\n            for (key in dict) {\n                if (Object.prototype.hasOwnProperty.call(dict, key)\n                        && !contains(keep, key)) {\n                    delete dict[key];\n                }\n            }\n        }\n    });\n};\n\n// SnapTranslator initialization\n\nSnapTranslator.dict.en = {\n    // meta information\n    'language_name':\n        'English',\n    'language_translator':\n        'Jens M\\u00F6nig',\n    'translator_e-mail':\n        'jens@moenig.org',\n    'last_changed':\n        '2020-07-09',\n\n    // symbols in dropdowns\n    '__shout__go__':\n        'green flag clicked',\n\n    // rewordings in English avoiding having to adjust all other translations\n    'any':\n        'random',\n    'length of %s':\n        'length of text %s',\n\n    // long strings look-up only\n    'file menu import hint':\n        'load an exported project file\\nor block library, a costume\\n'\n            + 'or a sound',\n    'settings menu prefer empty slots hint':\n        'check to focus on empty slots\\nwhen dragging & '\n                + 'dropping reporters',\n    'costumes tab help':\n        'import a picture from another web page or from\\n'\n            + 'a file on your computer by dropping it here\\n',\n    'block deletion dialog text':\n        'Are you sure you want to delete this\\n'\n            + 'custom block and all its instances?',\n    'download to disk text':\n        'This item could not be opened in a new tab.\\n' +\n        'It has been saved to your browser\\'s downloads folder.',\n    'unable to export text':\n        'This item could not be exported from Snap!.\\n' +\n        'It\\'s likely that your project may contain a lot of media ' +\n        '(sounds and images) or that you are using an older browser.' +\n        'Please try using a recent version of Chrome, Firefox, or Safari.'\n};\n\nSnapTranslator.dict.de = {\n    'language_name':\n        'Deutsch',\n    'language_translator':\n        'Jens M\\u00F6nig, Jadga H\\u00fcgle',\n    'translator_e-mail':\n        'jens@moenig.org, jadga.huegle@sap.com',\n    'last_changed':\n        '2020-11-02'\n};\n\nSnapTranslator.dict.it = {\n    'language_name':\n        'Italiano',\n    'language_translator':\n        'Stefano Federici, Alberto Firpo, Massimo Ghisalberti',\n    'translator_e-mail':\n        's_federici@yahoo.com, albertofirpo12@gmail.com, zairik@gmail.com',\n    'last_changed':\n        '2020-11-19'\n};\n\nSnapTranslator.dict.ja = {\n    'language_name':\n        '',\n    'language_translator':\n        'Kazuhiro Abe',\n    'translator_e-mail':\n        'abee@squeakland.jp',\n    'last_changed':\n        '2020-07-03'\n};\n\nSnapTranslator.dict.ja_HIRA = {\n    'language_name':\n        '',\n    'language_translator':\n        'Kazuhiro Abe',\n    'translator_e-mail':\n        'abee@squeakland.jp',\n    'last_changed':\n        '2018-10-23'\n};\n\nSnapTranslator.dict.ko = {\n    'language_name':\n        '',\n    'language_translator':\n        'Yunjae Jang',\n    'translator_e-mail':\n        'janggoons@gmail.com',\n    'last_changed':\n        '2015-01-21'\n};\n\nSnapTranslator.dict.pt = {\n    'language_name':\n        'Portugus',\n    'language_translator':\n        'Manuel Menezes de Sequeira',\n    'translator_e-mail':\n        'mmsequeira@gmail.com',\n    'last_changed':\n        '2020-08-03'\n};\n\nSnapTranslator.dict.cs = {\n    'language_name':\n        'esky',\n    'language_translator':\n        'Michal Moc, Jan Tomsa',\n    'translator_e-mail':\n        'info@iguru.eu, jan.tomsa.1976@gmail.com',\n    'last_changed':\n        '2015-11-16'\n};\n\nSnapTranslator.dict.zh_CN = {\n    'language_name':\n        '',\n    'language_translator':\n        '//',\n    'translator_e-mail':\n        'ubertao@qq.com/djh@rhjxx.cn',\n    'last_changed':\n        '2020-07-03'\n};\n\nSnapTranslator.dict.eo = {\n    'language_name':\n        'Esperanto',\n    'language_translator':\n        'Sebastian Cyprych',\n    'translator_e-mail':\n        'sebacyp(heliko)gmail(punkto)com',\n    'last_changed':\n        '2017-10-01'\n};\n\nSnapTranslator.dict.fr = {\n    'language_name':\n        'Fran\\u00E7ais',\n    'language_translator':\n        'Jean-Jacques Valliet, Mark Rafter, Martin Quinson, Damien Caselli',\n    'translator_e-mail':\n        'i.scool@mac.com',\n    'last_changed':\n        '2020-10-28'\n};\n\nSnapTranslator.dict.si = {\n    'language_name':\n        'Sloven\\u0161\\u010Dina',\n    'language_translator':\n        'Sasa Divjak, Gorazd Breskvar',\n    'translator_e-mail':\n        'sasa.divjak@fri.uni-lj.si',\n    'last_changed':\n        '2016-04-22'\n};\n\nSnapTranslator.dict.ru = {\n    'language_name':\n        '',\n    'language_translator':\n        'Svetlana Ptashnaya,  , Pavel Belousov',\n    'translator_e-mail':\n        'svetlanap@berkeley.edu, tema@school830.ru, pbsite@mail.ru',\n    'last_changed':\n        '2020-11-02'\n};\n\nSnapTranslator.dict.es = {\n    'language_name':\n        'Espa\\u00F1ol',\n    'language_translator':\n        'V\\u00EDctor Manuel Muratalla Morales / Cristi\\u00E1n Rizzi Iribarren / Alfonso Ruzafa',\n    'translator_e-mail':\n        'victor.muratalla@yahoo.com / rizzi.cristian@gmail.com',\n    'last_changed':\n        '2020-11-19'\n};\n\nSnapTranslator.dict.nl = {\n    'language_name':\n        'Nederlands',\n    'language_translator':\n        'Sjoerd Dirk Meijer, Frank Sierens, Jan-Gerard van der Toorn',\n    'translator_e-mail':\n        'sjoerddirk@fromScratchEd.nl, frank.sierens@telenet.be, jg.2019@xs4all.nl',\n    'last_changed':\n        '2017-09-01'\n};\n\nSnapTranslator.dict.pl = {\n    'language_name':\n        'Polski',\n    'language_translator':\n        'Witek Kranas & deKrain',\n    'translator_e-mail':\n        'witek@oeiizk.waw.pl',\n    'last_changed':\n        '2017-11-09'\n};\n\nSnapTranslator.dict.zh_TW = {\n    'language_name':\n        '',\n    'language_translator':\n        'cch',\n    'translator_e-mail':\n        'cchuang2009@gmail.com',\n    'last_changed':\n        '2013-8-14'\n};\n\nSnapTranslator.dict.no = {\n    'language_name':\n        'Norsk',\n    'language_translator':\n        'Olav A Marschall',\n    'translator_e-mail':\n        'olavmarschall@gmail.com',\n    'last_changed':\n        '2020-08-19'\n};\n\nSnapTranslator.dict.dk = {\n    'language_name':\n        'Dansk',\n    'language_translator':\n        'FAB, Pelle Hjek',\n    'translator_e-mail':\n        'fab@nielsen.mail.dk, hjek@mail.com',\n    'last_changed':\n        '2016-11-16'\n};\n\nSnapTranslator.dict.el = {\n    'language_name':\n        '',\n    'language_translator':\n        'Ino Samaras, Alexandros Prekates, HM100',\n    'translator_e-mail':\n        'ino.samaras@berkeley.edu, aprekates@sch.gr',\n    'last_changed':\n        '2020-10-09'\n};\n\nSnapTranslator.dict.ca = {\n    'language_name':\n        'Catal',\n    'language_translator':\n        'Bernat Romagosa Carrasquer, Joan Guilln i Pelegay',\n    'translator_e-mail':\n        'bernat@snap4arduino.rocks, jguille2@xtec.cat',\n    'last_changed':\n        '2020-08-31'\n};\n\nSnapTranslator.dict.ca_VA = {\n    'language_name':\n    \t'Catal - Valenci',\n    'language_translator':\n        'Bernat Romagosa Carrasquer, Joan Guilln i Pelegay, Pilar Embid',\n    'translator_e-mail':\n        'bernat@snap4arduino.rocks, jguille2@xtec.cat, embid_mar@gva.es',\n    'last_changed':\n        '2018-02-08'\n};\n\nSnapTranslator.dict.fi = {\n    'language_name':\n        'suomi',\n    'language_translator':\n        'Jouni K. Sepp\\u00e4nen',\n    'translator_e-mail':\n        'jks@iki.fi',\n    'last_changed':\n        '2014-04-18'\n};\n\nSnapTranslator.dict.sv = {\n    'language_name':\n        'svenska',\n    'language_translator':\n        'Erik A. Olsson',\n    'translator_e-mail':\n        'eolsson@gmail.com',\n    'last_changed':\n        '2016-06-09'\n};\n\nSnapTranslator.dict.pt_BR = {\n    'language_name':\n        'Portugus do Brasil',\n    'language_translator':\n        'Aldo von Wangenheim',\n    'translator_e-mail':\n        'awangenh@inf.ufsc.br',\n    'last_changed':\n        '2014-04-20'\n};\n\nSnapTranslator.dict.bn = {\n    'language_name':\n        '',\n    'language_translator':\n        'Dr. Mokter Hossain, Radman Siddiki',\n    'translator_e-mail':\n        'mokter@gmail.com, radman.siddiki@outlook.com',\n    'last_changed':\n        '2020-07-04'\n};\n\nSnapTranslator.dict.kn = {\n    'language_name':\n        '\\u0C95\\u0CA8\\u0CCD\\u0CA8\\u0CA1',\n    'language_translator':\n        'Vinayakumar R',\n    'translator_e-mail':\n        'vnkmr7620@gmail.com',\n    'last_changed':\n        '2014-12-02'\n};\n\nSnapTranslator.dict.ml = {\n    'language_name':\n        'Malayalam',\n    'language_translator':\n        'vinayakumar R',\n    'translator_e-mail':\n        'vnkmr7620@gmail.com',\n    'last_changed':\n        '2015-02-20'\n};\n\nSnapTranslator.dict.ta = {\n    'language_name':\n        'Tamil',\n    'language_translator':\n        'vinayakumar R',\n    'translator_e-mail':\n        'vnkmr7620@gmail.com',\n    'last_changed':\n        '2015-02-20'\n};\n\nSnapTranslator.dict.te = {\n    'language_name':\n        'Telagu', // the name as it should appear in the language menu\n    'language_translator':\n        'vinayakumar R', // your name for the Translators tab\n    'translator_e-mail':\n        'vnkmr7620@gmail.com', // optional\n    'last_changed':\n        '2015-02-20'\n};\n\nSnapTranslator.dict.tr = {\n    'language_name':\n        'Trke',\n    'language_translator':\n        'Turgut Gneysu, Hakan Atas',\n    'translator_e-mail':\n        'tguneysu@msn.com', // hakanatas@gmail.com, mustafaipekbayrak@gmail.com',\n    'last_changed':\n        '2020-09-20'\n};\n\nSnapTranslator.dict.hu = {\n    'language_name':\n        'Magyar',\n    'language_translator':\n        'Makny Gyrgy',\n    'translator_e-mail':\n        'makany.gyorgy@gmail.com',\n    'last_changed':\n        '2015-07-27'\n};\n\nSnapTranslator.dict.ia = {\n    'language_name':\n        'Interlingua',\n    'language_translator':\n        'Ken Dickey',\n    'translator_e-mail':\n        'Ken.Dickey@whidbey.com',\n    'last_changed':\n        '2015-08-09'\n};\n\nSnapTranslator.dict.hr = {\n    'language_name':\n        'Hrvatski',\n    'language_translator':\n        '\\u017Deljko Hrvoj',\n    'translator_e-mail':\n        'zeljko.hrvoj@zg.t-com.hr',\n    'last_changed':\n        '2017-08-15'\n};\n\nSnapTranslator.dict.bg = {\n    'language_name':\n        '',\n    'language_translator':\n        'Ivan Savov',\n    'translator_e-mail':\n        'ivan.savov@gmail.com',\n    'last_changed':\n        '2015-11-16'\n};\n\nSnapTranslator.dict.ro = {\n    'language_name':\n        'Romn',\n    'language_translator':\n        'Cristian Macarascu',\n    'translator_e-mail':\n        '',\n    'last_changed':\n        '2015-10-24'\n};\n\nSnapTranslator.dict.ar = {\n    'language_name':\n        '', // the name as it should appear in the language menu\n    'language_translator':\n        ' ', // your name for the Translators tab\n    'translator_e-mail':\n        'tarekgalal46@hotmail.com', // optional\n    'last_changed':\n        '2016-02-24'\n};\n\nSnapTranslator.dict.id = {\n    'language_name':\n        'Bahasa Indonesia',\n    'language_translator':\n        'Alexander Raphael Liu, Emmanuella Rumanti',\n    'translator_e-mail':\n        'raphaxander@gmail.com',\n    'last_changed':\n        '2019-01-21'\n};\n\nSnapTranslator.dict.et = {\n    'language_name':\n        'Eesti',\n    'language_translator':\n        'Hasso Tepper',\n    'translator_e-mail':\n        'hasso.tepper@gmail.com',\n    'last_changed':\n        '2016-05-03'\n};\n\nSnapTranslator.dict.gl = {\n    'language_name':\n        'Galego',\n    'language_translator':\n        'tecnoloxia <2016>,Miguel A. Bouzada <2019>',\n    'translator_e-mail':\n        'mbouzada@gmail.com',\n    'last_changed':\n        '2019-07-29'\n};\n\nSnapTranslator.dict.eu = {\n    'language_name':\n        'Euskara',\n    'language_translator':\n        'Asier Iturralde Sarasola',\n    'translator_e-mail':\n        'aiturralde@iametza.eus',\n    'last_changed':\n        '2018-06-26'\n};\n\nSnapTranslator.dict.ua = {\n    'language_name':\n        '',\n    'language_translator':\n        'Serhiy Kryzhanovsky',\n    'translator_e-mail':\n        'kseryj@gmail.com',\n    'last_changed':\n        '2018-08-21'\n};\n\nSnapTranslator.dict.sk = {\n    'language_name':\n        'Sloven\\u010Dina',\n    'language_translator':\n        'Peter Luka\\u010Dovi\\u010D',\n    'translator_e-mail':\n        'peter_lukacovic@outlook.com',\n    'last_changed':\n        '2019-12-10'\n};\n\nSnapTranslator.dict.he = {\n    'language_name':\n        '',\n    'language_translator':\n        ' ',\n    'translator_e-mail':\n        'cohenyossi81@gmail.com',\n    'last_changed':\n        '2020-04-21'\n};\n\nSnapTranslator.dict.eu = {\n    'language_name':\n        'Euskara',\n    'language_translator':\n        'Asier Iturralde Sarasola',\n    'translator_e-mail':\n        'aiturralde@iametza.eus',\n    'last_changed':\n        '2018-06-26'\n};\n\nSnapTranslator.dict.ua = {\n    'language_name':\n        '',\n    'language_translator':\n        'Serhiy Kryzhanovsky',\n    'translator_e-mail':\n        'kseryj@gmail.com',\n    'last_changed':\n        '2018-10-14'\n};\n","/*\n    paint.js\n\n    a paint editor for Snap!\n    inspired by the Scratch paint editor.\n\n    written by Kartik Chandra\n    Copyright (C) 2019 by Kartik Chandra\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    toc\n    ---\n    the following list shows the order in which all constructors are\n    defined. Use this list to locate code in this document:\n\n        PaintEditorMorph\n        PaintColorPickerMorph\n        PaintCanvasMorph\n\n\n    credits\n    -------\n    Nathan Dinsmore contributed a fully working prototype,\n    Nathan's brilliant flood-fill tool has been more or less\n    directly imported into this paint implementation.\n\n    Jens Mnig has contributed icons and bugfixes and says he has probably\n    introduced many other bugs in that process. :-)\n\n\n    revision history\n    ----------------\n    May 10 - first full release (Kartik)\n    May 14 - bugfixes, Snap integration (Jens)\n    May 16 - flat design adjustments (Jens)\n    July 12 - pipette tool, code formatting adjustments (Jens)\n    Sept 16 - flood fill freeze fix (Kartik)\n    Jan 08 - mouse leave dragging fix (Kartik)\n    Feb 11 - dynamically adjust to stage dimensions (Jens)\n    Apr 30 - localizations (Manuel)\n    June 3 - transformations (Kartik)\n    June 4 - tweaks (Jens)\n    Aug 24 - floodfill alpha-integer issue (Kartik)\n    Sep 29 - tweaks (Jens)\n    Sep 28 [of the following year :)] - Try to prevent antialiasing (Kartik)\n    Oct 02 - revert disable smoothing (Jens)\n    Dec 15 - center rotation point on costume creating (Craxic)\n    Jan 18 - avoid pixel collision detection in PaintCanvas (Jens)\n    Mar 22 - fixed automatic rotation center point mechanism (Jens)\n    May 10 - retina display support adjustments (Jens)\n    2017\n    Apr 10 - getGlobalPixelColor adjustment for Chrome & retina (Jens)\n    2018\n    Jan 22 - floodfill alpha tweak (Bernat)\n    Mar 19 - vector paint editor (Bernat)\n\n    2020 Apr 14 - Morphic2 migration (Jens)\n    2020 May 17 - Pipette alpha fix (Joan)\n    2020 July 13 - modified scale buttons (Jadga)\n*/\n\n/*global Point, Rectangle, DialogBoxMorph, AlignmentMorph, PushButtonMorph,\nColor, SymbolMorph, newCanvas, Morph, StringMorph, Costume, SpriteMorph, nop,\nlocalize, InputFieldMorph, SliderMorph, ToggleMorph, ToggleButtonMorph,\nBoxMorph, modules, radians, MorphicPreferences, getDocumentPositionOf,\nStageMorph, isNil, SVG_Costume*/\n\n// Global stuff ////////////////////////////////////////////////////////\n\nimport {\n  BoxMorph,\n  Color, getDocumentPositionOf, isNil,\n  modules,\n  Morph, MorphicPreferences,\n  newCanvas,\n  nop,\n  Point,\n  radians,\n  Rectangle,\n  SliderMorph,\n  StringMorph\n} from \"./morphic\";\nimport {\n  AlignmentMorph,\n  DialogBoxMorph,\n  InputFieldMorph,\n  PushButtonMorph,\n  ToggleButtonMorph,\n  ToggleMorph\n} from \"./widgets\";\nimport {SymbolMorph} from \"./symbols\";\nimport {Costume, SpriteMorph, StageMorph, SVG_Costume} from \"./objects\";\nimport {localize} from \"./locale\";\n\nmodules.paint = '2020-July-13';\n\n// Declarations\n\n// var PaintEditorMorph;\n// var PaintCanvasMorph;\n// var PaintColorPickerMorph;\n\n// PaintEditorMorph //////////////////////////\n\n// A complete paint editor\n\nPaintEditorMorph.prototype = new DialogBoxMorph();\nPaintEditorMorph.prototype.constructor = PaintEditorMorph;\nPaintEditorMorph.uber = DialogBoxMorph.prototype;\n\nPaintEditorMorph.prototype.padding = 10;\n\nexport function PaintEditorMorph() {\n    this.init();\n}\n\nPaintEditorMorph.prototype.init = function () {\n    // additional properties:\n    this.paper = null; // paint canvas\n    this.oncancel = null;\n\n    // initialize inherited properties:\n    PaintEditorMorph.uber.init.call(this);\n\n    // override inherited properties:\n    this.labelString = \"Paint Editor\";\n    this.createLabel();\n\n    // build contents:\n    this.buildContents();\n};\n\nPaintEditorMorph.prototype.buildContents = function () {\n    var myself = this;\n\n    this.paper = new PaintCanvasMorph(function () {return myself.shift; });\n    this.paper.setExtent(StageMorph.prototype.dimensions);\n\n    this.addBody(new AlignmentMorph('row', this.padding));\n    this.controls = new AlignmentMorph('column', this.padding / 2);\n    this.controls.alignment = 'center';\n\n    this.edits = new AlignmentMorph('row', this.padding / 2);\n    this.buildEdits();\n    this.controls.add(this.edits);\n\n    this.body.color = this.color;\n\n    this.body.add(this.controls);\n    this.body.add(this.paper);\n\n    this.toolbox = new BoxMorph();\n    this.toolbox.color = SpriteMorph.prototype.paletteColor.lighter(8);\n    this.toolbox.borderColor = this.toolbox.color.lighter(40);\n    if (MorphicPreferences.isFlat) {\n        this.toolbox.edge = 0;\n    }\n\n    this.buildToolbox();\n    this.controls.add(this.toolbox);\n\n    this.scaleBox = new AlignmentMorph('row', this.padding / 2);\n    this.buildScaleBox();\n    this.controls.add(this.scaleBox);\n\n    this.propertiesControls = {\n        colorpicker: null,\n        penSizeSlider: null,\n        penSizeField: null,\n        primaryColorButton: null,\n        primaryColorViewer: null,\n        constrain: null\n    };\n    this.populatePropertiesMenu();\n\n    this.addButton(\"ok\", \"OK\");\n    this.addButton(\"cancel\", \"Cancel\");\n\n    this.refreshToolButtons();\n    this.fixLayout();\n};\n\nPaintEditorMorph.prototype.buildToolbox = function () {\n    var tools = {\n            brush:\n                \"Paintbrush tool\\n(free draw)\",\n            rectangle:\n                \"Stroked Rectangle\\n(shift: square)\",\n            circle:\n                \"Stroked Ellipse\\n(shift: circle)\",\n            eraser:\n                \"Eraser tool\",\n            crosshairs:\n                \"Set the rotation center\",\n\n            line:\n                \"Line tool\\n(shift: vertical/horizontal)\",\n            rectangleSolid:\n                \"Filled Rectangle\\n(shift: square)\",\n            circleSolid:\n                \"Filled Ellipse\\n(shift: circle)\",\n            paintbucket:\n                \"Fill a region\",\n            pipette:\n                \"Pipette tool\\n(pick a color anywhere)\"\n        },\n        myself = this,\n        left = this.toolbox.left(),\n        top = this.toolbox.top(),\n        padding = 2,\n        inset = 5,\n        x = 0,\n        y = 0;\n\n    Object.keys(tools).forEach(function (tool) {\n        var btn = myself.toolButton(tool, tools[tool]);\n        btn.setPosition(new Point(\n            left + x,\n            top + y\n        ));\n        x += btn.width() + padding;\n        if (tool === \"crosshairs\") {\n            x = 0;\n            y += btn.height() + padding;\n            myself.paper.drawcrosshair();\n        }\n        myself.toolbox[tool] = btn;\n        myself.toolbox.add(btn);\n    });\n\n    this.toolbox.bounds = this.toolbox.fullBounds().expandBy(inset * 2);\n};\n\nPaintEditorMorph.prototype.buildEdits = function () {\n    var myself = this,\n        paper = this.paper;\n\n    this.edits.add(this.pushButton(\n        \"undo\",\n        function () {paper.undo(); }\n    ));\n\n    this.edits.add(this.pushButton(\n        \"clear\",\n        function () {paper.clearCanvas(); }\n    ));\n    this.edits.add(this.pushButton(\n        'Vector',\n        function () {\n            if (myself.paper.undoBuffer.length > 0) {\n                myself.ide.confirm(\n                    'This will erase your current drawing.\\n' +\n                    'Are you sure you want to continue?',\n                    'Switch to vector editor?',\n                    () => {\n                        setTimeout(() => {myself.switchToVector(); });\n                    }\n                );\n            } else {\n                myself.switchToVector();\n            }\n        }\n    ));\n\n    this.edits.fixLayout();\n};\n\nPaintEditorMorph.prototype.buildScaleBox = function () {\n    var paper = this.paper;\n    this.scaleBox.add(this.pushButton(\n        new SymbolMorph('grow', 18),\n        function () {paper.scale(0.05, 0.05); },\n        'grow'\n    ));\n    this.scaleBox.add(this.pushButton(\n        new SymbolMorph('shrink', 18),\n        function () {paper.scale(-0.05, -0.05); },\n        'shrink'\n    ));\n    this.scaleBox.add(this.pushButton(\n        new SymbolMorph('flipHorizontal', 18),\n        function () {paper.scale(-2, 0); },\n        'flip horizontal'\n    ));\n    this.scaleBox.add(this.pushButton(\n        new SymbolMorph('flipVertical', 18),\n        function () {paper.scale(0, -2); },\n        'flip vertical'\n    ));\n    this.scaleBox.fixLayout();\n};\n\nPaintEditorMorph.prototype.openIn = function (\n\tworld,\n    oldim,\n    oldrc,\n    callback,\n    anIDE\n) {\n    var myself = this;\n    // Open the editor in a world with an optional image to edit\n    this.oldim = oldim;\n    this.callback = callback || nop;\n    this.ide = anIDE;\n\n    this.processKeyUp = function () {\n        myself.shift = false;\n        myself.propertiesControls.constrain.refresh();\n    };\n\n    this.processKeyDown = function () {\n        myself.shift = myself.world().currentKey === 16;\n        myself.propertiesControls.constrain.refresh();\n    };\n    //merge oldim:\n    if (this.oldim) {\n        this.paper.automaticCrosshairs = isNil(oldrc);\n        this.paper.centermerge(this.oldim, this.paper.paper);\n        this.paper.rotationCenter =\n            (oldrc || new Point(0, 0)).add(\n                new Point(\n                    (this.paper.paper.width - this.oldim.width) / 2,\n                    (this.paper.paper.height - this.oldim.height) / 2\n                )\n            );\n        this.paper.drawNew();\n    }\n\n    this.key = 'paint';\n    this.popUp(world);\n};\n\nPaintEditorMorph.prototype.fixLayout = function () {\n    this.changed();\n    if (this.paper) {\n        this.paper.buildContents();\n        this.paper.drawNew();\n    }\n    if (this.controls) {this.controls.fixLayout(); }\n    if (this.body) {this.body.fixLayout(); }\n    PaintEditorMorph.uber.fixLayout.call(this);\n    this.changed();\n};\n\nPaintEditorMorph.prototype.refreshToolButtons = function () {\n    this.toolbox.children.forEach(function (toggle) {\n        toggle.refresh();\n    });\n};\n\nPaintEditorMorph.prototype.ok = function () {\n    this.paper.updateAutomaticCenter();\n    this.callback(\n        this.paper.paper,\n        this.paper.rotationCenter\n    );\n    this.destroy();\n};\n\nPaintEditorMorph.prototype.cancel = function () {\n    if (this.oncancel) {this.oncancel(); }\n    this.destroy();\n};\n\nPaintEditorMorph.prototype.switchToVector = function () {\n    this.object = new SVG_Costume(new Image(), '', new Point(0,0));\n    this.object.edit(\n        this.world(),\n        this.ide,\n        true\n    );\n};\n\nPaintEditorMorph.prototype.populatePropertiesMenu = function () {\n    var c = this.controls,\n        myself = this,\n        pc = this.propertiesControls,\n        alpen = new AlignmentMorph(\"row\", this.padding),\n        brushControl = new AlignmentMorph(\"column\", 3);\n\n    brushControl.alignment = \"left\";\n\n    pc.primaryColorViewer = new Morph();\n    pc.primaryColorViewer.isCachingImage = true;\n\n    pc.primaryColorViewer.render = function (ctx) {\n        var color = myself.paper.settings.primarycolor,\n            i,\n            j;\n        if (color === \"transparent\") {\n            for (i = 0; i < 180; i += 5) {\n                for (j = 0; j < 15; j += 5) {\n                    ctx.fillStyle =\n                        ((j + i) / 5) % 2 === 0 ?\n                                        \"rgba(0, 0, 0, 0.2)\" :\n                                        \"rgba(0, 0, 0, 0.5)\";\n                    ctx.fillRect(i, j, 5, 5);\n\n                }\n            }\n        } else {\n            ctx.fillStyle = color.toString();\n            ctx.fillRect(0, 0, 180, 15);\n        }\n        ctx.strokeStyle = \"black\";\n        ctx.lineWidth = Math.min(myself.paper.settings.linewidth, 20);\n        ctx.beginPath();\n        ctx.lineCap = \"round\";\n        ctx.moveTo(20, 30);\n        ctx.lineTo(160, 30);\n        ctx.stroke();\n    };\n\n    pc.primaryColorViewer.setExtent(new Point(180, 40));\n    pc.primaryColorViewer.color = new Color(0, 0, 0);\n\n    pc.colorpicker = new PaintColorPickerMorph(\n        new Point(180, 100),\n        function (color) {\n            myself.paper.settings.primarycolor = color;\n            pc.primaryColorViewer.rerender();\n        }\n    );\n    pc.colorpicker.isCachingImage = true;\n    pc.colorpicker.action(new Color(0, 0, 0));\n\n    pc.penSizeSlider = new SliderMorph(0, 20, 5, 5);\n    pc.penSizeSlider.orientation = \"horizontal\";\n    pc.penSizeSlider.setHeight(15);\n    pc.penSizeSlider.setWidth(150);\n    pc.penSizeSlider.action = function (num) {\n        if (pc.penSizeField) {\n            pc.penSizeField.setContents(num);\n        }\n        myself.paper.settings.linewidth = num;\n        pc.colorpicker.action(myself.paper.settings.primarycolor);\n    };\n\n    pc.penSizeField = new InputFieldMorph(\"5\", true, null, false);\n    pc.penSizeField.contents().minWidth = 20;\n    pc.penSizeField.setWidth(25);\n    pc.penSizeField.accept = function () {\n        var val = parseFloat(pc.penSizeField.getValue());\n        pc.penSizeSlider.value = val;\n        pc.penSizeSlider.updateValue();\n        this.setContents(val);\n        myself.paper.settings.linewidth = val;\n        this.world().keyboardFocus = myself;\n        pc.colorpicker.action(myself.paper.settings.primarycolor);\n    };\n\n    alpen.add(pc.penSizeSlider);\n    alpen.add(pc.penSizeField);\n    alpen.color = myself.color;\n    alpen.fixLayout();\n\n    pc.penSizeField.fixLayout();\n    pc.constrain = new ToggleMorph(\n        \"checkbox\",\n        this,\n        function () {myself.shift = !myself.shift; },\n        \"Constrain proportions of shapes?\\n(you can also hold shift)\",\n        function () {return myself.shift; }\n    );\n    pc.constrain.label.isBold = false;\n\n    c.add(pc.colorpicker);\n    //c.add(pc.primaryColorButton);\n    c.add(pc.primaryColorViewer);\n    brushControl.add(\n        new StringMorph(localize(\"Brush size\") + \":\", 10, null, true)\n    );\n    brushControl.add(alpen);\n    brushControl.add(pc.constrain);\n    brushControl.fixLayout();\n    c.add(brushControl);\n};\n\nPaintEditorMorph.prototype.toolButton = function (icon, hint) {\n    var button, myself = this;\n\n    button = new ToggleButtonMorph(\n        null,\n        this,\n        function () { // action\n            myself.paper.currentTool = icon;\n            myself.paper.toolChanged(icon);\n            myself.refreshToolButtons();\n            if (icon === 'pipette') {\n                myself.getUserColor();\n            }\n        },\n        new SymbolMorph(icon, 18),\n        function () {return myself.paper.currentTool === icon; }\n    );\n\n    button.hint = hint;\n    return button;\n};\n\nPaintEditorMorph.prototype.pushButton = function (title, action, hint) {\n    return new PushButtonMorph(\n        this,\n        action,\n        title,\n        null,\n        hint\n    );\n};\n\nPaintEditorMorph.prototype.getUserColor = function () {\n    var myself = this,\n        world = this.world(),\n        hand = world.hand,\n        posInDocument = getDocumentPositionOf(world.worldCanvas),\n        mouseMoveBak = hand.processMouseMove,\n        mouseDownBak = hand.processMouseDown,\n        mouseUpBak = hand.processMouseUp;\n\n    hand.processMouseMove = function (event) {\n        var color;\n        hand.setPosition(new Point(\n            event.pageX - posInDocument.x,\n            event.pageY - posInDocument.y\n        ));\n        color = world.getGlobalPixelColor(hand.position());\n        if (!color.a) {\n            // ignore transparent,\n            // needed for retina-display support\n            return;\n        }\n        color.a = 1;\n        myself.propertiesControls.colorpicker.action(color);\n    };\n\n    hand.processMouseDown = nop;\n\n    hand.processMouseUp = function () {\n        myself.paper.currentTool = 'brush';\n        myself.paper.toolChanged('brush');\n        myself.refreshToolButtons();\n        hand.processMouseMove = mouseMoveBak;\n        hand.processMouseDown = mouseDownBak;\n        hand.processMouseUp = mouseUpBak;\n    };\n};\n\n// AdvancedColorPickerMorph //////////////////\n\n// A large hsl color picker\n\nPaintColorPickerMorph.prototype = new Morph();\nPaintColorPickerMorph.prototype.constructor = PaintColorPickerMorph;\nPaintColorPickerMorph.uber = Morph.prototype;\n\nexport function PaintColorPickerMorph(extent, action) {\n    this.init(extent, action);\n}\n\nPaintColorPickerMorph.prototype.init = function (extent, action) {\n    this.isCachingImage = true;\n    this.setExtent(extent || new Point(200, 100));\n    this.action = action || nop;\n};\n\nPaintColorPickerMorph.prototype.render = function (ctx) {\n    var x = 0,\n        y = 0,\n        colorselection,\n        r;\n    for (x = 0; x < this.width(); x += 1) {\n        for (y = 0; y < this.height() - 20; y += 1) {\n            ctx.fillStyle = \"hsl(\" +\n                (360 * x / this.width()) +\n                \",\" +\n                \"100%,\" +\n                (y * 100 / (this.height() - 20)) +\n                \"%)\";\n            ctx.fillRect(x, y, 1, 1);\n        }\n    }\n    for (x = 0; x < this.width(); x += 1) {\n        r = Math.floor(255 * x / this.width());\n        ctx.fillStyle = \"rgb(\" + r + \", \" + r + \", \" + r + \")\";\n        ctx.fillRect(x, this.height() - 20, 1, 10);\n    }\n    colorselection = [\"black\", \"white\", \"gray\"];\n    for (x = 0; x < colorselection.length; x += 1) {\n        ctx.fillStyle = colorselection[x];\n        ctx.fillRect(\n            x * this.width() / colorselection.length,\n            this.height() - 10,\n            this.width() / colorselection.length,\n            10\n        );\n    }\n    for (x = this.width() * 2 / 3; x < this.width(); x += 2) {\n        for (y = this.height() - 10; y < this.height(); y += 2) {\n            if ((x + y) / 2 % 2 === 0) {\n                ctx.fillStyle = \"#DDD\";\n                ctx.fillRect(x, y, 2, 2);\n            }\n        }\n    }\n};\n\nPaintColorPickerMorph.prototype.mouseDownLeft = function (pos) {\n    if ((pos.subtract(this.position()).x > this.width() * 2 / 3) &&\n            (pos.subtract(this.position()).y > this.height() - 10)) {\n        this.action(\"transparent\");\n    } else {\n        this.action(this.getPixelColor(pos));\n    }\n};\n\nPaintColorPickerMorph.prototype.mouseMove =\n    PaintColorPickerMorph.prototype.mouseDownLeft;\n\n// PaintCanvasMorph ///////////////////////////\n/*\n    A canvas which reacts to drag events to\n    modify its image, based on a 'tool' property.\n*/\n\nPaintCanvasMorph.prototype = new Morph();\nPaintCanvasMorph.prototype.constructor = PaintCanvasMorph;\nPaintCanvasMorph.uber = Morph.prototype;\n\nexport function PaintCanvasMorph(shift) {\n    this.init(shift);\n}\n\nPaintCanvasMorph.prototype.init = function (shift) {\n    this.rotationCenter = new Point(240, 180);\n    this.dragRect = null;\n    this.previousDragPoint = null;\n    this.currentTool = \"brush\";\n    this.dragRect = new Rectangle();\n    // rectangle with origin being the starting drag position and\n    // corner being the current drag position\n    this.mask = null; // Temporary canvas\n    this.paper = null; // Actual canvas\n    this.erasermask = null; // eraser memory\n    this.background = null; // checkers\n    this.settings = {\n        \"primarycolor\": new Color(0, 0, 0, 255), // usually fill color\n        \"secondarycolor\": new Color(0, 0, 0, 255), // (unused)\n        \"linewidth\": 3 // stroke width\n    };\n    this.brushBuffer = [];\n    this.undoBuffer = [];\n    this.isShiftPressed = shift || function () {\n        var key = this.world().currentKey;\n        return (key === 16);\n    };\n    // should we calculate the center of the image ourselves,\n    // or use the user position\n    this.automaticCrosshairs = true;\n    this.isCachingImage = true;\n    this.buildContents();\n    this.drawNew();\n};\n\n// Calculate the center of all the non-transparent pixels on the canvas.\nPaintCanvasMorph.prototype.calculateCanvasCenter = function(canvas) {\n    var canvasBounds = Costume.prototype.canvasBoundingBox(canvas);\n    if (canvasBounds === null) {\n        return null;\n    }\n    // Can't use canvasBounds.center(), it rounds down.\n    return new Point(\n    \t(canvasBounds.origin.x + canvasBounds.corner.x) / 2,\n        (canvasBounds.origin.y + canvasBounds.corner.y) / 2\n    );\n};\n\n// If we are in automaticCrosshairs mode, recalculate the rotationCenter.\nPaintCanvasMorph.prototype.updateAutomaticCenter = function () {\n    if (this.automaticCrosshairs) {\n        // Calculate this.rotationCenter from this.paper\n        var rotationCenter = this.calculateCanvasCenter(this.paper);\n        if (rotationCenter !== null) {\n            this.rotationCenter = rotationCenter;\n        }\n    }\n};\n\nPaintCanvasMorph.prototype.scale = function (x, y) {\n    this.updateAutomaticCenter();\n    this.mask = newCanvas(this.extent(), true);\n    var c = newCanvas(this.extent(), true);\n    c.getContext(\"2d\").save();\n    c.getContext(\"2d\").translate(\n        this.rotationCenter.x,\n        this.rotationCenter.y\n    );\n    c.getContext(\"2d\").scale(1 + x, 1 + y);\n    c.getContext(\"2d\").drawImage(\n        this.paper,\n        -this.rotationCenter.x,\n        -this.rotationCenter.y\n    );\n    c.getContext(\"2d\").restore();\n    this.paper = c;\n    this.drawNew();\n    this.changed();\n};\n\nPaintCanvasMorph.prototype.cacheUndo = function () {\n    var cachecan = newCanvas(this.extent(), true);\n    this.merge(this.paper, cachecan);\n    this.undoBuffer.push(cachecan);\n};\n\nPaintCanvasMorph.prototype.undo = function () {\n    if (this.undoBuffer.length > 0) {\n        this.paper = newCanvas(this.extent(), true);\n        this.mask.width = this.mask.width + 1 - 1;\n        this.merge(this.undoBuffer.pop(), this.paper);\n        this.drawNew();\n        this.changed();\n    }\n};\n\nPaintCanvasMorph.prototype.merge = function (a, b) {\n    b.getContext(\"2d\").drawImage(a, 0, 0);\n};\n\nPaintCanvasMorph.prototype.centermerge = function (a, b) {\n    b.getContext(\"2d\").drawImage(\n        a,\n        (b.width - a.width) / 2,\n        (b.height - a.height) / 2\n    );\n};\n\nPaintCanvasMorph.prototype.clearCanvas = function () {\n    this.buildContents();\n    this.drawNew();\n    this.changed();\n};\n\nPaintCanvasMorph.prototype.toolChanged = function (tool) {\n    this.mask = newCanvas(this.extent(), true, this.mask);\n    if (tool === \"crosshairs\") {\n        this.updateAutomaticCenter();\n        this.drawcrosshair();\n    }\n    this.drawNew();\n    this.changed();\n};\n\nPaintCanvasMorph.prototype.drawcrosshair = function (context) {\n    var ctx = context || this.mask.getContext(\"2d\"),\n        rp = this.rotationCenter;\n\n    ctx.save();\n    ctx.lineWidth = 1;\n    ctx.strokeStyle = 'black';\n    ctx.clearRect(0, 0, this.mask.width, this.mask.height);\n\n    // draw crosshairs:\n    ctx.globalAlpha = 0.5;\n\n    // circle around center:\n    ctx.fillStyle = 'white';\n    ctx.beginPath();\n    ctx.arc(\n        rp.x,\n        rp.y,\n        20,\n        radians(0),\n        radians(360),\n        false\n    );\n    ctx.closePath();\n    ctx.fill();\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.arc(\n        rp.x,\n        rp.y,\n        10,\n        radians(0),\n        radians(360),\n        false\n    );\n    ctx.stroke();\n\n    // horizontal line:\n    ctx.beginPath();\n    ctx.moveTo(0, rp.y);\n    ctx.lineTo(this.mask.width, rp.y);\n    ctx.stroke();\n\n    // vertical line:\n    ctx.beginPath();\n    ctx.moveTo(rp.x, 0);\n    ctx.lineTo(rp.x, this.mask.height);\n    ctx.stroke();\n\n    ctx.restore();\n\n    this.drawNew();\n};\n\nPaintCanvasMorph.prototype.floodfill = function (sourcepoint) {\n    var width = this.paper.width,\n        height = this.paper.height,\n        ctx = this.paper.getContext(\"2d\"),\n        img = ctx.getImageData(0, 0, width, height),\n        data = img.data,\n        stack = [Math.round(Math.round(sourcepoint.y) * width + sourcepoint.x)],\n        currentpoint,\n        read,\n        sourcecolor,\n        checkpoint;\n    read = function (p) {\n        var d = p * 4;\n        return [data[d], data[d + 1], data[d + 2], data[d + 3]];\n    };\n    sourcecolor = read(stack[0]);\n    checkpoint = function (p) {\n        return p[0] === sourcecolor[0] &&\n            p[1] === sourcecolor[1] &&\n            p[2] === sourcecolor[2] &&\n            p[3] === sourcecolor[3];\n    };\n\n    // if already filled, abort\n    if (sourcecolor[3] === 0 &&\n            this.settings.primarycolor === \"transparent\") {\n        return;\n    }\n    if (sourcecolor[0] === this.settings.primarycolor.r &&\n            sourcecolor[1] === this.settings.primarycolor.g &&\n            sourcecolor[2] === this.settings.primarycolor.b &&\n            sourcecolor[3] === this.settings.primarycolor.a * 255) {\n        return;\n    }\n    if (sourcecolor[3] === 0 && this.settings.primarycolor.a === 0) {\n        return;\n    }\n\n    while (stack.length > 0) {\n        currentpoint = stack.pop();\n        if (checkpoint(read(currentpoint))) {\n            if (currentpoint % width > 1) {\n                stack.push(currentpoint + 1);\n                stack.push(currentpoint - 1);\n            }\n            if (currentpoint > 0 && currentpoint < height * width) {\n                stack.push(currentpoint + width);\n                stack.push(currentpoint - width);\n            }\n        }\n        if (this.settings.primarycolor === \"transparent\") {\n            data[currentpoint * 4 + 3] = 0;\n        } else {\n            data[currentpoint * 4] = this.settings.primarycolor.r;\n            data[currentpoint * 4 + 1] = this.settings.primarycolor.g;\n            data[currentpoint * 4 + 2] = this.settings.primarycolor.b;\n            data[currentpoint * 4 + 3] = this.settings.primarycolor.a * 255;\n        }\n    }\n    ctx.putImageData(img, 0, 0);\n    this.drawNew();\n    this.changed();\n};\n\nPaintCanvasMorph.prototype.mouseDownLeft = function (pos) {\n    this.cacheUndo();\n    this.dragRect.origin = pos.subtract(this.bounds.origin);\n    this.dragRect.corner = pos.subtract(this.bounds.origin);\n    this.previousDragPoint = this.dragRect.corner.copy();\n    if (this.currentTool === 'crosshairs') {\n        this.rotationCenter = pos.subtract(this.bounds.origin);\n        this.drawcrosshair();\n        return;\n    }\n    if (this.currentTool === \"paintbucket\") {\n        return this.floodfill(pos.subtract(this.bounds.origin));\n    }\n    if (this.settings.primarycolor === \"transparent\" &&\n            this.currentTool !== \"crosshairs\") {\n        this.erasermask = newCanvas(this.extent(), true, this.erasermask);\n        this.merge(this.paper, this.erasermask);\n    }\n};\n\nPaintCanvasMorph.prototype.mouseMove = function (pos) {\n    if (this.currentTool === \"paintbucket\") {\n        return;\n    }\n\n    var relpos = pos.subtract(this.bounds.origin),\n        mctx = this.mask.getContext(\"2d\"),\n        pctx = this.paper.getContext(\"2d\"),\n        x = this.dragRect.origin.x, // original drag X\n        y = this.dragRect.origin.y, // original drag y\n        p = relpos.x,               // current drag x\n        q = relpos.y,               // current drag y\n        w = (p - x) / 2,            // half the rect width\n        h = (q - y) / 2,            // half the rect height\n        i,                          // iterator number\n        width = this.paper.width;\n\n    mctx.save();\n    function newW() {\n        return Math.max(Math.abs(w), Math.abs(h)) * (w / Math.abs(w));\n    }\n    function newH() {\n        return Math.max(Math.abs(w), Math.abs(h)) * (h / Math.abs(h));\n    }\n    this.brushBuffer.push([p, q]);\n    mctx.lineWidth = this.settings.linewidth;\n    mctx.clearRect(0, 0, this.bounds.width(), this.bounds.height()); // mask\n\n    this.dragRect.corner = relpos.subtract(this.dragRect.origin); // reset crn\n\n    if (this.settings.primarycolor === \"transparent\" &&\n            this.currentTool !== \"crosshairs\") {\n        this.merge(this.erasermask, this.mask);\n        pctx.clearRect(0, 0, this.bounds.width(), this.bounds.height());\n        mctx.globalCompositeOperation = \"destination-out\";\n    } else {\n        mctx.fillStyle = this.settings.primarycolor.toString();\n        mctx.strokeStyle = this.settings.primarycolor.toString();\n    }\n    switch (this.currentTool) {\n    case \"rectangle\":\n        if (this.isShiftPressed()) {\n            mctx.strokeRect(x, y, newW() * 2, newH() * 2);\n        } else {\n            mctx.strokeRect(x, y, w * 2, h * 2);\n        }\n        break;\n    case \"rectangleSolid\":\n        if (this.isShiftPressed()) {\n            mctx.fillRect(x, y, newW() * 2, newH() * 2);\n        } else {\n            mctx.fillRect(x, y, w * 2, h * 2);\n        }\n        break;\n    case \"brush\":\n        mctx.lineCap = \"round\";\n        mctx.lineJoin = \"round\";\n        mctx.beginPath();\n        mctx.moveTo(this.brushBuffer[0][0], this.brushBuffer[0][1]);\n        for (i = 0; i < this.brushBuffer.length; i += 1) {\n            mctx.lineTo(this.brushBuffer[i][0], this.brushBuffer[i][1]);\n        }\n        mctx.stroke();\n        break;\n    case \"line\":\n        mctx.beginPath();\n        mctx.moveTo(x, y);\n        if (this.isShiftPressed()) {\n            if (Math.abs(h) > Math.abs(w)) {\n                mctx.lineTo(x, q);\n            } else {\n                mctx.lineTo(p, y);\n            }\n        } else {\n            mctx.lineTo(p, q);\n        }\n        mctx.stroke();\n        break;\n    case \"circle\":\n    case \"circleSolid\":\n        mctx.beginPath();\n        if (this.isShiftPressed()) {\n            mctx.arc(\n                x,\n                y,\n                new Point(x, y).distanceTo(new Point(p, q)),\n                0,\n                Math.PI * 2,\n                false\n            );\n        } else {\n            for (i = 0; i < width; i += 1) {\n                mctx.lineTo(\n                    i,\n                    (2 * h) * Math.sqrt(2 - Math.pow(\n                        (i - x) / (2 * w),\n                        2\n                    )) + y\n                );\n            }\n            for (i = width; i > 0; i -= 1) {\n                mctx.lineTo(\n                    i,\n                    -1 * (2 * h) * Math.sqrt(2 - Math.pow(\n                        (i - x) / (2 * w),\n                        2\n                    )) + y\n                );\n            }\n        }\n        mctx.closePath();\n        if (this.currentTool === \"circleSolid\") {\n            mctx.fill();\n        } else {\n            if (this.currentTool === \"circle\") {\n                mctx.stroke();\n            }\n        }\n        break;\n    case \"crosshairs\":\n        // Disable automatic crosshairs:\n        // user has now chosen where they should be.\n        this.automaticCrosshairs = false;\n        this.rotationCenter = relpos.copy();\n        this.drawcrosshair(mctx);\n        break;\n    case \"eraser\":\n        this.merge(this.paper, this.mask);\n        mctx.save();\n        mctx.globalCompositeOperation = \"destination-out\";\n        mctx.beginPath();\n        mctx.moveTo(this.brushBuffer[0][0], this.brushBuffer[0][1]);\n        for (i = 0; i < this.brushBuffer.length; i += 1) {\n            mctx.lineTo(this.brushBuffer[i][0], this.brushBuffer[i][1]);\n        }\n        mctx.stroke();\n        mctx.restore();\n        this.paper = newCanvas(this.extent(), true);\n        this.merge(this.mask, this.paper);\n        break;\n    default:\n        nop();\n    }\n    this.previousDragPoint = relpos;\n    this.drawNew();\n    mctx.restore();\n    this.changed();\n};\n\nPaintCanvasMorph.prototype.mouseClickLeft = function () {\n    if (this.currentTool !== \"crosshairs\") {\n        this.merge(this.mask, this.paper);\n    }\n    this.brushBuffer = [];\n};\n\nPaintCanvasMorph.prototype.mouseLeaveDragging\n    = PaintCanvasMorph.prototype.mouseClickLeft;\n\nPaintCanvasMorph.prototype.buildContents = function () {\n    this.background = newCanvas(this.extent(), false, this.background);\n    this.paper = newCanvas(this.extent(), true, this.paper);\n    this.mask = newCanvas(this.extent(), true, this.mask);\n    this.erasermask = newCanvas(this.extent(), true, this.erasermask);\n    var i, j, bkctx = this.background.getContext(\"2d\");\n    for (i = 0; i < this.background.width; i += 5) {\n        for (j = 0; j < this.background.height; j += 5) {\n            if ((i + j) / 5 % 2 === 1) {\n                bkctx.fillStyle = \"rgba(255, 255, 255, 1)\";\n            } else {\n                bkctx.fillStyle = \"rgba(255, 255, 255, 0.3)\";\n            }\n            bkctx.fillRect(i, j, 5, 5);\n        }\n    }\n};\n\nPaintCanvasMorph.prototype.drawNew = function () {\n    var can = newCanvas(this.extent(), true, this.cachedImage);\n    this.merge(this.background, can);\n    this.merge(this.paper, can);\n    this.merge(this.mask, can);\n    this.cachedImage = can;\n    this.drawFrame();\n};\n\nPaintCanvasMorph.prototype.rerender // ugly hack, but hey, it works ;-) jens\n    = PaintCanvasMorph.prototype.drawNew;\n\nPaintCanvasMorph.prototype.drawFrame = function () {\n    var context, borderColor;\n\n    context = this.cachedImage.getContext('2d');\n    if (this.parent) {\n        this.color = this.parent.color.lighter(this.contrast * 0.75);\n        borderColor = this.parent.color;\n    } else {\n        borderColor = new Color(120, 120, 120);\n    }\n    context.fillStyle = this.color.toString();\n\n    // cache my border colors\n    this.cachedClr = borderColor.toString();\n    this.cachedClrBright = borderColor.lighter(this.contrast)\n        .toString();\n    this.cachedClrDark = borderColor.darker(this.contrast).toString();\n    this.drawRectBorder(context);\n};\n\nPaintCanvasMorph.prototype.drawRectBorder\n    = InputFieldMorph.prototype.drawRectBorder;\n\nPaintCanvasMorph.prototype.edge\n    = InputFieldMorph.prototype.edge;\n\nPaintCanvasMorph.prototype.fontSize\n    = InputFieldMorph.prototype.fontSize;\n\nPaintCanvasMorph.prototype.typeInPadding\n    = InputFieldMorph.prototype.typeInPadding;\n\nPaintCanvasMorph.prototype.contrast\n    = InputFieldMorph.prototype.contrast;\n","import {\n  ArgLabelMorph, ArgMorph,\n  BlockMorph, ColorSlotMorph, CommandBlockMorph,\n  CommandSlotMorph,\n  CSlotMorph,\n  MultiArgMorph,\n  ReporterBlockMorph,\n  ReporterSlotMorph, RingMorph, SyntaxElementMorph\n} from \"./blocks\";\nimport {Context, JSCompiler, NONNUMBERS, Process, ThreadManager, Variable, VariableFrame} from \"./threads\";\nimport {List, ListWatcherMorph} from \"./lists\";\nimport {TableFrameMorph, TableMorph} from \"./tables\";\nimport {\n  BLACK,\n  contains,\n  degrees,\n  detect,\n  isNil,\n  isString,\n  localize, Morph,\n  newCanvas,\n  nop,\n  Point,\n  radians,\n  ZERO\n} from \"./morphic\";\nimport {SpriteMorph, StageMorph, StagePrompterMorph, WatcherMorph} from \"./objects\";\n\nexport function snapEquals(a, b) {\n  if (a instanceof List || (b instanceof List)) {\n    if (a instanceof List && (b instanceof List)) {\n      return a.equalTo(b);\n    }\n    return false;\n  }\n\n  var x = +a,\n    y = +b;\n\n  // check for special values before coercing to numbers\n  if (isNaN(x) || isNaN(y) ||\n    [a, b].some(any => contains(NONNUMBERS, any) ||\n      (isString(any) && (any.indexOf(' ') > -1)))\n  ) {\n    x = a;\n    y = b;\n  }\n\n  // handle text comparison case-insensitive.\n  if (isString(x) && isString(y)) {\n    return x.toLowerCase() === y.toLowerCase();\n  }\n\n  return x === y;\n}\n\nexport function invoke(\n  action, // a BlockMorph or a Context, a reified (\"ringified\") block\n  contextArgs, // optional List of arguments for the context, or null\n  receiver, // sprite or environment, optional for contexts\n  timeout, // msecs\n  timeoutErrorMsg, // string\n  suppressErrors, // bool\n  callerProcess, // optional for JS-functions\n  returnContext // bool\n) {\n  // execute the given block or context synchronously without yielding.\n  // Apply context (not a block) to a list of optional arguments.\n  // Receiver (sprite, stage or  environment), timeout etc. are optional.\n  // If a timeout (in milliseconds) is specified, abort execution\n  // after the timeout has been reached and throw an error.\n  // SuppressErrors (bool) if non-timeout errors occurring in the\n  // block are handled elsewhere.\n  // This is highly experimental.\n  // Caution: Kids, do not try this at home!\n  // Use ThreadManager::startProcess with a callback instead\n\n  var proc = new Process(),\n    deadline = (timeout ? Date.now() + timeout : null);\n\n  if (action instanceof Context) {\n    if (receiver) { // optional\n      action = proc.reportContextFor(receiver);\n    }\n    proc.initializeFor(action, contextArgs || new List());\n  } else if (action instanceof BlockMorph) {\n    proc.topBlock = action;\n    if (receiver) {\n      proc.homeContext = new Context();\n      proc.homeContext.receiver = receiver;\n      if (receiver.variables) {\n        proc.homeContext.variables.parentFrame = receiver.variables;\n      }\n    } else {\n      throw new Error('expecting a receiver but getting ' + receiver);\n    }\n    proc.context = new Context(\n      null,\n      action.blockSequence(),\n      proc.homeContext\n    );\n  } else if (action.evaluate) {\n    return action.evaluate();\n  } else if (action instanceof Function) {\n    return action.apply(\n      receiver,\n      contextArgs.asArray().concat(callerProcess)\n    );\n  } else {\n    throw new Error('expecting a block or ring but getting ' + action);\n  }\n  if (suppressErrors) {\n    proc.isCatchingErrors = false;\n  }\n  while (proc.isRunning()) {\n    if (deadline && (Date.now() > deadline)) {\n      throw (new Error(\n          localize(\n            timeoutErrorMsg ||\n            \"a synchronous Snap! script has timed out\")\n        )\n      );\n    }\n    proc.runStep(deadline);\n  }\n  return returnContext ? proc.homeContext : proc.homeContext.inputs[0];\n}\n\n\nThreadManager.prototype.pauseCustomHatBlocks = false;\n\nThreadManager.prototype.toggleProcess = function (block, receiver) {\n  var active = this.findProcess(block, receiver);\n  if (active) {\n    active.stop();\n  } else {\n    return this.startProcess(block, receiver, null, null, null, true);\n  }\n};\n\nThreadManager.prototype.startProcess = function (\n  block,\n  receiver,\n  isThreadSafe,\n  exportResult, // bool\n  callback,\n  isClicked,\n  rightAway,\n  atomic, // special option used (only) for \"onStop\" scripts\n  variables // optional variable frame, used for WHEN hats\n) {\n  var top = block.topBlock(),\n    active = this.findProcess(top, receiver),\n    glow,\n    newProc;\n  if (active) {\n    if (isThreadSafe) {\n      return active;\n    }\n    active.stop();\n    active.canBroadcast = true; // broadcasts to fire despite reentrancy\n    this.removeTerminatedProcesses();\n  }\n  newProc = new Process(top, receiver, callback, isClicked);\n  newProc.exportResult = exportResult;\n  newProc.isClicked = isClicked || false;\n  newProc.isAtomic = atomic || false;\n\n  // in case an optional variable frame has been passed,\n  // copy it into the new outer context.\n  // Relevance: When a predicate inside a generic WHEN hat block\n  // publishes an upvar, this code makes the upvar accessible\n  // to the script attached to the WHEN hat\n  if (variables instanceof VariableFrame) {\n    Object.keys(variables.vars).forEach(vName =>\n      newProc.context.outerContext.variables.vars[vName] =\n        variables.vars[vName]\n    );\n  }\n\n  // show a highlight around the running stack\n  // if there are more than one active processes\n  // for a block, display the thread count\n  // next to it\n  glow = top.getHighlight();\n  if (glow) {\n    glow.threadCount = this.processesForBlock(top).length + 1;\n    glow.updateReadout();\n  } else {\n    top.addHighlight();\n  }\n\n  this.processes.push(newProc);\n  if (rightAway) {\n    newProc.runStep();\n  }\n  return newProc;\n};\n\nThreadManager.prototype.stopAll = function (excpt) {\n  // excpt is optional\n  this.processes.forEach(proc => {\n    if (proc !== excpt) {\n      proc.stop();\n    }\n  });\n};\n\nThreadManager.prototype.stopAllForReceiver = function (rcvr, excpt) {\n  // excpt is optional\n  this.processes.forEach(proc => {\n    if (proc.homeContext.receiver === rcvr && proc !== excpt) {\n      proc.stop();\n      if (rcvr.isTemporary) {\n        proc.isDead = true;\n      }\n    }\n  });\n};\n\nThreadManager.prototype.stopAllForBlock = function (aTopBlock) {\n  this.processesForBlock(aTopBlock, true).forEach(proc =>\n    proc.stop()\n  );\n};\n\nThreadManager.prototype.stopProcess = function (block, receiver) {\n  var active = this.findProcess(block, receiver);\n  if (active) {\n    active.stop();\n  }\n};\n\nThreadManager.prototype.pauseAll = function (stage) {\n  this.processes.forEach(proc => proc.pause());\n  if (stage) {\n    stage.pauseAllActiveSounds();\n  }\n};\n\nThreadManager.prototype.isPaused = function () {\n  return detect(\n    this.processes,\n    proc => proc.isPaused\n  ) !== null;\n};\n\nThreadManager.prototype.resumeAll = function (stage) {\n  this.processes.forEach(proc => proc.resume());\n  if (stage) {\n    stage.resumeAllActiveSounds();\n  }\n};\n\nThreadManager.prototype.step = function () {\n  // run each process until it gives up control, skipping processes\n  // for sprites that are currently picked up, then filter out any\n  // processes that have been terminated\n\n  var isInterrupted;\n  if (Process.prototype.enableSingleStepping) {\n    this.processes.forEach(proc => {\n      if (proc.isInterrupted) {\n        proc.runStep();\n        isInterrupted = true;\n      } else {\n        proc.lastYield = Date.now();\n      }\n    });\n    this.wantsToPause = (Process.prototype.flashTime > 0.5);\n    if (isInterrupted) {\n      if (this.wantsToPause) {\n        this.pauseAll();\n      }\n      return;\n    }\n  }\n\n  this.processes.forEach(proc => {\n    if (!proc.homeContext.receiver.isPickedUp() && !proc.isDead) {\n      proc.runStep();\n    }\n  });\n  this.removeTerminatedProcesses();\n};\n\nThreadManager.prototype.removeTerminatedProcesses = function () {\n  // and un-highlight their scripts\n  var remaining = [],\n    count;\n  this.processes.forEach(proc => {\n    var result,\n      glow;\n    if ((!proc.isRunning() && !proc.errorFlag) || proc.isDead) {\n      if (proc.topBlock instanceof BlockMorph) {\n        proc.unflash();\n        // adjust the thread count indicator, if any\n        count = this.processesForBlock(proc.topBlock).length;\n        if (count) {\n          glow = proc.topBlock.getHighlight() ||\n            proc.topBlock.addHighlight();\n          glow.threadCount = count;\n          glow.updateReadout();\n        } else {\n          proc.topBlock.removeHighlight();\n        }\n      }\n      if (proc.prompter) {\n        proc.prompter.destroy();\n        if (proc.homeContext.receiver.stopTalking) {\n          proc.homeContext.receiver.stopTalking();\n        }\n      }\n      if (proc.topBlock instanceof ReporterBlockMorph ||\n        proc.isShowingResult || proc.exportResult) {\n        result = proc.homeContext.inputs[0];\n        if (proc.onComplete instanceof Function) {\n          proc.onComplete(result);\n        } else {\n          if (result instanceof List) {\n            proc.topBlock.showBubble(\n              result.isTable() ?\n                new TableFrameMorph(\n                  new TableMorph(result, 10)\n                )\n                : new ListWatcherMorph(result),\n              proc.exportResult,\n              proc.receiver\n            );\n          } else {\n            proc.topBlock.showBubble(\n              result,\n              proc.exportResult,\n              proc.receiver\n            );\n          }\n        }\n      } else if (proc.onComplete instanceof Function) {\n        proc.onComplete();\n      }\n    } else {\n      remaining.push(proc);\n    }\n  });\n  this.processes = remaining;\n};\n\nThreadManager.prototype.findProcess = function (block, receiver) {\n  var top = block.topBlock();\n  return detect(\n    this.processes,\n    each => each.topBlock === top && (each.receiver === receiver)\n  );\n};\n\nThreadManager.prototype.processesForBlock = function (block, only) {\n  var top = only ? block : block.topBlock();\n  return this.processes.filter(each =>\n    each.topBlock === top &&\n    each.isRunning() &&\n    !each.isDead\n  );\n};\n\nThreadManager.prototype.doWhen = function (block, receiver, stopIt) {\n  if (this.pauseCustomHatBlocks) {return; }\n  if ((!block) || this.findProcess(block, receiver)) {\n    return;\n  }\n  var pred = block.inputs()[0], world, test;\n  if (block.removeHighlight()) {\n    world = block.world();\n    if (world) {\n      world.hand.destroyTemporaries();\n    }\n  }\n  if (stopIt) {return; }\n  try {\n    test = invoke(\n      pred,\n      null,\n      receiver,\n      50, // timeout in msecs\n      'the predicate takes\\ntoo long for a\\ncustom hat block',\n      true, // suppress errors => handle them right here instead\n      null, // caller process for JS-functions\n      true // return the whole home context instead of just he result\n    );\n  } catch (error) {\n    block.addErrorHighlight();\n    block.showBubble(\n      error.name\n      + '\\n'\n      + error.message\n    );\n  }\n  // since we're asking for the whole context instead of just the result\n  // of the computation, we need to look at the result-context's first\n  // input to find out whether the condition is met\n  if (test === true || (test && test.inputs && test.inputs[0] === true)) {\n    this.startProcess(\n      block,\n      receiver,\n      null, // isThreadSafe\n      null, // exportResult\n      null, // callback\n      null, // isClicked\n      true,  // rightAway\n      null, // atomic\n      test.variables // make the test-context's variables available\n    );\n  }\n};\n\nThreadManager.prototype.toggleSingleStepping = function () {\n  Process.prototype.enableSingleStepping =\n    !Process.prototype.enableSingleStepping;\n  if (!Process.prototype.enableSingleStepping) {\n    this.processes.forEach(proc => {\n      if (!proc.isPaused) {\n        proc.unflash();\n      }\n    });\n  }\n};\n\n\n\nProcess.prototype.isRunning = function () {\n  return !this.readyToTerminate && (this.context || this.isPaused);\n};\n\n// Process entry points\n\nProcess.prototype.runStep = function (deadline) {\n  // a step is an an uninterruptable 'atom', it can consist\n  // of several contexts, even of several blocks\n\n  if (this.isPaused) { // allow pausing in between atomic steps:\n    return this.pauseStep();\n  }\n  this.readyToYield = false;\n  this.isInterrupted = false;\n\n  while (!this.readyToYield && !this.isInterrupted\n    && this.context\n    && (Date.now() - this.lastYield < this.timeout)\n    ) {\n    // also allow pausing inside atomic steps - for PAUSE block primitive:\n    if (this.isPaused) {\n      return this.pauseStep();\n    }\n    if (deadline && (Date.now() > deadline)) {\n      if (this.isAtomic &&\n        this.homeContext.receiver &&\n        this.homeContext.receiver.endWarp) {\n        this.homeContext.receiver.endWarp();\n      }\n      return;\n    }\n    this.evaluateContext();\n  }\n\n  this.lastYield = Date.now();\n  this.isFirstStep = false;\n\n  // make sure to redraw atomic things\n  if (this.isAtomic &&\n    this.homeContext.receiver &&\n    this.homeContext.receiver.endWarp) {\n    this.homeContext.receiver.endWarp();\n    this.homeContext.receiver.startWarp();\n  }\n\n  if (this.readyToTerminate) {\n    while (this.context) {\n      this.popContext();\n    }\n    if (this.homeContext.receiver) {\n      if (this.homeContext.receiver.endWarp) {\n        // pen optimization\n        this.homeContext.receiver.endWarp();\n      }\n    }\n  }\n};\n\nProcess.prototype.stop = function () {\n  this.readyToYield = true;\n  this.readyToTerminate = true;\n  this.errorFlag = false;\n  if (this.context) {\n    this.context.stopMusic();\n  }\n  this.canBroadcast = false;\n};\n\nProcess.prototype.pause = function () {\n  if (this.readyToTerminate) {\n    return;\n  }\n  this.isPaused = true;\n  this.flashPausedContext();\n  if (this.context && this.context.startTime) {\n    this.pauseOffset = Date.now() - this.context.startTime;\n  }\n};\n\nProcess.prototype.resume = function () {\n  if (!this.enableSingleStepping) {\n    this.unflash();\n  }\n  this.isPaused = false;\n  this.pauseOffset = null;\n};\n\nProcess.prototype.pauseStep = function () {\n  this.lastYield = Date.now();\n  if (this.context && this.context.startTime) {\n    this.context.startTime = this.lastYield - this.pauseOffset;\n  }\n};\n\n// Process evaluation\n\nProcess.prototype.evaluateContext = function () {\n  var exp = this.context.expression;\n  this.frameCount += 1;\n  if (this.context.tag === 'exit') {\n    this.expectReport();\n  }\n  if (exp instanceof Array) {\n    return this.evaluateSequence(exp);\n  }\n  if (exp instanceof MultiArgMorph) {\n    return this.evaluateMultiSlot(exp, exp.inputs().length);\n  }\n  if (exp instanceof ArgLabelMorph) {\n    return this.evaluateArgLabel(exp);\n  }\n  if (exp instanceof ArgMorph || exp.bindingID) {\n    return this.evaluateInput(exp);\n  }\n  if (exp instanceof BlockMorph) {\n    return this.evaluateBlock(exp, exp.inputs().length);\n  }\n  if (isString(exp)) {\n    return this[exp].apply(this, this.context.inputs);\n  }\n  if (exp instanceof Variable) { // special case for empty reporter rings\n    this.returnValueToParentContext(exp.value);\n  }\n  this.popContext(); // default: just ignore it\n};\n\nProcess.prototype.evaluateBlock = function (block, argCount) {\n  var rcvr, inputs,\n    selector = block.selector;\n\n  // check for special forms\n  if (selector === 'reportOr' ||\n    selector ===  'reportAnd' ||\n    selector === 'reportIfElse' ||\n    selector === 'doReport') {\n    if (this.isCatchingErrors) {\n      try {\n        return this[selector](block);\n      } catch (error) {\n        this.handleError(error, block);\n      }\n    } else {\n      return this[selector](block);\n    }\n  }\n\n  // first evaluate all inputs, then apply the primitive\n  rcvr = this.context.receiver || this.receiver;\n  inputs = this.context.inputs;\n\n  if (argCount > inputs.length) {\n    this.evaluateNextInput(block);\n  } else {\n    if (this.flashContext()) {return; } // yield to flash the block\n    if (this[selector]) {\n      rcvr = this;\n    }\n    if (this.isCatchingErrors) {\n      try {\n        this.returnValueToParentContext(\n          rcvr[selector].apply(rcvr, inputs)\n        );\n        this.popContext();\n      } catch (error) {\n        this.handleError(error, block);\n      }\n    } else {\n      this.returnValueToParentContext(\n        rcvr[selector].apply(rcvr, inputs)\n      );\n      this.popContext();\n    }\n  }\n};\n\n// Process: Special Forms Blocks Primitives\n\nProcess.prototype.reportOr = function (block) {\n  var inputs = this.context.inputs;\n\n  if (inputs.length < 1) {\n    this.evaluateNextInput(block);\n  } else if (inputs.length === 1) {\n    // this.assertType(inputs[0], 'Boolean');\n    if (inputs[0]) {\n      if (this.flashContext()) {return; }\n      this.returnValueToParentContext(true);\n      this.popContext();\n    } else {\n      this.evaluateNextInput(block);\n    }\n  } else {\n    // this.assertType(inputs[1], 'Boolean');\n    if (this.flashContext()) {return; }\n    this.returnValueToParentContext(inputs[1] === true);\n    this.popContext();\n  }\n};\n\nProcess.prototype.reportAnd = function (block) {\n  var inputs = this.context.inputs;\n\n  if (inputs.length < 1) {\n    this.evaluateNextInput(block);\n  } else if (inputs.length === 1) {\n    // this.assertType(inputs[0], 'Boolean');\n    if (!inputs[0]) {\n      if (this.flashContext()) {return; }\n      this.returnValueToParentContext(false);\n      this.popContext();\n    } else {\n      this.evaluateNextInput(block);\n    }\n  } else {\n    // this.assertType(inputs[1], 'Boolean');\n    if (this.flashContext()) {return; }\n    this.returnValueToParentContext(inputs[1] === true);\n    this.popContext();\n  }\n};\n\nProcess.prototype.doReport = function (block) {\n  var outer = this.context.outerContext;\n  if (this.flashContext()) {return; } // flash the block here, special form\n  if (this.isClicked && (block.topBlock() === this.topBlock)) {\n    this.isShowingResult = true;\n  }\n  if (block.partOfCustomCommand) {\n    this.doStopCustomBlock();\n    this.popContext();\n  } else {\n    while (this.context && this.context.tag !== 'exit') {\n      if (this.context.expression === 'doStopWarping') {\n        this.doStopWarping();\n      } else {\n        this.popContext();\n      }\n    }\n    if (this.context) {\n      if (this.context.expression === 'expectReport') {\n        // pop off inserted top-level exit context\n        this.popContext();\n      } else {\n        // un-tag and preserve original caller\n        this.context.tag = null;\n      }\n    }\n  }\n  // in any case evaluate (and ignore)\n  // the input, because it could be\n  // an HTTP Request for a hardware extension\n  this.pushContext(block.inputs()[0], outer);\n  this.context.isCustomCommand = block.partOfCustomCommand;\n};\n\n// Process: Non-Block evaluation\n\nProcess.prototype.evaluateMultiSlot = function (multiSlot, argCount) {\n  // first evaluate all subslots, then return a list of their values\n  var inputs = this.context.inputs,\n    ans;\n  if (multiSlot.bindingID) {\n    if (this.isCatchingErrors) {\n      try {\n        ans = this.context.variables.getVar(multiSlot.bindingID);\n      } catch (error) {\n        this.handleError(error, multiSlot);\n      }\n    } else {\n      ans = this.context.variables.getVar(multiSlot.bindingID);\n    }\n    this.returnValueToParentContext(ans);\n    this.popContext();\n  } else {\n    if (argCount > inputs.length) {\n      this.evaluateNextInput(multiSlot);\n    } else {\n      this.returnValueToParentContext(new List(inputs));\n      this.popContext();\n    }\n  }\n};\n\nProcess.prototype.evaluateArgLabel = function (argLabel) {\n  // perform the ID function on an ArgLabelMorph element\n  var inputs = this.context.inputs;\n  if (inputs.length < 1) {\n    this.evaluateNextInput(argLabel);\n  } else {\n    this.returnValueToParentContext(inputs[0]);\n    this.popContext();\n  }\n};\n\nProcess.prototype.evaluateInput = function (input) {\n  // evaluate the input unless it is bound to an implicit parameter\n  var ans;\n  if (this.flashContext()) {return; } // yield to flash the current argMorph\n  if (input.bindingID) {\n    if (this.isCatchingErrors) {\n      try {\n        ans = this.context.variables.getVar(input.bindingID);\n      } catch (error) {\n        this.handleError(error, input);\n      }\n    } else {\n      ans = this.context.variables.getVar(input.bindingID);\n    }\n  } else {\n    ans = input.evaluate();\n    if (ans) {\n      if (input.constructor === CommandSlotMorph ||\n        input.constructor === ReporterSlotMorph ||\n        (input instanceof CSlotMorph &&\n          (!input.isStatic || input.isLambda))) {\n        // I know, this still needs yet to be done right....\n        ans = this.reify(ans, new List());\n      }\n    }\n  }\n  this.returnValueToParentContext(ans);\n  this.popContext();\n};\n\nProcess.prototype.evaluateSequence = function (arr) {\n  var pc = this.context.pc,\n    outer = this.context.outerContext,\n    isCustomBlock = this.context.isCustomBlock;\n  if (pc === (arr.length - 1)) { // tail call elimination\n    this.context = new Context(\n      this.context.parentContext,\n      arr[pc],\n      this.context.outerContext,\n      this.context.receiver\n    );\n    this.context.isCustomBlock = isCustomBlock;\n  } else {\n    if (pc >= arr.length) {\n      this.popContext();\n    } else {\n      this.context.pc += 1;\n      this.pushContext(arr[pc], outer);\n    }\n  }\n};\n\n/*\n// version w/o tail call optimization:\n--------------------------------------\nCaution: we cannot just revert to this version of the method, because to make\ntail call elimination work many tweaks had to be done to various primitives.\nFor the most part these tweaks are about schlepping the outer context (for\nthe variable bindings) and the isCustomBlock flag along, and are indicated\nby a short comment in the code. But to really revert would take a good measure\nof trial and error as well as debugging. In the developers file archive there\nis a version of threads.js dated 120119(2) which basically resembles the\nlast version before introducing tail call optimization on 120123.\n\nProcess.prototype.evaluateSequence = function (arr) {\n    var pc = this.context.pc;\n    if (pc >= arr.length) {\n        this.popContext();\n    } else {\n        this.context.pc += 1;\n        this.pushContext(arr[pc]);\n    }\n};\n*/\n\nProcess.prototype.evaluateNextInput = function (element) {\n  var nxt = this.context.inputs.length,\n    args = element.inputs(),\n    exp = args[nxt],\n    sel = this.context.expression.selector,\n    outer = this.context.outerContext; // for tail call elimination\n\n  if (exp.isUnevaluated) {\n    if (exp.isUnevaluated === true || exp.isUnevaluated()) {\n      // just return the input as-is\n      /*\n                Note: we only reify the input here, if it's not an\n                input to a reification primitive itself (THE BLOCK,\n                THE SCRIPT), because those allow for additional\n                explicit parameter bindings.\n            */\n      if (sel === 'reify' || sel === 'reportScript') {\n        this.context.addInput(exp);\n      } else {\n        this.context.addInput(this.reify(exp, new List()));\n      }\n    } else {\n      this.pushContext(exp, outer);\n    }\n  } else {\n    this.pushContext(exp, outer);\n  }\n};\n\nProcess.prototype.doYield = function () {\n  this.popContext();\n  if (!this.isAtomic) {\n    this.readyToYield = true;\n  }\n};\n\nProcess.prototype.expectReport = function () {\n  this.handleError(new Error(\"reporter didn't report\"));\n};\n\n// Process Exception Handling\n\nProcess.prototype.handleError = function (error, element) {\n  var m = element;\n  this.stop();\n  this.errorFlag = true;\n  this.topBlock.addErrorHighlight();\n  if (isNil(m) || isNil(m.world())) {m = this.topBlock; }\n  m.showBubble(\n    (m === element ? '' : 'Inside: ')\n    + error.name\n    + '\\n'\n    + error.message,\n    this.exportResult,\n    this.receiver\n  );\n};\n\nProcess.prototype.errorObsolete = function () {\n  throw new Error('a custom block definition is missing');\n};\n\n// Process Lambda primitives\n\nProcess.prototype.reify = function (topBlock, parameterNames, isCustomBlock) {\n  var context = new Context(\n    null,\n    null,\n    this.context ? this.context.outerContext : null\n    ),\n    i = 0;\n\n  if (topBlock) {\n    context.expression = this.enableLiveCoding ||\n    this.enableSingleStepping ?\n      topBlock : topBlock.fullCopy();\n    context.expression.show(); // be sure to make visible if in app mode\n\n    if (!isCustomBlock && !parameterNames.length()) {\n      // mark all empty slots with an identifier\n      context.expression.allEmptySlots().forEach(slot => {\n        i += 1;\n        if (slot instanceof MultiArgMorph) {\n          slot.bindingID = Symbol.for('arguments');\n        } else {\n          slot.bindingID = i;\n        }\n      });\n      // and remember the number of detected empty slots\n      context.emptySlots = i;\n    }\n  } else {\n    context.expression = this.enableLiveCoding ||\n    this.enableSingleStepping ? [this.context.expression]\n      : [this.context.expression.fullCopy()];\n  }\n\n  context.inputs = parameterNames.asArray();\n  context.receiver\n    = this.context ? this.context.receiver : this.receiver;\n  context.origin = context.receiver; // for serialization\n\n  return context;\n};\n\nProcess.prototype.reportScript = function (parameterNames, topBlock) {\n  return this.reify(topBlock, parameterNames);\n};\n\nProcess.prototype.reifyScript = function (topBlock, parameterNames) {\n  return this.reify(topBlock, parameterNames);\n};\n\nProcess.prototype.reifyReporter = function (topBlock, parameterNames) {\n  return this.reify(topBlock, parameterNames);\n};\n\nProcess.prototype.reifyPredicate = function (topBlock, parameterNames) {\n  return this.reify(topBlock, parameterNames);\n};\n\nProcess.prototype.reportJSFunction = function (parmNames, body) {\n  return Function.apply(\n    null,\n    parmNames.asArray().concat([body])\n  );\n};\n\nProcess.prototype.doRun = function (context, args) {\n  return this.evaluate(context, args, true);\n};\n\nProcess.prototype.evaluate = function (\n  context,\n  args,\n  isCommand\n) {\n  if (!context) {\n    return this.returnValueToParentContext(null);\n  }\n  if (context instanceof Function) {\n    // if (!this.enableJS) {\n    //     throw new Error('JavaScript is not enabled');\n    // }\n    return context.apply(\n      this.blockReceiver(),\n      args.asArray().concat([this])\n    );\n  }\n  if (context.isContinuation) {\n    return this.runContinuation(context, args);\n  }\n  if (!(context instanceof Context)) {\n    throw new Error('expecting a ring but getting ' + context);\n  }\n\n  var outer = new Context(null, null, context.outerContext),\n    caller = this.context.parentContext,\n    exit,\n    runnable,\n    expr,\n    parms = args.asArray(),\n    i,\n    value;\n\n  if (!outer.receiver) {\n    outer.receiver = context.receiver; // for custom blocks\n  }\n  runnable = new Context(\n    this.context.parentContext,\n    context.expression,\n    outer,\n    context.receiver\n  );\n  runnable.isCustomCommand = isCommand; // for short-circuiting HTTP requests\n  this.context.parentContext = runnable;\n\n  if (context.expression instanceof ReporterBlockMorph) {\n    // auto-\"warp\" nested reporters\n    this.readyToYield = (Date.now() - this.lastYield > this.timeout);\n  }\n\n  // assign arguments to parameters\n\n  // assign the actual arguments list to the special\n  // parameter ID Symbol.for('arguments'), to be used for variadic inputs\n  outer.variables.addVar(Symbol.for('arguments'), args);\n\n  // assign arguments that are actually passed\n  if (parms.length > 0) {\n\n    // assign formal parameters\n    for (i = 0; i < context.inputs.length; i += 1) {\n      value = 0;\n      if (!isNil(parms[i])) {\n        value = parms[i];\n      }\n      outer.variables.addVar(context.inputs[i], value);\n    }\n\n    // assign implicit parameters if there are no formal ones\n    if (context.inputs.length === 0) {\n      // in case there is only one input\n      // assign it to all empty slots...\n      if (parms.length === 1) {\n        // ... unless it's an empty reporter ring,\n        // in which special case it gets treated as the ID-function;\n        // experimental feature jens is not at all comfortable with\n        if (!context.emptySlots) {\n          expr = context.expression;\n          if (expr instanceof Array &&\n            expr.length === 1 &&\n            expr[0].selector &&\n            expr[0].selector === 'reifyReporter' &&\n            !expr[0].contents()) {\n            runnable.expression = new Variable(parms[0]);\n          }\n        } else {\n          for (i = 1; i <= context.emptySlots; i += 1) {\n            outer.variables.addVar(i, parms[0]);\n          }\n        }\n\n        // if the number of inputs matches the number\n        // of empty slots distribute them sequentially\n      } else if (parms.length === context.emptySlots) {\n        for (i = 1; i <= parms.length; i += 1) {\n          outer.variables.addVar(i, parms[i - 1]);\n        }\n\n      } else if (context.emptySlots !== 1) {\n        throw new Error(\n          localize('expecting') + ' ' + context.emptySlots + ' '\n          + localize('input(s), but getting') + ' '\n          + parms.length\n        );\n      }\n    }\n  }\n\n  if (runnable.expression instanceof CommandBlockMorph) {\n    runnable.expression = runnable.expression.blockSequence();\n    if (!isCommand) {\n      if (caller) {\n        // tag caller, so \"report\" can catch it later\n        caller.tag = 'exit';\n      } else {\n        // top-level context, insert a tagged exit context\n        // which \"report\" can catch later\n        exit = new Context(\n          runnable.parentContext,\n          'expectReport',\n          outer,\n          outer.receiver\n        );\n        exit.tag = 'exit';\n        runnable.parentContext = exit;\n      }\n    }\n  }\n};\n\nProcess.prototype.fork = function (context, args) {\n  if (this.readyToTerminate) {return; }\n  var proc = new Process(),\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n  proc.instrument = this.instrument;\n  proc.receiver = this.receiver;\n  proc.initializeFor(context, args);\n  // proc.pushContext('doYield');\n  stage.threads.processes.push(proc);\n};\n\nProcess.prototype.initializeFor = function (context, args) {\n  // used by Process.fork() and global invoke()\n  if (context.isContinuation) {\n    throw new Error(\n      'continuations cannot be forked'\n    );\n  }\n  if (!(context instanceof Context)) {\n    throw new Error('expecting a ring but getting ' + context);\n  }\n\n  var outer = new Context(null, null, context.outerContext),\n    runnable = new Context(null,\n      context.expression,\n      outer\n    ),\n    parms = args.asArray(),\n    i,\n    value;\n\n  // remember the receiver\n  this.context = context.receiver;\n\n  // assign arguments to parameters\n\n  // assign the actual arguments list to the special\n  // parameter ID Symbol.for('arguments'), to be used for variadic inputs\n  outer.variables.addVar(Symbol.for('arguments'), args);\n\n  // assign arguments that are actually passed\n  if (parms.length > 0) {\n\n    // assign formal parameters\n    for (i = 0; i < context.inputs.length; i += 1) {\n      value = 0;\n      if (!isNil(parms[i])) {\n        value = parms[i];\n      }\n      outer.variables.addVar(context.inputs[i], value);\n    }\n\n    // assign implicit parameters if there are no formal ones\n    if (context.inputs.length === 0) {\n      // in case there is only one input\n      // assign it to all empty slots\n      if (parms.length === 1) {\n        for (i = 1; i <= context.emptySlots; i += 1) {\n          outer.variables.addVar(i, parms[0]);\n        }\n\n        // if the number of inputs matches the number\n        // of empty slots distribute them sequentially\n      } else if (parms.length === context.emptySlots) {\n        for (i = 1; i <= parms.length; i += 1) {\n          outer.variables.addVar(i, parms[i - 1]);\n        }\n\n      } else if (context.emptySlots !== 1) {\n        throw new Error(\n          localize('expecting') + ' ' + context.emptySlots + ' '\n          + localize('input(s), but getting') + ' '\n          + parms.length\n        );\n      }\n    }\n  }\n\n  if (runnable.expression instanceof CommandBlockMorph) {\n    runnable.expression = runnable.expression.blockSequence();\n  }\n\n  this.homeContext = new Context(); // context.outerContext;\n  this.homeContext.receiver = context.outerContext.receiver;\n  this.topBlock = context.expression;\n  this.context = runnable;\n};\n\n// Process stopping blocks primitives\n\nProcess.prototype.doStopBlock = function () {\n  var target = this.context.expression.exitTag;\n  if (isNil(target)) {\n    return this.doStopCustomBlock();\n  }\n  while (this.context &&\n  (isNil(this.context.tag) || (this.context.tag > target))) {\n    if (this.context.expression === 'doStopWarping') {\n      this.doStopWarping();\n    } else {\n      this.popContext();\n    }\n  }\n  this.pushContext();\n};\n\nProcess.prototype.doStopCustomBlock = function () {\n  // fallback solution for \"report\" blocks inside\n  // custom command definitions and untagged \"stop\" blocks\n  while (this.context && !this.context.isCustomBlock) {\n    if (this.context.expression === 'doStopWarping') {\n      this.doStopWarping();\n    } else {\n      this.popContext();\n    }\n  }\n};\n\n// Process continuations primitives\n\nProcess.prototype.doCallCC = function (aContext, isReporter) {\n  this.evaluate(\n    aContext,\n    new List([this.context.continuation(isReporter)]),\n    !isReporter\n  );\n};\n\nProcess.prototype.reportCallCC = function (aContext) {\n  this.doCallCC(aContext, true);\n};\n\nProcess.prototype.runContinuation = function (aContext, args) {\n  var parms = args.asArray();\n\n  // determine whether the continuations is to show the result\n  // in a value-balloon becuse the user has directly clicked on a reporter\n  if (aContext.expression === 'expectReport' && parms.length) {\n    this.stop();\n    this.homeContext.inputs[0] = parms[0];\n    return;\n  }\n\n  this.context.parentContext = aContext.copyForContinuationCall();\n  // passing parameter if any was passed\n  if (parms.length === 1) {\n    this.context.parentContext.outerContext.variables.addVar(\n      1,\n      parms[0]\n    );\n  }\n};\n\n// Process custom block primitives\n\nProcess.prototype.evaluateCustomBlock = function () {\n  var caller = this.context.parentContext,\n    block = this.context.expression,\n    method = block.isGlobal ? block.definition\n      : this.blockReceiver().getMethod(block.semanticSpec),\n    context = method.body,\n    declarations = method.declarations,\n    args = new List(this.context.inputs),\n    parms = args.asArray(),\n    runnable,\n    exit,\n    i,\n    value,\n    outer;\n\n  if (!context) {return null; }\n  this.procedureCount += 1;\n  outer = new Context();\n  outer.receiver = this.context.receiver;\n\n  outer.variables.parentFrame = block.variables;\n\n  // block (instance) var support, experimental:\n  // only splice in block vars if any are defined, because block vars\n  // can cause race conditions in global block definitions that\n  // access sprite-local variables at the same time.\n  if (method.variableNames.length) {\n    block.variables.parentFrame = outer.receiver ?\n      outer.receiver.variables : null;\n  } else {\n    // original code without block variables:\n    outer.variables.parentFrame = outer.receiver ?\n      outer.receiver.variables : null;\n  }\n\n  runnable = new Context(\n    this.context.parentContext,\n    context.expression,\n    outer,\n    outer.receiver\n  );\n  runnable.isCustomBlock = true;\n  this.context.parentContext = runnable;\n\n  // passing parameters if any were passed\n  if (parms.length > 0) {\n\n    // assign formal parameters\n    for (i = 0; i < context.inputs.length; i += 1) {\n      value = 0;\n      if (!isNil(parms[i])) {\n        value = parms[i];\n      }\n      outer.variables.addVar(context.inputs[i], value);\n\n      // if the parameter is an upvar,\n      // create a reference to the variable it points to\n      if (declarations.get(context.inputs[i])[0] === '%upvar') {\n        this.context.outerContext.variables.vars[value] =\n          outer.variables.vars[context.inputs[i]];\n      }\n    }\n  }\n\n  // tag return target\n  if (method.type !== 'command') {\n    if (caller) {\n      // tag caller, so \"report\" can catch it later\n      caller.tag = 'exit';\n    } else {\n      // top-level context, insert a tagged exit context\n      // which \"report\" can catch later\n      exit = new Context(\n        runnable.parentContext,\n        'expectReport',\n        outer,\n        outer.receiver\n      );\n      exit.tag = 'exit';\n      runnable.parentContext = exit;\n    }\n    // auto-\"warp\" nested reporters\n    this.readyToYield = (Date.now() - this.lastYield > this.timeout);\n  } else {\n    // tag all \"stop this block\" blocks with the current\n    // procedureCount as exitTag, and mark all \"report\" blocks\n    // as being inside a custom command definition\n    runnable.expression.tagExitBlocks(this.procedureCount, true);\n\n    // tag the caller with the current procedure count, so\n    // \"stop this block\" blocks can catch it, but only\n    // if the caller hasn't been tagged already\n    if (caller && !caller.tag) {\n      caller.tag = this.procedureCount;\n    }\n    // yield commands unless explicitly \"warped\" or directly recursive\n    if (!this.isAtomic && method.isDirectlyRecursive()) {\n      this.readyToYield = true;\n    }\n  }\n  runnable.expression = runnable.expression.blockSequence();\n};\n\n// Process variables primitives\n\nProcess.prototype.doDeclareVariables = function (varNames) {\n  var varFrame = this.context.outerContext.variables;\n  varNames.asArray().forEach(name =>\n    varFrame.addVar(name)\n  );\n};\n\nProcess.prototype.doSetVar = function (varName, value) {\n  var varFrame = this.context.variables,\n    name = varName;\n  if (name instanceof Context) {\n    if (name.expression.selector === 'reportGetVar') {\n      name.variables.setVar(\n        name.expression.blockSpec,\n        value,\n        this.blockReceiver()\n      );\n      return;\n    }\n    this.doSet(name, value);\n    return;\n  }\n  if (name instanceof Array) {\n    this.doSet(name, value);\n    return;\n  }\n  varFrame.setVar(name, value, this.blockReceiver());\n};\n\nProcess.prototype.doChangeVar = function (varName, value) {\n  var varFrame = this.context.variables,\n    name = varName;\n  this.assertType(value, 'number');\n  if (name instanceof Context) {\n    if (name.expression.selector === 'reportGetVar') {\n      name.variables.changeVar(\n        name.expression.blockSpec,\n        value,\n        this.blockReceiver()\n      );\n      return;\n    }\n  }\n  varFrame.changeVar(name, value, this.blockReceiver());\n};\n\nProcess.prototype.reportGetVar = function () {\n  // assumes a getter block whose blockSpec is a variable name\n  return this.context.variables.getVar(\n    this.context.expression.blockSpec\n  );\n};\n\nProcess.prototype.doShowVar = function (varName) {\n  var varFrame = (this.context || this.homeContext).variables,\n    stage,\n    watcher,\n    target,\n    label,\n    others,\n    isGlobal,\n    name = varName;\n\n  if (name instanceof Context) {\n    if (name.expression.selector === 'reportGetVar') {\n      name = name.expression.blockSpec;\n    } else {\n      this.doChangePrimitiveVisibility(name.expression, false);\n      return;\n    }\n  }\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      target = varFrame.silentFind(name);\n      if (!target) {return; }\n      // first try to find an existing (hidden) watcher\n      watcher = detect(\n        stage.children,\n        morph => morph instanceof WatcherMorph &&\n          morph.target === target &&\n          morph.getter === name\n      );\n      if (watcher !== null) {\n        watcher.show();\n        watcher.fixLayout(); // re-hide hidden parts\n        return;\n      }\n      // if no watcher exists, create a new one\n      isGlobal = contains(\n        this.homeContext.receiver.globalVariables().names(),\n        varName\n      );\n      if (isGlobal || target.owner) {\n        label = name;\n      } else {\n        label = name + ' ' + localize('(temporary)');\n      }\n      watcher = new WatcherMorph(\n        label,\n        SpriteMorph.prototype.blockColor.variables,\n        target,\n        name\n      );\n      watcher.setPosition(stage.position().add(10));\n      others = stage.watchers(watcher.left());\n      if (others.length > 0) {\n        watcher.setTop(others[others.length - 1].bottom());\n      }\n      stage.add(watcher);\n      watcher.fixLayout();\n      watcher.rerender();\n    }\n  }\n};\n\nProcess.prototype.doHideVar = function (varName) {\n  // if no varName is specified delete all watchers on temporaries\n  var varFrame = this.context.variables,\n    stage,\n    watcher,\n    target,\n    name = varName;\n\n  if (name instanceof Context) {\n    if (name.expression.selector === 'reportGetVar') {\n      name = name.expression.blockSpec;\n    } else {\n      this.doChangePrimitiveVisibility(name.expression, true);\n      return;\n    }\n  }\n  if (!name) {\n    this.doRemoveTemporaries();\n    return;\n  }\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      target = varFrame.find(name);\n      watcher = detect(\n        stage.children,\n        morph => morph instanceof WatcherMorph &&\n          morph.target === target &&\n          morph.getter === name\n      );\n      if (watcher !== null) {\n        if (watcher.isTemporary()) {\n          watcher.destroy();\n        } else {\n          watcher.hide();\n        }\n      }\n    }\n  }\n};\n\nProcess.prototype.doRemoveTemporaries = function () {\n  var stage;\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      stage.watchers().forEach(watcher => {\n        if (watcher.isTemporary()) {\n          watcher.destroy();\n        }\n      });\n    }\n  }\n};\n\n// Process hiding and showing primitives primitives :-)\n\nProcess.prototype.doChangePrimitiveVisibility = function (aBlock, hideIt) {\n  var ide = this.homeContext.receiver.parentThatIsA(IDE_Morph),\n    dict,\n    cat;\n  if (!ide || (aBlock.selector === 'evaluateCustomBlock')) {\n    return;\n  }\n  if (hideIt) {\n    StageMorph.prototype.hiddenPrimitives[aBlock.selector] = true;\n  } else {\n    delete StageMorph.prototype.hiddenPrimitives[aBlock.selector];\n  }\n  dict = {\n    doWarp: 'control',\n    reifyScript: 'operators',\n    reifyReporter: 'operators',\n    reifyPredicate: 'operators',\n    doDeclareVariables: 'variables'\n  };\n  cat = dict[this.selector] || this.category;\n  if (cat === 'lists') {cat = 'variables'; }\n  ide.flushBlocksCache(cat);\n  ide.refreshPalette();\n};\n\n// Process sprite inheritance primitives\n\nProcess.prototype.doDeleteAttr = function (attrName) {\n  var name = attrName,\n    rcvr = this.blockReceiver();\n  if (name instanceof Context) {\n    if (name.expression.selector === 'reportGetVar') {\n      name = name.expression.blockSpec;\n    } else { // attribute\n      name = {\n        xPosition: 'x position',\n        yPosition: 'y position',\n        direction: 'direction',\n        getCostumeIdx: 'costume #',\n        size: 'size'\n      }[name.expression.selector];\n      if (!isNil(name)) {\n        rcvr.inheritAttribute(name);\n      }\n      return; // error: cannot delete attribute...\n    }\n  }\n  if (name instanceof Array) {\n    return rcvr.inheritAttribute(this.inputOption(name));\n  }\n  if (contains(rcvr.inheritedVariableNames(true), name)) {\n    rcvr.deleteVariable(name);\n  }\n};\n\n// experimental message passing primitives\n\nProcess.prototype.doTellTo = function (sprite, context, args) {\n  this.doRun(\n    this.reportAttributeOf(context, sprite),\n    args\n  );\n};\n\nProcess.prototype.reportAskFor = function (sprite, context, args) {\n  this.evaluate(\n    this.reportAttributeOf(context, sprite),\n    args\n  );\n};\n\n// Process lists primitives\n\nProcess.prototype.reportNewList = function (elements) {\n  return elements;\n};\n\nProcess.prototype.reportCONS = function (car, cdr) {\n  this.assertType(cdr, 'list');\n  return new List().cons(car, cdr);\n};\n\nProcess.prototype.reportCDR = function (list) {\n  this.assertType(list, 'list');\n  return list.cdr();\n};\n\nProcess.prototype.doAddToList = function (element, list) {\n  this.assertType(list, 'list');\n  if (list.type) {\n    this.assertType(element, list.type);\n    list = this.shadowListAttribute(list);\n  }\n  list.add(element);\n};\n\nProcess.prototype.doDeleteFromList = function (index, list) {\n  var idx = index;\n  this.assertType(list, 'list');\n  if (list.type) {\n    list = this.shadowListAttribute(list);\n  }\n  if (this.inputOption(index) === 'all') {\n    return list.clear();\n  }\n  if (index === '') {\n    return null;\n  }\n  if (this.inputOption(index) === 'last') {\n    idx = list.length();\n  } else if (isNaN(+this.inputOption(index))) {\n    return null;\n  }\n  list.remove(idx);\n};\n\nProcess.prototype.doInsertInList = function (element, index, list) {\n  var idx = index;\n  this.assertType(list, 'list');\n  if (list.type) {\n    this.assertType(element, list.type);\n    list = this.shadowListAttribute(list);\n  }\n  if (index === '') {\n    return null;\n  }\n  if (this.inputOption(index) === 'any') {\n    idx = this.reportBasicRandom(1, list.length() + 1);\n  }\n  if (this.inputOption(index) === 'last') {\n    idx = list.length() + 1;\n  }\n  list.add(element, idx);\n};\n\nProcess.prototype.doReplaceInList = function (index, list, element) {\n  var idx = index;\n  this.assertType(list, 'list');\n  if (list.type) {\n    this.assertType(element, list.type);\n    list = this.shadowListAttribute(list);\n  }\n  if (index === '') {\n    return null;\n  }\n  if (this.inputOption(index) === 'any') {\n    idx = this.reportBasicRandom(1, list.length());\n  }\n  if (this.inputOption(index) === 'last') {\n    idx = list.length();\n  }\n  list.put(element, idx);\n};\n\nProcess.prototype.shadowListAttribute = function (list) {\n  // private - check whether the list is an attribute that needs to be\n  // shadowed. Use only on typed lists for performance.\n  var rcvr;\n  if (list.type === 'costume' || list.type === 'sound') {\n    rcvr = this.blockReceiver();\n    if (list === rcvr.costumes) {\n      rcvr.shadowAttribute('costumes');\n      list = rcvr.costumes;\n    } else if (list === rcvr.sounds) {\n      rcvr.shadowAttribute('sounds');\n      list = rcvr.sounds;\n    }\n  }\n  return list;\n};\n\n// Process accessing list elements - hyper dyadic\n\nProcess.prototype.reportListItem = function (index, list) {\n  var rank;\n  this.assertType(list, 'list');\n  if (index === '') {\n    return '';\n  }\n  if (this.inputOption(index) === 'any') {\n    return list.at(this.reportBasicRandom(1, list.length()));\n  }\n  if (this.inputOption(index) === 'last') {\n    return list.at(list.length());\n  }\n  rank = this.rank(index);\n  if (rank > 0 && this.enableHyperOps) {\n    if (rank === 1) {\n      if (index.isEmpty()) {\n        return list.map(item => item);\n      }\n      return index.map(idx => list.at(idx));\n    }\n    return this.reportItems(index, list);\n  }\n  return list.at(index);\n};\n\nProcess.prototype.reportItems = function (indices, list) {\n  // This. This is it. The pinnacle of my programmer's life.\n  // After days of roaming about my house and garden,\n  // of taking showers and rummaging through the fridge,\n  // of strumming the charango and the five ukuleles\n  // sitting next to my laptop on my desk,\n  // and of letting my mind wander far and wide,\n  // to come up with this design, always thinking\n  // \"What would Brian do?\".\n  // And look, Ma, it's turned out all beautiful! -jens\n\n  return makeSelector(\n    this.rank(list),\n    indices.cdr(),\n    makeLeafSelector(indices.at(1))\n  )(list);\n\n  function makeSelector(rank, indices, next) {\n    if (rank === 1) {\n      return next;\n    }\n    return makeSelector(\n      rank - 1,\n      indices.cdr(),\n      makeBranch(\n        indices.at(1) || new List(),\n        next\n      )\n    );\n  }\n\n  function makeBranch(indices, next) {\n    return function(data) {\n      if (indices.isEmpty()) {\n        return data.map(item => next(item));\n      }\n      return indices.map(idx => next(data.at(idx)));\n    };\n  }\n\n  function makeLeafSelector(indices) {\n    return function (data) {\n      if (indices.isEmpty()) {\n        return data.map(item => item);\n      }\n      return indices.map(idx => data.at(idx));\n    };\n  }\n};\n\n// Process - other basic list accessors\n\nProcess.prototype.reportListLength = function (list) {\n  this.assertType(list, 'list');\n  return list.length();\n};\n\nProcess.prototype.reportListIndex = function(element, list) {\n  this.assertType(list, 'list');\n  return list.indexOf(element);\n};\n\nProcess.prototype.reportListContainsItem = function (list, element) {\n  this.assertType(list, 'list');\n  return list.contains(element);\n};\n\nProcess.prototype.reportListIsEmpty = function (list) {\n  this.assertType(list, 'list');\n  return list.isEmpty();\n};\n\nProcess.prototype.doShowTable = function (list) {\n  // experimental\n  this.assertType(list, 'list');\n  new TableDialogMorph(list).popUp(this.blockReceiver().world());\n};\n\n// Process non-HOF list primitives\n\nProcess.prototype.reportNumbers = function (start, end) {\n  // hyper-dyadic\n  if (this.enableHyperOps) {\n    return this.hyperDyadic(\n      (strt, stp) => this.reportBasicNumbers(strt, stp),\n      start,\n      end\n    );\n  }\n  return this.reportLinkedNumbers(start, end);\n};\n\nProcess.prototype.reportBasicNumbers = function (start, end) {\n  // answer a new arrayed list containing an linearly ascending progression\n  // of integers beginning at start to end.\n  var result, len, i,\n    s = +start,\n    e = +end,\n    n = s;\n\n  this.assertType(s, 'number');\n  this.assertType(e, 'number');\n\n  if (e > s) {\n    len = Math.floor(e - s);\n    result = new Array(len);\n    for(i = 0; i <= len; i += 1) {\n      result[i] = n;\n      n += 1;\n    }\n  } else {\n    len = Math.floor(s - e);\n    result = new Array(len);\n    for(i = 0; i <= len; i += 1) {\n      result[i] = n;\n      n -= 1;\n    }\n  }\n  return new List(result);\n};\n\nProcess.prototype.reportConcatenatedLists = function (lists) {\n  var first, result, rows, row, rowIdx, cols, col;\n  this.assertType(lists, 'list');\n  if (lists.isEmpty()) {\n    return lists;\n  }\n  first = lists.at(1);\n  this.assertType(first, 'list');\n  if (first.isLinked) { // link everything\n    return this.concatenateLinkedLists(lists);\n  }\n\n  // in case the first sub-list is arrayed\n  result = [];\n  rows = lists.length();\n  for (rowIdx = 1; rowIdx <= rows; rowIdx += 1) {\n    row = lists.at(rowIdx);\n    this.assertType(row, 'list');\n    cols = row.length();\n    for (col = 1; col <= cols; col += 1) {\n      result.push(row.at(col));\n    }\n  }\n  return new List(result);\n};\n\nProcess.prototype.concatenateLinkedLists = function (lists) {\n  var first;\n  if (lists.isEmpty()) {\n    return lists;\n  }\n  first = lists.at(1);\n  this.assertType(first, 'list');\n  if (lists.length() === 1) {\n    return first;\n  }\n  if (first.isEmpty()) {\n    return this.concatenateLinkedLists(lists.cdr());\n  }\n  return lists.cons(\n    first.at(1),\n    this.concatenateLinkedLists(\n      lists.cons(\n        first.cdr(),\n        lists.cdr()\n      )\n    )\n  );\n};\n\n// Process interpolated non-HOF list primitives\n\nProcess.prototype.reportLinkedNumbers = function (start, end) {\n  // answer a new linked list containing an linearly ascending progression\n  // of integers beginning at start to end.\n  // this is interpolated so it can handle big ranges of numbers\n  // without blocking the UI\n\n  var dta;\n  if (this.context.accumulator === null) {\n    this.assertType(start, 'number');\n    this.assertType(end, 'number');\n    this.context.accumulator = {\n      target : new List(),\n      end : null,\n      idx : +start,\n      step: +end > +start ? +1 : -1\n    };\n    this.context.accumulator.target.isLinked = true;\n    this.context.accumulator.end = this.context.accumulator.target;\n  }\n  dta = this.context.accumulator;\n  if (dta.step === 1 ? dta.idx > +end : dta.idx < +end) {\n    dta.end.rest = new List();\n    this.returnValueToParentContext(dta.target.cdr());\n    return;\n  }\n  dta.end.rest = dta.target.cons(dta.idx);\n  dta.end = dta.end.rest;\n  dta.idx += dta.step;\n  this.pushContext();\n};\n\n// Process conditionals primitives\n\nProcess.prototype.doIf = function () {\n  var args = this.context.inputs,\n    outer = this.context.outerContext, // for tail call elimination\n    isCustomBlock = this.context.isCustomBlock;\n\n  // this.assertType(args[0], ['Boolean']);\n  this.popContext();\n  if (args[0]) {\n    if (args[1]) {\n      this.pushContext(args[1].blockSequence(), outer);\n      this.context.isCustomBlock = isCustomBlock;\n    }\n  }\n  this.pushContext();\n};\n\nProcess.prototype.doIfElse = function () {\n  var args = this.context.inputs,\n    outer = this.context.outerContext, // for tail call elimination\n    isCustomBlock = this.context.isCustomBlock;\n\n  // this.assertType(args[0], ['Boolean']);\n  this.popContext();\n  if (args[0]) {\n    if (args[1]) {\n      this.pushContext(args[1].blockSequence(), outer);\n    }\n  } else {\n    if (args[2]) {\n      this.pushContext(args[2].blockSequence(), outer);\n    } else {\n      this.pushContext('doYield');\n    }\n  }\n  if (this.context) {\n    this.context.isCustomBlock = isCustomBlock;\n  }\n\n  this.pushContext();\n};\n\nProcess.prototype.reportIfElse = function (block) {\n  var inputs = this.context.inputs;\n\n  if (inputs.length < 1) {\n    this.evaluateNextInput(block);\n  } else if (inputs.length > 1) {\n    if (this.flashContext()) {return; }\n    this.returnValueToParentContext(inputs.pop());\n    this.popContext();\n  } else {\n    // this.assertType(inputs[0], ['Boolean']);\n    if (inputs[0]) {\n      this.evaluateNextInput(block);\n    } else {\n      inputs.push(null);\n      this.evaluateNextInput(block);\n    }\n  }\n};\n\n/*\n// Process - hyperized reporter-if, experimental, commented out for now\n\nProcess.prototype.reportIfElse = function (block) {\n    var inputs = this.context.inputs;\n\n    if (inputs.length < 1) {\n        this.evaluateNextInput(block);\n    } else if (inputs.length > 1) {\n        if (this.flashContext()) {return; }\n        if (inputs[0] instanceof List && this.enableHyperOps) {\n            if (inputs.length < 3) {\n                this.evaluateNextInput(block);\n            } else {\n                this.returnValueToParentContext(\n                    this.hyperIf.apply(this, inputs)\n                );\n                this.popContext();\n            }\n        } else {\n            this.returnValueToParentContext(inputs.pop());\n            this.popContext();\n        }\n    } else {\n        if (inputs[0] instanceof List && this.enableHyperOps) {\n            this.evaluateNextInput(block);\n        } else {\n            // this.assertType(inputs[0], ['Boolean']);\n            if (inputs[0]) {\n                this.evaluateNextInput(block);\n            } else {\n                inputs.push(null);\n                this.evaluateNextInput(block);\n            }\n        }\n    }\n};\n\nProcess.prototype.hyperIf = function (test, trueValue, falseValue) {\n    if (test instanceof List) {\n        return test.map(each => this.hyperIf(each, trueValue, falseValue));\n    }\n    return test ? trueValue : falseValue;\n};\n*/\n\n// Process process related primitives\n\nProcess.prototype.doStop = function () {\n  this.stop();\n};\n\nProcess.prototype.doStopAll = function () {\n  var stage, ide;\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      if (stage.enableCustomHatBlocks) {\n        stage.threads.pauseCustomHatBlocks =\n          !stage.threads.pauseCustomHatBlocks;\n      } else {\n        stage.threads.pauseCustomHatBlocks = false;\n      }\n      stage.stopAllActiveSounds();\n      stage.threads.resumeAll(stage);\n      stage.keysPressed = {};\n      stage.runStopScripts();\n      stage.threads.stopAll();\n      if (stage.projectionSource) {\n        stage.stopProjection();\n      }\n      stage.children.forEach(morph => {\n        if (morph.stopTalking) {\n          morph.stopTalking();\n        }\n      });\n      stage.removeAllClones();\n    }\n    ide = stage.parentThatIsA(IDE_Morph);\n    if (ide) {\n      ide.controlBar.pauseButton.refresh();\n      ide.controlBar.stopButton.refresh();\n    }\n  }\n};\n\nProcess.prototype.doStopThis = function (choice) {\n  switch (this.inputOption(choice)) {\n    case 'all':\n      this.doStopAll();\n      break;\n    case 'this script':\n      this.doStop();\n      break;\n    case 'this block':\n      this.doStopBlock();\n      break;\n    default:\n      this.doStopOthers(choice);\n  }\n};\n\nProcess.prototype.doStopOthers = function (choice) {\n  var stage;\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      switch (this.inputOption(choice)) {\n        case 'all but this script':\n          stage.threads.stopAll(this);\n          break;\n        case 'other scripts in sprite':\n          stage.threads.stopAllForReceiver(\n            this.homeContext.receiver,\n            this\n          );\n          break;\n        default:\n          nop();\n      }\n    }\n  }\n};\n\nProcess.prototype.doWarp = function (body) {\n  // execute my contents block atomically (more or less)\n  var outer = this.context.outerContext, // for tail call elimination\n    isCustomBlock = this.context.isCustomBlock,\n    stage;\n\n  this.popContext();\n\n  if (body) {\n    if (this.homeContext.receiver) {\n      if (this.homeContext.receiver.startWarp) {\n        // pen optimization\n        this.homeContext.receiver.startWarp();\n      }\n      stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n      if (stage) {\n        stage.fps = 0; // variable frame rate\n      }\n    }\n\n    // this.pushContext('doYield'); // no longer needed in Morphic2\n    this.pushContext('popContext'); // instead we do this...\n\n    if (this.context) {\n      this.context.isCustomBlock = isCustomBlock;\n    }\n    if (!this.isAtomic) {\n      this.pushContext('doStopWarping');\n    }\n    this.pushContext(body.blockSequence(), outer);\n    this.isAtomic = true;\n  }\n  this.pushContext();\n};\n\nProcess.prototype.doStopWarping = function () {\n  var stage;\n  this.popContext();\n  this.isAtomic = false;\n  if (this.homeContext.receiver) {\n    if (this.homeContext.receiver.endWarp) {\n      // pen optimization\n      this.homeContext.receiver.endWarp();\n    }\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      stage.fps = stage.frameRate; //  back to fixed frame rate\n    }\n  }\n};\n\nProcess.prototype.reportIsFastTracking = function () {\n  var ide;\n  if (this.homeContext.receiver) {\n    ide = this.homeContext.receiver.parentThatIsA(IDE_Morph);\n    if (ide) {\n      return ide.stage.isFastTracked;\n    }\n  }\n  return false;\n};\n\nProcess.prototype.doSetGlobalFlag = function (name, bool) {\n  var stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n  name = this.inputOption(name);\n  this.assertType(bool, 'Boolean');\n  switch (name) {\n    case 'turbo mode':\n      this.doSetFastTracking(bool);\n      break;\n    case 'flat line ends':\n      SpriteMorph.prototype.useFlatLineEnds = bool;\n      break;\n    case 'log pen vectors':\n      StageMorph.prototype.enablePenLogging = bool;\n      break;\n    case 'video capture':\n      if (bool) {\n        this.startVideo(stage);\n      } else {\n        stage.stopProjection();\n      }\n      break;\n    case 'mirror video':\n      stage.mirrorVideo = bool;\n      break;\n  }\n};\n\nProcess.prototype.reportGlobalFlag = function (name) {\n  var stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n  name = this.inputOption(name);\n  switch (name) {\n    case 'turbo mode':\n      return this.reportIsFastTracking();\n    case 'flat line ends':\n      return SpriteMorph.prototype.useFlatLineEnds;\n    case 'log pen vectors':\n      return StageMorph.prototype.enablePenLogging;\n    case 'video capture':\n      return !isNil(stage.projectionSource) &&\n        stage.projectionLayer()\n          .getContext('2d')\n          .getImageData(0, 0, 1, 1)\n          .data[3] > 0;\n    case 'mirror video':\n      return stage.mirrorVideo;\n    default:\n      return '';\n  }\n};\n\nProcess.prototype.doSetFastTracking = function (bool) {\n  var ide;\n  if (!this.reportIsA(bool, 'Boolean')) {\n    return;\n  }\n  if (this.homeContext.receiver) {\n    ide = this.homeContext.receiver.parentThatIsA(IDE_Morph);\n    if (ide) {\n      if (bool) {\n        ide.startFastTracking();\n      } else {\n        ide.stopFastTracking();\n      }\n    }\n  }\n};\n\nProcess.prototype.doPauseAll = function () {\n  var stage, ide;\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      stage.threads.pauseAll(stage);\n    }\n    ide = stage.parentThatIsA(IDE_Morph);\n    if (ide) {ide.controlBar.pauseButton.refresh(); }\n  }\n};\n\n// Process loop primitives\n\nProcess.prototype.doForever = function (body) {\n  this.context.inputs = []; // force re-evaluation of C-slot\n  this.pushContext('doYield');\n  if (body) {\n    this.pushContext(body.blockSequence());\n  }\n  this.pushContext();\n};\n\nProcess.prototype.doRepeat = function (counter, body) {\n  var block = this.context.expression,\n    outer = this.context.outerContext, // for tail call elimination\n    isCustomBlock = this.context.isCustomBlock;\n\n  if (counter < 1) { // was '=== 0', which caused infinite loops on non-ints\n    return null;\n  }\n  this.popContext();\n  this.pushContext(block, outer);\n  this.context.isCustomBlock = isCustomBlock;\n  this.context.addInput(counter - 1);\n  this.pushContext('doYield');\n  if (body) {\n    this.pushContext(body.blockSequence());\n  }\n  this.pushContext();\n};\n\nProcess.prototype.doUntil = function (goalCondition, body) {\n  // this.assertType(goalCondition, ['Boolean']);\n  if (goalCondition) {\n    this.popContext();\n    this.pushContext('doYield');\n    return null;\n  }\n  this.context.inputs = [];\n  this.pushContext('doYield');\n  if (body) {\n    this.pushContext(body.blockSequence());\n  }\n  this.pushContext();\n};\n\nProcess.prototype.doWaitUntil = function (goalCondition) {\n  // this.assertType(goalCondition, ['Boolean']);\n  if (goalCondition) {\n    this.popContext();\n    this.pushContext('doYield');\n    return null;\n  }\n  this.context.inputs = [];\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\n// Process interpolated iteration primitives\n\nProcess.prototype.doForEach = function (upvar, list, script) {\n  // perform a script for each element of a list, assigning the\n  // current iteration's element to a variable with the name\n  // specified in the \"upvar\" parameter, so it can be referenced\n  // within the script.\n  // Distinguish between linked and arrayed lists.\n\n  var next;\n  if (this.context.accumulator === null) {\n    this.assertType(list, 'list');\n    this.context.accumulator = {\n      source : list,\n      remaining : list.length(),\n      idx : 0\n    };\n  }\n  if (this.context.accumulator.remaining === 0) {\n    return;\n  }\n  this.context.accumulator.remaining -= 1;\n  if (this.context.accumulator.source.isLinked) {\n    next = this.context.accumulator.source.at(1);\n    this.context.accumulator.source =\n      this.context.accumulator.source.cdr();\n  } else { // arrayed\n    this.context.accumulator.idx += 1;\n    next = this.context.accumulator.source.at(this.context.accumulator.idx);\n  }\n  this.pushContext('doYield');\n  this.pushContext();\n  this.context.outerContext.variables.addVar(upvar);\n  this.context.outerContext.variables.setVar(upvar, next);\n  this.evaluate(script, new List([next]), true);\n};\n\nProcess.prototype.doFor = function (upvar, start, end, script) {\n  // perform a script for every integer step between start and stop,\n  // assigning the current iteration index to a variable with the\n  // name specified in the \"upvar\" parameter, so it can be referenced\n  // within the script.\n\n  var vars = this.context.outerContext.variables,\n    dta = this.context.accumulator;\n  if (dta === null) {\n    this.assertType(start, 'number');\n    this.assertType(end, 'number');\n    dta = this.context.accumulator = {\n      test : +start < +end ?\n        (() => vars.getVar(upvar) > +end)\n        : (() => vars.getVar(upvar) < +end),\n      step : +start < +end ? 1 : -1,\n      parms : new List() // empty parameters, reusable to avoid GC\n    };\n    vars.addVar(upvar);\n    vars.setVar(upvar, Math.floor(+start));\n  } else {\n    vars.changeVar(upvar, dta.step);\n  }\n  if (dta.test()) {return; }\n  this.pushContext('doYield');\n  this.pushContext();\n  this.evaluate(script, dta.parms, true);\n};\n\n// Process interpolated HOF primitives\n\n/*\n    this.context.inputs:\n    [0] - reporter\n    [1] - list (original source)\n    -----------------------------\n    [2] - last reporter evaluation result\n\n    these primitives used to store the accumulated data in the unused parts\n    of the context's input-array. For reasons obscure to me this led to\n    JS stack overflows when used on large lists (> 150 k items). As a remedy\n    aggregations are now accumulated in the \"accumulator\" property slot\n    of Context. Why this speeds up execution by orders of magnitude while\n    \"fixing\" the stack-overflow issue eludes me. -Jens\n*/\n\nProcess.prototype.reportMap = function (reporter, list) {\n  // answer a new list containing the results of the reporter applied\n  // to each value of the given list. Distinguish between linked and\n  // arrayed lists.\n  // if the reporter uses formal parameters instead of implicit empty slots\n  // there are two additional optional parameters:\n  // #1 - element\n  // #2 - optional | index\n  // #3 - optional | source list\n\n  var next, index, parms;\n  if (list.isLinked) {\n    if (this.context.accumulator === null) {\n      this.assertType(list, 'list');\n      this.context.accumulator = {\n        source : list,\n        idx : 1,\n        target : new List(),\n        end : null,\n        remaining : list.length()\n      };\n      this.context.accumulator.target.isLinked = true;\n      this.context.accumulator.end = this.context.accumulator.target;\n    } else if (this.context.inputs.length > 2) {\n      this.context.accumulator.end.rest = list.cons(\n        this.context.inputs.pop()\n      );\n      this.context.accumulator.end = this.context.accumulator.end.rest;\n      this.context.accumulator.idx += 1;\n      this.context.accumulator.remaining -= 1;\n    }\n    if (this.context.accumulator.remaining === 0) {\n      this.context.accumulator.end.rest = list.cons(\n        this.context.inputs[2]\n      ).cdr();\n      this.returnValueToParentContext(\n        this.context.accumulator.target.cdr()\n      );\n      return;\n    }\n    index = this.context.accumulator.idx;\n    next = this.context.accumulator.source.at(1);\n    this.context.accumulator.source = this.context.accumulator.source.cdr();\n  } else { // arrayed\n    if (this.context.accumulator === null) {\n      this.assertType(list, 'list');\n      this.context.accumulator = [];\n    } else if (this.context.inputs.length > 2) {\n      this.context.accumulator.push(this.context.inputs.pop());\n    }\n    if (this.context.accumulator.length === list.length()) {\n      this.returnValueToParentContext(\n        new List(this.context.accumulator)\n      );\n      return;\n    }\n    index = this.context.accumulator.length + 1;\n    next = list.at(index);\n  }\n  this.pushContext();\n  parms = [next];\n  if (reporter.inputs.length > 1) {\n    parms.push(index);\n  }\n  if (reporter.inputs.length > 2) {\n    parms.push(list);\n  }\n  this.evaluate(reporter, new List(parms));\n};\n\nProcess.prototype.reportKeep = function (predicate, list) {\n  // Filter - answer a new list containing the items of the list for which\n  // the predicate evaluates TRUE.\n  // Distinguish between linked and arrayed lists.\n  // if the predicate uses formal parameters instead of implicit empty slots\n  // there are two additional optional parameters:\n  // #1 - element\n  // #2 - optional | index\n  // #3 - optional | source list\n\n  var next, index, parms;\n  if (list.isLinked) {\n    if (this.context.accumulator === null) {\n      this.assertType(list, 'list');\n      this.context.accumulator = {\n        source : list,\n        idx: 1,\n        target : new List(),\n        end : null,\n        remaining : list.length()\n      };\n      this.context.accumulator.target.isLinked = true;\n      this.context.accumulator.end = this.context.accumulator.target;\n    } else if (this.context.inputs.length > 2) {\n      if (this.context.inputs.pop() === true) {\n        this.context.accumulator.end.rest = list.cons(\n          this.context.accumulator.source.at(1)\n        );\n        this.context.accumulator.end =\n          this.context.accumulator.end.rest;\n      }\n      this.context.accumulator.remaining -= 1;\n      this.context.accumulator.idx += 1;\n      this.context.accumulator.source =\n        this.context.accumulator.source.cdr();\n    }\n    if (this.context.accumulator.remaining === 0) {\n      this.context.accumulator.end.rest = new List();\n      this.returnValueToParentContext(\n        this.context.accumulator.target.cdr()\n      );\n      return;\n    }\n    index = this.context.accumulator.idx;\n    next = this.context.accumulator.source.at(1);\n  } else { // arrayed\n    if (this.context.accumulator === null) {\n      this.assertType(list, 'list');\n      this.context.accumulator = {\n        idx : 0,\n        target : []\n      };\n    } else if (this.context.inputs.length > 2) {\n      if (this.context.inputs.pop() === true) {\n        this.context.accumulator.target.push(\n          list.at(this.context.accumulator.idx)\n        );\n      }\n    }\n    if (this.context.accumulator.idx === list.length()) {\n      this.returnValueToParentContext(\n        new List(this.context.accumulator.target)\n      );\n      return;\n    }\n    this.context.accumulator.idx += 1;\n    index = this.context.accumulator.idx;\n    next = list.at(index);\n  }\n  this.pushContext();\n  parms = [next];\n  if (predicate.inputs.length > 1) {\n    parms.push(index);\n  }\n  if (predicate.inputs.length > 2) {\n    parms.push(list);\n  }\n  this.evaluate(predicate, new List(parms));\n};\n\nProcess.prototype.reportFindFirst = function (predicate, list) {\n  // Find - answer the first item of the list for which\n  // the predicate evaluates TRUE.\n  // Distinguish between linked and arrayed lists.\n  // if the predicate uses formal parameters instead of implicit empty slots\n  // there are two additional optional parameters:\n  // #1 - element\n  // #2 - optional | index\n  // #3 - optional | source list\n\n  var next, index, parms;\n  if (list.isLinked) {\n    if (this.context.accumulator === null) {\n      this.assertType(list, 'list');\n      this.context.accumulator = {\n        source : list,\n        idx : 1,\n        remaining : list.length()\n      };\n    } else if (this.context.inputs.length > 2) {\n      if (this.context.inputs.pop() === true) {\n        this.returnValueToParentContext(\n          this.context.accumulator.source.at(1)\n        );\n        return;\n      }\n      this.context.accumulator.remaining -= 1;\n      this.context.accumulator.idx += 1;\n      this.context.accumulator.source =\n        this.context.accumulator.source.cdr();\n    }\n    if (this.context.accumulator.remaining === 0) {\n      this.returnValueToParentContext('');\n      return;\n    }\n    index = this.context.accumulator.idx;\n    next = this.context.accumulator.source.at(1);\n  } else { // arrayed\n    if (this.context.accumulator === null) {\n      this.assertType(list, 'list');\n      this.context.accumulator = {\n        idx : 0,\n        current : null\n      };\n    } else if (this.context.inputs.length > 2) {\n      if (this.context.inputs.pop() === true) {\n        this.returnValueToParentContext(\n          this.context.accumulator.current\n        );\n        return;\n      }\n    }\n    if (this.context.accumulator.idx === list.length()) {\n      this.returnValueToParentContext('');\n      return;\n    }\n    this.context.accumulator.idx += 1;\n    index = this.context.accumulator.idx;\n    next = list.at(index);\n    this.context.accumulator.current = next;\n  }\n  this.pushContext();\n  parms = [next];\n  if (predicate.inputs.length > 1) {\n    parms.push(index);\n  }\n  if (predicate.inputs.length > 2) {\n    parms.push(list);\n  }\n  this.evaluate(predicate, new List(parms));\n};\n\nProcess.prototype.reportCombine = function (list, reporter) {\n  // Fold - answer an aggregation of all list items from \"left to right\"\n  // Distinguish between linked and arrayed lists.\n  // if the reporter uses formal parameters instead of implicit empty slots\n  // there are two additional optional parameters:\n  // #1 - accumulator\n  // #2 - element\n  // #3 - optional | index\n  // #4 - optional | source list\n\n  var next, current, index, parms;\n  this.assertType(list, 'list');\n  if (list.length() < 2) {\n    this.returnValueToParentContext(list.length() ? list.at(1) : 0);\n    return;\n  }\n  if (list.isLinked) {\n    if (this.context.accumulator === null) {\n      this.context.accumulator = {\n        source : list.cdr(),\n        idx : 1,\n        target : list.at(1),\n        remaining : list.length() - 1\n      };\n    } else if (this.context.inputs.length > 2) {\n      this.context.accumulator.target = this.context.inputs.pop();\n      this.context.accumulator.remaining -= 1;\n      this.context.accumulator.idx += 1;\n      this.context.accumulator.source =\n        this.context.accumulator.source.cdr();\n    }\n    if (this.context.accumulator.remaining === 0) {\n      this.returnValueToParentContext(this.context.accumulator.target);\n      return;\n    }\n    next = this.context.accumulator.source.at(1);\n  } else { // arrayed\n    if (this.context.accumulator === null) {\n      this.context.accumulator = {\n        idx : 1,\n        target : list.at(1)\n      };\n    } else if (this.context.inputs.length > 2) {\n      this.context.accumulator.target = this.context.inputs.pop();\n    }\n    if (this.context.accumulator.idx === list.length()) {\n      this.returnValueToParentContext(this.context.accumulator.target);\n      return;\n    }\n    this.context.accumulator.idx += 1;\n    next = list.at(this.context.accumulator.idx);\n  }\n  index = this.context.accumulator.idx;\n  current = this.context.accumulator.target;\n  this.pushContext();\n  parms = [current, next];\n  if (reporter.inputs.length > 2) {\n    parms.push(index);\n  }\n  if (reporter.inputs.length > 3) {\n    parms.push(list);\n  }\n  this.evaluate(reporter, new List(parms));\n};\n\n// Process interpolated primitives\n\nProcess.prototype.doWait = function (secs) {\n  if (!this.context.startTime) {\n    this.context.startTime = Date.now();\n  }\n  if ((Date.now() - this.context.startTime) >= (secs * 1000)) {\n    if (!this.isAtomic && (secs === 0)) {\n      // \"wait 0 secs\" is a plain \"yield\"\n      // that can be overridden by \"warp\"\n      this.readyToYield = true;\n    }\n    return null;\n  }\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\nProcess.prototype.doGlide = function (secs, endX, endY) {\n  if (!this.context.startTime) {\n    this.context.startTime = Date.now();\n    this.context.startValue = new Point(\n      this.blockReceiver().xPosition(),\n      this.blockReceiver().yPosition()\n    );\n  }\n  if ((Date.now() - this.context.startTime) >= (secs * 1000)) {\n    this.blockReceiver().gotoXY(endX, endY);\n    return null;\n  }\n  this.blockReceiver().glide(\n    secs * 1000,\n    endX,\n    endY,\n    Date.now() - this.context.startTime,\n    this.context.startValue\n  );\n\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\nProcess.prototype.doSayFor = function (data, secs) {\n  if (!this.context.startTime) {\n    this.context.startTime = Date.now();\n    this.blockReceiver().bubble(data);\n  }\n  if ((Date.now() - this.context.startTime) >= (secs * 1000)) {\n    this.blockReceiver().stopTalking();\n    return null;\n  }\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\nProcess.prototype.doThinkFor = function (data, secs) {\n  if (!this.context.startTime) {\n    this.context.startTime = Date.now();\n    this.blockReceiver().doThink(data);\n  }\n  if ((Date.now() - this.context.startTime) >= (secs * 1000)) {\n    this.blockReceiver().stopTalking();\n    return null;\n  }\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\nProcess.prototype.blockReceiver = function () {\n  return this.context ? this.context.receiver || this.homeContext.receiver\n    : this.homeContext.receiver || this.receiver;\n};\n\n// Process sound primitives (interpolated)\n\nProcess.prototype.playSound = function (name) {\n  if (name instanceof List) {\n    return this.doPlaySoundAtRate(name, 44100);\n  }\n  return this.blockReceiver().doPlaySound(name);\n};\n\nProcess.prototype.doPlaySoundUntilDone = function (name) {\n  if (this.context.activeAudio === null) {\n    this.context.activeAudio = this.playSound(name);\n  }\n  if (name === null || this.context.activeAudio.ended\n    || this.context.activeAudio.terminated) {\n    return null;\n  }\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\nProcess.prototype.doStopAllSounds = function () {\n  var stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n  if (stage) {\n    stage.threads.processes.forEach(thread => {\n      if (thread.context) {\n        thread.context.stopMusic();\n        if (thread.context.activeAudio) {\n          thread.popContext();\n        }\n      }\n    });\n    stage.stopAllActiveSounds();\n  }\n};\n\nProcess.prototype.doPlaySoundAtRate = function (name, rate) {\n  var sound, samples, ctx, gain, pan, source, rcvr;\n\n  if (!(name instanceof List)) {\n    sound = name instanceof Sound ? name\n      : (typeof name === 'number' ? this.blockReceiver().sounds.at(name)\n          : detect(\n            this.blockReceiver().sounds.asArray(),\n            s => s.name === name.toString()\n          )\n      );\n    if (!sound.audioBuffer) {\n      this.decodeSound(sound);\n      return;\n    }\n    samples = this.reportGetSoundAttribute('samples', sound);\n  } else {\n    samples = name;\n  }\n\n  rcvr = this.blockReceiver();\n  ctx = rcvr.audioContext();\n  gain = rcvr.getGainNode();\n  pan = rcvr.getPannerNode();\n  source = this.encodeSound(samples, rate);\n  rcvr.setVolume(rcvr.volume);\n  source.connect(gain);\n  if (pan) {\n    gain.connect(pan);\n    pan.connect(ctx.destination);\n    rcvr.setPan(rcvr.pan);\n  } else {\n    gain.connect(ctx.destination);\n  }\n  source.pause = source.stop;\n  source.ended = false;\n  source.onended = () => source.ended = true;\n  source.start();\n  rcvr.parentThatIsA(StageMorph).activeSounds.push(source);\n  return source;\n};\n\nProcess.prototype.reportGetSoundAttribute = function (choice, soundName) {\n  var sound = soundName instanceof Sound ? soundName\n    : (typeof soundName === 'number' ?\n        this.blockReceiver().sounds.at(soundName)\n        : (soundName instanceof List ? this.encodeSound(soundName)\n            : detect(\n              this.blockReceiver().sounds.asArray(),\n              s => s.name === soundName.toString()\n            )\n        )\n    ),\n    option = this.inputOption(choice);\n\n  if (option === 'name') {\n    return sound.name;\n  }\n\n  if (!sound.audioBuffer) {\n    this.decodeSound(sound);\n    return;\n  }\n\n  switch (option) {\n    case 'samples':\n      if (!sound.cachedSamples) {\n        sound.cachedSamples = function (sound, untype) {\n          var buf = sound.audioBuffer,\n            result, i;\n          if (buf.numberOfChannels > 1) {\n            result = new List();\n            for (i = 0; i < buf.numberOfChannels; i += 1) {\n              result.add(new List(untype(buf.getChannelData(i))));\n            }\n            return result;\n          }\n          return new List(untype(buf.getChannelData(0)));\n        } (sound, this.untype);\n      }\n      return sound.cachedSamples;\n    case 'sample rate':\n      return sound.audioBuffer.sampleRate;\n    case 'duration':\n      return sound.audioBuffer.duration;\n    case 'length':\n      return sound.audioBuffer.length;\n    case 'number of channels':\n      return sound.audioBuffer.numberOfChannels;\n    default:\n      return 0;\n  }\n};\n\nProcess.prototype.decodeSound = function (sound, callback) {\n  // private - callback is optional and invoked with sound as argument\n  var base64, binaryString, len, bytes, i, arrayBuffer, audioCtx;\n\n  if (sound.audioBuffer) {\n    return (callback || nop)(sound);\n  }\n  if (!sound.isDecoding) {\n    base64 = sound.audio.src.split(',')[1];\n    binaryString = window.atob(base64);\n    len = binaryString.length;\n    bytes = new Uint8Array(len);\n    for (i = 0; i < len; i += 1)        {\n      bytes[i] = binaryString.charCodeAt(i);\n    }\n    arrayBuffer = bytes.buffer;\n    audioCtx = Note.prototype.getAudioContext();\n    sound.isDecoding = true;\n    audioCtx.decodeAudioData(\n      arrayBuffer,\n      buffer => {\n        sound.audioBuffer = buffer;\n        sound.isDecoding = false;\n      },\n      err => {\n        sound.isDecoding = false;\n        this.handleError(err);\n      }\n    );\n  }\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\nProcess.prototype.encodeSound = function (samples, rate) {\n  // private\n  var rcvr = this.blockReceiver(),\n    ctx = rcvr.audioContext(),\n    channels = (samples.at(1) instanceof List) ? samples.length() : 1,\n    frameCount = (channels === 1) ?\n      samples.length()\n      : samples.at(1).length(),\n    arrayBuffer = ctx.createBuffer(channels, frameCount, +rate || 44100),\n    i,\n    source;\n\n  if (!arrayBuffer.copyToChannel) {\n    arrayBuffer.copyToChannel = function (src, channel) {\n      var buffer = this.getChannelData(channel);\n      for (i = 0; i < src.length; i += 1) {\n        buffer[i] = src[i];\n      }\n    };\n  }\n  if (channels === 1) {\n    arrayBuffer.copyToChannel(\n      Float32Array.from(samples.asArray()),\n      0,\n      0\n    );\n  } else {\n    for (i = 0; i < channels; i += 1) {\n      arrayBuffer.copyToChannel(\n        Float32Array.from(samples.at(i + 1).asArray()),\n        i,\n        0\n      );\n    }\n  }\n  source = ctx.createBufferSource();\n  source.buffer = arrayBuffer;\n  source.audioBuffer = source.buffer;\n  return source;\n};\n\n// Process first-class sound creation from samples, interpolated\n\nProcess.prototype.reportNewSoundFromSamples = function (samples, rate) {\n  // this method inspired by: https://github.com/Jam3/audiobuffer-to-wav\n  // https://www.russellgood.com/how-to-convert-audiobuffer-to-audio-file\n\n  var audio, blob, reader;\n\n  if (isNil(this.context.accumulator)) {\n    this.assertType(samples, 'list'); // check only the first time\n    this.context.accumulator = {\n      audio: null\n    };\n    audio = new Audio();\n    blob = new Blob(\n      [\n        this.audioBufferToWav(\n          this.encodeSound(samples, rate || 44100).audioBuffer\n        )\n      ],\n      {type: \"audio/wav\"}\n    );\n    reader = new FileReader();\n    reader.onload = () => {\n      audio.src = reader.result;\n      this.context.accumulator.audio = audio;\n    };\n    reader.readAsDataURL(blob);\n  }\n  if (this.context.accumulator.audio) {\n    return new Sound(\n      this.context.accumulator.audio,\n      this.blockReceiver().newSoundName(localize('sound'))\n    );\n  }\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\nProcess.prototype.audioBufferToWav = function (buffer, opt) {\n  var numChannels = buffer.numberOfChannels,\n    sampleRate = buffer.sampleRate,\n    format = (opt || {}).float32 ? 3 : 1,\n    bitDepth = format === 3 ? 32 : 16,\n    result;\n\n  function interleave(inputL, inputR) {\n    var length = inputL.length + inputR.length,\n      result = new Float32Array(length),\n      index = 0,\n      inputIndex = 0;\n\n    while (index < length) {\n      result[index++] = inputL[inputIndex];\n      result[index++] = inputR[inputIndex];\n      inputIndex += 1;\n    }\n    return result;\n  }\n\n  if (numChannels === 2) {\n    result = interleave(\n      buffer.getChannelData(0),\n      buffer.getChannelData(1)\n    );\n  } else {\n    result = buffer.getChannelData(0);\n  }\n  return this.encodeWAV(result, format, sampleRate, numChannels, bitDepth);\n};\n\nProcess.prototype.encodeWAV = function (\n  samples,\n  format,\n  sampleRate,\n  numChannels,\n  bitDepth\n) {\n  var bytesPerSample = bitDepth / 8,\n    blockAlign = numChannels * bytesPerSample,\n    buffer = new ArrayBuffer(44 + samples.length * bytesPerSample),\n    view = new DataView(buffer);\n\n  function writeFloat32(output, offset, input) {\n    for (var i = 0; i < input.length; i += 1, offset += 4) {\n      output.setFloat32(offset, input[i], true);\n    }\n  }\n\n  function floatTo16BitPCM(output, offset, input) {\n    var i, s;\n    for (i = 0; i < input.length; i += 1, offset += 2) {\n      s = Math.max(-1, Math.min(1, input[i]));\n      output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);\n    }\n  }\n\n  function writeString(view, offset, string) {\n    for (var i = 0; i < string.length; i += 1) {\n      view.setUint8(offset + i, string.charCodeAt(i));\n    }\n  }\n\n  writeString(view, 0, 'RIFF'); // RIFF identifier\n  // RIFF chunk length:\n  view.setUint32(4, 36 + samples.length * bytesPerSample, true);\n  writeString(view, 8, 'WAVE'); // RIFF type\n  writeString(view, 12, 'fmt '); // format chunk identifier\n  view.setUint32(16, 16, true); // format chunk length\n  view.setUint16(20, format, true); // sample format (raw)\n  view.setUint16(22, numChannels, true); // channel count\n  view.setUint32(24, sampleRate, true); // sample rate\n  // byte rate (sample rate * block align):\n  view.setUint32(28, sampleRate * blockAlign, true);\n  // block align (channel count * bytes per sample):\n  view.setUint16(32, blockAlign, true);\n  view.setUint16(34, bitDepth, true); // bits per sample\n  writeString(view, 36, 'data'); // data chunk identifier\n  // data chunk length:\n  view.setUint32(40, samples.length * bytesPerSample, true);\n  if (format === 1) { // Raw PCM\n    floatTo16BitPCM(view, 44, samples);\n  } else {\n    writeFloat32(view, 44, samples);\n  }\n  return buffer;\n};\n\n// Process audio input (interpolated)\n\nProcess.prototype.reportAudio = function (choice) {\n  var stage = this.blockReceiver().parentThatIsA(StageMorph),\n    selection = this.inputOption(choice);\n  if (selection === 'resolution') {\n    return stage.microphone.binSize();\n  }\n  if (selection === 'modifier') {\n    return stage.microphone.modifier;\n  }\n  if (stage.microphone.isOn()) {\n    switch (selection) {\n      case 'volume':\n        return stage.microphone.volume * 100;\n      case 'frequency':\n        return stage.microphone.pitch;\n      case 'note':\n        return stage.microphone.note;\n      case 'samples':\n        return new List(this.untype(stage.microphone.signals));\n      case 'sample rate':\n        return stage.microphone.audioContext.sampleRate;\n      case 'output':\n        return new List(this.untype(stage.microphone.output));\n      case 'spectrum':\n        return new List(this.untype(stage.microphone.frequencies));\n      default:\n        return null;\n    }\n  }\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\nProcess.prototype.untype = function (typedArray) {\n  var len = typedArray.length,\n    arr = new Array(len),\n    i;\n  for (i = 0; i < len; i += 1) {\n    arr[i] = typedArray[i];\n  }\n  return arr;\n};\n\nProcess.prototype.setMicrophoneModifier = function (modifier) {\n  var stage = this.blockReceiver().parentThatIsA(StageMorph),\n    invalid = [\n      'sprite',\n      'stage',\n      'list',\n      'costume',\n      'sound',\n      'number',\n      'text',\n      'Boolean'\n    ];\n  if (!modifier || contains(invalid, this.reportTypeOf(modifier))) {\n    stage.microphone.modifier = null;\n    stage.microphone.stop();\n    return;\n  }\n  stage.microphone.modifier = modifier;\n  stage.microphone.compiledModifier = this.reportCompiled(modifier, 1);\n  stage.microphone.compilerProcess = this;\n};\n\n// Process user prompting primitives (interpolated)\n\nProcess.prototype.doAsk = function (data) {\n  var stage = this.homeContext.receiver.parentThatIsA(StageMorph),\n    rcvr = this.blockReceiver(),\n    isStage = rcvr instanceof StageMorph,\n    isHiddenSprite = rcvr instanceof SpriteMorph && !rcvr.isVisible,\n    activePrompter;\n\n  stage.keysPressed = {};\n  if (!this.prompter) {\n    activePrompter = detect(\n      stage.children,\n      morph => morph instanceof StagePrompterMorph\n    );\n    if (!activePrompter) {\n      if (!isStage && !isHiddenSprite) {\n        rcvr.bubble(data, false, true);\n      }\n      this.prompter = new StagePrompterMorph(\n        isStage || isHiddenSprite ? data : null\n      );\n      if (stage.scale < 1) {\n        this.prompter.setWidth(stage.width() - 10);\n      } else {\n        this.prompter.setWidth(stage.dimensions.x - 20);\n      }\n      this.prompter.fixLayout();\n      this.prompter.setCenter(stage.center());\n      this.prompter.setBottom(stage.bottom() - this.prompter.border);\n      stage.add(this.prompter);\n      this.prompter.inputField.edit();\n      stage.changed();\n    }\n  } else {\n    if (this.prompter.isDone) {\n      stage.lastAnswer = this.prompter.inputField.getValue();\n      this.prompter.destroy();\n      this.prompter = null;\n      if (!isStage) {rcvr.stopTalking(); }\n      return null;\n    }\n  }\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\nProcess.prototype.reportLastAnswer = function () {\n  return this.homeContext.receiver.parentThatIsA(StageMorph).lastAnswer;\n};\n\n// Process URI retrieval (interpolated)\n\nProcess.prototype.reportURL = function (url) {\n  var response;\n  if (!this.httpRequest) {\n    // use the location protocol unless the user specifies otherwise\n    if (url.indexOf('//') < 0 || url.indexOf('//') > 8) {\n      if (location.protocol === 'file:') {\n        // allow requests from locally loaded sources\n        url = 'https://' + url;\n      } else {\n        url = location.protocol + '//' + url;\n      }\n    }\n    this.httpRequest = new XMLHttpRequest();\n    this.httpRequest.open(\"GET\", url, true);\n    // cache-control, commented out for now\n    // added for Snap4Arduino but has issues with local robot servers\n    // this.httpRequest.setRequestHeader('Cache-Control', 'max-age=0');\n    this.httpRequest.send(null);\n    if (this.context.isCustomCommand) {\n      // special case when ignoring the result, e.g. when\n      // communicating with a robot to control its motors\n      this.httpRequest = null;\n      return null;\n    }\n  } else if (this.httpRequest.readyState === 4) {\n    response = this.httpRequest.responseText;\n    this.httpRequest = null;\n    return response;\n  }\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\n// Process event messages primitives\n\nProcess.prototype.doBroadcast = function (message) {\n  // messages are user-defined events, and by default global, same as in\n  // Scratch. An experimental feature, messages can be sent to a single\n  // sprite or to a list of sprites by using a 2-item list in the message\n  // slot, where the first slot is a message text, and the second slot\n  // its recipient(s), identified either by a single name or sprite, or by\n  // a list of names or sprites (can be a heterogeneous list).\n\n  var stage = this.homeContext.receiver.parentThatIsA(StageMorph),\n    thisObj,\n    msg = this.inputOption(message),\n    trg,\n    rcvrs,\n    procs = [];\n\n  if (!this.canBroadcast) {\n    return [];\n  }\n  if (message instanceof List && (message.length() === 2)) {\n    thisObj = this.blockReceiver();\n    msg = message.at(1);\n    trg = message.at(2);\n    if (isSnapObject(trg)) {\n      rcvrs = [trg];\n    } else if (isString(trg)) {\n      // assume the string to be the name of a sprite or the stage\n      if (trg === stage.name) {\n        rcvrs = [stage];\n      } else {\n        rcvrs = [this.getOtherObject(trg, thisObj, stage)];\n      }\n    } else if (trg instanceof List) {\n      // assume all elements to be sprites or sprite names\n      rcvrs = trg.itemsArray().map(each =>\n        this.getOtherObject(each, thisObj, stage)\n      );\n    } else {\n      return; // abort\n    }\n  } else { // global\n    rcvrs = stage.children.concat(stage);\n  }\n  if (msg !== '') {\n    stage.lastMessage = message; // the actual data structure\n    rcvrs.forEach(morph => {\n      if (isSnapObject(morph)) {\n        morph.allHatBlocksFor(msg).forEach(block => {\n          procs.push(stage.threads.startProcess(\n            block,\n            morph,\n            stage.isThreadSafe\n          ));\n        });\n      }\n    });\n    (stage.messageCallbacks[''] || []).forEach(callback =>\n      callback(msg) // for \"any\" message, pass it along as argument\n    );\n    (stage.messageCallbacks[msg] || []).forEach(callback =>\n      callback() // for a particular message\n    );\n  }\n  return procs;\n};\n\nProcess.prototype.doBroadcastAndWait = function (message) {\n  if (!this.context.activeSends) {\n    this.context.activeSends = this.doBroadcast(message);\n    if (this.isRunning()) {\n      this.context.activeSends.forEach(proc =>\n        proc.runStep()\n      );\n    }\n  }\n  this.context.activeSends = this.context.activeSends.filter(proc =>\n    proc.isRunning()\n  );\n  if (this.context.activeSends.length === 0) {\n    return null;\n  }\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\nProcess.prototype.getLastMessage = function () {\n  var stage;\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      return stage.getLastMessage();\n    }\n  }\n  return '';\n};\n\nProcess.prototype.doSend = function (message, target) {\n  var stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n  this.doBroadcast(\n    new List(\n      [\n        message,\n        target instanceof List ? target :\n          target === stage.name ? new List([stage]) :\n            new List([target])\n      ]\n    )\n  );\n};\n\n// Process type inference\n\nProcess.prototype.reportIsA = function (thing, typeString) {\n  return this.reportTypeOf(thing) === this.inputOption(typeString);\n};\n\nProcess.prototype.assertType = function (thing, typeString) {\n  // make sure \"thing\" is a particular type or any of a number of types\n  // and raise an error if not\n  // use responsibly wrt performance implications\n  var thingType = this.reportTypeOf(thing);\n  if (thingType === typeString) {return true; }\n  if (typeString instanceof Array && contains(typeString, thingType)) {\n    return true;\n  }\n  throw new Error('expecting ' + typeString + ' but getting ' + thingType);\n};\n\nProcess.prototype.assertAlive = function (thing) {\n  if (thing && thing.isCorpse) {\n    throw new Error('cannot operate on a deleted sprite');\n  }\n};\n\nProcess.prototype.reportTypeOf = function (thing) {\n  // answer a string denoting the argument's type\n  var exp;\n  if (thing === null || (thing === undefined)) {\n    return 'nothing';\n  }\n  if (thing === true || (thing === false)) {\n    return 'Boolean';\n  }\n  if (thing instanceof List) {\n    return 'list';\n  }\n  if (parseFloat(thing) === +thing) { // I hate this! -Jens\n    return 'number';\n  }\n  if (isString(thing)) {\n    return 'text';\n  }\n  if (thing instanceof SpriteMorph) {\n    return 'sprite';\n  }\n  if (thing instanceof StageMorph) {\n    return 'stage';\n  }\n  if (thing instanceof Costume) {\n    return 'costume';\n  }\n  if (thing instanceof Sound) {\n    return 'sound';\n  }\n  if (thing instanceof Context) {\n    if (thing.expression instanceof RingMorph) {\n      return thing.expression.dataType();\n    }\n    if (thing.expression instanceof ReporterBlockMorph) {\n      if (thing.expression.isPredicate) {\n        return 'predicate';\n      }\n      return 'reporter';\n    }\n\n    if (thing.expression instanceof Array) {\n      exp = thing.expression[thing.pc || 0];\n      if (exp.isPredicate) {\n        return 'predicate';\n      }\n      if (exp instanceof RingMorph) {\n        return exp.dataType();\n      }\n      if (exp instanceof ReporterBlockMorph) {\n        return 'reporter';\n      }\n      if (exp instanceof CommandBlockMorph) {\n        return 'command';\n      }\n      return 'reporter'; // 'ring';\n    }\n\n    if (thing.expression instanceof CommandBlockMorph) {\n      return 'command';\n    }\n    return 'reporter'; // 'ring';\n  }\n  return 'undefined';\n};\n\n// Process math primtives - hyper-dyadic\n\nProcess.prototype.hyperDyadic = function (baseOp, a, b) {\n  // enable dyadic operations to be performed on lists and tables\n  var len, i, result;\n  if (this.enableHyperOps) {\n    if (this.isMatrix(a)) {\n      if (this.isMatrix(b)) {\n        // zip both arguments ignoring out-of-bounds indices\n        a = a.asArray();\n        b = b.asArray();\n        len = Math.min(a.length, b.length);\n        result = new Array(len);\n        for (i = 0; i < len; i += 1) {\n          result[i] = this.hyperDyadic(baseOp, a[i], b[i]);\n        }\n        return new List(result);\n      }\n      return a.map(each => this.hyperDyadic(baseOp, each, b));\n    }\n    if (this.isMatrix(b)) {\n      return b.map(each => this.hyperDyadic(baseOp, a, each));\n    }\n    return this.hyperZip(baseOp, a, b);\n  }\n  return baseOp(a, b);\n};\n\nProcess.prototype.hyperZip = function (baseOp, a, b) {\n  // enable dyadic operations to be performed on lists and tables\n  var len, i, result;\n  if (a instanceof List) {\n    if (b instanceof List) {\n      // zip both arguments ignoring out-of-bounds indices\n      a = a.asArray();\n      b = b.asArray();\n      len = Math.min(a.length, b.length);\n      result = new Array(len);\n      for (i = 0; i < len; i += 1) {\n        result[i] = this.hyperZip(baseOp, a[i], b[i]);\n      }\n      return new List(result);\n    }\n    return a.map(each => this.hyperZip(baseOp, each, b));\n  }\n  if (b instanceof List) {\n    return b.map(each => this.hyperZip(baseOp, a, each));\n  }\n  return baseOp(a, b);\n};\n\nProcess.prototype.isMatrix = function (data) {\n  return data instanceof List && data.at(1) instanceof List;\n};\n\nProcess.prototype.rank = function(data) {\n  var rank = 0,\n    cur = data;\n  while (cur instanceof List) {\n    rank += 1;\n    cur = cur.at(1);\n  }\n  return rank;\n};\n\n// Process math primtives - arithmetic\n\nProcess.prototype.reportSum = function (a, b) {\n  return this.hyperDyadic(this.reportBasicSum, a, b);\n};\n\nProcess.prototype.reportBasicSum = function (a, b) {\n  return +a + (+b);\n};\n\nProcess.prototype.reportDifference = function (a, b) {\n  return this.hyperDyadic(this.reportBasicDifference, a, b);\n};\n\nProcess.prototype.reportBasicDifference = function (a, b) {\n  return +a - +b;\n};\n\nProcess.prototype.reportProduct = function (a, b) {\n  return this.hyperDyadic(this.reportBasicProduct, a, b);\n};\n\nProcess.prototype.reportBasicProduct = function (a, b) {\n  return +a * +b;\n};\n\nProcess.prototype.reportQuotient = function (a, b) {\n  return this.hyperDyadic(this.reportBasicQuotient, a, b);\n};\n\nProcess.prototype.reportBasicQuotient = function (a, b) {\n  return +a / +b;\n};\n\nProcess.prototype.reportPower = function (a, b) {\n  return this.hyperDyadic(this.reportBasicPower, a, b);\n};\n\nProcess.prototype.reportBasicPower = function (a, b) {\n  return Math.pow(+a, +b);\n};\n\nProcess.prototype.reportModulus = function (a, b) {\n  return this.hyperDyadic(this.reportBasicModulus, a, b);\n};\n\nProcess.prototype.reportBasicModulus = function (a, b) {\n  var x = +a,\n    y = +b;\n  return ((x % y) + y) % y;\n};\n\nProcess.prototype.reportRandom = function (a, b) {\n  return this.hyperDyadic(this.reportBasicRandom, a, b);\n};\n\nProcess.prototype.reportBasicRandom = function (min, max) {\n  var floor = +min,\n    ceil = +max;\n  if ((floor % 1 !== 0) || (ceil % 1 !== 0)) {\n    return Math.random() * (ceil - floor) + floor;\n  }\n  return Math.floor(Math.random() * (ceil - floor + 1)) + floor;\n};\n\n// Process logic primitives - hyper-diadic / monadic where applicable\n\nProcess.prototype.reportLessThan = function (a, b) {\n  return this.hyperDyadic(this.reportBasicLessThan, a, b);\n};\n\nProcess.prototype.reportBasicLessThan = function (a, b) {\n  var x = +a,\n    y = +b;\n  if (isNaN(x) || isNaN(y)) {\n    x = a;\n    y = b;\n  }\n  return x < y;\n};\n\nProcess.prototype.reportNot = function (bool) {\n  if (this.enableHyperOps) {\n    if (bool instanceof List) {\n      return bool.map(each => this.reportNot(each));\n    }\n  }\n  // this.assertType(bool, 'Boolean');\n  return !bool;\n};\n\nProcess.prototype.reportGreaterThan = function (a, b) {\n  return this.hyperDyadic(this.reportBasicGreaterThan, a, b);\n};\n\nProcess.prototype.reportBasicGreaterThan = function (a, b) {\n  var x = +a,\n    y = +b;\n  if (isNaN(x) || isNaN(y)) {\n    x = a;\n    y = b;\n  }\n  return x > y;\n};\n\nProcess.prototype.reportEquals = function (a, b) {\n  return snapEquals(a, b);\n};\n\nProcess.prototype.reportIsIdentical = function (a, b) {\n  var tag = 'idTag';\n  if (this.isImmutable(a) || this.isImmutable(b)) {\n    return snapEquals(a, b);\n  }\n\n  function clear() {\n    if (Object.prototype.hasOwnProperty.call(a, tag)) {\n      delete a[tag];\n    }\n    if (Object.prototype.hasOwnProperty.call(b, tag)) {\n      delete b[tag];\n    }\n  }\n\n  clear();\n  a[tag] = Date.now();\n  if (b[tag] === a[tag]) {\n    clear();\n    return true;\n  }\n  clear();\n  return false;\n};\n\nProcess.prototype.isImmutable = function (obj) {\n  // private\n  var type = this.reportTypeOf(obj);\n  return type === 'nothing' ||\n    type === 'Boolean' ||\n    type === 'text' ||\n    type === 'number' ||\n    type === 'undefined';\n};\n\nProcess.prototype.reportBoolean = function (bool) {\n  return bool;\n};\n\n// Process hyper-monadic primitives\n\nProcess.prototype.reportRound = function (n) {\n  if (this.enableHyperOps) {\n    if (n instanceof List) {\n      return n.map(each => this.reportRound(each));\n    }\n  }\n  return Math.round(+n);\n};\n\nProcess.prototype.reportMonadic = function (fname, n) {\n  if (this.enableHyperOps) {\n    if (n instanceof List) {\n      return n.map(each => this.reportMonadic(fname, each));\n    }\n  }\n\n  var x = +n,\n    result = 0;\n\n  switch (this.inputOption(fname)) {\n    case 'abs':\n      result = Math.abs(x);\n      break;\n    // case '\\u2212': // minus-sign\n    case 'neg':\n      result = n * -1;\n      break;\n    case 'ceiling':\n      result = Math.ceil(x);\n      break;\n    case 'floor':\n      result = Math.floor(x);\n      break;\n    case 'sqrt':\n      result = Math.sqrt(x);\n      break;\n    case 'sin':\n      result = Math.sin(radians(x));\n      break;\n    case 'cos':\n      result = Math.cos(radians(x));\n      break;\n    case 'tan':\n      result = Math.tan(radians(x));\n      break;\n    case 'asin':\n      result = degrees(Math.asin(x));\n      break;\n    case 'acos':\n      result = degrees(Math.acos(x));\n      break;\n    case 'atan':\n      result = degrees(Math.atan(x));\n      break;\n    case 'ln':\n      result = Math.log(x);\n      break;\n    case 'log': // base 10\n      result =  Math.log10(x);\n      break;\n    case 'lg': // base 2\n      result =  Math.log2(x);\n      break;\n    case 'e^':\n      result = Math.exp(x);\n      break;\n    case '10^':\n      result = Math.pow(10, x);\n      break;\n    case '2^':\n      result = Math.pow(2, x);\n      break;\n    case 'id':\n      return n;\n    default:\n      nop();\n  }\n  return result;\n};\n\n// Process - non hyper-monadic text primitives\n\nProcess.prototype.reportTextFunction = function (fname, string) {\n  // currently in dev mode only, not hyper-monadic\n  var x = (isNil(string) ? '' : string).toString(),\n    result = '';\n\n  switch (this.inputOption(fname)) {\n    case 'encode URI':\n      result = encodeURI(x);\n      break;\n    case 'decode URI':\n      result = decodeURI(x);\n      break;\n    case 'encode URI component':\n      result = encodeURIComponent(x);\n      break;\n    case 'decode URI component':\n      result = decodeURIComponent(x);\n      break;\n    case 'XML escape':\n      result = new XML_Element().escape(x);\n      break;\n    case 'XML unescape':\n      result = new XML_Element().unescape(x);\n      break;\n    case 'hex sha512 hash':\n      result = hex_sha512(x);\n      break;\n    default:\n      nop();\n  }\n  return result;\n};\n\nProcess.prototype.reportJoin = function (a, b) {\n  var x = (isNil(a) ? '' : a).toString(),\n    y = (isNil(b) ? '' : b).toString();\n  return x.concat(y);\n};\n\nProcess.prototype.reportJoinWords = function (aList) {\n  if (aList instanceof List) {\n    return aList.asText();\n  }\n  return (aList || '').toString();\n};\n\n// Process string ops - hyper-monadic/dyadic\n\nProcess.prototype.reportLetter = function (idx, string) {\n  return this.hyperDyadic(\n    (ix, str) => this.reportBasicLetter(ix, str),\n    idx,\n    string\n  );\n};\n\nProcess.prototype.reportBasicLetter = function (idx, string) {\n  var str, i;\n\n  str = isNil(string) ? '' : string.toString();\n  if (this.inputOption(idx) === 'any') {\n    idx = this.reportBasicRandom(1, str.length);\n  }\n  if (this.inputOption(idx) === 'last') {\n    idx = str.length;\n  }\n  i = +(idx || 0);\n  return str[i - 1] || '';\n};\n\nProcess.prototype.reportStringSize = function (data) {\n  if (this.enableHyperOps) {\n    if (data instanceof List) {\n      return data.map(each => this.reportStringSize(each));\n    }\n  }\n  if (data instanceof List) { // catch a common user error\n    return data.length();\n  }\n  return isNil(data) ? 0 : data.toString().length;\n};\n\nProcess.prototype.reportUnicode = function (string) {\n  var str;\n\n  if (this.enableHyperOps) {\n    if (string instanceof List) {\n      return string.map(each => this.reportUnicode(each));\n    }\n    str = isNil(string) ? '\\u0000' : string.toString();\n    if (str.length > 1) {\n      return this.reportUnicode(new List(str.split('')));\n    }\n  } else {\n    str = isNil(string) ? '\\u0000' : string.toString();\n  }\n  if (str.codePointAt) { // support for Unicode in newer browsers.\n    return str.codePointAt(0) || 0;\n  }\n  return str.charCodeAt(0) || 0;\n};\n\nProcess.prototype.reportUnicodeAsLetter = function (num) {\n  if (this.enableHyperOps) {\n    if (num instanceof List) {\n      return num.map(each => this.reportUnicodeAsLetter(each));\n    }\n  }\n\n  var code = +(num || 0);\n\n  if (String.fromCodePoint) { // support for Unicode in newer browsers.\n    return String.fromCodePoint(code);\n  }\n  return String.fromCharCode(code);\n};\n\nProcess.prototype.reportTextSplit = function (string, delimiter) {\n  return this.hyperDyadic(\n    (str, delim) => this.reportBasicTextSplit(str, delim),\n    string,\n    delimiter\n  );\n};\n\nProcess.prototype.reportBasicTextSplit = function (string, delimiter) {\n  var types = ['text', 'number'],\n    strType = this.reportTypeOf(string),\n    delType = this.reportTypeOf(this.inputOption(delimiter)),\n    str,\n    del;\n  if (!contains(types, strType)) {\n    throw new Error('expecting text instead of a ' + strType);\n  }\n  if (!contains(types, delType)) {\n    throw new Error('expecting a text delimiter instead of a ' + delType);\n  }\n  str = isNil(string) ? '' : string.toString();\n  switch (this.inputOption(delimiter)) {\n    case 'line':\n      // Unicode compliant line splitting (platform independent)\n      // http://www.unicode.org/reports/tr18/#Line_Boundaries\n      del = /\\r\\n|[\\n\\v\\f\\r\\x85\\u2028\\u2029]/;\n      break;\n    case 'tab':\n      del = '\\t';\n      break;\n    case 'cr':\n      del = '\\r';\n      break;\n    case 'word':\n    case 'whitespace':\n      str = str.trim();\n      del = /\\s+/;\n      break;\n    case 'letter':\n      del = '';\n      break;\n    case 'csv':\n      return this.parseCSV(string);\n    case 'json':\n      return this.parseJSON(string);\n    /*\n    case 'csv records':\n        return this.parseCSVrecords(string);\n    case 'csv fields':\n        return this.parseCSVfields(string);\n    */\n    default:\n      del = isNil(delimiter) ? '' : delimiter.toString();\n  }\n  return new List(str.split(del));\n};\n\n// Process - parsing primitives\n\nProcess.prototype.parseCSV = function (text) {\n  // try to address the kludge that Excel sometimes uses commas\n  // and sometimes semi-colons as delimiters, try to find out\n  // which makes more sense by examining the first line\n  return this.rawParseCSV(text, this.guessDelimiterCSV(text));\n};\n\nProcess.prototype.guessDelimiterCSV = function (text) {\n  // assumes that the first line contains the column headers.\n  // report the first delimiter for which parsing the header\n  // yields more than a single field, otherwise default to comma\n  var delims = [',', ';', '|', '\\t'],\n    len = delims.length,\n    firstLine = text.split('\\n')[0],\n    i;\n  for (i = 0; i < len; i += 1) {\n    if (this.rawParseCSV(firstLine, delims[i]).length() > 1) {\n      return delims[i];\n    }\n  }\n  return delims[0];\n};\n\nProcess.prototype.rawParseCSV = function (text, delim) {\n  // RFC 4180\n  // parse a csv table into a two-dimensional list.\n  // if the table contains just a single row return it a one-dimensional\n  // list of fields instead (for backwards-compatibility)\n  var prev = '',\n    fields = [''],\n    records = [fields],\n    col = 0,\n    r = 0,\n    esc = true,\n    len = text.length,\n    idx,\n    char;\n  delim = delim || ',';\n  for (idx = 0; idx < len; idx += 1) {\n    char = text[idx];\n    if (char === '\\\"') {\n      if (esc && char === prev) {\n        fields[col] += char;\n      }\n      esc = !esc;\n    } else if (char === delim && esc) {\n      char = '';\n      col += 1;\n      fields[col] = char;\n    } else if (char === '\\r' && esc) {\n      r += 1;\n      records[r] = [''];\n      fields = records[r];\n      col = 0;\n    } else if (char === '\\n' && esc) {\n      if (prev !== '\\r') {\n        r += 1;\n        records[r] = [''];\n        fields = records[r];\n        col = 0;\n      }\n    } else {\n      fields[col] += char;\n    }\n    prev = char;\n  }\n\n  // remove the last record, if it is empty\n  if (records[records.length - 1].length === 1 &&\n    records[records.length - 1][0] === '')\n  {\n    records.pop();\n  }\n\n  // convert arrays to Snap! Lists\n  records = new List(\n    records.map(row => new List(row))\n  );\n\n  // for backwards compatibility return the first row if it is the only one\n  if (records.length() === 1) {\n    return records.at(1);\n  }\n  return records;\n};\n\nProcess.prototype.parseJSON = function (string) {\n  // Bernat's original Snapi contribution\n  function listify(jsonObject) {\n    if (jsonObject instanceof Array) {\n      return new List(\n        jsonObject.map(function(eachElement) {\n          return listify(eachElement);\n        })\n      );\n    } else if (jsonObject instanceof Object) {\n      return new List(\n        Object.keys(jsonObject).map(function(eachKey) {\n          return new List([\n            eachKey,\n            listify(jsonObject[eachKey])\n          ]);\n        })\n      );\n    } else {\n      return jsonObject;\n    }\n  }\n\n  return listify(JSON.parse(string));\n};\n\n// Process debugging\n\nProcess.prototype.alert = function (data) {\n  // debugging primitives only work in dev mode, otherwise they're nop\n  var world;\n  if (this.homeContext.receiver) {\n    world = this.homeContext.receiver.world();\n    if (world.isDevMode) {\n      alert('Snap! ' + data.asArray());\n    }\n  }\n};\n\nProcess.prototype.log = function (data) {\n  // debugging primitives only work in dev mode, otherwise they're nop\n  var world;\n  if (this.homeContext.receiver) {\n    world = this.homeContext.receiver.world();\n    if (world.isDevMode) {\n      console.log('Snap! ' + data.asArray());\n    }\n  }\n};\n\n// Process motion primitives\n\nProcess.prototype.getOtherObject = function (name, thisObj, stageObj) {\n  // private, find the sprite indicated by the given name\n  // either onstage or in the World's hand\n\n  // deal with first-class sprites\n  if (isSnapObject(name)) {\n    return name;\n  }\n\n  if (this.inputOption(name) === 'myself') {\n    return thisObj;\n  }\n  var stage = isNil(stageObj) ?\n    thisObj.parentThatIsA(StageMorph) : stageObj,\n    thatObj = null;\n  if (stage) {\n    // find the corresponding sprite on the stage\n    thatObj = detect(\n      stage.children,\n      morph => morph.name === name\n    );\n    if (!thatObj) {\n      // check if the sprite in question is currently being\n      // dragged around\n      thatObj = detect(\n        stage.world().hand.children,\n        morph => morph instanceof SpriteMorph &&\n          morph.name === name\n      );\n    }\n  }\n  return thatObj;\n};\n\nProcess.prototype.getObjectsNamed = function (name, thisObj, stageObj) {\n  // private, find all sprites and their clones indicated\n  // by the given name either onstage or in the World's hand\n\n  var stage = isNil(stageObj) ?\n    thisObj.parentThatIsA(StageMorph) : stageObj,\n    those = [];\n\n  function check(obj) {\n    return obj instanceof SpriteMorph && obj.isTemporary ?\n      obj.cloneOriginName === name : obj.name === name;\n  }\n\n  if (stage) {\n    // find the corresponding sprite on the stage\n    those = stage.children.filter(check);\n    if (!those.length) {\n      // check if a sprite in question is currently being\n      // dragged around\n      those = stage.world().hand.children.filter(check);\n    }\n  }\n  return those;\n};\n\nProcess.prototype.setHeading = function (direction) {\n  var thisObj = this.blockReceiver();\n\n  if (thisObj) {\n    if (this.inputOption(direction) === 'random') {\n      direction = this.reportBasicRandom(1, 36000) / 100;\n    }\n    thisObj.setHeading(direction);\n  }\n};\n\nProcess.prototype.setHeading = function (direction) {\n  var thisObj = this.blockReceiver();\n\n  if (thisObj) {\n    if (this.inputOption(direction) === 'random') {\n      direction = this.reportRandom(1, 36000) / 100;\n    }\n    thisObj.setHeading(direction);\n  }\n};\n\nProcess.prototype.doFaceTowards = function (name) {\n  var thisObj = this.blockReceiver(),\n    thatObj;\n\n  if (thisObj) {\n    if (this.inputOption(name) === 'center') {\n      thisObj.faceToXY(0, 0);\n    } else if (this.inputOption(name) === 'mouse-pointer') {\n      thisObj.faceToXY(this.reportMouseX(), this.reportMouseY());\n    } else if (this.inputOption(name) === 'random position') {\n      thisObj.setHeading(this.reportBasicRandom(1, 36000) / 100);\n    } else {\n      if (name instanceof List) {\n        thisObj.faceToXY(\n          name.at(1),\n          name.at(2)\n        );\n        return;\n      }\n      thatObj = this.getOtherObject(name, this.homeContext.receiver);\n      if (thatObj) {\n        thisObj.faceToXY(\n          thatObj.xPosition(),\n          thatObj.yPosition()\n        );\n      }\n    }\n  }\n};\n\nProcess.prototype.doGotoObject = function (name) {\n  var thisObj = this.blockReceiver(),\n    thatObj,\n    stage;\n\n  if (thisObj) {\n    if (this.inputOption(name) === 'center') {\n      thisObj.gotoXY(0, 0);\n    } else if (this.inputOption(name) === 'mouse-pointer') {\n      thisObj.gotoXY(this.reportMouseX(), this.reportMouseY());\n    } else if (this.inputOption(name) === 'random position') {\n      stage = thisObj.parentThatIsA(StageMorph);\n      if (stage) {\n        thisObj.setCenter(new Point(\n          this.reportBasicRandom(stage.left(), stage.right()),\n          this.reportBasicRandom(stage.top(), stage.bottom())\n        ));\n      }\n    } else {\n      if (name instanceof List) {\n        thisObj.gotoXY(\n          name.at(1),\n          name.at(2)\n        );\n        return;\n      }\n      thatObj = this.getOtherObject(name, this.homeContext.receiver);\n      if (thatObj) {\n        thisObj.gotoXY(\n          thatObj.xPosition(),\n          thatObj.yPosition()\n        );\n      }\n    }\n  }\n};\n\n// Process layering primitives\n\nProcess.prototype.goToLayer = function (name) {\n  var option = this.inputOption(name),\n    thisObj = this.blockReceiver();\n  if (thisObj instanceof SpriteMorph) {\n    if (option === 'front') {\n      thisObj.comeToFront();\n    } else if (option === 'back') {\n      thisObj.goToBack();\n    }\n  }\n};\n\n// Process color primitives\n\nProcess.prototype.setHSVA = function (name, num) {\n  var options = ['hue', 'saturation', 'brightness', 'transparency'];\n  this.blockReceiver().setColorComponentHSVA(\n    options.indexOf(this.inputOption(name)),\n    +num\n  );\n};\n\nProcess.prototype.changeHSVA = function (name, num) {\n  var options = ['hue', 'saturation', 'brightness', 'transparency'];\n  this.blockReceiver().changeColorComponentHSVA(\n    options.indexOf(this.inputOption(name)),\n    +num\n  );\n};\n\nProcess.prototype.setPenHSVA = Process.prototype.setHSVA;\nProcess.prototype.changePenHSVA = Process.prototype.changeHSVA;\nProcess.prototype.setBackgroundHSVA = Process.prototype.setHSVA;\nProcess.prototype.changeBackgroundHSVA = Process.prototype.changeHSVA;\n\n// Process cutting & pasting primitives\n\nProcess.prototype.doPasteOn = function (name) {\n  this.blitOn(name, 'source-atop');\n};\n\nProcess.prototype.doCutFrom = function (name) {\n  this.blitOn(name, 'destination-out');\n};\n\nProcess.prototype.blitOn = function (name, mask, thisObj, stage) {\n  // allow for lists of sprites and also check for temparary clones,\n  // as in Scratch 2.0,\n  var those;\n  thisObj = thisObj || this.blockReceiver();\n  stage = stage || thisObj.parentThatIsA(StageMorph);\n  if (stage.name === name) {\n    name = stage;\n  }\n  if (isSnapObject(name)) {\n    return thisObj.blitOn(name, mask);\n  }\n  if (name instanceof List) { // assume all elements to be sprites\n    those = name.itemsArray();\n  } else {\n    those = this.getObjectsNamed(name, thisObj, stage); // clones\n  }\n  those.forEach(each => {\n    // only draw on same-named clones that don't dynamically the costume\n    if (!each.inheritsAttribute('costume #')) {\n      this.blitOn(each, mask, thisObj, stage);\n    }\n  });\n};\n\n// Process temporary cloning (Scratch-style)\n\nProcess.prototype.createClone = function (name) {\n  var thisObj = this.blockReceiver(),\n    thatObj;\n\n  if (!name || this.readyToTerminate) {return; }\n  if (thisObj) {\n    if (this.inputOption(name) === 'myself') {\n      thisObj.createClone(!this.isFirstStep);\n    } else {\n      thatObj = this.getOtherObject(name, thisObj);\n      if (thatObj) {\n        thatObj.createClone(!this.isFirstStep);\n      }\n    }\n  }\n};\n\nProcess.prototype.newClone = function (name) {\n  var thisObj = this.blockReceiver(),\n    thatObj;\n\n  if (!name) {return; }\n  if (thisObj) {\n    if (this.inputOption(name) === 'myself') {\n      return thisObj.newClone(!this.isFirstStep);\n    }\n    thatObj = this.getOtherObject(name, thisObj);\n    if (thatObj) {\n      return thatObj.newClone(!this.isFirstStep);\n    }\n  }\n};\n\n// Process sensing primitives\n\nProcess.prototype.reportTouchingObject = function (name) {\n  var thisObj = this.blockReceiver();\n\n  if (thisObj) {\n    return this.objectTouchingObject(thisObj, name);\n  }\n  return false;\n};\n\nProcess.prototype.objectTouchingObject = function (thisObj, name) {\n  // helper function for reportTouchingObject()\n  // also check for temparary clones, as in Scratch 2.0,\n  // and for any parts (subsprites)\n  var those,\n    stage,\n    box,\n    mouse;\n\n  if (this.inputOption(name) === 'mouse-pointer') {\n    mouse = thisObj.world().hand.position();\n    if (thisObj.bounds.containsPoint(mouse) &&\n      !thisObj.isTransparentAt(mouse)) {\n      return true;\n    }\n  } else {\n    stage = thisObj.parentThatIsA(StageMorph);\n    if (stage) {\n      if (this.inputOption(name) === 'edge') {\n        box = thisObj.bounds;\n        if (!thisObj.costume && thisObj.penBounds) {\n          box = thisObj.penBounds.translateBy(thisObj.position());\n        }\n        if (!stage.bounds.containsRectangle(box)) {\n          return true;\n        }\n      }\n      if (this.inputOption(name) === 'pen trails' &&\n        thisObj.isTouching(stage.penTrailsMorph())) {\n        return true;\n      }\n      if (isSnapObject(name)) {\n        return name.isVisible && thisObj.isTouching(name);\n      }\n      if (name instanceof List) { // assume all elements to be sprites\n        those = name.itemsArray();\n      } else {\n        those = this.getObjectsNamed(name, thisObj, stage); // clones\n      }\n      if (those.some(any => any.isVisible && thisObj.isTouching(any)\n        // check collision with any part, performance issue\n        // commented out for now\n        /*\n                    return any.allParts().some(function (part) {\n                        return part.isVisible && thisObj.isTouching(part);\n                    })\n                */\n      )) {\n        return true;\n      }\n    }\n  }\n  return thisObj.parts.some(any =>\n    this.objectTouchingObject(any, name)\n  );\n};\n\nProcess.prototype.reportAspect = function (aspect, location) {\n  // sense colors and sprites anywhere,\n  // use sprites to read/write data encoded in colors.\n  //\n  // usage:\n  // ------\n  // left input selects color/saturation/brightness/transparency or \"sprites\".\n  // right input selects \"mouse-pointer\", \"myself\" or name of another sprite.\n  // you can also embed a a reporter with a reference to a sprite itself\n  // or a list of two items representing x- and y- coordinates.\n  //\n  // what you'll get:\n  // ----------------\n  // left input (aspect):\n  //\n  //      'hue'           - hsv HUE on a scale of 0 - 100\n  //      'saturation'    - hsv SATURATION on a scale of 0 - 100\n  //      'brightness'    - hsv VALUE on a scale of 0 - 100\n  //      'transparency'  - rgba ALPHA on a reversed (!) scale of 0 - 100\n  //      'r-g-b-a'       - list of rgba values on a scale of 0 - 255 each\n  //      'sprites'       - a list of sprites at the location, empty if none\n  //\n  // right input (location):\n  //\n  //      'mouse-pointer' - color/sprites at mouse-pointer anywhere in Snap\n  //      'myself'        - sprites at or color UNDERNEATH the rotation center\n  //      sprite-name     - sprites at or color UNDERNEATH sprites's rot-ctr.\n  //      two-item-list   - color/sprites at x-/y- coordinates on the Stage\n  //\n  // what does \"underneath\" mean?\n  // ----------------------------\n  // the not-fully-transparent color of the top-layered sprite at the given\n  // location excluding the receiver sprite's own layer and all layers above\n  // it gets reported.\n  //\n  // color-aspect \"underneath\" a sprite means that the sprite's layer is\n  // relevant for what gets reported. Sprites can only sense colors in layers\n  // below themselves, not their own color and not colors in sprites above\n  // their own layer.\n\n  var choice = this.inputOption(aspect),\n    target = this.inputOption(location),\n    options = ['hue', 'saturation', 'brightness', 'transparency'],\n    idx = options.indexOf(choice),\n    thisObj = this.blockReceiver(),\n    thatObj,\n    stage = thisObj.parentThatIsA(StageMorph),\n    world = thisObj.world(),\n    point,\n    clr;\n\n  if (target === 'myself') {\n    if (choice === 'sprites') {\n      if (thisObj instanceof StageMorph) {\n        point = thisObj.center();\n      } else {\n        point = thisObj.rotationCenter();\n      }\n      return this.spritesAtPoint(point, stage);\n    } else {\n      clr = this.colorAtSprite(thisObj);\n    }\n  } else if (target === 'mouse-pointer') {\n    if (choice === 'sprites') {\n      return this.spritesAtPoint(world.hand.position(), stage);\n    } else {\n      clr = world.getGlobalPixelColor(world.hand.position());\n    }\n  } else if (target instanceof List) {\n    point = new Point(\n      target.at(1) * stage.scale + stage.center().x,\n      stage.center().y - (target.at(2) * stage.scale)\n    );\n    if (choice === 'sprites') {\n      return this.spritesAtPoint(point, stage);\n    } else {\n      clr = world.getGlobalPixelColor(point);\n    }\n  } else {\n    if (!target) {return; }\n    thatObj = this.getOtherObject(target, thisObj, stage);\n    if (thatObj) {\n      if (choice === 'sprites') {\n        point = thatObj instanceof SpriteMorph ?\n          thatObj.rotationCenter() : thatObj.center();\n        return this.spritesAtPoint(point, stage);\n      } else {\n        clr = this.colorAtSprite(thatObj);\n      }\n    } else {\n      return;\n    }\n\n  }\n\n  if (choice === 'r-g-b-a') {\n    return new List([clr.r, clr.g, clr.b, Math.round(clr.a * 255)]);\n  }\n  if (idx < 0 || idx > 3) {\n    return;\n  }\n  if (idx === 3) {\n    return (1 - clr.a) * 100;\n  }\n  return clr.hsv()[idx] * 100;\n};\n\nProcess.prototype.colorAtSprite = function (sprite) {\n  // private - helper function for aspect of location\n  // answer the top-most color at the sprite's rotation center\n  // excluding the sprite itself\n  var point = sprite instanceof SpriteMorph ? sprite.rotationCenter()\n    : sprite.center(),\n    stage = sprite.parentThatIsA(StageMorph),\n    child,\n    i;\n\n  if (!stage) {return BLACK; }\n  for (i = stage.children.length; i > 0; i -= 1) {\n    child = stage.children[i - 1];\n    if ((child !== sprite) &&\n      child.isVisible &&\n      child.bounds.containsPoint(point) &&\n      !child.isTransparentAt(point)\n    ) {\n      return child.getPixelColor(point);\n    }\n  }\n  if (stage.bounds.containsPoint(point)) {\n    return stage.getPixelColor(point);\n  }\n  return BLACK;\n};\n\nProcess.prototype.colorBelowSprite = function (sprite) {\n  // private - helper function for aspect of location\n  // answer the color underneath the layer of the sprite's rotation center\n  // NOTE: layer-aware color sensing is currently unused\n  // in favor of top-layer detection because of user-observations\n  var point = sprite instanceof SpriteMorph ? sprite.rotationCenter()\n    : sprite.center(),\n    stage = sprite.parentThatIsA(StageMorph),\n    below = stage,\n    found = false,\n    child,\n    i;\n\n  if (!stage) {return BLACK; }\n  for (i = 0; i < stage.children.length; i += 1) {\n    if (!found) {\n      child = stage.children[i];\n      if (child === sprite) {\n        found = true;\n      } else if (child.isVisible &&\n        child.bounds.containsPoint(point) &&\n        !child.isTransparentAt(point)\n      ) {\n        below = child;\n      }\n    }\n  }\n  if (below.bounds.containsPoint(point)) {\n    return below.getPixelColor(point);\n  }\n  return BLACK;\n};\n\nProcess.prototype.spritesAtPoint = function (point, stage) {\n  // private - helper function for aspect of location\n  // point argument is an absolute (Morphic) point\n  // answer a list of sprites, if any, at the given point\n  // ordered by their layer, i.e. top-layer is last in the list\n  return new List(\n    stage.children.filter(morph =>\n      morph instanceof SpriteMorph &&\n      morph.isVisible &&\n      morph.bounds.containsPoint(point) &&\n      !morph.isTransparentAt(point)\n    )\n  );\n};\n\nProcess.prototype.reportAspect = function (aspect, location) {\n  // sense colors and sprites anywhere,\n  // use sprites to read/write data encoded in colors.\n  //\n  // usage:\n  // ------\n  // left input selects color/saturation/brightness/transparency or \"sprites\".\n  // right input selects \"mouse-pointer\", \"myself\" or name of another sprite.\n  // you can also embed a a reporter with a reference to a sprite itself\n  // or a list of two items representing x- and y- coordinates.\n  //\n  // what you'll get:\n  // ----------------\n  // left input (aspect):\n  //\n  //      'hue'           - hsv HUE on a scale of 0 - 100\n  //      'saturation'    - hsv SATURATION on a scale of 0 - 100\n  //      'brightness'    - hsv VALUE on a scale of 0 - 100\n  //      'transparency'  - rgba ALPHA on a reversed (!) scale of 0 - 100\n  //      'sprites'       - a list of sprites at the location, empty if none\n  //\n  // right input (location):\n  //\n  //      'mouse-pointer' - color/sprites at mouse-pointer anywhere in Snap\n  //      'myself'        - sprites at or color UNDERNEATH the rotation center\n  //      sprite-name     - sprites at or color UNDERNEATH sprites's rot-ctr.\n  //      two-item-list   - color/sprites at x-/y- coordinates on the Stage\n  //\n  // what does \"underneath\" mean?\n  // ----------------------------\n  // the not-fully-transparent color of the top-layered sprite at the given\n  // location excluding the receiver sprite's own layer and all layers above\n  // it gets reported.\n  //\n  // color-aspect \"underneath\" a sprite means that the sprite's layer is\n  // relevant for what gets reported. Sprites can only sense colors in layers\n  // below themselves, not their own color and not colors in sprites above\n  // their own layer.\n\n  var choice = this.inputOption(aspect),\n    target = this.inputOption(location),\n    options = ['hue', 'saturation', 'brightness', 'transparency'],\n    idx = options.indexOf(choice),\n    thisObj = this.blockReceiver(),\n    thatObj,\n    stage = thisObj.parentThatIsA(StageMorph),\n    world = thisObj.world(),\n    point,\n    clr;\n\n  if (target === 'myself') {\n    if (choice === 'sprites') {\n      if (thisObj instanceof StageMorph) {\n        point = thisObj.center();\n      } else {\n        point = thisObj.rotationCenter();\n      }\n      return this.spritesAtPoint(point, stage);\n    } else {\n      clr = this.colorAtSprite(thisObj);\n    }\n  } else if (target === 'mouse-pointer') {\n    if (choice === 'sprites') {\n      return this.spritesAtPoint(world.hand.position(), stage);\n    } else {\n      clr = world.getGlobalPixelColor(world.hand.position());\n    }\n  } else if (target instanceof List) {\n    point = new Point(\n      target.at(1) * stage.scale + stage.center().x,\n      stage.center().y - (target.at(2) * stage.scale)\n    );\n    if (choice === 'sprites') {\n      return this.spritesAtPoint(point, stage);\n    } else {\n      clr = world.getGlobalPixelColor(point);\n    }\n  } else {\n    if (!target) {return; }\n    thatObj = this.getOtherObject(target, thisObj, stage);\n    if (thatObj) {\n      if (choice === 'sprites') {\n        point = thatObj instanceof SpriteMorph ?\n          thatObj.rotationCenter() : thatObj.center();\n        return this.spritesAtPoint(point, stage);\n      } else {\n        clr = this.colorAtSprite(thatObj);\n      }\n    } else {\n      return;\n    }\n\n  }\n\n  if (idx < 0 || idx > 3) {\n    return;\n  }\n  if (idx === 3) {\n    return (1 - clr.a) * 100;\n  }\n  return clr.hsv()[idx] * 100;\n};\n\nProcess.prototype.colorAtSprite = function (sprite) {\n  // private - helper function for aspect of location\n  // answer the color underneath the layer of the sprite's rotation center\n  var point = sprite instanceof SpriteMorph ? sprite.rotationCenter()\n    : sprite.center(),\n    stage = sprite.parentThatIsA(StageMorph),\n    below = stage,\n    found = false,\n    child,\n    i;\n\n  if (!stage) {return new Color(); }\n  for (i = 0; i < stage.children.length; i += 1) {\n    if (!found) {\n      child = stage.children[i];\n      if (child === sprite) {\n        found = true;\n      } else if (child.isVisible &&\n        child.bounds.containsPoint(point) &&\n        !child.isTransparentAt(point)\n      ) {\n        below = child;\n      }\n    }\n  }\n  if (below.bounds.containsPoint(point)) {\n    return below.getPixelColor(point);\n  }\n  return new Color();\n};\n\nProcess.prototype.spritesAtPoint = function (point, stage) {\n  // private - helper function for aspect of location\n  // point argument is an absolute (Morphic) point\n  // answer a list of sprites, if any, at the given point\n  // ordered by their layer, i.e. top-layer is last in the list\n  return new List(\n    stage.children.filter(function (morph) {\n      return morph instanceof SpriteMorph &&\n        morph.isVisible &&\n        morph.bounds.containsPoint(point) &&\n        !morph.isTransparentAt(point);\n    })\n  );\n};\n\nProcess.prototype.reportRelationTo = function (relation, name) {\n  if (this.enableHyperOps) {\n    if (name instanceof List && !this.isCoordinate(name)) {\n      return name.map(each => this.reportRelationTo(relation, each));\n    }\n  }\n\n  var rel = this.inputOption(relation);\n  if (rel === 'distance') {\n    return this.reportDistanceTo(name);\n  }\n  if (rel === 'direction') {\n    return this.reportDirectionTo(name);\n  }\n  return 0;\n};\n\nProcess.prototype.isCoordinate = function (data) {\n  return data instanceof List &&\n    (data.length() === 2) &&\n    this.reportTypeOf(data.at(1)) === 'number' &&\n    this.reportTypeOf(data.at(2)) === 'number';\n};\n\nProcess.prototype.reportDistanceTo = function (name) {\n  var thisObj = this.blockReceiver(),\n    thatObj,\n    stage,\n    rc,\n    point;\n\n  if (thisObj) {\n    rc = thisObj.rotationCenter();\n    point = rc;\n    if (this.inputOption(name) === 'mouse-pointer') {\n      point = thisObj.world().hand.position();\n    } else if (this.inputOption(name) === 'center') {\n      return new Point(thisObj.xPosition(), thisObj.yPosition())\n        .distanceTo(ZERO);\n    } else if (name instanceof List) {\n      return new Point(thisObj.xPosition(), thisObj.yPosition())\n        .distanceTo(new Point(name.at(1), name.at(2)));\n    }\n    stage = thisObj.parentThatIsA(StageMorph);\n    thatObj = this.getOtherObject(name, thisObj, stage);\n    if (thatObj) {\n      point = thatObj.rotationCenter();\n    }\n    return rc.distanceTo(point) / stage.scale;\n  }\n  return 0;\n};\n\nProcess.prototype.reportDirectionTo = function (name) {\n  var thisObj = this.blockReceiver(),\n    thatObj;\n\n  if (thisObj) {\n    if (this.inputOption(name) === 'mouse-pointer') {\n      return thisObj.angleToXY(this.reportMouseX(), this.reportMouseY());\n    }\n    if (this.inputOption(name) === 'center') {\n      return thisObj.angleToXY(0, 0);\n    }\n    if (name instanceof List) {\n      return thisObj.angleToXY(\n        name.at(1),\n        name.at(2)\n      );\n    }\n    thatObj = this.getOtherObject(name, this.homeContext.receiver);\n    if (thatObj) {\n      return thisObj.angleToXY(\n        thatObj.xPosition(),\n        thatObj.yPosition()\n      );\n    }\n    return thisObj.direction();\n  }\n  return 0;\n};\n\nProcess.prototype.reportAttributeOf = function (attribute, name) {\n  var thisObj = this.blockReceiver(),\n    thatObj,\n    stage;\n\n  if (thisObj) {\n    this.assertAlive(thisObj);\n    stage = thisObj.parentThatIsA(StageMorph);\n    if (stage.name === name) {\n      thatObj = stage;\n    } else {\n      thatObj = this.getOtherObject(name, thisObj, stage);\n    }\n    if (thatObj) {\n      this.assertAlive(thatObj);\n      if (attribute instanceof BlockMorph) { // a \"wish\"\n        return this.reportContextFor(\n          this.reify(\n            thatObj.getMethod(attribute.semanticSpec)\n              .blockInstance(),\n            new List()\n          ),\n          thatObj\n        );\n      }\n      if (attribute instanceof Context) {\n        return this.reportContextFor(attribute, thatObj);\n      }\n      if (isString(attribute)) {\n        return thatObj.variables.getVar(attribute);\n      }\n      switch (this.inputOption(attribute)) {\n        case 'x position':\n          return thatObj.xPosition ? thatObj.xPosition() : '';\n        case 'y position':\n          return thatObj.yPosition ? thatObj.yPosition() : '';\n        case 'direction':\n          return thatObj.direction ? thatObj.direction() : '';\n        case 'costume #':\n          return thatObj.getCostumeIdx();\n        case 'costume name':\n          return thatObj.costume ? thatObj.costume.name\n            : thatObj instanceof SpriteMorph ? localize('Turtle')\n              : localize('Empty');\n        case 'size':\n          return thatObj.getScale ? thatObj.getScale() : '';\n        case 'volume':\n          return thatObj.getVolume();\n        case 'balance':\n          return thatObj.getPan();\n        case 'width':\n          if (thatObj instanceof StageMorph) {\n            return thatObj.dimensions.x;\n          }\n          this.assertType(thatObj, 'sprite');\n          return thatObj.width() / stage.scale;\n        case 'height':\n          if (thatObj instanceof StageMorph) {\n            return thatObj.dimensions.y;\n          }\n          this.assertType(thatObj, 'sprite');\n          return thatObj.height() / stage.scale;\n        case 'left':\n          return thatObj.xLeft();\n        case 'right':\n          return thatObj.xRight();\n        case 'top':\n          return thatObj.yTop();\n        case 'bottom':\n          return thatObj.yBottom();\n      }\n    }\n  }\n  return '';\n};\n\nProcess.prototype.reportGet = function (query) {\n  // answer a reference to a first-class member\n  // or a list of first-class members\n  var thisObj = this.blockReceiver(),\n    stage,\n    objName;\n\n  if (thisObj) {\n    switch (this.inputOption(query)) {\n      case 'self' :\n        return thisObj;\n      case 'other sprites':\n        stage = thisObj.parentThatIsA(StageMorph);\n        return new List(\n          stage.children.filter(each =>\n            each instanceof SpriteMorph &&\n            each !== thisObj\n          )\n        );\n      case 'parts': // shallow copy to disable side-effects\n        return new List((thisObj.parts || []).map(each => each));\n      case 'anchor':\n        return thisObj.anchor || '';\n      case 'parent':\n        return thisObj.exemplar || '';\n      case 'children':\n        return new List(thisObj.specimens ? thisObj.specimens() : []);\n      case 'temporary?':\n        return thisObj.isTemporary || false;\n      case 'clones':\n        stage = thisObj.parentThatIsA(StageMorph);\n        objName = thisObj.name || thisObj.cloneOriginName;\n        return new List(\n          stage.children.filter(each =>\n            each.isTemporary &&\n            (each !== thisObj) &&\n            (each.cloneOriginName === objName)\n          )\n        );\n      case 'other clones':\n        return thisObj.isTemporary ?\n          this.reportGet(['clones']) : new List();\n      case 'neighbors':\n        // old rectangular, bounding-box-based algorithm\n        // deprecated in favor of a circular perimeter based newer one\n        /*\n            stage = thisObj.parentThatIsA(StageMorph);\n            neighborhood = thisObj.bounds.expandBy(new Point(\n                thisObj.width(),\n                thisObj.height()\n            ));\n            return new List(\n                stage.children.filter(each =>\n                    each instanceof SpriteMorph &&\n                        each.isVisible &&\n                        (each !== thisObj) &&\n                        each.bounds.intersects(neighborhood)\n                )\n            );\n            */\n        return thisObj.neighbors();\n      case 'dangling?':\n        return !thisObj.rotatesWithAnchor;\n      case 'draggable?':\n        return thisObj.isDraggable;\n      case 'rotation style':\n        return thisObj.rotationStyle || 0;\n      case 'rotation x':\n        return thisObj.xPosition();\n      case 'rotation y':\n        return thisObj.yPosition();\n      case 'center x':\n        return thisObj.xCenter();\n      case 'center y':\n        return thisObj.yCenter();\n      case 'left':\n        return thisObj.xLeft();\n      case 'right':\n        return thisObj.xRight();\n      case 'top':\n        return thisObj.yTop();\n      case 'bottom':\n        return thisObj.yBottom();\n      case 'name':\n        return thisObj.name;\n      case 'stage':\n        return thisObj.parentThatIsA(StageMorph);\n      case 'costume':\n        return thisObj.costume;\n      case 'costumes':\n        return thisObj.reportCostumes();\n      case 'sounds':\n        return thisObj.sounds;\n      case 'width':\n        if (thisObj instanceof StageMorph) {\n          return thisObj.dimensions.x;\n        }\n        stage = thisObj.parentThatIsA(StageMorph);\n        return stage ? thisObj.width() / stage.scale : 0;\n      case 'height':\n        if (thisObj instanceof StageMorph) {\n          return thisObj.dimensions.y;\n        }\n        stage = thisObj.parentThatIsA(StageMorph);\n        return stage ? thisObj.height() / stage.scale : 0;\n    }\n  }\n  return '';\n};\n\nProcess.prototype.reportObject = function (name) {\n  var thisObj = this.blockReceiver(),\n    thatObj,\n    stage;\n\n  if (thisObj) {\n    this.assertAlive(thisObj);\n    stage = thisObj.parentThatIsA(StageMorph);\n    if (stage.name === name) {\n      thatObj = stage;\n    } else {\n      thatObj = this.getOtherObject(name, thisObj, stage);\n    }\n    if (thatObj) {\n      this.assertAlive(thatObj);\n    }\n    return thatObj;\n  }\n};\n\nProcess.prototype.doSet = function (attribute, value) {\n  // experimental, manipulate sprites' attributes\n  var name, rcvr, ide;\n  rcvr = this.blockReceiver();\n  this.assertAlive(rcvr);\n  if (!(attribute instanceof Context || attribute instanceof Array) ||\n    (attribute instanceof Context &&\n      attribute.expression.selector !== 'reportGet')) {\n    throw new Error(localize('unsupported attribute'));\n  }\n  name = attribute instanceof Context ?\n    attribute.expression.inputs()[0].evaluate()\n    : attribute;\n  if (name instanceof Array) {\n    name = name[0];\n  }\n  switch (name) {\n    case 'anchor':\n    case 'my anchor':\n      this.assertType(rcvr, 'sprite');\n      if (value instanceof SpriteMorph) {\n        // avoid circularity here, because the GUI already checks for\n        // conflicts while the user drags parts over prospective targets\n        if (!rcvr.enableNesting || contains(rcvr.allParts(), value)) {\n          throw new Error(\n            localize('unable to nest\\n(disabled or circular?)')\n          );\n        }\n        value.attachPart(rcvr);\n      } else {\n        rcvr.detachFromAnchor();\n      }\n      break;\n    case 'parent':\n    case 'my parent':\n      this.assertType(rcvr, 'sprite');\n      value = value instanceof SpriteMorph ? value : null;\n      rcvr.setExemplar(value, true); // throw an error in case of circularity\n      break;\n    case 'temporary?':\n    case 'my temporary?':\n      this.assertType(rcvr, 'sprite');\n      this.assertType(value, 'Boolean');\n      if (value) {\n        rcvr.release();\n      } else {\n        rcvr.perpetuate();\n      }\n      break;\n    case 'name':\n    case 'my name':\n      this.assertType(rcvr, ['sprite', 'stage']);\n      this.assertType(value, ['text', 'number']);\n      ide = rcvr.parentThatIsA(IDE_Morph);\n      if (ide) {\n        rcvr.setName(\n          ide.newSpriteName(value.toString(), rcvr)\n        );\n        ide.spriteBar.nameField.setContents(\n          ide.currentSprite.name.toString()\n        );\n      }\n      break;\n    case 'dangling?':\n    case 'my dangling?':\n      this.assertType(rcvr, 'sprite');\n      this.assertType(value, 'Boolean');\n      rcvr.rotatesWithAnchor = !value;\n      rcvr.version = Date.now();\n      break;\n    case 'draggable?':\n    case 'my draggable?':\n      this.assertType(rcvr, 'sprite');\n      this.assertType(value, 'Boolean');\n      rcvr.isDraggable = value;\n      // update padlock symbol in the IDE:\n      ide = rcvr.parentThatIsA(IDE_Morph);\n      if (ide) {\n        ide.spriteBar.children.forEach(each => {\n          if (each.refresh) {\n            each.refresh();\n          }\n        });\n      }\n      rcvr.version = Date.now();\n      break;\n    case 'rotation style':\n    case 'my rotation style':\n      this.assertType(rcvr, 'sprite');\n      this.assertType(+value, 'number');\n      if (!contains([0, 1, 2], +value)) {\n        return; // maybe throw an error msg\n      }\n      rcvr.changed();\n      rcvr.rotationStyle = +value;\n      rcvr.fixLayout();\n      rcvr.rerender();\n      // update padlock symbol in the IDE:\n      ide = rcvr.parentThatIsA(IDE_Morph);\n      if (ide) {\n        ide.spriteBar.children.forEach(each => {\n          if (each.refresh) {\n            each.refresh();\n          }\n        });\n      }\n      rcvr.version = Date.now();\n      break;\n    case 'rotation x':\n    case 'my rotation x':\n      this.assertType(rcvr, 'sprite');\n      this.assertType(value, 'number');\n      rcvr.setRotationX(value);\n      break;\n    case 'rotation y':\n    case 'my rotation y':\n      this.assertType(rcvr, 'sprite');\n      this.assertType(value, 'number');\n      rcvr.setRotationY(value);\n      break;\n    case 'microphone modifier':\n      this.setMicrophoneModifier(value);\n      break;\n    default:\n      throw new Error(\n        '\"' + localize(name) + '\" ' + localize('is read-only')\n      );\n  }\n};\n\nProcess.prototype.reportContextFor = function (context, otherObj) {\n  // Private - return a copy of the context\n  // and bind it to another receiver\n  var result = copy(context),\n    receiverVars,\n    rootVars;\n\n  result.receiver = otherObj;\n  if (result.outerContext) {\n    result.outerContext = copy(result.outerContext);\n    result.outerContext.variables = copy(result.outerContext.variables);\n    result.outerContext.receiver = otherObj;\n    if (result.outerContext.variables.parentFrame) {\n      rootVars = result.outerContext.variables.parentFrame;\n      receiverVars = copy(otherObj.variables);\n      receiverVars.parentFrame = rootVars;\n      result.outerContext.variables.parentFrame = receiverVars;\n    } else {\n      result.outerContext.variables.parentFrame = otherObj.variables;\n    }\n  }\n  return result;\n};\n\nProcess.prototype.reportMouseX = function () {\n  var stage, world;\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      world = stage.world();\n      if (world) {\n        return (world.hand.position().x - stage.center().x)\n          / stage.scale;\n      }\n    }\n  }\n  return 0;\n};\n\nProcess.prototype.reportMouseY = function () {\n  var stage, world;\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      world = stage.world();\n      if (world) {\n        return (stage.center().y - world.hand.position().y)\n          / stage.scale;\n      }\n    }\n  }\n  return 0;\n};\n\nProcess.prototype.reportMouseDown = function () {\n  var world;\n  if (this.homeContext.receiver) {\n    world = this.homeContext.receiver.world();\n    if (world) {\n      return world.hand.mouseButton === 'left';\n    }\n  }\n  return false;\n};\n\nProcess.prototype.reportKeyPressed = function (keyString) {\n  var stage;\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      if (this.inputOption(keyString) === 'any key') {\n        return Object.keys(stage.keysPressed).length > 0;\n      }\n      return stage.keysPressed[keyString] !== undefined;\n    }\n  }\n  return false;\n};\n\nProcess.prototype.doResetTimer = function () {\n  var stage;\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      stage.resetTimer();\n    }\n  }\n};\n\nProcess.prototype.reportTimer = function () {\n  var stage;\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      return stage.getTimer();\n    }\n  }\n  return 0;\n};\n\n// Process Dates and times in Snap\nProcess.prototype.reportDate = function (datefn) {\n  var currDate, func, result,\n    inputFn = this.inputOption(datefn),\n    // Map block options to built-in functions\n    dateMap = {\n      'year' : 'getFullYear',\n      'month' : 'getMonth',\n      'date': 'getDate',\n      'day of week' : 'getDay',\n      'hour' : 'getHours',\n      'minute' : 'getMinutes',\n      'second' : 'getSeconds',\n      'time in milliseconds' : 'getTime'\n    };\n\n  if (!dateMap[inputFn]) { return ''; }\n  currDate = new Date();\n  func = dateMap[inputFn];\n  result = currDate[func]();\n\n  // Show months as 1-12 and days as 1-7\n  if (inputFn === 'month' || inputFn === 'day of week') {\n    result += 1;\n  }\n  return result;\n};\n\n// Process video motion detection primitives\n\nProcess.prototype.doSetVideoTransparency = function(factor) {\n  var stage;\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      stage.projectionTransparency = Math.max(0, Math.min(100, factor));\n    }\n  }\n};\n\nProcess.prototype.reportVideo = function(attribute, name) {\n  var thisObj = this.blockReceiver(),\n    stage = thisObj.parentThatIsA(StageMorph),\n    thatObj = this.getOtherObject(name, thisObj, stage);\n\n  if (!stage.projectionSource || !stage.projectionSource.stream) {\n    // wait until video is turned on\n    if (!this.context.accumulator) {\n      this.context.accumulator = true; // started video\n      stage.startVideo();\n    }\n    this.pushContext('doYield');\n    this.pushContext();\n    return;\n  }\n\n  switch (this.inputOption(attribute)) {\n    case 'motion':\n      if (thatObj instanceof SpriteMorph) {\n        stage.videoMotion.getLocalMotion(thatObj);\n        return thatObj.motionAmount;\n      }\n      stage.videoMotion.getStageMotion();\n      return stage.videoMotion.motionAmount;\n    case 'direction':\n      if (thatObj instanceof SpriteMorph) {\n        stage.videoMotion.getLocalMotion(thatObj);\n        return thatObj.motionDirection;\n      }\n      stage.videoMotion.getStageMotion();\n      return stage.videoMotion.motionDirection;\n    case 'snap':\n      if (thatObj instanceof SpriteMorph) {\n        return thatObj.projectionSnap();\n      }\n      return stage.projectionSnap();\n  }\n  return -1;\n};\n\nProcess.prototype.startVideo = function(stage) {\n  // interpolated\n  if (this.reportGlobalFlag('video capture')) {return; }\n  if (!stage.projectionSource || !stage.projectionSource.stream) {\n    // wait until video is turned on\n    if (!this.context.accumulator) {\n      this.context.accumulator = true; // started video\n      stage.startVideo();\n    }\n  }\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\n// Process code mapping\n\n/*\n    for generating textual source code using\n    blocks - not needed to run or debug Snap\n*/\n\nProcess.prototype.doMapCodeOrHeader = function (aContext, anOption, aString) {\n  if (this.inputOption(anOption) === 'code') {\n    return this.doMapCode(aContext, aString);\n  }\n  if (this.inputOption(anOption) === 'header') {\n    return this.doMapHeader(aContext, aString);\n  }\n  throw new Error(\n    ' \\'' + anOption + '\\'\\nis not a valid option'\n  );\n};\n\nProcess.prototype.doMapHeader = function (aContext, aString) {\n  if (aContext instanceof Context) {\n    if (aContext.expression instanceof SyntaxElementMorph) {\n      return aContext.expression.mapHeader(aString || '');\n    }\n  }\n};\n\nProcess.prototype.doMapCode = function (aContext, aString) {\n  if (aContext instanceof Context) {\n    if (aContext.expression instanceof SyntaxElementMorph) {\n      return aContext.expression.mapCode(aString || '');\n    }\n  }\n};\n\nProcess.prototype.doMapValueCode = function (type, aString) {\n  var tp = this.inputOption(type);\n  switch (tp) {\n    case 'String':\n      StageMorph.prototype.codeMappings.string = aString || '<#1>';\n      break;\n    case 'Number':\n      StageMorph.prototype.codeMappings.number = aString || '<#1>';\n      break;\n    case 'true':\n      StageMorph.prototype.codeMappings.boolTrue = aString || 'true';\n      break;\n    case 'false':\n      StageMorph.prototype.codeMappings.boolFalse = aString || 'true';\n      break;\n    default:\n      throw new Error(\n        localize('unsupported data type') + ' ' + tp\n      );\n  }\n\n};\n\nProcess.prototype.doMapListCode = function (part, kind, aString) {\n  var key1 = '',\n    key2 = 'delim';\n\n  if (this.inputOption(kind) === 'parameters') {\n    key1 = 'parms_';\n  } else if (this.inputOption(kind) === 'variables') {\n    key1 = 'tempvars_';\n  }\n\n  if (this.inputOption(part) === 'list') {\n    key2 = 'list';\n  } else if (this.inputOption(part) === 'item') {\n    key2 = 'item';\n  }\n\n  StageMorph.prototype.codeMappings[key1 + key2] = aString || '';\n};\n\nProcess.prototype.reportMappedCode = function (aContext) {\n  if (aContext instanceof Context) {\n    if (aContext.expression instanceof SyntaxElementMorph) {\n      return aContext.expression.mappedCode();\n    }\n  }\n  return '';\n};\n\n// Process music primitives\n\nProcess.prototype.doRest = function (beats) {\n  var tempo = this.reportTempo();\n  this.doWait(60 / tempo * beats);\n};\n\nProcess.prototype.reportTempo = function () {\n  var stage;\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      return stage.getTempo();\n    }\n  }\n  return 0;\n};\n\nProcess.prototype.doChangeTempo = function (delta) {\n  var stage;\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      stage.changeTempo(delta);\n    }\n  }\n};\n\nProcess.prototype.doSetTempo = function (bpm) {\n  var stage;\n  if (this.homeContext.receiver) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (stage) {\n      stage.setTempo(bpm);\n    }\n  }\n};\n\nProcess.prototype.doPlayNote = function (pitch, beats) {\n  var tempo = this.reportTempo();\n  this.doPlayNoteForSecs(\n    parseFloat(pitch || '0'),\n    60 / tempo * parseFloat(beats || '0')\n  );\n};\n\nProcess.prototype.doPlayNoteForSecs = function (pitch, secs) {\n  // interpolated\n  var rcvr = this.blockReceiver();\n  if (!this.context.startTime) {\n    rcvr.setVolume(rcvr.getVolume()); // b/c Chrome needs lazy init\n    rcvr.setPan(rcvr.getPan()); // b/c Chrome needs lazy initialization\n    this.context.startTime = Date.now();\n    this.context.activeNote = new Note(pitch);\n    this.context.activeNote.play(\n      this.instrument,\n      rcvr.getGainNode(),\n      rcvr.getPannerNode()\n    );\n  }\n  if ((Date.now() - this.context.startTime) >= (secs * 1000)) {\n    if (this.context.activeNote) {\n      this.context.activeNote.stop();\n      this.context.activeNote = null;\n    }\n    return null;\n  }\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\nProcess.prototype.doPlayFrequency = function (hz, secs) {\n  this.doPlayFrequencyForSecs(\n    parseFloat(hz || '0'),\n    parseFloat(secs || '0')\n  );\n};\n\nProcess.prototype.doPlayFrequencyForSecs = function (hz, secs) {\n  // interpolated\n  if (!this.context.startTime) {\n    this.context.startTime = Date.now();\n    this.context.activeNote = new Note();\n    this.context.activeNote.frequency = hz;\n    this.context.activeNote.play(this.instrument);\n  }\n  if ((Date.now() - this.context.startTime) >= (secs * 1000)) {\n    if (this.context.activeNote) {\n      this.context.activeNote.stop();\n      this.context.activeNote = null;\n    }\n    return null;\n  }\n  this.pushContext('doYield');\n  this.pushContext();\n};\n\nProcess.prototype.doSetInstrument = function (num) {\n  this.instrument = +num;\n  this.receiver.instrument = +num;\n  if (this.receiver.freqPlayer) {\n    this.receiver.freqPlayer.setInstrument(+num);\n  }\n};\n\n// Process image processing primitives\n\nProcess.prototype.reportGetImageAttribute = function (choice, name) {\n  var cst = this.costumeNamed(name) || new Costume(),\n    option = this.inputOption(choice);\n\n  switch (option) {\n    case 'name':\n      return cst.name;\n    case 'width':\n      return cst.width();\n    case 'height':\n      return cst.height();\n    case 'pixels':\n      return cst.rasterized().pixels();\n    default:\n      return cst;\n  }\n};\n\nProcess.prototype.reportNewCostumeStretched = function (name, xP, yP) {\n  var cst;\n  if (name instanceof List) {\n    return this.reportNewCostume(name, xP, yP);\n  }\n  cst = this.costumeNamed(name);\n  if (!cst) {\n    return new Costume();\n  }\n  if (!isFinite(+xP * +yP) || isNaN(+xP * +yP)) {\n    throw new Error(\n      'expecting a finite number\\nbut getting Infinity or NaN'\n    );\n  }\n  return cst.stretched(\n    Math.round(cst.width() * +xP / 100),\n    Math.round(cst.height() * +yP / 100)\n  );\n};\n\nProcess.prototype.costumeNamed = function (name) {\n  // private\n  if (name instanceof Costume) {\n    return name;\n  }\n  if (typeof name === 'number') {\n    return this.blockReceiver().costumes.at(name);\n  }\n  if (this.inputOption(name) === 'current') {\n    return this.blockReceiver().costume;\n  }\n  return detect(\n    this.blockReceiver().costumes.asArray(),\n    c => c.name === name.toString()\n  );\n};\n\nProcess.prototype.reportNewCostume = function (pixels, width, height, name) {\n  var rcvr, stage, canvas, ctx, src, dta, i, k, px;\n\n  this.assertType(pixels, 'list');\n  if (this.inputOption(width) === 'current') {\n    rcvr = this.blockReceiver();\n    stage = rcvr.parentThatIsA(StageMorph);\n    width = rcvr.costume ? rcvr.costume.width() : stage.dimensions.x;\n  }\n  if (this.inputOption(height) === 'current') {\n    rcvr = rcvr || this.blockReceiver();\n    stage = stage || rcvr.parentThatIsA(StageMorph);\n    height = rcvr.costume ? rcvr.costume.height() : stage.dimensions.y;\n  }\n  width = Math.abs(Math.floor(+width));\n  height = Math.abs(Math.floor(+height));\n  if (width <= 0 || height <= 0) {\n    return new Costume();\n  }\n  if (!isFinite(width * height) || isNaN(width * height)) {\n    throw new Error(\n      'expecting a finite number\\nbut getting Infinity or NaN'\n    );\n  }\n\n  canvas = newCanvas(new Point(width, height), true);\n  ctx = canvas.getContext('2d');\n  src = pixels.asArray();\n  dta = ctx.createImageData(width, height);\n  for (i = 0; i < src.length; i += 1) {\n    px = src[i].asArray();\n    for (k = 0; k < 3; k += 1) {\n      dta.data[(i * 4) + k] = px[k];\n    }\n    dta.data[i * 4 + 3] = (px[3] === undefined ? 255 : px[3]);\n  }\n  ctx.putImageData(dta, 0, 0);\n  return new Costume(\n    canvas,\n    name || (rcvr || this.blockReceiver()).newCostumeName(\n    localize('costume')\n    )\n  );\n};\n\nProcess.prototype.reportPentrailsAsSVG = function () {\n  // interpolated\n  var rcvr, stage, svg, acc, offset;\n\n  if (!this.context.accumulator) {\n    stage = this.homeContext.receiver.parentThatIsA(StageMorph);\n    if (!stage.trailsLog.length) {\n      throw new Error (localize(\n        'there are currently no\\nvectorizable pen trail segments'\n      ));\n    }\n    svg = stage.trailsLogAsSVG();\n    this.context.accumulator = {\n      img : new Image(),\n      rot : svg.rot,\n      ready : false\n    };\n    acc = this.context.accumulator;\n    acc.img.onload = () => acc.ready = true;\n    acc.img.src = 'data:image/svg+xml,' + svg.src;\n    acc.img.rot = svg.rotationShift;\n  } else if (this.context.accumulator.ready) {\n    offset = ZERO;\n    rcvr = this.blockReceiver();\n    if (rcvr instanceof SpriteMorph) {\n      offset = new Point(rcvr.xPosition(), -rcvr.yPosition());\n    }\n    this.returnValueToParentContext(\n      new SVG_Costume(\n        this.context.accumulator.img,\n        this.blockReceiver().newCostumeName(localize('Costume')),\n        this.context.accumulator.rot.translateBy(offset)\n      )\n    );\n    return;\n  }\n  this.pushContext();\n};\n\n// Process constant input options\n\nProcess.prototype.inputOption = function (dta) {\n  // private - for localization\n  return dta instanceof Array ? dta[0] : dta;\n};\n\n// Process stack\n\nProcess.prototype.pushContext = function (expression, outerContext) {\n  this.context = new Context(\n    this.context,\n    expression,\n    outerContext || (this.context ? this.context.outerContext : null),\n    // for tail call elimination\n    this.context ? // check needed due to tail call elimination\n      this.context.receiver : this.homeContext.receiver\n  );\n};\n\nProcess.prototype.popContext = function () {\n  if (this.context) {\n    this.context.stopMusic();\n  }\n  this.context = this.context ? this.context.parentContext : null;\n};\n\nProcess.prototype.returnValueToParentContext = function (value) {\n  // if no parent context exists treat value as result\n  if (value !== undefined) {\n    var target = this.context ? // in case of tail call elimination\n      this.context.parentContext || this.homeContext\n      : this.homeContext;\n    target.addInput(value);\n  }\n};\n\nProcess.prototype.reportStackSize = function () {\n  return this.context ? this.context.stackSize() : 0;\n};\n\nProcess.prototype.reportFrameCount = function () {\n  return this.frameCount;\n};\n\n// Process single-stepping\n\nProcess.prototype.flashContext = function () {\n  var expr = this.context.expression;\n  if (this.enableSingleStepping &&\n    !this.isAtomic &&\n    expr instanceof SyntaxElementMorph &&\n    !(expr instanceof CommandSlotMorph) &&\n    !this.context.isFlashing &&\n    expr.world() &&\n    !(expr instanceof ColorSlotMorph)) {\n    this.unflash();\n    expr.flash();\n    this.context.isFlashing = true;\n    this.flashingContext = this.context;\n    if (this.flashTime > 0 && (this.flashTime <= 0.5)) {\n      this.pushContext('doIdle');\n      this.context.addInput(this.flashTime);\n    } else {\n      this.pushContext('doInterrupt');\n    }\n    return true;\n  }\n  return false;\n};\n\nProcess.prototype.flashPausedContext = function () {\n  var flashable = this.context ? this.context.lastFlashable() : null;\n  if (flashable) {\n    this.unflash();\n    flashable.expression.flash();\n    flashable.isFlashing = true;\n    this.flashingContext = flashable;\n  }\n};\n\nProcess.prototype.doInterrupt = function () {\n  this.popContext();\n  if (!this.isAtomic) {\n    this.isInterrupted = true;\n  }\n};\n\nProcess.prototype.doIdle = function (secs) {\n  if (!this.context.startTime) {\n    this.context.startTime = Date.now();\n  }\n  if ((Date.now() - this.context.startTime) < (secs * 1000)) {\n    this.pushContext('doInterrupt');\n    return;\n  }\n  this.popContext();\n};\n\nProcess.prototype.unflash = function () {\n  if (this.flashingContext) {\n    this.flashingContext.expression.unflash();\n    this.flashingContext.isFlashing = false;\n    this.flashingContext = null;\n  }\n};\n\n// Process: Compile (as of yet simple) block scripts to JS\n\n/*\n\twith either only explicit formal parameters or a specified number of\n\timplicit formal parameters mapped to empty input slots\n\t*** highly experimental and heavily under construction ***\n*/\n\nProcess.prototype.reportCompiled = function (context, implicitParamCount) {\n  // implicitParamCount is optional and indicates the number of\n  // expected parameters, if any. This is only used to handle\n  // implicit (empty slot) parameters and can otherwise be\n  // ignored\n  return new JSCompiler(this).compileFunction(context, implicitParamCount);\n};\n\nProcess.prototype.capture = function (aContext) {\n  // private - answer a new process on a full copy of the given context\n  // while retaining the lexical variable scope\n  var proc = new Process(this.topBlock, this.receiver);\n  var clos = new Context(\n    aContext.parentContext,\n    aContext.expression,\n    aContext.outerContext,\n    aContext.receiver\n  );\n  clos.variables = aContext.variables.fullCopy();\n  clos.variables.root().parentFrame = proc.variables;\n  proc.context = clos;\n  return proc;\n};\n\nProcess.prototype.getVarNamed = function (name) {\n  // private - special form for compiled expressions\n  // DO NOT use except in compiled methods!\n  // first check script vars, then global ones\n  var frame = this.homeContext.variables.silentFind(name) ||\n    this.context.variables.silentFind(name),\n    value;\n  if (frame) {\n    value = frame.vars[name].value;\n    return (value === 0 ? 0\n      : value === false ? false\n        : value === '' ? ''\n          : value || 0); // don't return null\n  }\n  throw new Error(\n    localize('a variable of name \\'')\n    + name\n    + localize('\\'\\ndoes not exist in this context')\n  );\n};\n\nProcess.prototype.setVarNamed = function (name, value) {\n  // private - special form for compiled expressions\n  // incomplete, currently only sets named vars\n  // DO NOT use except in compiled methods!\n  // first check script vars, then global ones\n  var frame = this.homeContext.variables.silentFind(name) ||\n    this.context.variables.silentFind(name);\n  if (isNil(frame)) {\n    throw new Error(\n      localize('a variable of name \\'')\n      + name\n      + localize('\\'\\ndoes not exist in this context')\n    );\n  }\n  frame.vars[name].value = value;\n};\n\nProcess.prototype.incrementVarNamed = function (name, delta) {\n  // private - special form for compiled expressions\n  this.setVarNamed(name, this.getVarNamed(name) + (+delta));\n};\n\n// Process: Atomic HOFs using experimental JIT-compilation\n\nProcess.prototype.reportAtomicMap = function (reporter, list) {\n  // if the reporter uses formal parameters instead of implicit empty slots\n  // there are two additional optional parameters:\n  // #1 - element\n  // #2 - optional | index\n  // #3 - optional | source list\n\n  this.assertType(list, 'list');\n  var result = [],\n    src = list.asArray(),\n    len = src.length,\n    formalParameterCount = reporter.inputs.length,\n    parms,\n    func,\n    i;\n\n  // try compiling the reporter into generic JavaScript\n  // fall back to the morphic reporter if unsuccessful\n  try {\n    func = this.reportCompiled(reporter, 1); // a single expected input\n  } catch (err) {\n    console.log(err.message);\n    func = reporter;\n  }\n\n  // iterate over the data in a single frame:\n  // to do: Insert some kind of user escape mechanism\n\n  for (i = 0; i < len; i += 1) {\n    parms = [src[i]];\n    if (formalParameterCount > 1) {\n      parms.push(i + 1);\n    }\n    if (formalParameterCount > 2) {\n      parms.push(list);\n    }\n    result.push(\n      invoke(\n        func,\n        new List(parms),\n        null,\n        null,\n        null,\n        null,\n        this.capture(reporter) // process\n      )\n    );\n  }\n  return new List(result);\n};\n\nProcess.prototype.reportAtomicKeep = function (reporter, list) {\n  // if the reporter uses formal parameters instead of implicit empty slots\n  // there are two additional optional parameters:\n  // #1 - element\n  // #2 - optional | index\n  // #3 - optional | source list\n\n  this.assertType(list, 'list');\n  var result = [],\n    src = list.asArray(),\n    len = src.length,\n    formalParameterCount = reporter.inputs.length,\n    parms,\n    func,\n    i;\n\n  // try compiling the reporter into generic JavaScript\n  // fall back to the morphic reporter if unsuccessful\n  try {\n    func = this.reportCompiled(reporter, 1); // a single expected input\n  } catch (err) {\n    console.log(err.message);\n    func = reporter;\n  }\n\n  // iterate over the data in a single frame:\n  // to do: Insert some kind of user escape mechanism\n  for (i = 0; i < len; i += 1) {\n    parms = [src[i]];\n    if (formalParameterCount > 1) {\n      parms.push(i + 1);\n    }\n    if (formalParameterCount > 2) {\n      parms.push(list);\n    }\n    if (\n      invoke(\n        func,\n        new List(parms),\n        null,\n        null,\n        null,\n        null,\n        this.capture(reporter) // process\n      )\n    ) {\n      result.push(src[i]);\n    }\n  }\n  return new List(result);\n};\n\nProcess.prototype.reportAtomicFindFirst = function (reporter, list) {\n  // if the reporter uses formal parameters instead of implicit empty slots\n  // there are two additional optional parameters:\n  // #1 - element\n  // #2 - optional | index\n  // #3 - optional | source list\n\n  this.assertType(list, 'list');\n  var src = list.asArray(),\n    len = src.length,\n    formalParameterCount = reporter.inputs.length,\n    parms,\n    func,\n    i;\n\n  // try compiling the reporter into generic JavaScript\n  // fall back to the morphic reporter if unsuccessful\n  try {\n    func = this.reportCompiled(reporter, 1); // a single expected input\n  } catch (err) {\n    console.log(err.message);\n    func = reporter;\n  }\n\n  // iterate over the data in a single frame:\n  // to do: Insert some kind of user escape mechanism\n  for (i = 0; i < len; i += 1) {\n    parms = [src[i]];\n    if (formalParameterCount > 1) {\n      parms.push(i + 1);\n    }\n    if (formalParameterCount > 2) {\n      parms.push(list);\n    }\n    if (\n      invoke(\n        func,\n        new List(parms),\n        null,\n        null,\n        null,\n        null,\n        this.capture(reporter) // process\n      )\n    ) {\n      return src[i];\n    }\n  }\n  return false;\n};\n\nProcess.prototype.reportAtomicCombine = function (list, reporter) {\n  // if the reporter uses formal parameters instead of implicit empty slots\n  // there are two additional optional parameters:\n  // #1 - accumulator\n  // #2 - element\n  // #3 - optional | index\n  // #4 - optional | source list\n\n  this.assertType(list, 'list');\n  var result = '',\n    src = list.asArray(),\n    len = src.length,\n    formalParameterCount = reporter.inputs.length,\n    parms,\n    func,\n    i;\n\n  if (len === 0) {\n    return result;\n  }\n  result = src[0];\n\n  // try compiling the reporter into generic JavaScript\n  // fall back to the morphic reporter if unsuccessful\n  try {\n    func = this.reportCompiled(reporter, 2); // a single expected input\n  } catch (err) {\n    console.log(err.message);\n    func = reporter;\n  }\n\n  // iterate over the data in a single frame:\n  // to do: Insert some kind of user escape mechanism\n  for (i = 1; i < len; i += 1) {\n    parms = [result, src[i]];\n    if (formalParameterCount > 2) {\n      parms.push(i + 1);\n    }\n    if (formalParameterCount > 3) {\n      parms.push(list);\n    }\n    result = invoke(\n      func,\n      new List(parms),\n      null,\n      null,\n      null,\n      null,\n      this.capture(reporter) // process\n    );\n  }\n  return result;\n};\n\nProcess.prototype.reportAtomicSort = function (list, reporter) {\n  this.assertType(list, 'list');\n  var func;\n\n  // try compiling the reporter into generic JavaScript\n  // fall back to the morphic reporter if unsuccessful\n  try {\n    func = this.reportCompiled(reporter, 2); // two inputs expected\n  } catch (err) {\n    console.log(err.message);\n    func = reporter;\n  }\n\n  // iterate over the data in a single frame:\n  return new List(\n    list.asArray().slice().sort((a, b) =>\n      invoke(\n        func,\n        new List([a, b]),\n        null,\n        null,\n        null,\n        null,\n        this.capture(reporter) // process\n      ) ? -1 : 1\n    )\n  );\n};\n\nProcess.prototype.reportAtomicGroup = function (list, reporter) {\n  this.assertType(list, 'list');\n  var result = [],\n    dict = new Map(),\n    groupKey,\n    src = list.asArray(),\n    len = src.length,\n    func,\n    i;\n\n  // try compiling the reporter into generic JavaScript\n  // fall back to the morphic reporter if unsuccessful\n  try {\n    func = this.reportCompiled(reporter, 1); // a single expected input\n  } catch (err) {\n    console.log(err.message);\n    func = reporter;\n  }\n\n  // iterate over the data in a single frame:\n  // to do: Insert some kind of user escape mechanism\n\n  for (i = 0; i < len; i += 1) {\n    groupKey = invoke(\n      func,\n      new List([src[i]]),\n      null,\n      null,\n      null,\n      null,\n      this.capture(reporter) // process\n    );\n    if (dict.has(groupKey)) {\n      dict.get(groupKey).push(src[i]);\n    } else {\n      dict.set(groupKey, [src[i]]);\n    }\n  }\n\n  dict.forEach((value, key) =>\n    result.push(new List([key, value.length, new List(value)]))\n  );\n  return new List(result);\n};\nContext.prototype.toString = function () {\n  var expr = this.expression;\n  if (expr instanceof Array) {\n    if (expr.length > 0) {\n      expr = '[' + expr[0] + ']';\n    }\n  }\n  return 'Context >> ' + expr + ' ' + this.variables;\n};\n\nContext.prototype.image = function () {\n  var ring = new RingMorph(),\n    block,\n    cont;\n\n  if (this.expression instanceof Morph) {\n    block = this.expression.fullCopy();\n\n    // replace marked call/cc block with empty slot\n    if (this.isContinuation) {\n      cont = detect(\n        block.allInputs(),\n        inp => inp.bindingID === 1\n      );\n      if (cont) {\n        block.revertToDefaultInput(cont, true);\n      }\n    }\n    ring.embed(block, this.inputs);\n    return ring.doWithAlpha(\n      1,\n      () => {\n        ring.clearAlpha();\n        return ring.fullImage();\n      }\n    );\n  }\n  if (this.expression instanceof Array) {\n    block = this.expression[this.pc].fullCopy();\n    if (block instanceof RingMorph && !block.contents()) { // empty ring\n      return block.doWithAlpha(1, () => block.fullImage());\n    }\n    ring.embed(block, this.isContinuation ? [] : this.inputs);\n    return ring.doWithAlpha(1, () => ring.fullImage());\n  }\n\n  // otherwise show an empty ring\n  ring.color = SpriteMorph.prototype.blockColor.other;\n  ring.setSpec('%rc %ringparms');\n\n  // also show my inputs, unless I'm a continuation\n  if (!this.isContinuation) {\n    this.inputs.forEach(inp =>\n      ring.parts()[1].addInput(inp)\n    );\n  }\n  return ring.doWithAlpha(1, () => ring.fullImage());\n};\n\n// Context continuations:\n\nContext.prototype.continuation = function (isReporter) {\n  var cont;\n  if (this.expression instanceof Array) {\n    cont = this;\n  } else if (this.parentContext) {\n    cont = this.parentContext;\n  } else {\n    cont = new Context(\n      null,\n      isReporter ? 'expectReport' : 'popContext'\n    );\n    cont.isContinuation = true;\n    return cont;\n  }\n  cont = cont.copyForContinuation();\n  cont.tag = null;\n  cont.isContinuation = true;\n  return cont;\n};\n\nContext.prototype.copyForContinuation = function () {\n  var cpy = copy(this),\n    cur = cpy,\n    isReporter = !(this.expression instanceof Array ||\n      isString(this.expression));\n  if (isReporter) {\n    cur.prepareContinuationForBinding();\n    while (cur.parentContext) {\n      cur.parentContext = copy(cur.parentContext);\n      cur = cur.parentContext;\n      cur.inputs = [];\n    }\n  }\n  return cpy;\n};\n\nContext.prototype.copyForContinuationCall = function () {\n  var cpy = copy(this),\n    cur = cpy,\n    isReporter = !(this.expression instanceof Array ||\n      isString(this.expression));\n  if (isReporter) {\n    this.expression = this.expression.fullCopy();\n    this.inputs = [];\n    while (cur.parentContext) {\n      cur.parentContext = copy(cur.parentContext);\n      cur = cur.parentContext;\n      cur.inputs = [];\n    }\n  }\n  return cpy;\n};\n\nContext.prototype.prepareContinuationForBinding = function () {\n  var pos = this.inputs.length,\n    slot;\n  this.expression = this.expression.fullCopy();\n  slot = this.expression.inputs()[pos];\n  if (slot) {\n    this.inputs = [];\n    // mark slot containing the call/cc reporter with an identifier\n    slot.bindingID = 1;\n    // and remember the number of detected empty slots\n    this.emptySlots = 1;\n  }\n};\n\n// Context accessing:\n\nContext.prototype.addInput = function (input) {\n  this.inputs.push(input);\n};\n\n// Context music\n\nContext.prototype.stopMusic = function () {\n  if (this.activeNote) {\n    this.activeNote.stop();\n    this.activeNote = null;\n  }\n};\n\n// Context single-stepping:\n\nContext.prototype.lastFlashable = function () {\n  // for experimental single-stepping when pausing\n  if (this.expression instanceof SyntaxElementMorph &&\n    !(this.expression instanceof CommandSlotMorph)) {\n    return this;\n  } else if (this.parentContext) {\n    return this.parentContext.lastFlashable();\n  }\n  return null;\n};\n\n// Context debugging\n\nContext.prototype.stackSize = function () {\n  if (!this.parentContext) {\n    return 1;\n  }\n  return 1 + this.parentContext.stackSize();\n};\n\nVariableFrame.prototype.toString = function () {\n  return 'a VariableFrame {' + this.names() + '}';\n};\n\nVariableFrame.prototype.copy = function () {\n  var frame = new VariableFrame(this.parentFrame);\n  this.names().forEach(vName =>\n    frame.addVar(vName, this.getVar(vName))\n  );\n  return frame;\n};\n\nVariableFrame.prototype.fullCopy = function () {\n  // experimental - for compiling to JS\n  var frame;\n  if (this.parentFrame) {\n    frame = new VariableFrame(this.parentFrame.fullCopy());\n  } else {\n    frame = new VariableFrame();\n  }\n  frame.vars = copy(this.vars);\n  return frame;\n};\n\nVariableFrame.prototype.root = function () {\n  if (this.parentFrame) {\n    return this.parentFrame.root();\n  }\n  return this;\n};\n\nVariableFrame.prototype.find = function (name) {\n  // answer the closest variable frame containing\n  // the specified variable. otherwise throw an exception.\n  var frame = this.silentFind(name);\n  if (frame) {return frame; }\n  throw new Error(\n    localize('a variable of name \\'')\n    + name\n    + localize('\\'\\ndoes not exist in this context')\n  );\n};\n\nVariableFrame.prototype.silentFind = function (name) {\n  // answer the closest variable frame containing\n  // the specified variable. Otherwise return null.\n  if (this.vars[name] instanceof Variable) {\n    return this;\n  }\n  if (this.parentFrame) {\n    return this.parentFrame.silentFind(name);\n  }\n  return null;\n};\n\nVariableFrame.prototype.setVar = function (name, value, sender) {\n  // change the specified variable if it exists\n  // else throw an error, because variables need to be\n  // declared explicitly (e.g. through a \"script variables\" block),\n  // before they can be accessed.\n  // if the found frame is inherited by the sender sprite\n  // shadow it (create an explicit one for the sender)\n  // before setting the value (\"create-on-write\")\n\n  var frame = this.find(name);\n  if (frame) {\n    if (sender instanceof SpriteMorph &&\n      (frame.owner instanceof SpriteMorph) &&\n      (sender !== frame.owner)) {\n      sender.shadowVar(name, value);\n    } else {\n      frame.vars[name].value = value;\n    }\n  }\n};\n\nVariableFrame.prototype.changeVar = function (name, delta, sender) {\n  // change the specified variable if it exists\n  // else throw an error, because variables need to be\n  // declared explicitly (e.g. through a \"script variables\" block,\n  // before they can be accessed.\n  // if the found frame is inherited by the sender sprite\n  // shadow it (create an explicit one for the sender)\n  // before changing the value (\"create-on-write\")\n\n  var frame = this.find(name),\n    value,\n    newValue;\n  if (frame) {\n    value = parseFloat(frame.vars[name].value);\n    newValue = isNaN(value) ? delta : value + parseFloat(delta);\n    if (sender instanceof SpriteMorph &&\n      (frame.owner instanceof SpriteMorph) &&\n      (sender !== frame.owner)) {\n      sender.shadowVar(name, newValue);\n    } else {\n      frame.vars[name].value = newValue;\n    }\n\n  }\n};\n\nVariableFrame.prototype.getVar = function (name) {\n  var frame = this.silentFind(name),\n    value;\n  if (frame) {\n    value = frame.vars[name].value;\n    return (value === 0 ? 0\n      : value === false ? false\n        : value === '' ? ''\n          : value || 0); // don't return null\n  }\n  if (typeof name === 'number') {\n    // empty input with a Binding-ID called without an argument\n    return '';\n  }\n  throw new Error(\n    localize('a variable of name \\'')\n    + name\n    + localize('\\'\\ndoes not exist in this context')\n  );\n};\n\nVariableFrame.prototype.addVar = function (name, value) {\n  this.vars[name] = new Variable(value === 0 ? 0\n    : value === false ? false\n      : value === '' ? '' : value || 0);\n};\n\nVariableFrame.prototype.deleteVar = function (name) {\n  var frame = this.find(name);\n  if (frame) {\n    delete frame.vars[name];\n  }\n};\n\n// VariableFrame tools\n\nVariableFrame.prototype.names = function () {\n  var each, names = [];\n  for (each in this.vars) {\n    if (Object.prototype.hasOwnProperty.call(this.vars, each)) {\n      names.push(each);\n    }\n  }\n  return names;\n};\n\nVariableFrame.prototype.allNamesDict = function (upTo) {\n  // \"upTo\" is an optional parent frame at which to stop, e.g. globals\n  var dict = {}, current = this;\n\n  function addKeysToDict(srcDict, trgtDict) {\n    var eachKey;\n    for (eachKey in srcDict) {\n      if (Object.prototype.hasOwnProperty.call(srcDict, eachKey)) {\n        trgtDict[eachKey] = eachKey;\n      }\n    }\n  }\n\n  while (current && (current !== upTo)) {\n    addKeysToDict(current.vars, dict);\n    current = current.parentFrame;\n  }\n  return dict;\n};\n\nVariableFrame.prototype.allNames = function (upTo) {\n  /*\n      only show the names of the lexical scope, hybrid scoping is\n      reserved to the daring ;-)\n    \"upTo\" is an optional parent frame at which to stop, e.g. globals\n  */\n  var answer = [], each, dict = this.allNamesDict(upTo);\n\n  for (each in dict) {\n    if (Object.prototype.hasOwnProperty.call(dict, each)) {\n      answer.push(each);\n    }\n  }\n  return answer;\n};\n\n\nexport {ThreadManager}\nexport {Process}\nexport {Context}\nexport {VariableFrame}\n","/*\n\n    xml.js\n\n    a simple XML DOM, encoder and parser for morphic.js\n\n    written by Jens Mnig\n    jens@moenig.org\n\n    Copyright (C) 2020 by Jens Mnig\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    prerequisites:\n    --------------\n    needs morphic.js\n\n\n    hierarchy\n    ---------\n    the following tree lists all constructors hierarchically,\n    indentation indicating inheritance. Refer to this list to get a\n    contextual overview:\n\n        Node*\n            XML_Element\n        ReadStream\n\n    * defined in morphic.js\n\n\n    toc\n    ---\n    the following list shows the order in which all constructors are\n    defined. Use this list to locate code in this document:\n\n        ReadStream\n        XML_Element\n\n\n    credits\n    -------\n    Nathan Dinsmore contributed to the design and implemented a first\n    working version of a complete XMLSerializer. I have taken much of the\n    overall design and many of the functions and methods in this file from\n    Nathan's fine original prototype. Recently Nathan has once again\n    worked his magic on the parser and optimized it by an order of\n    magnitude.\n\n*/\n\n/*global modules, detect, Node, isNil*/\n\n// Global stuff ////////////////////////////////////////////////////////\n\nimport {modules, detect, isNil} from \"./morphic\";\n\nmodules.xml = '2020-April-27';\n\n// Declarations\n\n// export var ReadStream;\n// export var XML_Element;\n\n// ReadStream ////////////////////////////////////////////////////////////\n\n// I am a sequential reading interface to an Array or String\n\n// ReadStream instance creation:\n\nexport function ReadStream(arrayOrString) {\n    this.contents = arrayOrString || '';\n    this.index = 0;\n}\n\n// ReadStream constants:\n\nReadStream.prototype.nonSpace = /\\S|$/g;\nReadStream.prototype.nonWord = /[\\s\\>\\/\\=]|$/g;\n\n// ReadStream accessing:\n\nReadStream.prototype.next = function (count) {\n    var element, start;\n    if (count === undefined) {\n        element = this.contents[this.index];\n        this.index += 1;\n        return element;\n    }\n    start = this.index;\n    this.index += count;\n    return this.contents.slice(start, this.index);\n};\n\nReadStream.prototype.peek = function () {\n    return this.contents[this.index];\n};\n\nReadStream.prototype.skip = function (count) {\n    this.index += count || 1;\n};\n\nReadStream.prototype.atEnd = function () {\n    return this.index > (this.contents.length - 1);\n};\n\n// ReadStream accessing String contents:\n\nReadStream.prototype.upTo = function (str) {\n    var i = this.contents.indexOf(str, this.index);\n    return i === -1 ? '' : this.contents.slice(this.index, this.index = i);\n};\n\nReadStream.prototype.peekUpTo = function (str) {\n    var i = this.contents.indexOf(str, this.index);\n    return i === -1 ? '' : this.contents.slice(this.index, i);\n};\n\nReadStream.prototype.skipSpace = function () {\n    this.nonSpace.lastIndex = this.index;\n    var result = this.nonSpace.exec(this.contents);\n    if (result) this.index = result.index;\n};\n\nReadStream.prototype.word = function () {\n    this.nonWord.lastIndex = this.index;\n    var result = this.nonWord.exec(this.contents);\n    return result ? this.contents.slice(this.index, this.index = result.index) : '';\n};\n\n// XML_Element ///////////////////////////////////////////////////////////\n/*\n    I am a DOM-Node which can encode itself to as well as parse itself\n    from a well-formed XML string. Note that there is no separate parser\n    object, all the parsing can be done in a single object.\n*/\n\n// XML_Element inherits from Node:\n\nXML_Element.prototype = Object.create(Node.prototype);\nXML_Element.prototype.constructor = XML_Element;\nXML_Element.uber = Node.prototype;\n\n// XML_Element preferences settings:\n\nXML_Element.prototype.indentation = '  ';\n\n// XML_Element instance creation:\n\nexport function XML_Element(tag, contents, parent) {\n    this.init(tag, contents, parent);\n}\n\nXML_Element.prototype.init = function (tag, contents, parent) {\n    // additional properties:\n    this.tag = tag || 'unnamed';\n    this.attributes = {};\n    this.contents = contents || '';\n\n    // initialize inherited properties:\n    XML_Element.uber.init.call(this);\n\n    // override inherited properties\n    if (parent) parent.addChild(this);\n};\n\n// XML_Element DOM navigation: (aside from what's inherited from Node)\n\nXML_Element.prototype.require = function (tagName, fallback) {\n    // answer the first direct child with the specified tagName.\n    // if it doesn't exist execute the fallback function or return the\n    // fallback value, otherwise throw an error\n    var child = this.childNamed(tagName);\n    if (!child) {\n        if (fallback instanceof Function) {\n            return fallback();\n        }\n        if (!isNil(fallback)) {\n            return fallback;\n        }\n        throw new Error('Missing required element <' + tagName + '>!');\n    }\n    return child;\n};\n\nXML_Element.prototype.childNamed = function (tagName) {\n    // answer the first direct child with the specified tagName, or null\n    return detect(\n        this.children,\n        child => child.tag === tagName\n    );\n};\n\nXML_Element.prototype.childrenNamed = function (tagName) {\n    // answer all direct children with the specified tagName\n    return this.children.filter(child => child.tag === tagName);\n};\n\nXML_Element.prototype.parentNamed = function (tagName) {\n    // including myself\n    if (this.tag === tagName) {\n        return this;\n    }\n    if (!this.parent) {\n        return null;\n    }\n    return this.parent.parentNamed(tagName);\n};\n\n// XML_Element output:\n\nXML_Element.prototype.toString = function (isFormatted, indentationLevel) {\n    var result = '',\n        indent = '',\n        level = indentationLevel || 0,\n        key,\n        i;\n\n    // spaces for indentation, if any\n    if (isFormatted) {\n        for (i = 0; i < level; i += 1) {\n            indent += this.indentation;\n        }\n        result += indent;\n    }\n\n    // opening tag\n    result += ('<' + this.tag);\n\n    // attributes, if any\n    for (key in this.attributes) {\n        if (Object.prototype.hasOwnProperty.call(this.attributes, key)\n                && this.attributes[key]) {\n            result += ' ' + key + '=\"' + this.escape(this.attributes[key]) + '\"';\n        }\n    }\n\n    // contents, subnodes, and closing tag\n    if (!this.contents.length && !this.children.length) {\n        result += '/>';\n    } else {\n        result += '>';\n        result += this.escape(this.contents);\n        this.children.forEach(element => {\n            if (isFormatted) {\n                result += '\\n';\n            }\n            result += element.toString(isFormatted, level + 1);\n        });\n        if (isFormatted && this.children.length) {\n            result += ('\\n' + indent);\n        }\n        result += '</' + this.tag + '>';\n    }\n    return result;\n};\n\nXML_Element.prototype.escape = function (string, ignoreQuotes) {\n    var src = isNil(string) ? '' : string.toString(),\n        result = '',\n        i,\n        ch;\n    for (i = 0; i < src.length; i += 1) {\n        ch = src[i];\n        switch (ch) {\n        case '\\'':\n            result += '&apos;';\n            break;\n        case '\\\"':\n            result += ignoreQuotes ? ch : '&quot;';\n            break;\n        case '<':\n            result += '&lt;';\n            break;\n        case '>':\n            result += '&gt;';\n            break;\n        case '&':\n            result += '&amp;';\n            break;\n        case '\\n': // escape CR b/c of export to URL feature\n            result += '&#xD;';\n            break;\n        case '~': // escape tilde b/c it's overloaded in serializer.store()\n            result += '&#126;';\n            break;\n        default:\n            result += ch;\n        }\n    }\n    return result;\n};\n\nXML_Element.prototype.unescape = function (string) {\n    return string.replace(/&(amp|apos|quot|lt|gt|#xD|#126);/g, (_, name) => {\n        switch (name) {\n            case 'amp': return '&';\n            case 'apos': return '\\'';\n            case 'quot': return '\"';\n            case 'lt': return '<';\n            case 'gt': return '>';\n            case '#xD': return '\\n';\n            case '#126': return '~';\n            default: console.warn('unreachable');\n        }\n    });\n};\n\n// XML_Element parsing:\n\nXML_Element.prototype.parseString = function (string) {\n    var stream = new ReadStream(string);\n    stream.upTo('<');\n    stream.skip();\n    this.parseStream(stream);\n};\n\nXML_Element.prototype.parseStream = function (stream) {\n    var key, value, ch, child;\n\n    // tag:\n    this.tag = stream.word();\n    stream.skipSpace();\n\n    // attributes:\n    ch = stream.peek();\n    while (ch !== '>' && ch !== '/') {\n        key = stream.word();\n        stream.skipSpace();\n        if (stream.next() !== '=') {\n            throw new Error('Expected \"=\" after attribute name');\n        }\n        stream.skipSpace();\n        ch = stream.next();\n        if (ch !== '\"' && ch !== \"'\") {\n            throw new Error('Expected single- or double-quoted attribute value');\n        }\n        value = stream.upTo(ch);\n        stream.skip(1);\n        stream.skipSpace();\n        this.attributes[key] = this.unescape(value);\n        ch = stream.peek();\n    }\n\n    // empty tag:\n    if (ch === '/') {\n        stream.skip();\n        if (stream.next() !== '>') {\n            throw new Error('Expected \">\" after \"/\" in empty tag');\n        }\n        return;\n    }\n    if (stream.next() !== '>') {\n        throw new Error('Expected \">\" after tag name and attributes');\n    }\n\n    // contents and children\n    while (!stream.atEnd()) {\n        ch = stream.next();\n        if (ch === '<') {\n            if (stream.peek() === '/') { // closing tag\n                stream.skip();\n                if (stream.word() !== this.tag) {\n                    throw new Error('Expected to close ' + this.tag);\n                }\n                stream.upTo('>');\n                stream.skip();\n                this.contents = this.unescape(this.contents);\n                return;\n            }\n            child = new XML_Element(null, null, this);\n            child.parseStream(stream);\n        } else {\n            this.contents += ch;\n        }\n    }\n};\n","/*\n\n    store.js\n\n    saving and loading Snap! projects\n\n    written by Jens Mnig\n    jens@moenig.org\n\n    Copyright (C) 2019 by Jens Mnig\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    prerequisites:\n    --------------\n    needs morphic.js, xml.js, and most of Snap!'s other modules\n\n\n    hierarchy\n    ---------\n    the following tree lists all constructors hierarchically,\n    indentation indicating inheritance. Refer to this list to get a\n    contextual overview:\n\n        XML_Serializer\n            SnapSerializer\n\n\n    credits\n    -------\n    Nathan Dinsmore contributed to the design and implemented a first\n    working version of a complete XMLSerializer. I have taken much of the\n    overall design and many of the functions and methods in this file from\n    Nathan's fine original prototype.\n\n*/\n\n/*global modules, XML_Element, VariableFrame, StageMorph, SpriteMorph,\nWatcherMorph, Point, CustomBlockDefinition, Context, ReporterBlockMorph,\nCommandBlockMorph, detect, CustomCommandBlockMorph, CustomReporterBlockMorph,\nColor, List, newCanvas, Costume, Sound, Audio, IDE_Morph, ScriptsMorph,\nBlockMorph, ArgMorph, InputSlotMorph, TemplateSlotMorph, CommandSlotMorph,\nFunctionSlotMorph, MultiArgMorph, ColorSlotMorph, nop, CommentMorph, isNil,\nlocalize, sizeOf, ArgLabelMorph, SVG_Costume, MorphicPreferences, Process,\nSyntaxElementMorph, Variable, isSnapObject, console, BooleanSlotMorph,\nnormalizeCanvas, contains*/\n\n// Global stuff ////////////////////////////////////////////////////////\nimport {sb} from './ypr'\n\nimport {modules, Morph, Color\n  ,  newCanvas,\n   Point,  normalizeCanvas,\n  contains,  nop, detect,\n  MorphicPreferences, isNil,   localize,\n sizeOf, } from './morphic'\nimport { SyntaxElementMorph, BlockMorph, ScriptsMorph, ArgMorph, CommentMorph, CommandBlockMorph\n  , BooleanSlotMorph, ReporterBlockMorph,\n  InputSlotMorph, TemplateSlotMorph, CommandSlotMorph,\n  FunctionSlotMorph, MultiArgMorph, ColorSlotMorph, ArgLabelMorph\n  , } from './blocks'\nimport { VariableFrame, Process, Context,  Variable,\n} from './threads'\nimport {SpriteMorph, StageMorph, Costume, SVG_Costume, WatcherMorph, isSnapObject,Note,\nSound} from './objects'\nimport {ListWatcherMorph, List} from './lists'\nimport {InputSlotDialogMorph, BlockExportDialogMorph, BlockImportDialogMorph,\n  BlockLabelPlaceHolderMorph,BlockRemovalDialogMorph, BlockEditorMorph, BlockDialogMorph,\n  CustomCommandBlockMorph, CustomReporterBlockMorph, CustomBlockDefinition\n} from './byob'\nimport {TableDialogMorph, TableMorph\n} from './tables'\nimport {XML_Element} from './xml'\nmodules.store = '2020-October-27';\n\n\n// XML_Serializer ///////////////////////////////////////////////////////\n/*\n    I am an abstract protype for my heirs.\n\n    I manage object identities and keep track of circular data structures.\n    Objects are \"touched\" and a property named \"serializationID\" is added\n    to each, representing an index integer in the list, starting with 1.\n*/\n\n// XML_Serializer instance creation:\n\nexport function XML_Serializer() {\n    this.contents = [];\n    this.media = [];\n    this.isCollectingMedia = false;\n    this.isExportingBlocksLibrary = false;\n}\n\n// XML_Serializer preferences settings:\n\nXML_Serializer.prototype.idProperty = 'serializationID';\nXML_Serializer.prototype.mediaIdProperty = 'serializationMediaID';\nXML_Serializer.prototype.mediaDetectionProperty = 'isMedia';\nXML_Serializer.prototype.version = 1; // increment on structural change\n\n// XML_Serializer accessing:\n\nXML_Serializer.prototype.serialize = function (object, forBlocksLibrary) {\n    // public: answer an XML string representing the given object\n    var xml;\n    this.flush(); // in case an error occurred in an earlier attempt\n    this.flushMedia();\n    this.isExportingBlocksLibrary = forBlocksLibrary;\n    xml = this.store(object);\n    this.flush();\n    return xml;\n};\n\nXML_Serializer.prototype.store = function (object, mediaID) {\n    // private - mediaID is optional\n    if (isNil(object) || !object.toXML) {\n        // unsupported type, to be checked before calling store()\n        // when debugging, be sure to throw an error at this point\n        return '';\n    }\n    if (this.isCollectingMedia && object[this.mediaDetectionProperty]) {\n        this.addMedia(object, mediaID);\n        return this.format(\n            '<ref mediaID=\"@\"></ref>',\n            object[this.mediaIdProperty]\n        );\n    }\n    if (object[this.idProperty]) {\n        return this.format('<ref id=\"@\"></ref>', object[this.idProperty]);\n    }\n    this.add(object);\n    return object.toXML(this, mediaID).replace(\n        '~',\n        this.format('id=\"@\"', object[this.idProperty])\n    );\n};\n\nXML_Serializer.prototype.mediaXML = function () {\n    // answer a project's collected media module as XML\n    var xml = '<media>';\n    this.media.forEach(object => {\n        var str = object.toXML(this).replace(\n            '~',\n            this.format('mediaID=\"@\"', object[this.mediaIdProperty])\n        );\n        xml = xml + str;\n    });\n    return xml + '</media>';\n};\n\nXML_Serializer.prototype.add = function (object) {\n    // private - mark the object with a serializationID property and add it\n    if (object[this.idProperty]) { // already present\n        return -1;\n    }\n    this.contents.push(object);\n    object[this.idProperty] = this.contents.length;\n    return this.contents.length;\n};\n\nXML_Serializer.prototype.addMedia = function (object, mediaID) {\n    // private - mark the object with a serializationMediaID property\n    // and add it to media\n    // if a mediaID is given, take it, otherwise generate one\n    if (object[this.mediaIdProperty]) { // already present\n        return -1;\n    }\n    this.media.push(object);\n    if (mediaID) {\n        object[this.mediaIdProperty] = mediaID + '_' + object.name;\n    } else {\n        object[this.mediaIdProperty] = this.media.length;\n    }\n    return this.media.length;\n};\n\nXML_Serializer.prototype.at = function (integer) {\n    // private\n    return this.contents[integer - 1];\n};\n\nXML_Serializer.prototype.flush = function () {\n    // private - free all objects and empty my contents\n    this.contents.forEach(obj => delete obj[this.idProperty]);\n    this.contents = [];\n};\n\nXML_Serializer.prototype.flushMedia = function () {\n    // private - free all media objects and empty my media\n    if (this.media instanceof Array) {\n        this.media.forEach(obj => delete obj[this.mediaIdProperty]);\n    }\n    this.media = [];\n    this.isExportingBlocksLibrary = false;\n};\n\n// XML_Serializer formatting:\n\nXML_Serializer.prototype.escape = XML_Element.prototype.escape;\nXML_Serializer.prototype.unescape = XML_Element.prototype.unescape;\n\n\nXML_Serializer.prototype.format = function (string) {\n    // private\n    var i = -1,\n        values = arguments,\n        value;\n\n    return string.replace(/[@$%]([\\d]+)?/g, (spec, index) => {\n        index = parseInt(index, 10);\n\n        if (isNaN(index)) {\n            i += 1;\n            value = values[i + 1];\n        } else {\n            value = values[index + 1];\n        }\n        // original line of code - now frowned upon by JSLint:\n        // value = values[(isNaN(index) ? (i += 1) : index) + 1];\n\n        return spec === '@' ?\n                this.escape(value)\n                    : spec === '$' ?\n                        this.escape(value, true)\n                            : value;\n    });\n};\n\n// XML_Serializer loading:\n\nXML_Serializer.prototype.load = function (xmlString) {\n    // public - answer a new object which is represented by the given\n    // XML string.\n    nop(xmlString);\n    throw new Error(\n        'loading should be implemented in heir of XML_Serializer'\n    );\n};\n\nXML_Serializer.prototype.parse = function (xmlString) {\n    // private - answer an XML_Element representing the given XML String\n    var element = new XML_Element();\n    try {\n        element.parseString(xmlString);\n    } catch (e) {\n        // Trace.log('XML.parseFailed', xmlString);\n        throw e;\n    }\n    return element;\n};\n\n// SnapSerializer ////////////////////////////////////////////////////////////\n\n// export var SnapSerializer;\n\n// SnapSerializer inherits from XML_Serializer:\n\nSnapSerializer.prototype = new XML_Serializer();\nSnapSerializer.prototype.constructor = SnapSerializer;\nSnapSerializer.uber = XML_Serializer.prototype;\n\n// SnapSerializer constants:\n\nSnapSerializer.prototype.app = 'iSnap 3.0, http://go.ncsu.edu/isnap';\nSnapSerializer.prototype.appParent = 'Snap! 6, https://snap.berkeley.edu';\n\nSnapSerializer.prototype.thumbnailSize = new Point(160, 120);\n\nSnapSerializer.prototype.watcherLabels = {\n    xPosition: 'x position',\n    yPosition: 'y position',\n    direction: 'direction',\n    getScale: 'size',\n    reportShown: 'shown?',\n    getTempo: 'tempo',\n    getVolume: 'volume',\n    getPan: 'balance',\n    getPenDown: 'pen down?',\n    getLastAnswer: 'answer',\n    getLastMessage: 'message',\n    getTimer: 'timer',\n    getCostumeIdx: 'costume #',\n    reportMouseX: 'mouse x',\n    reportMouseY: 'mouse y',\n    reportThreadCount: 'processes'\n};\n\n// SnapSerializer instance creation:\n\nexport function SnapSerializer() {\n    this.init();\n}\n\n// SnapSerializer initialization:\n\nSnapSerializer.prototype.init = function () {\n    this.project = {};\n    this.objects = {};\n    this.mediaDict = {};\n};\n\n// SnapSerializer saving:\n\nXML_Serializer.prototype.mediaXML = function (name) {\n    // under construction....\n    var xml = '<media name=\"' +\n            (name || 'untitled') +\n            '\" app=\"' + this.app +\n            '\" version=\"' +\n            this.version +\n            '\">';\n    this.media.forEach(object => {\n        var str = object.toXML(this).replace(\n            '~',\n            this.format('mediaID=\"@\"', object[this.mediaIdProperty])\n        );\n        xml = xml + str;\n    });\n    return xml + '</media>';\n};\n\n// SnapSerializer loading:\n\nSnapSerializer.prototype.load = function (xmlString, ide) {\n    // public - answer a new Project represented by the given XML String\n    return this.loadProjectModel(this.parse(xmlString), ide);\n};\n\nSnapSerializer.prototype.loadProjectModel = function (xmlNode, ide, remixID) {\n    // public - answer a new Project represented by the given XML top node\n    // show a warning if the origin apps differ\n\n    var appInfo = xmlNode.attributes.app,\n        app = appInfo ? appInfo.split(' ')[0] : null;\n\n    var sourceApp = this.app.split(' ')[0];\n    var sourceAppParent = this.appParent.split(' ')[0];\n    if (ide && app && app !== sourceApp && app !== sourceAppParent) {\n        ide.inform(\n            app + ' Project',\n            'This project has been created by a different app:\\n\\n' +\n                app +\n                '\\n\\nand may be incompatible or fail to load here.'\n        );\n    }\n    return this.rawLoadProjectModel(xmlNode, remixID);\n};\n\nSnapSerializer.prototype.rawLoadProjectModel = function (xmlNode, remixID) {\n    // private\n    var project = {sprites: {}},\n        model,\n        nameID;\n\n    this.project = project;\n\n    model = {project: xmlNode };\n    if (+xmlNode.attributes.version > this.version) {\n        throw 'Project uses newer version of Serializer';\n    }\n\n    /* Project Info */\n\n    this.objects = {};\n    project.name = model.project.attributes.name;\n    if (!project.name) {\n        nameID = 1;\n        while (\n            Object.prototype.hasOwnProperty.call(\n                localStorage,\n                '-snap-project-Untitled ' + nameID\n            )\n        ) {\n            nameID += 1;\n        }\n        project.name = 'Untitled ' + nameID;\n    }\n    model.notes = model.project.childNamed('notes');\n    if (model.notes) {\n        project.notes = model.notes.contents;\n    }\n    model.data = model.project.childNamed('data');\n    if (model.data) {\n        project.data = model.data.contents;\n    }\n    model.globalVariables = model.project.childNamed('variables');\n    project.globalVariables = new VariableFrame();\n\n    /* Stage */\n\n    model.stage = model.project.require('stage');\n    StageMorph.prototype.frameRate = 0;\n    project.stage = new StageMorph(project.globalVariables);\n    project.stage.remixID = remixID;\n    if (Object.prototype.hasOwnProperty.call(\n            model.stage.attributes,\n            'id'\n        )) {\n        this.objects[model.stage.attributes.id] = project.stage;\n    }\n    if (model.stage.attributes.name) {\n        project.stage.name = model.stage.attributes.name;\n    }\n    if (model.stage.attributes.color) {\n        project.stage.color = this.loadColor(model.stage.attributes.color);\n        project.stage.cachedHSV = project.stage.color.hsv();\n    }\n    if (model.stage.attributes.scheduled === 'true') {\n        project.stage.fps = 30;\n        StageMorph.prototype.frameRate = 30;\n    }\n    if (model.stage.attributes.volume) {\n        project.stage.volume = +model.stage.attributes.volume;\n    }\n    if (model.stage.attributes.pan) {\n        project.stage.pan = +model.stage.attributes.pan;\n    }\n    if (model.stage.attributes.penlog) {\n        StageMorph.prototype.enablePenLogging =\n            (model.stage.attributes.penlog === 'true');\n    }\n\n    model.pentrails = model.stage.childNamed('pentrails');\n    if (model.pentrails) {\n        project.pentrails = new Image();\n        project.pentrails.onload = function () {\n            if (project.stage.trailsCanvas) { // work-around a bug in FF\n                normalizeCanvas(project.stage.trailsCanvas);\n                var context = project.stage.trailsCanvas.getContext('2d');\n                context.drawImage(project.pentrails, 0, 0);\n                project.stage.changed();\n            }\n        };\n        project.pentrails.src = model.pentrails.contents;\n    }\n    project.stage.setTempo(model.stage.attributes.tempo);\n    StageMorph.prototype.dimensions = new Point(480, 360);\n    if (model.stage.attributes.width) {\n        StageMorph.prototype.dimensions.x =\n            Math.max(+model.stage.attributes.width, 240);\n    }\n    if (model.stage.attributes.height) {\n        StageMorph.prototype.dimensions.y =\n            Math.max(+model.stage.attributes.height, 180);\n    }\n    project.stage.setExtent(StageMorph.prototype.dimensions);\n    SpriteMorph.prototype.useFlatLineEnds =\n        model.stage.attributes.lines === 'flat';\n    BooleanSlotMorph.prototype.isTernary =\n        model.stage.attributes.ternary !== 'false';\n    Process.prototype.enableHyperOps =\n        model.stage.attributes.hyperops !== 'false';\n    project.stage.isThreadSafe =\n        model.stage.attributes.threadsafe === 'true';\n    StageMorph.prototype.enableCodeMapping =\n        model.stage.attributes.codify === 'true';\n    StageMorph.prototype.enableInheritance =\n        model.stage.attributes.inheritance !== 'false';\n    StageMorph.prototype.enableSublistIDs =\n        model.stage.attributes.sublistIDs === 'true';\n\n    model.hiddenPrimitives = model.project.childNamed('hidden');\n    if (model.hiddenPrimitives) {\n        model.hiddenPrimitives.contents.split(' ').forEach(\n            sel => {\n                if (sel) {\n                    StageMorph.prototype.hiddenPrimitives[sel] = true;\n                }\n            }\n        );\n    }\n\n    model.codeHeaders = model.project.childNamed('headers');\n    if (model.codeHeaders) {\n        model.codeHeaders.children.forEach(\n            xml => StageMorph.prototype.codeHeaders[xml.tag] = xml.contents\n        );\n    }\n\n    model.codeMappings = model.project.childNamed('code');\n    if (model.codeMappings) {\n        model.codeMappings.children.forEach(\n            xml => StageMorph.prototype.codeMappings[xml.tag] = xml.contents\n        );\n    }\n\n    model.globalBlocks = model.project.childNamed('blocks');\n    if (model.globalBlocks) {\n        this.loadCustomBlocks(project.stage, model.globalBlocks, true);\n        this.populateCustomBlocks(\n            project.stage,\n            model.globalBlocks,\n            true\n        );\n    }\n    this.loadObject(project.stage, model.stage);\n\n    /* Sprites */\n\n    model.sprites = model.stage.require('sprites');\n    project.sprites[project.stage.name] = project.stage;\n\n    model.sprites.childrenNamed('sprite').forEach(\n        model => this.loadValue(model)\n    );\n\n    // restore inheritance and nesting associations\n    this.project.stage.children.forEach(sprite => {\n        var exemplar, anchor;\n        if (sprite.inheritanceInfo) { // only sprites can inherit\n            exemplar = this.project.sprites[\n                sprite.inheritanceInfo.exemplar\n            ];\n            if (exemplar) {\n                sprite.setExemplar(exemplar);\n            }\n            sprite.inheritedAttributes = sprite.inheritanceInfo.delegated || [];\n            sprite.updatePropagationCache();\n        }\n        if (sprite.nestingInfo) { // only sprites may have nesting info\n            anchor = this.project.sprites[sprite.nestingInfo.anchor];\n            if (anchor) {\n                anchor.attachPart(sprite);\n            }\n            sprite.rotatesWithAnchor = (sprite.nestingInfo.synch === 'true');\n        }\n    });\n    this.project.stage.children.forEach(sprite => {\n        var costume;\n        if (sprite.nestingInfo) { // only sprites may have nesting info\n            sprite.nestingScale = +(sprite.nestingInfo.scale || sprite.scale);\n            delete sprite.nestingInfo;\n        }\n        ['scripts', 'costumes', 'sounds'].forEach(att => {\n            if (sprite.inheritsAttribute(att)) {\n                sprite.refreshInheritedAttribute(att);\n            }\n        });\n        if (sprite.inheritsAttribute('costumes')) {\n            if (sprite.inheritsAttribute('costume #')) {\n                costume = sprite.exemplar.costume;\n            } else {\n                costume = sprite.costumes.asArray()[\n                    sprite.inheritanceInfo.costumeNumber - 1\n                ];\n            }\n            if (costume) {\n                if (costume.loaded) {\n                    sprite.wearCostume(costume, true);\n                } else {\n                    costume.loaded = function () {\n                        this.loaded = true;\n                        sprite.wearCostume(costume, true);\n                    };\n                }\n            }\n        }\n        delete sprite.inheritanceInfo;\n    });\n\n     /* Editing custom block */\n\n    // Regardless of whether we're showing an editing block, we should close\n    // any open editor window when loading a new project.\n    // We slice the array because close() modifies the original array\n    BlockEditorMorph.showing.slice().forEach(function(editor) {\n        editor.close();\n    });\n\n    model.editing  = model.project.childNamed('editing');\n    if (model.editing) {\n        var defaultGUID = model.editing.attributes.guid;\n        model.editing.children.forEach((scripts, i) => {\n            this.loadEditing(project, scripts, defaultGUID, i);\n        }, this);\n    }\n\n    /* Global Variables */\n\n    if (model.globalVariables) {\n        this.loadVariables(\n            project.globalVariables,\n            model.globalVariables\n        );\n    }\n\n    this.objects = {};\n\n    /* Watchers */\n\n    model.sprites.childrenNamed('watcher').forEach(model => {\n        var watcher, color, target, hidden, extX, extY;\n\n        color = this.loadColor(model.attributes.color);\n        target = Object.prototype.hasOwnProperty.call(\n            model.attributes,\n            'scope'\n        ) ? project.sprites[model.attributes.scope] : null;\n\n        // determine whether the watcher is hidden, slightly\n        // complicated to retain backward compatibility\n        // with former tag format: hidden=\"hidden\"\n        // now it's: hidden=\"true\"\n        hidden = Object.prototype.hasOwnProperty.call(\n            model.attributes,\n            'hidden'\n        ) && (model.attributes.hidden !== 'false');\n\n        if (Object.prototype.hasOwnProperty.call(\n                model.attributes,\n                'var'\n            )) {\n            watcher = new WatcherMorph(\n                model.attributes['var'],\n                color,\n                isNil(target) ? project.globalVariables\n                    : target.variables,\n                model.attributes['var'],\n                hidden\n            );\n        } else {\n            watcher = new WatcherMorph(\n                localize(this.watcherLabels[model.attributes.s]),\n                color,\n                target,\n                model.attributes.s,\n                hidden\n            );\n        }\n        watcher.setStyle(model.attributes.style || 'normal');\n        if (watcher.style === 'slider') {\n            watcher.setSliderMin(model.attributes.min || '1', true);\n            watcher.setSliderMax(model.attributes.max || '100', true);\n        }\n        watcher.setPosition(\n            project.stage.topLeft().add(new Point(\n                +model.attributes.x || 0,\n                +model.attributes.y || 0\n            ))\n        );\n        project.stage.add(watcher);\n        watcher.onNextStep = function () {this.currentValue = null; };\n\n        // set watcher's contentsMorph's extent if it is showing a list and\n        // its monitor dimensions are given\n        if (watcher.currentValue instanceof List &&\n                watcher.cellMorph.contentsMorph) {\n            extX = model.attributes.extX;\n            if (extX) {\n                watcher.cellMorph.contentsMorph.setWidth(+extX);\n            }\n            extY = model.attributes.extY;\n            if (extY) {\n                watcher.cellMorph.contentsMorph.setHeight(+extY);\n            }\n            // adjust my contentsMorph's handle position\n            watcher.cellMorph.contentsMorph.handle.fixLayout();\n        }\n    });\n\n    // clear sprites' inherited methods caches, if any\n    this.project.stage.children.forEach(\n        sprite => sprite.inheritedMethodsCache = []\n    );\n\n    this.objects = {};\n    return project;\n};\n\nSnapSerializer.prototype.loadBlocks = function (xmlString, targetStage) {\n    // public - answer a new Array of custom block definitions\n    // represented by the given XML String\n    var stage = new StageMorph(),\n        model;\n\n    this.project = {\n        stage: stage,\n        sprites: {},\n        targetStage: targetStage // for secondary custom block def look-up\n    };\n    model = this.parse(xmlString);\n    if (+model.attributes.version > this.version) {\n        throw 'Module uses newer version of Serializer';\n    }\n    this.loadCustomBlocks(stage, model, true);\n    this.populateCustomBlocks(\n        stage,\n        model,\n        true\n    );\n    this.objects = {};\n    stage.globalBlocks.forEach(def => def.receiver = null);\n    this.objects = {};\n    this.project = {};\n    this.mediaDict = {};\n    return stage.globalBlocks;\n};\n\nSnapSerializer.prototype.loadSprites = function (xmlString, ide) {\n    // public - import a set of sprites represented by xmlString\n    // into the current project of the ide\n    var model, project;\n\n    project = this.project = {\n        globalVariables: ide.globalVariables,\n        stage: ide.stage,\n        sprites: {}\n    };\n    project.sprites[project.stage.name] = project.stage;\n\n    model = this.parse(xmlString);\n    if (+model.attributes.version > this.version) {\n        throw 'Module uses newer version of Serializer';\n    }\n    model.childrenNamed('sprite').forEach(model => {\n        var sprite  = new SpriteMorph(project.globalVariables);\n\n        if (model.attributes.id) {\n            this.objects[model.attributes.id] = sprite;\n        }\n        if (model.attributes.name) {\n            sprite.name = ide.newSpriteName(model.attributes.name);\n            project.sprites[sprite.name] = sprite;\n        }\n        if (model.attributes.color) {\n            sprite.color = this.loadColor(model.attributes.color);\n            sprite.cachedHSV = sprite.color.hsv();\n        }\n        if (model.attributes.pen) {\n            sprite.penPoint = model.attributes.pen;\n        }\n        if (model.attributes.volume) {\n            sprite.volume = +model.attributes.volume;\n        }\n        if (model.attributes.pan) {\n            sprite.pan = +model.attributes.pan;\n        }\n        project.stage.add(sprite);\n        ide.sprites.add(sprite);\n        sprite.scale = parseFloat(model.attributes.scale || '1');\n        sprite.rotationStyle = parseFloat(\n            model.attributes.rotation || '1'\n        );\n        sprite.isDraggable = model.attributes.draggable !== 'false';\n        sprite.isVisible = model.attributes.hidden !== 'true';\n        sprite.heading = parseFloat(model.attributes.heading) || 0;\n        sprite.gotoXY(+model.attributes.x || 0, +model.attributes.y || 0);\n        this.loadObject(sprite, model);\n        sprite.fixLayout();\n        sprite.pauseGenericHatBlocks();\n    });\n\n    // restore inheritance and nesting associations\n    project.stage.children.forEach(sprite => {\n        var exemplar, anchor;\n        if (sprite.inheritanceInfo) { // only sprites can inherit\n            exemplar = project.sprites[\n                sprite.inheritanceInfo.exemplar\n            ];\n            if (exemplar) {\n                sprite.setExemplar(exemplar);\n            }\n        }\n        if (sprite.nestingInfo) { // only sprites may have nesting info\n            anchor = project.sprites[sprite.nestingInfo.anchor];\n            if (anchor) {\n                anchor.attachPart(sprite);\n            }\n            sprite.rotatesWithAnchor = (sprite.nestingInfo.synch === 'true');\n        }\n    });\n    project.stage.children.forEach(sprite => {\n        delete sprite.inheritanceInfo;\n        if (sprite.nestingInfo) { // only sprites may have nesting info\n            sprite.nestingScale = +(sprite.nestingInfo.scale || sprite.scale);\n            delete sprite.nestingInfo;\n        }\n    });\n\n    this.objects = {};\n    this.project = {};\n    this.mediaDict = {};\n\n    ide.stage.fixLayout();\n    ide.stage.rerender();\n    ide.createCorral();\n    ide.fixLayout();\n};\n\nSnapSerializer.prototype.loadMedia = function (xmlString) {\n    // public - load the media represented by xmlString into memory\n    // to be referenced by a media-less project later\n    return this.loadMediaModel(this.parse(xmlString));\n};\n\nSnapSerializer.prototype.loadMediaModel = function (xmlNode) {\n    // public - load the media represented by xmlNode into memory\n    // to be referenced by a media-less project later\n    var model = xmlNode;\n    this.mediaDict = {};\n    if (+model.attributes.version > this.version) {\n        throw 'Module uses newer version of Serializer';\n    }\n    model.children.forEach(model => this.loadValue(model));\n    return this.mediaDict;\n};\n\nSnapSerializer.prototype.loadObject = function (object, model) {\n    // private\n    var blocks = model.require('blocks'),\n        dispatches = model.childNamed('dispatches'),\n        node,\n        costume;\n\n    // load the instrument\n    if (model.attributes.instrument) {\n        object.instrument = +model.attributes.instrument;\n    }\n\n    this.loadInheritanceInfo(object, model);\n    this.loadNestingInfo(object, model);\n\n    // load the costume that's not in the wardrobe, if any\n    node = model.childNamed('wear');\n    if (node) {\n        node = node.childNamed('costume') || node.childNamed('ref');\n        if (!node) {\n            console.log(object.name + ': missing costume to wear');\n        } else {\n            costume = this.loadValue(node, object);\n            if (costume.loaded) {\n                object.wearCostume(costume, true);\n            } else {\n                costume.loaded = function () {\n                    this.loaded = true;\n                    object.wearCostume(costume, true);\n                };\n            }\n        }\n    }\n\n    // load costumes unless they're inherited\n    if (!(object.inheritanceInfo &&\n            (object.inheritanceInfo.delegated instanceof Array) &&\n            contains(object.inheritanceInfo.delegated, 'costumes'))) {\n        this.loadCostumes(object, model);\n    }\n\n    // load sounds unless they're inherited\n    if (!(object.inheritanceInfo &&\n            (object.inheritanceInfo.delegated instanceof Array) &&\n            contains(object.inheritanceInfo.delegated, 'sounds'))) {\n        this.loadSounds(object, model);\n    }\n\n    this.loadCustomBlocks(object, blocks);\n    if (dispatches) {\n        this.loadCustomBlocks(object, dispatches, false, true);\n    }\n    this.populateCustomBlocks(object, blocks);\n    this.loadVariables(object.variables, model.require('variables'), object);\n\n    // load scripts unless they're inherited\n    if (!(object.inheritanceInfo &&\n            (object.inheritanceInfo.delegated instanceof Array) &&\n            contains(object.inheritanceInfo.delegated, 'scripts'))) {\n        this.loadScripts(object, object.scripts, model.require('scripts'));\n    }\n\n    // note: the dispatches cache isn't cleared until after\n    // *all* objects are loaded\n};\n\nSnapSerializer.prototype.loadInheritanceInfo = function (object, model) {\n    // private\n    var info = model.childNamed('inherit'),\n        delegated;\n    if (info) {\n        object.inheritanceInfo = info.attributes;\n        delegated = info.childNamed('list');\n        if (delegated) {\n            object.inheritanceInfo.delegated =\n                this.loadValue(delegated).asArray();\n        }\n        object.inheritanceInfo.costumeNumber = model.attributes.costume;\n    }\n};\n\nSnapSerializer.prototype.loadNestingInfo = function (object, model) {\n    // private\n    var info = model.childNamed('nest');\n    if (info) {\n        object.nestingInfo = info.attributes;\n    }\n};\n\nSnapSerializer.prototype.loadCostumes = function (object, model) {\n    // private\n    var costumes = model.childNamed('costumes'),\n        costume;\n    if (costumes) {\n        object.costumes = this.loadValue(costumes.require(\n            'list',\n            function () {\n                console.log(object.name + ': missing required costumes list, ' +\n                    'improvising...');\n                return new XML_Element('list');\n            }\n        ));\n        object.costumes.type = 'costume';\n    }\n    if (Object.prototype.hasOwnProperty.call(\n            model.attributes,\n            'costume'\n        )) {\n        costume = object.costumes.asArray()[model.attributes.costume - 1];\n        if (costume) {\n            if (costume.loaded) {\n                object.wearCostume(costume, true);\n            } else {\n                costume.loaded = function () {\n                    this.loaded = true;\n                    object.wearCostume(costume, true);\n                };\n            }\n        }\n    }\n};\n\nSnapSerializer.prototype.loadSounds = function (object, model) {\n    // private\n    var sounds = model.childNamed('sounds');\n    if (sounds) {\n        // object.sounds = this.loadValue(sounds.require('list'));\n        object.sounds = this.loadValue(sounds.require(\n            'list',\n            function () {\n                console.log(object.name + ': missing required sounds list, ' +\n                    'improvising...');\n                return new XML_Element('list');\n            }\n        ));\n\n        object.sounds.type = 'sound';\n    }\n};\n\nSnapSerializer.prototype.loadVariables = function (varFrame, element, object) {\n    // private\n    element.children.forEach(child => {\n        var v, value;\n        if (child.tag !== 'variable') {\n            return;\n        }\n        value = child.children[0];\n        v = new Variable();\n        v.isTransient = (child.attributes.transient === 'true');\n        v.value = (v.isTransient || !value ) ? 0\n                : this.loadValue(value, object);\n        varFrame.vars[child.attributes.name] = v;\n    });\n};\n\nSnapSerializer.prototype.loadCustomBlocks = function (\n    object,\n    element,\n    isGlobal,\n    isDispatch\n) {\n    element.children.forEach(function(child) {\n        this.loadCustomBlock(object, child, isGlobal, isDispatch);\n    }, this);\n};\n\nSnapSerializer.prototype.loadCustomBlock = function(\n    object, child, isGlobal, isDispatch\n) {\n    // private\n    var myself = this;\n    var definition, names, inputs, vars, header, code, trans, comment, i;\n    if (child.tag !== 'block-definition') {\n        return null;\n    }\n    definition = new CustomBlockDefinition(\n        child.attributes.s || '',\n        object\n    );\n    definition.category = child.attributes.category || 'other';\n    definition.type = child.attributes.type || 'command';\n    if (child.attributes.guid) {\n        definition.guid = child.attributes.guid;\n    }\n    if (child.attributes.isImported) {\n        definition.isImported = child.attributes.isImported === 'true';\n    }\n    definition.isGlobal = (isGlobal === true);\n    if (object) {\n        if (isDispatch) {\n            object.inheritedMethodsCache.push(definition);\n        } else {\n            if (definition.isGlobal) {\n                object.globalBlocks.push(definition);\n            } else {\n                object.customBlocks.push(definition);\n            }\n        }\n    }\n\n    names = definition.parseSpec(definition.spec).filter(\n        function (str) {\n            return str.charAt(0) === '%' && str.length > 1;\n        }\n    ).map(function (str) {\n        return str.substr(1);\n    });\n\n    definition.names = names;\n    inputs = child.childNamed('inputs');\n    if (inputs) {\n        i = -1;\n        inputs.children.forEach(child => {\n            var options = child.childNamed('options');\n            if (child.tag !== 'input') {\n                return;\n            }\n            i += 1;\n            definition.declarations.set(\n                names[i],\n                [\n                    child.attributes.type,\n                    contains(['%b', '%boolUE'], child.attributes.type) ?\n                        (child.contents ? child.contents === 'true' : null)\n                            : child.contents,\n                    options ? options.contents : undefined,\n                    child.attributes.readonly === 'true'\n                ]\n            );\n        });\n    }\n\n    vars = child.childNamed('variables');\n    if (vars) {\n        definition.variableNames = myself.loadValue(\n            vars.require('list')\n        ).asArray();\n    }\n\n    header = child.childNamed('header');\n    if (header) {\n        definition.codeHeader = header.contents;\n    }\n\n    code = child.childNamed('code');\n    if (code) {\n        definition.codeMapping = code.contents;\n    }\n\n    trans = child.childNamed('translations');\n    if (trans) {\n        definition.updateTranslations(trans.contents);\n    }\n\n    comment = child.childNamed('comment');\n    if (comment) {\n        definition.comment = this.loadComment(comment);\n    }\n\n    return definition;\n};\n\nSnapSerializer.prototype.populateCustomBlocks = function (\n    object,\n    element,\n    isGlobal\n) {\n    element.children.forEach(function (child, index) {\n        var definition = isGlobal ? object.globalBlocks[index]\n            : object.customBlocks[index];\n        this.populateCustomBlock(object, child, definition);\n    }, this);\n};\n\nSnapSerializer.prototype.populateCustomBlock = function (\n    object,\n    child,\n    definition\n) {\n    var script, scripts;\n    if (child.tag !== 'block-definition') {\n        return;\n    }\n    script = child.childNamed('script');\n    if (script) {\n        definition.body = new Context(\n            null,\n            script ? this.loadScript(script) : null,\n            null,\n            object\n        );\n        definition.body.inputs = definition.names.slice(0);\n    }\n    scripts = child.childNamed('scripts');\n    if (scripts) {\n        definition.scripts = this.loadScriptsArray(scripts, object);\n    }\n\n    delete definition.names;\n};\n\n// Loads a custom block definition that the user was in the process of editing\n// when the project was saved. This is mainly for viewing log data, but can\n// also function if a project is saved with an edit dialog open.\nSnapSerializer.prototype.loadEditing = function(\n    project, model, defaultGUID, index\n) {\n    var stage = project.stage;\n\n    // Get all custom blocks in the project\n    var allBlocks = [];\n    var allSprites = [stage].concat(stage.children);\n    allBlocks[0] = stage.customBlocks.concat(stage.globalBlocks);\n    stage.children.forEach(function(sprite, i) {\n        allBlocks[i + 1] = sprite.customBlocks;\n    });\n\n    // Backwards compatibility for when the guid was stored in <editing>\n    var guid = model.attributes.guid || defaultGUID;\n    // Find the block definition that matches the editing GUID\n    var originalDefinition = null, editingSprite = null;\n    Object.keys(allBlocks).forEach(function(sprite, i) {\n        allBlocks[sprite].forEach(function(block) {\n            if (block.guid === guid) {\n                originalDefinition = block;\n                editingSprite = allSprites[i];\n            }\n        });\n    });\n\n    if (!originalDefinition) return;\n\n    // Load the editing definition from XML\n    var editingDefinition;\n    if (model.tag === 'scripts') {\n        Trace.logErrorMessage(\n            'Skipping legacy version of editing code using script tags. ' +\n            'No longer supported. To load, use an older version of iSnap.');\n        return;\n    } else if (model.tag === 'block-definition') {\n        editingDefinition = this.loadCustomBlock(null, model,\n            originalDefinition.isGlobal);\n        this.populateCustomBlock(null, model, editingDefinition);\n        // We passed null as the parent object when constructing the definition,\n        // so we manually define the definition's receiver\n        editingDefinition.receiver = originalDefinition.receiver;\n    } else {\n        Trace.logErrorMessage('Unknown editing tag: ' + model.tag);\n        return;\n    }\n\n    // Next frame, after the project has loaded, pop up the block editor with\n    // editing code\n    setTimeout(function() {\n        Morph.prototype.trackChanges = false;\n        var editor = new BlockEditorMorph(editingDefinition, editingSprite);\n        editor.popUp();\n        // Offset the editor in case there are multiple\n        editor.setCenter(editor.center().add(index * 15));\n        Morph.prototype.trackChanges = true;\n        editor.changed();\n\n        // If the user applied changes, we swap in the original block definition\n        // for the temp copy we've loaded\n        var oldUpdate = editor.updateDefinition;\n        editor.updateDefinition = function() {\n            editor.definition = originalDefinition;\n            oldUpdate.call(editor);\n        };\n    });\n};\n\nSnapSerializer.prototype.loadScripts = function (object, scripts, model) {\n    // private\n    var scale = SyntaxElementMorph.prototype.scale;\n    scripts.cachedTexture = IDE_Morph.prototype.scriptsPaneTexture;\n    model.children.forEach(child => {\n        var element;\n        if (child.tag === 'script') {\n            element = this.loadScript(child, object);\n            if (!element) {\n                return;\n            }\n            element.setPosition(new Point(\n                (+child.attributes.x || 0) * scale,\n                (+child.attributes.y || 0) * scale\n            ).add(scripts.topLeft()));\n            scripts.add(element);\n            element.fixBlockColor(null, true); // force zebra coloring\n            element.allComments().forEach(comment => comment.align(element));\n        } else if (child.tag === 'comment') {\n            element = this.loadComment(child);\n            if (!element) {\n                return;\n            }\n            element.setPosition(new Point(\n                (+child.attributes.x || 0) * scale,\n                (+child.attributes.y || 0) * scale\n            ).add(scripts.topLeft()));\n            scripts.add(element);\n        }\n    });\n};\n\nSnapSerializer.prototype.loadScriptsArray = function (model, object) {\n    // private - answer an array containting the model's scripts\n    var scale = SyntaxElementMorph.prototype.scale,\n        scripts = [];\n    model.children.forEach(child => {\n        var element;\n        if (child.tag === 'script') {\n            element = this.loadScript(child, object);\n            if (!element) {\n                return;\n            }\n            element.setPosition(new Point(\n                (+child.attributes.x || 0) * scale,\n                (+child.attributes.y || 0) * scale\n            ));\n            scripts.push(element);\n            element.fixBlockColor(null, true); // force zebra coloring\n        } else if (child.tag === 'comment') {\n            element = this.loadComment(child);\n            if (!element) {\n                return;\n            }\n            element.setPosition(new Point(\n                (+child.attributes.x || 0) * scale,\n                (+child.attributes.y || 0) * scale\n            ));\n            scripts.push(element);\n        }\n    });\n    return scripts;\n};\n\nSnapSerializer.prototype.loadScript = function (model, object) {\n    // private\n    var topBlock, block, nextBlock;\n\n    // Check whether we're importing a single script, not a script as part of a\n    // whole project\n    if (!this.project.stage) {\n        this.project.stage = object.parentThatIsA(StageMorph);\n        this.project.targetStage = this.project.stage;\n    }\n\n    model.children.forEach(child => {\n        nextBlock = this.loadBlock(child, false, object);\n        if (!nextBlock) {\n            return;\n        }\n        if (block) {\n            if (block.nextBlock && (nextBlock instanceof CommandBlockMorph)) {\n                block.nextBlock(nextBlock);\n            } else {\n                console.log(\n                    'SNAP: expecting a command but getting a reporter:\\n' +\n                        '  ' + block.blockSpec + '\\n' +\n                        '  ' + nextBlock.blockSpec\n                );\n                return topBlock;\n            }\n        } else {\n            topBlock = nextBlock;\n        }\n        block = nextBlock;\n    });\n    return topBlock;\n};\n\nSnapSerializer.prototype.loadComment = function (model) {\n    // private\n    var comment = new CommentMorph(model.contents),\n        scale = SyntaxElementMorph.prototype.scale;\n    comment.isCollapsed = (model.attributes.collapsed === 'true');\n    comment.setTextWidth(+model.attributes.w * scale);\n    return comment;\n};\n\nSnapSerializer.prototype.setBlockId = function (model, block) {\n    var id = parseInt(model.attributes['blockID']);\n    if (isNaN(id)) return;\n    block.id = id;\n    BlockMorph.nextId = Math.max(BlockMorph.nextId, id + 1);\n}\n\nSnapSerializer.prototype.loadBlock = function (model, isReporter, object) {\n    // private\n    var block, info, inputs, isGlobal, receiver, migration,\n        migrationOffset = 0;\n\n    if (model.tag === 'block') {\n        if (Object.prototype.hasOwnProperty.call(\n                model.attributes,\n                'var'\n            )) {\n            block = SpriteMorph.prototype.variableBlock(\n                model.attributes['var']\n            );\n        } else {\n        /*\n        // disable JavaScript functions, commented out for now\n        if (model.attributes.s === 'reportJSFunction' &&\n                !Process.prototype.enableJS) {\n            if (window.confirm('enable JavaScript?')) {\n                Process.prototype.enableJS = true;\n            } else {\n                throw new Error('JavaScript is not enabled');\n            }\n        }\n        */\n            block = SpriteMorph.prototype.blockForSelector(model.attributes.s);\n            migration = SpriteMorph.prototype.blockMigrations[\n                model.attributes.s\n            ];\n            if (migration) {\n                migrationOffset = migration.offset;\n            }\n        }\n    } else if (model.tag === 'custom-block') {\n        isGlobal = model.attributes.scope ? false : true;\n        receiver = isGlobal ? this.project.stage : object;\n        if (isGlobal) {\n            info = detect(\n                receiver.globalBlocks,\n                block => block.blockSpec() === model.attributes.s\n            );\n            if (!info && this.project.targetStage) { // importing block files\n                info = detect(\n                    this.project.targetStage.globalBlocks,\n                    block => block.blockSpec() === model.attributes.s\n                );\n            }\n        } else {\n            // lookup in inherited methods\n            info = detect(\n                receiver.customBlocks,\n                block => block.blockSpec() === model.attributes.s\n            ) || (\n            \treceiver.inheritedMethodsCache ?\n                \tdetect(\n                        receiver.inheritedMethodsCache,\n                        block => block.blockSpec() === model.attributes.s\n                \t)\n          \t\t: null\n          \t);\n        }\n        if (!info || !contains(\n        \t\t// catch other forks' blocks\n        \t\tSpriteMorph.prototype.categories, info.category\n        )) {\n            return this.obsoleteBlock(isReporter);\n        }\n        block = info.type === 'command' ? new CustomCommandBlockMorph(\n            info,\n            false\n        ) : new CustomReporterBlockMorph(\n            info,\n            info.type === 'predicate',\n            false\n        );\n    }\n    if (block === null) {\n        block = this.obsoleteBlock(isReporter);\n    }\n    SnapSerializer.prototype.setBlockId(model, block);\n    block.isDraggable = true;\n    inputs = block.inputs();\n    model.children.forEach((child, i) => {\n        if (child.tag === 'variables') {\n            this.loadVariables(block.variables, child, object);\n        } else if (child.tag === 'comment') {\n            block.comment = this.loadComment(child);\n            block.comment.block = block;\n        } else if (child.tag === 'receiver') {\n            nop(); // ignore\n        } else {\n            this.loadInput(child, inputs[i + migrationOffset], block, object);\n        }\n    });\n    block.cachedInputs = null;\n    return block;\n};\n\nSnapSerializer.prototype.obsoleteBlock = function (isReporter) {\n    // private\n    var block = isReporter ? new ReporterBlockMorph()\n            : new CommandBlockMorph();\n    block.selector = 'errorObsolete';\n    block.color = new Color(200, 0, 20);\n    block.setSpec('Obsolete!');\n    block.isDraggable = true;\n    return block;\n};\n\nSnapSerializer.prototype.loadInput = function (model, input, block, object) {\n    // private\n    var inp, val;\n    if (isNil(input)) {\n        return;\n    }\n    if (model.tag === 'script') {\n        inp = this.loadScript(model, object);\n        if (inp) {\n            if (block.selector === 'reifyReporter' ||\n                    block.selector === 'reifyPredicate') {\n                input.replaceInput(input.children[0], inp);\n                input.fixLayout();\n            } else {\n                input.add(inp);\n                input.fixLayout();\n            }\n        }\n    } else if (model.tag === 'autolambda' && model.children[0]) {\n        inp = this.loadBlock(model.children[0], true, object);\n        if (inp) {\n            input.replaceInput(input.children[0], inp);\n            input.fixLayout();\n        }\n    } else if (model.tag === 'list') {\n        while (input.inputs().length > 0) {\n            input.removeInput();\n        }\n        model.children.forEach(item => {\n            input.addInput();\n            this.loadInput(\n                item,\n                input.children[input.children.length - 2],\n                input,\n                object\n            );\n        });\n        input.fixLayout();\n    } else if (model.tag === 'block' || model.tag === 'custom-block') {\n//        block.silentReplaceInput(input, this.loadBlock(model, true, object));\n        block.replaceInput(input, this.loadBlock(model, true, object));\n    } else if (model.tag === 'color') {\n        input.setColor(this.loadColor(model.contents));\n    } else {\n        val = this.loadValue(model);\n        if (!isNil(val) && !isNil(input) && input.setContents) {\n            // checking whether \"input\" is nil should not\n            // be necessary, but apparently is after retina support\n            // was added.\n            input.setContents(this.loadValue(model));\n        }\n    }\n};\n\nSnapSerializer.prototype.loadValue = function (model, object) {\n    // private\n    var v, i, lst, items, el, center, image, name, audio, option, bool, origin,\n    \twish, def,\n        myself = this;\n\n    function record() {\n        if (Object.prototype.hasOwnProperty.call(\n                model.attributes,\n                'id'\n            )) {\n            myself.objects[model.attributes.id] = v;\n        }\n        if (Object.prototype.hasOwnProperty.call(\n                model.attributes,\n                'mediaID'\n            )) {\n            myself.mediaDict[model.attributes.mediaID] = v;\n        }\n    }\n\n    switch (model.tag) {\n    case 'ref':\n        if (Object.prototype.hasOwnProperty.call(model.attributes, 'id')) {\n            return this.objects[model.attributes.id];\n        }\n        if (Object.prototype.hasOwnProperty.call(\n                model.attributes,\n                'mediaID'\n            )) {\n            return this.mediaDict[model.attributes.mediaID];\n        }\n        throw new Error('expecting a reference id');\n    case 'l':\n        option = model.childNamed('option');\n        if (option) {\n            return [option.contents];\n        }\n        bool = model.childNamed('bool');\n        if (bool) {\n            return this.loadValue(bool);\n        }\n        wish = model.childNamed('wish');\n        if (wish) {\n            return this.loadValue(wish);\n        }\n        return model.contents;\n    case 'bool':\n        return model.contents === 'true';\n    case 'list':\n        if (model.attributes.hasOwnProperty('linked')) {\n            if (model.attributes.struct === 'atomic') {\n                v = Process.prototype.parseCSV(model.contents);\n                v.becomeLinked();\n                record();\n                return v;\n            }\n            v = new List();\n            v.isLinked = true;\n            record();\n            lst = v;\n            items = model.childrenNamed('item');\n            items.forEach((item, i) => {\n                var value = item.children[0];\n                if (!value) {\n                    v.first = 0;\n                } else {\n                    v.first = this.loadValue(value, object);\n                }\n                var tail = model.childNamed('list') ||\n                    model.childNamed('ref');\n                if (tail) {\n                    v.rest = this.loadValue(tail, object);\n                } else {\n                    if (i < (items.length - 1)) {\n                        v.rest = new List();\n                        v = v.rest;\n                        v.isLinked = true;\n                    }\n                }\n            });\n            return lst;\n        }\n        if (model.attributes.struct === 'atomic') {\n            v = Process.prototype.parseCSV(model.contents);\n            record();\n            return v;\n        }\n        v = new List();\n        record();\n        v.contents = model.childrenNamed('item').map(item => {\n            var value = item.children[0];\n            if (!value) {\n                return 0;\n            }\n            return this.loadValue(value, object);\n        });\n        return v;\n    case 'sprite':\n        v  = new SpriteMorph(this.project.globalVariables);\n        if (model.attributes.id) {\n            this.objects[model.attributes.id] = v;\n        }\n        if (model.attributes.name) {\n            v.name = model.attributes.name;\n            this.project.sprites[model.attributes.name] = v;\n        }\n        if (model.attributes.idx) {\n            v.idx = +model.attributes.idx;\n        }\n        if (model.attributes.color) {\n            v.color = this.loadColor(model.attributes.color);\n            v.cachedHSV = v.color.hsv();\n        }\n        if (model.attributes.pen) {\n            v.penPoint = model.attributes.pen;\n        }\n        if (model.attributes.volume) {\n            v.volume = +model.attributes.volume;\n        }\n        if (model.attributes.pan) {\n            v.pan = +model.attributes.pan;\n        }\n        this.project.stage.add(v);\n        v.scale = parseFloat(model.attributes.scale || '1');\n        v.rotationStyle = parseFloat(\n            model.attributes.rotation || '1'\n        );\n        v.isDraggable = model.attributes.draggable !== 'false';\n        v.isVisible = model.attributes.hidden !== 'true';\n        v.heading = parseFloat(model.attributes.heading) || 0;\n        v.gotoXY(+model.attributes.x || 0, +model.attributes.y || 0);\n        this.loadObject(v, model);\n        v.fixLayout();\n\n        return v;\n    case 'context':\n        v = new Context(null);\n        record();\n        el = model.childNamed('origin');\n        if (el) {\n            el = el.childNamed('ref') || el.childNamed('sprite');\n            if (el) {\n                v.origin = this.loadValue(el);\n            }\n        }\n        el = model.childNamed('receiver');\n        if (el) {\n            el = el.childNamed('ref') || el.childNamed('sprite');\n            if (el) {\n                v.receiver = this.loadValue(el);\n            }\n        }\n        origin = v.origin || v.receiver || object; // for local blocks look up\n        el = model.childNamed('script');\n        if (el) {\n            v.expression = this.loadScript(el, origin);\n        } else {\n            el = model.childNamed('block') ||\n                model.childNamed('custom-block');\n            if (el) {\n                v.expression = this.loadBlock(el, null, origin);\n            } else {\n                el = model.childNamed('l');\n                if (el) {\n                    bool = el.childNamed('bool');\n                    if (bool) {\n                        v.expression = new BooleanSlotMorph(\n                            this.loadValue(bool)\n                        );\n                    } else {\n                        v.expression = new InputSlotMorph(el.contents);\n                    }\n                }\n            }\n        }\n        if (v.expression instanceof BlockMorph) {\n            // bind empty slots to implicit formal parameters\n            i = 0;\n            v.expression.allEmptySlots().forEach(slot => {\n                i += 1;\n                if (slot instanceof MultiArgMorph) {\n                    slot.bindingID = ['arguments'];\n                } else {\n                    slot.bindingID = i;\n                }\n            });\n            // and remember the number of detected empty slots\n            v.emptySlots = i;\n        }\n        el = model.childNamed('inputs');\n        if (el) {\n            el.children.forEach(item => {\n                if (item.tag === 'input') {\n                    v.inputs.push(item.contents);\n                }\n            });\n        }\n        el = model.childNamed('variables');\n        if (el) {\n            this.loadVariables(v.variables, el, origin);\n        }\n        el = model.childNamed('context');\n        if (el) {\n            v.outerContext = this.loadValue(el, origin);\n        }\n        if (v.outerContext && v.receiver &&\n                !v.outerContext.variables.parentFrame) {\n            v.outerContext.variables.parentFrame = v.receiver.variables;\n        }\n        return v;\n    case 'costume':\n        center = new Point();\n        if (Object.prototype.hasOwnProperty.call(\n                model.attributes,\n                'center-x'\n            )) {\n            center.x = parseFloat(model.attributes['center-x']);\n        }\n        if (Object.prototype.hasOwnProperty.call(\n                model.attributes,\n                'center-y'\n            )) {\n            center.y = parseFloat(model.attributes['center-y']);\n        }\n        if (Object.prototype.hasOwnProperty.call(\n                model.attributes,\n                'name'\n            )) {\n            name = model.attributes.name;\n        }\n        if (Object.prototype.hasOwnProperty.call(\n                model.attributes,\n                'image'\n            )) {\n            image = new Image();\n            if (model.attributes.image.indexOf('data:image/svg+xml') === 0\n                    && !MorphicPreferences.rasterizeSVGs) {\n                v = new SVG_Costume(null, name, center);\n                image.onload = function () {\n                    v.contents = image;\n                    v.version = +new Date();\n                    if (typeof v.loaded === 'function') {\n                        v.loaded();\n                    } else {\n                        v.loaded = true;\n                    }\n                };\n            } else {\n                v = new Costume(null, name, center);\n                image.onload = function () {\n                    var canvas = newCanvas(\n                            new Point(image.width, image.height),\n                            true // nonRetina\n                        ),\n                        context = canvas.getContext('2d');\n                    context.drawImage(image, 0, 0);\n                    v.contents = canvas;\n                    v.version = +new Date();\n                    if (typeof v.loaded === 'function') {\n                        v.loaded();\n                    } else {\n                        v.loaded = true;\n                    }\n                };\n            }\n            image.src = model.attributes.image;\n        }\n        record();\n        return v;\n    case 'sound':\n        audio = new Audio();\n        v = new Sound(audio, model.attributes.name);\n        audio.oncanplaythrough = () => v.loaded = true;\n        audio.src = model.attributes.sound;\n        if (Object.prototype.hasOwnProperty.call(\n                model.attributes,\n                'mediaID'\n            )) {\n            this.mediaDict[model.attributes.mediaID] = v;\n        }\n        record();\n        return v;\n    case 'wish':\n    \tdef = new CustomBlockDefinition(model.attributes.s);\n     \tdef.type = model.attributes.type;\n      \tdef.category = model.attributes.category;\n       \tdef.storedSemanticSpec = model.attributes.s;\n        def.updateTranslations(model.contents);\n        return def.blockInstance(true); // include translations\n    }\n    return undefined;\n};\n\nSnapSerializer.prototype.loadColor = function (colorString) {\n    // private\n    var c = (colorString || '').split(',');\n    return new Color(\n        parseFloat(c[0]),\n        parseFloat(c[1]),\n        parseFloat(c[2]),\n        parseFloat(c[3])\n    );\n};\n\nSnapSerializer.prototype.openProject = function (project, ide) {\n    var stage = ide.stage,\n        sprites = [],\n        sprite;\n    if (!project || !project.stage) {\n        return;\n    }\n    ide.siblings().forEach(morph =>\n        morph.destroy()\n    );\n    ide.projectName = project.name;\n    ide.projectNotes = project.notes || '';\n    ide.setProjectData(project.data || '');\n    if (ide.globalVariables) {\n        ide.globalVariables = project.globalVariables;\n    }\n    if (stage) {\n        stage.destroy();\n    }\n    ide.add(project.stage);\n    ide.stage = project.stage;\n    sprites = ide.stage.children.filter(\n        child => child instanceof SpriteMorph\n    );\n    sprites.sort((x, y) => x.idx - y.idx);\n\n    ide.sprites = new List(sprites);\n    sprite = sprites[0] || project.stage;\n\n    if (sizeOf(this.mediaDict) > 0) {\n        ide.hasChangedMedia = false;\n        this.mediaDict = {};\n    } else {\n        ide.hasChangedMedia = true;\n    }\n    project.stage.fixLayout();\n    project.stage.pauseGenericHatBlocks();\n    ide.createCorral();\n    ide.selectSprite(sprite);\n    ide.fixLayout();\n    ide.world().keyboardFocus = project.stage;\n};\n\n// SnapSerializer XML-representation of objects:\n\n// Generics\n\nArray.prototype.toXML = function (serializer) {\n    return this.reduce(\n        (xml, item) => xml + serializer.store(item),\n        ''\n    );\n};\n\n// Sprites\n\nStageMorph.prototype.toXML = function (serializer) {\n    var thumbnail = serializer.excludeMedia ? '' :\n            normalizeCanvas(\n                this.thumbnail(SnapSerializer.prototype.thumbnailSize),\n                true\n            ),\n        thumbdata,\n        costumeIdx = this.getCostumeIdx(),\n        ide = this.parentThatIsA(IDE_Morph);\n\n    // catch cross-origin tainting exception when using SVG costumes\n    try {\n        thumbdata =  serializer.excludeMedia ? null :\n            thumbnail.toDataURL('image/png');\n    } catch (error) {\n        thumbdata = null;\n    }\n\n    function code(key) {\n        var str = '';\n        Object.keys(StageMorph.prototype[key]).forEach(\n            selector => {\n                str += (\n                    '<' + selector + '>' +\n                        XML_Element.prototype.escape(\n                            StageMorph.prototype[key][selector]\n                        ) +\n                        '</' + selector + '>'\n                );\n            }\n        );\n        return str;\n    }\n\n    this.removeAllClones();\n\n    // If the user is currently editing a custom block, we add it to the XML.\n\n    var makeEditingBlock = function() {\n        var editingBlocks = BlockEditorMorph.showing.map(function(editor) {\n            if (!editor.definition) {\n                return '';\n            }\n            var definition = editor.definition.copyAndBindTo();\n            editor.applyToDefinition(definition);\n            return definition.toXML(serializer);\n        });\n        return serializer.format(\n            '<editing>%</editing>',\n            editingBlocks.join()\n        );\n    };\n\n    var projectData = ide ? JSON.stringify(ide.getProjectData()) : '';\n    return serializer.format(\n        '<project name=\"@\" app=\"@\" version=\"@\" guid=\"@\" assignment=\"@\">' +\n            '<data>$</data>' +\n            '<notes>$</notes>' +\n            '<thumbnail>$</thumbnail>' +\n            '<stage name=\"@\" width=\"@\" height=\"@\" ' +\n            'costume=\"@\" color=\"@,@,@,@\" tempo=\"@\" threadsafe=\"@\" ' +\n            'penlog=\"@\" ' +\n            '%' +\n            'volume=\"@\" ' +\n            'pan=\"@\" ' +\n            'lines=\"@\" ' +\n            'ternary=\"@\" ' +\n            'hyperops=\"@\" ' +\n            'codify=\"@\" ' +\n            'inheritance=\"@\" ' +\n            'sublistIDs=\"@\" ' +\n            'scheduled=\"@\" ~>' +\n            '<pentrails>$</pentrails>' +\n            '%' + // current costume, if it's not in the wardrobe\n            '<costumes>%</costumes>' +\n            '<sounds>%</sounds>' +\n            '<variables>%</variables>' +\n            '<blocks>%</blocks>' +\n            '<scripts>%</scripts><sprites>%</sprites>' +\n            '</stage>' +\n            '<hidden>$</hidden>' +\n            '<headers>%</headers>' +\n            '<code>%</code>' +\n            '<blocks>%</blocks>' +\n            '<variables>%</variables>' +\n            '%' +\n            '</project>',\n        (ide && ide.projectName) ? ide.projectName : localize('Untitled'),\n        serializer.app,\n        serializer.version,\n        this.guid,\n        this.assignment,\n        projectData,\n        (ide && ide.projectNotes) ? ide.projectNotes : '',\n        thumbdata,\n        this.name,\n        StageMorph.prototype.dimensions.x,\n        StageMorph.prototype.dimensions.y,\n        costumeIdx,\n        this.color.r,\n        this.color.g,\n        this.color.b,\n        this.color.a,\n        this.getTempo(),\n        this.isThreadSafe,\n        this.enablePenLogging,\n        this.instrument ?\n                ' instrument=\"' + parseInt(this.instrument) + '\" ' : '',\n        this.volume,\n        this.pan,\n        SpriteMorph.prototype.useFlatLineEnds ? 'flat' : 'round',\n        BooleanSlotMorph.prototype.isTernary,\n        Process.prototype.enableHyperOps === true,\n        this.enableCodeMapping,\n        this.enableInheritance,\n        this.enableSublistIDs,\n        StageMorph.prototype.frameRate !== 0,\n        serializer.excludeMedia ? '' :\n            normalizeCanvas(this.trailsCanvas, true).toDataURL('image/png'),\n\n        // current costume, if it's not in the wardrobe\n        !costumeIdx && this.costume && !serializer.excludeMedia ?\n            '<wear>' + serializer.store(this.costume) + '</wear>'\n                : '',\n\n        serializer.store(this.costumes, this.name + '_cst'),\n        serializer.store(this.sounds, this.name + '_snd'),\n        serializer.store(this.variables),\n        serializer.store(this.customBlocks),\n        serializer.store(this.scripts),\n        serializer.store(this.children),\n        Object.keys(StageMorph.prototype.hiddenPrimitives).reduce(\n                (a, b) => a + ' ' + b,\n                ''\n            ),\n        code('codeHeaders'),\n        code('codeMappings'),\n        serializer.store(this.globalBlocks),\n        (ide && ide.globalVariables) ?\n                    serializer.store(ide.globalVariables) : '',\n        makeEditingBlock()\n    );\n};\n\nSpriteMorph.prototype.toXML = function (serializer) {\n    var stage = this.parentThatIsA(StageMorph),\n        ide = stage ? stage.parentThatIsA(IDE_Morph) : null,\n        idx = ide ? ide.sprites.asArray().indexOf(this) + 1 : 0,\n        costumeIdx = this.getCostumeIdx(),\n        noCostumes = this.inheritsAttribute('costumes'),\n        noSounds = this.inheritsAttribute('sounds'),\n        noScripts = this.inheritsAttribute('scripts');\n\n    return serializer.format(\n        '<sprite name=\"@\" idx=\"@\" x=\"@\" y=\"@\"' +\n            ' heading=\"@\"' +\n            ' scale=\"@\"' +\n            ' volume=\"@\"' +\n            ' pan=\"@\"' +\n            ' rotation=\"@\"' +\n            '%' +\n            ' draggable=\"@\"' +\n            '%' +\n            ' costume=\"@\" color=\"@,@,@,@\" pen=\"@\" ~>' +\n            '%' + // inheritance info\n            '%' + // nesting info\n            '%' + // current costume\n            (noCostumes ? '%' : '<costumes>%</costumes>') +\n            (noSounds ? '%' : '<sounds>%</sounds>') +\n            '<blocks>%</blocks>' +\n            '<variables>%</variables>' +\n            (this.exemplar ? '<dispatches>%</dispatches>' : '%') +\n            (noScripts ? '%' : '<scripts>%</scripts>') +\n            '</sprite>',\n        this.name,\n        idx,\n        this.xPosition(),\n        this.yPosition(),\n        this.heading,\n        this.scale,\n        this.volume,\n        this.pan,\n        this.rotationStyle,\n        this.instrument ?\n                ' instrument=\"' + parseInt(this.instrument) + '\" ' : '',\n        this.isDraggable,\n        this.isVisible ? '' : ' hidden=\"true\"',\n        costumeIdx,\n        this.color.r,\n        this.color.g,\n        this.color.b,\n        this.color.a,\n        this.penPoint,\n\n        // inheritance info\n        this.exemplar\n            ? '<inherit exemplar=\"' +\n                    this.exemplar.name +\n                    '\">' +\n                    (this.inheritedAttributes.length ?\n                        serializer.store(new List(this.inheritedAttributes))\n                        : '') +\n                    '</inherit>'\n            : '',\n\n        // nesting info\n        this.anchor\n            ? '<nest anchor=\"' +\n                    this.anchor.name +\n                    '\" synch=\"'\n                    + this.rotatesWithAnchor\n                    + (this.scale === this.nestingScale ? '' :\n                            '\"'\n                            + ' scale=\"'\n                            + this.nestingScale)\n\n                    + '\"/>'\n            : '',\n\n        // current costume, if it's not in the wardrobe\n        !costumeIdx && this.costume ?\n            '<wear>' + serializer.store(this.costume) + '</wear>'\n                : '',\n\n        noCostumes ? '' : serializer.store(this.costumes, this.name + '_cst'),\n        noSounds ? '' : serializer.store(this.sounds, this.name + '_snd'),\n        !this.customBlocks ? '' : serializer.store(this.customBlocks),\n        serializer.store(this.variables),\n        this.exemplar ? serializer.store(this.inheritedMethods()) : '',\n        noScripts ? '' : serializer.store(this.scripts)\n    );\n};\n\nCostume.prototype[XML_Serializer.prototype.mediaDetectionProperty] = true;\n\nCostume.prototype.toXML = function (serializer) {\n    return serializer.format(\n        '<costume name=\"@\" center-x=\"@\" center-y=\"@\" image=\"@\" ~/>',\n        this.name,\n        this.rotationCenter.x,\n        this.rotationCenter.y,\n        serializer.excludeMedia ? '' :\n            this instanceof SVG_Costume ?\n                (this.contents ? this.contents.src : '')\n                : normalizeCanvas(this.contents).toDataURL('image/png')\n    );\n};\n\nSound.prototype[XML_Serializer.prototype.mediaDetectionProperty] = true;\n\nSound.prototype.toXML = function (serializer) {\n    return serializer.format(\n        '<sound name=\"@\" sound=\"@\" ~/>',\n        this.name,\n        serializer.excludeMedia ? '' : this.toDataURL()\n    );\n};\n\nVariableFrame.prototype.toXML = function (serializer) {\n    return Object.keys(this.vars).reduce((vars, v) => {\n        var val = this.vars[v].value,\n            dta;\n        if (this.vars[v].isTransient) {\n            dta = serializer.format(\n                '<variable name=\"@\" transient=\"true\"/>',\n                v)\n            ;\n        } else if (val === undefined || val === null) {\n            dta = serializer.format('<variable name=\"@\"/>', v);\n        } else {\n            dta = serializer.format(\n                '<variable name=\"@\">%</variable>',\n                v,\n                typeof val === 'object' ?\n                        (isSnapObject(val) ? ''\n                                : serializer.store(val))\n                                : typeof val === 'boolean' ?\n                                        serializer.format(\n                                            '<bool>$</bool>', val\n                                        )\n                                        : serializer.format('<l>$</l>', val)\n            );\n        }\n        return vars + dta;\n    }, '');\n};\n\n// Watchers\n\nWatcherMorph.prototype.toXML = function (serializer) {\n    var isVar = this.target instanceof VariableFrame,\n        isList = this.currentValue instanceof List,\n        color = this.readoutColor,\n        position = this.parent ?\n                this.topLeft().subtract(this.parent.topLeft())\n                : this.topLeft();\n\n    if (this.isTemporary()) {\n        // do not save watchers on temporary variables\n        return '';\n    }\n    return serializer.format(\n        '<watcher% % style=\"@\"% x=\"@\" y=\"@\" color=\"@,@,@\"%%/>',\n        (isVar && this.target.owner) || (!isVar && this.target) ?\n                    serializer.format(' scope=\"@\"',\n                        isVar ? this.target.owner.name : this.target.name)\n                            : '',\n        serializer.format(isVar ? 'var=\"@\"' : 's=\"@\"', this.getter),\n        this.style,\n        isVar && this.style === 'slider' ? serializer.format(\n                ' min=\"@\" max=\"@\"',\n                this.sliderMorph.start,\n                this.sliderMorph.stop\n            ) : '',\n        position.x,\n        position.y,\n        color.r,\n        color.g,\n        color.b,\n        !isList ? ''\n                : serializer.format(\n                ' extX=\"@\" extY=\"@\"',\n                this.cellMorph.contentsMorph.width(),\n                this.cellMorph.contentsMorph.height()\n            ),\n        this.isVisible ? '' : ' hidden=\"true\"'\n    );\n};\n\n// Scripts\n\nScriptsMorph.prototype.toXML = function (serializer) {\n    return this.children.reduce((xml, child) => {\n        if (child instanceof BlockMorph) {\n            return xml + child.toScriptXML(serializer, true);\n        }\n        if (child instanceof CommentMorph && !child.block) { // unattached\n            return xml + child.toXML(serializer);\n        }\n        return xml;\n    }, '');\n};\n\nBlockMorph.prototype.toXML = BlockMorph.prototype.toScriptXML = function (\n    serializer,\n    savePosition\n) {\n    var position,\n        xml,\n        scale = SyntaxElementMorph.prototype.scale,\n        block = this;\n\n    // determine my position\n    if (this.parent) {\n        position = this.topLeft().subtract(this.parent.topLeft());\n    } else {\n        position = this.topLeft();\n    }\n\n    // save my position to xml\n    if (savePosition) {\n        xml = serializer.format(\n            '<script x=\"@\" y=\"@\">',\n            position.x / scale,\n            position.y / scale\n        );\n    } else {\n        xml = '<script>';\n    }\n\n    // recursively add my next blocks to xml\n    do {\n        xml += block.toBlockXML(serializer);\n        block = block.nextBlock();\n    } while (block);\n    xml += '</script>';\n    return xml;\n};\n\nBlockMorph.prototype.toBlockXML = function (serializer) {\n    return serializer.format(\n        '<block blockID=\"@\" s=\"@\">%%</block>',\n        this.id,\n        this.selector,\n        serializer.store(this.inputs()),\n        this.comment ? this.comment.toXML(serializer) : ''\n    );\n};\n\nReporterBlockMorph.prototype.toXML = function (serializer) {\n    if (this.selector === 'reportGetVar') {\n        if (!this.comment) {\n            return serializer.format(\n                '<block id=\"@\" var=\"@\"/>',\n                this.id,\n                this.blockSpec);\n        } else {\n            return serializer.format(\n                '<block id=\"@\" var=\"@\">%</block>',\n                this.id,\n                this.blockSpec,\n                this.comment.toXML(serializer));\n        }\n    } else {\n        return this.toBlockXML(serializer);\n    }\n};\n\nReporterBlockMorph.prototype.toScriptXML = function (\n    serializer,\n    savePosition\n) {\n    var position,\n        scale = SyntaxElementMorph.prototype.scale;\n\n    // determine my save-position\n    if (this.parent) {\n        position = this.topLeft().subtract(this.parent.topLeft());\n    } else {\n        position = this.topLeft();\n    }\n\n    if (savePosition) {\n        return serializer.format(\n            '<script x=\"@\" y=\"@\">%</script>',\n            position.x / scale,\n            position.y / scale,\n            this.toXML(serializer)\n        );\n    }\n    return serializer.format('<script>%</script>', this.toXML(serializer));\n};\n\nCustomCommandBlockMorph.prototype.toBlockXML = function (serializer) {\n    var scope = this.isGlobal ? undefined : 'local';\n    return serializer.format(\n        '<custom-block id=\"@\" s=\"@\"%>%%%%</custom-block>',\n        this.id,\n        this.semanticSpec,\n        this.isGlobal ?\n                '' : serializer.format(' scope=\"@\"', scope),\n        serializer.store(this.inputs()),\n        this.isGlobal &&\n        \tthis.definition.variableNames.length &&\n            !serializer.isExportingBlocksLibrary ?\n                '<variables>' +\n                    this.variables.toXML(serializer) +\n                    '</variables>'\n                        : '',\n        this.comment ? this.comment.toXML(serializer) : ''\n    );\n};\n\nCustomReporterBlockMorph.prototype.toBlockXML\n    = CustomCommandBlockMorph.prototype.toBlockXML;\n\nCustomBlockDefinition.prototype.toXML = function (serializer) {\n    function encodeScripts(array) {\n        return array.reduce((xml, element) => {\n            if (element instanceof BlockMorph) {\n                return xml + element.toScriptXML(serializer, true);\n            }\n            if (element instanceof CommentMorph && !element.block) {\n                return xml + element.toXML(serializer);\n            }\n            return xml;\n        }, '');\n    }\n\n    return serializer.format(\n        '<block-definition s=\"@\" type=\"@\" category=\"@\" guid=\"@\" isImported=\"@\">' +\n           '%' +\n            (this.variableNames.length ? '<variables>%</variables>' : '@') +\n            '<header>@</header>' +\n            '<code>@</code>' +\n            '<translations>@</translations>' +\n            '<inputs>%</inputs>%%' +\n            '</block-definition>',\n        this.spec,\n        this.type,\n        this.category || 'other',\n        this.guid,\n        this.isImported,\n        this.comment ? this.comment.toXML(serializer) : '',\n        (this.variableNames.length ?\n                serializer.store(new List(this.variableNames)) : ''),\n        this.codeHeader || '',\n        this.codeMapping || '',\n        this.translationsAsText(),\n        Array.from(this.declarations.keys()).reduce((xml, decl) => {\n            // to be refactored now that we've moved to ES6 Map:\n                return xml + serializer.format(\n                    '<input type=\"@\"$>$%</input>',\n                    this.declarations.get(decl)[0],\n                    this.declarations.get(decl)[3] ?\n                            ' readonly=\"true\"' : '',\n                    this.declarations.get(decl)[1],\n                    this.declarations.get(decl)[2] ?\n                            serializer.format(\n                                '<options>@</options>',\n                                this.declarations.get(decl)[2]\n                            ) : ''\n                );\n            }, ''),\n        this.body ? serializer.store(this.body.expression) : '',\n        this.scripts.length > 0 ?\n                    '<scripts>' + encodeScripts(this.scripts) + '</scripts>'\n                        : ''\n    );\n};\n\n// Scripts - Inputs\n\nArgMorph.prototype.toXML = function () {\n    return '<l/>'; // empty by default\n};\n\nBooleanSlotMorph.prototype.toXML = function () {\n    return (typeof this.value === 'boolean') ?\n            '<l><bool>' + this.value + '</bool></l>'\n                    : '<l/>';\n\n};\n\nInputSlotMorph.prototype.toXML = function (serializer) {\n\tif (this.selectedBlock) {\n \t\treturn serializer.format(\n        \t'<l><wish s=\"@\" type=\"@\" category=\"@\">@</wish></l>',\n            this.selectedBlock.semanticSpec,\n         \tthis.selectedBlock instanceof CommandBlockMorph ? 'command'\n          \t\t: (this.selectedBlock.isPredicate ? 'predicate' : 'reporter'),\n            this.selectedBlock.category,\n            this.selectedBlock.storedTranslations\n        );\n \t}\n    if (this.constant) {\n        return serializer.format(\n            '<l><option>$</option></l>',\n            this.constant\n        );\n    }\n    return serializer.format('<l>$</l>', this.contents().text);\n};\n\nTemplateSlotMorph.prototype.toXML = function (serializer) {\n    return serializer.format('<l>$</l>', this.contents());\n};\n\nCommandSlotMorph.prototype.toXML = function (serializer) {\n    var block = this.nestedBlock();\n    if (block instanceof BlockMorph) {\n        if (block instanceof ReporterBlockMorph) {\n            return serializer.format(\n                '<autolambda>%</autolambda>',\n                serializer.store(block)\n            );\n        }\n        return serializer.store(block);\n    }\n    return '<script></script>';\n};\n\nFunctionSlotMorph.prototype.toXML = CommandSlotMorph.prototype.toXML;\n\nMultiArgMorph.prototype.toXML = function (serializer) {\n    return serializer.format(\n        '<list>%</list>',\n        serializer.store(this.inputs())\n    );\n};\n\nArgLabelMorph.prototype.toXML = function (serializer) {\n    return serializer.format(\n        '%',\n        serializer.store(this.inputs()[0])\n    );\n};\n\nColorSlotMorph.prototype.toXML = function (serializer) {\n    return serializer.format(\n        '<color>$,$,$,$</color>',\n        this.color.r,\n        this.color.g,\n        this.color.b,\n        this.color.a\n    );\n};\n\n// Values\n\nList.prototype.toXML = function (serializer, mediaContext) {\n    // mediaContext is an optional name-stub\n    // when collecting media into a separate module\n    var xml, value, item;\n\n    if (this.hasOnlyAtomicData() &&\n            (!this.isLinked || !StageMorph.prototype.enableSublistIDs)) {\n        // special case for a less cluttered format\n        return serializer.format(\n            '<list struct=\"atomic\" ' +\n                (this.isLinked ? 'linked=\"linked\" ' : '') +\n                '~>@</list>',\n            this.asCSV()\n        );\n    }\n\n    if (this.isLinked) {\n        xml = '<list linked=\"linked\" ~>';\n        if (StageMorph.prototype.enableSublistIDs) {\n            // recursively nest tails:\n            value = this.first;\n            if (!isNil(value)) {\n                xml += serializer.format(\n                    '<item>%</item>',\n                    typeof value === 'object' ?\n                            (isSnapObject(value) ? ''\n                                    : serializer.store(value, mediaContext))\n                            : typeof value === 'boolean' ?\n                                    serializer.format('<bool>$</bool>', value)\n                                    : serializer.format('<l>$</l>', value)\n                );\n            }\n            if (!isNil(this.rest)) {\n                xml += serializer.store(this.rest, mediaContext);\n            }\n            return xml + '</list>';\n        }\n        // else sequentially serialize tails:\n        item = this;\n        do {\n            value = item.first;\n            if (!isNil(value)) {\n                xml += serializer.format(\n                    '<item>%</item>',\n                    typeof value === 'object' ?\n                            (isSnapObject(value) ? ''\n                                    : serializer.store(value, mediaContext))\n                            : typeof value === 'boolean' ?\n                                    serializer.format('<bool>$</bool>', value)\n                                    : serializer.format('<l>$</l>', value)\n                );\n            }\n            item = item.rest;\n        } while (!isNil(item));\n        return xml + '</list>';\n    }\n    // dynamic array:\n    return serializer.format(\n        '<list ~>%</list>',\n        this.contents.reduce((xml, item) => {\n            return xml + serializer.format(\n                '<item>%</item>',\n                typeof item === 'object' ?\n                        (isSnapObject(item) ? ''\n                                : serializer.store(item, mediaContext))\n                        : typeof item === 'boolean' ?\n                                serializer.format('<bool>$</bool>', item)\n                                : serializer.format('<l>$</l>', item)\n            );\n        }, '')\n    );\n};\n\nContext.prototype.toXML = function (serializer) {\n    if (this.isContinuation) { // continuations are transient in Snap!\n        return '';\n    }\n    return serializer.format(\n        '<context ~><inputs>%</inputs><variables>%</variables>' +\n            '%<receiver>%</receiver><origin>%</origin>%</context>',\n        this.inputs.reduce(\n                (xml, input) => {\n                    return xml + serializer.format('<input>$</input>', input);\n                },\n                ''\n            ),\n        this.variables ? serializer.store(this.variables) : '',\n        this.expression ? serializer.store(this.expression) : '',\n        this.receiver ? serializer.store(this.receiver) : '',\n        this.receiver ? serializer.store(this.origin) : '',\n        this.outerContext ? serializer.store(this.outerContext) : ''\n    );\n};\n\n// Comments\n\nCommentMorph.prototype.toXML = function (serializer) {\n    var position,\n        scale = SyntaxElementMorph.prototype.scale;\n\n    if (this.block) { // attached to a block\n        return serializer.format(\n            '<comment w=\"@\" collapsed=\"@\">%</comment>',\n            this.textWidth() / scale,\n            this.isCollapsed,\n            serializer.escape(this.text())\n        );\n    }\n\n    // free-floating, determine my save-position\n    if (this.parent) {\n        position = this.topLeft().subtract(this.parent.topLeft());\n    } else {\n        position = this.topLeft();\n    }\n    return serializer.format(\n        '<comment x=\"@\" y=\"@\" w=\"@\" collapsed=\"@\">%</comment>',\n        position.x / scale,\n        position.y / scale,\n        this.textWidth() / scale,\n        this.isCollapsed,\n        serializer.escape(this.text())\n    );\n};\n","/*\n\n    cloud.js\n\n    a backend API for SNAP!\n\n    written by Bernat Romagosa\n    inspired by the original cloud API by Jens Mnig\n\n    Copyright (C) 2018 by Bernat Romagosa\n    Copyright (C) 2015 by Jens Mnig\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n// Global settings /////////////////////////////////////////////////////\n// cloud.js should be able to exist indepent of Snap!\n// (The module date is included for simplicity, but is not needed elsewhere.)\n\n/*global modules, hex_sha512*/\nimport {modules} from './morphic'\n// modules = modules || {};\nmodules.cloud = '2020-October-21';\n\n// Global stuff\n\n// export var Cloud;\n\n// Cloud /////////////////////////////////////////////////////////////\n\nexport function Cloud() {\n    this.init();\n}\n\nCloud.prototype.init = function () {\n    this.apiBasePath = '/api/v1';\n    this.url = this.determineCloudDomain() + this.apiBasePath;\n    this.username = null;\n    this.disabled = false;\n};\n\nCloud.prototype.disable = function () {\n    this.disabled = true;\n    this.username = null;\n};\n\n// Projects larger than this are rejected.\nCloud.MAX_FILE_SIZE = 10 * 1024 * 1024;\n\nCloud.prototype.knownDomains = {\n    'Snap!Cloud' : 'https://snap.berkeley.edu',\n    'Snap!Cloud (cs10)' : 'https://snap-cloud.cs10.org',\n    'Snap!Cloud (staging)': 'https://snap-staging.cs10.org',\n    'localhost': 'http://localhost:8080',\n    'localhost (secure)': 'https://localhost:4431'\n};\n\nCloud.prototype.defaultDomain = Cloud.prototype.knownDomains['Snap!Cloud'];\n\nCloud.prototype.determineCloudDomain = function () {\n    // We dynamically determine the domain of the cloud server.\n    // This allows for easy mirrors and development servers.\n    // The domain is determined by:\n    // 1. <meta name='snap-cloud-domain' location=\"X\"> in snap.html.\n    // 2. The current page's domain\n    var currentDomain = window.location.host, // host includes the port.\n        metaTag = document.head.querySelector(\"[name='snap-cloud-domain']\"),\n        cloudDomain = this.defaultDomain,\n        domainMap = this.knownDomains;\n\n    if (metaTag) { return metaTag.getAttribute('location'); }\n\n    Object.keys(domainMap).some(function (name) {\n        var server = domainMap[name];\n        if (Cloud.isMatchingDomain(currentDomain, server)) {\n            cloudDomain = server;\n            return true;\n        }\n        return false;\n    });\n\n    return cloudDomain;\n};\n\nCloud.isMatchingDomain = function (client, server) {\n    // A matching domain means that the client-server are not subject to\n    // 3rd party cookie restrictions.\n    // see https://tools.ietf.org/html/rfc6265#section-5.1.3\n    // This matches a domain at end of a subdomain URL.\n    var position = server.indexOf(client);\n    switch (position) {\n        case -1:\n            return false;\n        case 0:\n            return client === server;\n        default:\n            return /[\\.\\/]/.test(server[position - 1]) &&\n                server.length === position + client.length;\n    }\n};\n\n// Dictionary handling\n\nCloud.prototype.parseDict = function (src) {\n    var dict = {};\n    if (!src) {return dict; }\n    src.split(\"&\").forEach(function (entry) {\n        var pair = entry.split(\"=\"),\n            key = decodeURIComponent(pair[0]),\n            val = decodeURIComponent(pair[1]);\n        dict[key] = val;\n    });\n    return dict;\n};\n\nCloud.prototype.encodeDict = function (dict) {\n    var str = '',\n        pair,\n        key;\n    if (!dict) {return null; }\n    for (key in dict) {\n        if (dict.hasOwnProperty(key)) {\n            pair = encodeURIComponent(key)\n                + '='\n                + encodeURIComponent(dict[key]);\n            if (str.length > 0) {\n                str += '&';\n            }\n            str += pair;\n        }\n    }\n    return str;\n};\n\n// Error handling\n\nCloud.genericErrorMessage =\n    'There was an error while trying to access\\n' +\n    'a Snap!Cloud service. Please try again later.';\n\nCloud.prototype.genericError = function () {\n    throw new Error(Cloud.genericErrorMessage);\n};\n\n\n\n// Low level functionality\n\nCloud.prototype.request = function (\n    method,\n    path,\n    onSuccess,\n    onError,\n    errorMsg,\n    wantsRawResponse,\n    body) {\n\n    if (this.disabled) { return; }\n\n    var request = new XMLHttpRequest(),\n        myself = this,\n        fullPath = this.url +\n            (path.indexOf('%username') > -1 ?\n                path.replace('%username', encodeURIComponent(this.username)) :\n                path);\n\n    try {\n        request.open(\n            method,\n            fullPath,\n            true\n        );\n        request.setRequestHeader(\n            'Content-Type',\n            'application/json; charset=utf-8'\n        );\n        request.withCredentials = true;\n        request.onreadystatechange = function () {\n            if (request.readyState === 4) {\n                if (request.responseText) {\n                    var response =\n                        (!wantsRawResponse ||\n                        (request.responseText.indexOf('{\"errors\"') === 0)) ?\n                            JSON.parse(request.responseText) :\n                            request.responseText;\n\n                    if (response.errors) {\n                       onError.call(\n                            null,\n                            response.errors[0],\n                            errorMsg\n                        );\n                    } else {\n                        if (onSuccess) {\n                            onSuccess.call(null, response.message || response);\n                        }\n                    }\n                } else {\n                    if (onError) {\n                        onError.call(\n                            null,\n                            errorMsg || Cloud.genericErrorMessage,\n                            myself.url\n                        );\n                    } else {\n                        myself.genericError();\n                    }\n                }\n            }\n        };\n        request.send(body);\n    } catch (err) {\n        onError.call(this, err.toString(), 'Cloud Error');\n    }\n};\n\nCloud.prototype.withCredentialsRequest = function (\n    method,\n    path,\n    onSuccess,\n    onError,\n    errorMsg,\n    wantsRawResponse,\n    body) {\n\n    var myself = this;\n    this.checkCredentials(\n        function (username) {\n            if (username) {\n                myself.request(\n                    method,\n                    // %username is replaced by the actual username\n                    path,\n                    onSuccess,\n                    onError,\n                    errorMsg,\n                    wantsRawResponse,\n                    body);\n            } else {\n                onError.call(this, 'You are not logged in', 'Snap!Cloud');\n            }\n        }\n    );\n};\n\n// Credentials management\n\nCloud.prototype.initSession = function (onSuccess) {\n    var myself = this;\n    if (location.protocol === 'file:') {\n        // disabled for now (jens)\n        return;\n    }\n    this.request(\n        'POST',\n        '/init',\n        function () { myself.checkCredentials(onSuccess); },\n        function () {},\n        null,\n        true\n    );\n};\n\nCloud.prototype.checkCredentials = function (onSuccess, onError, response) {\n    var myself = this;\n    this.getCurrentUser(\n        function (user) {\n            if (user.username) {\n                myself.username = user.username;\n                myself.verified = user.verified;\n            }\n            if (onSuccess) {\n            \tonSuccess.call(\n                    null,\n                    user.username,\n                    user.role,\n                    response ? JSON.parse(response) : null\n                );\n            }\n        },\n        onError\n    );\n};\n\nCloud.prototype.getCurrentUser = function (onSuccess, onError) {\n    this.request(\n    \t'GET',\n        '/users/c',\n        onSuccess,\n        onError,\n        'Could not retrieve current user'\n    );\n};\n\nCloud.prototype.getUser = function (username, onSuccess, onError) {\n    this.request(\n    \t'GET',\n        '/users/' + encodeURIComponent(username),\n        onSuccess,\n        onError,\n        'Could not retrieve user'\n    );\n};\n\nCloud.prototype.logout = function (onSuccess, onError) {\n    this.username = null;\n    this.request(\n        'POST',\n        '/logout',\n        onSuccess,\n        onError,\n        'logout failed'\n    );\n};\n\nCloud.prototype.login = function (\n\tusername,\n    password,\n    persist,\n    onSuccess,\n    onError\n) {\n    var myself = this;\n    this.request(\n        'POST',\n        '/users/' + encodeURIComponent(username) + '/login?' +\n            this.encodeDict({\n                persist: persist\n            }),\n        function (response) {\n            myself.checkCredentials(onSuccess, onError, response);\n        },\n        onError,\n        'login failed',\n        'false', // wants raw response\n        hex_sha512(password) // password travels inside the body\n    );\n};\n\nCloud.prototype.signup = function (\n\tusername,\n    password,\n    passwordRepeat,\n    email,\n    onSuccess,\n    onError\n) {\n    this.request(\n        'POST',\n        '/users/' + encodeURIComponent(username) + '?' + this.encodeDict({\n            email: email,\n            password: hex_sha512(password),\n            password_repeat: hex_sha512(passwordRepeat)\n        }),\n        onSuccess,\n        onError,\n        'signup failed');\n};\n\nCloud.prototype.changePassword = function (\n\tpassword,\n    newPassword,\n    passwordRepeat,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'POST',\n        '/users/%username/newpassword?' + this.encodeDict({\n            oldpassword: hex_sha512(password),\n            password_repeat: hex_sha512(passwordRepeat),\n            newpassword: hex_sha512(newPassword)\n        }),\n        onSuccess,\n        onError,\n        'Could not change password'\n    );\n};\n\nCloud.prototype.resetPassword = function (username, onSuccess, onError) {\n    this.request(\n        'POST',\n        '/users/' + encodeURIComponent(username) + '/password_reset',\n        onSuccess,\n        onError,\n        'Password reset request failed'\n    );\n};\n\nCloud.prototype.resendVerification = function (username, onSuccess, onError) {\n    this.request(\n        'POST',\n        '/users/' + encodeURIComponent(username) + '/resendverification',\n        onSuccess,\n        onError,\n        'Could not send verification email'\n    );\n};\n\n\n// Projects\n\nCloud.prototype.saveProject = function (projectName, body, onSuccess, onError) {\n    // Expects a body object with the following paramters:\n    // xml, media, thumbnail, remixID (optional), notes (optional)\n    var myself = this;\n    this.checkCredentials(\n        function (username) {\n            if (username) {\n                myself.request(\n                    'POST',\n                    '/projects/' +\n                        encodeURIComponent(username) +\n                        '/' +\n                        encodeURIComponent(projectName),\n                    onSuccess,\n                    onError,\n                    'Project could not be saved',\n                    false,\n                    JSON.stringify(body) // POST body\n                );\n            } else {\n                onError.call(this, 'You are not logged in', 'Snap!Cloud');\n            }\n        }\n    );\n};\n\nCloud.prototype.getProjectList = function (onSuccess, onError, withThumbnail) {\n    var path = '/projects/%username?updatingnotes=true';\n\n    if (withThumbnail) {\n        path += '&withthumbnail=true';\n    }\n\n    this.withCredentialsRequest(\n        'GET',\n        path,\n        onSuccess,\n        onError,\n        'Could not fetch projects'\n    );\n};\n\nCloud.prototype.getPublishedProjectList = function (\n\tusername,\n    page,\n    pageSize,\n    searchTerm,\n    onSuccess,\n    onError,\n    withThumbnail\n) {\n    var path = '/projects' +\n    \t\t(username ? '/' + encodeURIComponent(username) : '') +\n\t        '?ispublished=true';\n\n    if (!username) {\n        // When requesting the global list of published projects, filter out\n        // those with project names that are typical of online courses like\n        // Teals or BJC. When requesting a user's published projects, show them\n        // all.\n        path += '&filtered=true';\n    }\n\n    if (withThumbnail) {\n        path += '&withthumbnail=true';\n    }\n\n    if (page) {\n        path += '&page=' + page + '&pagesize=' + (pageSize || 16);\n    }\n\n    if (searchTerm) {\n        path += '&matchtext=' + encodeURIComponent(searchTerm);\n    }\n\n    this.request(\n        'GET',\n        path,\n        onSuccess,\n        onError,\n        'Could not fetch projects'\n    );\n};\n\nCloud.prototype.getThumbnail = function (\n\tusername,\n    projectName,\n    onSuccess,\n    onError\n) {\n    this[username ? 'request' : 'withCredentialsRequest'](\n        'GET',\n        '/projects/' +\n            (username ? encodeURIComponent(username) : '%username') +\n            '/' +\n            encodeURIComponent(projectName) +\n            '/thumbnail',\n        onSuccess,\n        onError,\n        'Could not fetch thumbnail',\n        true\n    );\n};\n\nCloud.prototype.getProject = function (projectName, delta, onSuccess, onError) {\n    this.withCredentialsRequest(\n        'GET',\n        '/projects/%username/' +\n            encodeURIComponent(projectName) +\n            (delta ? '?delta=' + delta : ''),\n        onSuccess,\n        onError,\n        'Could not fetch project ' + projectName,\n        true\n    );\n};\n\nCloud.prototype.getPublicProject = function (\n\tprojectName,\n    username,\n    onSuccess,\n    onError\n) {\n    this.request(\n        'GET',\n        '/projects/' +\n            encodeURIComponent(username) +\n            '/' +\n            encodeURIComponent(projectName),\n        onSuccess,\n        onError,\n        'Could not fetch project ' + projectName,\n        true\n    );\n};\n\nCloud.prototype.getProjectMetadata = function (\n\tprojectName,\n    username,\n    onSuccess,\n    onError\n) {\n    this.request(\n        'GET',\n        '/projects/' +\n            encodeURIComponent(username) +\n            '/' +\n            encodeURIComponent(projectName) +\n            '/metadata',\n        onSuccess,\n        onError,\n        'Could not fetch metadata for ' + projectName\n    );\n};\n\nCloud.prototype.getProjectVersionMetadata = function (\n        projectName,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'GET',\n        '/projects/%username/' +\n            encodeURIComponent(projectName) +\n            '/versions',\n        onSuccess,\n        onError,\n        'Could not fetch versions for project ' + projectName\n    );\n};\n\nCloud.prototype.getRemixes = function (\n\tusername,\n    projectName,\n    page,\n    pageSize,\n    onSuccess,\n    onError\n) {\n    var path = '/projects/' +\n                encodeURIComponent(username) + '/' +\n                encodeURIComponent(projectName) + '/remixes';\n\n    if (page) {\n        path += '?page=' + page + '&pagesize=' + (pageSize || 16);\n    }\n\n    this.request(\n        'GET',\n        path,\n        onSuccess,\n        onError,\n        'Could not fetch remixes for project ' + projectName\n    );\n};\n\nCloud.prototype.deleteProject = function (\n\tprojectName,\n    username,\n    onSuccess,\n    onError\n) {\n    this[username ? 'request' : 'withCredentialsRequest'](\n        'DELETE',\n        '/projects/' +\n            (username ? encodeURIComponent(username) : '%username') +\n            '/' +\n            encodeURIComponent(projectName),\n        onSuccess,\n        onError,\n        'Could not delete project'\n    );\n};\n\nCloud.prototype.shareProject = function (\n\tprojectName,\n    username,\n    onSuccess,\n    onError\n) {\n    this[username ? 'request' : 'withCredentialsRequest'](\n        'POST',\n        '/projects/' +\n            (username ? encodeURIComponent(username) : '%username') +\n            '/' +\n            encodeURIComponent(projectName) +\n            '/metadata?ispublic=true',\n        onSuccess,\n        onError,\n        'Could not share project'\n    );\n};\n\nCloud.prototype.unshareProject = function (\n\tprojectName,\n    username,\n    onSuccess,\n    onError\n) {\n    this[username ? 'request' : 'withCredentialsRequest'](\n        'POST',\n        '/projects/' +\n            (username ? encodeURIComponent(username) : '%username') +\n            '/' +\n            encodeURIComponent(projectName) +\n            '/metadata?ispublic=false&ispublished=false',\n        onSuccess,\n        onError,\n        'Could not unshare project'\n    );\n};\n\nCloud.prototype.publishProject = function (\n\tprojectName,\n    username,\n    onSuccess,\n    onError\n) {\n    this[username ? 'request' : 'withCredentialsRequest'](\n        'POST',\n        '/projects/' +\n            (username ? encodeURIComponent(username) : '%username') +\n            '/' +\n            encodeURIComponent(projectName) +\n            '/metadata?ispublished=true',\n        onSuccess,\n        onError,\n        'Could not publish project'\n    );\n};\n\nCloud.prototype.unpublishProject = function (\n\tprojectName,\n    username,\n    onSuccess,\n    onError\n) {\n    this[username ? 'request' : 'withCredentialsRequest'](\n        'POST',\n        '/projects/' +\n            (username ? encodeURIComponent(username) : '%username') +\n            '/' +\n            encodeURIComponent(projectName) +\n            '/metadata?ispublished=false',\n        onSuccess,\n        onError,\n        'Could not unpublish project'\n    );\n};\n\nCloud.prototype.updateNotes = function (\n\tprojectName,\n    notes,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'POST',\n        '/projects/%username/' +\n            encodeURIComponent(projectName) +\n            '/metadata',\n        onSuccess,\n        onError,\n        'Could not update project notes',\n        false, // wants raw response\n        JSON.stringify({ notes: notes })\n    );\n};\n\nCloud.prototype.updateProjectName = function (\n\tprojectName,\n    newName,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'POST',\n        '/projects/%username/' +\n            encodeURIComponent(projectName) +\n            '/metadata',\n        onSuccess,\n        onError,\n        'Could not update project name',\n        false, // wants raw response\n        JSON.stringify({ projectname: newName })\n    );\n};\n\n// Collections\n\nCloud.prototype.newCollection = function (\n        collectionName,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'POST',\n        '/users/%username/collections/' + encodeURIComponent(collectionName),\n        onSuccess,\n        onError,\n        'Could not create collection'\n    );\n};\n\nCloud.prototype.getCollectionMetadata = function (\n        collectionUsername,\n    collectionName,\n    onSuccess,\n    onError\n) {\n    this.request(\n        'GET',\n        '/users/' +\n            (collectionUsername ?\n                encodeURIComponent(collectionUsername) :\n                '%username') +\n            '/collections/' + encodeURIComponent(collectionName) +\n            '/metadata',\n        onSuccess,\n        onError,\n        'Could not fetch metadata for ' + collectionName\n    );\n};\n\nCloud.prototype.getCollectionProjects = function (\n    collectionUsername,\n    page,\n    pageSize,\n    collectionName,\n    onSuccess,\n    onError,\n    withThumbnail\n) {\n    var path = '/users/' +\n                (collectionUsername ?\n                    encodeURIComponent(collectionUsername) :\n                    '%username') +\n                '/collections/' + encodeURIComponent(collectionName) +\n                '/projects';\n\n    if (page) {\n        path += '?page=' + page + '&pagesize=' + (pageSize || 16);\n    }\n\n    if (withThumbnail) {\n        path += (page ? '&' : '?') + 'withthumbnail=true';\n    }\n\n    this.request(\n        'GET',\n        path,\n        onSuccess,\n        onError,\n        'Could not fetch projects'\n    );\n};\n\nCloud.prototype.setCollectionThumbnail = function (\n    collectionUsername,\n    collectionName,\n    thumbnailId,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'POST',\n        '/users/' + encodeURIComponent(collectionUsername) +\n            '/collections/' + encodeURIComponent(collectionName) +\n            '/thumbnail?id=' + encodeURIComponent(thumbnailId),\n        onSuccess,\n        onError,\n        'Could not set project thumbnail'\n    );\n};\n\nCloud.prototype.updateCollectionDescription = function (\n\tcollectionUsername,\n    collectionName,\n    description,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'POST',\n        '/users/' + encodeURIComponent(collectionUsername) +\n            '/collections/' + encodeURIComponent(collectionName) +\n            '/metadata',\n        onSuccess,\n        onError,\n        'Could not update collection description',\n        false, // wants raw response\n        JSON.stringify({ description: description })\n    );\n};\n\nCloud.prototype.updateCollectionName = function (\n\tcollectionUsername,\n    collectionName,\n    newName,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'POST',\n        '/users/' + encodeURIComponent(collectionUsername) +\n            '/collections/' + encodeURIComponent(collectionName) +\n            '/metadata',\n        onSuccess,\n        onError,\n        'Could not update collection name',\n        false, // wants raw response\n        JSON.stringify({ name: newName })\n    );\n};\n\nCloud.prototype.shareCollection = function (\n\tcollectionUsername,\n    collectionName,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'POST',\n        '/users/' + encodeURIComponent(collectionUsername) +\n            '/collections/' + encodeURIComponent(collectionName) +\n            '/metadata?shared=true',\n        onSuccess,\n        onError,\n        'Could not share collection'\n    );\n};\n\nCloud.prototype.unshareCollection = function (\n\tcollectionUsername,\n    collectionName,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'POST',\n        '/users/' + encodeURIComponent(collectionUsername) +\n            '/collections/' + encodeURIComponent(collectionName) +\n            '/metadata?shared=false&published=false',\n        onSuccess,\n        onError,\n        'Could not unshare collection'\n    );\n};\n\nCloud.prototype.publishCollection = function (\n\tcollectionUsername,\n    collectionName,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'POST',\n        '/users/' + encodeURIComponent(collectionUsername) +\n            '/collections/' + encodeURIComponent(collectionName) +\n            '/metadata?published=true',\n        onSuccess,\n        onError,\n        'Could not publish collection'\n    );\n};\n\nCloud.prototype.unpublishCollection = function (\n\tcollectionUsername,\n    collectionName,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'POST',\n        '/users/' + encodeURIComponent(collectionUsername) +\n            '/collections/' + encodeURIComponent(collectionName) +\n            '/metadata?published=false',\n        onSuccess,\n        onError,\n        'Could not unpublish collection'\n    );\n};\n\nCloud.prototype.addProjectToCollection = function (\n        collectionUsername,\n    collectionName,\n    projectUsername,\n    projectName,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'POST',\n        '/users/' + encodeURIComponent(collectionUsername) +\n            '/collections/' + encodeURIComponent(collectionName) +\n            '/projects',\n        onSuccess,\n        onError,\n        'Could not add project to collection',\n        false, // wants raw response\n        JSON.stringify({\n            username: projectUsername,\n            projectname: projectName\n        })\n    );\n};\n\nCloud.prototype.removeProjectFromCollection = function (\n        collectionUsername,\n    collectionName,\n    projectId,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'DELETE',\n        '/users/' + encodeURIComponent(collectionUsername) +\n            '/collections/' + encodeURIComponent(collectionName) +\n            '/projects/' + encodeURIComponent(projectId),\n        onSuccess,\n        onError,\n        'Could not remove project from collection'\n    );\n};\n\nCloud.prototype.getUserCollections = function (\n        collectionUsername,\n    page,\n    pageSize,\n    searchTerm,\n    onSuccess,\n    onError\n) {\n    this[(collectionUsername !== this.username) ?\n            'request' :\n            'withCredentialsRequest'](\n        'GET',\n        '/users/' +\n            (collectionUsername ?\n                encodeURIComponent(collectionUsername) :\n                '%username') +\n            '/collections?' +\n            this.encodeDict(\n                page > 0 ?\n                    {\n                        page: page,\n                        pagesize: pageSize || 16,\n                        matchtext:\n                            searchTerm ? encodeURIComponent(searchTerm) : ''\n                    } : {}\n            ),\n        onSuccess,\n        onError,\n        'Could not fetch collections'\n    );\n};\n\nCloud.prototype.getCollectionsContainingProject = function (\n        username,\n    projectName,\n    page,\n    pageSize,\n    onSuccess,\n    onError\n) {\n    var path = '/projects/' +\n                encodeURIComponent(username) + '/' +\n                encodeURIComponent(projectName) + '/collections';\n\n    if (page) {\n        path += '?page=' + page + '&pagesize=' + (pageSize || 16);\n    }\n\n    this.request(\n        'GET',\n        path,\n        onSuccess,\n        onError,\n        'Could not fetch collections for project ' + projectName\n    );\n};\n\nCloud.prototype.getCollections = function (\n        page,\n    pageSize,\n    searchTerm,\n    onSuccess,\n    onError\n) {\n    var dict = {\n        page: page,\n        pagesize: page ? pageSize || 16 : '',\n    };\n\n    if (searchTerm) { dict.matchtext = encodeURIComponent(searchTerm); }\n\n    this.request(\n        'GET',\n        '/collections?' + this.encodeDict(dict),\n        onSuccess,\n        onError,\n        'Could not fetch collections'\n    );\n};\n\nCloud.prototype.deleteCollection = function (\n        collectionUsername,\n    collectionName,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'DELETE',\n        '/users/' + encodeURIComponent(collectionUsername) +\n            '/collections/' + encodeURIComponent(collectionName),\n        onSuccess,\n        onError,\n        'Could not remove collection'\n    );\n};\n\nCloud.prototype.addEditorToCollection = function (\n        collectionUsername,\n    collectionName,\n    editorUsername,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'POST',\n        '/users/' + encodeURIComponent(collectionUsername) +\n            '/collections/' + encodeURIComponent(collectionName) +\n            '/editors',\n        onSuccess,\n        onError,\n        'Could not add editor to collection',\n        false, // wants raw response\n        JSON.stringify({\n            editor_username: editorUsername,\n        })\n    );\n};\n\nCloud.prototype.removeEditorFromCollection = function (\n        collectionUsername,\n    collectionName,\n    editorUsername,\n    onSuccess,\n    onError\n) {\n    this.withCredentialsRequest(\n        'DELETE',\n        '/users/' + encodeURIComponent(collectionUsername) +\n            '/collections/' + encodeURIComponent(collectionName) +\n            '/editors/' + encodeURIComponent(editorUsername),\n        onSuccess,\n        onError,\n        'Could not remove editor from collection'\n    );\n};\n\n// Paths to front-end pages\n/*\n    This list of paths is incomplete, we will add them as necessary.\n    Important: a path is a string *without* a domain.\n    These paths are not prefixed by `apiBasePath`.\n*/\n\nCloud.prototype.showProjectPath = function (username, projectname) {\n    return '/project?' + this.encodeDict({\n        user: username,\n        project: projectname\n    });\n};\n","import {\n  BoxMorph,\n  contains,\n  isNil,\n  isString,\n  localize,\n  MenuMorph,\n  Morph, MorphicPreferences,\n  newCanvas,\n  nop,\n  Point, radians,\n  TextMorph, useBlurredShadows,\n  WHITE\n} from \"./morphic\";\nimport {\n  CellMorph,\n  Costume,\n  isSnapObject,\n  Sound,\n  SpriteBubbleMorph,\n  SpriteMorph,\n  StageMorph,\n  WatcherMorph\n} from \"./objects\";\nimport {PaintEditorMorph} from \"./paint\";\nimport {PushButtonMorph, ToggleMorph} from \"./widgets\";\nimport {IDE_Morph} from \"./gui\";\nimport {Context, Process, VariableFrame} from \"./threads\";\nimport {BlockMorph, SyntaxElementMorph} from \"./blocks\";\nimport {VariableDialogMorph} from \"./byob\";\nimport {SymbolMorph} from \"./symbols\";\nimport {List, ListWatcherMorph} from \"./lists\";\nimport {TableFrameMorph} from \"./tables\";\n\nCostume.prototype.edit = function (aWorld, anIDE, isnew, oncancel, onsubmit) {\n  var editor = new PaintEditorMorph();\n  editor.oncancel = oncancel || nop;\n  editor.openIn(\n    aWorld,\n    isnew ?\n      newCanvas(StageMorph.prototype.dimensions, true) :\n      this.contents,\n    isnew ?\n      null :\n      this.rotationCenter,\n    (img, rc) => {\n      this.contents = img;\n      this.rotationCenter = rc;\n      this.version = Date.now();\n      aWorld.changed();\n      if (anIDE) {\n        if (anIDE.currentSprite instanceof SpriteMorph) {\n          // don't shrinkwrap stage costumes\n          this.shrinkWrap();\n        }\n        anIDE.currentSprite.wearCostume(this, true); // don't shadow\n        anIDE.hasChangedMedia = true;\n      }\n      (onsubmit || nop)();\n    },\n    anIDE\n  );\n};\nSpriteMorph.prototype.blockTemplates = function (category) {\n  var blocks = [], myself = this, varNames, button,\n    cat = category || 'motion', txt,\n    inheritedVars = this.inheritedVariableNames();\n\n  function block(selector, isGhosted) {\n    if (StageMorph.prototype.hiddenPrimitives[selector]) {\n      return null;\n    }\n    var newBlock = SpriteMorph.prototype.blockForSelector(selector, true);\n    newBlock.isTemplate = true;\n    if (isGhosted) {newBlock.ghost(); }\n    return newBlock;\n  }\n\n  function variableBlock(varName, isLocal) {\n    var newBlock = SpriteMorph.prototype.variableBlock(varName, isLocal);\n    newBlock.isDraggable = false;\n    newBlock.isTemplate = true;\n    if (contains(inheritedVars, varName)) {\n      newBlock.ghost();\n    }\n    return newBlock;\n  }\n\n  function watcherToggle(selector) {\n    if (StageMorph.prototype.hiddenPrimitives[selector]) {\n      return null;\n    }\n    var info = SpriteMorph.prototype.blocks[selector];\n    return new ToggleMorph(\n      'checkbox',\n      this,\n      function () {\n        myself.toggleWatcher(\n          selector,\n          localize(info.spec),\n          myself.blockColor[info.category]\n        );\n      },\n      null,\n      function () {\n        return myself.showingWatcher(selector);\n      },\n      null\n    );\n  }\n\n  function variableWatcherToggle(varName) {\n    return new ToggleMorph(\n      'checkbox',\n      this,\n      function () {\n        myself.toggleVariableWatcher(varName);\n      },\n      null,\n      function () {\n        return myself.showingVariableWatcher(varName);\n      },\n      null\n    );\n  }\n\n  function helpMenu() {\n    var menu = new MenuMorph(this);\n    menu.addItem('help...', 'showHelp');\n    return menu;\n  }\n\n  function addVar(pair) {\n    var ide;\n    if (pair) {\n      if (myself.isVariableNameInUse(pair[0], pair[1])) {\n        myself.inform('that name is already in use');\n      } else {\n        ide = myself.parentThatIsA(IDE_Morph);\n        myself.addVariable(pair[0], pair[1]);\n        myself.toggleVariableWatcher(pair[0], pair[1]);\n        ide.flushBlocksCache('variables'); // b/c of inheritance\n        ide.refreshPalette();\n      }\n    }\n  }\n\n  if (cat === 'motion') {\n\n    blocks.push(block('forward'));\n    blocks.push(block('turn'));\n    blocks.push(block('turnLeft'));\n    blocks.push('-');\n    blocks.push(block('setHeading'));\n    blocks.push(block('doFaceTowards'));\n    blocks.push('-');\n    blocks.push(block('gotoXY'));\n    blocks.push(block('doGotoObject'));\n    blocks.push(block('doGlide'));\n    blocks.push('-');\n    blocks.push(block('changeXPosition'));\n    blocks.push(block('setXPosition'));\n    blocks.push(block('changeYPosition'));\n    blocks.push(block('setYPosition'));\n    blocks.push('-');\n    blocks.push(block('bounceOffEdge'));\n    blocks.push('-');\n    blocks.push(watcherToggle('xPosition'));\n    blocks.push(block('xPosition', this.inheritsAttribute('x position')));\n    blocks.push(watcherToggle('yPosition'));\n    blocks.push(block('yPosition', this.inheritsAttribute('y position')));\n    blocks.push(watcherToggle('direction'));\n    blocks.push(block('direction', this.inheritsAttribute('direction')));\n    blocks.push('=');\n    blocks.push(this.makeBlockButton(cat));\n\n  } else if (cat === 'looks') {\n\n    blocks.push(block('doSwitchToCostume'));\n    blocks.push(block('doWearNextCostume'));\n    blocks.push(watcherToggle('getCostumeIdx'));\n    blocks.push(block('getCostumeIdx', this.inheritsAttribute('costume #')));\n    blocks.push('-');\n    blocks.push(block('doSayFor'));\n    blocks.push(block('bubble'));\n    blocks.push(block('doThinkFor'));\n    blocks.push(block('doThink'));\n    blocks.push('-');\n    blocks.push(block('reportGetImageAttribute'));\n    blocks.push(block('reportNewCostumeStretched'));\n    blocks.push(block('reportNewCostume'));\n    blocks.push('-');\n    blocks.push(block('changeEffect'));\n    blocks.push(block('setEffect'));\n    blocks.push(block('clearEffects'));\n    blocks.push(block('getEffect'));\n    blocks.push('-');\n    blocks.push(block('changeScale'));\n    blocks.push(block('setScale'));\n    blocks.push(watcherToggle('getScale'));\n    blocks.push(block('getScale', this.inheritsAttribute('size')));\n    blocks.push('-');\n    blocks.push(block('show'));\n    blocks.push(block('hide'));\n    blocks.push(watcherToggle('reportShown'));\n    blocks.push(block('reportShown', this.inheritsAttribute('shown?')));\n    blocks.push('-');\n    blocks.push(block('goToLayer'));\n    blocks.push(block('goBack'));\n\n    // for debugging: ///////////////\n\n    if (this.world().isDevMode) {\n      blocks.push('-');\n      txt = new TextMorph(localize(\n        'development mode \\ndebugging primitives:'\n      ));\n      txt.fontSize = 9;\n      txt.setColor(this.paletteTextColor);\n      blocks.push(txt);\n      blocks.push('-');\n      blocks.push(block('log'));\n      blocks.push(block('alert'));\n      blocks.push('-');\n      blocks.push(block('doScreenshot'));\n    }\n\n    /////////////////////////////////\n\n    blocks.push('=');\n    blocks.push(this.makeBlockButton(cat));\n\n  } else if (cat === 'sound') {\n\n    blocks.push(block('playSound'));\n    blocks.push(block('doPlaySoundUntilDone'));\n    blocks.push(block('doStopAllSounds'));\n    blocks.push('-');\n    blocks.push(block('doPlaySoundAtRate'));\n    blocks.push(block('reportGetSoundAttribute'));\n    blocks.push(block('reportNewSoundFromSamples'));\n    blocks.push('-');\n    blocks.push(block('doRest'));\n    blocks.push(block('doPlayNote'));\n    blocks.push(block('doSetInstrument'));\n    blocks.push('-');\n    blocks.push(block('doChangeTempo'));\n    blocks.push(block('doSetTempo'));\n    blocks.push(watcherToggle('getTempo'));\n    blocks.push(block('getTempo'));\n    blocks.push('-');\n    blocks.push(block('changeVolume'));\n    blocks.push(block('setVolume'));\n    blocks.push(watcherToggle('getVolume'));\n    blocks.push(block('getVolume', this.inheritsAttribute('volume')));\n    blocks.push('-');\n    blocks.push(block('changePan'));\n    blocks.push(block('setPan'));\n    blocks.push(watcherToggle('getPan'));\n    blocks.push(block('getPan', this.inheritsAttribute('balance')));\n    blocks.push('-');\n    blocks.push(block('playFreq'));\n    blocks.push(block('stopFreq'));\n\n    // for debugging: ///////////////\n\n    if (this.world().isDevMode) {\n      blocks.push('-');\n      txt = new TextMorph(localize(\n        'development mode \\ndebugging primitives:'\n      ));\n      txt.fontSize = 9;\n      txt.setColor(this.paletteTextColor);\n      blocks.push(txt);\n      blocks.push('-');\n      blocks.push(block('doPlayFrequency'));\n    }\n\n    /////////////////////////////////\n\n    blocks.push('=');\n    blocks.push(this.makeBlockButton(cat));\n\n  } else if (cat === 'pen') {\n\n    blocks.push(block('clear'));\n    blocks.push('-');\n    blocks.push(block('down'));\n    blocks.push(block('up'));\n    blocks.push(watcherToggle('getPenDown'));\n    blocks.push(block('getPenDown', this.inheritsAttribute('pen down?')));\n    blocks.push('-');\n    blocks.push(block('setColor'));\n    blocks.push(block('changePenHSVA'));\n    blocks.push(block('setPenHSVA'));\n    blocks.push(block('getPenAttribute'));\n    blocks.push('-');\n    blocks.push(block('changeSize'));\n    blocks.push(block('setSize'));\n    blocks.push('-');\n    blocks.push(block('doStamp'));\n    blocks.push(block('floodFill'));\n    blocks.push(block('write'));\n    blocks.push('-');\n    blocks.push(block('reportPenTrailsAsCostume'));\n    blocks.push('-');\n    blocks.push(block('doPasteOn'));\n    blocks.push(block('doCutFrom'));\n    blocks.push('=');\n    blocks.push(this.makeBlockButton(cat));\n\n  } else if (cat === 'control') {\n\n    blocks.push(block('receiveGo'));\n    blocks.push(block('receiveKey'));\n    blocks.push(block('receiveInteraction'));\n    blocks.push(block('receiveCondition'));\n    blocks.push(block('receiveMessage'));\n    blocks.push('-');\n    blocks.push(block('doBroadcast'));\n    blocks.push(block('doBroadcastAndWait'));\n    blocks.push(block('doSend'));\n    blocks.push(watcherToggle('getLastMessage'));\n    blocks.push(block('getLastMessage'));\n    blocks.push('-');\n    blocks.push(block('doWarp'));\n    blocks.push('-');\n    blocks.push(block('doWait'));\n    blocks.push(block('doWaitUntil'));\n    blocks.push('-');\n    blocks.push(block('doForever'));\n    blocks.push(block('doRepeat'));\n    blocks.push(block('doUntil'));\n    blocks.push(block('doFor'));\n    blocks.push('-');\n    blocks.push(block('doIf'));\n    blocks.push(block('doIfElse'));\n    blocks.push(block('reportIfElse'));\n    blocks.push('-');\n    blocks.push(block('doReport'));\n    blocks.push(block('doStopThis'));\n    blocks.push('-');\n    blocks.push(block('doRun'));\n    blocks.push(block('fork'));\n    blocks.push(block('evaluate'));\n    blocks.push('-');\n    blocks.push(block('doTellTo'));\n    blocks.push(block('reportAskFor'));\n    blocks.push('-');\n    blocks.push(block('doCallCC'));\n    blocks.push(block('reportCallCC'));\n    blocks.push('-');\n    blocks.push(block('receiveOnClone'));\n    blocks.push(block('createClone'));\n    blocks.push(block('newClone'));\n    blocks.push(block('removeClone'));\n    blocks.push('-');\n    blocks.push(block('doPauseAll'));\n    blocks.push('=');\n    blocks.push(this.makeBlockButton(cat));\n\n  } else if (cat === 'sensing') {\n\n    blocks.push(block('reportTouchingObject'));\n    blocks.push(block('reportTouchingColor'));\n    blocks.push(block('reportColorIsTouchingColor'));\n    blocks.push('-');\n    blocks.push(block('doAsk'));\n    blocks.push(watcherToggle('getLastAnswer'));\n    blocks.push(block('getLastAnswer'));\n    blocks.push('-');\n    blocks.push(watcherToggle('reportMouseX'));\n    blocks.push(block('reportMouseX'));\n    blocks.push(watcherToggle('reportMouseY'));\n    blocks.push(block('reportMouseY'));\n    blocks.push(block('reportMouseDown'));\n    blocks.push('-');\n    blocks.push(block('reportKeyPressed'));\n    blocks.push('-');\n    blocks.push(block('reportRelationTo'));\n    blocks.push(block('reportAspect'));\n    blocks.push('-');\n    blocks.push(block('doResetTimer'));\n    blocks.push(watcherToggle('getTimer'));\n    blocks.push(block('getTimer'));\n    blocks.push('-');\n    blocks.push(block('reportAttributeOf'));\n\n    if (SpriteMorph.prototype.enableFirstClass) {\n      blocks.push(block('reportGet'));\n    }\n\n    blocks.push(block('reportObject'));\n    blocks.push('-');\n    blocks.push(block('reportURL'));\n    blocks.push(block('reportAudio'));\n    blocks.push(block('reportVideo'));\n    blocks.push(block('doSetVideoTransparency'));\n    blocks.push('-');\n    blocks.push(block('reportGlobalFlag'));\n    blocks.push(block('doSetGlobalFlag'));\n    blocks.push('-');\n    blocks.push(block('reportDate'));\n\n    // for debugging: ///////////////\n\n    if (this.world().isDevMode) {\n\n      blocks.push('-');\n      txt = new TextMorph(localize(\n        'development mode \\ndebugging primitives:'\n      ));\n      txt.fontSize = 9;\n      txt.setColor(this.paletteTextColor);\n      blocks.push(txt);\n      blocks.push('-');\n      blocks.push(watcherToggle('reportThreadCount'));\n      blocks.push(block('reportThreadCount'));\n      blocks.push(block('reportStackSize'));\n      blocks.push(block('reportFrameCount'));\n    }\n\n    /////////////////////////////////\n\n    blocks.push('=');\n    blocks.push(this.makeBlockButton(cat));\n\n  } else if (cat === 'operators') {\n\n    blocks.push(block('reifyScript'));\n    blocks.push(block('reifyReporter'));\n    blocks.push(block('reifyPredicate'));\n    blocks.push('#');\n    blocks.push('-');\n    blocks.push(block('reportSum'));\n    blocks.push(block('reportDifference'));\n    blocks.push(block('reportProduct'));\n    blocks.push(block('reportQuotient'));\n    blocks.push(block('reportPower'));\n    blocks.push('-');\n    blocks.push(block('reportModulus'));\n    blocks.push(block('reportRound'));\n    blocks.push(block('reportMonadic'));\n    blocks.push(block('reportRandom'));\n    blocks.push('-');\n    blocks.push(block('reportLessThan'));\n    blocks.push(block('reportEquals'));\n    blocks.push(block('reportGreaterThan'));\n    blocks.push('-');\n    blocks.push(block('reportAnd'));\n    blocks.push(block('reportOr'));\n    blocks.push(block('reportNot'));\n    blocks.push(block('reportBoolean'));\n    blocks.push('-');\n    blocks.push(block('reportJoinWords'));\n    blocks.push(block('reportTextSplit'));\n    blocks.push(block('reportLetter'));\n    blocks.push(block('reportStringSize'));\n    blocks.push('-');\n    blocks.push(block('reportUnicode'));\n    blocks.push(block('reportUnicodeAsLetter'));\n    blocks.push('-');\n    blocks.push(block('reportIsA'));\n    blocks.push(block('reportIsIdentical'));\n\n    if (true) { // (Process.prototype.enableJS) {\n      blocks.push('-');\n      blocks.push(block('reportJSFunction'));\n      if (Process.prototype.enableCompiling) {\n        blocks.push(block('reportCompiled'));\n      }\n    }\n\n    // for debugging: ///////////////\n\n    if (this.world().isDevMode) {\n      blocks.push('-');\n      txt = new TextMorph(localize(\n        'development mode \\ndebugging primitives:'\n      ));\n      txt.fontSize = 9;\n      txt.setColor(this.paletteTextColor);\n      blocks.push(txt);\n      blocks.push('-');\n      blocks.push(block('reportTypeOf'));\n      blocks.push(block('reportTextFunction'));\n    }\n\n    /////////////////////////////////\n\n    blocks.push('=');\n    blocks.push(this.makeBlockButton(cat));\n\n  } else if (cat === 'variables') {\n\n    button = new PushButtonMorph(\n      null,\n      function () {\n        new VariableDialogMorph(\n          null,\n          addVar,\n          myself\n        ).prompt(\n          'Variable name',\n          null,\n          myself.world()\n        );\n      },\n      'Make a variable'\n    );\n    button.userMenu = helpMenu;\n    button.selector = 'addVariable';\n    button.showHelp = BlockMorph.prototype.showHelp;\n    blocks.push(button);\n\n    if (this.deletableVariableNames().length > 0) {\n      button = new PushButtonMorph(\n        null,\n        function () {\n          var menu = new MenuMorph(\n            myself.deleteVariable,\n            null,\n            myself\n          );\n          myself.deletableVariableNames().forEach(name =>\n            menu.addItem(\n              name,\n              name,\n              null,\n              null,\n              null,\n              null,\n              null,\n              null,\n              true // verbatim - don't translate\n            )\n          );\n          menu.popUpAtHand(myself.world());\n        },\n        'Delete a variable'\n      );\n      button.userMenu = helpMenu;\n      button.selector = 'deleteVariable';\n      button.showHelp = BlockMorph.prototype.showHelp;\n      blocks.push(button);\n    }\n\n    blocks.push('-');\n\n    varNames = this.reachableGlobalVariableNames(true);\n    if (varNames.length > 0) {\n      varNames.forEach(name => {\n        blocks.push(variableWatcherToggle(name));\n        blocks.push(variableBlock(name));\n      });\n      blocks.push('-');\n    }\n\n    varNames = this.allLocalVariableNames(true);\n    if (varNames.length > 0) {\n      varNames.forEach(name => {\n        blocks.push(variableWatcherToggle(name));\n        blocks.push(variableBlock(name, true));\n      });\n      blocks.push('-');\n    }\n\n    blocks.push(block('doSetVar'));\n    blocks.push(block('doChangeVar'));\n    blocks.push(block('doShowVar'));\n    blocks.push(block('doHideVar'));\n    blocks.push(block('doDeclareVariables'));\n\n    // inheritance:\n\n    if (StageMorph.prototype.enableInheritance) {\n      blocks.push('-');\n      blocks.push(block('doDeleteAttr'));\n    }\n\n    ///////////////////////////////\n\n    blocks.push('=');\n\n    blocks.push(block('reportNewList'));\n    blocks.push(block('reportNumbers'));\n    blocks.push('-');\n    blocks.push(block('reportCONS'));\n    blocks.push(block('reportListItem'));\n    blocks.push(block('reportCDR'));\n    blocks.push('-');\n    blocks.push(block('reportListLength'));\n    blocks.push(block('reportListIndex'));\n    blocks.push(block('reportListContainsItem'));\n    blocks.push(block('reportListIsEmpty'));\n    blocks.push('-');\n    blocks.push(block('reportMap'));\n    blocks.push(block('reportKeep'));\n    blocks.push(block('reportFindFirst'));\n    blocks.push(block('reportCombine'));\n    blocks.push('-');\n    blocks.push(block('doForEach'));\n    blocks.push('-');\n    blocks.push(block('reportConcatenatedLists'));\n    blocks.push('-');\n    blocks.push(block('doAddToList'));\n    blocks.push(block('doDeleteFromList'));\n    blocks.push(block('doInsertInList'));\n    blocks.push(block('doReplaceInList'));\n\n    // for debugging: ///////////////\n\n    if (this.world().isDevMode) {\n      blocks.push('-');\n      txt = new TextMorph(localize(\n        'development mode \\ndebugging primitives:'\n      ));\n      txt.fontSize = 9;\n      txt.setColor(this.paletteTextColor);\n      blocks.push(txt);\n      blocks.push('-');\n      blocks.push(block('doShowTable'));\n    }\n\n    /////////////////////////////////\n\n    blocks.push('=');\n\n    if (StageMorph.prototype.enableCodeMapping) {\n      blocks.push(block('doMapCodeOrHeader'));\n      blocks.push(block('doMapValueCode'));\n      blocks.push(block('doMapListCode'));\n      blocks.push('-');\n      blocks.push(block('reportMappedCode'));\n      blocks.push('=');\n    }\n\n    blocks.push(this.makeBlockButton());\n  }\n  return blocks;\n};\n\n// SpriteBubbleMorph contents formatting\n\nSpriteBubbleMorph.prototype.dataAsMorph = function (data) {\n  var contents,\n    sprite = SpriteMorph.prototype,\n    isText,\n    img,\n    scaledImg,\n    width;\n  if (data instanceof Morph) {\n    if (isSnapObject(data)) {\n      img = data.thumbnail(new Point(40, 40));\n      contents = new Morph();\n      contents.isCachingImage = true;\n      contents.bounds.setWidth(img.width);\n      contents.bounds.setHeight(img.height);\n      contents.cachedImage = img;\n      contents.version = data.version;\n      contents.step = function () {\n        if (this.version !== data.version) {\n          img = data.thumbnail(new Point(40, 40), this.cachedImage);\n          this.cachedImage = img;\n          this.version = data.version;\n          this.changed();\n        }\n      };\n    } else {\n      contents = data;\n    }\n  } else if (isString(data)) {\n    isText = true;\n    contents = new TextMorph(\n      data,\n      sprite.bubbleFontSize * this.scale,\n      null, // fontStyle\n      sprite.bubbleFontIsBold,\n      false, // italic\n      'center'\n    );\n  } else if (typeof data === 'boolean') {\n    img = sprite.booleanMorph(data).fullImage();\n    contents = new Morph();\n    contents.isCachingImage = true;\n    contents.bounds.setWidth(img.width);\n    contents.bounds.setHeight(img.height);\n    contents.cachedImage = img;\n  } else if (data instanceof Costume) {\n    img = data.thumbnail(new Point(40, 40));\n    contents = new Morph();\n    contents.isCachingImage = true;\n    contents.bounds.setWidth(img.width);\n    contents.bounds.setHeight(img.height);\n    contents.cachedImage = img;\n  } else if (data instanceof Sound) {\n    contents = new SymbolMorph('notes', 30);\n  } else if (data instanceof HTMLCanvasElement) {\n    img = data;\n    contents = new Morph();\n    contents.isCachingImage = true;\n    contents.bounds.setWidth(img.width);\n    contents.bounds.setHeight(img.height);\n    contents.cachedImage = img;\n  } else if (data instanceof List) {\n    if (data.isTable()) {\n      contents = new TableFrameMorph(new TableMorph(data, 10));\n      if (this.stage) {\n        contents.expand(this.stage.extent().translateBy(\n          -2 * (this.edge + this.border + this.padding)\n        ));\n      }\n    } else {\n      contents = new ListWatcherMorph(data);\n      contents.update(true);\n      contents.step = contents.update;\n      if (this.stage) {\n        contents.expand(this.stage.extent().translateBy(\n          -2 * (this.edge + this.border + this.padding)\n        ));\n      }\n    }\n    contents.isDraggable = false;\n  } else if (data instanceof Context) {\n    img = data.image();\n    contents = new Morph();\n    contents.isCachingImage = true;\n    contents.bounds.setWidth(img.width);\n    contents.bounds.setHeight(img.height);\n    contents.cachedImage = img;\n  } else {\n    contents = new TextMorph(\n      data.toString(),\n      sprite.bubbleFontSize * this.scale,\n      null, // fontStyle\n      sprite.bubbleFontIsBold,\n      false, // italic\n      'center'\n    );\n  }\n  if (contents instanceof TextMorph) {\n    // reflow text boundaries\n    width = Math.max(\n      contents.width(),\n      sprite.bubbleCorner * 2 * this.scale\n    );\n    if (isText) {\n      width = Math.min(width, sprite.bubbleMaxTextWidth * this.scale);\n    }\n    contents.setWidth(width);\n  } else if (!(data instanceof List)) {\n    // scale contents image\n    scaledImg = newCanvas(contents.extent().multiplyBy(this.scale));\n    scaledImg.getContext('2d').drawImage(\n      contents.getImage(),\n      0,\n      0,\n      scaledImg.width,\n      scaledImg.height\n    );\n    contents.cachedImage = scaledImg;\n    contents.bounds = contents.bounds.scaleBy(this.scale);\n  }\n  return contents;\n};\n// SpriteBubbleMorph scaling\n\nSpriteBubbleMorph.prototype.setScale = function (scale) {\n  this.scale = scale;\n  this.changed();\n  this.fixLayout();\n  this.rerender();\n};\n\n// SpriteBubbleMorph layout:\n\nSpriteBubbleMorph.prototype.fixLayout = function () {\n  var sprite = SpriteMorph.prototype;\n\n  // rebuild my contents\n  if (!(this.contentsMorph instanceof ListWatcherMorph ||\n    this.contentsMorph instanceof TableFrameMorph)) {\n    this.contentsMorph.destroy();\n    this.contentsMorph = this.dataAsMorph(this.data);\n  }\n  this.add(this.contentsMorph);\n\n  // scale my settings\n  this.edge = sprite.bubbleCorner * this.scale;\n  this.border = sprite.bubbleBorder * this.scale;\n  this.padding = sprite.bubbleCorner / 2 * this.scale;\n\n  // adjust my dimensions\n  this.bounds.setWidth(this.contentsMorph.width()\n    + (this.padding ? this.padding * 2 : this.edge * 2));\n  this.bounds.setHeight(this.contentsMorph.height()\n    + this.edge\n    + this.border * 2\n    + this.padding * 2\n    + 2);\n\n  // position my contents\n  this.contentsMorph.setPosition(this.position().add(\n    new Point(\n      this.padding || this.edge,\n      this.border + this.padding + 1\n    )\n  ));\n};\n\n\n// CellMorph accessing:\n\nCellMorph.prototype.big = function () {\n  this.isBig = true;\n  this.changed();\n  if (this.contentsMorph instanceof TextMorph) {\n    this.contentsMorph.setFontSize(\n      SyntaxElementMorph.prototype.fontSize * 1.5\n    );\n  }\n  this.fixLayout(true);\n  this.rerender();\n};\n\nCellMorph.prototype.normal = function () {\n  this.isBig = false;\n  this.changed();\n  if (this.contentsMorph instanceof TextMorph) {\n    this.contentsMorph.setFontSize(\n      SyntaxElementMorph.prototype.fontSize\n    );\n  }\n  this.fixLayout(true);\n  this.rerender();\n};\n\n// CellMorph circularity testing:\n\n\nCellMorph.prototype.isCircular = function (list) {\n  if (!this.parentCell) {return false; }\n  if (list instanceof List) {\n    return this.contents === list || this.parentCell.isCircular(list);\n  }\n  return this.parentCell.isCircular(this.contents);\n};\n\n// CellMorph layout:\n\nCellMorph.prototype.fixLayout = function (justMe) {\n  var isSameList = this.contentsMorph instanceof ListWatcherMorph\n    && (this.contentsMorph.list === this.contents),\n    isSameTable = this.contentsMorph instanceof TableFrameMorph\n      && (this.contentsMorph.tableMorph.table === this.contents),\n    listwatcher;\n\n  if (justMe) {return; }\n\n  this.createContents();\n\n  // adjust my dimensions\n  this.bounds.setHeight(this.contentsMorph.height()\n    + this.edge\n    + this.border * 2);\n  this.bounds.setWidth(Math.max(\n    this.contentsMorph.width() + this.edge * 2,\n    (this.contents instanceof Context ||\n    this.contents instanceof List ? 0 :\n      SyntaxElementMorph.prototype.fontSize * 3.5)\n  ));\n\n  // position my contents\n  if (!isSameList && !isSameTable) {\n    this.contentsMorph.setCenter(this.center());\n  }\n\n  if (this.parent) {\n    this.parent.changed();\n    this.parent.fixLayout();\n    this.parent.rerender();\n    listwatcher = this.parentThatIsA(ListWatcherMorph);\n    if (listwatcher) {\n      listwatcher.changed();\n      listwatcher.fixLayout();\n      listwatcher.rerender();\n    }\n  }\n};\n\nCellMorph.prototype.createContents = function () {\n  // re-build my contents\n  var txt,\n    img,\n    fontSize = SyntaxElementMorph.prototype.fontSize,\n    isSameList = this.contentsMorph instanceof ListWatcherMorph\n      && (this.contentsMorph.list === this.contents),\n    isSameTable = this.contentsMorph instanceof TableFrameMorph\n      && (this.contentsMorph.tableMorph.table === this.contents);\n\n  if (this.isBig) {\n    fontSize = fontSize * 1.5;\n  }\n\n  if (this.contentsMorph && !isSameList && !isSameTable) {\n    this.contentsMorph.destroy();\n    this.version = null;\n  }\n\n  if (!isSameList && !isSameTable) {\n    if (this.contents instanceof Morph) {\n      if (isSnapObject(this.contents)) {\n        img = this.contents.thumbnail(new Point(40, 40));\n        this.contentsMorph = new Morph();\n        this.contentsMorph.isCachingImage = true;\n        this.contentsMorph.bounds.setWidth(img.width);\n        this.contentsMorph.bounds.setHeight(img.height);\n        this.contentsMorph.cachedImage = img;\n        this.version = this.contents.version;\n      } else {\n        this.contentsMorph = this.contents;\n      }\n    } else if (isString(this.contents)) {\n      txt  = this.contents.length > 500 ?\n        this.contents.slice(0, 500) + '...' : this.contents;\n      this.contentsMorph = new TextMorph(\n        txt,\n        fontSize,\n        null,\n        true,\n        false,\n        'left' // was formerly 'center', reverted b/c of code-mapping\n      );\n      if (this.isEditable) {\n        this.contentsMorph.isEditable = true;\n        this.contentsMorph.enableSelecting();\n      }\n      this.contentsMorph.setColor(WHITE);\n    } else if (typeof this.contents === 'boolean') {\n      img = SpriteMorph.prototype.booleanMorph.call(\n        null,\n        this.contents\n      ).fullImage();\n      this.contentsMorph = new Morph();\n      this.contentsMorph.isCachingImage = true;\n      this.contentsMorph.bounds.setWidth(img.width);\n      this.contentsMorph.bounds.setHeight(img.height);\n      this.contentsMorph.cachedImage = img;\n    } else if (this.contents instanceof HTMLCanvasElement) {\n      img = this.contents;\n      this.contentsMorph = new Morph();\n      this.contentsMorph.isCachingImage = true;\n      this.contentsMorph.bounds.setWidth(img.width);\n      this.contentsMorph.bounds.setHeight(img.height);\n      this.contentsMorph.cachedImage = img;\n    } else if (this.contents instanceof Context) {\n      img = this.contents.image();\n      this.contentsMorph = new Morph();\n      this.contentsMorph.isCachingImage = true;\n      this.contentsMorph.bounds.setWidth(img.width);\n      this.contentsMorph.bounds.setHeight(img.height);\n      this.contentsMorph.cachedImage = img;\n    } else if (this.contents instanceof Costume) {\n      img = this.contents.thumbnail(new Point(40, 40));\n      this.contentsMorph = new Morph();\n      this.contentsMorph.isCachingImage = true;\n      this.contentsMorph.bounds.setWidth(img.width);\n      this.contentsMorph.bounds.setHeight(img.height);\n      this.contentsMorph.cachedImage = img;\n    } else if (this.contents instanceof Sound) {\n      this.contentsMorph = new SymbolMorph('notes', 30);\n    } else if (this.contents instanceof List) {\n      if (this.contents.isTable()) {\n        this.contentsMorph = new TableFrameMorph(new TableMorph(\n          this.contents,\n          10\n        ));\n        this.contentsMorph.expand(new Point(200, 150));\n      } else {\n        if (this.isCircular()) {\n          this.contentsMorph = new TextMorph(\n            '(...)',\n            fontSize,\n            null,\n            false, // bold\n            true, // italic\n            'center'\n          );\n          this.contentsMorph.setColor(WHITE);\n        } else {\n          this.contentsMorph = new ListWatcherMorph(\n            this.contents,\n            this\n          );\n        }\n      }\n      this.contentsMorph.isDraggable = false;\n    } else {\n      this.contentsMorph = new TextMorph(\n        !isNil(this.contents) ? this.contents.toString() : '',\n        fontSize,\n        null,\n        true,\n        false,\n        'center'\n      );\n      if (this.isEditable) {\n        this.contentsMorph.isEditable = true;\n        this.contentsMorph.enableSelecting();\n      }\n      this.contentsMorph.setColor(WHITE);\n    }\n    this.add(this.contentsMorph);\n  }\n};\n\n// CellMorph drawing:\n\nCellMorph.prototype.update = function () {\n  // special case for observing sprites\n  if (!isSnapObject(this.contents) && !(this.contents instanceof Costume)) {\n    return;\n  }\n  if (this.version !== this.contents.version) {\n    this.fixLayout();\n    this.rerender();\n    this.version = this.contents.version;\n  }\n};\n\nCellMorph.prototype.render = function (ctx) {\n  // draw my outline\n  if ((this.edge === 0) && (this.border === 0)) {\n    BoxMorph.uber.render.call(this, ctx);\n    return null;\n  }\n  ctx.fillStyle = this.color.toString();\n  ctx.beginPath();\n  this.outlinePath(\n    ctx,\n    Math.max(this.edge - this.border, 0),\n    this.border\n  );\n  ctx.closePath();\n  ctx.fill();\n  if (this.border > 0 && !MorphicPreferences.isFlat) {\n    ctx.lineWidth = this.border;\n    ctx.strokeStyle = this.borderColor.toString();\n    ctx.beginPath();\n    this.outlinePath(ctx, this.edge, this.border / 2);\n    ctx.closePath();\n    ctx.stroke();\n\n    if (useBlurredShadows) {\n      ctx.shadowOffsetX = this.border;\n      ctx.shadowOffsetY = this.border;\n      ctx.shadowBlur = this.border;\n      ctx.shadowColor = this.color.darker(80).toString();\n      this.drawShadow(ctx, this.edge, this.border / 2);\n    }\n  }\n};\n\nCellMorph.prototype.drawShadow = function (context, radius, inset) {\n  var offset = radius + inset,\n    w = this.width(),\n    h = this.height();\n\n  // bottom left:\n  context.beginPath();\n  context.moveTo(0, h - offset);\n  context.lineTo(0, offset);\n  context.stroke();\n\n  // top left:\n  context.beginPath();\n  context.arc(\n    offset,\n    offset,\n    radius,\n    radians(-180),\n    radians(-90),\n    false\n  );\n  context.stroke();\n\n  // top right:\n  context.beginPath();\n  context.moveTo(offset, 0);\n  context.lineTo(w - offset, 0);\n  context.stroke();\n};\n\n// CellMorph editing (inside list watchers):\n\nCellMorph.prototype.layoutChanged = function () {\n  var listWatcher = this.parentThatIsA(ListWatcherMorph);\n\n  // adjust my layout\n  this.bounds.setHeight(this.contentsMorph.height()\n    + this.edge\n    + this.border * 2);\n  this.bounds.setWidth(Math.max(\n    this.contentsMorph.width() + this.edge * 2,\n    (this.contents instanceof Context ||\n    this.contents instanceof List ? 0 : this.height() * 2)\n  ));\n\n  // position my contents\n  this.contentsMorph.setCenter(this.center());\n  this.rerender();\n\n  if (listWatcher) {\n    listWatcher.fixLayout();\n  }\n};\n\nCellMorph.prototype.reactToEdit = function (textMorph) {\n  var listWatcher;\n  if (!isNil(this.idx)) {\n    listWatcher = this.parentThatIsA(ListWatcherMorph);\n    if (listWatcher) {\n      listWatcher.list.put(\n        textMorph.text,\n        this.idx + listWatcher.start - 1\n      );\n    }\n  }\n};\n\nCellMorph.prototype.mouseClickLeft = function (pos) {\n  if (this.isEditable && this.contentsMorph instanceof TextMorph) {\n    this.contentsMorph.selectAllAndEdit();\n  } else {\n    this.escalateEvent('mouseClickLeft', pos);\n  }\n};\n\nCellMorph.prototype.mouseDoubleClick = function (pos) {\n  if (List.prototype.enableTables &&\n    this.currentValue instanceof List) {\n    new TableDialogMorph(this.contents).popUp(this.world());\n  } else {\n    this.escalateEvent('mouseDoubleClick', pos);\n  }\n};\n\n// WatcherMorph updating:\n\nWatcherMorph.prototype.update = function () {\n  var newValue, sprite, num, att,\n    isInherited = false;\n\n  if (this.target && this.getter) {\n    this.updateLabel();\n    if (this.target instanceof VariableFrame) {\n      newValue = this.target.vars[this.getter] ?\n        this.target.vars[this.getter].value : undefined;\n      if (newValue === undefined && this.target.owner) {\n        sprite = this.target.owner;\n        if (contains(sprite.inheritedVariableNames(), this.getter)) {\n          newValue = this.target.getVar(this.getter);\n          // ghost cell color\n          this.cellMorph.setColor(\n            SpriteMorph.prototype.blockColor.variables\n              .lighter(35)\n          );\n        } else {\n          this.destroy();\n          return;\n        }\n      } else {\n        // un-ghost the cell color\n        this.cellMorph.setColor(\n          SpriteMorph.prototype.blockColor.variables\n        );\n      }\n    } else {\n      newValue = this.target[this.getter]();\n\n      // determine whether my getter is an inherited attribute\n      att = {\n        xPosition: 'x position',\n        yPosition: 'y position',\n        direction: 'direction',\n        getCostumeIdx: 'costume #',\n        getScale: 'size',\n        getVolume: 'volume',\n        getPan: 'balance',\n        reportShown: 'shown?',\n        getPenDown: 'pen down?'\n      } [this.getter];\n      isInherited = att ? this.target.inheritsAttribute(att) : false;\n    }\n    if (newValue !== '' && !isNil(newValue)) {\n      num = +newValue;\n      if (typeof newValue !== 'boolean' && !isNaN(num)) {\n        newValue = Math.round(newValue * 1000000000) / 1000000000;\n      }\n    }\n    if (newValue === undefined) {\n      // console.log('removing watcher for', this.labelText);\n      this.destroy();\n      return;\n    }\n    if (newValue !== this.currentValue ||\n      isInherited !== this.isGhosted ||\n      (!isNil(newValue) &&\n        newValue.version &&\n        (newValue.version !== this.version)\n      )\n    ) {\n      this.changed();\n      this.cellMorph.contents = newValue;\n      this.isGhosted = isInherited;\n      if (isSnapObject(this.target)) {\n        if (isInherited) {\n          this.cellMorph.setColor(this.readoutColor.lighter(35));\n        } else {\n          this.cellMorph.setColor(this.readoutColor);\n        }\n      }\n      this.cellMorph.fixLayout();\n      if (!isNaN(newValue)) {\n        this.sliderMorph.value = newValue;\n        this.sliderMorph.fixLayout();\n      }\n      this.fixLayout();\n      if (this.currentValue && this.currentValue.version) {\n        this.version = this.currentValue.version;\n      } else {\n        this.version = Date.now();\n      }\n      this.currentValue = newValue;\n    }\n  }\n  if (this.cellMorph.contentsMorph instanceof ListWatcherMorph) {\n    this.cellMorph.contentsMorph.update();\n  } else if (isSnapObject(this.cellMorph.contents)) {\n    this.cellMorph.update();\n  }\n};\n\nexport {Costume}\nexport {SpriteMorph}\nexport {SpriteBubbleMorph}\nexport {CellMorph}\nexport {WatcherMorph}\n","// import  {HandleMorph} from \"./morphic\";\n// console.log(HandleMorph);\n//\n// import  {SymbolMorph} from \"./symbols\";\n// console.log(SymbolMorph);\n//\n// import {PushButtonMorph} from \"./widgets\";\n// let pbm = new PushButtonMorph();\n// console.log(pbm.is3D);\n\n\n// import {BlockSymbolMorph} from \"./blocks\";\n// let sfm = new BlockSymbolMorph();\n// console.log(sfm);\n//\n//\n// import {Process} from \"./threads\";\n// let sfm2 = new Process();\n// console.log(sfm2);\n\nimport {WorldMorph} from \"./morphic\";\nimport {IDE_Morph} from \"./gui\";\n// let ide = new IDE_Morph();\n// console.log(ide);\n\nvar world, ide;\nwindow.onload = function () {\n  world = new WorldMorph(document.getElementById('world'),\n    true, true);\n  world.worldCanvas.focus();\n  ide = new IDE_Morph();\n  ide.openIn(world);\n  loop();\n  if (window.onWorldLoaded) {\n    window.onWorldLoaded();\n  }\n};\nfunction loop() {\n  requestAnimationFrame(loop);\n  world.doOneCycle();\n}\n","/*\n\n    gui.js\n\n    a programming environment\n    based on morphic.js, blocks.js, threads.js and objects.js\n    inspired by Scratch\n\n    written by Jens Mnig\n    jens@moenig.org\n\n    Copyright (C) 2020 by Jens Mnig\n\n    This file is part of Snap!.\n\n    Snap! is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of\n    the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n\n    prerequisites:\n    --------------\n    needs blocks.js, threads.js, objects.js, cloud.jus and morphic.js\n\n\n    toc\n    ---\n    the following list shows the order in which all constructors are\n    defined. Use this list to locate code in this document:\n\n        IDE_Morph\n        ProjectDialogMorph\n        SpriteIconMorph\n        TurtleIconMorph\n        CostumeIconMorph\n        WardrobeMorph\n        StageHandleMorph\n        PaletteHandleMorph\n        CamSnapshotDialogMorph\n        SoundRecorderDialogMorph\n\n\n    credits\n    -------\n    Nathan Dinsmore contributed saving and loading of projects,\n    ypr-Snap! project conversion and countless bugfixes\n    Ian Reynolds contributed handling and visualization of sounds\n    Michael Ball contributed the LibraryImportDialogMorph and countless\n    utilities to load libraries from relative urls\n    Bernat Romagosa contributed more things than I can mention,\n    including interfacing to the camera and microphone\n\n*/\n\n/*global modules, Morph, SpriteMorph, SyntaxElementMorph, Color, Cloud, Audio,\nListWatcherMorph, TextMorph, newCanvas, useBlurredShadows, VariableFrame, Sound,\nStringMorph, Point, MenuMorph, morphicVersion, DialogBoxMorph, normalizeCanvas,\nToggleButtonMorph, contains, ScrollFrameMorph, StageMorph, PushButtonMorph, sb,\nInputFieldMorph, FrameMorph, Process, nop, SnapSerializer, ListMorph, detect,\nAlignmentMorph, TabMorph, Costume, MorphicPreferences,BlockMorph, ToggleMorph,\nInputSlotDialogMorph, ScriptsMorph, isNil, SymbolMorph, fontHeight,  localize,\nBlockExportDialogMorph, BlockImportDialogMorph, SnapTranslator, List, ArgMorph,\nUint8Array, HandleMorph, SVG_Costume, TableDialogMorph, CommentMorph, saveAs,\nCommandBlockMorph, BooleanSlotMorph, RingReporterSlotMorph, ScriptFocusMorph,\nBlockLabelPlaceHolderMorph, SpeechBubbleMorph, XML_Element, WatcherMorph, WHITE,\nBlockRemovalDialogMorph,TableMorph, isSnapObject, isRetinaEnabled, SliderMorph,\ndisableRetinaSupport, enableRetinaSupport, isRetinaSupported, MediaRecorder,\nAnimation, BoxMorph, BlockEditorMorph, BlockDialogMorph, Note, ZERO, BLACK*/\n\n// Global stuff ////////////////////////////////////////////////////////\nimport {sb} from './ypr'\n\nimport {\n  modules, Morph, Color\n  , TextMorph, newCanvas, useBlurredShadows,\n  StringMorph, Point, MenuMorph, morphicVersion, normalizeCanvas,\n  contains, ScrollFrameMorph,\n  FrameMorph, nop, ListMorph, detect,\n  MorphicPreferences, isNil, fontHeight, localize\n  , HandleMorph, SpeechBubbleMorph, WHITE, isRetinaEnabled, SliderMorph,\n  disableRetinaSupport, enableRetinaSupport, isRetinaSupported,\n  Animation, BoxMorph, ZERO, BLACK, isString\n} from './morphic'\n\nimport {SymbolMorph} from './symbols'\n\nimport {DialogBoxMorph, ToggleButtonMorph, PushButtonMorph,\n  InputFieldMorph, AlignmentMorph, TabMorph, ToggleMorph\n } from './widgets'\n\nimport {\n  SyntaxElementMorph,\n  ScriptsMorph,\n  ArgMorph,\n  CommentMorph,\n  CommandBlockMorph\n  ,\n  BooleanSlotMorph,\n  RingReporterSlotMorph,\n  ScriptFocusMorph,\n  InputSlotMorph,\n  RingMorph,\n  HatBlockMorph,\n  ReporterSlotMorph, CommandSlotMorph\n  ,\n} from './blocks'\n\nimport {BlockMorph, ReporterBlockMorph} from './runtime-blocks';\nimport { StageMorph, SVG_Costume, isSnapObject, Note, Sound,\n} from './objects'\nimport {Costume, SpriteMorph, SpriteBubbleMorph, CellMorph, WatcherMorph} from './runtime-objects';\n\n\nimport {ThreadManager, Process,VariableFrame, Context} from \"./runtime-threads\";\n\nimport {ListWatcherMorph, List} from './lists'\nimport {\n  InputSlotDialogMorph,\n  BlockExportDialogMorph,\n  BlockImportDialogMorph,\n  BlockLabelPlaceHolderMorph,\n  BlockRemovalDialogMorph,\n  BlockDialogMorph,\n  CustomCommandBlockMorph,\n  PrototypeHatBlockMorph\n} from './byob'\nimport {TableDialogMorph, TableFrameMorph, TableMorph} from './tables'\nimport {XML_Element} from './xml'\nimport { SnapSerializer} from './store'\nimport {SnapTranslater} from './locale'\nimport {Cloud} from './cloud'\nimport {saveAs} from './FileSaver.min'\n\n// import {} from './cloud'\n\nmodules.gui = '2020-November-19';\n\n// Declarations\n\n// var IDE_Morph;\n// var ProjectDialogMorph;\n// var LibraryImportDialogMorph;\n// var SpriteIconMorph;\n// var CostumeIconMorph;\n// var TurtleIconMorph;\n// var WardrobeMorph;\n// var SoundIconMorph;\n// var JukeboxMorph;\n// var StageHandleMorph;\n// var PaletteHandleMorph;\n// var CamSnapshotDialogMorph;\n// var SoundRecorderDialogMorph;\n\n// IDE_Morph ///////////////////////////////////////////////////////////\n\n// I am SNAP's top-level frame, the Editor window\n\n// IDE_Morph inherits from Morph:\n\nIDE_Morph.prototype = new Morph();\nIDE_Morph.prototype.constructor = IDE_Morph;\nIDE_Morph.uber = Morph.prototype;\n\n// IDE_Morph preferences settings and skins\n\nIDE_Morph.prototype.setDefaultDesign = function () {\n    MorphicPreferences.isFlat = false;\n    SpriteMorph.prototype.paletteColor = new Color(30, 30, 30);\n    SpriteMorph.prototype.paletteTextColor = new Color(230, 230, 230);\n    StageMorph.prototype.paletteTextColor\n        = SpriteMorph.prototype.paletteTextColor;\n    StageMorph.prototype.paletteColor = SpriteMorph.prototype.paletteColor;\n    SpriteMorph.prototype.sliderColor\n        = SpriteMorph.prototype.paletteColor.lighter(30);\n\n    IDE_Morph.prototype.buttonContrast = 30;\n    IDE_Morph.prototype.backgroundColor = new Color(10, 10, 10);\n    IDE_Morph.prototype.frameColor = SpriteMorph.prototype.paletteColor;\n\n    IDE_Morph.prototype.groupColor\n        = SpriteMorph.prototype.paletteColor.lighter(5);\n    IDE_Morph.prototype.sliderColor = SpriteMorph.prototype.sliderColor;\n    IDE_Morph.prototype.buttonLabelColor = WHITE;\n    IDE_Morph.prototype.tabColors = [\n        IDE_Morph.prototype.groupColor.darker(50),\n        IDE_Morph.prototype.groupColor.darker(25),\n        IDE_Morph.prototype.groupColor\n    ];\n    IDE_Morph.prototype.rotationStyleColors = IDE_Morph.prototype.tabColors;\n    IDE_Morph.prototype.appModeColor = BLACK;\n    IDE_Morph.prototype.scriptsPaneTexture = this.scriptsTexture();\n    IDE_Morph.prototype.padding = 1;\n\n    SpriteIconMorph.prototype.labelColor\n        = IDE_Morph.prototype.buttonLabelColor;\n    CostumeIconMorph.prototype.labelColor\n        = IDE_Morph.prototype.buttonLabelColor;\n    SoundIconMorph.prototype.labelColor\n        = IDE_Morph.prototype.buttonLabelColor;\n    TurtleIconMorph.prototype.labelColor\n        = IDE_Morph.prototype.buttonLabelColor;\n\n    SyntaxElementMorph.prototype.contrast = 65;\n    ScriptsMorph.prototype.feedbackColor = WHITE;\n};\n\nIDE_Morph.prototype.setFlatDesign = function () {\n    MorphicPreferences.isFlat = true;\n    SpriteMorph.prototype.paletteColor = WHITE;\n    SpriteMorph.prototype.paletteTextColor = new Color(70, 70, 70);\n    StageMorph.prototype.paletteTextColor\n        = SpriteMorph.prototype.paletteTextColor;\n    StageMorph.prototype.paletteColor = SpriteMorph.prototype.paletteColor;\n    SpriteMorph.prototype.sliderColor = SpriteMorph.prototype.paletteColor;\n\n    IDE_Morph.prototype.buttonContrast = 30;\n    IDE_Morph.prototype.backgroundColor = new Color(220, 220, 230);\n    IDE_Morph.prototype.frameColor = new Color(240, 240, 245);\n\n    IDE_Morph.prototype.groupColor = WHITE;\n    IDE_Morph.prototype.sliderColor = SpriteMorph.prototype.sliderColor;\n    IDE_Morph.prototype.buttonLabelColor = new Color(70, 70, 70);\n    IDE_Morph.prototype.tabColors = [\n        IDE_Morph.prototype.frameColor,\n        IDE_Morph.prototype.frameColor.lighter(50),\n        IDE_Morph.prototype.groupColor\n    ];\n    IDE_Morph.prototype.rotationStyleColors = IDE_Morph.prototype.tabColors;\n    IDE_Morph.prototype.appModeColor = IDE_Morph.prototype.frameColor;\n    IDE_Morph.prototype.scriptsPaneTexture = null;\n    IDE_Morph.prototype.padding = 1;\n\n    SpriteIconMorph.prototype.labelColor\n        = IDE_Morph.prototype.buttonLabelColor;\n    CostumeIconMorph.prototype.labelColor\n        = IDE_Morph.prototype.buttonLabelColor;\n    SoundIconMorph.prototype.labelColor\n        = IDE_Morph.prototype.buttonLabelColor;\n    TurtleIconMorph.prototype.labelColor\n        = IDE_Morph.prototype.buttonLabelColor;\n\n    SyntaxElementMorph.prototype.contrast = 25;\n    ScriptsMorph.prototype.feedbackColor = new Color(153, 255, 213);\n};\n\nIDE_Morph.prototype.scriptsTexture = function () {\n    var pic = newCanvas(new Point(100, 100)), // bigger scales faster\n        ctx = pic.getContext('2d'),\n        i;\n    for (i = 0; i < 100; i += 4) {\n        ctx.fillStyle = this.frameColor.toString();\n        ctx.fillRect(i, 0, 1, 100);\n        ctx.fillStyle = this.groupColor.lighter(2).toString();\n        ctx.fillRect(i + 1, 0, 1, 100);\n        ctx.fillRect(i + 3, 0, 1, 100);\n        ctx.fillStyle = this.groupColor.darker(2).toString();\n        ctx.fillRect(i + 2, 0, 1, 100);\n    }\n    return pic;\n};\n\nIDE_Morph.prototype.setDefaultDesign();\n\n// IDE_Morph instance creation:\n\nexport function IDE_Morph(isAutoFill) {\n    this.init(isAutoFill);\n}\n\nIDE_Morph.prototype.init = function (isAutoFill) {\n    // global font setting\n    MorphicPreferences.globalFontFamily = 'Helvetica, Arial';\n\n    // restore saved user preferences\n    this.userLanguage = null; // user language preference for startup\n    this.projectsInURLs = false;\n    this.applySavedSettings();\n\n    // additional properties:\n    this.cloud = new Cloud();\n    this.cloudMsg = null;\n    this.source = null;\n    this.serializer = new SnapSerializer();\n\n    this.globalVariables = new VariableFrame();\n    this.currentSprite = new SpriteMorph(this.globalVariables);\n    this.sprites = new List([this.currentSprite]);\n    this.currentCategory = 'motion';\n    this.currentTab = 'scripts';\n    this.projectName = '';\n    this.projectNotes = '';\n\n    // logoURL is disabled because the image data is hard-copied\n    // to avoid tainting the world canvas\n    // this.logoURL = this.resourceURL('src', 'snap_logo_sm.png');\n\n    this.logo = null;\n    this.controlBar = null;\n    this.categories = null;\n    this.palette = null;\n    this.paletteHandle = null;\n    this.spriteBar = null;\n    this.spriteEditor = null;\n    this.stage = null;\n    this.stageHandle = null;\n    this.corralBar = null;\n    this.corral = null;\n\n    this.embedPlayButton = null;\n    this.embedOverlay = null;\n    this.isEmbedMode = false;\n\n    this.isAutoFill = isAutoFill === undefined ? true : isAutoFill;\n    this.isAppMode = false;\n    this.isSmallStage = false;\n    this.filePicker = null;\n    this.hasChangedMedia = false;\n\n    this.isAnimating = true;\n    this.paletteWidth = 200; // initially same as logo width\n    this.stageRatio = 1; // for IDE animations, e.g. when zooming\n\n\tthis.wasSingleStepping = false; // for toggling to and from app mode\n\n    this.loadNewProject = false; // flag when starting up translated\n    this.shield = null;\n\n    this.savingPreferences = true; // for bh's infamous \"Eisenbergification\"\n\n    // initialize inherited properties:\n    IDE_Morph.uber.init.call(this);\n\n    // override inherited properites:\n    this.color = this.backgroundColor;\n};\n\nIDE_Morph.prototype.openIn = function (world) {\n    // Trace.log('IDE.opened');\n\n    var hash, myself = this, urlLanguage = null;\n\n    function initUser(username) {\n        sessionStorage.username = username;\n        myself.controlBar.cloudButton.refresh();\n        if (username) {\n            myself.source = 'cloud';\n            if (!myself.cloud.verified) {\n                new DialogBoxMorph().inform(\n                    'Unverified account',\n                    'Your account is still unverified.\\n' +\n                    'Please use the verification link that\\n' +\n                    'was sent to your email address when you\\n' +\n                    'signed up.\\n\\n' +\n                    'If you cannot find that email, please\\n' +\n                    'check your spam folder. If you still\\n' +\n                    'cannot find it, please use the \"Resend\\n' +\n                    'Verification Email...\" option in the cloud\\n' +\n                    'menu.',\n                    world,\n                    myself.cloudIcon(null, new Color(0, 180, 0))\n                );\n            }\n        }\n    }\n\n    this.buildPanes();\n    world.add(this);\n    world.userMenu = this.userMenu;\n\n    // override SnapCloud's user message with Morphic\n    this.cloud.message = (string) => {\n        var m = new MenuMorph(null, string),\n            intervalHandle;\n        m.popUpCenteredInWorld(world);\n        intervalHandle = setInterval(() => {\n            m.destroy();\n            clearInterval(intervalHandle);\n        }, 2000);\n    };\n\n    // prevent non-DialogBoxMorphs from being dropped\n    // onto the World in user-mode\n    world.reactToDropOf = (morph) => {\n        if (!(morph instanceof DialogBoxMorph ||\n        \t\t(morph instanceof MenuMorph))) {\n            if (world.hand.grabOrigin) {\n                morph.slideBackTo(world.hand.grabOrigin);\n            } else {\n                world.hand.grab(morph);\n            }\n        }\n    };\n\n    this.reactToWorldResize(world.bounds);\n\n    function applyFlags(dict) {\n        if (dict.noCloud) {\n            myself.cloud.disable();\n        }\n        if (dict.embedMode) {\n            myself.setEmbedMode();\n        }\n        if (dict.editMode) {\n            myself.toggleAppMode(false);\n        } else {\n            myself.toggleAppMode(true);\n        }\n        if (!dict.noRun) {\n            autoRun();\n        }\n        if (dict.hideControls) {\n            myself.controlBar.hide();\n            window.onbeforeunload = nop;\n        }\n        if (dict.noExitWarning) {\n            window.onbeforeunload = nop;\n        }\n        if (dict.lang) {\n            myself.setLanguage(dict.lang, null, true); // don't persist\n        }\n\n        // only force my world to get focus if I'm not in embed mode\n        // to prevent the iFrame from involuntarily scrolling into view\n        if (!myself.isEmbedMode) {\n            world.worldCanvas.focus();\n        }\n    }\n\n    function autoRun () {\n        // wait until all costumes and sounds are loaded\n        if (isLoadingAssets()) {\n            myself.world().animations.push(\n                new Animation(nop, nop, 0, 200, nop, autoRun)\n            );\n        } else {\n            myself.runScripts();\n        }\n    }\n\n    function isLoadingAssets() {\n        return myself.sprites.asArray().concat([myself.stage]).some(any =>\n            (any.costume ? any.costume.loaded !== true : false) ||\n            any.costumes.asArray().some(each => each.loaded !== true) ||\n            any.sounds.asArray().some(each => each.loaded !== true)\n        );\n    }\n\n    // dynamic notifications from non-source text files\n    // has some issues, commented out for now\n    /*\n    this.cloudMsg = getURL('https://snap.berkeley.edu/cloudmsg.txt');\n    motd = getURL('https://snap.berkeley.edu/motd.txt');\n    if (motd) {\n        this.inform('Snap!', motd);\n    }\n    */\n\n    function interpretUrlAnchors() {\n        var dict, idx;\n\n        if (location.hash.substr(0, 6) === '#open:') {\n            hash = location.hash.substr(6);\n            if (hash.charAt(0) === '%'\n                    || hash.search(/\\%(?:[0-9a-f]{2})/i) > -1) {\n                hash = decodeURIComponent(hash);\n            }\n            if (contains(\n                    ['project', 'blocks', 'sprites', 'snapdata'].map(each =>\n                        hash.substr(0, 8).indexOf(each)\n                    ),\n                    1\n                )) {\n                this.droppedText(hash);\n            } else {\n                idx = hash.indexOf(\"&\");\n                if (idx > 0) {\n                    dict = myself.cloud.parseDict(hash.substr(idx));\n                    dict.editMode = true;\n                    hash = hash.slice(0, idx);\n                    applyFlags(dict);\n                }\n                this.shield = new Morph();\n                this.shield.alpha = 0;\n                this.shield.setExtent(this.parent.extent());\n                this.parent.add(this.shield);\n                this.showMessage('Fetching project...');\n\n                this.getURL(\n                    hash,\n                    projectData => {\n                        var msg;\n                        this.nextSteps([\n                            () => msg = this.showMessage('Opening project...'),\n                            () => {\n                                if (projectData.indexOf('<snapdata') === 0) {\n                                    this.rawOpenCloudDataString(projectData);\n                                } else if (\n                                    projectData.indexOf('<project') === 0\n                                ) {\n                                    this.rawOpenProjectString(projectData);\n                                }\n                                this.hasChangedMedia = true;\n                            },\n                            () => {\n                                this.shield.destroy();\n                                this.shield = null;\n                                msg.destroy();\n                                this.toggleAppMode(false);\n                            }\n                        ]);\n                    }\n                );\n            }\n        } else if (location.hash.substr(0, 5) === '#run:') {\n            hash = location.hash.substr(5);\n            idx = hash.indexOf(\"&\");\n            if (idx > 0) {\n                hash = hash.slice(0, idx);\n            }\n            if (hash.charAt(0) === '%'\n                    || hash.search(/\\%(?:[0-9a-f]{2})/i) > -1) {\n                hash = decodeURIComponent(hash);\n            }\n            if (hash.substr(0, 8) === '<project>') {\n                this.rawOpenProjectString(hash);\n                applyFlags(myself.cloud.parseDict(location.hash.substr(5)));\n            } else {\n                this.shield = new Morph();\n                this.shield.alpha = 0;\n                this.shield.setExtent(this.parent.extent());\n                this.parent.add(this.shield);\n                this.showMessage('Fetching project...');\n\n                this.getURL(\n                    hash,\n                    projectData => {\n                        var msg;\n                        this.nextSteps([\n                            () => msg = this.showMessage('Opening project...'),\n                            () => {\n                                if (projectData.indexOf('<snapdata') === 0) {\n                                    this.rawOpenCloudDataString(projectData);\n                                } else if (\n                                    projectData.indexOf('<project') === 0\n                                ) {\n                                    this.rawOpenProjectString(projectData);\n                                }\n                                this.hasChangedMedia = true;\n                            },\n                            () => {\n                                this.shield.destroy();\n                                this.shield = null;\n                                msg.destroy();\n                                // this.toggleAppMode(true);\n                                applyFlags(\n                                    this.cloud.parseDict(\n                                        location.hash.substr(5)\n                                    )\n                                );\n                            }\n                        ]);\n                    }\n                );\n            }\n        } else if (location.hash.substr(0, 9) === '#present:') {\n            this.shield = new Morph();\n            this.shield.color = this.color;\n            this.shield.setExtent(this.parent.extent());\n            this.parent.add(this.shield);\n            myself.showMessage('Fetching project\\nfrom the cloud...');\n\n            // make sure to lowercase the username\n            dict = myself.cloud.parseDict(location.hash.substr(9));\n            dict.Username = dict.Username.toLowerCase();\n\n            myself.cloud.getPublicProject(\n                dict.ProjectName,\n                dict.Username,\n                projectData => {\n                    var msg;\n                    myself.nextSteps([\n                        () => msg = myself.showMessage('Opening project...'),\n                        () => {\n                            if (projectData.indexOf('<snapdata') === 0) {\n                                myself.rawOpenCloudDataString(projectData);\n                            } else if (\n                                projectData.indexOf('<project') === 0\n                            ) {\n                                myself.rawOpenProjectString(projectData);\n                            }\n                            myself.hasChangedMedia = true;\n                        },\n                        () => {\n                            myself.shield.destroy();\n                            myself.shield = null;\n                            msg.destroy();\n                            applyFlags(dict);\n                        }\n                    ]);\n                },\n                this.cloudError()\n            );\n        } else if (location.hash.substr(0, 7) === '#cloud:') {\n            this.shield = new Morph();\n            this.shield.alpha = 0;\n            this.shield.setExtent(this.parent.extent());\n            this.parent.add(this.shield);\n            myself.showMessage('Fetching project\\nfrom the cloud...');\n\n            // make sure to lowercase the username\n            dict = myself.cloud.parseDict(location.hash.substr(7));\n\n            myself.cloud.getPublicProject(\n                dict.ProjectName,\n                dict.Username,\n                projectData => {\n                    var msg;\n                    myself.nextSteps([\n                        () => msg = myself.showMessage('Opening project...'),\n                        () => {\n                            if (projectData.indexOf('<snapdata') === 0) {\n                                myself.rawOpenCloudDataString(projectData);\n                            } else if (\n                                projectData.indexOf('<project') === 0\n                            ) {\n                                myself.rawOpenProjectString(projectData);\n                            }\n                            myself.hasChangedMedia = true;\n                        },\n                        () => {\n                            myself.shield.destroy();\n                            myself.shield = null;\n                            msg.destroy();\n                            myself.toggleAppMode(false);\n                        }\n                    ]);\n                },\n                this.cloudError()\n            );\n        } else if (location.hash.substr(0, 4) === '#dl:') {\n            myself.showMessage('Fetching project\\nfrom the cloud...');\n\n            // make sure to lowercase the username\n            dict = myself.cloud.parseDict(location.hash.substr(4));\n            dict.Username = dict.Username.toLowerCase();\n\n            myself.cloud.getPublicProject(\n                dict.ProjectName,\n                dict.Username,\n                projectData => {\n                \tmyself.saveXMLAs(projectData, dict.ProjectName);\n                 \tmyself.showMessage(\n                  \t   'Saved project\\n' + dict.ProjectName,\n                      \t2\n                 \t);\n                },\n                this.cloudError()\n            );\n        } else if (location.hash.substr(0, 6) === '#lang:') {\n            urlLanguage = location.hash.substr(6);\n            this.setLanguage(urlLanguage, null, true); // don't persist\n            this.loadNewProject = true;\n        } else if (location.hash.substr(0, 7) === '#signup') {\n            this.createCloudAccount();\n        }\n        this.loadNewProject = false;\n    }\n\n    if (this.userLanguage) {\n        this.loadNewProject = true;\n        this.setLanguage(this.userLanguage, interpretUrlAnchors);\n    } else {\n        interpretUrlAnchors.call(this);\n    }\n\n    if (location.protocol !== 'file:') {\n        if (!sessionStorage.username) {\n            // check whether login should persist across browser sessions\n            this.cloud.initSession(initUser);\n        } else {\n            // login only persistent during a single browser session\n            this.cloud.checkCredentials(initUser);\n        }\n    }\n\n    world.keyboardFocus = this.stage;\n    this.warnAboutIE();\n};\n\n// IDE_Morph construction\n\nIDE_Morph.prototype.buildPanes = function () {\n    this.createLogo();\n    this.createControlBar();\n    this.createCategories();\n    this.createPalette();\n    this.createStage();\n    this.createSpriteBar();\n    this.createSpriteEditor();\n    this.createCorralBar();\n    this.createCorral();\n};\n\nIDE_Morph.prototype.createLogo = function () {\n    var myself = this;\n\n    if (this.logo) {\n        this.logo.destroy();\n    }\n\n    this.logo = new Morph();\n\n    // the logo texture is not loaded dynamically as an image, but instead\n    // hard-copied here to avoid tainting the world canvas. This lets us\n    // use Snap's (and Morphic's) color pickers to sense any pixel which\n    // otherwise would be compromised by annoying browser security.\n\n    // this.logo.texture = this.logoURL; // original code, commented out\n    this.logo.texture = \"data:image/png;base64,\" +\n        \"iVBORw0KGgoAAAANSUhEUgAAACwAAAAYCAYAAACBbx+6AAAKiklEQVRYR5VXe3BU5RX/\" +\n        \"ne+7924SwiOEJJvwUCAgCZFBEtRatIlVlATLIwlFsCgdeYWICu1MfbKUabVVtBoDQlUc\" +\n        \"FCubEIpAAEUTrGhFGIXAAjZCFdhNQiTkQbK7997vdO7SREAo9P5zZ77HOb9zzu87D8JV\" +\n        \"fOyBwGIwEdg5XrcmKRExcoSCNQKgWwXRTYKQDAKUQi1DbASrjzgsdqdM8zc6d6o80LIB\" +\n        \"RR6oq1B52SN0pcteL+SUKbCdcw3lCUMsof2amAs0iVRNEoIhZYKoCcTtYBARxUUZ1IMZ\" +\n        \"CIZxWDG9oVSv1/tP8Z12ZHAVNMqBdSW9l9uPAGYGoQwicqjQUQsmZ9kLSf8FGyhzzyCB\" +\n        \"P8X1kO7TLaoREJuIxCeSzKNhWzRbKhgyRCwJZfcA2UOY+E4QTewZK2Ob2tQhIl6cPLmu\" +\n        \"LKLPC+n8O2X/P+CJAXLAXXzpfLD+sqRHesaKF5vbHZtil4bCA98YeO+2f19J0Yl3+wzV\" +\n        \"DH0GMz8cE0WxHSH8DZrxhPsX3x7rBO5YUFgI1Um3y8r0sCg8WOZgBQ54YPTJGNCPgehw\" +\n        \"qNl/zfTmJoe3Dt9OeN15LgObTUs/JNB9prvA9/mljNvblCkyh+7l6p3AxVxt2JiQalty\" +\n        \"IYB5AL5n5qWh1vqVA2cieCWjz+07AXd8C+eZAP71SY8Q6JlzfuajDPFMSkHg7brtSd1w\" +\n        \"Vr2hVIymxX97f2IO2nCPP2be0EDaWZuMVttoP2tGBd5/dfCpToHnKMZUvWSJzP5ZNSin\" +\n        \"uouv9RXX/MRW9lMgHkekaqCsVZDmZnfD4JMI7LXPPUgHXATaBVEvLDrg7tBgRDbrK9wz\" +\n        \"GHwnM0Xrmsg3bT4eC5XV2FzfYnS/fkzK9zU7aQ7MXxbvnxkk8UhYUTcGTGJyMsM/Okw5\" +\n        \"s3rVdY2Zs/foe1MyIw8UHjA8oCosEUA1cjw/AA94M/KUMOcQBW8gsptYuXYpa8Cr/aZW\" +\n        \"7Sss9Mrhw33swWJkV1eL6uoc6wFPVVRDo3stmDN/xOFAed95EHYps7o/Jb/hrc6QTXt0\" +\n        \"/4QzYa1Egd7TyCq3WEgBGkggMyGhbt2bnpyrDO8PJDizAYPbbS21Tw+rXk+BjzIQvhRF\" +\n        \"8ub6MlhiF4h6dKU1J1M4xD+xvnc/CaMKpN5LntywqHM9d77vrwCNrCxNG32x0Oxs1lzp\" +\n        \"vmtdQVnfe0DArGvsczNskUAaareWDP/SOT+2qKa/DkrtLu14k8HrW+JrsKbf1xFZN3ES\" +\n        \"khrbJ7tPxYYMMRpsxQi4ajaVDjnobI8vrslWLLc6186lNYBqX041hiyoDR339ovWNGs7\" +\n        \"GA3J+XUFneDGFft+T4zfCsYDm5enrzsfdF7R12lM1jsAfcPgNmJkMqE3AfEMWqYTlVpK\" +\n        \"vcDAbSCcEUCcIO6jSyzWSW04a8rXmGAw4yQYg5nQkxi9GHhu6/L0pbnzfbcxoZIUFXd5\" +\n        \"2KlEOR5Yfm/cACFduxnCl5zvv70TWN68/YNYauVSi77BNjs2CmDVQKF/WFIyJPTzh48m\" +\n        \"GVbwCwK6E+MJJtpBLKUi+1kC3wNShbaF40KDrkM7FrQ0S5PmsyCMd5xAzHMVYRgzzbCV\" +\n        \"/jkb4Z66En/WpGuisjryFIkGsFqrWN0XAXx+NQuUpyyJ70VPnz5jfapc7RNS7mltXLly\" +\n        \"tj5nzipzbPG+gTrrTzIwQ2guTZmhHUoXxdteGnYkd/6hfUR8cMsr6dM6jcwt+nokkbkL\" +\n        \"JBdseWXY6+dH5a6iw3dLUiuYsQJEPwXQurU07b7OM3c9ery3DLceAdHHgvl1xVQYIvzG\" +\n        \"AUzshXCqTsP65NtsxioQWgAVw2w/kFLQuGfPykw9a84eqzPV3D2vZgQJ7UEp9YfYDtXa\" +\n        \"mhwvLHs5QTRvKU2b3AW4+ND1YOwQQi3cXDJ8be78QwsZGCXAUgFDCdRPET8uGGMBiqlM\" +\n        \"WDcBHo9yMkVZ2RQ7d75vEzMGMMmFUqqO0b2H/dMBGym/zBB1Fe6PwBAgvAxgBYMWpuQH\" +\n        \"3nLq/5KdrA42f+Y69WXIdFKNA2pcsW+iYLzDjBIQZwHUWlmaNqnTsNzimiywtoFhL2PI\" +\n        \"YQTOZfDbAH1B4CwCTSfiJxXTHQTun5gQk/emZ2Aw3XPA8HkywuOKfZXElFJZmjYykik9\" +\n        \"LLrSWl1F0iyXIVaFgmqa5rI+NsO680LXJufXzedIo3ZhIv/Bi75qAvwMpEChrnJ52r1d\" +\n        \"kSg6MlqStYZBxwFKZ4XpW1ek7XTuTiiq6W+SfA/Ez4FxB0EkbylNG3fem4ljoR1hoFLY\" +\n        \"eJ50Kdtq/AcjHG7cFN/XDOu7AWpOzg+kH/DCiJdJXzFLocX7s5wK9+CivZnfne3WM0rD\" +\n        \"4ZYwhWO7dbjskD6VSPwOij1MmE2E+srS9LFdmWXu4dtJU2VgOgxgqFDqKc0V827YDCaC\" +\n        \"uIgYs1hxMQTdAubbFctJ21YM2z95ti85aGA5gFGsuISIHgNwshurWyKAAxXJy7q5sLA1\" +\n        \"qGb1za9/zVnzlyeu6h7TbdbZjmNT3flYN3XBvj+22noRA8cY6CBCFJgSFdQaM6ReMlyi\" +\n        \"nEDHKkvTZ3R5f77vTmIuZYlXSNEoEPKZcRiMehAsJ4URsEIJSiPmOQT+EKAWJhoEcIKm\" +\n        \"xFxbKottVICwrrI0fTY5Pa5N8iunh2i3w2MGT2lqdhTWlSWNj4kxNp0Nth8Qoe/vSCph\" +\n        \"c2rWgYk2EE8gYZNqs1l88feSjN0RPj908AZlo3X78uG1nYBnPHYoHh0dQweh+ZCzdgjx\" +\n        \"eU5B0Q0+2MduOtAsY+Paw3qo1daeAXFSFJnLJIm+LIi6a+Hq1ctG+bwvfBq97pueg4TR\" +\n        \"42jZi/07KFDh9ib20gpPnbH/4J4ceHLPSuhZc2AeW31tVFT34Fp3ojE50Gi9n5zqn0oj\" +\n        \"0HSp0nmpNY/HIzwez1VNF+OLD35gM4W3lqbn/W/5TBRYn7iISPaxFXn7Fvi/9Hgg0tNB\" +\n        \"zpRR571mIMtgSbcokXe2PcavKLaCYR4DFBT1qvWfnFZ984IFLU4rugRVoroaqKrKsZ0e\" +\n        \"0OmxT3qzrlOC7pZojmbWmcggWylACNh2nBYb9VG4LTy9ZuqOJY/31my9dMziF3vGvDug\" +\n        \"pSPb0GWzBdkEwWSdbs/aOPxXZZHIXTAidTbzzj9Srwns35QSgzDfJdjKBon+DM1m5gwi\" +\n        \"dAjhL0yahG/+VZnqSt1dazoC9yZDZs6G5dwNbEhcBIXHAdpFZCu2NQ0kmahdWZyoubQj\" +\n        \"aLMmbc/Z9pdR6a4Qv5bzYK2ufTwmZGUoTXxnsooxGByWetPTSRPC+yN9zeVC4OBd4gF5\" +\n        \"zhsanUY/w4PwiQ19R0plvQWmpckFdd7Lyagrd29i4Nvkgrpix/DTHaboHa1HaCKMDFLh\" +\n        \"9/lIo0c9/dmUOKkpXj36+TOuPm+KU8ZYSggfYGHYpMKSP+nwhzrnSnLCWZYOutyYEpm/\" +\n        \"fOCLp9268uQXQOpGZnKKTBtLinaYAgJJojZWfCsDBSTlFPfEEzVXy/3/5UCHZlecmh0B\" +\n        \"jrfLvBAJPlC/G1PlkNza0OkP4noGW4zVhkaTTAsWsTNnkDP02XSu82oTTPOSCgJvOw85\" +\n        \"0xE09MezY9mpQp7i87IHwOJ0IiRcSNOIAdkRmZEJ5D9/VBCtnsd7nAAAAABJRU5ErkJg\" +\n        \"gg==\";\n\n    this.logo.render = function (ctx) {\n        var gradient = ctx.createLinearGradient(\n                0,\n                0,\n                this.width(),\n                0\n            );\n        gradient.addColorStop(0, 'black');\n        gradient.addColorStop(0.5, myself.frameColor.toString());\n        ctx.fillStyle = MorphicPreferences.isFlat ?\n                myself.frameColor.toString() : gradient;\n        ctx.fillRect(0, 0, this.width(), this.height());\n        if (this.cachedTexture) {\n            this.renderCachedTexture(ctx);\n        } else if (this.texture) {\n            this.renderTexture(this.texture, ctx);\n        }\n    };\n\n    this.logo.renderCachedTexture = function (ctx) {\n        ctx.drawImage(\n            this.cachedTexture,\n            5,\n            Math.round((this.height() - this.cachedTexture.height) / 2)\n        );\n        this.changed();\n    };\n\n    this.logo.mouseClickLeft = function () {\n        myself.snapMenu();\n    };\n\n    this.logo.color = BLACK;\n    this.logo.setExtent(new Point(200, 28)); // dimensions are fixed\n    this.add(this.logo);\n};\n\nIDE_Morph.prototype.createControlBar = function () {\n    // assumes the logo has already been created\n    var padding = 5,\n        button,\n        slider,\n        stopButton,\n        pauseButton,\n        startButton,\n        projectButton,\n        settingsButton,\n        stageSizeButton,\n        appModeButton,\n        steppingButton,\n        cloudButton,\n        x,\n        colors = MorphicPreferences.isFlat ? this.tabColors\n        : [\n            this.groupColor,\n            this.frameColor.darker(50),\n            this.frameColor.darker(50)\n        ],\n        myself = this;\n\n    if (this.controlBar) {\n        this.controlBar.destroy();\n    }\n\n    this.controlBar = new Morph();\n    this.controlBar.color = this.frameColor;\n    this.controlBar.setHeight(this.logo.height()); // height is fixed\n\n    // let users manually enforce re-layout when changing orientation\n    // on mobile devices\n    this.controlBar.mouseClickLeft = function () {\n        this.world().fillPage();\n    };\n\n    this.add(this.controlBar);\n\n    //smallStageButton\n    button = new ToggleButtonMorph(\n        null, //colors,\n        this, // the IDE is the target\n        'toggleStageSize',\n        [\n            new SymbolMorph('smallStage', 14),\n            new SymbolMorph('normalStage', 14)\n        ],\n        () => this.isSmallStage // query\n    );\n\n    button.hasNeutralBackground = true;\n    button.corner = 12;\n    button.color = colors[0];\n    button.highlightColor = colors[1];\n    button.pressColor = colors[0];\n    button.labelMinExtent = new Point(36, 18);\n    button.padding = 0;\n    button.labelShadowOffset = new Point(-1, -1);\n    button.labelShadowColor = colors[1];\n    button.labelColor = MorphicPreferences.isFlat ?\n        WHITE\n        : this.buttonLabelColor;\n    button.contrast = this.buttonContrast;\n    // button.hint = 'stage size\\nsmall & normal';\n    button.fixLayout();\n    button.refresh();\n    stageSizeButton = button;\n    this.controlBar.add(stageSizeButton);\n    this.controlBar.stageSizeButton = button; // for refreshing\n\n    //appModeButton\n    button = new ToggleButtonMorph(\n        null, //colors,\n        this, // the IDE is the target\n        'toggleAppMode',\n        [\n            new SymbolMorph('fullScreen', 14),\n            new SymbolMorph('normalScreen', 14)\n        ],\n        () => this.isAppMode // query\n    );\n\n    button.hasNeutralBackground = true;\n    button.corner = 12;\n    button.color = colors[0];\n    button.highlightColor = colors[1];\n    button.pressColor = colors[0];\n    button.labelMinExtent = new Point(36, 18);\n    button.padding = 0;\n    button.labelShadowOffset = new Point(-1, -1);\n    button.labelShadowColor = colors[1];\n    button.labelColor = this.buttonLabelColor;\n    button.contrast = this.buttonContrast;\n    // button.hint = 'app & edit\\nmodes';\n    button.fixLayout();\n    button.refresh();\n    appModeButton = button;\n    this.controlBar.add(appModeButton);\n    this.controlBar.appModeButton = appModeButton; // for refreshing\n\n    //steppingButton\n    button = new ToggleButtonMorph(\n        null, //colors,\n        this, // the IDE is the target\n        'toggleSingleStepping',\n        [\n            new SymbolMorph('footprints', 16),\n            new SymbolMorph('footprints', 16)\n        ],\n        () => Process.prototype.enableSingleStepping // query\n    );\n\n    button.corner = 12;\n    button.color = colors[0];\n    button.highlightColor = colors[1];\n    button.pressColor = new Color(153, 255, 213);\n    button.labelMinExtent = new Point(36, 18);\n    button.padding = 0;\n    button.labelShadowOffset = new Point(-1, -1);\n    button.labelShadowColor = colors[1];\n    button.labelColor = this.buttonLabelColor;\n    button.contrast = this.buttonContrast;\n    button.hint = 'Visible stepping';\n    button.fixLayout();\n    button.refresh();\n    steppingButton = button;\n    this.controlBar.add(steppingButton);\n    this.controlBar.steppingButton = steppingButton; // for refreshing\n\n    // stopButton\n    button = new ToggleButtonMorph(\n        null, // colors\n        this, // the IDE is the target\n        'stopAllScripts',\n        [\n            new SymbolMorph('octagon', 14),\n            new SymbolMorph('square', 14)\n        ],\n        () => this.stage ? // query\n                myself.stage.enableCustomHatBlocks &&\n                    myself.stage.threads.pauseCustomHatBlocks\n            : true\n    );\n\n    button.corner = 12;\n    button.color = colors[0];\n    button.highlightColor = colors[1];\n    button.pressColor = colors[2];\n    button.labelMinExtent = new Point(36, 18);\n    button.padding = 0;\n    button.labelShadowOffset = new Point(-1, -1);\n    button.labelShadowColor = colors[1];\n    button.labelColor = new Color(\n        MorphicPreferences.isFlat ? 128 : 200,\n        0,\n        0\n    );\n    button.contrast = this.buttonContrast;\n    // button.hint = 'stop\\nevery-\\nthing';\n    button.fixLayout();\n    button.refresh();\n    stopButton = button;\n    this.controlBar.add(stopButton);\n    this.controlBar.stopButton = stopButton; // for refreshing\n\n    //pauseButton\n    button = new ToggleButtonMorph(\n        null, //colors,\n        this, // the IDE is the target\n        'togglePauseResume',\n        [\n            new SymbolMorph('pause', 12),\n            new SymbolMorph('pointRight', 14)\n        ],\n        () => this.isPaused() // query\n    );\n\n    button.hasNeutralBackground = true;\n    button.corner = 12;\n    button.color = colors[0];\n    button.highlightColor = colors[1];\n    button.pressColor = colors[0];\n    button.labelMinExtent = new Point(36, 18);\n    button.padding = 0;\n    button.labelShadowOffset = new Point(-1, -1);\n    button.labelShadowColor = colors[1];\n    button.labelColor = MorphicPreferences.isFlat ?\n        new Color(220, 185, 0)\n            : new Color(255, 220, 0);\n    button.contrast = this.buttonContrast;\n    // button.hint = 'pause/resume\\nall scripts';\n    button.fixLayout();\n    button.refresh();\n    pauseButton = button;\n    this.controlBar.add(pauseButton);\n    this.controlBar.pauseButton = pauseButton; // for refreshing\n\n    // startButton\n    button = new PushButtonMorph(\n        this,\n        'pressStart',\n        new SymbolMorph('flag', 14)\n    );\n    button.corner = 12;\n    button.color = colors[0];\n    button.highlightColor = colors[1];\n    button.pressColor = colors[2];\n    button.labelMinExtent = new Point(36, 18);\n    button.padding = 0;\n    button.labelShadowOffset = new Point(-1, -1);\n    button.labelShadowColor = colors[1];\n    button.labelColor = new Color(\n        0,\n        MorphicPreferences.isFlat ? 100 : 200,\n        0\n    );\n    button.contrast = this.buttonContrast;\n    // button.hint = 'start green\\nflag scripts';\n    button.fixLayout();\n    startButton = button;\n    this.controlBar.add(startButton);\n    this.controlBar.startButton = startButton;\n\n    // steppingSlider\n    slider = new SliderMorph(\n        61,\n        1,\n        Process.prototype.flashTime * 100 + 1,\n        6,\n        'horizontal'\n    );\n    slider.action = (num) => {\n        Process.prototype.flashTime = (num - 1) / 100;\n        this.controlBar.refreshResumeSymbol();\n    };\n    // slider.alpha = MorphicPreferences.isFlat ? 0.1 : 0.3;\n    slider.color = new Color(153, 255, 213);\n    slider.alpha = 0.3;\n    slider.setExtent(new Point(50, 14));\n    this.controlBar.add(slider);\n    this.controlBar.steppingSlider = slider;\n\n    // projectButton\n    button = new PushButtonMorph(\n        this,\n        'projectMenu',\n        new SymbolMorph('file', 14)\n        //'\\u270E'\n    );\n    button.corner = 12;\n    button.color = colors[0];\n    button.highlightColor = colors[1];\n    button.pressColor = colors[2];\n    button.labelMinExtent = new Point(36, 18);\n    button.padding = 0;\n    button.labelShadowOffset = new Point(-1, -1);\n    button.labelShadowColor = colors[1];\n    button.labelColor = this.buttonLabelColor;\n    button.contrast = this.buttonContrast;\n    // button.hint = 'open, save, & annotate project';\n    button.fixLayout();\n    projectButton = button;\n    this.controlBar.add(projectButton);\n    this.controlBar.projectButton = projectButton; // for menu positioning\n\n    // settingsButton\n    button = new PushButtonMorph(\n        this,\n        'settingsMenu',\n        new SymbolMorph('gears', 14)\n        //'\\u2699'\n    );\n    button.corner = 12;\n    button.color = colors[0];\n    button.highlightColor = colors[1];\n    button.pressColor = colors[2];\n    button.labelMinExtent = new Point(36, 18);\n    button.padding = 0;\n    button.labelShadowOffset = new Point(-1, -1);\n    button.labelShadowColor = colors[1];\n    button.labelColor = this.buttonLabelColor;\n    button.contrast = this.buttonContrast;\n    // button.hint = 'edit settings';\n    button.fixLayout();\n    settingsButton = button;\n    this.controlBar.add(settingsButton);\n    this.controlBar.settingsButton = settingsButton; // for menu positioning\n\n    // cloudButton\n    button = new ToggleButtonMorph(\n        null, //colors,\n        this, // the IDE is the target\n        'cloudMenu',\n        [\n            new SymbolMorph('cloudOutline', 11),\n            new SymbolMorph('cloud', 11)\n        ],\n        () => !isNil(this.cloud.username) // query\n    );\n\n    button.hasNeutralBackground = true;\n    button.corner = 12;\n    button.color = colors[0];\n    button.highlightColor = colors[1];\n    button.pressColor = colors[0];\n    button.labelMinExtent = new Point(36, 18);\n    button.padding = 0;\n    button.labelShadowOffset = new Point(-1, -1);\n    button.labelShadowColor = colors[1];\n    button.labelColor = this.buttonLabelColor;\n    button.contrast = this.buttonContrast;\n    // button.hint = 'cloud operations';\n    button.fixLayout();\n    button.refresh();\n    cloudButton = button;\n    this.controlBar.add(cloudButton);\n    this.controlBar.cloudButton = cloudButton; // for menu positioning & refresh\n\n    this.controlBar.fixLayout = function () {\n        x = this.right() - padding;\n        [stopButton, pauseButton, startButton].forEach(button => {\n                button.setCenter(myself.controlBar.center());\n                button.setRight(x);\n                x -= button.width();\n                x -= padding;\n            }\n        );\n\n        x = Math.min(\n            startButton.left() - (3 * padding + 2 * stageSizeButton.width()),\n            myself.right() - StageMorph.prototype.dimensions.x *\n                (myself.isSmallStage ? myself.stageRatio : 1)\n        );\n        [stageSizeButton, appModeButton].forEach(button => {\n                x += padding;\n                button.setCenter(myself.controlBar.center());\n                button.setLeft(x);\n                x += button.width();\n            }\n        );\n\n        slider.setCenter(myself.controlBar.center());\n        slider.setRight(stageSizeButton.left() - padding);\n\n        steppingButton.setCenter(myself.controlBar.center());\n        steppingButton.setRight(slider.left() - padding);\n\n        settingsButton.setCenter(myself.controlBar.center());\n        settingsButton.setLeft(this.left());\n\n        projectButton.setCenter(myself.controlBar.center());\n\n        if (myself.cloud.disabled) {\n            cloudButton.hide();\n            projectButton.setRight(settingsButton.left() - padding);\n        } else {\n            cloudButton.setCenter(myself.controlBar.center());\n            cloudButton.setRight(settingsButton.left() - padding);\n            projectButton.setRight(cloudButton.left() - padding);\n        }\n\n        this.refreshSlider();\n        this.updateLabel();\n    };\n\n    this.controlBar.refreshSlider = function () {\n        if (Process.prototype.enableSingleStepping && !myself.isAppMode) {\n            slider.fixLayout();\n            slider.rerender();\n            slider.show();\n        } else {\n            slider.hide();\n        }\n        this.refreshResumeSymbol();\n    };\n\n    this.controlBar.refreshResumeSymbol = function () {\n        var pauseSymbols;\n        if (Process.prototype.enableSingleStepping &&\n                Process.prototype.flashTime > 0.5) {\n            myself.stage.threads.pauseAll(myself.stage);\n            pauseSymbols = [\n                new SymbolMorph('pause', 12),\n                new SymbolMorph('stepForward', 14)\n            ];\n        } else {\n            pauseSymbols = [\n                new SymbolMorph('pause', 12),\n                new SymbolMorph('pointRight', 14)\n            ];\n        }\n        pauseButton.labelString = pauseSymbols;\n        pauseButton.createLabel();\n        pauseButton.fixLayout();\n        pauseButton.refresh();\n    };\n\n    this.controlBar.updateLabel = function () {\n        var suffix = myself.world().isDevMode ?\n                ' - ' + localize('development mode') : '',\n            txt;\n\n        if (this.label) {\n            this.label.destroy();\n        }\n        if (myself.isAppMode) {\n            return;\n        }\n        txt = new StringMorph(\n            (myself.projectName || localize('untitled')) + suffix,\n            14,\n            'sans-serif',\n            true,\n            false,\n            false,\n            MorphicPreferences.isFlat ? null : new Point(2, 1),\n            myself.frameColor.darker(myself.buttonContrast)\n        );\n        txt.color = myself.buttonLabelColor;\n\n        this.label = new FrameMorph();\n        this.label.acceptsDrops = false;\n        this.label.alpha = 0;\n        txt.setPosition(this.label.position());\n        this.label.add(txt);\n        this.label.setExtent(\n            new Point(\n                steppingButton.left() - settingsButton.right() - padding * 2,\n                txt.height()\n            )\n        );\n        this.label.setCenter(this.center());\n        this.label.setLeft(this.settingsButton.right() + padding);\n        this.add(this.label);\n    };\n};\n\nIDE_Morph.prototype.changeCategory = function (category) {\n    // Trace.log('IDE.changeCategory', category);\n    this.currentCategory = category;\n    this.categories.children.forEach(function (each) {\n        each.refresh();\n    });\n    this.refreshPalette(true);\n};\n\nIDE_Morph.prototype.createCategories = function () {\n    var myself = this;\n\n    if (this.categories) {\n        this.categories.destroy();\n    }\n    this.categories = new Morph();\n    this.categories.color = this.groupColor;\n    this.categories.bounds.setWidth(this.paletteWidth);\n    // this.categories.getRenderColor = ScriptsMorph.prototype.getRenderColor;\n\n    function addCategoryButton(category) {\n        var labelWidth = 75,\n            colors = [\n                myself.frameColor,\n                myself.frameColor.darker(MorphicPreferences.isFlat ? 5 : 50),\n                SpriteMorph.prototype.blockColor[category]\n            ],\n            button;\n\n        button = new ToggleButtonMorph(\n            colors,\n            myself, // the IDE is the target\n            () => {\n                myself.currentCategory = category;\n                myself.categories.children.forEach(each =>\n                    each.refresh()\n                );\n                myself.refreshPalette(true);\n            },\n            category[0].toUpperCase().concat(category.slice(1)), // label\n            () => myself.currentCategory === category, // query\n            null, // env\n            null, // hint\n            labelWidth, // minWidth\n            true // has preview\n        );\n\n        button.corner = 8;\n        button.padding = 0;\n        button.labelShadowOffset = new Point(-1, -1);\n        button.labelShadowColor = colors[1];\n        button.labelColor = myself.buttonLabelColor;\n        if (MorphicPreferences.isFlat) {\n            button.labelPressColor = WHITE;\n        }\n        button.fixLayout();\n        button.refresh();\n        myself.categories.add(button);\n        return button;\n    }\n\n    function fixCategoriesLayout() {\n        var buttonWidth = myself.categories.children[0].width(),\n            buttonHeight = myself.categories.children[0].height(),\n            border = 3,\n            rows =  Math.ceil((myself.categories.children.length) / 2),\n            xPadding = (200 // myself.logo.width()\n                - border\n                - buttonWidth * 2) / 3,\n            yPadding = 2,\n            l = myself.categories.left(),\n            t = myself.categories.top(),\n            i = 0,\n            row,\n            col;\n\n        myself.categories.children.forEach(button => {\n            i += 1;\n            row = Math.ceil(i / 2);\n            col = 2 - (i % 2);\n            button.setPosition(new Point(\n                l + (col * xPadding + ((col - 1) * buttonWidth)),\n                t + (row * yPadding + ((row - 1) * buttonHeight) + border)\n            ));\n        });\n\n        myself.categories.setHeight(\n            (rows + 1) * yPadding\n                + rows * buttonHeight\n                + 2 * border\n        );\n    }\n\n    SpriteMorph.prototype.categories.forEach(cat => {\n        if (!contains(['lists', 'other'], cat)) {\n            addCategoryButton(cat);\n        }\n    });\n    fixCategoriesLayout();\n    this.add(this.categories);\n};\n\nIDE_Morph.prototype.createPalette = function (forSearching) {\n    // assumes that the logo pane has already been created\n    // needs the categories pane for layout\n\n    if (this.palette) {\n        this.palette.destroy();\n    }\n\n    if (forSearching) {\n        this.palette = new ScrollFrameMorph(\n            null,\n            null,\n            this.currentSprite.sliderColor\n        );\n\n        // search toolbar (floating cancel button):\n        /* commented out for now\n        this.palette.toolBar = new PushButtonMorph(\n            this,\n            () => {\n                this.refreshPalette();\n                this.palette.adjustScrollBars();\n            },\n            new SymbolMorph(\"magnifierOutline\", 16)\n        );\n        this.palette.toolBar.alpha = 0.2;\n        this.palette.toolBar.padding = 1;\n        // this.palette.toolBar.hint = 'Cancel';\n        this.palette.toolBar.labelShadowColor = new Color(140, 140, 140);\n        this.palette.toolBar.fixLayout();\n        this.palette.add(this.palette.toolBar);\n\t    */\n    } else {\n        this.palette = this.currentSprite.palette(this.currentCategory);\n    }\n    this.palette.isDraggable = false;\n    this.palette.acceptsDrops = true;\n    this.palette.enableAutoScrolling = false;\n    this.palette.contents.acceptsDrops = false;\n\n    this.palette.reactToDropOf = (droppedMorph, hand) => {\n        if (droppedMorph instanceof DialogBoxMorph) {\n            this.world().add(droppedMorph);\n        } else if (droppedMorph instanceof SpriteMorph) {\n            this.removeSprite(droppedMorph);\n        } else if (droppedMorph instanceof SpriteIconMorph) {\n            droppedMorph.destroy();\n            this.removeSprite(droppedMorph.object);\n        } else if (droppedMorph instanceof CostumeIconMorph) {\n            this.currentSprite.wearCostume(null);\n            droppedMorph.perish();\n        } else if (droppedMorph instanceof BlockMorph) {\n            // Trace.log('Block.dragDestroy', droppedMorph.blockId());\n            this.stage.threads.stopAllForBlock(droppedMorph);\n            if (hand && hand.grabOrigin.origin instanceof ScriptsMorph) {\n                hand.grabOrigin.origin.clearDropInfo();\n                hand.grabOrigin.origin.lastDroppedBlock = droppedMorph;\n                hand.grabOrigin.origin.recordDrop(hand.grabOrigin);\n            }\n            droppedMorph.perish();\n        } else {\n            droppedMorph.perish();\n        }\n    };\n\n    this.palette.contents.reactToDropOf = (droppedMorph) => {\n        // for \"undrop\" operation\n        if (droppedMorph instanceof BlockMorph) {\n            droppedMorph.destroy();\n        }\n    };\n\n    this.palette.setWidth(this.logo.width());\n    this.add(this.palette);\n    return this.palette;\n};\n\nIDE_Morph.prototype.createPaletteHandle = function () {\n    // assumes that the palette has already been created\n    if (this.paletteHandle) {this.paletteHandle.destroy(); }\n    this.paletteHandle = new PaletteHandleMorph(this.categories);\n    this.add(this.paletteHandle);\n};\n\nIDE_Morph.prototype.createStage = function () {\n    // assumes that the logo pane has already been created\n    if (this.stage) {this.stage.destroy(); }\n    StageMorph.prototype.frameRate = 0;\n    this.stage = new StageMorph(this.globalVariables);\n    this.stage.setExtent(this.stage.dimensions); // dimensions are fixed\n    if (this.currentSprite instanceof SpriteMorph) {\n        this.currentSprite.setPosition(\n            this.stage.center().subtract(\n                this.currentSprite.extent().divideBy(2)\n            )\n        );\n        this.stage.add(this.currentSprite);\n    }\n    this.add(this.stage);\n};\n\nIDE_Morph.prototype.createStageHandle = function () {\n    // assumes that the stage has already been created\n    if (this.stageHandle) {this.stageHandle.destroy(); }\n    this.stageHandle = new StageHandleMorph(this.stage);\n    this.add(this.stageHandle);\n};\n\nIDE_Morph.prototype.createSpriteBar = function () {\n    // assumes that the categories pane has already been created\n    var rotationStyleButtons = [],\n        thumbSize = new Point(45, 45),\n        nameField,\n        padlock,\n        thumbnail,\n        tabCorner = 15,\n        tabColors = this.tabColors,\n        tabBar = new AlignmentMorph('row', -tabCorner * 2),\n        tab,\n        symbols = [\n            new SymbolMorph('arrowRightThin', 10),\n            new SymbolMorph('turnAround', 10),\n            new SymbolMorph('arrowLeftRightThin', 10),\n        ],\n        labels = ['don\\'t rotate', 'can rotate', 'only face left/right'],\n        myself = this;\n\n    if (this.spriteBar) {\n        this.spriteBar.destroy();\n    }\n\n    this.spriteBar = new Morph();\n    this.spriteBar.color = this.frameColor;\n    this.add(this.spriteBar);\n\n    function addRotationStyleButton(rotationStyle) {\n        var colors = myself.rotationStyleColors,\n            button;\n\n        button = new ToggleButtonMorph(\n            colors,\n            myself, // the IDE is the target\n            () => {\n                if (myself.currentSprite instanceof SpriteMorph) {\n                    // Trace.log('IDE.rotationStyleChanged', rotationStyle);\n                    myself.currentSprite.rotationStyle = rotationStyle;\n                    myself.currentSprite.changed();\n                    myself.currentSprite.fixLayout();\n                    myself.currentSprite.rerender();\n                }\n                rotationStyleButtons.forEach(each =>\n                    each.refresh()\n                );\n            },\n            symbols[rotationStyle], // label\n            () => myself.currentSprite instanceof SpriteMorph // query\n                && myself.currentSprite.rotationStyle === rotationStyle,\n            null, // environment\n            localize(labels[rotationStyle])\n        );\n\n        button.corner = 8;\n        button.labelMinExtent = new Point(11, 11);\n        button.padding = 0;\n        button.labelShadowOffset = new Point(-1, -1);\n        button.labelShadowColor = colors[1];\n        button.labelColor = myself.buttonLabelColor;\n        button.fixLayout();\n        button.refresh();\n        rotationStyleButtons.push(button);\n        button.setPosition(myself.spriteBar.position().add(new Point(2, 4)));\n        button.setTop(button.top()\n            + ((rotationStyleButtons.length - 1) * (button.height() + 2))\n            );\n        myself.spriteBar.add(button);\n        if (myself.currentSprite instanceof StageMorph) {\n            button.hide();\n        }\n        return button;\n    }\n\n    addRotationStyleButton(1);\n    addRotationStyleButton(2);\n    addRotationStyleButton(0);\n    this.rotationStyleButtons = rotationStyleButtons;\n\n    thumbnail = new Morph();\n    thumbnail.isCachingImage = true;\n    thumbnail.bounds.setExtent(thumbSize);\n    thumbnail.cachedImage = this.currentSprite.thumbnail(thumbSize);\n    thumbnail.setPosition(\n        rotationStyleButtons[0].topRight().add(new Point(5, 3))\n    );\n    this.spriteBar.add(thumbnail);\n\n    thumbnail.fps = 3;\n\n    thumbnail.step = function () {\n        if (thumbnail.version !== myself.currentSprite.version) {\n            thumbnail.cachedImage = myself.currentSprite.thumbnail(\n                thumbSize,\n                thumbnail.cachedImage\n            );\n            thumbnail.changed();\n            thumbnail.version = myself.currentSprite.version;\n        }\n    };\n\n    nameField = new InputFieldMorph(this.currentSprite.name);\n    nameField.setWidth(100); // fixed dimensions\n    nameField.contrast = 90;\n    nameField.setPosition(thumbnail.topRight().add(new Point(10, 3)));\n    this.spriteBar.add(nameField);\n    this.spriteBar.nameField = nameField;\n    nameField.fixLayout();\n    nameField.accept = function () {\n        var newName = nameField.getValue();\n        myself.currentSprite.setName(\n            myself.newSpriteName(newName, myself.currentSprite)\n        );\n        nameField.setContents(myself.currentSprite.name);\n    };\n    this.spriteBar.reactToEdit = nameField.accept;\n\n    // padlock\n    padlock = new ToggleMorph(\n        'checkbox',\n        null,\n        () => {\n            this.currentSprite.isDraggable = !this.currentSprite.isDraggable;\n            // Trace.log('IDE.setSpriteDraggable',\n            //     this.currentSprite.isDraggable);\n        },\n        localize('draggable'),\n        () => this.currentSprite.isDraggable\n    );\n    padlock.label.isBold = false;\n    padlock.label.setColor(this.buttonLabelColor);\n    padlock.color = tabColors[2];\n    padlock.highlightColor = tabColors[0];\n    padlock.pressColor = tabColors[1];\n\n    padlock.tick.shadowOffset = MorphicPreferences.isFlat ?\n            ZERO : new Point(-1, -1);\n    padlock.tick.shadowColor = BLACK;\n    padlock.tick.color = this.buttonLabelColor;\n    padlock.tick.isBold = false;\n    padlock.tick.fixLayout();\n\n    padlock.setPosition(nameField.bottomLeft().add(2));\n    padlock.fixLayout();\n    this.spriteBar.add(padlock);\n    if (this.currentSprite instanceof StageMorph) {\n        padlock.hide();\n    }\n\n    // tab bar\n    tabBar.tabTo = function (tabString) {\n        // Trace.log('IDE.setSpriteTab', tabString);\n        var active;\n        myself.currentTab = tabString;\n        this.children.forEach(each => {\n            each.refresh();\n            if (each.state) {active = each; }\n        });\n        active.refresh(); // needed when programmatically tabbing\n        myself.createSpriteEditor();\n        myself.fixLayout('tabEditor');\n    };\n\n    tab = new TabMorph(\n        tabColors,\n        null, // target\n        () => tabBar.tabTo('scripts'),\n        localize('Scripts'), // label\n        () => this.currentTab === 'scripts' // query\n    );\n    tab.padding = 3;\n    tab.corner = tabCorner;\n    tab.edge = 1;\n    tab.labelShadowOffset = new Point(-1, -1);\n    tab.labelShadowColor = tabColors[1];\n    tab.labelColor = this.buttonLabelColor;\n\n    tab.getPressRenderColor = function () {\n        if (MorphicPreferences.isFlat ||\n                SyntaxElementMorph.prototype.alpha > 0.85) {\n            return this.pressColor;\n        }\n        return this.pressColor.mixed(\n            Math.max(SyntaxElementMorph.prototype.alpha - 0.15, 0),\n            SpriteMorph.prototype.paletteColor\n        );\n    };\n\n    tab.fixLayout();\n    tabBar.add(tab);\n\n    tab = new TabMorph(\n        tabColors,\n        null, // target\n        () => tabBar.tabTo('costumes'),\n        localize(this.currentSprite instanceof SpriteMorph ?\n            'Costumes' : 'Backgrounds'\n        ),\n        () => this.currentTab === 'costumes' // query\n    );\n    tab.padding = 3;\n    tab.corner = tabCorner;\n    tab.edge = 1;\n    tab.labelShadowOffset = new Point(-1, -1);\n    tab.labelShadowColor = tabColors[1];\n    tab.labelColor = this.buttonLabelColor;\n    tab.fixLayout();\n    tabBar.add(tab);\n\n    tab = new TabMorph(\n        tabColors,\n        null, // target\n        () => tabBar.tabTo('sounds'),\n        localize('Sounds'), // label\n        () => this.currentTab === 'sounds' // query\n    );\n    tab.padding = 3;\n    tab.corner = tabCorner;\n    tab.edge = 1;\n    tab.labelShadowOffset = new Point(-1, -1);\n    tab.labelShadowColor = tabColors[1];\n    tab.labelColor = this.buttonLabelColor;\n    tab.fixLayout();\n    tabBar.add(tab);\n\n    tabBar.fixLayout();\n    tabBar.children.forEach(each =>\n        each.refresh()\n    );\n    this.spriteBar.tabBar = tabBar;\n    this.spriteBar.add(this.spriteBar.tabBar);\n\n    this.spriteBar.fixLayout = function () {\n        this.tabBar.setLeft(this.left());\n        this.tabBar.setBottom(this.bottom() + myself.padding);\n    };\n};\n\nIDE_Morph.prototype.createSpriteEditor = function () {\n    // assumes that the logo pane and the stage have already been created\n    var scripts = this.currentSprite.scripts;\n\n    if (this.spriteEditor) {\n        this.spriteEditor.destroy();\n    }\n\n    if (this.currentTab === 'scripts') {\n        scripts.isDraggable = false;\n        scripts.color = this.groupColor;\n        scripts.cachedTexture = this.scriptsPaneTexture;\n\n        this.spriteEditor = new ScrollFrameMorph(\n            scripts,\n            null,\n            this.sliderColor\n        );\n        this.spriteEditor.color = this.groupColor;\n        this.spriteEditor.padding = 10;\n        this.spriteEditor.growth = 50;\n        this.spriteEditor.isDraggable = false;\n        this.spriteEditor.acceptsDrops = false;\n        this.spriteEditor.contents.acceptsDrops = true;\n\n        scripts.scrollFrame = this.spriteEditor;\n        scripts.updateToolbar();\n        this.add(this.spriteEditor);\n        this.spriteEditor.scrollX(this.spriteEditor.padding);\n        this.spriteEditor.scrollY(this.spriteEditor.padding);\n    } else if (this.currentTab === 'costumes') {\n        this.spriteEditor = new WardrobeMorph(\n            this.currentSprite,\n            this.sliderColor\n        );\n        this.spriteEditor.color = this.groupColor;\n        this.add(this.spriteEditor);\n        this.spriteEditor.updateSelection();\n\n        this.spriteEditor.acceptsDrops = false;\n        this.spriteEditor.contents.acceptsDrops = false;\n\n        this.spriteEditor.contents.mouseEnterDragging = (morph) => {\n            if (morph instanceof BlockMorph) {\n                this.spriteBar.tabBar.tabTo('scripts');\n            }\n        };\n    } else if (this.currentTab === 'sounds') {\n        this.spriteEditor = new JukeboxMorph(\n            this.currentSprite,\n            this.sliderColor\n        );\n        this.spriteEditor.color = this.groupColor;\n        this.add(this.spriteEditor);\n        this.spriteEditor.updateSelection();\n        this.spriteEditor.acceptDrops = false;\n        this.spriteEditor.contents.acceptsDrops = false;\n\n        this.spriteEditor.contents.mouseEnterDragging = (morph) => {\n            if (morph instanceof BlockMorph) {\n                this.spriteBar.tabBar.tabTo('scripts');\n            }\n        };\n    } else {\n        this.spriteEditor = new Morph();\n        this.spriteEditor.color = this.groupColor;\n        this.spriteEditor.acceptsDrops = true;\n        this.spriteEditor.reactToDropOf = (droppedMorph) => {\n            if (droppedMorph instanceof DialogBoxMorph) {\n                this.world().add(droppedMorph);\n            } else if (droppedMorph instanceof SpriteMorph) {\n                this.removeSprite(droppedMorph);\n            } else {\n                droppedMorph.destroy();\n            }\n        };\n        this.add(this.spriteEditor);\n    }\n};\n\nIDE_Morph.prototype.createCorralBar = function () {\n    // assumes the stage has already been created\n    var padding = 5,\n        newbutton,\n        paintbutton,\n        cambutton,\n        colors = MorphicPreferences.isFlat ? this.tabColors\n        : [\n            this.groupColor,\n            this.frameColor.darker(50),\n            this.frameColor.darker(50)\n        ];\n\n    if (this.corralBar) {\n        this.corralBar.destroy();\n    }\n\n    this.corralBar = new Morph();\n    this.corralBar.color = this.frameColor;\n    this.corralBar.setHeight(this.logo.height()); // height is fixed\n    this.add(this.corralBar);\n\n    // new sprite button\n    newbutton = new PushButtonMorph(\n        this,\n        \"addNewSprite\",\n        new SymbolMorph(\"turtle\", 14)\n    );\n    newbutton.corner = 12;\n    newbutton.color = colors[0];\n    newbutton.highlightColor = colors[1];\n    newbutton.pressColor = colors[2];\n    newbutton.labelMinExtent = new Point(36, 18);\n    newbutton.padding = 0;\n    newbutton.labelShadowOffset = new Point(-1, -1);\n    newbutton.labelShadowColor = colors[1];\n    newbutton.labelColor = this.buttonLabelColor;\n    newbutton.contrast = this.buttonContrast;\n    newbutton.hint = \"add a new Turtle sprite\";\n    newbutton.fixLayout();\n    newbutton.setCenter(this.corralBar.center());\n    newbutton.setLeft(this.corralBar.left() + padding);\n    this.corralBar.add(newbutton);\n\n    paintbutton = new PushButtonMorph(\n        this,\n        \"paintNewSprite\",\n        new SymbolMorph(\"brush\", 15)\n    );\n    paintbutton.corner = 12;\n    paintbutton.color = colors[0];\n    paintbutton.highlightColor = colors[1];\n    paintbutton.pressColor = colors[2];\n    paintbutton.labelMinExtent = new Point(36, 18);\n    paintbutton.padding = 0;\n    paintbutton.labelShadowOffset = new Point(-1, -1);\n    paintbutton.labelShadowColor = colors[1];\n    paintbutton.labelColor = this.buttonLabelColor;\n    paintbutton.contrast = this.buttonContrast;\n    paintbutton.hint = \"paint a new sprite\";\n    paintbutton.fixLayout();\n    paintbutton.setCenter(this.corralBar.center());\n    paintbutton.setLeft(\n        this.corralBar.left() + padding + newbutton.width() + padding\n    );\n    this.corralBar.add(paintbutton);\n\n    if (CamSnapshotDialogMorph.prototype.enableCamera) {\n        cambutton = new PushButtonMorph(\n                this,\n                \"newCamSprite\",\n                new SymbolMorph(\"camera\", 15)\n                );\n        cambutton.corner = 12;\n        cambutton.color = colors[0];\n        cambutton.highlightColor = colors[1];\n        cambutton.pressColor = colors[2];\n        cambutton.labelMinExtent = new Point(36, 18);\n        cambutton.padding = 0;\n        cambutton.labelShadowOffset = new Point(-1, -1);\n        cambutton.labelShadowColor = colors[1];\n        cambutton.labelColor = this.buttonLabelColor;\n        cambutton.contrast = this.buttonContrast;\n        cambutton.hint = \"take a camera snapshot and\\n\" +\n        \t\"import it as a new sprite\";\n        cambutton.fixLayout();\n        cambutton.setCenter(this.corralBar.center());\n        cambutton.setLeft(\n            this.corralBar.left() +\n            padding +\n            newbutton.width() +\n            padding +\n            paintbutton.width() +\n            padding\n        );\n        this.corralBar.add(cambutton);\n        document.addEventListener(\n            'cameraDisabled',\n            event => {\n                cambutton.disable();\n                cambutton.hint =\n                    CamSnapshotDialogMorph.prototype.notSupportedMessage;\n            }\n        );\n    }\n};\n\nIDE_Morph.prototype.createCorral = function () {\n    // assumes the corral bar has already been created\n    var frame, padding = 5, myself = this;\n\n    this.createStageHandle();\n    this.createPaletteHandle();\n\n    if (this.corral) {\n        this.corral.destroy();\n    }\n\n    this.corral = new Morph();\n    this.corral.color = this.groupColor;\n    this.corral.getRenderColor = ScriptsMorph.prototype.getRenderColor;\n\n    this.add(this.corral);\n\n    this.corral.stageIcon = new SpriteIconMorph(this.stage);\n    this.corral.stageIcon.isDraggable = false;\n    this.corral.add(this.corral.stageIcon);\n\n    frame = new ScrollFrameMorph(null, null, this.sliderColor);\n    frame.acceptsDrops = false;\n    frame.contents.acceptsDrops = false;\n\n    frame.contents.wantsDropOf = (morph) => morph instanceof SpriteIconMorph;\n\n    frame.contents.reactToDropOf = (spriteIcon) =>\n        this.corral.reactToDropOf(spriteIcon);\n\n    frame.alpha = 0;\n\n    this.sprites.asArray().forEach(morph => {\n        if (!morph.isTemporary) {\n            frame.contents.add(new SpriteIconMorph(morph));\n        }\n    });\n\n    this.corral.frame = frame;\n    this.corral.add(frame);\n\n    this.corral.fixLayout = function () {\n        this.stageIcon.setCenter(this.center());\n        this.stageIcon.setLeft(this.left() + padding);\n        this.frame.setLeft(this.stageIcon.right() + padding);\n        this.frame.setExtent(new Point(\n            this.right() - this.frame.left(),\n            this.height()\n        ));\n        this.arrangeIcons();\n        this.refresh();\n    };\n\n    this.corral.arrangeIcons = function () {\n        var x = this.frame.left(),\n            y = this.frame.top(),\n            max = this.frame.right(),\n            start = this.frame.left();\n\n        this.frame.contents.children.forEach(icon => {\n            var w = icon.width();\n\n            if (x + w > max) {\n                x = start;\n                y += icon.height(); // they're all the same\n            }\n            icon.setPosition(new Point(x, y));\n            x += w;\n        });\n        this.frame.contents.adjustBounds();\n    };\n\n    this.corral.addSprite = function (sprite) {\n        this.frame.contents.add(new SpriteIconMorph(sprite));\n        this.fixLayout();\n    };\n\n    this.corral.refresh = function () {\n        this.stageIcon.refresh();\n        this.frame.contents.children.forEach(icon =>\n            icon.refresh()\n        );\n    };\n\n    this.corral.wantsDropOf = (morph) => morph instanceof SpriteIconMorph;\n\n    this.corral.reactToDropOf = function (spriteIcon) {\n        var idx = 1,\n            pos = spriteIcon.position();\n        spriteIcon.destroy();\n        this.frame.contents.children.forEach(icon => {\n            if (pos.gt(icon.position()) || pos.y > icon.bottom()) {\n                idx += 1;\n            }\n        });\n        myself.sprites.add(spriteIcon.object, idx);\n        myself.createCorral();\n        myself.fixLayout();\n    };\n};\n\n// IDE_Morph layout\n\nIDE_Morph.prototype.fixLayout = function (situation) {\n    // situation is a string, i.e.\n    // 'selectSprite' or 'refreshPalette' or 'tabEditor'\n    var padding = this.padding,\n        flag,\n        maxPaletteWidth;\n\n    if (situation !== 'refreshPalette') {\n        // controlBar\n        this.controlBar.setPosition(this.logo.topRight());\n        this.controlBar.setWidth(this.right() - this.controlBar.left());\n        this.controlBar.fixLayout();\n\n        // categories\n        this.categories.setLeft(this.logo.left());\n        this.categories.setTop(this.logo.bottom());\n        this.categories.setWidth(this.paletteWidth);\n    }\n\n    // palette\n    this.palette.setLeft(this.logo.left());\n    this.palette.setTop(this.categories.bottom());\n    this.palette.setHeight(this.bottom() - this.palette.top());\n    this.palette.setWidth(this.paletteWidth);\n\n    if (situation !== 'refreshPalette') {\n        // stage\n        if (this.isEmbedMode) {\n            this.stage.setScale(Math.floor(Math.min(\n                this.width() / this.stage.dimensions.x,\n                this.height() / this.stage.dimensions.y\n                ) * 100) / 100);\n            flag = this.embedPlayButton.flag;\n            flag.size = Math.floor(Math.min(\n                        this.width(), this.height())) / 5;\n            flag.fixLayout();\n            this.embedPlayButton.size = flag.size * 1.6;\n            this.embedPlayButton.fixLayout();\n            if (this.embedOverlay) {\n                this.embedOverlay.setExtent(this.extent());\n            }\n            this.stage.setCenter(this.center());\n            this.embedPlayButton.setCenter(this.stage.center());\n            flag.setCenter(this.embedPlayButton.center());\n            flag.setLeft(flag.left() + flag.size * 0.1); // account for slight asymmetry\n        } else if (this.isAppMode) {\n            this.stage.setScale(Math.floor(Math.min(\n                (this.width() - padding * 2) / this.stage.dimensions.x,\n                (this.height() - this.controlBar.height() * 2 - padding * 2)\n                    / this.stage.dimensions.y\n            ) * 10) / 10);\n            this.stage.setCenter(this.center());\n        } else {\n            this.stage.setScale(this.isSmallStage ? this.stageRatio : 1);\n            this.stage.setTop(this.logo.bottom() + padding);\n            this.stage.setRight(this.right());\n            maxPaletteWidth = Math.max(\n                200,\n                this.width() -\n                    this.stage.width() -\n                    this.spriteBar.tabBar.width() -\n                    (this.padding * 2)\n            );\n            if (this.paletteWidth > maxPaletteWidth) {\n                this.paletteWidth = maxPaletteWidth;\n                this.fixLayout();\n            }\n            this.stageHandle.fixLayout();\n            this.paletteHandle.fixLayout();\n        }\n\n        // spriteBar\n        this.spriteBar.setLeft(this.paletteWidth + padding);\n        this.spriteBar.setTop(this.logo.bottom() + padding);\n        this.spriteBar.setExtent(new Point(\n            Math.max(0, this.stage.left() - padding - this.spriteBar.left()),\n            this.categories.bottom() - this.spriteBar.top() - padding - 8\n        ));\n        this.spriteBar.fixLayout();\n\n        // spriteEditor\n        if (this.spriteEditor.isVisible) {\n            this.spriteEditor.setPosition(new Point(\n                this.spriteBar.left(),\n                this.spriteBar.bottom() + padding\n            ));\n            this.spriteEditor.setExtent(new Point(\n                this.spriteBar.width(),\n                this.bottom() - this.spriteEditor.top()\n            ));\n        }\n\n        // corralBar\n        this.corralBar.setLeft(this.stage.left());\n        this.corralBar.setTop(this.stage.bottom() + padding);\n        this.corralBar.setWidth(this.stage.width());\n\n        // corral\n        if (!contains(['selectSprite', 'tabEditor'], situation)) {\n            this.corral.setPosition(this.corralBar.bottomLeft());\n            this.corral.setWidth(this.stage.width());\n            this.corral.setHeight(this.bottom() - this.corral.top());\n            this.corral.fixLayout();\n        }\n    }\n};\n\nIDE_Morph.prototype.setProjectName = function (string) {\n    this.projectName = string.replace(/['\"]/g, ''); // filter quotation marks\n    this.hasChangedMedia = true;\n    this.controlBar.updateLabel();\n};\n\nIDE_Morph.prototype.getProjectData = function() {\n    return this.projectData;\n};\n\nIDE_Morph.prototype.setProjectData = function(string) {\n    if (!string || !string.length) {\n        this.projectData = {};\n        return;\n    }\n    try {\n        var data = JSON.parse(string);\n        if (data) this.projectData = data;\n    } catch (e) {\n        console.log(\"Error parsing project data: \" + string);\n        console.error(e);\n    }\n};\n\n// IDE_Morph resizing\n\nIDE_Morph.prototype.setExtent = function (point) {\n    var padding = new Point(430, 110),\n        minExt,\n        ext,\n        maxWidth,\n        minWidth,\n        maxHeight,\n        minRatio,\n        maxRatio;\n\n    // determine the minimum dimensions making sense for the current mode\n    if (this.isAppMode) {\n        if (this.isEmbedMode) {\n            minExt = new Point(100, 100);\n        } else {\n            minExt = StageMorph.prototype.dimensions.add(\n                this.controlBar.height() + 10\n            );\n        }\n    } else {\n        if (this.stageRatio > 1) {\n            minExt = padding.add(StageMorph.prototype.dimensions);\n        } else {\n            minExt = padding.add(\n                StageMorph.prototype.dimensions.multiplyBy(this.stageRatio)\n            );\n        }\n    }\n    ext = point.max(minExt);\n\n    // adjust stage ratio if necessary\n    maxWidth = ext.x -\n        (200 + this.spriteBar.tabBar.width() + (this.padding * 2));\n    minWidth = SpriteIconMorph.prototype.thumbSize.x * 3;\n    maxHeight = (ext.y - SpriteIconMorph.prototype.thumbSize.y * 3.5);\n    minRatio = minWidth / this.stage.dimensions.x;\n    maxRatio = Math.min(\n        (maxWidth / this.stage.dimensions.x),\n        (maxHeight / this.stage.dimensions.y)\n    );\n    this.stageRatio = Math.min(maxRatio, Math.max(minRatio, this.stageRatio));\n\n    // apply\n    IDE_Morph.uber.setExtent.call(this, ext);\n    this.fixLayout();\n};\n\n// IDE_Morph rendering\n\nIDE_Morph.prototype.render = function (ctx) {\n    var frame;\n    IDE_Morph.uber.render.call(this, ctx);\n    if (this.isAppMode && this.stage) {\n        // draw a subtle outline rectangle around the stage\n        // in presentation mode\n        frame = this.stage.bounds.translateBy(\n            this.position().neg()\n        ).expandBy(2);\n        ctx.strokeStyle = (MorphicPreferences.isFlat ? this.backgroundColor\n            : this.groupColor).toString();\n        ctx.lineWidth = 1;\n        ctx.beginPath();\n        ctx.moveTo(frame.origin.x, frame.origin.y);\n        ctx.lineTo(frame.corner.x, frame.origin.y);\n        ctx.lineTo(frame.corner.x, frame.corner.y);\n        ctx.lineTo(frame.origin.x, frame.corner.y);\n        ctx.closePath();\n        ctx.stroke();\n    }\n};\n\n// IDE_Morph events\n\nIDE_Morph.prototype.reactToWorldResize = function (rect) {\n    if (this.isAutoFill) {\n        this.setPosition(rect.origin);\n        this.setExtent(rect.extent());\n    }\n    if (this.filePicker) {\n        document.body.removeChild(this.filePicker);\n        this.filePicker = null;\n    }\n};\n\nIDE_Morph.prototype.droppedImage = function (aCanvas, name) {\n    var costume = new Costume(\n        aCanvas,\n        this.currentSprite.newCostumeName(\n            name ? name.split('.')[0] : '' // up to period\n        )\n    );\n\n    if (costume.isTainted()) {\n        this.inform(\n            'Unable to import this image',\n            'The picture you wish to import has been\\n' +\n                'tainted by a restrictive cross-origin policy\\n' +\n                'making it unusable for costumes in Snap!. \\n\\n' +\n                'Try downloading this picture first to your\\n' +\n                'computer, and import it from there.'\n        );\n        return;\n    }\n\n    this.currentSprite.addCostume(costume);\n    this.currentSprite.wearCostume(costume);\n    this.spriteBar.tabBar.tabTo('costumes');\n    this.hasChangedMedia = true;\n};\n\nIDE_Morph.prototype.droppedSVG = function (anImage, name) {\n    var costume = new SVG_Costume(anImage, name.split('.')[0]);\n    this.currentSprite.addCostume(costume);\n    this.currentSprite.wearCostume(costume);\n    this.spriteBar.tabBar.tabTo('costumes');\n    this.hasChangedMedia = true;\n};\n\nIDE_Morph.prototype.droppedAudio = function (anAudio, name) {\n    if (anAudio.src.indexOf('data:audio') !== 0) {\n    \t// fetch and base 64 encode samples using FileReader\n    \tthis.getURL(\n        \tanAudio.src,\n            blob => {\n                var reader = new window.FileReader();\n                reader.readAsDataURL(blob);\n                reader.onloadend = () => {\n                \tvar base64 = reader.result;\n                    base64 = 'data:audio/ogg;base64,' +\n                        base64.split(',')[1];\n                    anAudio.src = base64;\n                    this.droppedAudio(anAudio, name);\n                };\n            },\n            'blob'\n        );\n    } else {\n    \tthis.currentSprite.addSound(anAudio, name.split('.')[0]); // up to '.'\n    \tthis.spriteBar.tabBar.tabTo('sounds');\n    \tthis.hasChangedMedia = true;\n    }\n};\n\nIDE_Morph.prototype.droppedText = function (aString, name, fileType) {\n    var lbl = name ? name.split('.')[0] : '',\n        ext = name ? name.slice(name.lastIndexOf('.') + 1).toLowerCase() : '';\n\n    // check for Snap specific files, projects, libraries, sprites, scripts\n    if (aString.indexOf('<project') === 0) {\n        location.hash = '';\n        return this.openProjectString(aString);\n    }\n    if (aString.indexOf('<snapdata') === 0) {\n        location.hash = '';\n        return this.openCloudDataString(aString);\n    }\n    if (aString.indexOf('<blocks') === 0) {\n        return this.openBlocksString(aString, lbl, true);\n    }\n    if (aString.indexOf('<sprites') === 0) {\n        return this.openSpritesString(aString);\n    }\n    if (aString.indexOf('<media') === 0) {\n        return this.openMediaString(aString);\n    }\n    if (aString.indexOf('<script') === 0) {\n        return this.openScriptString(aString);\n    }\n\n    // check for encoded data-sets, CSV, JSON\n    if (fileType.indexOf('csv') !== -1 || ext === 'csv') {\n        return this.openDataString(aString, lbl, 'csv');\n    }\n    if (fileType.indexOf('json') !== -1 || ext === 'json') {\n        return this.openDataString(aString, lbl, 'json');\n    }\n\n    // import as plain text data\n    this.openDataString(aString, lbl, 'text');\n};\n\nIDE_Morph.prototype.droppedBinary = function (anArrayBuffer, name) {\n    // dynamically load ypr->Snap!\n    var ypr = document.getElementById('ypr'),\n        myself = this,\n        suffix = name.substring(name.length - 3);\n\n    if (suffix.toLowerCase() !== 'ypr') {return; }\n\n    function loadYPR(buffer, lbl) {\n        var reader = new sb.Reader(),\n            pname = lbl.split('.')[0]; // up to period\n        reader.onload = function (info) {\n            myself.droppedText(new sb.XMLWriter().write(pname, info));\n        };\n        reader.readYPR(new Uint8Array(buffer));\n    }\n\n    if (!ypr) {\n        ypr = document.createElement('script');\n        ypr.id = 'ypr';\n        ypr.onload = function () {loadYPR(anArrayBuffer, name); };\n        document.head.appendChild(ypr);\n        ypr.src = this.resourceURL('src', 'ypr.js');\n    } else {\n        loadYPR(anArrayBuffer, name);\n    }\n};\n\n// IDE_Morph button actions\n\nIDE_Morph.prototype.refreshPalette = function (shouldIgnorePosition) {\n    var oldTop = this.palette.contents.top();\n\n    this.createPalette();\n    if (this.isAppMode) {\n        this.palette.hide();\n        return;\n    }\n    this.fixLayout('refreshPalette');\n    if (!shouldIgnorePosition) {\n        this.palette.contents.setTop(oldTop);\n    }\n};\n\nIDE_Morph.prototype.pressStart = function () {\n    if (this.world().currentKey === 16) { // shiftClicked\n        this.toggleFastTracking();\n    } else {\n        this.stage.threads.pauseCustomHatBlocks = false;\n        this.controlBar.stopButton.refresh();\n        this.runScripts();\n    }\n};\n\nIDE_Morph.prototype.toggleFastTracking = function () {\n    if (this.stage.isFastTracked) {\n        this.stopFastTracking();\n    } else {\n        this.startFastTracking();\n    }\n};\n\nIDE_Morph.prototype.toggleVariableFrameRate = function () {\n    if (StageMorph.prototype.frameRate) {\n        StageMorph.prototype.frameRate = 0;\n        this.stage.fps = 0;\n    } else {\n        StageMorph.prototype.frameRate = 30;\n        this.stage.fps = 30;\n    }\n};\n\nIDE_Morph.prototype.toggleSingleStepping = function () {\n    this.stage.threads.toggleSingleStepping();\n    this.controlBar.steppingButton.refresh();\n    this.controlBar.refreshSlider();\n};\n\nIDE_Morph.prototype.toggleCameraSupport = function () {\n    CamSnapshotDialogMorph.prototype.enableCamera =\n        !CamSnapshotDialogMorph.prototype.enableCamera;\n    this.spriteBar.tabBar.tabTo(this.currentTab);\n    this.createCorralBar();\n    this.fixLayout();\n};\n\nIDE_Morph.prototype.startFastTracking = function () {\n    this.stage.isFastTracked = true;\n    this.stage.fps = 0;\n    this.controlBar.startButton.labelString = new SymbolMorph('flash', 14);\n    this.controlBar.startButton.createLabel();\n    this.controlBar.startButton.fixLayout();\n    this.controlBar.startButton.rerender();\n};\n\nIDE_Morph.prototype.stopFastTracking = function () {\n    this.stage.isFastTracked = false;\n    this.stage.fps = this.stage.frameRate;\n    this.controlBar.startButton.labelString = new SymbolMorph('flag', 14);\n    this.controlBar.startButton.createLabel();\n    this.controlBar.startButton.fixLayout();\n    this.controlBar.startButton.rerender();\n};\n\nIDE_Morph.prototype.runScripts = function () {\n    // Trace.log('IDE.greenFlag');\n    if (this.stage.threads.pauseCustomHatBlocks) {\n        this.stage.threads.pauseCustomHatBlocks = false;\n        this.controlBar.stopButton.refresh();\n    }\n    this.stage.fireGreenFlagEvent();\n};\n\nIDE_Morph.prototype.togglePauseResume = function () {\n    if (this.stage.threads.isPaused()) {\n        // Trace.log('IDE.unpause');\n        this.stage.threads.resumeAll(this.stage);\n    } else {\n        // Trace.log('IDE.pause');\n        this.stage.threads.pauseAll(this.stage);\n    }\n    this.controlBar.pauseButton.refresh();\n};\n\nIDE_Morph.prototype.isPaused = function () {\n    if (!this.stage) {return false; }\n    return this.stage.threads.isPaused();\n};\n\nIDE_Morph.prototype.stopAllScripts = function () {\n    // Trace.log('IDE.stop');\n    if (this.stage.enableCustomHatBlocks) {\n        this.stage.threads.pauseCustomHatBlocks =\n            !this.stage.threads.pauseCustomHatBlocks;\n    } else {\n        this.stage.threads.pauseCustomHatBlocks = false;\n    }\n    this.controlBar.stopButton.refresh();\n    this.stage.fireStopAllEvent();\n};\n\nIDE_Morph.prototype.selectSprite = function (sprite) {\n    // Trace.log('IDE.selectSprite', sprite.name);\n    // prevent switching to another sprite if a block editor is open\n    // so local blocks of different sprites don't mix\n    if (\n        detect(\n            this.world().children,\n            morph => morph instanceof BlockEditorMorph ||\n                morph instanceof BlockDialogMorph\n        )\n    ) {\n        return;\n    }\n    if (this.currentSprite && this.currentSprite.scripts.focus) {\n        this.currentSprite.scripts.focus.stopEditing();\n    }\n    this.currentSprite = sprite;\n    this.createPalette();\n    this.createSpriteBar();\n    this.createSpriteEditor();\n    this.corral.refresh();\n    this.fixLayout('selectSprite');\n    this.currentSprite.scripts.fixMultiArgs();\n};\n\n// IDE_Morph retina display support\n\nIDE_Morph.prototype.toggleRetina = function () {\n    if (isRetinaEnabled()) {\n        disableRetinaSupport();\n    } else {\n        enableRetinaSupport();\n    }\n    this.world().fillPage();\n    if (!MorphicPreferences.isFlat) {\n        IDE_Morph.prototype.scriptsPaneTexture = this.scriptsTexture();\n    }\n    this.stage.clearPenTrails();\n    this.refreshIDE();\n};\n\n// IDE_Morph skins\n\nIDE_Morph.prototype.defaultDesign = function () {\n    this.setDefaultDesign();\n    this.refreshIDE();\n    this.removeSetting('design');\n};\n\nIDE_Morph.prototype.flatDesign = function () {\n    this.setFlatDesign();\n    this.refreshIDE();\n    this.saveSetting('design', 'flat');\n};\n\nIDE_Morph.prototype.refreshIDE = function () {\n    var projectData;\n\n    if (Process.prototype.isCatchingErrors) {\n        try {\n            projectData = this.serializer.serialize(this.stage);\n        } catch (err) {\n            this.showMessage('Serialization failed: ' + err);\n        }\n    } else {\n        projectData = this.serializer.serialize(this.stage);\n    }\n    SpriteMorph.prototype.initBlocks();\n    this.buildPanes();\n    this.fixLayout();\n    if (this.loadNewProject) {\n        this.newProject();\n    } else {\n        this.openProjectString(projectData);\n    }\n};\n\n// IDE_Morph settings persistance\n\nIDE_Morph.prototype.applySavedSettings = function () {\n    var design = this.getSetting('design'),\n        zoom = this.getSetting('zoom'),\n        fade = this.getSetting('fade'),\n        language = this.getSetting('language'),\n        click = this.getSetting('click'),\n        longform = this.getSetting('longform'),\n        longurls = this.getSetting('longurls'),\n        plainprototype = this.getSetting('plainprototype'),\n        keyboard = this.getSetting('keyboard'),\n        tables = this.getSetting('tables'),\n        tableLines = this.getSetting('tableLines'),\n        autoWrapping = this.getSetting('autowrapping'),\n        solidshadow = this.getSetting('solidshadow');\n\n    // design\n    if (design === 'flat') {\n        this.setFlatDesign();\n    } else {\n        this.setDefaultDesign();\n    }\n\n    // blocks zoom\n    if (zoom) {\n        SyntaxElementMorph.prototype.setScale(Math.min(zoom, 12));\n        CommentMorph.prototype.refreshScale();\n        SpriteMorph.prototype.initBlocks();\n    }\n\n    // blocks fade\n    if (!isNil(fade)) {\n        this.setBlockTransparency(+fade);\n    }\n\n    // language\n    if (language && language !== 'en') {\n        this.userLanguage = language;\n    } else {\n        this.userLanguage = null;\n    }\n\n    //  click\n    if (click && !BlockMorph.prototype.snapSound) {\n        BlockMorph.prototype.toggleSnapSound();\n    }\n\n    // long form\n    if (longform) {\n        InputSlotDialogMorph.prototype.isLaunchingExpanded = true;\n    }\n\n    // project data in URLs\n    if (longurls) {\n        this.projectsInURLs = true;\n    } else {\n        this.projectsInURLs = false;\n    }\n\n    // keyboard editing\n    if (keyboard === 'false') {\n        ScriptsMorph.prototype.enableKeyboard = false;\n    } else {\n        ScriptsMorph.prototype.enableKeyboard = true;\n    }\n\n    // tables\n    if (tables === 'false') {\n        List.prototype.enableTables = false;\n    } else {\n        List.prototype.enableTables = true;\n    }\n\n    // tableLines\n    if (tableLines) {\n        TableMorph.prototype.highContrast = true;\n    } else {\n        TableMorph.prototype.highContrast = false;\n    }\n\n    // nested auto-wrapping\n    if (autoWrapping === 'false') {\n        ScriptsMorph.prototype.enableNestedAutoWrapping = false;\n    } else {\n        ScriptsMorph.prototype.enableNestedAutoWrapping = true;\n    }\n\n    // plain prototype labels\n    if (plainprototype) {\n        BlockLabelPlaceHolderMorph.prototype.plainLabel = true;\n    }\n\n    // solid shadow\n    if (solidshadow) {\n        window.useBlurredShadows = false;\n        this.rerender();\n    }\n};\n\nIDE_Morph.prototype.saveSetting = function (key, value) {\n    if (!this.savingPreferences) {\n        return;\n    }\n    if (this.hasLocalStorage()) {\n        localStorage['-snap-setting-' + key] = value;\n    }\n};\n\nIDE_Morph.prototype.getSetting = function (key) {\n    if (this.hasLocalStorage()) {\n        return localStorage['-snap-setting-' + key];\n    }\n    return null;\n};\n\nIDE_Morph.prototype.removeSetting = function (key) {\n    if (this.hasLocalStorage()) {\n        delete localStorage['-snap-setting-' + key];\n    }\n};\n\nIDE_Morph.prototype.hasLocalStorage = function () {\n\t// checks whether localStorage is available,\n    // this kludgy try/catch mechanism is needed\n    // because Safari 11 is paranoid about accessing\n    // localstorage from the file:// protocol\n\ttry {\n\t\treturn !isNil(localStorage);\n\t} catch (err) {\n    \treturn false;\n\t}\n};\n\n// IDE_Morph sprite list access\n\nIDE_Morph.prototype.addNewSprite = function () {\n    var sprite = new SpriteMorph(this.globalVariables),\n        rnd = Process.prototype.reportBasicRandom;\n\n    sprite.name = this.newSpriteName(sprite.name);\n    // Trace.log('IDE.addSprite', sprite.name);\n    sprite.setCenter(this.stage.center());\n    this.stage.add(sprite);\n    sprite.fixLayout();\n    sprite.rerender();\n\n    // randomize sprite properties\n    sprite.setColorComponentHSVA(0, rnd.call(this, 0, 100));\n    sprite.setColorComponentHSVA(1, 100);\n    sprite.setColorComponentHSVA(2, rnd.call(this, 50, 100));\n\n    sprite.setXPosition(rnd.call(this, -220, 220));\n    sprite.setYPosition(rnd.call(this, -160, 160));\n\n    if (this.world().currentKey === 16) { // shift-click\n        sprite.turn(rnd.call(this, 1, 360));\n    }\n\n    this.sprites.add(sprite);\n    this.corral.addSprite(sprite);\n    this.selectSprite(sprite);\n};\n\nIDE_Morph.prototype.paintNewSprite = function () {\n    var sprite = new SpriteMorph(this.globalVariables),\n        cos = new Costume();\n\n    sprite.name = this.newSpriteName(sprite.name);\n    // Trace.log('IDE.paintNewSprite', sprite.name);\n    sprite.setCenter(this.stage.center());\n    this.stage.add(sprite);\n    this.sprites.add(sprite);\n    this.corral.addSprite(sprite);\n    this.selectSprite(sprite);\n    cos.edit(\n        this.world(),\n        this,\n        true,\n        () => this.removeSprite(sprite),\n        () => {\n            sprite.addCostume(cos);\n            sprite.wearCostume(cos);\n        }\n    );\n};\n\nIDE_Morph.prototype.newCamSprite = function () {\n    var sprite = new SpriteMorph(this.globalVariables),\n        camDialog;\n\n    sprite.name = this.newSpriteName(sprite.name);\n    sprite.setCenter(this.stage.center());\n    this.stage.add(sprite);\n    this.sprites.add(sprite);\n    this.corral.addSprite(sprite);\n    this.selectSprite(sprite);\n\n    camDialog = new CamSnapshotDialogMorph(\n        this,\n        sprite,\n        () => this.removeSprite(sprite),\n        function (costume) { // needs to be \"function\" to it can access \"this\"\n            sprite.addCostume(costume);\n            sprite.wearCostume(costume);\n            this.close();\n        });\n\n    camDialog.popUp(this.world());\n};\n\nIDE_Morph.prototype.recordNewSound = function () {\n    var soundRecorder;\n\n    soundRecorder = new SoundRecorderDialogMorph(\n        audio => {\n            var sound;\n            if (audio) {\n                sound = this.currentSprite.addSound(\n                \taudio,\n                    this.newSoundName('recording')\n                );\n                this.makeSureRecordingIsMono(sound);\n                this.spriteBar.tabBar.tabTo('sounds');\n                this.hasChangedMedia = true;\n            }\n        });\n\n    soundRecorder.key = 'microphone';\n    soundRecorder.popUp(this.world());\n};\n\nIDE_Morph.prototype.makeSureRecordingIsMono = function (sound) {\n    // private and temporary, a horrible kludge to work around browsers'\n    // reluctance to implement audio recording constraints that let us\n    // record sound in mono only. As of January 2020 the audio channelCount\n    // constraint only works in Firefox, hence this terrible function to\n    // force convert a stereo sound to mono for Chrome.\n    // If this code is still here next year, something is very wrong.\n    // -Jens\n\n    decodeSound(sound, makeMono);\n\n    function decodeSound(sound, callback) {\n        var base64, binaryString, len, bytes, i, arrayBuffer, audioCtx;\n        if (sound.audioBuffer) {\n            return callback (sound);\n        }\n        base64 = sound.audio.src.split(',')[1];\n        binaryString = window.atob(base64);\n        len = binaryString.length;\n        bytes = new Uint8Array(len);\n        for (i = 0; i < len; i += 1)        {\n            bytes[i] = binaryString.charCodeAt(i);\n        }\n        arrayBuffer = bytes.buffer;\n        audioCtx = Note.prototype.getAudioContext();\n        sound.isDecoding = true;\n        audioCtx.decodeAudioData(\n            arrayBuffer,\n            buffer => {\n                sound.audioBuffer = buffer;\n                return callback (sound);\n            },\n            err => {throw err; }\n        );\n    }\n\n    function makeMono(sound) {\n        var samples, audio, blob, reader;\n        if (sound.audioBuffer.numberOfChannels === 1) {return; }\n        samples = sound.audioBuffer.getChannelData(0);\n\n        audio = new Audio();\n        blob = new Blob(\n            [\n                audioBufferToWav(\n                    encodeSound(samples, 44100).audioBuffer\n                )\n            ],\n            {type: \"audio/wav\"}\n        );\n        reader = new FileReader();\n        reader.onload = () => {\n            audio.src = reader.result;\n            sound.audio = audio; // .... aaaand we're done!\n            sound.audioBuffer = null;\n            sound.cachedSamples = null;\n            sound.isDecoding = false;\n            // console.log('made mono', sound);\n        };\n        reader.readAsDataURL(blob);\n    }\n\n    function encodeSound(samples, rate) {\n        var ctx = Note.prototype.getAudioContext(),\n            frameCount = samples.length,\n            arrayBuffer = ctx.createBuffer(1, frameCount, +rate || 44100),\n            i,\n            source;\n\n        if (!arrayBuffer.copyToChannel) {\n            arrayBuffer.copyToChannel = function (src, channel) {\n                var buffer = this.getChannelData(channel);\n                for (i = 0; i < src.length; i += 1) {\n                    buffer[i] = src[i];\n                }\n            };\n        }\n        arrayBuffer.copyToChannel(\n            Float32Array.from(samples),\n            0,\n            0\n        );\n        source = ctx.createBufferSource();\n        source.buffer = arrayBuffer;\n        source.audioBuffer = source.buffer;\n        return source;\n    }\n\n    function audioBufferToWav(buffer, opt) {\n        var sampleRate = buffer.sampleRate,\n            format = (opt || {}).float32 ? 3 : 1,\n            bitDepth = format === 3 ? 32 : 16,\n            result;\n\n        result = buffer.getChannelData(0);\n        return encodeWAV(result, format, sampleRate, 1, bitDepth);\n    }\n\n    function encodeWAV(\n        samples,\n        format,\n        sampleRate,\n        numChannels,\n        bitDepth\n    ) {\n        var bytesPerSample = bitDepth / 8,\n            blockAlign = numChannels * bytesPerSample,\n            buffer = new ArrayBuffer(44 + samples.length * bytesPerSample),\n            view = new DataView(buffer);\n\n        function writeFloat32(output, offset, input) {\n            for (var i = 0; i < input.length; i += 1, offset += 4) {\n                output.setFloat32(offset, input[i], true);\n            }\n        }\n\n        function floatTo16BitPCM(output, offset, input) {\n            var i, s;\n            for (i = 0; i < input.length; i += 1, offset += 2) {\n                s = Math.max(-1, Math.min(1, input[i]));\n                output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);\n            }\n        }\n\n        function writeString(view, offset, string) {\n            for (var i = 0; i < string.length; i += 1) {\n                view.setUint8(offset + i, string.charCodeAt(i));\n            }\n        }\n\n        writeString(view, 0, 'RIFF'); // RIFF identifier\n        // RIFF chunk length:\n        view.setUint32(4, 36 + samples.length * bytesPerSample, true);\n        writeString(view, 8, 'WAVE'); // RIFF type\n        writeString(view, 12, 'fmt '); // format chunk identifier\n        view.setUint32(16, 16, true); // format chunk length\n        view.setUint16(20, format, true); // sample format (raw)\n        view.setUint16(22, numChannels, true); // channel count\n        view.setUint32(24, sampleRate, true); // sample rate\n        // byte rate (sample rate * block align):\n        view.setUint32(28, sampleRate * blockAlign, true);\n        // block align (channel count * bytes per sample):\n        view.setUint16(32, blockAlign, true);\n        view.setUint16(34, bitDepth, true); // bits per sample\n        writeString(view, 36, 'data'); // data chunk identifier\n        // data chunk length:\n        view.setUint32(40, samples.length * bytesPerSample, true);\n        if (format === 1) { // Raw PCM\n            floatTo16BitPCM(view, 44, samples);\n        } else {\n            writeFloat32(view, 44, samples);\n        }\n        return buffer;\n    }\n};\n\nIDE_Morph.prototype.duplicateSprite = function (sprite) {\n    var duplicate = sprite.fullCopy();\n    // Trace.log('IDE.duplicateSprite', sprite.name);\n\n    duplicate.isDown = false;\n    duplicate.setPosition(this.world().hand.position());\n    duplicate.appearIn(this);\n    duplicate.keepWithin(this.stage);\n    duplicate.isDown = sprite.isDown;\n    this.selectSprite(duplicate);\n};\n\nIDE_Morph.prototype.instantiateSprite = function (sprite) {\n    var instance = sprite.fullCopy(true),\n        hats = instance.allHatBlocksFor('__clone__init__');\n    instance.isDown = false;\n    instance.appearIn(this);\n    if (hats.length) {\n        instance.initClone(hats);\n    } else {\n        instance.setPosition(this.world().hand.position());\n        instance.keepWithin(this.stage);\n    }\n    instance.isDown = sprite.isDown;\n    this.selectSprite(instance);\n};\n\nIDE_Morph.prototype.removeSprite = function (sprite) {\n    var idx;\n    sprite.parts.slice().forEach(part =>\n    \tthis.removeSprite(part)\n    );\n    idx = this.sprites.asArray().indexOf(sprite) + 1;\n    this.stage.threads.stopAllForReceiver(sprite);\n    sprite.corpsify();\n    sprite.destroy();\n    this.stage.watchers().forEach(watcher => {\n        if (watcher.object() === sprite) {\n            watcher.destroy();\n        }\n    });\n    if (idx > 0) {\n        this.sprites.remove(idx);\n    }\n    this.createCorral();\n    this.fixLayout();\n    this.currentSprite = detect(\n        this.stage.children,\n        morph => morph instanceof SpriteMorph && !morph.isTemporary\n    ) || this.stage;\n\n    this.selectSprite(this.currentSprite);\n};\n\nIDE_Morph.prototype.newSoundName = function (name) {\n    var lastSound = this.currentSprite.sounds.at(\n            this.currentSprite.sounds.length()\n        );\n\n    return this.newName(\n        name || lastSound.name,\n        this.currentSprite.sounds.asArray().map(eachSound =>\n            eachSound.name\n        )\n    );\n};\n\nIDE_Morph.prototype.newSpriteName = function (name, ignoredSprite) {\n    var all = this.sprites.asArray().concat(this.stage).filter(each =>\n            each !== ignoredSprite\n        ).map(each => each.name);\n    return this.newName(name, all);\n};\n\nIDE_Morph.prototype.newName = function (name, elements) {\n    var ix = name.indexOf('('),\n        stem = (ix < 0) ? name : name.substring(0, ix),\n        count = 1,\n        newName = stem;\n\n    while (contains(elements, newName)) {\n        count += 1;\n        newName = stem + '(' + count + ')';\n    }\n    return newName;\n};\n\n// IDE_Morph deleting scripts\n\nIDE_Morph.prototype.removeBlock = function (aBlock, justThis) {\n    this.stage.threads.stopAllForBlock(aBlock);\n    aBlock.destroy(justThis);\n};\n\n// IDE_Morph menus\n\nIDE_Morph.prototype.userMenu = function () {\n    var menu = new MenuMorph(this);\n    // menu.addItem('help', 'nop');\n    return menu;\n};\n\nIDE_Morph.prototype.snapMenu = function () {\n    var menu,\n        world = this.world();\n\n    menu = new MenuMorph(this);\n    menu.addItem('About...', 'aboutSnap');\n    menu.addLine();\n    menu.addItem(\n        'Reference manual',\n        () => {\n            var url = this.resourceURL('help', 'SnapManual.pdf');\n            window.open(url, 'SnapReferenceManual');\n        }\n    );\n    menu.addItem(\n        'Snap! website',\n        () => window.open('https://snap.berkeley.edu/', 'SnapWebsite')\n    );\n    menu.addItem(\n        'Download source',\n        () => window.open(\n                'https://github.com/jmoenig/Snap/releases/latest',\n                'SnapSource'\n            )\n    );\n    if (world.isDevMode) {\n        menu.addLine();\n        menu.addItem(\n            'Switch back to user mode',\n            'switchToUserMode',\n            'disable deep-Morphic\\ncontext menus'\n                + '\\nand show user-friendly ones',\n            new Color(0, 100, 0)\n        );\n    } else if (world.currentKey === 16) { // shift-click\n        menu.addLine();\n        menu.addItem(\n            'Switch to dev mode',\n            'switchToDevMode',\n            'enable Morphic\\ncontext menus\\nand inspectors,'\n                + '\\nnot user-friendly!',\n            new Color(100, 0, 0)\n        );\n    }\n    menu.popup(world, this.logo.bottomLeft());\n};\n\nIDE_Morph.prototype.cloudMenu = function () {\n    var menu,\n        world = this.world(),\n        pos = this.controlBar.cloudButton.bottomLeft(),\n        shiftClicked = (world.currentKey === 16);\n\n    if (location.protocol === 'file:' && !shiftClicked) {\n        this.showMessage('cloud unavailable without a web server.');\n        return;\n    }\n\n    menu = new MenuMorph(this);\n    if (shiftClicked) {\n        menu.addItem(\n            'url...',\n            'setCloudURL',\n            null,\n            new Color(100, 0, 0)\n        );\n        menu.addLine();\n    }\n    if (!this.cloud.username) {\n        menu.addItem(\n            'Login...',\n            'initializeCloud'\n        );\n        menu.addItem(\n            'Signup...',\n            'createCloudAccount'\n        );\n        menu.addItem(\n            'Reset Password...',\n            'resetCloudPassword'\n        );\n        menu.addItem(\n            'Resend Verification Email...',\n            'resendVerification'\n        );\n    } else {\n        menu.addItem(\n            localize('Logout') + ' ' + this.cloud.username,\n            'logout'\n        );\n        menu.addItem(\n            'Change Password...',\n            'changeCloudPassword'\n        );\n    }\n    if (this.hasCloudProject()) {\n        menu.addLine();\n        menu.addItem(\n            'Open in Community Site',\n            () => {\n                var dict = this.urlParameters();\n                window.open(\n                    this.cloud.showProjectPath(\n                        dict.Username, dict.ProjectName\n                    ),\n                    '_blank'\n                );\n            }\n        );\n    }\n    if (shiftClicked) {\n        menu.addLine();\n        menu.addItem(\n            'export project media only...',\n            () => {\n                if (this.projectName) {\n                    this.exportProjectMedia(this.projectName);\n                } else {\n                    this.prompt(\n                        'Export Project As...',\n                        name => this.exportProjectMedia(name),\n                        null,\n                        'exportProject'\n                    );\n                }\n            },\n            null,\n            this.hasChangedMedia ? new Color(100, 0, 0) : new Color(0, 100, 0)\n        );\n        menu.addItem(\n            'export project without media...',\n            () => {\n                if (this.projectName) {\n                    this.exportProjectNoMedia(this.projectName);\n                } else {\n                    this.prompt(\n                        'Export Project As...',\n                        name => this.exportProjectNoMedia(name),\n                        null,\n                        'exportProject'\n                    );\n                }\n            },\n            null,\n            new Color(100, 0, 0)\n        );\n        menu.addItem(\n            'export project as cloud data...',\n            () => {\n                if (this.projectName) {\n                    this.exportProjectAsCloudData(this.projectName);\n                } else {\n                    this.prompt(\n                        'Export Project As...',\n                        name => this.exportProjectAsCloudData(name),\n                        null,\n                        'exportProject'\n                    );\n                }\n            },\n            null,\n            new Color(100, 0, 0)\n        );\n        menu.addLine();\n        menu.addItem(\n            'open shared project from cloud...',\n            () => {\n                this.prompt(\n                    'Author name',\n                    usr => {\n                        this.prompt(\n                            'Project name...',\n                            prj => {\n                                this.showMessage(\n                                    'Fetching project\\nfrom the cloud...'\n                                );\n                                this.cloud.getPublicProject(\n                                    prj,\n                                    usr.toLowerCase(),\n                                    projectData => {\n                                        var msg;\n                                        if (\n                                            !Process.prototype.isCatchingErrors\n                                        ) {\n                                            window.open(\n                                                'data:text/xml,' + projectData\n                                            );\n                                        }\n                                    this.nextSteps([\n                                        () => {\n                                            msg = this.showMessage(\n                                                'Opening project...'\n                                            );\n                                        },\n                                        () => {\n                                            this.rawOpenCloudDataString(\n                                                projectData\n                                            );\n                                            msg.destroy();\n                                        },\n                                    ]);\n                                },\n                                this.cloudError()\n                            );\n                        },\n                        null,\n                        'project'\n                    );\n                },\n                null,\n                'project'\n                );\n            },\n            null,\n            new Color(100, 0, 0)\n        );\n    }\n    menu.popup(world, pos);\n};\n\nIDE_Morph.prototype.settingsMenu = function () {\n    var menu,\n        stage = this.stage,\n        world = this.world(),\n        pos = this.controlBar.settingsButton.bottomLeft(),\n        shiftClicked = (world.currentKey === 16),\n        on = new SymbolMorph(\n            'checkedBox',\n            MorphicPreferences.menuFontSize * 0.75\n        ),\n        off = new SymbolMorph(\n            'rectangle',\n            MorphicPreferences.menuFontSize * 0.75\n        );\n\n    function addPreference(label, toggle, test, onHint, offHint, hide) {\n        if (!hide || shiftClicked) {\n            menu.addItem(\n                [\n                    (test? on : off),\n                    localize(label)\n                ],\n                toggle,\n                test ? onHint : offHint,\n                hide ? new Color(100, 0, 0) : null\n            );\n        }\n    }\n\n    menu = new MenuMorph(this);\n    menu.addPair(\n        [\n            new SymbolMorph(\n                'globe',\n                MorphicPreferences.menuFontSize\n            ),\n            localize('Language...')\n        ],\n        'languageMenu'\n    );\n    menu.addItem(\n        'Zoom blocks...',\n        'userSetBlocksScale'\n    );\n    menu.addItem(\n        'Fade blocks...',\n        'userFadeBlocks'\n    );\n    menu.addItem(\n        'Stage size...',\n        'userSetStageSize'\n    );\n    if (shiftClicked) {\n        menu.addItem(\n            'Dragging threshold...',\n            'userSetDragThreshold',\n            'specify the distance the hand has to move\\n' +\n                'before it picks up an object',\n            new Color(100, 0, 0)\n        );\n    }\n    menu.addItem(\n        'Microphone resolution...',\n        'microphoneMenu'\n    );\n    menu.addLine();\n    /*\n    addPreference(\n        'JavaScript',\n        () => {\n            Process.prototype.enableJS = !Process.prototype.enableJS;\n            this.currentSprite.blocksCache.operators = null;\n            this.currentSprite.paletteCache.operators = null;\n            this.refreshPalette();\n        },\n        Process.prototype.enableJS,\n        'uncheck to disable support for\\nnative JavaScript functions',\n        'check to support\\nnative JavaScript functions'\n    );\n    */\n    if (isRetinaSupported()) {\n        addPreference(\n            'Retina display support',\n            'toggleRetina',\n            isRetinaEnabled(),\n            'uncheck for lower resolution,\\nsaves computing resources',\n            'check for higher resolution,\\nuses more computing resources',\n            true\n        );\n    }\n    addPreference(\n        'Input sliders',\n        'toggleInputSliders',\n        MorphicPreferences.useSliderForInput,\n        'uncheck to disable\\ninput sliders for\\nentry fields',\n        'check to enable\\ninput sliders for\\nentry fields'\n    );\n    if (MorphicPreferences.useSliderForInput) {\n        addPreference(\n            'Execute on slider change',\n            'toggleSliderExecute',\n            ArgMorph.prototype.executeOnSliderEdit,\n            'uncheck to suppress\\nrunning scripts\\nwhen moving the slider',\n            'check to run\\nthe edited script\\nwhen moving the slider'\n        );\n    }\n    addPreference(\n        'Turbo mode',\n        'toggleFastTracking',\n        this.stage.isFastTracked,\n        'uncheck to run scripts\\nat normal speed',\n        'check to prioritize\\nscript execution'\n    );\n    addPreference(\n        'Visible stepping',\n        'toggleSingleStepping',\n        Process.prototype.enableSingleStepping,\n        'uncheck to turn off\\nvisible stepping',\n        'check to turn on\\n visible stepping (slow)',\n        false\n    );\n    addPreference(\n        'Log pen vectors',\n        () => StageMorph.prototype.enablePenLogging =\n            !StageMorph.prototype.enablePenLogging,\n        StageMorph.prototype.enablePenLogging,\n        'uncheck to turn off\\nlogging pen vectors',\n        'check to turn on\\nlogging pen vectors',\n        false\n    );\n    addPreference(\n        'Ternary Boolean slots',\n        () => BooleanSlotMorph.prototype.isTernary =\n            !BooleanSlotMorph.prototype.isTernary,\n        BooleanSlotMorph.prototype.isTernary,\n        'uncheck to limit\\nBoolean slots to true / false',\n        'check to allow\\nempty Boolean slots',\n        true\n    );\n    addPreference(\n        'Camera support',\n        'toggleCameraSupport',\n        CamSnapshotDialogMorph.prototype.enableCamera,\n        'uncheck to disable\\ncamera support',\n        'check to enable\\ncamera support',\n        true\n    );\n    menu.addLine(); // everything visible below is persistent\n    addPreference(\n        'Blurred shadows',\n        'toggleBlurredShadows',\n        useBlurredShadows,\n        'uncheck to use solid drop\\nshadows and highlights',\n        'check to use blurred drop\\nshadows and highlights',\n        true\n    );\n    addPreference(\n        'Zebra coloring',\n        'toggleZebraColoring',\n        BlockMorph.prototype.zebraContrast,\n        'uncheck to disable alternating\\ncolors for nested block',\n        'check to enable alternating\\ncolors for nested blocks',\n        true\n    );\n    addPreference(\n        'Dynamic input labels',\n        'toggleDynamicInputLabels',\n        SyntaxElementMorph.prototype.dynamicInputLabels,\n        'uncheck to disable dynamic\\nlabels for variadic inputs',\n        'check to enable dynamic\\nlabels for variadic inputs',\n        true\n    );\n    addPreference(\n        'Prefer empty slot drops',\n        'togglePreferEmptySlotDrops',\n        ScriptsMorph.prototype.isPreferringEmptySlots,\n        'uncheck to allow dropped\\nreporters to kick out others',\n        'settings menu prefer empty slots hint',\n        true\n    );\n    addPreference(\n        'Long form input dialog',\n        'toggleLongFormInputDialog',\n        InputSlotDialogMorph.prototype.isLaunchingExpanded,\n        'uncheck to use the input\\ndialog in short form',\n        'check to always show slot\\ntypes in the input dialog'\n    );\n    addPreference(\n        'Plain prototype labels',\n        'togglePlainPrototypeLabels',\n        BlockLabelPlaceHolderMorph.prototype.plainLabel,\n        'uncheck to always show (+) symbols\\nin block prototype labels',\n        'check to hide (+) symbols\\nin block prototype labels'\n    );\n    addPreference(\n        'Virtual keyboard',\n        'toggleVirtualKeyboard',\n        MorphicPreferences.useVirtualKeyboard,\n        'uncheck to disable\\nvirtual keyboard support\\nfor mobile devices',\n        'check to enable\\nvirtual keyboard support\\nfor mobile devices',\n        true\n    );\n    addPreference(\n        'Clicking sound',\n        () => {\n            BlockMorph.prototype.toggleSnapSound();\n            if (BlockMorph.prototype.snapSound) {\n                this.saveSetting('click', true);\n            } else {\n                this.removeSetting('click');\n            }\n        },\n        BlockMorph.prototype.snapSound,\n        'uncheck to turn\\nblock clicking\\nsound off',\n        'check to turn\\nblock clicking\\nsound on'\n    );\n    addPreference(\n        'Animations',\n        () => this.isAnimating = !this.isAnimating,\n        this.isAnimating,\n        'uncheck to disable\\nIDE animations',\n        'check to enable\\nIDE animations',\n        true\n    );\n    addPreference(\n        'Cache Inputs',\n        () => {\n            BlockMorph.prototype.isCachingInputs =\n                !BlockMorph.prototype.isCachingInputs;\n        },\n        BlockMorph.prototype.isCachingInputs,\n        'uncheck to stop caching\\ninputs (for debugging the evaluator)',\n        'check to cache inputs\\nboosts recursion',\n        true\n    );\n    addPreference(\n        'Rasterize SVGs',\n        () => MorphicPreferences.rasterizeSVGs =\n            !MorphicPreferences.rasterizeSVGs,\n        MorphicPreferences.rasterizeSVGs,\n        'uncheck for smooth\\nscaling of vector costumes',\n        'check to rasterize\\nSVGs on import',\n        true\n    );\n    addPreference(\n        'Flat design',\n        () => {\n            if (MorphicPreferences.isFlat) {\n                return this.defaultDesign();\n            }\n            this.flatDesign();\n        },\n        MorphicPreferences.isFlat,\n        'uncheck for default\\nGUI design',\n        'check for alternative\\nGUI design',\n        false\n    );\n    addPreference(\n        'Nested auto-wrapping',\n        () => {\n            ScriptsMorph.prototype.enableNestedAutoWrapping =\n                !ScriptsMorph.prototype.enableNestedAutoWrapping;\n            if (ScriptsMorph.prototype.enableNestedAutoWrapping) {\n                this.removeSetting('autowrapping');\n            } else {\n                this.saveSetting('autowrapping', false);\n            }\n        },\n        ScriptsMorph.prototype.enableNestedAutoWrapping,\n        'uncheck to confine auto-wrapping\\nto top-level block stacks',\n        'check to enable auto-wrapping\\ninside nested block stacks',\n        true\n    );\n    addPreference(\n        'Project URLs',\n        () => {\n            this.projectsInURLs = !this.projectsInURLs;\n            if (this.projectsInURLs) {\n                this.saveSetting('longurls', true);\n            } else {\n                this.removeSetting('longurls');\n            }\n        },\n        this.projectsInURLs,\n        'uncheck to disable\\nproject data in URLs',\n        'check to enable\\nproject data in URLs',\n        true\n    );\n    addPreference(\n        'Sprite Nesting',\n        () => SpriteMorph.prototype.enableNesting =\n            !SpriteMorph.prototype.enableNesting,\n        SpriteMorph.prototype.enableNesting,\n        'uncheck to disable\\nsprite composition',\n        'check to enable\\nsprite composition',\n        true\n    );\n    addPreference(\n        'First-Class Sprites',\n        () => {\n            SpriteMorph.prototype.enableFirstClass =\n                !SpriteMorph.prototype.enableFirstClass;\n            this.currentSprite.blocksCache.sensing = null;\n            this.currentSprite.paletteCache.sensing = null;\n            this.refreshPalette();\n        },\n        SpriteMorph.prototype.enableFirstClass,\n        'uncheck to disable support\\nfor first-class sprites',\n        'check to enable support\\n for first-class sprite',\n        true\n    );\n    addPreference(\n        'Keyboard Editing',\n        () => {\n            ScriptsMorph.prototype.enableKeyboard =\n                !ScriptsMorph.prototype.enableKeyboard;\n            this.currentSprite.scripts.updateToolbar();\n            if (ScriptsMorph.prototype.enableKeyboard) {\n                this.removeSetting('keyboard');\n            } else {\n                this.saveSetting('keyboard', false);\n            }\n        },\n        ScriptsMorph.prototype.enableKeyboard,\n        'uncheck to disable\\nkeyboard editing support',\n        'check to enable\\nkeyboard editing support',\n        true\n    );\n    addPreference(\n        'Table support',\n        () => {\n            List.prototype.enableTables =\n                !List.prototype.enableTables;\n            if (List.prototype.enableTables) {\n                this.removeSetting('tables');\n            } else {\n                this.saveSetting('tables', false);\n            }\n        },\n        List.prototype.enableTables,\n        'uncheck to disable\\nmulti-column list views',\n        'check for multi-column\\nlist view support',\n        true\n    );\n    if (List.prototype.enableTables) {\n        addPreference(\n            'Table lines',\n            () => {\n                TableMorph.prototype.highContrast =\n                    !TableMorph.prototype.highContrast;\n                if (TableMorph.prototype.highContrast) {\n                    this.saveSetting('tableLines', true);\n                } else {\n                    this.removeSetting('tableLines');\n                }\n            },\n            TableMorph.prototype.highContrast,\n            'uncheck for less contrast\\nmulti-column list views',\n            'check for higher contrast\\ntable views',\n            true\n        );\n    }\n    addPreference(\n        'Live coding support',\n        () => Process.prototype.enableLiveCoding =\n            !Process.prototype.enableLiveCoding,\n        Process.prototype.enableLiveCoding,\n        'EXPERIMENTAL! uncheck to disable live\\ncustom control structures',\n        'EXPERIMENTAL! check to enable\\n live custom control structures',\n        true\n    );\n    addPreference(\n        'JIT compiler support',\n        () => {\n            Process.prototype.enableCompiling =\n                !Process.prototype.enableCompiling;\n            this.currentSprite.blocksCache.operators = null;\n            this.currentSprite.paletteCache.operators = null;\n            this.refreshPalette();\n        },\n        Process.prototype.enableCompiling,\n        'EXPERIMENTAL! uncheck to disable live\\nsupport for compiling',\n        'EXPERIMENTAL! check to enable\\nsupport for compiling',\n        true\n    );\n    menu.addLine(); // everything below this line is stored in the project\n    addPreference(\n        'Thread safe scripts',\n        () => stage.isThreadSafe = !stage.isThreadSafe,\n        this.stage.isThreadSafe,\n        'uncheck to allow\\nscript reentrance',\n        'check to disallow\\nscript reentrance'\n    );\n    addPreference(\n        'Prefer smooth animations',\n        'toggleVariableFrameRate',\n        StageMorph.prototype.frameRate,\n        'uncheck for greater speed\\nat variable frame rates',\n        'check for smooth, predictable\\nanimations across computers',\n        true\n    );\n    addPreference(\n        'Flat line ends',\n        () => SpriteMorph.prototype.useFlatLineEnds =\n            !SpriteMorph.prototype.useFlatLineEnds,\n        SpriteMorph.prototype.useFlatLineEnds,\n        'uncheck for round ends of lines',\n        'check for flat ends of lines'\n    );\n    addPreference(\n        'Codification support',\n        () => {\n            StageMorph.prototype.enableCodeMapping =\n                !StageMorph.prototype.enableCodeMapping;\n            this.currentSprite.blocksCache.variables = null;\n            this.currentSprite.paletteCache.variables = null;\n            this.refreshPalette();\n        },\n        StageMorph.prototype.enableCodeMapping,\n        'uncheck to disable\\nblock to text mapping features',\n        'check for block\\nto text mapping features',\n        false\n    );\n    addPreference(\n        'Inheritance support',\n        () => {\n            StageMorph.prototype.enableInheritance =\n                !StageMorph.prototype.enableInheritance;\n            this.currentSprite.blocksCache.variables = null;\n            this.currentSprite.paletteCache.variables = null;\n            this.refreshPalette();\n        },\n        StageMorph.prototype.enableInheritance,\n        'uncheck to disable\\nsprite inheritance features',\n        'check for sprite\\ninheritance features',\n        true\n    );\n    addPreference(\n        'Hyper blocks support',\n        () => Process.prototype.enableHyperOps =\n            !Process.prototype.enableHyperOps,\n        Process.prototype.enableHyperOps,\n        'uncheck to disable\\nusing operators on lists and tables',\n        'check to enable\\nusing operators on lists and tables',\n        false\n    );\n    addPreference(\n        'Persist linked sublist IDs',\n        () => StageMorph.prototype.enableSublistIDs =\n            !StageMorph.prototype.enableSublistIDs,\n        StageMorph.prototype.enableSublistIDs,\n        'uncheck to disable\\nsaving linked sublist identities',\n        'check to enable\\nsaving linked sublist identities',\n        true\n    );\n    addPreference(\n        'Enable command drops in all rings',\n        () => RingReporterSlotMorph.prototype.enableCommandDrops =\n            !RingReporterSlotMorph.prototype.enableCommandDrops,\n        RingReporterSlotMorph.prototype.enableCommandDrops,\n        'uncheck to disable\\ndropping commands in reporter rings',\n        'check to enable\\ndropping commands in all rings',\n        true\n    );\n    menu.popup(world, pos);\n};\n\nIDE_Morph.prototype.projectMenu = function () {\n    var menu,\n        world = this.world(),\n        pos = this.controlBar.projectButton.bottomLeft(),\n        graphicsName = this.currentSprite instanceof SpriteMorph ?\n                'Costumes' : 'Backgrounds',\n        shiftClicked = (world.currentKey === 16);\n\n    menu = new MenuMorph(this);\n    menu.addItem('Project notes...', 'editProjectNotes');\n    menu.addLine();\n    menu.addPair('New', 'createNewProject', '^N');\n    menu.addPair('Open...', 'openProjectsBrowser', '^O');\n    menu.addPair('Save', \"save\", '^S');\n    menu.addItem('Save As...', 'saveProjectsBrowser');\n    menu.addLine();\n    menu.addItem(\n        'Import...',\n        'importLocalFile',\n        'file menu import hint' // looks up the actual text in the translator\n    );\n\n    if (shiftClicked) {\n        menu.addItem(\n            localize(\n                'Export project...') + ' ' + localize('(in a new window)'\n            ),\n            () => {\n                if (this.projectName) {\n                    this.exportProject(this.projectName, shiftClicked);\n                } else {\n                    this.prompt(\n                        'Export Project As...',\n                        // false - override the shiftClick setting to use XML:\n                        name => this.exportProject(name, false),\n                        null,\n                        'exportProject'\n                    );\n                }\n            },\n            'show project data as XML\\nin a new browser window',\n            new Color(100, 0, 0)\n        );\n    }\n    menu.addItem(\n        shiftClicked ?\n                'Export project as plain text...' : 'Export project...',\n        () => {\n            if (this.projectName) {\n                this.exportProject(this.projectName, shiftClicked);\n            } else {\n                this.prompt(\n                    'Export Project As...',\n                    name => this.exportProject(name, shiftClicked),\n                    null,\n                    'exportProject'\n                );\n            }\n        },\n        'save project data as XML\\nto your downloads folder',\n        shiftClicked ? new Color(100, 0, 0) : null\n    );\n\n    if (this.stage.globalBlocks.length) {\n        menu.addItem(\n            'Export blocks...',\n            () => this.exportGlobalBlocks(),\n            'save global custom block\\ndefinitions as XML'\n        );\n        menu.addItem(\n            'Unused blocks...',\n            () => this.removeUnusedBlocks(),\n            'find unused global custom blocks' +\n                '\\nand remove their definitions'\n        );\n    }\n\n    menu.addItem(\n        'Export summary...',\n        () => this.exportProjectSummary(),\n        'save a summary\\nof this project'\n    );\n\n    if (shiftClicked) {\n        menu.addItem(\n            'Export summary with drop-shadows...',\n            () => this.exportProjectSummary(true),\n            'download and save' +\n                '\\nwith a summary of this project' +\n                '\\nwith drop-shadows on all pictures.' +\n                '\\nnot supported by all browsers',\n            new Color(100, 0, 0)\n        );\n        menu.addItem(\n            'Export all scripts as pic...',\n            () => this.exportScriptsPicture(),\n            'show a picture of all scripts\\nand block definitions',\n            new Color(100, 0, 0)\n        );\n    }\n\n    menu.addLine();\n    menu.addItem(\n        'Libraries...',\n        () => {\n            if (location.protocol === 'file:') {\n                this.importLocalFile();\n                return;\n            }\n            this.getURL(\n                this.resourceURL('libraries', 'LIBRARIES'),\n                txt => {\n                    var libraries = this.parseResourceFile(txt);\n                    new LibraryImportDialogMorph(this, libraries).popUp();\n                }\n            );\n        },\n        'Select categories of additional blocks to add to this project.'\n    );\n\n    menu.addItem(\n        localize(graphicsName) + '...',\n        () => {\n            if (location.protocol === 'file:') {\n                this.importLocalFile();\n                return;\n            }\n            this.importMedia(graphicsName);\n        },\n        'Select a costume from the media library'\n    );\n    menu.addItem(\n        localize('Sounds') + '...',\n        () => {\n            if (location.protocol === 'file:') {\n                this.importLocalFile();\n                return;\n            }\n            this.importMedia('Sounds');\n        },\n        'Select a sound from the media library'\n    );\n\n    menu.popup(world, pos);\n};\n\nIDE_Morph.prototype.resourceURL = function () {\n    // Take in variadic inputs that represent an a nested folder structure.\n    // Method can be easily overridden if running in a custom location.\n    // Default Snap! simply returns a path (relative to snap.html)\n    var args = Array.prototype.slice.call(arguments, 0);\n    return args.join('/');\n};\n\nIDE_Morph.prototype.getMediaList = function (dirname, callback) {\n    // Invoke the given callback with a list of files in a directory\n    // based on the contents file.\n    // If no callback is specified, synchronously return the list of files\n    // Note: Synchronous fetching has been deprecated and should be switched\n    var url = this.resourceURL(dirname, dirname.toUpperCase()),\n        async = callback instanceof Function,\n        data;\n\n    function alphabetically(x, y) {\n        return x.name.toLowerCase() < y.name.toLowerCase() ? -1 : 1;\n    }\n\n    if (async) {\n        this.getURL(\n            url,\n            txt => {\n                var data = this.parseResourceFile(txt);\n                data.sort(alphabetically);\n                callback.call(this, data);\n            }\n        );\n    } else {\n        data = this.parseResourceFile(this.getURL(url));\n        data.sort(alphabetically);\n        return data;\n    }\n};\n\nIDE_Morph.prototype.parseResourceFile = function (text) {\n    // A Resource File lists all the files that could be loaded in a submenu\n    // Examples are libraries/LIBRARIES, Costumes/COSTUMES, etc\n    // The file format is tab-delimited, with unix newlines:\n    // file-name, Display Name, Help Text (optional)\n    var parts,\n        items = [];\n\n    text.split('\\n').map(line =>\n        line.trim()\n    ).filter(line =>\n        line.length > 0\n    ).forEach(line => {\n        parts = line.split('\\t').map(str => str.trim());\n\n        if (parts.length < 2) {return; }\n\n        items.push({\n            fileName: parts[0],\n            name: parts[1],\n            description: parts.length > 2 ? parts[2] : ''\n        });\n    });\n\n    return items;\n};\n\nIDE_Morph.prototype.importLocalFile = function () {\n    var inp = document.createElement('input'),\n        world = this.world();\n\n    if (this.filePicker) {\n        document.body.removeChild(this.filePicker);\n        this.filePicker = null;\n    }\n    inp.type = 'file';\n    inp.style.color = \"transparent\";\n    inp.style.backgroundColor = \"transparent\";\n    inp.style.border = \"none\";\n    inp.style.outline = \"none\";\n    inp.style.position = \"absolute\";\n    inp.style.top = \"0px\";\n    inp.style.left = \"0px\";\n    inp.style.width = \"0px\";\n    inp.style.height = \"0px\";\n    inp.style.display = \"none\";\n    inp.addEventListener(\n        \"change\",\n        () => {\n            document.body.removeChild(inp);\n            this.filePicker = null;\n            world.hand.processDrop(inp.files);\n        },\n        false\n    );\n    document.body.appendChild(inp);\n    this.filePicker = inp;\n    inp.click();\n};\n\nIDE_Morph.prototype.importMedia = function (folderName) {\n    // open a dialog box letting the user browse available \"built-in\"\n    // costumes, backgrounds or sounds\n    var msg = this.showMessage('Opening ' + folderName + '...');\n    this.getMediaList(\n        folderName,\n        items => {\n            msg.destroy();\n            this.popupMediaImportDialog(folderName, items);\n        }\n    );\n\n};\n\nIDE_Morph.prototype.popupMediaImportDialog = function (folderName, items) {\n    // private - this gets called by importMedia() and creates\n    // the actual dialog\n    var dialog = new DialogBoxMorph().withKey('import' + folderName),\n        frame = new ScrollFrameMorph(),\n        selectedIcon = null,\n        turtle = new SymbolMorph('turtle', 60),\n        myself = this,\n        world = this.world(),\n        handle;\n\n    frame.acceptsDrops = false;\n    frame.contents.acceptsDrops = false;\n    frame.color = myself.groupColor;\n    frame.fixLayout = nop;\n    dialog.labelString = folderName;\n    dialog.createLabel();\n    dialog.addBody(frame);\n    dialog.addButton('ok', 'Import');\n    dialog.addButton('cancel', 'Cancel');\n\n    dialog.ok = function () {\n        if (selectedIcon) {\n            if (selectedIcon.object instanceof Sound) {\n                myself.droppedAudio(\n                    selectedIcon.object.copy().audio,\n                    selectedIcon.labelString\n                );\n            } else if (selectedIcon.object instanceof SVG_Costume) {\n                myself.droppedSVG(\n                    selectedIcon.object.contents,\n                    selectedIcon.labelString\n                );\n            } else {\n                myself.droppedImage(\n                    selectedIcon.object.contents,\n                    selectedIcon.labelString\n                );\n            }\n        }\n    };\n\n    dialog.fixLayout = function () {\n        var th = fontHeight(this.titleFontSize) + this.titlePadding * 2,\n            x = 0,\n            y = 0,\n            fp, fw;\n        this.buttons.fixLayout();\n        this.body.setPosition(this.position().add(new Point(\n            this.padding,\n            th + this.padding\n        )));\n        this.body.setExtent(new Point(\n            this.width() - this.padding * 2,\n            this.height() - this.padding * 3 - th - this.buttons.height()\n        ));\n        fp = this.body.position();\n        fw = this.body.width();\n        frame.contents.children.forEach(function (icon) {\n              icon.setPosition(fp.add(new Point(x, y)));\n            x += icon.width();\n            if (x + icon.width() > fw) {\n                x = 0;\n                y += icon.height();\n            }\n        });\n        frame.contents.adjustBounds();\n        this.label.setCenter(this.center());\n        this.label.setTop(this.top() + (th - this.label.height()) / 2);\n        this.buttons.setCenter(this.center());\n        this.buttons.setBottom(this.bottom() - this.padding);\n\n        // refresh shadow\n        this.removeShadow();\n        this.addShadow();\n    };\n\n    items.forEach(item => {\n        // Caution: creating very many thumbnails can take a long time!\n        var url = this.resourceURL(folderName, item.fileName),\n            img = new Image(),\n            suffix = url.slice(url.lastIndexOf('.') + 1).toLowerCase(),\n            isSVG = suffix === 'svg' && !MorphicPreferences.rasterizeSVGs,\n            isSound = contains(['wav', 'mp3'], suffix),\n            icon;\n\n        if (isSound) {\n            icon = new SoundIconMorph(new Sound(new Audio(), item.name));\n        } else {\n            icon = new CostumeIconMorph(\n                new Costume(turtle.getImage(), item.name)\n            );\n        }\n        icon.isDraggable = false;\n        icon.userMenu = nop;\n        icon.action = function () {\n            if (selectedIcon === icon) {return; }\n            var prevSelected = selectedIcon;\n            selectedIcon = icon;\n            if (prevSelected) {prevSelected.refresh(); }\n        };\n        icon.doubleClickAction = dialog.ok;\n        icon.query = function () {\n            return icon === selectedIcon;\n        };\n        frame.addContents(icon);\n        if (isSound) {\n            icon.object.audio.onloadeddata = function () {\n                icon.createThumbnail();\n                icon.fixLayout();\n                icon.refresh();\n            };\n\n            icon.object.audio.src = url;\n            icon.object.audio.load();\n        } else if (isSVG) {\n            img.onload = function () {\n                icon.object = new SVG_Costume(img, item.name);\n                icon.refresh();\n            };\n            this.getURL(\n                url,\n                txt => img.src = 'data:image/svg+xml;base64,' +\n                    window.btoa(txt)\n            );\n        } else {\n            img.onload = function () {\n                var canvas = newCanvas(new Point(img.width, img.height), true);\n                canvas.getContext('2d').drawImage(img, 0, 0);\n                icon.object = new Costume(canvas, item.name);\n                icon.refresh();\n            };\n            img.src = url;\n        }\n    });\n    dialog.popUp(world);\n    dialog.setExtent(new Point(400, 300));\n    dialog.setCenter(world.center());\n\n    handle = new HandleMorph(\n        dialog,\n        300,\n        280,\n        dialog.corner,\n        dialog.corner\n    );\n};\n\n// IDE_Morph menu actions\n\nIDE_Morph.prototype.aboutSnap = function () {\n    var dlg, aboutTxt, noticeTxt, creditsTxt, versions = '', translations,\n        module, btn1, btn2, btn3, btn4, licenseBtn, translatorsBtn,\n        world = this.world();\n\n    aboutTxt = 'Snap! 6.3.6 \\nBuild Your Own Blocks\\n\\n'\n        + 'Copyright \\u24B8 2008-2020 Jens M\\u00F6nig and '\n        + 'Brian Harvey\\n'\n        + 'jens@moenig.org, bh@cs.berkeley.edu\\n\\n'\n        + '        Snap! is developed by the University of California, '\n        + 'Berkeley and SAP        \\n'\n        + 'with support from the National Science Foundation (NSF),\\n'\n        + 'MIOsoft and YC Research.\\n'\n        + 'The design of Snap! is influenced and inspired by Scratch,\\n'\n        + 'from the Lifelong Kindergarten group at the MIT Media Lab\\n\\n'\n\n        + 'for more information see https://snap.berkeley.edu';\n\n    noticeTxt = localize('License')\n        + '\\n\\n'\n        + 'Snap! is free software: you can redistribute it and/or modify\\n'\n        + 'it under the terms of the GNU Affero General Public License as\\n'\n        + 'published by the Free Software Foundation, either version 3 of\\n'\n        + 'the License, or (at your option) any later version.\\n\\n'\n\n        + 'This program is distributed in the hope that it will be useful,\\n'\n        + 'but WITHOUT ANY WARRANTY; without even the implied warranty of\\n'\n        + 'MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\\n'\n        + 'GNU Affero General Public License for more details.\\n\\n'\n\n        + 'You should have received a copy of the\\n'\n        + 'GNU Affero General Public License along with this program.\\n'\n        + 'If not, see http://www.gnu.org/licenses/\\n\\n'\n\n        + 'Want to use Snap! but scared by the open-source license?\\n'\n        + 'Get in touch with us, we\\'ll make it work.';\n\n    creditsTxt = localize('Contributors')\n        + '\\n\\nNathan Dinsmore: Saving/Loading, Snap-Logo Design, '\n        + '\\ncountless bugfixes and optimizations'\n        + '\\nMichael Ball: Time/Date UI, Library Import Dialog,'\n        + '\\ncountless bugfixes and optimizations'\n        + '\\nBernat Romagosa: Countless contributions'\n        + '\\nBartosz Leper: Retina Display Support'\n        + '\\nZhenlei Jia and Dariusz Doroalski: IME text editing'\n        + '\\nKen Kahn: IME support and countless other contributions'\n        + '\\nJosep Ferrndiz: Video Motion Detection'\n        + '\\nJoan Guilln: Countless contributions'\n        + '\\nKartik Chandra: Paint Editor'\n        + '\\nCarles Paredes: Initial Vector Paint Editor'\n        + '\\n\"Ava\" Yuan Yuan, Dylan Servilla: Graphic Effects'\n        + '\\nKyle Hotchkiss: Block search design'\n        + '\\nBrian Broll: Many bugfixes and optimizations'\n        + '\\nIan Reynolds: UI Design, Event Bindings, '\n        + 'Sound primitives'\n        + '\\nJadga Hgle: Icons and countless other contributions'\n        + '\\nIvan Motyashov: Initial Squeak Porting'\n        + '\\nLucas Karahadian: Piano Keyboard Design'\n        + '\\nDavide Della Casa: Morphic Optimizations'\n        + '\\nAchal Dave: Web Audio'\n        + '\\nJoe Otto: Morphic Testing and Debugging';\n\n    for (module in modules) {\n        if (Object.prototype.hasOwnProperty.call(modules, module)) {\n            versions += ('\\n' + module + ' (' +\n                            modules[module] + ')');\n        }\n    }\n    if (versions !== '') {\n        versions = localize('current module versions:') + ' \\n\\n' +\n            'morphic (' + morphicVersion + ')' +\n            versions;\n    }\n    translations = localize('Translations') + '\\n' + SnapTranslator.credits();\n\n    dlg = new DialogBoxMorph();\n\n    function txt(textString) {\n        var tm = new TextMorph(\n                textString,\n                dlg.fontSize,\n                dlg.fontStyle,\n                true,\n                false,\n                'center',\n                null,\n                null,\n                MorphicPreferences.isFlat ? null : new Point(1, 1),\n                WHITE\n            ),\n            scroller,\n            maxHeight = world.height() - dlg.titleFontSize * 10;\n        if (tm.height() > maxHeight) {\n            scroller = new ScrollFrameMorph();\n            scroller.acceptsDrops = false;\n            scroller.contents.acceptsDrops = false;\n            scroller.bounds.setWidth(tm.width());\n            scroller.bounds.setHeight(maxHeight);\n            scroller.addContents(tm);\n            scroller.color = new Color(0, 0, 0, 0);\n            return scroller;\n        }\n        return tm;\n    }\n\n    dlg.inform('About Snap', aboutTxt, world, this.logo.cachedTexture);\n    btn1 = dlg.buttons.children[0];\n    translatorsBtn = dlg.addButton(\n        () => {\n            dlg.addBody(txt(translations));\n            dlg.body.fixLayout();\n            btn1.show();\n            btn2.show();\n            btn3.hide();\n            btn4.hide();\n            licenseBtn.hide();\n            translatorsBtn.hide();\n            dlg.fixLayout();\n            dlg.setCenter(world.center());\n        },\n        'Translators...'\n    );\n    btn2 = dlg.addButton(\n        () => {\n            dlg.addBody(txt(aboutTxt));\n            dlg.body.fixLayout();\n            btn1.show();\n            btn2.hide();\n            btn3.show();\n            btn4.show();\n            licenseBtn.show();\n            translatorsBtn.hide();\n            dlg.fixLayout();\n            dlg.setCenter(world.center());\n        },\n        'Back...'\n    );\n    btn2.hide();\n    licenseBtn = dlg.addButton(\n        () => {\n            dlg.addBody(txt(noticeTxt));\n            dlg.body.fixLayout();\n            btn1.show();\n            btn2.show();\n            btn3.hide();\n            btn4.hide();\n            licenseBtn.hide();\n            translatorsBtn.hide();\n            dlg.fixLayout();\n            dlg.setCenter(world.center());\n        },\n        'License...'\n    );\n    btn3 = dlg.addButton(\n        () => {\n            dlg.addBody(txt(versions));\n            dlg.body.fixLayout();\n            btn1.show();\n            btn2.show();\n            btn3.hide();\n            btn4.hide();\n            licenseBtn.hide();\n            translatorsBtn.hide();\n            dlg.fixLayout();\n            dlg.setCenter(world.center());\n        },\n        'Modules...'\n    );\n    btn4 = dlg.addButton(\n        () => {\n            dlg.addBody(txt(creditsTxt));\n            dlg.body.fixLayout();\n            btn1.show();\n            btn2.show();\n            translatorsBtn.show();\n            btn3.hide();\n            btn4.hide();\n            licenseBtn.hide();\n            dlg.fixLayout();\n            dlg.setCenter(world.center());\n        },\n        'Credits...'\n    );\n    translatorsBtn.hide();\n    dlg.fixLayout();\n};\n\n\nIDE_Morph.prototype.editProjectNotes = function () {\n    var dialog = new DialogBoxMorph().withKey('projectNotes'),\n        frame = new ScrollFrameMorph(),\n        text = new TextMorph(this.projectNotes || ''),\n        size = 250,\n        world = this.world();\n\n    frame.padding = 6;\n    frame.setWidth(size);\n    frame.acceptsDrops = false;\n    frame.contents.acceptsDrops = false;\n\n    text.setWidth(size - frame.padding * 2);\n    text.setPosition(frame.topLeft().add(frame.padding));\n    text.enableSelecting();\n    text.isEditable = true;\n\n    frame.setHeight(size);\n    frame.fixLayout = nop;\n    frame.edge = InputFieldMorph.prototype.edge;\n    frame.fontSize = InputFieldMorph.prototype.fontSize;\n    frame.typeInPadding = InputFieldMorph.prototype.typeInPadding;\n    frame.contrast = InputFieldMorph.prototype.contrast;\n    frame.render = InputFieldMorph.prototype.render;\n    frame.drawRectBorder = InputFieldMorph.prototype.drawRectBorder;\n\n    frame.addContents(text);\n\n    dialog.getInput = () => text.text;\n\n    dialog.target = this;\n\n    dialog.action = (note) => this.projectNotes = note;\n\n    dialog.justDropped = () => text.edit();\n\n    dialog.labelString = 'Project Notes';\n    dialog.createLabel();\n    dialog.addBody(frame);\n    dialog.addButton('ok', 'OK');\n    dialog.addButton('cancel', 'Cancel');\n    dialog.fixLayout();\n    dialog.popUp(world);\n    dialog.setCenter(world.center());\n    text.edit();\n};\n\nIDE_Morph.prototype.newProject = function () {\n    // Trace.log('IDE.newProject');\n    this.source = this.cloud.username ? 'cloud' : null;\n    if (this.stage) {\n        this.stage.destroy();\n    }\n    if (location.hash.substr(0, 6) !== '#lang:') {\n        location.hash = '';\n    }\n    this.globalVariables = new VariableFrame();\n    this.currentSprite = new SpriteMorph(this.globalVariables);\n    this.sprites = new List([this.currentSprite]);\n    StageMorph.prototype.dimensions = new Point(480, 360);\n    StageMorph.prototype.hiddenPrimitives = {};\n    StageMorph.prototype.codeMappings = {};\n    StageMorph.prototype.codeHeaders = {};\n    StageMorph.prototype.enableCodeMapping = false;\n    StageMorph.prototype.enableInheritance = true;\n    StageMorph.prototype.enableSublistIDs = false;\n    StageMorph.prototype.enablePenLogging = false;\n    SpriteMorph.prototype.useFlatLineEnds = false;\n    Process.prototype.enableLiveCoding = false;\n    Process.prototype.enableHyperOps = true;\n    this.setProjectName('');\n    this.projectNotes = '';\n    this.createStage();\n    this.add(this.stage);\n    this.createCorral();\n    this.selectSprite(this.stage.children[0]);\n    this.fixLayout();\n};\n\nIDE_Morph.prototype.save = function () {\n\n    // temporary hack - only allow exporting projects to disk\n    // when running Snap! locally without a web server\n    if (location.protocol === 'file:') {\n        if (this.projectName) {\n            this.exportProject(this.projectName, false);\n        } else {\n            this.prompt(\n                'Export Project As...',\n                name => this.exportProject(name, false),\n                null,\n                'exportProject'\n            );\n        }\n        return;\n    }\n\n    if (this.source === 'examples' || this.source === 'local') {\n        // cannot save to examples, deprecated localStorage\n        this.source = null;\n    }\n\n    if (this.cloud.disabled) {this.source = 'disk'; }\n\n    if (this.projectName) {\n        if (this.source === 'disk') {\n            this.exportProject(this.projectName);\n        } else if (this.source === 'cloud') {\n            this.saveProjectToCloud(this.projectName);\n        } else {\n            this.saveProjectsBrowser();\n        }\n    } else {\n        this.saveProjectsBrowser();\n    }\n};\n\nIDE_Morph.prototype.exportProject = function (name, plain) {\n    // Export project XML, saving a file to disk\n    // newWindow requests displaying the project in a new tab.\n    // Trace.log('IDE.exportProject', name);\n    var menu, str, dataPrefix;\n\n    if (name) {\n        this.setProjectName(name);\n        dataPrefix = 'data:text/' + plain ? 'plain,' : 'xml,';\n        try {\n            menu = this.showMessage('Exporting');\n            str = this.serializer.serialize(this.stage);\n            this.setURL('#open:' + dataPrefix + encodeURIComponent(str));\n            this.saveXMLAs(str, name);\n            menu.destroy();\n            this.showMessage('Exported!', 1);\n        } catch (err) {\n            if (Process.prototype.isCatchingErrors) {\n                this.showMessage('Export failed: ' + err);\n            } else {\n                throw err;\n            }\n        }\n    }\n};\n\nIDE_Morph.prototype.exportGlobalBlocks = function () {\n    // Trace.log('IDE.exportGlobalBlocks');\n    if (this.stage.globalBlocks.length > 0) {\n        new BlockExportDialogMorph(\n            this.serializer,\n            this.stage.globalBlocks\n        ).popUp(this.world());\n    } else {\n        this.inform(\n            'Export blocks',\n            'this project doesn\\'t have any\\n'\n                + 'custom global blocks yet'\n        );\n    }\n};\n\nIDE_Morph.prototype.removeUnusedBlocks = function () {\n    var targets = this.sprites.asArray().concat([this.stage]),\n        globalBlocks = this.stage.globalBlocks,\n        unused = [],\n        isDone = false,\n        found;\n\n    function scan() {\n        return globalBlocks.filter(def => {\n            if (contains(unused, def)) {return false; }\n            return targets.every((each, trgIdx) =>\n                !each.usesBlockInstance(def, true, trgIdx, unused)\n            );\n        });\n    }\n\n    while (!isDone) {\n        found = scan();\n        if (found.length) {\n            unused = unused.concat(found);\n        } else {\n            isDone = true;\n        }\n    }\n    if (unused.length > 0) {\n        new BlockRemovalDialogMorph(\n            unused,\n            this.stage\n        ).popUp(this.world());\n    } else {\n        this.inform(\n            'Remove unused blocks',\n            'there are currently no unused\\n'\n                + 'global custom blocks in this project'\n        );\n    }\n};\n\nIDE_Morph.prototype.exportSprite = function (sprite) {\n    // Trace.log('IDE.exportSprite', sprite.name);\n    var str = this.serializer.serialize(sprite.allParts());\n    str = '<sprites app=\"'\n        + this.serializer.app\n        + '\" version=\"'\n        + this.serializer.version\n        + '\">'\n        + str\n        + '</sprites>';\n    this.saveXMLAs(str, sprite.name);\n};\n\nIDE_Morph.prototype.exportScriptsPicture = function () {\n    // Trace.log('IDE.exportScriptsPicture');\n    var pics = [],\n        pic,\n        padding = 20,\n        w = 0,\n        h = 0,\n        y = 0,\n        ctx;\n\n    // collect all script pics\n    this.sprites.asArray().forEach(sprite => {\n        pics.push(sprite.getImage());\n        pics.push(sprite.scripts.scriptsPicture());\n        sprite.customBlocks.forEach(def =>\n            pics.push(def.scriptsPicture())\n        );\n    });\n    pics.push(this.stage.getImage());\n    pics.push(this.stage.scripts.scriptsPicture());\n    this.stage.customBlocks.forEach(def =>\n        pics.push(def.scriptsPicture())\n    );\n\n    // collect global block pics\n    this.stage.globalBlocks.forEach(def =>\n        pics.push(def.scriptsPicture())\n    );\n\n    pics = pics.filter(each => !isNil(each));\n\n    // determine dimensions of composite\n    pics.forEach(each => {\n        w = Math.max(w, each.width);\n        h += (each.height);\n        h += padding;\n    });\n    h -= padding;\n    pic = newCanvas(new Point(w, h));\n    ctx = pic.getContext('2d');\n\n    // draw all parts\n    pics.forEach(each => {\n        ctx.drawImage(each, 0, y);\n        y += padding;\n        y += each.height;\n    });\n    this.saveCanvasAs(pic, this.projectName || localize('Untitled'));\n};\n\nIDE_Morph.prototype.exportProjectSummary = function (useDropShadows) {\n    var html, head, meta, css, body, pname, notes, toc, globalVars,\n        stage = this.stage;\n\n    function addNode(tag, node, contents) {\n        if (!node) {node = body; }\n        return new XML_Element(tag, contents, node);\n    }\n\n    function add(contents, tag, node) {\n        if (!tag) {tag = 'p'; }\n        if (!node) {node = body; }\n        return new XML_Element(tag, contents, node);\n    }\n\n    function addImage(canvas, node, inline) {\n        if (!node) {node = body; }\n        var para = !inline ? addNode('p', node) : null,\n            pic = addNode('img', para || node);\n        pic.attributes.src = canvas.toDataURL();\n        return pic;\n    }\n\n    function addVariables(varFrame) {\n        var names = varFrame.names().sort(),\n            isFirst = true,\n            ul;\n        if (names.length) {\n            add(localize('Variables'), 'h3');\n            names.forEach(name => {\n                /*\n                addImage(\n                    SpriteMorph.prototype.variableBlock(name).scriptPic()\n                );\n                */\n                var watcher, listMorph, li, img;\n\n                if (isFirst) {\n                    ul = addNode('ul');\n                    isFirst = false;\n                }\n                li = addNode('li', ul);\n                watcher = new WatcherMorph(\n                    name,\n                    SpriteMorph.prototype.blockColor.variables,\n                    varFrame,\n                    name\n                );\n                listMorph = watcher.cellMorph.contentsMorph;\n                if (listMorph instanceof ListWatcherMorph) {\n                    listMorph.expand();\n                }\n                img = addImage(watcher.fullImage(), li);\n                img.attributes.class = 'script';\n            });\n        }\n    }\n\n    function addBlocks(definitions) {\n        if (definitions.length) {\n            add(localize('Blocks'), 'h3');\n            SpriteMorph.prototype.categories.forEach(category => {\n                var isFirst = true,\n                    ul;\n                definitions.forEach(def => {\n                    var li, blockImg;\n                    if (def.category === category) {\n                        if (isFirst) {\n                            add(\n                                localize(\n                                    category[0].toUpperCase().concat(\n                                        category.slice(1)\n                                    )\n                                ),\n                                'h4'\n                            );\n                            ul = addNode('ul');\n                            isFirst = false;\n                        }\n                        li = addNode('li', ul);\n                        blockImg = addImage(\n                            def.templateInstance().scriptPic(),\n                            li\n                        );\n                        blockImg.attributes.class = 'script';\n                        def.sortedElements().forEach(script => {\n                            var defImg = addImage(\n                                script instanceof BlockMorph ?\n                                        script.scriptPic()\n                                                : script.fullImage(),\n                                li\n                            );\n                            defImg.attributes.class = 'script';\n                        });\n                    }\n                });\n            });\n        }\n    }\n\n    pname = this.projectName || localize('untitled');\n\n    html = new XML_Element('html');\n    html.attributes.lang = SnapTranslator.language;\n    // html.attributes.contenteditable = 'true';\n\n    head = addNode('head', html);\n\n    meta = addNode('meta', head);\n    meta.attributes.charset = 'UTF-8';\n\n    if (useDropShadows) {\n        css = 'img {' +\n            'vertical-align: top;' +\n            'filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));' +\n            '-webkit-filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));' +\n            '-ms-filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));' +\n            '}' +\n            '.toc {' +\n            'vertical-align: middle;' +\n            'padding: 2px 1em 2px 1em;' +\n            '}';\n    } else {\n        css = 'img {' +\n            'vertical-align: top;' +\n            '}' +\n            '.toc {' +\n            'vertical-align: middle;' +\n            'padding: 2px 1em 2px 1em;' +\n            '}' +\n            '.sprite {' +\n            'border: 1px solid lightgray;' +\n            '}';\n    }\n    addNode('style', head, css);\n\n    add(pname, 'title', head);\n\n    body = addNode('body', html);\n    add(pname, 'h1');\n\n    /*\n    if (this.cloud.username) {\n        add(localize('by ') + this.cloud.username);\n    }\n    */\n    if (location.hash.indexOf('#present:') === 0) {\n        add(location.toString(), 'a', body).attributes.href =\n            location.toString();\n        addImage(\n            stage.thumbnail(stage.dimensions)\n        ).attributes.class = 'sprite';\n        add(this.serializer.app, 'h4');\n    } else {\n        add(this.serializer.app, 'h4');\n        addImage(\n            stage.thumbnail(stage.dimensions)\n        ).attributes.class = 'sprite';\n    }\n\n    // project notes\n    notes = Process.prototype.reportTextSplit(this.projectNotes, 'line');\n    notes.asArray().forEach(paragraph => add(paragraph));\n\n    // table of contents\n    add(localize('Contents'), 'h4');\n    toc = addNode('ul');\n\n    // sprites & stage\n    this.sprites.asArray().concat([stage]).forEach(sprite => {\n        var tocEntry = addNode('li', toc),\n            scripts = sprite.scripts.sortedElements(),\n            cl = sprite.costumes.length(),\n            pic,\n            ol;\n\n        addNode('hr');\n        addImage(\n            sprite.thumbnail(new Point(40, 40)),\n            tocEntry,\n            true\n        ).attributes.class = 'toc';\n        add(sprite.name, 'a', tocEntry).attributes.href = '#' + sprite.name;\n\n        add(sprite.name, 'h2').attributes.id = sprite.name;\n        // if (sprite instanceof SpriteMorph || sprite.costume) {\n        pic = addImage(\n            sprite.thumbnail(sprite.extent().divideBy(stage.scale))\n        );\n        pic.attributes.class = 'sprite';\n        if (sprite instanceof SpriteMorph) {\n            if (sprite.exemplar) {\n                addImage(\n                    sprite.exemplar.thumbnail(new Point(40, 40)),\n                    add(localize('Kind of') + ' ' + sprite.exemplar.name),\n                    true\n                ).attributes.class = 'toc';\n            }\n            if (sprite.anchor) {\n                addImage(\n                    sprite.anchor.thumbnail(new Point(40, 40)),\n                    add(localize('Part of') + ' ' + sprite.anchor.name),\n                    true\n                ).attributes.class = 'toc';\n            }\n            if (sprite.parts.length) {\n                add(localize('Parts'), 'h3');\n                ol = addNode('ul');\n                sprite.parts.forEach(part => {\n                    var li = addNode('li', ol, part.name);\n                    addImage(part.thumbnail(new Point(40, 40)), li, true)\n                        .attributes.class = 'toc';\n                });\n            }\n        }\n\n        // costumes\n        if (cl > 1 || (sprite.getCostumeIdx() !== cl)) {\n            add(localize('Costumes'), 'h3');\n            ol = addNode('ol');\n            sprite.costumes.asArray().forEach(costume => {\n                var li = addNode('li', ol, costume.name);\n                addImage(costume.thumbnail(new Point(40, 40)), li, true)\n                    .attributes.class = 'toc';\n            });\n        }\n\n        // sounds\n        if (sprite.sounds.length()) {\n            add(localize('Sounds'), 'h3');\n            ol = addNode('ol');\n            sprite.sounds.asArray().forEach(sound =>\n                add(sound.name, 'li', ol)\n            );\n        }\n\n        // variables\n        addVariables(sprite.variables);\n\n        // scripts\n        if (scripts.length) {\n            add(localize('Scripts'), 'h3');\n            scripts.forEach(script => {\n                var img = addImage(script instanceof BlockMorph ?\n                        script.scriptPic()\n                                : script.fullImage());\n                img.attributes.class = 'script';\n            });\n        }\n\n        // custom blocks\n        addBlocks(sprite.customBlocks);\n    });\n\n    // globals\n    globalVars = stage.globalVariables();\n    if (Object.keys(globalVars.vars).length || stage.globalBlocks.length) {\n        addNode('hr');\n        add(\n            localize('For all Sprites'),\n            'a',\n            addNode('li', toc)\n        ).attributes.href = '#global';\n        add(localize('For all Sprites'), 'h2').attributes.id = 'global';\n\n        // variables\n        addVariables(globalVars);\n\n        // custom blocks\n        addBlocks(stage.globalBlocks);\n    }\n\n    this.saveFileAs(\n        '<!DOCTYPE html>' + html.toString(),\n        'text/html;charset=utf-8',\n        pname\n    );\n};\n\nIDE_Morph.prototype.openProjectString = function (str) {\n    // Trace.log('IDE.openProjectString');\n    var msg;\n    this.nextSteps([\n        () => msg = this.showMessage('Opening project...'),\n        () => {\n            this.rawOpenProjectString(str);\n            msg.destroy();\n        }\n    ]);\n};\n\nIDE_Morph.prototype.rawOpenProjectString = function (str) {\n    this.toggleAppMode(false);\n    this.spriteBar.tabBar.tabTo('scripts');\n    StageMorph.prototype.hiddenPrimitives = {};\n    StageMorph.prototype.codeMappings = {};\n    StageMorph.prototype.codeHeaders = {};\n    StageMorph.prototype.enableCodeMapping = false;\n    StageMorph.prototype.enableInheritance = true;\n    StageMorph.prototype.enableSublistIDs = false;\n    StageMorph.prototype.enablePenLogging = false;\n    Process.prototype.enableLiveCoding = false;\n    if (Process.prototype.isCatchingErrors) {\n        try {\n            this.serializer.openProject(\n                this.serializer.load(str, this),\n                this\n            );\n        } catch (err) {\n            this.showMessage('Load failed: ' + err);\n            Trace.logError(err);\n        }\n    } else {\n        this.serializer.openProject(\n            this.serializer.load(str, this),\n            this\n        );\n    }\n    this.stopFastTracking();\n};\n\nIDE_Morph.prototype.openCloudDataString = function (str) {\n    // Trace.log('IDE.openCloudDataString');\n    var msg,\n        size = Math.round(str.length / 1024);\n    this.nextSteps([\n        () => msg = this.showMessage('Opening project\\n' + size + ' KB...'),\n        () => {\n            this.rawOpenCloudDataString(str);\n            msg.destroy();\n        }\n    ]);\n};\n\nIDE_Morph.prototype.rawOpenCloudDataString = function (str) {\n    var model;\n    StageMorph.prototype.hiddenPrimitives = {};\n    StageMorph.prototype.codeMappings = {};\n    StageMorph.prototype.codeHeaders = {};\n    StageMorph.prototype.enableCodeMapping = false;\n    StageMorph.prototype.enableInheritance = true;\n    StageMorph.prototype.enableSublistIDs = false;\n    StageMorph.prototype.enablePenLogging = false;\n    Process.prototype.enableLiveCoding = false;\n    if (Process.prototype.isCatchingErrors) {\n        try {\n            model = this.serializer.parse(str);\n            this.serializer.loadMediaModel(model.childNamed('media'));\n            this.serializer.openProject(\n                this.serializer.loadProjectModel(\n                    model.childNamed('project'),\n                    this,\n                    model.attributes.remixID\n                ),\n                this\n            );\n        } catch (err) {\n            this.showMessage('Load failed: ' + err);\n            Trace.logError(err);\n        }\n    } else {\n        model = this.serializer.parse(str);\n        this.serializer.loadMediaModel(model.childNamed('media'));\n        this.serializer.openProject(\n            this.serializer.loadProjectModel(\n                model.childNamed('project'),\n                this,\n                model.attributes.remixID\n            ),\n            this\n        );\n    }\n    this.stopFastTracking();\n};\n\nIDE_Morph.prototype.openBlocksString = function (str, name, silently) {\n    // Trace.log('IDE.openBlocksString');\n    var msg;\n    this.nextSteps([\n        () => msg = this.showMessage('Opening blocks...'),\n        () => {\n            this.rawOpenBlocksString(str, name, silently);\n            msg.destroy();\n        }\n    ]);\n};\n\nIDE_Morph.prototype.rawOpenBlocksString = function (str, name, silently) {\n    // name is optional (string), so is silently (bool)\n    var blocks;\n    if (Process.prototype.isCatchingErrors) {\n        try {\n            blocks = this.serializer.loadBlocks(str, this.stage);\n        } catch (err) {\n            this.showMessage('Load failed: ' + err);\n            Trace.logError(err);\n        }\n    } else {\n        blocks = this.serializer.loadBlocks(str, this.stage);\n    }\n    if (silently) {\n        blocks.forEach(def => {\n            def.receiver = this.stage;\n            this.stage.globalBlocks.push(def);\n            this.stage.replaceDoubleDefinitionsFor(def);\n        });\n        this.flushPaletteCache();\n        this.refreshPalette();\n        this.showMessage(\n            'Imported Blocks Module' + (name ? ': ' + name : '') + '.',\n            2\n        );\n    } else {\n        new BlockImportDialogMorph(blocks, this.stage, name).popUp();\n    }\n};\n\nIDE_Morph.prototype.openSpritesString = function (str) {\n    // Trace.log('IDE.openSpritesString');\n    var msg;\n    this.nextSteps([\n        () => msg = this.showMessage('Opening sprite...'),\n        () => {\n            this.rawOpenSpritesString(str);\n            msg.destroy();\n        },\n    ]);\n};\n\nIDE_Morph.prototype.rawOpenSpritesString = function (str) {\n    if (Process.prototype.isCatchingErrors) {\n        try {\n            this.serializer.loadSprites(str, this);\n        } catch (err) {\n            this.showMessage('Load failed: ' + err);\n            Trace.logError(err);\n        }\n    } else {\n        this.serializer.loadSprites(str, this);\n    }\n};\n\nIDE_Morph.prototype.openMediaString = function (str) {\n    // Trace.log('IDE.openMediaString');\n    if (Process.prototype.isCatchingErrors) {\n        try {\n            this.serializer.loadMedia(str);\n        } catch (err) {\n            this.showMessage('Load failed: ' + err);\n            Trace.logError(err);\n        }\n    } else {\n        this.serializer.loadMedia(str);\n    }\n    this.showMessage('Imported Media Module.', 2);\n};\n\nIDE_Morph.prototype.openScriptString = function (str) {\n    var msg;\n    this.nextSteps([\n        () => msg = this.showMessage('Opening script...'),\n        () => {\n            this.rawOpenScriptString(str);\n            msg.destroy();\n        }\n    ]);\n};\n\nIDE_Morph.prototype.rawOpenScriptString = function (str) {\n    var xml,\n        script,\n        scripts = this.currentSprite.scripts;\n\n    if (Process.prototype.isCatchingErrors) {\n        try {\n            xml = this.serializer.parse(str, this.currentSprite);\n            script = this.serializer.loadScript(xml, this.currentSprite);\n        } catch (err) {\n            this.showMessage('Load failed: ' + err);\n        }\n    } else {\n        xml = this.serializer.loadScript(str, this.currentSprite);\n        script = this.serializer.loadScript(xml, this.currentSprite);\n    }\n    script.setPosition(this.world().hand.position());\n    scripts.add(script);\n    scripts.adjustBounds();\n    scripts.lastDroppedBlock = script;\n    scripts.recordDrop(\n\t\t{\n            origin: this.palette,\n            position: this.palette.center()\n        }\n    );\n    this.showMessage(\n        'Imported Script.',\n        2\n    );\n};\n\nIDE_Morph.prototype.openDataString = function (str, name, type) {\n    var msg;\n    this.nextSteps([\n        () => msg = this.showMessage('Opening data...'),\n        () => {\n            this.rawOpenDataString(str, name, type);\n            msg.destroy();\n        }\n    ]);\n};\n\nIDE_Morph.prototype.rawOpenDataString = function (str, name, type) {\n    var data, vName, dlg,\n        globals = this.currentSprite.globalVariables();\n\n    function newVarName(name) {\n        var existing = globals.names(),\n            ix = name.indexOf('\\('),\n            stem = (ix < 0) ? name : name.substring(0, ix),\n            count = 1,\n            newName = stem;\n        while (contains(existing, newName)) {\n            count += 1;\n            newName = stem + '(' + count + ')';\n        }\n        return newName;\n    }\n\n    switch (type) {\n        case 'csv':\n            data = Process.prototype.parseCSV(str);\n            break;\n        case 'json':\n            data = Process.prototype.parseJSON(str);\n            break;\n        default: // assume plain text\n            data = str;\n    }\n    vName = newVarName(name || 'data');\n    globals.addVar(vName);\n    globals.setVar(vName, data);\n    this.currentSprite.toggleVariableWatcher(vName, true); // global\n    this.flushBlocksCache('variables');\n    this.currentCategory = 'variables';\n    this.categories.children.forEach(each =>\n        each.refresh()\n    );\n    this.refreshPalette(true);\n    if (data instanceof List) {\n        dlg = new TableDialogMorph(data);\n        dlg.labelString = localize(dlg.labelString) + ': ' + vName;\n        dlg.createLabel();\n        dlg.popUp(this.world());\n    }\n};\n\nIDE_Morph.prototype.openProject = function (name) {\n    // Trace.log('IDE.openProject', name);\n    var str;\n    if (name) {\n        this.showMessage('opening project\\n' + name);\n        this.setProjectName(name);\n        str = localStorage['-snap-project-' + name];\n        this.openProjectString(str);\n        this.setURL('#open:' + str);\n    }\n};\n\nIDE_Morph.prototype.setURL = function (str) {\n    // Set the URL to a project's XML contents\n    location.hash = this.projectsInURLs ? str : '';\n};\n\nIDE_Morph.prototype.saveFileAs = function (\n    contents,\n    fileType,\n    fileName\n) {\n    /** Allow for downloading a file to a disk.\n        This relies the FileSaver.js library which exports saveAs()\n        Two utility methods saveImageAs and saveXMLAs should be used first.\n    */\n    var blobIsSupported = false,\n        world = this.world(),\n        fileExt,\n        dialog;\n\n    // fileType is a <kind>/<ext>;<charset> format.\n    fileExt = fileType.split('/')[1].split(';')[0];\n    // handle text/plain as a .txt file\n    fileExt = '.' + (fileExt === 'plain' ? 'txt' : fileExt);\n\n    function dataURItoBlob(text, mimeType) {\n        var i,\n            data = text,\n            components = text.split(','),\n            hasTypeStr = text.indexOf('data:') === 0;\n        // Convert to binary data, in format Blob() can use.\n        if (hasTypeStr && components[0].indexOf('base64') > -1) {\n            text = atob(components[1]);\n            data = new Uint8Array(text.length);\n            i = text.length;\n            while (i--) {\n                data[i] = text.charCodeAt(i);\n            }\n        } else if (hasTypeStr) {\n            // not base64 encoded\n            text = text.replace(/^data:image\\/.*?, */, '');\n            data = new Uint8Array(text.length);\n            i = text.length;\n            while (i--) {\n                data[i] = text.charCodeAt(i);\n            }\n        }\n        return new Blob([data], {type: mimeType });\n    }\n\n    try {\n        blobIsSupported = !!new Blob();\n    } catch (e) {}\n\n    if (blobIsSupported) {\n        if (!(contents instanceof Blob)) {\n            contents = dataURItoBlob(contents, fileType);\n        }\n        // download a file and delegate to FileSaver\n        // false: Do not preprend a BOM to the file.\n        saveAs(contents, fileName + fileExt, false);\n    } else {\n        dialog = new DialogBoxMorph();\n        dialog.inform(\n            localize('Could not export') + ' ' + fileName,\n            'unable to export text',\n            world\n        );\n        dialog.fixLayout();\n    }\n};\n\nIDE_Morph.prototype.saveCanvasAs = function (canvas, fileName) {\n    // Export a Canvas object as a PNG image\n    // Note: This commented out due to poor browser support.\n    // cavas.toBlob() is currently supported in Firefox, IE, Chrome but\n    // browsers prevent easily saving the generated files.\n    // Do not re-enable without revisiting issue #1191\n    // if (canvas.toBlob) {\n    //     var myself = this;\n    //     canvas.toBlob(function (blob) {\n    //         myself.saveFileAs(blob, 'image/png', fileName);\n    //     });\n    //     return;\n    // }\n\n    this.saveFileAs(canvas.toDataURL(), 'image/png', fileName);\n};\n\nIDE_Morph.prototype.saveAudioAs = function (audio, fileName) {\n    // Export a Sound object as a WAV file\n    this.saveFileAs(audio.src, 'audio/wav', fileName);\n};\n\nIDE_Morph.prototype.saveXMLAs = function(xml, fileName) {\n    // wrapper to saving XML files with a proper type tag.\n    this.saveFileAs(xml, 'text/xml;chartset=utf-8', fileName);\n};\n\nIDE_Morph.prototype.switchToUserMode = function () {\n    var world = this.world();\n\n    world.isDevMode = false;\n    Process.prototype.isCatchingErrors = true;\n    this.controlBar.updateLabel();\n    this.isAutoFill = true;\n    this.isDraggable = false;\n    this.reactToWorldResize(world.bounds.copy());\n    this.siblings().forEach(morph => {\n        if (morph instanceof DialogBoxMorph) {\n            world.add(morph); // bring to front\n        } else {\n            morph.destroy();\n        }\n    });\n    this.flushBlocksCache();\n    this.refreshPalette();\n    // prevent non-DialogBoxMorphs from being dropped\n    // onto the World in user-mode\n    world.reactToDropOf = (morph) => {\n        if (!(morph instanceof DialogBoxMorph ||\n        \t\t(morph instanceof MenuMorph))) {\n            if (world.hand.grabOrigin) {\n                morph.slideBackTo(world.hand.grabOrigin);\n            } else {\n                world.hand.grab(morph);\n            }\n        }\n    };\n    this.showMessage('entering user mode', 1);\n};\n\nIDE_Morph.prototype.getSpriteByName = function (name) {\n  const sprites = this.sprites.contents.filter(function (sprite) {\n    return sprite.name === name;\n  });\n  if (sprites && sprites.length !== 0) {\n    return sprites[0];\n  }\n  return null;\n}\n\nIDE_Morph.prototype.switchToDevMode = function () {\n    var world = this.world();\n\n    world.isDevMode = true;\n    Process.prototype.isCatchingErrors = false;\n    this.controlBar.updateLabel();\n    this.isAutoFill = false;\n    this.isDraggable = true;\n    this.setExtent(world.extent().subtract(100));\n    this.setPosition(world.position().add(20));\n    this.flushBlocksCache();\n    this.refreshPalette();\n    // enable non-DialogBoxMorphs to be dropped\n    // onto the World in dev-mode\n    delete world.reactToDropOf;\n    this.showMessage(\n        'entering development mode.\\n\\n'\n            + 'error catching is turned off,\\n'\n            + 'use the browser\\'s web console\\n'\n            + 'to see error messages.'\n    );\n};\n\nIDE_Morph.prototype.flushBlocksCache = function (category) {\n    // if no category is specified, the whole cache gets flushed\n    if (category) {\n        this.stage.blocksCache[category] = null;\n        this.stage.children.forEach(m => {\n            if (m instanceof SpriteMorph) {\n                m.blocksCache[category] = null;\n            }\n        });\n    } else {\n        this.stage.blocksCache = {};\n        this.stage.children.forEach(m => {\n            if (m instanceof SpriteMorph) {\n                m.blocksCache = {};\n            }\n        });\n    }\n    this.flushPaletteCache(category);\n};\n\nIDE_Morph.prototype.flushPaletteCache = function (category) {\n    // if no category is specified, the whole cache gets flushed\n    if (category) {\n        this.stage.paletteCache[category] = null;\n        this.stage.children.forEach(m => {\n            if (m instanceof SpriteMorph) {\n                m.paletteCache[category] = null;\n            }\n        });\n    } else {\n        this.stage.paletteCache = {};\n        this.stage.children.forEach(m => {\n            if (m instanceof SpriteMorph) {\n                m.paletteCache = {};\n            }\n        });\n    }\n};\n\nIDE_Morph.prototype.toggleZebraColoring = function () {\n    var scripts = [];\n\n    if (!BlockMorph.prototype.zebraContrast) {\n        BlockMorph.prototype.zebraContrast = 40;\n    } else {\n        BlockMorph.prototype.zebraContrast = 0;\n    }\n\n    // select all scripts:\n    this.stage.children.concat(this.stage).forEach(morph => {\n        if (isSnapObject(morph)) {\n            scripts = scripts.concat(\n                morph.scripts.children.filter(morph =>\n                    morph instanceof BlockMorph\n                )\n            );\n        }\n    });\n\n    // force-update all scripts:\n    scripts.forEach(topBlock =>\n        topBlock.fixBlockColor(null, true)\n    );\n};\n\nIDE_Morph.prototype.toggleDynamicInputLabels = function () {\n    var projectData;\n    SyntaxElementMorph.prototype.dynamicInputLabels =\n        !SyntaxElementMorph.prototype.dynamicInputLabels;\n    if (Process.prototype.isCatchingErrors) {\n        try {\n            projectData = this.serializer.serialize(this.stage);\n        } catch (err) {\n            this.showMessage('Serialization failed: ' + err);\n        }\n    } else {\n        projectData = this.serializer.serialize(this.stage);\n    }\n    SpriteMorph.prototype.initBlocks();\n    this.spriteBar.tabBar.tabTo('scripts');\n    this.createCategories();\n    this.createCorralBar();\n    this.openProjectString(projectData);\n};\n\nIDE_Morph.prototype.toggleBlurredShadows = function () {\n    window.useBlurredShadows = !useBlurredShadows;\n    this.rerender();\n    if (window.useBlurredShadows) {\n        this.removeSetting('solidshadow');\n    } else {\n        this.saveSetting('solidshadow', false);\n    }\n};\n\nIDE_Morph.prototype.toggleLongFormInputDialog = function () {\n    InputSlotDialogMorph.prototype.isLaunchingExpanded =\n        !InputSlotDialogMorph.prototype.isLaunchingExpanded;\n    if (InputSlotDialogMorph.prototype.isLaunchingExpanded) {\n        this.saveSetting('longform', true);\n    } else {\n        this.removeSetting('longform');\n    }\n};\n\nIDE_Morph.prototype.togglePlainPrototypeLabels = function () {\n    BlockLabelPlaceHolderMorph.prototype.plainLabel =\n        !BlockLabelPlaceHolderMorph.prototype.plainLabel;\n    if (BlockLabelPlaceHolderMorph.prototype.plainLabel) {\n        this.saveSetting('plainprototype', true);\n    } else {\n        this.removeSetting('plainprototype');\n    }\n};\n\nIDE_Morph.prototype.togglePreferEmptySlotDrops = function () {\n    ScriptsMorph.prototype.isPreferringEmptySlots =\n        !ScriptsMorph.prototype.isPreferringEmptySlots;\n};\n\nIDE_Morph.prototype.toggleVirtualKeyboard = function () {\n    MorphicPreferences.useVirtualKeyboard =\n        !MorphicPreferences.useVirtualKeyboard;\n};\n\nIDE_Morph.prototype.toggleInputSliders = function () {\n    MorphicPreferences.useSliderForInput =\n        !MorphicPreferences.useSliderForInput;\n};\n\nIDE_Morph.prototype.toggleSliderExecute = function () {\n    ArgMorph.prototype.executeOnSliderEdit =\n        !ArgMorph.prototype.executeOnSliderEdit;\n};\n\nIDE_Morph.prototype.setEmbedMode = function () {\n    var myself = this;\n\n    this.isEmbedMode = true;\n    this.appModeColor = new Color(243,238,235);\n    this.embedOverlay = new Morph();\n    this.embedOverlay.color = new Color(128, 128, 128);\n    this.embedOverlay.alpha = 0.5;\n\n    this.embedPlayButton = new SymbolMorph('circleSolid');\n    this.embedPlayButton.color = new Color(64, 128, 64);\n    this.embedPlayButton.alpha = 0.75;\n    this.embedPlayButton.flag = new SymbolMorph('flag');\n    this.embedPlayButton.flag.color = new Color(128, 255, 128);\n    this.embedPlayButton.flag.alpha = 0.75;\n    this.embedPlayButton.add(this.embedPlayButton.flag);\n    this.embedPlayButton.mouseClickLeft = function () {\n        myself.runScripts();\n        myself.embedOverlay.destroy();\n        this.destroy();\n    };\n\n    this.controlBar.hide();\n\n    this.add(this.embedOverlay);\n    this.add(this.embedPlayButton);\n\n    this.fixLayout();\n};\n\nIDE_Morph.prototype.toggleAppMode = function (appMode) {\n    var world = this.world(),\n        elements = [\n            this.logo,\n            this.controlBar.cloudButton,\n            this.controlBar.projectButton,\n            this.controlBar.settingsButton,\n            this.controlBar.steppingButton,\n            this.controlBar.stageSizeButton,\n            this.paletteHandle,\n            this.stageHandle,\n            this.corral,\n            this.corralBar,\n            this.spriteEditor,\n            this.spriteBar,\n            this.palette,\n            this.categories\n        ];\n\n    this.isAppMode = isNil(appMode) ? !this.isAppMode : appMode;\n    // Trace.log('IDE.toggleAppMode', this.isAppMode);\n\n    if (this.isAppMode) {\n\t\tthis.wasSingleStepping = Process.prototype.enableSingleStepping;\n\t\tif (this.wasSingleStepping) {\n     \t\tthis.toggleSingleStepping();\n    \t}\n        this.setColor(this.appModeColor);\n        this.controlBar.setColor(this.color);\n        this.controlBar.appModeButton.refresh();\n        elements.forEach(e =>\n            e.hide()\n        );\n        world.children.forEach(morph => {\n            if (morph instanceof DialogBoxMorph) {\n                morph.hide();\n            }\n        });\n        if (world.keyboardFocus instanceof ScriptFocusMorph) {\n            world.keyboardFocus.stopEditing();\n        }\n    } else {\n        if (this.wasSingleStepping && !Process.prototype.enableSingleStepping) {\n             this.toggleSingleStepping();\n        }\n        this.setColor(this.backgroundColor);\n        this.controlBar.setColor(this.frameColor);\n        elements.forEach(e =>\n            e.show()\n        );\n        this.stage.setScale(1);\n        // show all hidden dialogs\n        world.children.forEach(morph => {\n            if (morph instanceof DialogBoxMorph) {\n                morph.show();\n            }\n        });\n        // prevent scrollbars from showing when morph appears\n        world.allChildren().filter(c =>\n            c instanceof ScrollFrameMorph\n        ).forEach(s =>\n            s.adjustScrollBars()\n        );\n        // prevent rotation and draggability controls from\n        // showing for the stage\n        if (this.currentSprite === this.stage) {\n            this.spriteBar.children.forEach(child => {\n                if (child instanceof PushButtonMorph) {\n                    child.hide();\n                }\n            });\n        }\n        // update undrop controls\n        this.currentSprite.scripts.updateToolbar();\n    }\n    this.setExtent(this.world().extent());\n};\n\nIDE_Morph.prototype.toggleStageSize = function (isSmall, forcedRatio) {\n    var myself = this,\n        smallRatio = forcedRatio || 0.5,\n        msecs = this.isAnimating ? 100 : 0,\n        world = this.world(),\n        shiftClicked = (world.currentKey === 16),\n        altClicked = (world.currentKey === 18);\n\n    function toggle() {\n        myself.isSmallStage = isNil(isSmall) ? !myself.isSmallStage : isSmall;\n        // Trace.log('IDE.toggleStageSize', myself.isSmallStage);\n    }\n\n    function zoomTo(targetRatio) {\n        myself.isSmallStage = true;\n        world.animations.push(new Animation(\n            ratio => {\n                myself.stageRatio = ratio;\n                myself.setExtent(world.extent());\n            },\n            () => myself.stageRatio,\n            targetRatio - myself.stageRatio,\n            msecs,\n            null, // easing\n            () => {\n                myself.isSmallStage = (targetRatio !== 1);\n                myself.controlBar.stageSizeButton.refresh();\n            }\n        ));\n    }\n\n    if (shiftClicked) {\n        smallRatio = SpriteIconMorph.prototype.thumbSize.x * 3 /\n            this.stage.dimensions.x;\n        if (!this.isSmallStage || (smallRatio === this.stageRatio)) {\n            toggle();\n        }\n    } else if (altClicked) {\n        smallRatio = this.width() / 2 /\n            this.stage.dimensions.x;\n        if (!this.isSmallStage || (smallRatio === this.stageRatio)) {\n            toggle();\n        }\n    } else {\n        toggle();\n    }\n    if (this.isSmallStage) {\n        zoomTo(smallRatio);\n    } else {\n        zoomTo(1);\n    }\n};\n\nIDE_Morph.prototype.setPaletteWidth = function (newWidth) {\n    var msecs = this.isAnimating ? 100 : 0,\n        world = this.world();\n\n    world.animations.push(new Animation(\n        newWidth => {\n            this.paletteWidth = newWidth;\n            this.setExtent(world.extent());\n        },\n        () => this.paletteWidth,\n        newWidth - this.paletteWidth,\n        msecs\n    ));\n};\n\nIDE_Morph.prototype.createNewProject = function () {\n    this.confirm(\n        'Replace the current project with a new one?',\n        'New Project',\n        () => this.newProject()\n    );\n};\n\nIDE_Morph.prototype.openProjectsBrowser = function () {\n    if (location.protocol === 'file:') {\n        // bypass the project import dialog and directly pop up\n        // the local file picker.\n        // this should not be necessary, we should be able\n        // to access the cloud even when running Snap! locally\n        // to be worked on.... (jens)\n        this.importLocalFile();\n        return;\n    }\n    new ProjectDialogMorph(this, 'open').popUp();\n};\n\nIDE_Morph.prototype.saveProjectsBrowser = function () {\n    // temporary hack - only allow exporting projects to disk\n    // when running Snap! locally without a web server\n    if (location.protocol === 'file:') {\n        this.prompt(\n            'Export Project As...',\n            name => this.exportProject(name, false),\n            null,\n            'exportProject'\n        );\n        return;\n    }\n\n    if (this.source === 'examples') {\n        this.source = null; // cannot save to examples\n    }\n    new ProjectDialogMorph(this, 'save').popUp();\n};\n\n// IDE_Morph microphone settings\n\nIDE_Morph.prototype.microphoneMenu = function () {\n    var menu = new MenuMorph(this),\n        world = this.world(),\n        pos = this.controlBar.settingsButton.bottomLeft(),\n        resolutions = ['low', 'normal', 'high', 'max'],\n        microphone = this.stage.microphone,\n        tick = new SymbolMorph(\n            'tick',\n            MorphicPreferences.menuFontSize * 0.75\n        ),\n        on = new SymbolMorph(\n            'checkedBox',\n            MorphicPreferences.menuFontSize * 0.75\n        ),\n        empty = tick.fullCopy();\n\n    empty.render = nop;\n    if (microphone.isReady) {\n        menu.addItem(\n            [\n                on,\n                localize('Microphone')\n            ],\n            () => microphone.stop()\n        );\n        menu.addLine();\n    }\n    resolutions.forEach((res, i) => {\n        menu.addItem(\n            [\n                microphone.resolution === i + 1 ? tick : empty,\n                localize(res)\n            ],\n            () => microphone.setResolution(i + 1)\n        );\n    });\n    menu.popup(world, pos);\n};\n\n// IDE_Morph localization\n\nIDE_Morph.prototype.languageMenu = function () {\n    var menu = new MenuMorph(this),\n        world = this.world(),\n        pos = this.controlBar.settingsButton.bottomLeft(),\n        tick = new SymbolMorph(\n            'tick',\n            MorphicPreferences.menuFontSize * 0.75\n        ),\n        empty = tick.fullCopy();\n\n    empty.render = nop;\n    SnapTranslator.languages().forEach(lang =>\n        menu.addItem(\n            [\n                SnapTranslator.language === lang ? tick : empty,\n                SnapTranslator.languageName(lang)\n            ],\n            () => {\n                this.loadNewProject = false;\n                this.setLanguage(lang);\n            }\n        )\n    );\n    menu.popup(world, pos);\n};\n\nIDE_Morph.prototype.setLanguage = function (lang, callback, noSave) {\n    // Trace.log('IDE.setLanguage', lang);\n    var translation = document.getElementById('language'),\n        src = this.resourceURL('locale', 'lang-' + lang + '.js');\n    SnapTranslator.unload();\n    if (translation) {\n        document.head.removeChild(translation);\n    }\n    if (lang === 'en') {\n        return this.reflectLanguage('en', callback, noSave);\n    }\n    translation = document.createElement('script');\n    translation.id = 'language';\n    translation.onload = () => this.reflectLanguage(lang, callback, noSave);\n    document.head.appendChild(translation);\n    translation.src = src;\n};\n\nIDE_Morph.prototype.reflectLanguage = function (lang, callback, noSave) {\n    var projectData,\n        urlBar = location.hash;\n    SnapTranslator.language = lang;\n    if (!this.loadNewProject) {\n        if (Process.prototype.isCatchingErrors) {\n            try {\n                projectData = this.serializer.serialize(this.stage);\n            } catch (err) {\n                this.showMessage('Serialization failed: ' + err);\n            }\n        } else {\n            projectData = this.serializer.serialize(this.stage);\n        }\n    }\n    SpriteMorph.prototype.initBlocks();\n    this.spriteBar.tabBar.tabTo('scripts');\n    this.createCategories();\n    this.createCorralBar();\n    this.fixLayout();\n    if (this.loadNewProject) {\n        this.newProject();\n        location.hash = urlBar;\n    } else {\n        this.openProjectString(projectData);\n    }\n    if (!noSave) {\n        this.saveSetting('language', lang);\n    }\n    if (callback) {callback.call(this); }\n};\n\n// IDE_Morph blocks scaling\n\nIDE_Morph.prototype.userSetBlocksScale = function () {\n    var scrpt,\n        blck,\n        shield,\n        sample,\n        action,\n        dlg;\n\n    scrpt = new CommandBlockMorph();\n    scrpt.color = SpriteMorph.prototype.blockColor.motion;\n    scrpt.setSpec(localize('build'));\n    blck = new CommandBlockMorph();\n    blck.color = SpriteMorph.prototype.blockColor.sound;\n    blck.setSpec(localize('your own'));\n    scrpt.nextBlock(blck);\n    blck = new CommandBlockMorph();\n    blck.color = SpriteMorph.prototype.blockColor.operators;\n    blck.setSpec(localize('blocks'));\n    scrpt.bottomBlock().nextBlock(blck);\n    /*\n    blck = SpriteMorph.prototype.blockForSelector('doForever');\n    blck.inputs()[0].nestedBlock(scrpt);\n    */\n\n    sample = new FrameMorph();\n    sample.acceptsDrops = false;\n    sample.color = IDE_Morph.prototype.groupColor;\n    if (SyntaxElementMorph.prototype.alpha > 0.8) {\n        sample.cachedTexture = this.scriptsPaneTexture;\n    }\n    sample.setExtent(new Point(250, 180));\n    scrpt.setPosition(sample.position().add(10));\n    sample.add(scrpt);\n\n    shield = new Morph();\n    shield.alpha = 0;\n    shield.setExtent(sample.extent());\n    shield.setPosition(sample.position());\n    sample.add(shield);\n\n    action = (num) => {\n        scrpt.blockSequence().forEach(block => {\n            block.setScale(num);\n            block.setSpec(block.blockSpec);\n        });\n        scrpt.fullChanged();\n    };\n\n    dlg = new DialogBoxMorph(\n        null,\n        num => this.setBlocksScale(Math.min(num, 12))\n    ).withKey('zoomBlocks');\n    if (MorphicPreferences.isTouchDevice) {\n        dlg.isDraggable = false;\n    }\n    dlg.prompt(\n        'Zoom blocks',\n        SyntaxElementMorph.prototype.scale.toString(),\n        this.world(),\n        sample, // pic\n        {\n            'normal (1x)' : 1,\n            'demo (1.2x)' : 1.2,\n            'presentation (1.4x)' : 1.4,\n            'big (2x)' : 2,\n            'huge (4x)' : 4,\n            'giant (8x)' : 8,\n            'monstrous (10x)' : 10\n        },\n        false, // read only?\n        true, // numeric\n        1, // slider min\n        5, // slider max\n        action // slider action\n    );\n};\n\nIDE_Morph.prototype.setBlocksScale = function (num) {\n    var projectData;\n    if (Process.prototype.isCatchingErrors) {\n        try {\n            projectData = this.serializer.serialize(this.stage);\n        } catch (err) {\n            this.showMessage('Serialization failed: ' + err);\n        }\n    } else {\n        projectData = this.serializer.serialize(this.stage);\n    }\n    SyntaxElementMorph.prototype.setScale(num);\n    CommentMorph.prototype.refreshScale();\n    SpriteMorph.prototype.initBlocks();\n    this.spriteBar.tabBar.tabTo('scripts');\n    this.createCategories();\n    this.createCorralBar();\n    this.fixLayout();\n    this.openProjectString(projectData);\n    this.saveSetting('zoom', num);\n};\n\n// IDE_Morph blocks fading\n\nIDE_Morph.prototype.userFadeBlocks = function () {\n    var dlg,\n        initial = 100 - (SyntaxElementMorph.prototype.alpha * 100);\n\n    dlg = new DialogBoxMorph(\n        null,\n        num => this.setBlockTransparency(num, true) // and save setting\n    ).withKey('fadeBlocks');\n    if (MorphicPreferences.isTouchDevice) {\n        dlg.isDraggable = false;\n    }\n\n    dlg.cancel = () => {\n        this.setBlockTransparency(initial);\n        dlg.destroy();\n    };\n\n    dlg.prompt(\n        'Fade blocks',\n        initial.toString(),\n        this.world(),\n        null, // pic\n        {\n            'block-solid (0)' : 0,\n            'medium (50)' : 50,\n            'light (70)' : 70,\n            'shimmering (80)' : 80,\n            'elegant (90)' : 90,\n            'subtle (95)' : 95,\n            'text-only (100)' : 100\n        },\n        false, // read only?\n        true, // numeric\n        0, // slider min\n        100, // slider max\n        num => this.setBlockTransparency(num), // slider action\n        0 // decimals\n    );\n};\n\nIDE_Morph.prototype.setBlockTransparency = function (num, save) {\n    SyntaxElementMorph.prototype.setAlphaScaled(100 - num);\n    this.changed();\n    if (save) {\n        if (num === 0) {\n            this.removeSetting('fade');\n        } else {\n            this.saveSetting('fade', num);\n        }\n    }\n};\n\n// IDE_Morph stage size manipulation\n\nIDE_Morph.prototype.userSetStageSize = function () {\n    new DialogBoxMorph(\n        this,\n        this.setStageExtent,\n        this\n    ).promptVector(\n        \"Stage size\",\n        StageMorph.prototype.dimensions,\n        new Point(480, 360),\n        'Stage width',\n        'Stage height',\n        this.world(),\n        null, // pic\n        null // msg\n    );\n};\n\nIDE_Morph.prototype.setStageExtent = function (aPoint) {\n    var myself = this,\n        world = this.world(),\n        ext = aPoint.max(new Point(240, 180));\n\n    function zoom() {\n        myself.step = function () {\n            var delta = ext.subtract(\n                StageMorph.prototype.dimensions\n            ).divideBy(2);\n            if (delta.abs().lt(new Point(5, 5))) {\n                StageMorph.prototype.dimensions = ext;\n                delete myself.step;\n            } else {\n                StageMorph.prototype.dimensions =\n                    StageMorph.prototype.dimensions.add(delta);\n            }\n            myself.stage.setExtent(StageMorph.prototype.dimensions);\n            myself.stage.clearPenTrails();\n            myself.fixLayout();\n            this.setExtent(world.extent());\n        };\n    }\n\n    this.stageRatio = 1;\n    this.isSmallStage = false;\n    this.controlBar.stageSizeButton.refresh();\n    this.stage.stopVideo();\n    this.setExtent(world.extent());\n    if (this.isAnimating) {\n        zoom();\n    } else {\n        StageMorph.prototype.dimensions = ext;\n        this.stage.setExtent(StageMorph.prototype.dimensions);\n        this.stage.clearPenTrails();\n        this.fixLayout();\n        this.setExtent(world.extent());\n    }\n};\n\n// IDE_Morph dragging threshold (internal feature)\n\nIDE_Morph.prototype.userSetDragThreshold = function () {\n    new DialogBoxMorph(\n        this,\n        num => MorphicPreferences.grabThreshold = Math.min(\n            Math.max(+num, 0),\n            200\n        ),\n        this\n    ).prompt(\n        \"Dragging threshold\",\n        MorphicPreferences.grabThreshold.toString(),\n        this.world(),\n        null, // pic\n        null, // choices\n        null, // read only\n        true // numeric\n    );\n};\n\n// IDE_Morph cloud interface\n\nIDE_Morph.prototype.initializeCloud = function () {\n    var world = this.world();\n    new DialogBoxMorph(\n        null,\n        user => this.cloud.login(\n            user.username.toLowerCase(),\n            user.password,\n            user.choice,\n            (username, role, response) => {\n                sessionStorage.username = username;\n                this.controlBar.cloudButton.refresh();\n                this.source = 'cloud';\n                if (!isNil(response.days_left)) {\n                    var duration = response.days_left + ' day' +\n                        (response.days_left > 1 ? 's' : '');\n                    new DialogBoxMorph().inform(\n                        'Unverified account: ' + duration + ' left' +\n                        'You are now logged in, and your account\\n' +\n                        'is enabled for ' + duration + '.\\n' +\n                        'Please use the verification link that\\n' +\n                        'was sent to your email address when you\\n' +\n                        'signed up.\\n\\n' +\n                        'If you cannot find that email, please\\n' +\n                        'check your spam folder. If you still\\n' +\n                        'cannot find it, please use the \"Resend\\n' +\n                        'Verification Email...\" option in the cloud\\n' +\n                        'menu.\\n\\n' +\n                        'You have ' + duration + ' left.',\n                        world,\n                        this.cloudIcon(null, new Color(0, 180, 0))\n                    );\n                } else {\n                    this.showMessage(response.message, 2);\n                }\n            },\n            this.cloudError()\n        )\n    ).withKey('cloudlogin').promptCredentials(\n        'Sign in',\n        'login',\n        null,\n        null,\n        null,\n        null,\n        'stay signed in on this computer\\nuntil logging out',\n        world,\n        this.cloudIcon(),\n        this.cloudMsg\n    );\n};\n\nIDE_Morph.prototype.createCloudAccount = function () {\n    var world = this.world();\n\n    new DialogBoxMorph(\n        null,\n        user => this.cloud.signup(\n            user.username,\n            user.password,\n            user.passwordRepeat,\n            user.email,\n            (txt, title) => new DialogBoxMorph().inform(\n                title,\n                txt + '.\\n\\nYou can now log in.',\n                world,\n                this.cloudIcon(null, new Color(0, 180, 0))\n            ),\n            this.cloudError()\n        )\n    ).withKey('cloudsignup').promptCredentials(\n        'Sign up',\n        'signup',\n        'https://snap.berkeley.edu/tos.html',\n        'Terms of Service...',\n        'https://snap.berkeley.edu/privacy.html',\n        'Privacy...',\n        'I have read and agree\\nto the Terms of Service',\n        world,\n        this.cloudIcon(),\n        this.cloudMsg\n    );\n};\n\nIDE_Morph.prototype.resetCloudPassword = function () {\n    var world = this.world();\n\n    new DialogBoxMorph(\n        null,\n        user => this.cloud.resetPassword(\n            user.username,\n            (txt, title) => new DialogBoxMorph().inform(\n                title,\n                txt +\n                    '\\n\\nAn e-mail with a link to\\n' +\n                    'reset your password\\n' +\n                    'has been sent to the address provided',\n                world,\n                this.cloudIcon(null, new Color(0, 180, 0))\n            ),\n            this.cloudError()\n        )\n    ).withKey('cloudresetpassword').promptCredentials(\n        'Reset password',\n        'resetPassword',\n        null,\n        null,\n        null,\n        null,\n        null,\n        world,\n        this.cloudIcon(),\n        this.cloudMsg\n    );\n};\n\nIDE_Morph.prototype.resendVerification = function () {\n    var world = this.world();\n\n    new DialogBoxMorph(\n        null,\n        user => this.cloud.resendVerification(\n            user.username,\n            (txt, title) => new DialogBoxMorph().inform(\n                title,\n                txt,\n                world,\n                this.cloudIcon(null, new Color(0, 180, 0))\n            ),\n            this.cloudError()\n        )\n    ).withKey('cloudresendverification').promptCredentials(\n        'Resend verification email',\n        'resendVerification',\n        null,\n        null,\n        null,\n        null,\n        null,\n        world,\n        this.cloudIcon(),\n        this.cloudMsg\n    );\n};\n\nIDE_Morph.prototype.changeCloudPassword = function () {\n    var world = this.world();\n\n    new DialogBoxMorph(\n        null,\n        user => this.cloud.changePassword(\n            user.oldpassword,\n            user.password,\n            user.passwordRepeat,\n            () => this.showMessage('password has been changed.', 2),\n            this.cloudError()\n        )\n    ).withKey('cloudpassword').promptCredentials(\n        'Change Password',\n        'changePassword',\n        null,\n        null,\n        null,\n        null,\n        null,\n        world,\n        this.cloudIcon(),\n        this.cloudMsg\n    );\n};\n\nIDE_Morph.prototype.logout = function () {\n    this.cloud.logout(\n        () => {\n            delete(sessionStorage.username);\n            this.controlBar.cloudButton.refresh();\n            this.showMessage('disconnected.', 2);\n        },\n        () => {\n            delete(sessionStorage.username);\n            this.controlBar.cloudButton.refresh();\n            this.showMessage('disconnected.', 2);\n        }\n    );\n};\n\nIDE_Morph.prototype.buildProjectRequest = function () {\n    var xml = this.serializer.serialize(this.stage),\n        thumbnail = normalizeCanvas(\n            this.stage.thumbnail(\n                SnapSerializer.prototype.thumbnailSize\n        )).toDataURL(),\n        body;\n\n    this.serializer.isCollectingMedia = true;\n    body = {\n        notes: this.projectNotes,\n        xml: xml,\n        media: this.hasChangedMedia ?\n            this.serializer.mediaXML(this.projectName) : null,\n        thumbnail: thumbnail,\n        remixID: this.stage.remixID\n    };\n    this.serializer.isCollectingMedia = false;\n    this.serializer.flushMedia();\n\n    return body;\n};\n\nIDE_Morph.prototype.verifyProject = function (body) {\n    // Ensure the project is less than 10MB and serializes correctly.\n    var encodedBody = JSON.stringify(body);\n    if (encodedBody.length > Cloud.MAX_FILE_SIZE) {\n        new DialogBoxMorph().inform(\n            'Snap!Cloud - Cannot Save Project',\n            'The media inside this project exceeds 10 MB.\\n' +\n                'Please reduce the size of costumes or sounds.\\n',\n            this.world(),\n            this.cloudIcon(null, new Color(180, 0, 0))\n        );\n        return false;\n    }\n\n    // console.log(encodedBody.length);\n    // check if serialized data can be parsed back again\n    try {\n        this.serializer.parse(body.xml);\n    } catch (err) {\n        this.showMessage('Serialization of program data failed:\\n' + err);\n        return false;\n    }\n    if (body.media !== null) {\n        try {\n            this.serializer.parse(body.media);\n        } catch (err) {\n            this.showMessage('Serialization of media failed:\\n' + err);\n            return false;\n        }\n    }\n    this.serializer.isCollectingMedia = false;\n    this.serializer.flushMedia();\n\n    return encodedBody.length;\n};\n\nIDE_Morph.prototype.saveProjectToCloud = function (name) {\n    // Trace.log('IDE.saveProjectToCloud', name);\n    var projectBody, projectSize;\n\n    if (name) {\n        this.setProjectName(name);\n    }\n\n    this.showMessage('Saving project\\nto the cloud...');\n    projectBody = this.buildProjectRequest();\n    projectSize = this.verifyProject(projectBody);\n    if (!projectSize) {return; } // Invalid Projects don't return anything.\n    this.showMessage(\n        'Uploading ' + Math.round(projectSize / 1024) + ' KB...'\n    );\n    this.cloud.saveProject(\n        this.projectName,\n        projectBody,\n        () => this.showMessage('saved.', 2),\n        this.cloudError()\n    );\n};\n\nIDE_Morph.prototype.exportProjectMedia = function (name) {\n    // Trace.log('IDE.exportProjectMedia', name);\n    var menu, media;\n    this.serializer.isCollectingMedia = true;\n    if (name) {\n        this.setProjectName(name);\n        try {\n            menu = this.showMessage('Exporting');\n            media = this.serializer.mediaXML(name);\n            this.saveXMLAs(media, this.projectName + ' media');\n            menu.destroy();\n            this.showMessage('Exported!', 1);\n        } catch (err) {\n            if (Process.prototype.isCatchingErrors) {\n                this.serializer.isCollectingMedia = false;\n                this.showMessage('Export failed: ' + err);\n            } else {\n                throw err;\n            }\n        }\n    }\n    this.serializer.isCollectingMedia = false;\n    this.serializer.flushMedia();\n    // this.hasChangedMedia = false;\n};\n\nIDE_Morph.prototype.exportProjectNoMedia = function (name) {\n    // Trace.log('IDE.exportProjectNoMedia', name);\n    var menu, str;\n    this.serializer.isCollectingMedia = true;\n    if (name) {\n        this.setProjectName(name);\n        if (Process.prototype.isCatchingErrors) {\n            try {\n                menu = this.showMessage('Exporting');\n                str = this.serializer.serialize(this.stage);\n                this.saveXMLAs(str, this.projectName);\n                menu.destroy();\n                this.showMessage('Exported!', 1);\n            } catch (err) {\n                this.serializer.isCollectingMedia = false;\n                this.showMessage('Export failed: ' + err);\n            }\n        } else {\n            menu = this.showMessage('Exporting');\n            str = this.serializer.serialize(this.stage);\n            this.saveXMLAs(str, this.projectName);\n            menu.destroy();\n            this.showMessage('Exported!', 1);\n        }\n    }\n    this.serializer.isCollectingMedia = false;\n    this.serializer.flushMedia();\n};\n\nIDE_Morph.prototype.exportProjectAsCloudData = function (name) {\n    // Trace.log('IDE.exportProejctAsCloudData', name);\n    var menu, str, media, dta;\n    this.serializer.isCollectingMedia = true;\n    if (name) {\n        this.setProjectName(name);\n        if (Process.prototype.isCatchingErrors) {\n            try {\n                menu = this.showMessage('Exporting');\n                str = this.serializer.serialize(this.stage);\n                media = this.serializer.mediaXML(name);\n                dta = '<snapdata>' + str + media + '</snapdata>';\n                this.saveXMLAs(str, this.projectName);\n                menu.destroy();\n                this.showMessage('Exported!', 1);\n            } catch (err) {\n                this.serializer.isCollectingMedia = false;\n                this.showMessage('Export failed: ' + err);\n            }\n        } else {\n            menu = this.showMessage('Exporting');\n            str = this.serializer.serialize(this.stage);\n            media = this.serializer.mediaXML(name);\n            dta = '<snapdata>' + str + media + '</snapdata>';\n            this.saveXMLAs(str, this.projectName);\n            menu.destroy();\n            this.showMessage('Exported!', 1);\n        }\n    }\n    this.serializer.isCollectingMedia = false;\n    this.serializer.flushMedia();\n    // this.hasChangedMedia = false;\n};\n\nIDE_Morph.prototype.cloudAcknowledge = function () {\n    return (responseText, url) => {\n        nop(responseText);\n        new DialogBoxMorph().inform(\n            'Cloud Connection',\n            'Successfully connected to:\\n'\n                + 'http://'\n                + url,\n            this.world(),\n            this.cloudIcon(null, new Color(0, 180, 0))\n        );\n    };\n};\n\nIDE_Morph.prototype.cloudResponse = function () {\n    return (responseText, url) => {\n        var response = responseText;\n        if (response.length > 50) {\n            response = response.substring(0, 50) + '...';\n        }\n        new DialogBoxMorph().inform(\n            'Snap!Cloud',\n            'http://'\n                + url + ':\\n\\n'\n                + 'responds:\\n'\n                + response,\n            this.world(),\n            this.cloudIcon(null, new Color(0, 180, 0))\n        );\n    };\n};\n\nIDE_Morph.prototype.cloudError = function () {\n    return (responseText, url) => {\n        // first, try to find out an explanation for the error\n        // and notify the user about it,\n        // if none is found, show an error dialog box\n        var response = responseText,\n            // explanation = getURL('https://snap.berkeley.edu/cloudmsg.txt'),\n            explanation = null;\n        if (this.shield) {\n            this.shield.destroy();\n            this.shield = null;\n        }\n        if (explanation) {\n            this.showMessage(explanation);\n            return;\n        }\n        new DialogBoxMorph().inform(\n            'Snap!Cloud',\n            (url ? url + '\\n' : '')\n                + response,\n            this.world(),\n            this.cloudIcon(null, new Color(180, 0, 0))\n        );\n    };\n};\n\nIDE_Morph.prototype.cloudIcon = function (height, color) {\n    var clr = color || DialogBoxMorph.prototype.titleBarColor,\n        isFlat = MorphicPreferences.isFlat,\n        icon = new SymbolMorph(\n            isFlat ? 'cloud' : 'cloudGradient',\n            height || 50,\n            clr,\n            isFlat ? null : new Point(-1, -1),\n            clr.darker(50)\n        );\n    if (!isFlat) {\n        icon.addShadow(new Point(1, 1), 1, clr.lighter(95));\n    }\n    return icon;\n};\n\nIDE_Morph.prototype.setCloudURL = function () {\n    var myself = this;\n    new DialogBoxMorph(\n        null,\n        url => {\n            this.cloud.url = url;\n            this.cloud.checkCredentials(\n                () => this.controlBar.cloudButton.refresh(),\n                () => this.controlBar.cloudButton.refresh()\n            );\n        }\n    ).withKey('cloudURL').prompt(\n        'Cloud URL',\n        this.cloud.url,\n        this.world(),\n        null,\n        this.cloud.knownDomains\n    );\n};\n\nIDE_Morph.prototype.urlParameters = function () {\n    var parameters = location.hash.slice(location.hash.indexOf(':') + 1);\n    return this.cloud.parseDict(parameters);\n};\n\nIDE_Morph.prototype.hasCloudProject = function () {\n    var params = this.urlParameters();\n    return params.hasOwnProperty('Username') &&\n        params.hasOwnProperty('ProjectName');\n};\n\n// IDE_Morph HTTP data fetching\n\nIDE_Morph.prototype.getURL = function (url, callback, responseType) {\n    // fetch the contents of a url and pass it into the specified callback.\n    // If no callback is specified synchronously fetch and return it\n    // Note: Synchronous fetching has been deprecated and should be switched\n    var request = new XMLHttpRequest(),\n        async = callback instanceof Function,\n        rsp;\n    if (async) {\n        request.responseType = responseType || 'text';\n    }\n    rsp = (!async || request.responseType === 'text') ? 'responseText'\n        : 'response';\n    try {\n        request.open('GET', url, async);\n        if (async) {\n            request.onreadystatechange = () => {\n                if (request.readyState === 4) {\n                    if (request[rsp]) {\n                        callback.call(\n                            this,\n                            request[rsp]\n                        );\n                    } else {\n                        this.showMessage('unable to retrieve ' + url);\n                        throw new Error('unable to retrieve ' + url);\n                    }\n                }\n            };\n        }\n        // cache-control, commented out for now\n        // added for Snap4Arduino but has issues with local robot servers\n        // request.setRequestHeader('Cache-Control', 'max-age=0');\n        request.send();\n        if (!async) {\n            if (request.status === 200) {\n                return request[rsp];\n            }\n            throw new Error('unable to retrieve ' + url);\n        }\n    } catch (err) {\n        this.showMessage(err.toString());\n        if (async) {\n            callback.call(this);\n        } else {\n            return request[rsp];\n        }\n    }\n};\n\n// IDE_Morph user dialog shortcuts\n\nIDE_Morph.prototype.showMessage = function (message, secs) {\n    var m = new MenuMorph(null, message),\n        intervalHandle;\n    m.popUpCenteredInWorld(this.world());\n    if (secs) {\n        intervalHandle = setInterval(\n            () => {\n                m.destroy();\n                clearInterval(intervalHandle);\n            },\n            secs * 1000\n        );\n    }\n    return m;\n};\n\nIDE_Morph.prototype.inform = function (title, message) {\n    new DialogBoxMorph().inform(\n        title,\n        localize(message),\n        this.world()\n    );\n};\n\nIDE_Morph.prototype.confirm = function (message, title, action) {\n    new DialogBoxMorph(null, action).askYesNo(\n        title,\n        localize(message),\n        this.world()\n    );\n};\n\nIDE_Morph.prototype.prompt = function (message, callback, choices, key) {\n    (new DialogBoxMorph(null, callback)).withKey(key).prompt(\n        message,\n        '',\n        this.world(),\n        null,\n        choices\n    );\n};\n\n// IDE_Morph bracing against IE\n\nIDE_Morph.prototype.warnAboutIE = function () {\n    var dlg, txt;\n    if (this.isIE()) {\n        dlg = new DialogBoxMorph();\n        txt = new TextMorph(\n            'Please do not use Internet Explorer.\\n' +\n                'Snap! runs best in a web-standards\\n' +\n                'compliant browser',\n            dlg.fontSize,\n            dlg.fontStyle,\n            true,\n            false,\n            'center',\n            null,\n            null,\n            MorphicPreferences.isFlat ? null : new Point(1, 1),\n            WHITE\n        );\n\n        dlg.key = 'IE-Warning';\n        dlg.labelString = \"Internet Explorer\";\n        dlg.createLabel();\n        dlg.addBody(txt);\n        dlg.fixLayout();\n        dlg.popUp(this.world());\n    }\n};\n\nIDE_Morph.prototype.isIE = function () {\n    var ua = navigator.userAgent;\n    return ua.indexOf(\"MSIE \") > -1 || ua.indexOf(\"Trident/\") > -1;\n};\n\n// ProjectDialogMorph ////////////////////////////////////////////////////\n\n// ProjectDialogMorph inherits from DialogBoxMorph:\n\nProjectDialogMorph.prototype = new DialogBoxMorph();\nProjectDialogMorph.prototype.constructor = ProjectDialogMorph;\nProjectDialogMorph.uber = DialogBoxMorph.prototype;\n\n// ProjectDialogMorph instance creation:\n\nexport function ProjectDialogMorph(ide, label) {\n    this.init(ide, label);\n}\n\nProjectDialogMorph.prototype.init = function (ide, task) {\n    // Trace.log('ProjectDialog.shown');\n    // additional properties:\n    this.ide = ide;\n    this.task = task || 'open'; // String describing what do do (open, save)\n    this.source = ide.source;\n    this.projectList = []; // [{name: , thumb: , notes:}]\n\n    this.handle = null;\n    this.srcBar = null;\n    this.nameField = null;\n    this.filterField = null;\n    this.magnifyingGlass = null;\n    this.listField = null;\n    this.preview = null;\n    this.notesText = null;\n    this.notesField = null;\n    this.deleteButton = null;\n    this.shareButton = null;\n    this.unshareButton = null;\n    this.publishButton = null;\n    this.unpublishButton = null;\n    this.recoverButton = null;\n\n    // initialize inherited properties:\n    ProjectDialogMorph.uber.init.call(\n        this,\n        this, // target\n        null, // function\n        null // environment\n    );\n\n    // override inherited properites:\n    this.labelString = this.task === 'save' ? 'Save Project' : 'Open Project';\n    this.createLabel();\n    this.key = 'project' + task;\n\n    // build contents\n    if (task === 'open' && this.source === 'disk') {\n        // give the user a chance to switch to another source\n        this.source = null;\n        this.buildContents();\n        this.projectList = [];\n        this.listField.hide();\n        this.source = 'disk';\n    } else {\n        this.buildContents();\n        this.onNextStep = () => // yield to show \"updating\" message\n            this.setSource(this.source);\n    }\n};\n\nProjectDialogMorph.prototype.buildContents = function () {\n    var thumbnail, notification;\n\n    this.addBody(new Morph());\n    this.body.color = this.color;\n\n    this.srcBar = new AlignmentMorph('column', this.padding / 2);\n\n    if (this.ide.cloudMsg) {\n        notification = new TextMorph(\n            this.ide.cloudMsg,\n            10,\n            null, // style\n            false, // bold\n            null, // italic\n            null, // alignment\n            null, // width\n            null, // font name\n            new Point(1, 1), // shadow offset\n            WHITE // shadowColor\n        );\n        notification.refresh = nop;\n        this.srcBar.add(notification);\n    }\n\n    if (!this.ide.cloud.disabled) {\n        this.addSourceButton('cloud', localize('Cloud'), 'cloud');\n    }\n\n    if (this.task === 'open') {\n        this.buildFilterField();\n        this.addSourceButton('examples', localize('Examples'), 'poster');\n        if (this.hasLocalProjects() || this.ide.world().currentKey === 16) {\n            // shift- clicked\n            this.addSourceButton('local', localize('Browser'), 'globe');\n        }\n    }\n    this.addSourceButton('disk', localize('Computer'), 'storage');\n\n    this.srcBar.fixLayout();\n    this.body.add(this.srcBar);\n\n    if (this.task === 'save') {\n        this.nameField = new InputFieldMorph(this.ide.projectName);\n        this.body.add(this.nameField);\n    }\n\n    this.listField = new ListMorph([]);\n    this.fixListFieldItemColors();\n    this.listField.fixLayout = nop;\n    this.listField.edge = InputFieldMorph.prototype.edge;\n    this.listField.fontSize = InputFieldMorph.prototype.fontSize;\n    this.listField.typeInPadding = InputFieldMorph.prototype.typeInPadding;\n    this.listField.contrast = InputFieldMorph.prototype.contrast;\n    this.listField.render = InputFieldMorph.prototype.render;\n    this.listField.drawRectBorder = InputFieldMorph.prototype.drawRectBorder;\n\n    this.body.add(this.listField);\n\n    this.preview = new Morph();\n    this.preview.fixLayout = nop;\n    this.preview.edge = InputFieldMorph.prototype.edge;\n    this.preview.fontSize = InputFieldMorph.prototype.fontSize;\n    this.preview.typeInPadding = InputFieldMorph.prototype.typeInPadding;\n    this.preview.contrast = InputFieldMorph.prototype.contrast;\n    this.preview.render = function (ctx) {\n        InputFieldMorph.prototype.render.call(this, ctx);\n        if (this.cachedTexture) {\n            this.renderCachedTexture(ctx);\n        } else if (this.texture) {\n            this.renderTexture(this.texture, ctx);\n        }\n    };\n    this.preview.renderCachedTexture = function (ctx) {\n        ctx.drawImage(this.cachedTexture, this.edge, this.edge);\n    };\n    this.preview.drawRectBorder = InputFieldMorph.prototype.drawRectBorder;\n    this.preview.setExtent(\n        this.ide.serializer.thumbnailSize.add(this.preview.edge * 2)\n    );\n\n    this.body.add(this.preview);\n    if (this.task === 'save') {\n        thumbnail = this.ide.stage.thumbnail(\n            SnapSerializer.prototype.thumbnailSize\n        );\n        this.preview.texture = null;\n        this.preview.cachedTexture = thumbnail;\n        this.preview.rerender();\n    }\n\n    this.notesField = new ScrollFrameMorph();\n    this.notesField.fixLayout = nop;\n\n    this.notesField.edge = InputFieldMorph.prototype.edge;\n    this.notesField.fontSize = InputFieldMorph.prototype.fontSize;\n    this.notesField.typeInPadding = InputFieldMorph.prototype.typeInPadding;\n    this.notesField.contrast = InputFieldMorph.prototype.contrast;\n    this.notesField.render = InputFieldMorph.prototype.render;\n    this.notesField.drawRectBorder = InputFieldMorph.prototype.drawRectBorder;\n\n    this.notesField.acceptsDrops = false;\n    this.notesField.contents.acceptsDrops = false;\n\n    if (this.task === 'open') {\n        this.notesText = new TextMorph('');\n    } else { // 'save'\n        this.notesText = new TextMorph(this.ide.projectNotes);\n        this.notesText.isEditable = true;\n        this.notesText.enableSelecting();\n    }\n\n    this.notesField.isTextLineWrapping = true;\n    this.notesField.padding = 3;\n    this.notesField.setContents(this.notesText);\n    this.notesField.setWidth(this.preview.width());\n\n    this.body.add(this.notesField);\n\n    if (this.task === 'open') {\n        this.addButton('openProject', 'Open');\n        this.action = 'openProject';\n        this.recoverButton = this.addButton('recoveryDialog', 'Recover', true);\n        this.recoverButton.hide();\n    } else { // 'save'\n        this.addButton('saveProject', 'Save');\n        this.action = 'saveProject';\n    }\n    this.shareButton = this.addButton('shareProject', 'Share', true);\n    this.unshareButton = this.addButton('unshareProject', 'Unshare', true);\n    this.shareButton.hide();\n    this.unshareButton.hide();\n    this.publishButton = this.addButton('publishProject', 'Publish', true);\n    this.unpublishButton = this.addButton(\n        'unpublishProject',\n        'Unpublish',\n        true\n    );\n    this.publishButton.hide();\n    this.unpublishButton.hide();\n    this.deleteButton = this.addButton('deleteProject', 'Delete');\n    this.addButton('cancel', 'Cancel');\n\n    if (notification) {\n        this.setExtent(new Point(500, 360).add(notification.extent()));\n    } else {\n        this.setExtent(new Point(500, 360));\n    }\n    this.fixLayout();\n\n};\n\nProjectDialogMorph.prototype.popUp = function (wrrld) {\n    var world = wrrld || this.ide.world();\n    if (world) {\n        ProjectDialogMorph.uber.popUp.call(this, world);\n        this.handle = new HandleMorph(\n            this,\n            350,\n            330,\n            this.corner,\n            this.corner\n        );\n    }\n};\n\n// ProjectDialogMorph action buttons\n\nProjectDialogMorph.prototype.createButtons = function () {\n    if (this.buttons) {\n        this.buttons.destroy();\n    }\n    this.buttons = new AlignmentMorph('column', this.padding / 3);\n    this.buttons.bottomRow = new AlignmentMorph('row', this.padding);\n    this.buttons.topRow = new AlignmentMorph('row', this.padding);\n    this.buttons.add(this.buttons.topRow);\n    this.buttons.add(this.buttons.bottomRow);\n    this.add(this.buttons);\n\n    this.buttons.fixLayout = function () {\n        if (this.topRow.children.some(function (any) {\n            return any.isVisible;\n        })) {\n            this.topRow.show();\n            this.topRow.fixLayout();\n        } else {\n            this.topRow.hide();\n        }\n        this.bottomRow.fixLayout();\n        AlignmentMorph.prototype.fixLayout.call(this);\n    };\n};\n\nProjectDialogMorph.prototype.addButton = function (action, label, topRow) {\n    var button = new PushButtonMorph(\n        this,\n        action || 'ok',\n        '  ' + localize((label || 'OK')) + '  '\n    );\n    button.fontSize = this.buttonFontSize;\n    button.corner = this.buttonCorner;\n    button.edge = this.buttonEdge;\n    button.outline = this.buttonOutline;\n    button.outlineColor = this.buttonOutlineColor;\n    button.outlineGradient = this.buttonOutlineGradient;\n    button.padding = this.buttonPadding;\n    button.contrast = this.buttonContrast;\n    button.fixLayout();\n    if (topRow) {\n        this.buttons.topRow.add(button);\n    } else {\n        this.buttons.bottomRow.add(button);\n    }\n    return button;\n};\n\n// ProjectDialogMorph source buttons\n\nProjectDialogMorph.prototype.addSourceButton = function (\n    source,\n    label,\n    symbol\n) {\n    var lbl1 = new StringMorph(\n            label,\n            10,\n            null,\n            true,\n            null,\n            null,\n            new Point(1, 1),\n            WHITE\n        ),\n        lbl2 = new StringMorph(\n            label,\n            10,\n            null,\n            true,\n            null,\n            null,\n            new Point(-1, -1),\n            this.titleBarColor.darker(50),\n            WHITE\n        ),\n        l1 = new Morph(),\n        l2 = new Morph(),\n        button;\n\n    lbl1.add(new SymbolMorph(\n        symbol,\n        24,\n        this.titleBarColor.darker(20),\n        new Point(1, 1),\n        this.titleBarColor.darker(50)\n    ));\n    lbl1.children[0].setCenter(lbl1.center());\n    lbl1.children[0].setBottom(lbl1.top() - this.padding / 2);\n\n    l1.isCachingImage = true;\n    l1.cachedImage = lbl1.fullImage();\n    l1.bounds = lbl1.fullBounds();\n\n    lbl2.add(new SymbolMorph(\n        symbol,\n        24,\n        WHITE,\n        new Point(-1, -1),\n        this.titleBarColor.darker(50)\n    ));\n    lbl2.children[0].setCenter(lbl2.center());\n    lbl2.children[0].setBottom(lbl2.top() - this.padding / 2);\n\n    l2.isCachingImage = true;\n    l2.cachedImage = lbl2.fullImage();\n    l2.bounds = lbl2.fullBounds();\n\n    button = new ToggleButtonMorph(\n        null, //colors,\n        this, // the ProjectDialog is the target\n        () => this.setSource(source), // action\n        [l1, l2],\n        () => this.source === source // query\n    );\n\n    button.corner = this.buttonCorner;\n    button.edge = this.buttonEdge;\n    button.outline = this.buttonOutline;\n    button.outlineColor = this.buttonOutlineColor;\n    button.outlineGradient = this.buttonOutlineGradient;\n    button.labelMinExtent = new Point(60, 0);\n    button.padding = this.buttonPadding;\n    button.contrast = this.buttonContrast;\n    button.pressColor = this.titleBarColor.darker(20);\n    button.fixLayout();\n    button.refresh();\n    this.srcBar.add(button);\n};\n\n// ProjectDialogMorph list field control\n\nProjectDialogMorph.prototype.fixListFieldItemColors = function () {\n    // remember to always fixLayout() afterwards for the changes\n    // to take effect\n    this.listField.contents.children[0].alpha = 0;\n    this.listField.contents.children[0].children.forEach(item => {\n        item.pressColor = this.titleBarColor.darker(20);\n        item.color = new Color(0, 0, 0, 0);\n    });\n};\n\n// ProjectDialogMorph filter field\n\nProjectDialogMorph.prototype.buildFilterField = function () {\n    var myself = this;\n\n    this.filterField = new InputFieldMorph('');\n    this.magnifyingGlass = new SymbolMorph(\n        'magnifyingGlass',\n        this.filterField.height(),\n        this.titleBarColor.darker(50)\n    );\n\n    this.body.add(this.magnifyingGlass);\n    this.body.add(this.filterField);\n\n    this.filterField.reactToInput = function (evt) {\n        var text = this.getValue();\n\n        myself.listField.elements =\n            myself.projectList.filter(aProject => {\n                var name = aProject.projectname || aProject.name,\n                    notes = aProject.notes || '';\n                return name.toLowerCase().indexOf(text.toLowerCase()) > -1 ||\n                    notes.toLowerCase().indexOf(text.toLowerCase()) > -1;\n            });\n\n        if (myself.listField.elements.length === 0) {\n            myself.listField.elements.push('(no matches)');\n        }\n\n        myself.clearDetails();\n        myself.listField.buildListContents();\n        myself.fixListFieldItemColors();\n        myself.listField.adjustScrollBars();\n        myself.listField.scrollY(myself.listField.top());\n        myself.fixLayout();\n    };\n};\n\n// ProjectDialogMorph ops\n\nProjectDialogMorph.prototype.setSource = function (source) {\n    // Trace.log('ProjectDialog.setSource', source);\n    var msg;\n\n    this.source = source;\n    this.srcBar.children.forEach(button =>\n        button.refresh()\n    );\n\n    switch (this.source) {\n    case 'cloud':\n        msg = this.ide.showMessage('Updating\\nproject list...');\n        this.projectList = [];\n        this.ide.cloud.getProjectList(\n            response => {\n                // Don't show cloud projects if user has since switched panes.\n                if (this.source === 'cloud') {\n                    this.installCloudProjectList(response.projects);\n                }\n                msg.destroy();\n            },\n            (err, lbl) => {\n                msg.destroy();\n                this.ide.cloudError().call(null, err, lbl);\n            }\n        );\n        return;\n    case 'examples':\n        this.projectList = this.getExamplesProjectList();\n        break;\n    case 'local':\n        // deprecated, only for reading\n        this.projectList = this.getLocalProjectList();\n        break;\n    case 'disk':\n        if (this.task === 'save') {\n            this.projectList = [];\n        } else {\n            this.destroy();\n            this.ide.importLocalFile();\n            return;\n        }\n        break;\n    }\n\n    this.listField.destroy();\n    this.listField = new ListMorph(\n        this.projectList,\n        this.projectList.length > 0 ?\n            (element) => {return element.name || element; }\n                : null,\n        null,\n        () => this.ok()\n    );\n    if (this.source === 'disk') {\n        this.listField.hide();\n    }\n\n    this.fixListFieldItemColors();\n    this.listField.fixLayout = nop;\n    this.listField.edge = InputFieldMorph.prototype.edge;\n    this.listField.fontSize = InputFieldMorph.prototype.fontSize;\n    this.listField.typeInPadding = InputFieldMorph.prototype.typeInPadding;\n    this.listField.contrast = InputFieldMorph.prototype.contrast;\n    this.listField.render = InputFieldMorph.prototype.render;\n    this.listField.drawRectBorder = InputFieldMorph.prototype.drawRectBorder;\n\n    if (this.source === 'local') {\n        this.listField.action = (item) => {\n            var src, xml;\n            if (item === undefined) {return; }\n            if (this.nameField) {\n                this.nameField.setContents(item.name || '');\n            }\n            if (this.task === 'open') {\n                src = localStorage['-snap-project-' + item.name];\n                if (src) {\n                    xml = this.ide.serializer.parse(src);\n                    this.notesText.text =\n                        xml.childNamed('notes').contents || '';\n                    this.notesText.rerender();\n                    this.notesField.contents.adjustBounds();\n                    this.preview.texture =\n                        xml.childNamed('thumbnail').contents || null;\n                    this.preview.cachedTexture = null;\n                    this.preview.rerender();\n                }\n            }\n            this.edit();\n        };\n    } else { // 'examples'; 'cloud' is initialized elsewhere\n        this.listField.action = (item) => {\n            var src, xml;\n            if (item === undefined) {return; }\n            if (this.nameField) {\n                this.nameField.setContents(item.name || '');\n            }\n            src = this.ide.getURL(\n                this.ide.resourceURL('Examples', item.fileName)\n            );\n            xml = this.ide.serializer.parse(src);\n            this.notesText.text = xml.childNamed('notes').contents || '';\n            this.notesText.rerender();\n            this.notesField.contents.adjustBounds();\n            this.preview.texture = xml.childNamed('thumbnail').contents || null;\n            this.preview.cachedTexture = null;\n            this.preview.rerender();\n            this.edit();\n        };\n    }\n    this.body.add(this.listField);\n    this.shareButton.hide();\n    this.unshareButton.hide();\n\n    if (this.task === 'open') {\n        this.recoverButton.hide();\n    }\n\n    this.publishButton.hide();\n    this.unpublishButton.hide();\n    if (this.source === 'local') {\n        this.deleteButton.show();\n    } else { // examples\n        this.deleteButton.hide();\n    }\n    this.buttons.fixLayout();\n    this.fixLayout();\n    if (this.task === 'open') {\n        this.clearDetails();\n    }\n};\n\nProjectDialogMorph.prototype.hasLocalProjects = function () {\n    // check and report whether old projects still exist in the\n    // browser's local storage, which as of v5 has been deprecated,\n    // so the user can recover and move them elsewhere\n    return Object.keys(localStorage).some(any =>\n        any.indexOf('-snap-project-') === 0\n    );\n};\n\nProjectDialogMorph.prototype.getLocalProjectList = function () {\n    var stored, name, dta,\n        projects = [];\n    for (stored in localStorage) {\n        if (Object.prototype.hasOwnProperty.call(localStorage, stored)\n                && stored.substr(0, 14) === '-snap-project-') {\n            name = stored.substr(14);\n            dta = {\n                name: name,\n                thumb: null,\n                notes: null\n            };\n            projects.push(dta);\n        }\n    }\n    projects.sort((x, y) =>\n        x.name.toLowerCase() < y.name.toLowerCase() ? -1 : 1\n    );\n    return projects;\n};\n\nProjectDialogMorph.prototype.getExamplesProjectList = function () {\n    return this.ide.getMediaList('Examples');\n};\n\nProjectDialogMorph.prototype.installCloudProjectList = function (pl) {\n    this.projectList = pl[0] ? pl : [];\n    this.projectList.sort((x, y) =>\n        x.projectname.toLowerCase() < y.projectname.toLowerCase() ? -1 : 1\n    );\n\n    this.listField.destroy();\n    this.listField = new ListMorph(\n        this.projectList,\n        this.projectList.length > 0 ?\n            (element) => {return element.projectname || element; }\n                : null,\n        [ // format: display shared project names bold\n            [\n                'bold',\n                proj => proj.ispublic\n            ],\n            [\n                'italic',\n                proj => proj.ispublished\n            ]\n        ],\n        () => this.ok()\n    );\n    this.fixListFieldItemColors();\n    this.listField.fixLayout = nop;\n    this.listField.edge = InputFieldMorph.prototype.edge;\n    this.listField.fontSize = InputFieldMorph.prototype.fontSize;\n    this.listField.typeInPadding = InputFieldMorph.prototype.typeInPadding;\n    this.listField.contrast = InputFieldMorph.prototype.contrast;\n    this.listField.render = InputFieldMorph.prototype.render;\n    this.listField.drawRectBorder = InputFieldMorph.prototype.drawRectBorder;\n\n    this.listField.action = (item) => {\n        if (item === undefined) {return; }\n        if (this.nameField) {\n            this.nameField.setContents(item.projectname || '');\n        }\n        if (this.task === 'open') {\n            this.notesText.text = item.notes || '';\n            this.notesText.rerender();\n            this.notesField.contents.adjustBounds();\n            this.preview.texture = '';\n            this.preview.rerender();\n            // we ask for the thumbnail when selecting a project\n            this.ide.cloud.getThumbnail(\n                null, // username is implicit\n                item.projectname,\n                thumbnail => {\n                    this.preview.texture = thumbnail;\n                    this.preview.cachedTexture = null;\n                    this.preview.rerender();\n                });\n            new SpeechBubbleMorph(new TextMorph(\n                localize('last changed') + '\\n' + item.lastupdated,\n                null,\n                null,\n                null,\n                null,\n                'center'\n            )).popUp(\n                this.world(),\n                this.preview.rightCenter().add(new Point(2, 0))\n            );\n        }\n        if (item.ispublic) {\n            this.shareButton.hide();\n            this.unshareButton.show();\n            if (item.ispublished) {\n                this.publishButton.hide();\n                this.unpublishButton.show();\n            } else {\n                this.publishButton.show();\n                this.unpublishButton.hide();\n            }\n        } else {\n            this.unshareButton.hide();\n            this.shareButton.show();\n            this.publishButton.hide();\n            this.unpublishButton.hide();\n        }\n        this.buttons.fixLayout();\n        this.fixLayout();\n        this.edit();\n    };\n    this.body.add(this.listField);\n    if (this.task === 'open') {\n        this.recoverButton.show();\n    }\n    this.shareButton.show();\n    this.unshareButton.hide();\n    this.deleteButton.show();\n    this.buttons.fixLayout();\n    this.fixLayout();\n    if (this.task === 'open') {\n        this.clearDetails();\n    }\n};\n\nProjectDialogMorph.prototype.clearDetails = function () {\n    this.notesText.text = '';\n    this.notesText.rerender();\n    this.notesField.contents.adjustBounds();\n    this.preview.texture = null;\n    this.preview.cachedTexture = null;\n    this.preview.rerender();\n};\n\nProjectDialogMorph.prototype.recoveryDialog = function () {\n    var proj = this.listField.selected;\n    if (!proj) {return; }\n    this.removeShadow();\n    this.hide();\n    new ProjectRecoveryDialogMorph(this.ide, proj.projectname, this).popUp();\n};\n\nProjectDialogMorph.prototype.recoveryDialog = function () {\n    var proj = this.listField.selected;\n    if (!proj) {return; }\n    new ProjectRecoveryDialogMorph(this.ide, proj.projectname, this).popUp();\n    this.hide();\n};\n\nProjectDialogMorph.prototype.openProject = function () {\n    var proj = this.listField.selected,\n        src;\n    if (!proj) {return; }\n    this.ide.source = this.source;\n    if (this.source === 'cloud') {\n        this.openCloudProject(proj);\n    } else if (this.source === 'examples') {\n        // Note \"file\" is a property of the parseResourceFile function.\n        src = this.ide.getURL(this.ide.resourceURL('Examples', proj.fileName));\n        this.ide.openProjectString(src);\n        this.destroy();\n    } else { // 'local'\n        this.ide.source = null;\n        this.ide.openProject(proj.name);\n        this.destroy();\n    }\n};\n\nProjectDialogMorph.prototype.openCloudProject = function (project, delta) {\n    this.ide.nextSteps([\n        () => this.ide.showMessage('Fetching project\\nfrom the cloud...'),\n        () => this.rawOpenCloudProject(project, delta)\n    ]);\n};\n\nProjectDialogMorph.prototype.rawOpenCloudProject = function (proj, delta) {\n    this.ide.cloud.getProject(\n        proj.projectname,\n        delta,\n        clouddata => {\n            this.ide.source = 'cloud';\n            this.ide.nextSteps([\n                () => this.ide.openCloudDataString(clouddata)\n            ]);\n\t\t\tlocation.hash = '';\n            if (proj.ispublic) {\n                location.hash = '#present:Username=' +\n                    encodeURIComponent(this.ide.cloud.username) +\n                    '&ProjectName=' +\n                    encodeURIComponent(proj.projectname);\n            }\n        },\n        this.ide.cloudError()\n    );\n    this.destroy();\n};\n\nProjectDialogMorph.prototype.saveProject = function () {\n    var name = this.nameField.contents().text.text,\n        notes = this.notesText.text;\n\n    if (this.ide.projectNotes !== notes) {\n        this.ide.projectNotes = notes;\n    }\n    if (name) {\n        if (this.source === 'cloud') {\n            if (detect(\n                    this.projectList,\n                    item => item.projectname === name\n                )) {\n                this.ide.confirm(\n                    localize(\n                        'Are you sure you want to replace'\n                    ) + '\\n\"' + name + '\"?',\n                    'Replace Project',\n                    () => {\n                        this.ide.setProjectName(name);\n                        this.saveCloudProject();\n                    }\n                );\n            } else {\n                this.ide.setProjectName(name);\n                this.saveCloudProject();\n            }\n        } else if (this.source === 'disk') {\n            this.ide.exportProject(name, false);\n            this.ide.source = 'disk';\n            this.destroy();\n        }\n    }\n};\n\nProjectDialogMorph.prototype.saveCloudProject = function () {\n    this.ide.source = 'cloud';\n    this.ide.saveProjectToCloud();\n    this.destroy();\n};\n\nProjectDialogMorph.prototype.deleteProject = function () {\n    var proj,\n        idx,\n        name;\n\n    if (this.source === 'cloud') {\n        proj = this.listField.selected;\n        if (proj) {\n            this.ide.confirm(\n                localize(\n                    'Are you sure you want to delete'\n                ) + '\\n\"' + proj.projectname + '\"?',\n                'Delete Project',\n                () => this.ide.cloud.deleteProject(\n                    proj.projectname,\n                    null, // username is implicit\n                    () => {\n                        this.ide.hasChangedMedia = true;\n                        idx = this.projectList.indexOf(proj);\n                        this.projectList.splice(idx, 1);\n                        this.installCloudProjectList( // refresh list\n                            this.projectList\n                        );\n                    },\n                    this.ide.cloudError()\n                )\n            );\n        }\n    } else { // 'local, examples'\n        if (this.listField.selected) {\n            name = this.listField.selected.name;\n            this.ide.confirm(\n                localize(\n                    'Are you sure you want to delete'\n                ) + '\\n\"' + name + '\"?',\n                'Delete Project',\n                () => {\n                    delete localStorage['-snap-project-' + name];\n                    this.setSource(this.source); // refresh list\n                }\n            );\n        }\n    }\n};\n\nProjectDialogMorph.prototype.shareProject = function () {\n    var ide = this.ide,\n        proj = this.listField.selected,\n        entry = this.listField.active;\n\n    if (proj) {\n        this.ide.confirm(\n            localize(\n                'Are you sure you want to share'\n            ) + '\\n\"' + proj.projectname + '\"?',\n            'Share Project',\n            () => {\n                // Trace.log('ProjectDialogMorph.shareProject', proj.ProjectName);\n                if (proj.ProjectName === ide.projectName) {\n                    // We log this as a separate event so it's easy to detect\n                    // in MySQL, to see which projects have been shared\n                    // Trace.log('ProjectDialogMorph.shareThisProject');\n                }\n                ide.showMessage('sharing\\nproject...');\n                ide.cloud.shareProject(\n                    proj.projectname,\n                    null, // username is implicit\n                    () => {\n                        proj.ispublic = true;\n                        this.unshareButton.show();\n                        this.shareButton.hide();\n                        this.publishButton.show();\n                        this.unpublishButton.hide();\n                        entry.label.isBold = true;\n                        entry.label.rerender();\n                        this.buttons.fixLayout();\n                        this.rerender();\n                        this.ide.showMessage('shared.', 2);\n\n                        // Set the Shared URL if the project is currently open\n                        if (proj.projectname === ide.projectName) {\n                            var usr = ide.cloud.username,\n                                projectId = 'Username=' +\n                                    encodeURIComponent(usr.toLowerCase()) +\n                                    '&ProjectName=' +\n                                    encodeURIComponent(proj.projectname);\n                            location.hash = 'present:' + projectId;\n                        }\n                    },\n                    this.ide.cloudError()\n                );\n            }\n        );\n    }\n};\n\nProjectDialogMorph.prototype.unshareProject = function () {\n    var ide = this.ide,\n        proj = this.listField.selected,\n        entry = this.listField.active;\n\n    if (proj) {\n        this.ide.confirm(\n            localize(\n                'Are you sure you want to unshare'\n            ) + '\\n\"' + proj.projectname + '\"?',\n            'Unshare Project',\n            () => {\n                // Trace.log('ProjectDialogMorph.unshareProject',\n                //     proj.ProjectName);\n                ide.showMessage('unsharing\\nproject...');\n                ide.cloud.unshareProject(\n                    proj.projectname,\n                    null, // username is implicit\n                    () => {\n                        proj.ispublic = false;\n                        this.shareButton.show();\n                        this.unshareButton.hide();\n                        this.publishButton.hide();\n                        this.unpublishButton.hide();\n                        entry.label.isBold = false;\n                        entry.label.isItalic = false;\n                        entry.label.rerender();\n                        this.buttons.fixLayout();\n                        this.rerender();\n                        this.ide.showMessage('unshared.', 2);\n                        if (proj.projectname === ide.projectName) {\n                            location.hash = '';\n                        }\n                    },\n                    this.ide.cloudError()\n                );\n            }\n        );\n    }\n};\n\nProjectDialogMorph.prototype.publishProject = function () {\n    var ide = this.ide,\n        proj = this.listField.selected,\n        entry = this.listField.active;\n\n    if (proj) {\n        this.ide.confirm(\n            localize(\n                'Are you sure you want to publish'\n            ) + '\\n\"' + proj.projectname + '\"?',\n            'Publish Project',\n            () => {\n                ide.showMessage('publishing\\nproject...');\n                ide.cloud.publishProject(\n                    proj.projectname,\n                    null, // username is implicit\n                    () => {\n                        proj.ispublished = true;\n                        this.unshareButton.show();\n                        this.shareButton.hide();\n                        this.publishButton.hide();\n                        this.unpublishButton.show();\n                        entry.label.isItalic = true;\n                        entry.label.rerender();\n                        this.buttons.fixLayout();\n                        this.rerender();\n                        this.ide.showMessage('published.', 2);\n\n                        // Set the Shared URL if the project is currently open\n                        if (proj.projectname === ide.projectName) {\n                            var usr = ide.cloud.username,\n                                projectId = 'Username=' +\n                                    encodeURIComponent(usr.toLowerCase()) +\n                                    '&ProjectName=' +\n                                    encodeURIComponent(proj.projectname);\n                            location.hash = 'present:' + projectId;\n                        }\n                    },\n                    this.ide.cloudError()\n                );\n            }\n        );\n    }\n};\n\nProjectDialogMorph.prototype.unpublishProject = function () {\n    var proj = this.listField.selected,\n        entry = this.listField.active;\n\n    if (proj) {\n        this.ide.confirm(\n            localize(\n                'Are you sure you want to unpublish'\n            ) + '\\n\"' + proj.projectname + '\"?',\n            'Unpublish Project',\n            () => {\n                this.ide.showMessage('unpublishing\\nproject...');\n                this.ide.cloud.unpublishProject(\n                    proj.projectname,\n                    null, // username is implicit\n                    () => {\n                        proj.ispublished = false;\n                        this.unshareButton.show();\n                        this.shareButton.hide();\n                        this.publishButton.show();\n                        this.unpublishButton.hide();\n                        entry.label.isItalic = false;\n                        entry.label.rerender();\n                        this.buttons.fixLayout();\n                        this.rerender();\n                        this.ide.showMessage('unpublished.', 2);\n                    },\n                    this.ide.cloudError()\n                );\n            }\n        );\n    }\n};\n\nProjectDialogMorph.prototype.edit = function () {\n    if (this.nameField) {\n        this.nameField.edit();\n    } else if (this.filterField) {\n        this.filterField.edit();\n    }\n};\n\n// ProjectDialogMorph layout\n\nProjectDialogMorph.prototype.fixLayout = function () {\n    var th = fontHeight(this.titleFontSize) + this.titlePadding * 2,\n        thin = this.padding / 2,\n        inputField = this.nameField || this.filterField;\n\n    if (this.buttons && (this.buttons.children.length > 0)) {\n        this.buttons.fixLayout();\n    }\n\n    if (this.body) {\n        this.body.setPosition(this.position().add(new Point(\n            this.padding,\n            th + this.padding\n        )));\n        this.body.setExtent(new Point(\n            this.width() - this.padding * 2,\n            this.height() - this.padding * 3 - th - this.buttons.height()\n        ));\n        this.srcBar.setPosition(this.body.position());\n\n        inputField.setWidth(\n                this.body.width() - this.srcBar.width() - this.padding * 6\n            );\n        inputField.setLeft(this.srcBar.right() + this.padding * 3);\n        inputField.setTop(this.srcBar.top());\n\n        this.listField.setLeft(this.srcBar.right() + this.padding);\n        this.listField.setWidth(\n            this.body.width()\n                - this.srcBar.width()\n                - this.preview.width()\n                - this.padding\n                - thin\n        );\n        this.listField.contents.children[0].adjustWidths();\n\n        this.listField.setTop(inputField.bottom() + this.padding);\n        this.listField.setHeight(\n            this.body.height() - inputField.height() - this.padding\n        );\n\n        if (this.magnifyingGlass) {\n            this.magnifyingGlass.setTop(inputField.top());\n            this.magnifyingGlass.setLeft(this.listField.left());\n        }\n\n        this.preview.setRight(this.body.right());\n        this.preview.setTop(inputField.bottom() + this.padding);\n\n        this.notesField.setTop(this.preview.bottom() + thin);\n        this.notesField.setLeft(this.preview.left());\n        this.notesField.setHeight(\n            this.body.bottom() - this.preview.bottom() - thin\n        );\n    }\n\n    if (this.label) {\n        this.label.setCenter(this.center());\n        this.label.setTop(this.top() + (th - this.label.height()) / 2);\n    }\n\n    if (this.buttons && (this.buttons.children.length > 0)) {\n        this.buttons.setCenter(this.center());\n        this.buttons.setBottom(this.bottom() - this.padding);\n    }\n\n    // refresh shadow\n    this.removeShadow();\n    this.addShadow();\n};\n\n// ProjectRecoveryDialogMorph /////////////////////////////////////////\n// I show previous versions for a particular project and\n// let users recover them.\n\nProjectRecoveryDialogMorph.prototype = new DialogBoxMorph();\nProjectRecoveryDialogMorph.prototype.constructor = ProjectRecoveryDialogMorph;\nProjectRecoveryDialogMorph.uber = DialogBoxMorph.prototype;\n\n// ProjectRecoveryDialogMorph instance creation:\n\nexport function ProjectRecoveryDialogMorph(ide, project, browser) {\n    this.init(ide, project, browser);\n}\n\nProjectRecoveryDialogMorph.prototype.init = function (\n    ide,\n    projectName,\n    browser\n) {\n    // initialize inherited properties:\n    ProjectRecoveryDialogMorph.uber.init.call(\n        this,\n        this, // target\n        null, // function\n        null  // environment\n    );\n\n    this.ide = ide;\n    this.browser = browser;\n    this.key = 'recoverProject';\n    this.projectName = projectName;\n\n    this.versions = null;\n\n    this.handle = null;\n    this.listField = null;\n    this.preview = null;\n    this.notesText = null;\n    this.notesField = null;\n\n    this.labelString = 'Recover project';\n    this.createLabel();\n\n    this.buildContents();\n};\n\nProjectRecoveryDialogMorph.prototype.buildContents = function () {\n    this.addBody(new Morph());\n    this.body.color = this.color;\n\n    this.buildListField();\n\n    this.preview = new Morph();\n    this.preview.fixLayout = nop;\n    this.preview.edge = InputFieldMorph.prototype.edge;\n    this.preview.fontSize = InputFieldMorph.prototype.fontSize;\n    this.preview.typeInPadding = InputFieldMorph.prototype.typeInPadding;\n    this.preview.contrast = InputFieldMorph.prototype.contrast;\n    this.preview.drawNew = function () {\n        InputFieldMorph.prototype.drawNew.call(this);\n        if (this.texture) {\n            this.drawTexture(this.texture);\n        }\n    };\n    this.preview.drawCachedTexture = function () {\n        var context = this.image.getContext('2d');\n        context.drawImage(this.cachedTexture, this.edge, this.edge);\n        this.changed();\n    };\n    this.preview.drawRectBorder = InputFieldMorph.prototype.drawRectBorder;\n    this.preview.setExtent(\n        this.ide.serializer.thumbnailSize.add(this.preview.edge * 2)\n    );\n\n    this.body.add(this.preview);\n    this.preview.drawNew();\n\n    this.notesField = new ScrollFrameMorph();\n    this.notesField.fixLayout = nop;\n\n    this.notesField.edge = InputFieldMorph.prototype.edge;\n    this.notesField.fontSize = InputFieldMorph.prototype.fontSize;\n    this.notesField.typeInPadding = InputFieldMorph.prototype.typeInPadding;\n    this.notesField.contrast = InputFieldMorph.prototype.contrast;\n    this.notesField.drawNew = InputFieldMorph.prototype.drawNew;\n    this.notesField.drawRectBorder = InputFieldMorph.prototype.drawRectBorder;\n\n    this.notesField.acceptsDrops = false;\n    this.notesField.contents.acceptsDrops = false;\n\n    this.notesText = new TextMorph('');\n\n    this.notesField.isTextLineWrapping = true;\n    this.notesField.padding = 3;\n    this.notesField.setContents(this.notesText);\n    this.notesField.setWidth(this.preview.width());\n\n    this.body.add(this.notesField);\n\n    this.addButton('recoverProject', 'Recover');\n    this.addButton('cancel', 'Cancel');\n\n    this.setExtent(new Point(360, 300));\n    this.fixLayout();\n};\n\nProjectRecoveryDialogMorph.prototype.buildListField = function () {\n    var myself = this;\n\n    this.listField = new ListMorph([]);\n    this.fixListFieldItemColors();\n    this.listField.fixLayout = nop;\n    this.listField.edge = InputFieldMorph.prototype.edge;\n    this.listField.fontSize = InputFieldMorph.prototype.fontSize;\n    this.listField.typeInPadding = InputFieldMorph.prototype.typeInPadding;\n    this.listField.contrast = InputFieldMorph.prototype.contrast;\n    this.listField.drawNew = InputFieldMorph.prototype.drawNew;\n    this.listField.drawRectBorder = InputFieldMorph.prototype.drawRectBorder;\n\n    this.listField.action = function (item) {\n        var version;\n        if (item === undefined) { return; }\n        version = detect(\n            myself.versions,\n            function (version) {\n                return version.lastupdated === item;\n            });\n        myself.notesText.text = version.notes || '';\n        myself.notesText.drawNew();\n        myself.notesField.contents.adjustBounds();\n        myself.preview.texture = version.thumbnail;\n        myself.preview.cachedTexture = null;\n        myself.preview.drawNew();\n    };\n\n    this.ide.cloud.getProjectVersionMetadata(\n        this.projectName,\n        function (versions) {\n            var today = new Date(),\n                yesterday = new Date();\n            yesterday.setDate(today.getDate() - 1);\n            myself.versions = versions;\n            myself.versions.forEach(function (version) {\n                var date = new Date(\n                    new Date().getTime() - version.lastupdated * 1000\n                );\n                if (date.toDateString() === today.toDateString()) {\n                    version.lastupdated = localize('Today, ') +\n                        date.toLocaleTimeString();\n                } else if (date.toDateString() === yesterday.toDateString()) {\n                    version.lastupdated = localize('Yesterday, ') +\n                        date.toLocaleTimeString();\n                } else {\n                    version.lastupdated = date.toLocaleString();\n                }\n            });\n            myself.listField.elements =\n                myself.versions.map(function (version) {\n                    return version.lastupdated;\n                });\n            myself.clearDetails();\n            myself.listField.buildListContents();\n            myself.fixListFieldItemColors();\n            myself.listField.adjustScrollBars();\n            myself.listField.scrollY(myself.listField.top());\n            myself.fixLayout();\n        },\n        this.ide.cloudError()\n    );\n\n    this.body.add(this.listField);\n};\n\nProjectRecoveryDialogMorph.prototype.cancel = function () {\n    var myself = this;\n    this.browser.show();\n    this.browser.listField.select(\n        detect(\n            this.browser.projectList,\n            function (item) {\n                return item.projectname === myself.projectName;\n            }\n        )\n    );\n    ProjectRecoveryDialogMorph.uber.cancel.call(this);\n};\n\nProjectRecoveryDialogMorph.prototype.recoverProject = function () {\n    var lastupdated = this.listField.selected,\n        version = detect(\n        this.versions,\n        function (version) {\n            return version.lastupdated === lastupdated;\n        });\n\n    this.browser.openCloudProject(\n        {projectname: this.projectName},\n        version.delta\n    );\n    this.destroy();\n};\n\nProjectRecoveryDialogMorph.prototype.popUp = function () {\n    var world = this.ide.world();\n    if (world) {\n        ProjectRecoveryDialogMorph.uber.popUp.call(this, world);\n        this.handle = new HandleMorph(\n            this,\n            300,\n            300,\n            this.corner,\n            this.corner\n        );\n    }\n};\n\nProjectRecoveryDialogMorph.prototype.fixListFieldItemColors =\n    ProjectDialogMorph.prototype.fixListFieldItemColors;\n\nProjectRecoveryDialogMorph.prototype.clearDetails =\n    ProjectDialogMorph.prototype.clearDetails;\n\nProjectRecoveryDialogMorph.prototype.fixLayout = function () {\n    var titleHeight = fontHeight(this.titleFontSize) + this.titlePadding * 2,\n        thin = this.padding / 2,\n        oldFlag = Morph.prototype.trackChanges;\n\n    Morph.prototype.trackChanges = false;\n\n    if (this.body) {\n        this.body.setPosition(this.position().add(new Point(\n            this.padding,\n            titleHeight + this.padding\n        )));\n        this.body.setExtent(new Point(\n            this.width() - this.padding * 2,\n            this.height()\n                - this.padding * 3 // top, bottom and button padding.\n                - titleHeight\n                - this.buttons.height()\n        ));\n\n        this.listField.setWidth(\n            this.body.width()\n                - this.preview.width()\n                - this.padding\n        );\n        this.listField.contents.children[0].adjustWidths();\n\n        this.listField.setPosition(this.body.position());\n        this.listField.setHeight(this.body.height());\n\n        this.preview.setRight(this.body.right());\n        this.preview.setTop(this.listField.top());\n\n        this.notesField.setTop(this.preview.bottom() + thin);\n        this.notesField.setLeft(this.preview.left());\n        this.notesField.setHeight(\n            this.body.bottom() - this.preview.bottom() - thin\n        );\n    }\n\n    if (this.label) {\n        this.label.setCenter(this.center());\n        this.label.setTop(\n            this.top() + (titleHeight - this.label.height()) / 2\n        );\n    }\n\n    if (this.buttons) {\n        this.buttons.fixLayout();\n        this.buttons.setCenter(this.center());\n        this.buttons.setBottom(this.bottom() - this.padding);\n    }\n\n    Morph.prototype.trackChanges = oldFlag;\n    this.changed();\n};\n\n// LibraryImportDialogMorph ///////////////////////////////////////////\n// I am preview dialog shown before importing a library.\n// I inherit from a DialogMorph but look similar to\n// ProjectDialogMorph, and BlockImportDialogMorph\n\nLibraryImportDialogMorph.prototype = new DialogBoxMorph();\nLibraryImportDialogMorph.prototype.constructor = LibraryImportDialogMorph;\nLibraryImportDialogMorph.uber = DialogBoxMorph.prototype;\n\n// LibraryImportDialogMorph instance creation:\n\nexport function LibraryImportDialogMorph(ide, librariesData) {\n    this.init(ide, librariesData);\n}\n\nLibraryImportDialogMorph.prototype.init = function (ide, librariesData) {\n    // initialize inherited properties:\n    LibraryImportDialogMorph.uber.init.call(\n        this,\n        this, // target\n        null, // function\n        null  // environment\n    );\n\n    this.ide = ide;\n    this.key = 'importLibrary';\n    this.action = 'importLibrary';\n    this.librariesData = librariesData; // [{name: , fileName: , description:}]\n\n    // I contain a cached version of the libaries I have displayed,\n    // because users may choose to explore a library many times before\n    // importing.\n    this.libraryCache = {}; // {fileName: [blocks-array] }\n\n    this.handle = null;\n    this.listField = null;\n    this.palette = null;\n    this.notesText = null;\n    this.notesField = null;\n\n    this.labelString = 'Import library';\n    this.createLabel();\n\n    this.buildContents();\n};\n\nLibraryImportDialogMorph.prototype.buildContents = function () {\n    this.addBody(new Morph());\n    this.body.color = this.color;\n\n    this.initializePalette();\n    this.initializeLibraryDescription();\n    this.installLibrariesList();\n\n    this.addButton('ok', 'Import');\n    this.addButton('cancel', 'Cancel');\n\n    this.setExtent(new Point(460, 455));\n    this.fixLayout();\n};\n\nLibraryImportDialogMorph.prototype.initializePalette = function () {\n    // I will display a scrolling list of blocks.\n    if (this.palette) {this.palette.destroy(); }\n\n    this.palette = new ScrollFrameMorph(\n        null,\n        null,\n        SpriteMorph.prototype.sliderColor\n    );\n    this.palette.color = SpriteMorph.prototype.paletteColor;\n    this.palette.padding = 4;\n    this.palette.isDraggable = false;\n    this.palette.acceptsDrops = false;\n    this.palette.contents.acceptsDrops = false;\n\n    this.body.add(this.palette);\n};\n\nLibraryImportDialogMorph.prototype.initializeLibraryDescription = function () {\n    if (this.notesField) {this.notesField.destroy(); }\n\n    this.notesField = new ScrollFrameMorph();\n    this.notesField.fixLayout = nop;\n\n    this.notesField.edge = InputFieldMorph.prototype.edge;\n    this.notesField.fontSize = InputFieldMorph.prototype.fontSize;\n    this.notesField.typeInPadding = InputFieldMorph.prototype.typeInPadding;\n    this.notesField.contrast = InputFieldMorph.prototype.contrast;\n    this.notesField.render = InputFieldMorph.prototype.render;\n    this.notesField.drawRectBorder = InputFieldMorph.prototype.drawRectBorder;\n\n    this.notesField.acceptsDrops = false;\n    this.notesField.contents.acceptsDrops = false;\n\n    this.notesText = new TextMorph('');\n\n    this.notesField.isTextLineWrapping = true;\n    this.notesField.padding = 3;\n    this.notesField.setContents(this.notesText);\n    this.notesField.setHeight(100);\n\n    this.body.add(this.notesField);\n};\n\nLibraryImportDialogMorph.prototype.installLibrariesList = function () {\n    if (this.listField) {this.listField.destroy(); }\n\n    this.listField = new ListMorph(\n        this.librariesData,\n        element => element.name,\n        null,\n        () => this.importLibrary(),\n        '~' // separator\n    );\n\n    this.fixListFieldItemColors();\n\n    this.listField.fixLayout = nop;\n    this.listField.edge = InputFieldMorph.prototype.edge;\n    this.listField.fontSize = InputFieldMorph.prototype.fontSize;\n    this.listField.typeInPadding = InputFieldMorph.prototype.typeInPadding;\n    this.listField.contrast = InputFieldMorph.prototype.contrast;\n    this.listField.render = InputFieldMorph.prototype.render;\n    this.listField.drawRectBorder = InputFieldMorph.prototype.drawRectBorder;\n\n    this.listField.action = (item) => {\n        if (isNil(item)) {return; }\n\n        this.notesText.text = localize(item.description || '');\n        this.notesText.rerender();\n        this.notesField.contents.adjustBounds();\n\n        if (this.hasCached(item.fileName)) {\n            this.displayBlocks(item.fileName);\n        } else {\n            this.showMessage(localize('Loading') + '\\n' + localize(item.name));\n            this.ide.getURL(\n                this.ide.resourceURL('libraries', item.fileName),\n                libraryXML => {\n                    this.cacheLibrary(\n                        item.fileName,\n                        this.ide.serializer.loadBlocks(libraryXML)\n                    );\n                    this.displayBlocks(item.fileName);\n                }\n            );\n        }\n\n\n    };\n\n    this.listField.setWidth(200);\n    this.body.add(this.listField);\n\n    this.fixLayout();\n};\n\nLibraryImportDialogMorph.prototype.popUp = function () {\n    var world = this.ide.world();\n    if (world) {\n        LibraryImportDialogMorph.uber.popUp.call(this, world);\n        this.handle = new HandleMorph(\n            this,\n            300,\n            300,\n            this.corner,\n            this.corner\n        );\n    }\n};\n\nLibraryImportDialogMorph.prototype.fixListFieldItemColors =\n    ProjectDialogMorph.prototype.fixListFieldItemColors;\n\nLibraryImportDialogMorph.prototype.clearDetails =\n    ProjectDialogMorph.prototype.clearDetails;\n\nLibraryImportDialogMorph.prototype.fixLayout = function () {\n    var titleHeight = fontHeight(this.titleFontSize) + this.titlePadding * 2,\n        thin = this.padding / 2;\n\n    if (this.body) {\n        this.body.setPosition(this.position().add(new Point(\n            this.padding,\n            titleHeight + this.padding\n        )));\n        this.body.setExtent(new Point(\n            this.width() - this.padding * 2,\n            this.height()\n                - this.padding * 3 // top, bottom and button padding.\n                - titleHeight\n                - this.buttons.height()\n        ));\n\n        this.listField.setExtent(new Point(\n            200,\n            this.body.height()\n        ));\n        this.notesField.setExtent(new Point(\n            this.body.width() - this.listField.width() - thin,\n            100\n        ));\n        this.palette.setExtent(new Point(\n            this.notesField.width(),\n            this.body.height() - this.notesField.height() - thin\n        ));\n        this.listField.contents.children[0].adjustWidths();\n\n        this.listField.setPosition(this.body.position());\n        this.palette.setPosition(this.listField.topRight().add(\n            new Point(thin, 0)\n        ));\n        this.notesField.setPosition(this.palette.bottomLeft().add(\n            new Point(0, thin)\n        ));\n    }\n\n    if (this.label) {\n        this.label.setCenter(this.center());\n        this.label.setTop(\n            this.top() + (titleHeight - this.label.height()) / 2\n        );\n    }\n\n    if (this.buttons) {\n        this.buttons.fixLayout();\n        this.buttons.setCenter(this.center());\n        this.buttons.setBottom(this.bottom() - this.padding);\n    }\n\n    // refresh shadow\n    this.removeShadow();\n    this.addShadow();\n};\n\n// Library Cache Utilities.\nLibraryImportDialogMorph.prototype.hasCached = function (key) {\n    return this.libraryCache.hasOwnProperty(key);\n};\n\nLibraryImportDialogMorph.prototype.cacheLibrary = function (key, blocks) {\n    this.libraryCache[key] = blocks ;\n};\n\nLibraryImportDialogMorph.prototype.cachedLibrary = function (key) {\n    return this.libraryCache[key];\n};\n\nLibraryImportDialogMorph.prototype.importLibrary = function () {\n    if (!this.listField.selected) {return; }\n\n    var blocks,\n        ide = this.ide,\n        selectedLibrary = this.listField.selected.fileName,\n        libraryName = this.listField.selected.name;\n\n    if (this.hasCached(selectedLibrary)) {\n        blocks = this.cachedLibrary(selectedLibrary);\n        blocks.forEach(def => {\n            def.receiver = ide.stage;\n            ide.stage.globalBlocks.push(def);\n            ide.stage.replaceDoubleDefinitionsFor(def);\n        });\n        ide.showMessage(localize('Imported') + ' ' + localize(libraryName), 2);\n    } else {\n        ide.showMessage(localize('Loading') + ' ' + localize(libraryName));\n        ide.getURL(\n            ide.resourceURL('libraries', selectedLibrary),\n            function(libraryText) {\n                ide.droppedText(libraryText, libraryName);\n            }\n        );\n    }\n};\n\nLibraryImportDialogMorph.prototype.displayBlocks = function (libraryKey) {\n    var x, y, blockImage, previousCategory, blockContainer,\n        padding = 4,\n        blocksList = this.cachedLibrary(libraryKey);\n\n    if (!blocksList.length) {return; }\n    // populate palette, grouped by categories.\n    this.initializePalette();\n    x = this.palette.left() + padding;\n    y = this.palette.top();\n\n    SpriteMorph.prototype.categories.forEach(category => {\n        blocksList.forEach(definition => {\n            if (definition.category !== category) {return; }\n            if (category !== previousCategory) {\n                y += padding;\n            }\n            previousCategory = category;\n\n            blockImage = definition.templateInstance().fullImage();\n            blockContainer = new Morph();\n            blockContainer.isCachingImage = true;\n            blockContainer.bounds.setWidth(blockImage.width);\n            blockContainer.bounds.setHeight(blockImage.height);\n            blockContainer.cachedImage = blockImage;\n            blockContainer.setPosition(new Point(x, y));\n            this.palette.addContents(blockContainer);\n\n            y += blockContainer.fullBounds().height() + padding;\n        });\n    });\n\n    this.palette.scrollX(padding);\n    this.palette.scrollY(padding);\n    this.fixLayout();\n};\n\nLibraryImportDialogMorph.prototype.showMessage = function (msgText) {\n    var msg = new MenuMorph(null, msgText);\n    this.initializePalette();\n    this.fixLayout();\n    msg.popUpCenteredInWorld(this.palette.contents);\n};\n\n\n\nSpriteMorph.prototype.makeBlock = function () {\n  // prompt the user to make a new block\n  var ide = this.parentThatIsA(IDE_Morph),\n    stage = this.parentThatIsA(StageMorph),\n    category = ide.currentCategory,\n    clr = SpriteMorph.prototype.blockColor[category],\n    dlg;\n  dlg = new BlockDialogMorph(\n    null,\n    definition => {\n      if (definition.spec !== '') {\n        if (definition.isGlobal) {\n          stage.globalBlocks.push(definition);\n        } else {\n          this.customBlocks.push(definition);\n        }\n        ide.flushPaletteCache();\n        ide.refreshPalette();\n        new BlockEditorMorph(definition, this).popUp();\n      }\n    },\n    this\n  );\n  if (category !== 'variables') {\n    dlg.category = category;\n    dlg.categories.children.forEach(each => each.refresh());\n    dlg.types.children.forEach(each => {\n      each.setColor(clr);\n      each.refresh();\n    });\n  }\n  dlg.prompt(\n    'Make a block',\n    null,\n    this.world()\n  );\n};\nCustomCommandBlockMorph.prototype.isInUse = function () {\n  // answer true if an instance of my definition is found\n  // in any of my receiver's scripts or block definitions\n  // NOTE: for sprite-local blocks only to be used in a situation\n  // where the user actively clicks on a block in the IDE,\n  // e.g. to edit it (and change its type)\n  var def = this.definition,\n    rcvr = this.scriptTarget(),\n    ide = rcvr.parentThatIsA(IDE_Morph);\n  if (def.isGlobal && ide) {\n    return ide.sprites.asArray().concat([ide.stage]).some((any, idx) =>\n      any.usesBlockInstance(def, false, idx)\n    );\n  }\n  return rcvr.allDependentInvocationsOf(this.blockSpec).length > 0;\n};\n\n\nCustomCommandBlockMorph.prototype.userMenu = function () {\n  var hat = this.parentThatIsA(PrototypeHatBlockMorph),\n    rcvr = this.scriptTarget(),\n    myself = this,\n    // shiftClicked = this.world().currentKey === 16,\n    menu;\n\n  function addOption(label, toggle, test, onHint, offHint) {\n    var on = '\\u2611 ',\n      off = '\\u2610 ';\n    menu.addItem(\n      (test ? on : off) + localize(label),\n      toggle,\n      test ? onHint : offHint\n    );\n  }\n\n  function monitor(vName) {\n    var stage = rcvr.parentThatIsA(StageMorph),\n      varFrame = myself.variables;\n    menu.addItem(\n      vName + '...',\n      function () {\n        var watcher = detect(\n          stage.children,\n          function (morph) {\n            return morph instanceof WatcherMorph\n              && morph.target === varFrame\n              && morph.getter === vName;\n          }\n          ),\n          others;\n        if (watcher !== null) {\n          watcher.show();\n          watcher.fixLayout(); // re-hide hidden parts\n          return;\n        }\n        watcher = new WatcherMorph(\n          vName + ' ' + localize('(temporary)'),\n          SpriteMorph.prototype.blockColor.variables,\n          varFrame,\n          vName\n        );\n        watcher.setPosition(stage.position().add(10));\n        others = stage.watchers(watcher.left());\n        if (others.length > 0) {\n          watcher.setTop(others[others.length - 1].bottom());\n        }\n        stage.add(watcher);\n        watcher.fixLayout();\n      }\n    );\n  }\n\n  if (this.isPrototype) {\n    menu = new MenuMorph(this);\n    menu.addItem(\n      \"script pic...\",\n      function () {\n        var ide = this.world().children[0];\n        ide.saveCanvasAs(\n          this.topBlock().scriptPic(),\n          (ide.projectName || localize('untitled')) + ' ' +\n          localize('script pic')\n        );\n      },\n      'open a new window\\nwith a picture of this script'\n    );\n    menu.addItem(\n      \"translations...\",\n      function () {\n        hat.parentThatIsA(BlockEditorMorph).editTranslations();\n      },\n      'experimental -\\nunder construction'\n    );\n    if (this.isGlobal) {\n      if (hat.inputs().length < 2) {\n        menu.addItem(\n          \"block variables...\",\n          function () {\n            hat.enableBlockVars();\n          },\n          'experimental -\\nunder construction'\n        );\n      } else {\n        menu.addItem(\n          \"remove block variables...\",\n          function () {\n            hat.enableBlockVars(false);\n          },\n          'experimental -\\nunder construction'\n        );\n      }\n    }\n  } else {\n    menu = this.constructor.uber.userMenu.call(this);\n    if (!menu) {\n      menu = new MenuMorph(this);\n    } else {\n      menu.addLine();\n    }\n    if (this.isTemplate) { // inside the palette\n      if (this.isGlobal) {\n        menu.addItem(\n          \"delete block definition...\",\n          'deleteBlockDefinition'\n        );\n      } else { // local method\n        if (contains(\n          Object.keys(rcvr.inheritedBlocks()),\n          this.blockSpec\n        )) {\n          // inherited\n          addOption(\n            'inherited',\n            function () {\n              var ide = myself.parentThatIsA(IDE_Morph);\n              rcvr.customBlocks.push(\n                rcvr.getMethod(\n                  myself.blockSpec\n                ).copyAndBindTo(rcvr)\n              );\n              if (ide) {\n                ide.flushPaletteCache();\n                ide.refreshPalette();\n              }\n            },\n            true,\n            'uncheck to\\ndisinherit',\n            null\n          );\n        } else if (rcvr.exemplar &&\n          rcvr.exemplar.getMethod(this.blockSpec\n          )) {\n          // shadowed\n          addOption(\n            'inherited',\n            'deleteBlockDefinition',\n            false,\n            null,\n            localize('check to inherit\\nfrom')\n            + ' ' + rcvr.exemplar.name\n          );\n        } else {\n          // own block\n          menu.addItem(\n            \"delete block definition...\",\n            'deleteBlockDefinition'\n          );\n        }\n      }\n      menu.addItem(\n        \"duplicate block definition...\",\n        'duplicateBlockDefinition'\n      );\n      if (this.isGlobal) {\n        menu.addItem(\n          \"export block definition...\",\n          'exportBlockDefinition',\n          'including dependencies'\n        );\n      }\n    } else { // inside a script\n      // if global or own method - let the user delete the definition\n      if (this.isGlobal ||\n        contains(\n          Object.keys(rcvr.ownBlocks()),\n          this.blockSpec\n        )\n      ) {\n        menu.addItem(\n          \"delete block definition...\",\n          'deleteBlockDefinition'\n        );\n      }\n    }\n\n    this.variables.names().forEach(vName =>\n      monitor(vName)\n    );\n  }\n  menu.addItem(\"edit...\", 'edit'); // works also for prototypes\n  return menu;\n};\n\nCustomCommandBlockMorph.prototype.exportBlockDefinition = function () {\n  var ide = this.parentThatIsA(IDE_Morph);\n  new BlockExportDialogMorph(\n    ide.serializer,\n    [this.definition].concat(this.definition.collectDependencies())\n  ).popUp(this.world());\n};\n\n\nCustomCommandBlockMorph.prototype.duplicateBlockDefinition = function () {\n  var rcvr = this.scriptTarget(),\n    ide = this.parentThatIsA(IDE_Morph),\n    def = this.isGlobal ? this.definition : rcvr.getMethod(this.blockSpec),\n    dup = def.copyAndBindTo(rcvr),\n    spec = dup.spec,\n    count = 1;\n\n  if (this.isGlobal) {\n    ide.stage.globalBlocks.push(dup);\n  } else {\n    rcvr.customBlocks.push(dup);\n  }\n\n  // find a unique spec\n  while (rcvr.doubleDefinitionsFor(dup).length > 0) {\n    count += 1;\n    dup.spec = spec + ' (' + count + ')';\n  }\n\n  ide.flushPaletteCache();\n  ide.refreshPalette();\n  new BlockEditorMorph(dup, rcvr).popUp();\n};\n\n\n\nCustomCommandBlockMorph.prototype.deleteBlockDefinition = function () {\n  var idx, stage, ide, method, block,\n    rcvr = this.scriptTarget();\n  if (this.isPrototype) {\n    return null; // under construction...\n  }\n  method = this.isGlobal? this.definition\n    : rcvr.getLocalMethod(this.blockSpec);\n  block = method.blockInstance();\n  new DialogBoxMorph(\n    this,\n    () => {\n      // Trace.log('IDE.deleteCustomBlock', this.definition ? {\n      //     'spec': this.definition.spec,\n      //     'category': this.definition.category,\n      //     'type': this.definition.type,\n      //     'guid': this.definition.guid,\n      // } : null);\n      rcvr.deleteAllBlockInstances(method);\n      if (method.isGlobal) {\n        stage = rcvr.parentThatIsA(StageMorph);\n        idx = stage.globalBlocks.indexOf(method);\n        if (idx !== -1) {\n          stage.globalBlocks.splice(idx, 1);\n        }\n      } else {\n        // delete local definition\n        idx = rcvr.customBlocks.indexOf(method);\n        if (idx !== -1) {\n          rcvr.customBlocks.splice(idx, 1);\n        }\n        // refresh instances of inherited method, if any\n        method = rcvr.getMethod(this.blockSpec);\n        if (method) {\n          rcvr.allDependentInvocationsOf(this.blockSpec).forEach(\n            block => block.refresh(method)\n          );\n        }\n      }\n      ide = rcvr.parentThatIsA(IDE_Morph);\n      if (ide) {\n        ide.flushPaletteCache();\n        ide.refreshPalette();\n      }\n    },\n    this\n  ).askYesNo(\n    'Delete Custom Block',\n    localize('block deletion dialog text'), // long string lookup\n    this.world(),\n    block.doWithAlpha(\n      1,\n      () => {\n        block.addShadow();\n        return block.fullImage();\n      }\n    )\n  );\n};\n\nBlockDialogMorph.prototype.addCategoryButton = function (category) {\n  var labelWidth = 75,\n    colors = [\n      IDE_Morph.prototype.frameColor,\n      IDE_Morph.prototype.frameColor.darker(MorphicPreferences.isFlat ? 5 : 50),\n      SpriteMorph.prototype.blockColor[category]\n    ],\n    button;\n\n  button = new ToggleButtonMorph(\n    colors,\n    this, // this block dialog box is the target\n    () => {\n      this.category = category;\n      this.categories.children.forEach(each =>\n        each.refresh()\n      );\n      if (this.types) {\n        this.types.children.forEach(each =>\n          each.setColor(colors[2])\n        );\n      }\n      this.edit();\n    },\n    category[0].toUpperCase().concat(category.slice(1)), // UCase label\n    () => this.category === category, // query\n    null, // env\n    null, // hint\n    labelWidth, // minWidth\n    true // has preview\n  );\n\n  button.corner = 8;\n  button.padding = 0;\n  button.labelShadowOffset = new Point(-1, -1);\n  button.labelShadowColor = colors[1];\n  button.labelColor = IDE_Morph.prototype.buttonLabelColor;\n  if (MorphicPreferences.isFlat) {\n    button.labelPressColor = WHITE;\n  }\n  button.contrast = this.buttonContrast;\n  button.fixLayout();\n  button.refresh();\n  this.categories.add(button);\n  return button;\n};\n\n\n\nBlockEditorMorph.prototype = new DialogBoxMorph();\nBlockEditorMorph.prototype.constructor = BlockEditorMorph;\nBlockEditorMorph.uber = DialogBoxMorph.prototype;\n\n// Keep track of the currently showing block editors\nBlockEditorMorph.showing = [];\n\n// BlockEditorMorph instance creation:\n\nexport function BlockEditorMorph(definition, target) {\n  this.init(definition, target);\n}\n\nBlockEditorMorph.prototype.ok = function() {\n  // Trace.log('BlockEditor.ok', this.getDefinitionJSON());\n  BlockEditorMorph.uber.ok.apply(this, arguments);\n};\n\nBlockEditorMorph.prototype.destroy = function() {\n  BlockEditorMorph.uber.destroy.apply(this, arguments);\n  var index = BlockEditorMorph.showing.indexOf(this);\n  if (index >= 0) {\n    BlockEditorMorph.showing.splice(index, 1);\n  }\n};\n\nBlockEditorMorph.defaultHatBlockMargin = new Point(10, 10);\n\nBlockEditorMorph.prototype.getDefinitionJSON = function() {\n  var definition = this.definition;\n  return definition ? {\n    'spec': definition.spec,\n    'category': definition.category,\n    'type': definition.type,\n    'guid': definition.guid,\n  } : null;\n};\n\nBlockEditorMorph.prototype.init = function (definition, target) {\n  var scripts, proto, scriptsFrame, block, comment,\n    isLive = Process.prototype.enableLiveCoding ||\n      Process.prototype.enableSingleStepping;\n\n  // additional properties:\n  this.definition = definition;\n  this.translations = definition.translationsAsText();\n  this.handle = null;\n\n  // Trace.log('BlockEditor.start', this.getDefinitionJSON());\n\n  // initialize inherited properties:\n  BlockEditorMorph.uber.init.call(\n    this,\n    target,\n    () => this.updateDefinition(),\n    target\n  );\n\n  // override inherited properites:\n  this.key = 'editBlock' + definition.spec;\n  this.labelString = this.definition.isGlobal ? 'Block Editor'\n    : 'Method Editor';\n  this.createLabel();\n\n  // Copy IDs when copying blocks, rather than making new block IDs\n  // as we would do for duplicating a block\n  BlockMorph.copyIDs = true;\n\n  // create scripting area\n  scripts = new ScriptsMorph();\n  scripts.rejectsHats = true;\n  scripts.isDraggable = false;\n  scripts.color = IDE_Morph.prototype.groupColor;\n  scripts.cachedTexture = IDE_Morph.prototype.scriptsPaneTexture;\n  scripts.cleanUpMargin = 10;\n\n  proto = new PrototypeHatBlockMorph(this.definition);\n  proto.setPosition(scripts.position().add(\n    BlockEditorMorph.defaultHatBlockMargin));\n  if (definition.comment !== null) {\n    comment = definition.comment.fullCopy();\n    proto.comment = comment;\n    comment.block = proto;\n  }\n  if (definition.body !== null) {\n    proto.nextBlock(isLive ? definition.body.expression\n      : definition.body.expression.fullCopy()\n    );\n  }\n  scripts.add(proto);\n  proto.fixBlockColor(null, true);\n\n  this.definition.scripts.forEach(element => {\n    block = element.fullCopy();\n    block.setPosition(scripts.position().add(element.position()));\n    scripts.add(block);\n    if (block instanceof BlockMorph) {\n      block.allComments().forEach(comment =>\n        comment.align(block)\n      );\n    }\n  });\n  proto.allComments().forEach(comment =>\n    comment.align(proto)\n  );\n\n  // Make sure to disable block ID copying\n  BlockMorph.copyIDs = false;\n\n  scriptsFrame = new ScrollFrameMorph(scripts);\n  scriptsFrame.padding = 10;\n  scriptsFrame.growth = 50;\n  scriptsFrame.isDraggable = false;\n  scriptsFrame.acceptsDrops = false;\n  scriptsFrame.contents.acceptsDrops = true;\n  scripts.scrollFrame = scriptsFrame;\n  scripts.updateToolbar();\n\n  this.addBody(scriptsFrame);\n  this.addButton('ok', 'OK');\n  if (!isLive) {\n    this.addButton('updateDefinition', 'Apply');\n    this.addButton('cancel', 'Cancel');\n  }\n\n  this.setExtent(new Point(400, 350).add(\n    BlockEditorMorph.defaultHatBlockMargin)); // normal initial extent\n  this.fixLayout();\n  scripts.fixMultiArgs();\n\n  block = proto.parts()[0];\n  block.forceNormalColoring();\n  block.fixBlockColor(proto, true);\n};\n\nBlockEditorMorph.prototype.popUp = function () {\n  var world = this.target.world();\n\n  // Add this to the list of showing blockEditorMorphs\n  BlockEditorMorph.showing.push(this);\n\n  if (world) {\n    BlockEditorMorph.uber.popUp.call(this, world);\n    this.setInitialDimensions();\n    this.handle = new HandleMorph(\n      this,\n      280,\n      220,\n      this.corner,\n      this.corner\n    );\n    world.keyboardFocus = null;\n  }\n};\n\nBlockEditorMorph.prototype.justDropped = function () {\n  // override the inherited default behavior, which is to\n  // give keyboard focus to dialog boxes, as in this case\n  // we want Snap-global keyboard-shortcuts like ctrl-f\n  // to still work\n  nop();\n};\n\n// BlockEditorMorph ops\n\nBlockEditorMorph.prototype.accept = function (origin) {\n  // check DialogBoxMorph comment for accept()\n  if (origin instanceof CursorMorph) {return; }\n  if (this.action) {\n    if (typeof this.target === 'function') {\n      if (typeof this.action === 'function') {\n        this.target.call(this.environment, this.action.call());\n      } else {\n        this.target.call(this.environment, this.action);\n      }\n    } else {\n      if (typeof this.action === 'function') {\n        this.action.call(this.target, this.getInput());\n      } else { // assume it's a String\n        this.target[this.action](this.getInput());\n      }\n    }\n  }\n  this.close();\n};\n\nBlockEditorMorph.prototype.cancel = function (origin) {\n  if (origin instanceof CursorMorph) {return; }\n  // Trace.log('BlockEditor.cancel', this.getDefinitionJSON());\n  //this.refreshAllBlockInstances();\n  this.close();\n};\n\nBlockEditorMorph.prototype.close = function () {\n  var doubles, block;\n\n  // assert that no scope conflicts exists, i.e. that a global\n  // definition doesn't contain any local custom blocks, as they\n  // will be rendered \"Obsolete!\" when reloading the project\n  if (this.definition.isGlobal) {\n    block = detect(\n      this.body.contents.allChildren(),\n      morph => morph.isCustomBlock && !morph.isGlobal\n    );\n    if (block) {\n      block = block.scriptTarget()\n        .getMethod(block.semanticSpec)\n        .blockInstance();\n      block.addShadow();\n      new DialogBoxMorph().inform(\n        'Local Block(s) in Global Definition',\n        'This global block definition contains one or more\\n'\n        + 'local custom blocks which must be removed first.',\n        this.world(),\n        block.doWithAlpha(1, () => block.fullImage())\n      );\n      return;\n    }\n  }\n\n  // allow me to disappear only when name collisions\n  // have been resolved\n  doubles = this.target.doubleDefinitionsFor(this.definition);\n  if (doubles.length > 0) {\n    block = doubles[0].blockInstance();\n    block.addShadow();\n    new DialogBoxMorph(this, 'consolidateDoubles', this).askYesNo(\n      'Same Named Blocks',\n      'Another custom block with this name exists.\\n'\n      + 'Would you like to replace it?',\n      this.world(),\n      block.doWithAlpha(1, () => block.fullImage())\n    );\n    return;\n  }\n\n  this.destroy();\n  this.deduplicateBlockIDs();\n};\n\nBlockEditorMorph.prototype.consolidateDoubles = function () {\n  this.target.replaceDoubleDefinitionsFor(this.definition);\n  this.deduplicateBlockIDs();\n  this.destroy();\n};\n\nBlockEditorMorph.prototype.refreshAllBlockInstances = function (oldSpec) {\n  var def = this.definition,\n    template = this.target.paletteBlockInstance(def);\n\n  if (this.definition.isGlobal) {\n    this.target.allBlockInstances(this.definition).reverse().forEach(\n      block => block.refresh()\n    );\n  } else {\n    this.target.allDependentInvocationsOf(oldSpec).reverse().forEach(\n      block => block.refresh(def)\n    );\n  }\n  if (template) {\n    template.refreshDefaults();\n  }\n};\n\n// It is possible for blocks to get duplicated by dragging them out of a block\n// editor and then cancelling the edit. This checks for any duplicate block IDs\n// in the just-closed block definition and then assigns new IDs to those blocks.\nBlockEditorMorph.prototype.deduplicateBlockIDs = function() {\n  var definition = this.definition;\n  function findBlockIDs(root, array) {\n    array = array || [];\n    // Ignore any children of this definition\n    if (root == definition || root == null) return array;\n    if (root instanceof BlockMorph) array.push(root.id);\n    // Include custom block definitions in Sprites and the Stage\n    if (root instanceof SpriteMorph) findBlockIDs(root.customBlocks);\n    if (root instanceof StageMorph) findBlockIDs(root.globalBlocks);\n    var children = root.children || root;\n    if (!(children instanceof Array)) return array;\n    children.forEach(function(child) {\n      if (child instanceof Morph) {\n        findBlockIDs(child, array);\n      }\n    });\n    return array;\n  }\n  var blockIDs = findBlockIDs(this.root());\n\n  var scripts = definition.scripts.slice();\n  if (this.definition.body) scripts.push(this.definition.body.expression);\n  scripts.forEach(function(script) {\n    if (script == null || !script.allChildren) return;\n    script.allChildren().forEach(function(block) {\n      if (!(block instanceof BlockMorph)) return;\n      if (blockIDs.includes(block.id)) block.getNewID();\n    });\n  });\n};\n\nBlockEditorMorph.prototype.updateDefinition = function () {\n  // Trace.log('BlockEditor.apply', this.getDefinitionJSON());\n  var oldSpec = this.definition.blockSpec();\n  this.applyToDefinition(this.definition);\n  this.refreshAllBlockInstances(oldSpec);\n  ide = this.target.parentThatIsA(IDE_Morph);\n  ide.flushPaletteCache();\n  ide.refreshPalette();\n};\n\n// We want to be able to apply the edits represented in this editor to an\n// arbitrary block definition (e.g. a copy of the original), mainly for\n// logging purposes.\nBlockEditorMorph.prototype.applyToDefinition = function (definition) {\n  var head,\n    pos = this.body.contents.position(),\n    count = 1,\n    element;\n\n  // Copy IDs when copying blocks, rather than making new block IDs\n  // as we would do for duplicating a block\n  BlockMorph.copyIDs = true;\n\n  definition.receiver = this.target; // only for serialization\n  definition.spec = this.prototypeSpec();\n  definition.declarations = this.prototypeSlots();\n  definition.variableNames = this.variableNames();\n  definition.scripts = [];\n  definition.updateTranslations(this.translations);\n  definition.cachedTranslation = null;\n  definition.editorDimensions = this.bounds.copy();\n  definition.cachedIsRecursive = null; // flush the cache, don't update\n\n  this.body.contents.children.forEach(morph => {\n    if (morph instanceof PrototypeHatBlockMorph) {\n      head = morph;\n    } else if (morph instanceof BlockMorph ||\n      (morph instanceof CommentMorph && !morph.block)) {\n      element = morph.fullCopy();\n      element.parent = null;\n      element.setPosition(morph.position().subtract(pos));\n      definition.scripts.push(element);\n    }\n  });\n\n  if (head) {\n    if (definition.category !== head.blockCategory) {\n      this.target.shadowAttribute('scripts');\n    }\n    definition.category = head.blockCategory;\n    definition.type = head.type;\n    if (head.comment) {\n      definition.comment = head.comment.fullCopy();\n      definition.comment.block = true; // serialize in short form\n    } else {\n      definition.comment = null;\n    }\n  }\n\n  definition.body = this.context(head);\n\n  // Make sure to turn copying IDs off when finished\n  BlockMorph.copyIDs = false;\n\n  // make sure the spec is unique\n  while (this.target.doubleDefinitionsFor(this.definition).length > 0) {\n    count += 1;\n    this.definition.spec = this.definition.spec + ' (' + count + ')';\n  }\n};\n\nBlockEditorMorph.prototype.context = function (prototypeHat) {\n  // answer my script reified for deferred execution\n  // if no prototypeHat is given, my body is scanned\n  var head, topBlock, stackFrame;\n\n  head = prototypeHat || detect(\n    this.body.contents.children,\n    c => c instanceof PrototypeHatBlockMorph\n  );\n  topBlock = head.nextBlock();\n  if (topBlock === null) {\n    return null;\n  }\n  topBlock.allChildren().forEach(c => {\n    if (c instanceof BlockMorph) {c.cachedInputs = null; }\n  });\n  stackFrame = Process.prototype.reify.call(\n    null,\n    topBlock,\n    new List(this.definition.inputNames()),\n    true // ignore empty slots for custom block reification\n  );\n  stackFrame.outerContext = null;\n  return stackFrame;\n};\n\nBlockEditorMorph.prototype.prototypeSpec = function () {\n  // answer the spec represented by my (edited) block prototype\n  return detect(\n    this.body.contents.children,\n    c => c instanceof PrototypeHatBlockMorph\n  ).parts()[0].specFromFragments();\n};\n\nBlockEditorMorph.prototype.prototypeSlots = function () {\n  // answer the slot declarations from my (edited) block prototype\n  return detect(\n    this.body.contents.children,\n    c => c instanceof PrototypeHatBlockMorph\n  ).parts()[0].declarationsFromFragments();\n};\n\nBlockEditorMorph.prototype.variableNames = function () {\n  // answer the variable declarations from my prototype hat\n  return detect(\n    this.body.contents.children,\n    c => c instanceof PrototypeHatBlockMorph\n  ).variableNames();\n};\n\n// BlockEditorMorph translation\n\nBlockEditorMorph.prototype.editTranslations = function () {\n  var block = this.definition.blockInstance();\n  block.addShadow(new Point(3, 3));\n  new DialogBoxMorph(\n    this,\n    text => this.translations = text,\n    this\n  ).promptCode(\n    'Custom Block Translations',\n    this.translations,\n    this.world(),\n    block.doWithAlpha(1, () => block.fullImage()),\n    this.definition.abstractBlockSpec() +\n    '\\n\\n' +\n    localize('Enter one translation per line. ' +\n      'use colon (\":\") as lang/spec delimiter\\n' +\n      'and underscore (\"_\") as placeholder for an input, ' +\n      'e.g.:\\n\\nen:say _ for _ secs')\n  );\n};\n\n// BlockEditorMorph layout\n\nBlockEditorMorph.prototype.setInitialDimensions = function () {\n  var world = this.world(),\n    mex = world.extent().subtract(new Point(this.padding, this.padding)),\n    th = fontHeight(this.titleFontSize) + this.titlePadding * 2,\n    bh = this.buttons.height();\n\n  if (this.definition.editorDimensions) {\n    this.setPosition(this.definition.editorDimensions.origin);\n    this.setExtent(this.definition.editorDimensions.extent().min(mex));\n    this.keepWithin(world);\n    return;\n  }\n  this.setExtent(\n    this.body.contents.extent().add(\n      new Point(this.padding, this.padding + th + bh)\n    ).min(mex)\n  );\n  this.setCenter(this.world().center());\n};\n\nBlockEditorMorph.prototype.fixLayout = function () {\n  var th = fontHeight(this.titleFontSize) + this.titlePadding * 2;\n\n  if (this.buttons && (this.buttons.children.length > 0)) {\n    this.buttons.fixLayout();\n  }\n\n  if (this.body) {\n    this.body.setPosition(this.position().add(new Point(\n      this.padding,\n      th + this.padding\n    )));\n    this.body.setExtent(new Point(\n      this.width() - this.padding * 2,\n      this.height() - this.padding * 3 - th - this.buttons.height()\n    ));\n  }\n\n  if (this.label) {\n    this.label.setCenter(this.center());\n    this.label.setTop(this.top() + (th - this.label.height()) / 2);\n  }\n\n  if (this.buttons && (this.buttons.children.length > 0)) {\n    this.buttons.setCenter(this.center());\n    this.buttons.setBottom(this.bottom() - this.padding);\n  }\n\n  // refresh a shallow shadow\n  this.removeShadow();\n  this.addShadow();\n};\n\n\nCustomCommandBlockMorph.prototype.edit = function () {\n  var def = this.definition,\n    editor, block,\n    hat,\n    rcvr;\n\n  if (this.isPrototype) {\n    block = this.definition.blockInstance();\n    block.addShadow();\n    hat = this.parentThatIsA(PrototypeHatBlockMorph);\n    new BlockDialogMorph(\n      null,\n      (definition) => {\n        if (definition) { // temporarily update everything\n          // Trace.log('BlockEditor.changeType', this.getDefinitionID());\n          hat.blockCategory = definition.category;\n          hat.type = definition.type;\n          this.refreshPrototype();\n        }\n      },\n      this\n    ).openForChange(\n      'Change block',\n      hat.blockCategory,\n      hat.type,\n      this.world(),\n      block.doWithAlpha(1, () => block.fullImage()),\n      this.isInUse()\n    );\n  } else {\n    // check for local custom block inheritance\n    rcvr = this.scriptTarget();\n    if (!this.isGlobal) {\n      if (contains(\n        Object.keys(rcvr.inheritedBlocks()),\n        this.blockSpec\n      )\n      ) {\n        this.duplicateBlockDefinition();\n        return;\n      }\n      def = rcvr.getMethod(this.semanticSpec);\n    }\n    editor = new BlockEditorMorph(def, rcvr);\n    editor.popUp();\n    editor.changed();\n  }\n};\n\n\nBlockExportDialogMorph.prototype.fixLayout\n  = BlockEditorMorph.prototype.fixLayout;\n\nBlockImportDialogMorph.prototype.fixLayout\n  = BlockEditorMorph.prototype.fixLayout;\n\nBlockRemovalDialogMorph.prototype.fixLayout\n  = BlockEditorMorph.prototype.fixLayout;\n\n\nBlockImportDialogMorph.prototype.importBlocks = function (name) {\n  var ide = this.target.parentThatIsA(IDE_Morph);\n  if (!ide) {return; }\n  if (this.blocks.length > 0) {\n    this.blocks.forEach(def => {\n      def.receiver = ide.stage;\n      ide.stage.globalBlocks.push(def);\n      ide.stage.replaceDoubleDefinitionsFor(def);\n    });\n    ide.flushPaletteCache();\n    ide.refreshPalette();\n    ide.showMessage(\n      'Imported Blocks Module' + (name ? ': ' + name : '') + '.',\n      2\n    );\n  } else {\n    new DialogBoxMorph().inform(\n      'Import blocks',\n      'no blocks were selected',\n      this.world()\n    );\n  }\n};\n\nTableDialogMorph.prototype.fixLayout =\n  BlockEditorMorph.prototype.fixLayout;\n\n\nSyntaxElementMorph.prototype.showBubble = function (value, exportPic, target) {\n  var bubble,\n    txt,\n    img,\n    morphToShow,\n    isClickable = false,\n    ide = this.parentThatIsA(IDE_Morph),\n    anchor = this,\n    pos = this.rightCenter().add(new Point(2, 0)),\n    sf = this.parentThatIsA(ScrollFrameMorph),\n    wrrld = this.world();\n\n  if ((value === undefined) || !wrrld) {\n    return null;\n  }\n  if (value instanceof ListWatcherMorph) {\n    morphToShow = value;\n    morphToShow.update(true);\n    morphToShow.step = value.update;\n    morphToShow.isDraggable = false;\n    morphToShow.expand(this.parentThatIsA(ScrollFrameMorph).extent());\n    isClickable = true;\n  } else if (value instanceof TableFrameMorph) {\n    morphToShow = value;\n    morphToShow.isDraggable = false;\n    morphToShow.expand(this.parentThatIsA(ScrollFrameMorph).extent());\n    isClickable = true;\n  } else if (value instanceof Morph) {\n    if (isSnapObject(value)) {\n      img = value.thumbnail(new Point(40, 40));\n      morphToShow = new Morph();\n      morphToShow.isCachingImage = true;\n      morphToShow.bounds.setWidth(img.width);\n      morphToShow.bounds.setHeight(img.height);\n      morphToShow.cachedImage = img;\n      morphToShow.version = value.version;\n      morphToShow.step = function () {\n        if (this.version !== value.version) {\n          img = value.thumbnail(new Point(40, 40));\n          this.cachedImage = img;\n          this.version = value.version;\n          this.changed();\n        }\n      };\n    } else {\n      img = value.fullImage();\n      morphToShow = new Morph();\n      morphToShow.isCachingImage = true;\n      morphToShow.bounds.setWidth(img.width);\n      morphToShow.bounds.setHeight(img.height);\n      morphToShow.cachedImage = img;\n    }\n  } else if (value instanceof Costume) {\n    img = value.thumbnail(new Point(40, 40));\n    morphToShow = new Morph();\n    morphToShow = new Morph();\n    morphToShow.isCachingImage = true;\n    morphToShow.bounds.setWidth(img.width);\n    morphToShow.bounds.setHeight(img.height);\n    morphToShow.cachedImage = img;\n  } else if (value instanceof Sound) {\n    morphToShow = new SymbolMorph('notes', 30);\n  } else if (value instanceof Context) {\n    img = value.image();\n    morphToShow = new Morph();\n    morphToShow.isCachingImage = true;\n    morphToShow.bounds.setWidth(img.width);\n    morphToShow.bounds.setHeight(img.height);\n    morphToShow.cachedImage = img;\n  } else if (typeof value === 'boolean') {\n    morphToShow = SpriteMorph.prototype.booleanMorph.call(\n      null,\n      value\n    );\n  } else if (isString(value)) {\n    txt  = value.length > 500 ? value.slice(0, 500) + '...' : value;\n    morphToShow = new TextMorph(\n      txt,\n      this.fontSize\n    );\n  } else if (value === null) {\n    morphToShow = new TextMorph(\n      '',\n      this.fontSize\n    );\n  } else if (value === 0) {\n    morphToShow = new TextMorph(\n      '0',\n      this.fontSize\n    );\n  } else if (value.toString) {\n    morphToShow = new TextMorph(\n      value.toString(),\n      this.fontSize\n    );\n  }\n  if (ide && (ide.currentSprite !== target)) {\n    if (target instanceof StageMorph) {\n      anchor = ide.corral.stageIcon;\n    } else if (target) {\n      if (target.isTemporary) {\n        target = detect(\n          target.allExemplars(),\n          each => !each.isTemporary\n        );\n      }\n      anchor = detect(\n        ide.corral.frame.contents.children,\n        icon => icon.object === target\n      );\n    } else {\n      target = ide;\n    }\n    pos = anchor.center();\n  }\n  bubble = new SpeechBubbleMorph(\n    morphToShow,\n    null,\n    Math.max(this.rounding - 2, 6),\n    0\n  );\n  bubble.popUp(\n    wrrld,\n    pos,\n    isClickable\n  );\n  if (exportPic) {\n    this.exportPictureWithResult(bubble);\n  }\n  if (anchor instanceof SpriteIconMorph) {\n    bubble.keepWithin(ide.corral);\n  } else if (sf) {\n    bubble.keepWithin(sf);\n  }\n};\n\n\nBlockMorph.prototype.userMenu = function () {\n  var menu = new MenuMorph(this),\n    world = this.world(),\n    myself = this,\n    hasLine = false,\n    shiftClicked = world.currentKey === 16,\n    proc = this.activeProcess(),\n    top = this.topBlock(),\n    vNames = proc && proc.context && proc.context.outerContext ?\n      proc.context.outerContext.variables.names() : [],\n    alternatives,\n    field,\n    rcvr;\n\n  function addOption(label, toggle, test, onHint, offHint) {\n    menu.addItem(\n      [\n        test ? new SymbolMorph(\n          'checkedBox',\n          MorphicPreferences.menuFontSize * 0.75\n        ) : new SymbolMorph(\n          'rectangle',\n          MorphicPreferences.menuFontSize * 0.75\n        ),\n        localize(label)\n      ],\n      toggle,\n      test ? onHint : offHint\n    );\n  }\n\n  function renameVar() {\n    var blck = myself.fullCopy();\n    blck.addShadow();\n    new DialogBoxMorph(\n      myself,\n      function(arg) {\n        // Trace.log('Block.rename', {\n        //     'id': myself.blockId(),\n        //     'name': arg,\n        // });\n        myself.userSetSpec(arg);\n      },\n      myself\n    ).prompt(\n      \"Variable name\",\n      myself.blockSpec,\n      world,\n      blck.doWithAlpha(1, () => blck.fullImage()), // pic\n      InputSlotMorph.prototype.getVarNamesDict.call(myself)\n    );\n  }\n\n  menu.addItem(\n    \"help...\",\n    'showHelp'\n  );\n  if (this.isTemplate) {\n    if (this.parent instanceof SyntaxElementMorph) { // in-line\n      if (this.selector === 'reportGetVar') { // script var definition\n        menu.addLine();\n        menu.addItem(\n          'rename...',\n          () => this.refactorThisVar(true), // just the template\n          'rename only\\nthis reporter'\n        );\n        menu.addItem(\n          'rename all...',\n          'refactorThisVar',\n          'rename all blocks that\\naccess this variable'\n        );\n      }\n    } else { // in palette\n      if (this.selector === 'reportGetVar') {\n        rcvr = this.scriptTarget();\n        if (this.isInheritedVariable(false)) { // fully inherited\n          addOption(\n            'inherited',\n            () => rcvr.toggleInheritedVariable(this.blockSpec),\n            true,\n            'uncheck to\\ndisinherit',\n            null\n          );\n        } else { // not inherited\n          if (this.isInheritedVariable(true)) { // shadowed\n            addOption(\n              'inherited',\n              () => rcvr.toggleInheritedVariable(\n                this.blockSpec\n              ),\n              false,\n              null,\n              localize('check to inherit\\nfrom')\n              + ' ' + rcvr.exemplar.name\n            );\n          }\n          addOption(\n            'transient',\n            'toggleTransientVariable',\n            this.isTransientVariable(),\n            'uncheck to save contents\\nin the project',\n            'check to prevent contents\\nfrom being saved'\n          );\n          menu.addLine();\n          menu.addItem(\n            'rename...',\n            () => this.refactorThisVar(true), // just the template\n            'rename only\\nthis reporter'\n          );\n          menu.addItem(\n            'rename all...',\n            'refactorThisVar',\n            'rename all blocks that\\naccess this variable'\n          );\n        }\n      } else if (this.selector !== 'evaluateCustomBlock') {\n        menu.addItem(\n          \"hide\",\n          'hidePrimitive'\n        );\n      }\n\n      // allow toggling inheritable attributes\n      if (StageMorph.prototype.enableInheritance) {\n        rcvr = this.scriptTarget();\n        field = {\n          xPosition: 'x position',\n          yPosition: 'y position',\n          direction: 'direction',\n          getScale: 'size',\n          getCostumeIdx: 'costume #',\n          getVolume: 'volume',\n          getPan: 'balance',\n          reportShown: 'shown?',\n          getPenDown: 'pen down?'\n        }[this.selector];\n        if (field && rcvr && rcvr.exemplar) {\n          menu.addLine();\n          addOption(\n            'inherited',\n            () => rcvr.toggleInheritanceForAttribute(field),\n            rcvr.inheritsAttribute(field),\n            'uncheck to\\ndisinherit',\n            localize('check to inherit\\nfrom')\n            + ' ' + rcvr.exemplar.name\n          );\n        }\n      }\n\n      if (StageMorph.prototype.enableCodeMapping) {\n        menu.addLine();\n        menu.addItem(\n          'header mapping...',\n          'mapToHeader'\n        );\n        menu.addItem(\n          'code mapping...',\n          'mapToCode'\n        );\n      }\n    }\n    return menu;\n  }\n  menu.addLine();\n  if (this.selector === 'reportGetVar') {\n    menu.addItem(\n      'rename...',\n      renameVar,\n      'rename only\\nthis reporter'\n    );\n  } else if (SpriteMorph.prototype.blockAlternatives[this.selector]) {\n    menu.addItem(\n      'relabel...',\n      () => this.relabel(\n        SpriteMorph.prototype.blockAlternatives[this.selector]\n      )\n    );\n  } else if (this.isCustomBlock && this.alternatives) {\n    alternatives = this.alternatives();\n    if (alternatives.length > 0) {\n      menu.addItem(\n        'relabel...',\n        () => this.relabel(alternatives)\n      );\n    }\n  }\n\n  // direct relabelling:\n  // - JIT-compile HOFs - experimental\n  // - vector pen trails\n  if (\n    contains(\n      ['reportMap', 'reportKeep', 'reportFindFirst', 'reportCombine'],\n      this.selector\n    )\n  ) {\n    alternatives = {\n      reportMap : 'reportAtomicMap',\n      reportKeep : 'reportAtomicKeep',\n      reportFindFirst: 'reportAtomicFindFirst',\n      reportCombine : 'reportAtomicCombine'\n    };\n    menu.addItem(\n      'compile',\n      () => this.setSelector(alternatives[this.selector]),\n      'experimental!\\nmake this reporter fast and uninterruptable\\n' +\n      'CAUTION: Errors in the ring\\ncan break your Snap! session!'\n    );\n  } else if (\n    contains(\n      [\n        'reportAtomicMap',\n        'reportAtomicKeep',\n        'reportAtomicFindFirst',\n        'reportAtomicCombine'\n      ],\n      this.selector\n    )\n  ) {\n    alternatives = {\n      reportAtomicMap : 'reportMap',\n      reportAtomicKeep : 'reportKeep',\n      reportAtomicFindFirst: 'reportFindFirst',\n      reportAtomicCombine : 'reportCombine'\n    };\n    menu.addItem(\n      'uncompile',\n      () => this.setSelector(alternatives[this.selector])\n    );\n  } else if (\n    contains(\n      ['reportPenTrailsAsCostume', 'reportPentrailsAsSVG'],\n      this.selector\n    )\n  ) {\n    alternatives = {\n      reportPenTrailsAsCostume : 'reportPentrailsAsSVG',\n      reportPentrailsAsSVG : 'reportPenTrailsAsCostume'\n    };\n    menu.addItem(\n      localize(\n        SpriteMorph.prototype.blocks[\n          alternatives[this.selector]\n          ].spec\n      ),\n      () => {\n        this.setSelector(alternatives[this.selector]);\n        this.changed();\n      }\n    );\n  }\n\n  menu.addItem(\n    \"duplicate\",\n    () => {\n      var dup = this.fullCopy(),\n        ide = this.parentThatIsA(IDE_Morph),\n        blockEditor = this.parentThatIsA(BlockEditorMorph);\n      dup.pickUp(world);\n      // register the drop-origin, so the block can\n      // slide back to its former situation if dropped\n      // somewhere where it gets rejected\n      if (!ide && blockEditor) {\n        ide = blockEditor.target.parentThatIsA(IDE_Morph);\n      }\n      if (ide) {\n        world.hand.grabOrigin = {\n          origin: ide.palette,\n          position: ide.palette.center()\n        };\n      }\n    },\n    'make a copy\\nand pick it up'\n  );\n  if (this instanceof CommandBlockMorph && this.nextBlock()) {\n    menu.addItem(\n      (proc ? this.fullCopy() : this).thumbnail(0.5, 60),\n      () => {\n        var cpy = this.fullCopy(),\n          nb = cpy.nextBlock(),\n          ide = this.parentThatIsA(IDE_Morph),\n          blockEditor = this.parentThatIsA(BlockEditorMorph);\n        if (nb) {nb.destroy(); }\n        cpy.pickUp(world);\n        if (!ide && blockEditor) {\n          ide = blockEditor.target.parentThatIsA(IDE_Morph);\n        }\n        if (ide) {\n          world.hand.grabOrigin = {\n            origin: ide.palette,\n            position: ide.palette.center()\n          };\n        }\n      },\n      'only duplicate this block'\n    );\n    menu.addItem(\n      'extract',\n      'userExtractJustThis',\n      'only grab this block'\n    );\n  }\n  menu.addItem(\n    \"delete\",\n    'userDestroy'\n  );\n  if (isNil(this.comment)) {\n    menu.addItem(\n      \"add comment\",\n      () => {\n        var comment = new CommentMorph();\n        this.comment = comment;\n        comment.block = this;\n        comment.layoutChanged();\n\n        // Simulate drag/drop for better undo/redo behavior\n        var scripts = this.parentThatIsA(ScriptsMorph),\n          ide = this.parentThatIsA(IDE_Morph),\n          blockEditor = this.parentThatIsA(BlockEditorMorph);\n        if (!ide && blockEditor) {\n          ide = blockEditor.target.parentThatIsA(IDE_Morph);\n        }\n        if (ide) {\n          world.hand.grabOrigin = {\n            origin: ide.palette,\n            position: ide.palette.center()\n          };\n        }\n        scripts.clearDropInfo();\n        scripts.lastDropTarget = { element: this };\n        scripts.lastDroppedBlock = comment;\n        scripts.recordDrop(world.hand.grabOrigin);\n      }\n    );\n  }\n  menu.addItem(\n    \"script pic...\",\n    () => {\n      // Trace.log('Block.scriptPic', myself.blockId());\n      var ide = this.parentThatIsA(IDE_Morph) ||\n        this.parentThatIsA(BlockEditorMorph).target.parentThatIsA(\n          IDE_Morph\n        );\n      ide.saveCanvasAs(\n        top.scriptPic(),\n        (ide.projectName || localize('untitled')) + ' ' +\n        localize('script pic')\n      );\n    },\n    'save a picture\\nof this script'\n  );\n  if (top instanceof ReporterBlockMorph ||\n    (!(top instanceof PrototypeHatBlockMorph) &&\n      top.allChildren().some((any) => any.selector === 'doReport'))\n  ) {\n    menu.addItem(\n      \"result pic...\",\n      () => top.exportResultPic(),\n      'save a picture of both\\nthis script and its result'\n    );\n  }\n  if (shiftClicked) {\n    menu.addItem(\n      'download script',\n      () => {\n        var ide = this.parentThatIsA(IDE_Morph),\n          blockEditor = this.parentThatIsA(BlockEditorMorph);\n        if (!ide && blockEditor) {\n          ide = blockEditor.target.parentThatIsA(IDE_Morph);\n        }\n        if (ide) {\n          ide.saveXMLAs(\n            ide.serializer.serialize(this),\n            this.selector + ' script',\n            false);\n        }\n      },\n      'download this script\\nas an XML file',\n      new Color(100, 0, 0)\n    );\n  }\n  if (proc) {\n    if (vNames.length) {\n      menu.addLine();\n      vNames.forEach(vn =>\n        menu.addItem(\n          vn + '...',\n          () => proc.doShowVar(vn)\n        )\n      );\n    }\n    proc.homeContext.variables.names().forEach(vn => {\n      if (!contains(vNames, vn)) {\n        menu.addItem(\n          vn + '...',\n          () => proc.doShowVar(vn)\n        );\n      }\n    });\n    return menu;\n  }\n  if (this.parent.parentThatIsA(RingMorph)) {\n    menu.addLine();\n    menu.addItem(\"unringify\", 'unringify');\n    if (this instanceof ReporterBlockMorph ||\n      (!(top instanceof HatBlockMorph))) {\n      menu.addItem(\"ringify\", 'ringify');\n    }\n    return menu;\n  }\n  if (contains(\n    ['doBroadcast', 'doSend', 'doBroadcastAndWait', 'receiveMessage',\n      'receiveOnClone', 'receiveGo'],\n    this.selector\n  )) {\n    hasLine = true;\n    menu.addLine();\n    menu.addItem(\n      (this.selector.indexOf('receive') === 0 ?\n        \"senders...\" : \"receivers...\"),\n      'showMessageUsers'\n    );\n  }\n  if (this.parent instanceof ReporterSlotMorph\n    || (this.parent instanceof CommandSlotMorph)\n    || (this instanceof HatBlockMorph)\n    || (this instanceof CommandBlockMorph\n      && (top instanceof HatBlockMorph))) {\n    return menu;\n  }\n  if (!hasLine) {menu.addLine(); }\n  menu.addItem(\"ringify\", 'ringify');\n  if (StageMorph.prototype.enableCodeMapping) {\n    menu.addLine();\n    menu.addItem(\n      'header mapping...',\n      'mapToHeader'\n    );\n    menu.addItem(\n      'code mapping...',\n      'mapToCode'\n    );\n  }\n  return menu;\n};\n\n// SpriteIconMorph ////////////////////////////////////////////////////\n\n/*\n    I am a selectable element in the Sprite corral, keeping a self-updating\n    thumbnail of the sprite I'm respresenting, and a self-updating label\n    of the sprite's name (in case it is changed elsewhere)\n*/\n\n// SpriteIconMorph inherits from ToggleButtonMorph (Widgets)\n\nSpriteIconMorph.prototype = new ToggleButtonMorph();\nSpriteIconMorph.prototype.constructor = SpriteIconMorph;\nSpriteIconMorph.uber = ToggleButtonMorph.prototype;\n\n// SpriteIconMorph settings\n\nSpriteIconMorph.prototype.thumbSize = new Point(40, 40);\nSpriteIconMorph.prototype.labelShadowOffset = null;\nSpriteIconMorph.prototype.labelShadowColor = null;\nSpriteIconMorph.prototype.labelColor = WHITE;\nSpriteIconMorph.prototype.fontSize = 9;\n\n// SpriteIconMorph instance creation:\n\nexport function SpriteIconMorph(aSprite) {\n    this.init(aSprite);\n}\n\nSpriteIconMorph.prototype.init = function (aSprite) {\n    var colors, action, query, hover;\n\n    colors = [\n        IDE_Morph.prototype.groupColor,\n        IDE_Morph.prototype.frameColor,\n        IDE_Morph.prototype.frameColor\n    ];\n\n    action = () => {\n        // make my sprite the current one\n        var ide = this.parentThatIsA(IDE_Morph);\n\n        if (ide) {\n            ide.selectSprite(this.object);\n        }\n    };\n\n    query = () => {\n        // answer true if my sprite is the current one\n        var ide = this.parentThatIsA(IDE_Morph);\n\n        if (ide) {\n            return ide.currentSprite === this.object;\n        }\n        return false;\n    };\n\n    hover = () => {\n        if (!aSprite.exemplar) {return null; }\n        return (localize('parent') + ':\\n' + aSprite.exemplar.name);\n    };\n\n    // additional properties:\n    this.object = aSprite || new SpriteMorph(); // mandatory, actually\n    this.version = this.object.version;\n    this.thumbnail = null;\n    this.rotationButton = null; // synchronous rotation of nested sprites\n\n    // initialize inherited properties:\n    SpriteIconMorph.uber.init.call(\n        this,\n        colors, // color overrides, <array>: [normal, highlight, pressed]\n        null, // target - not needed here\n        action, // a toggle function\n        this.object.name, // label string\n        query, // predicate/selector\n        null, // environment\n        hover // hint\n    );\n\n    // override defaults and build additional components\n    this.isDraggable = true;\n    this.createThumbnail();\n    this.padding = 2;\n    this.corner = 8;\n    this.fixLayout();\n    this.fps = 1;\n};\n\nSpriteIconMorph.prototype.createThumbnail = function () {\n    if (this.thumbnail) {\n        this.thumbnail.destroy();\n    }\n\n    this.thumbnail = new Morph();\n    this.thumbnail.isCachingImage = true;\n    this.thumbnail.bounds.setExtent(this.thumbSize);\n    if (this.object instanceof SpriteMorph) { // support nested sprites\n        this.thumbnail.cachedImage = this.object.fullThumbnail(\n            this.thumbSize,\n            this.thumbnail.cachedImage\n        );\n        this.add(this.thumbnail);\n        this.createRotationButton();\n    } else {\n        this.thumbnail.cachedImage = this.object.thumbnail(\n            this.thumbSize,\n            this.thumbnail.cachedImage\n        );\n        this.add(this.thumbnail);\n    }\n};\n\nSpriteIconMorph.prototype.createLabel = function () {\n    var txt;\n\n    if (this.label) {\n        this.label.destroy();\n    }\n    txt = new StringMorph(\n        this.object.name,\n        this.fontSize,\n        this.fontStyle,\n        true,\n        false,\n        false,\n        this.labelShadowOffset,\n        this.labelShadowColor,\n        this.labelColor\n    );\n\n    this.label = new FrameMorph();\n    this.label.acceptsDrops = false;\n    this.label.alpha = 0;\n    this.label.setExtent(txt.extent());\n    txt.setPosition(this.label.position());\n    this.label.add(txt);\n    this.add(this.label);\n};\n\nSpriteIconMorph.prototype.createRotationButton = function () {\n    var button;\n\n    if (this.rotationButton) {\n        this.rotationButton.destroy();\n        this.roationButton = null;\n    }\n    if (!this.object.anchor) {\n        return;\n    }\n\n    button = new ToggleButtonMorph(\n        null, // colors,\n        null, // target\n        () => this.object.rotatesWithAnchor = !this.object.rotatesWithAnchor,\n        [\n            '\\u2192',\n            '\\u21BB'\n        ],\n        () => this.object.rotatesWithAnchor // query\n    );\n\n    button.corner = 8;\n    button.labelMinExtent = new Point(11, 11);\n    button.padding = 0;\n    button.pressColor = button.color;\n    // button.hint = 'rotate synchronously\\nwith anchor';\n    button.fixLayout();\n    button.refresh();\n    this.rotationButton = button;\n    this.add(this.rotationButton);\n};\n\n// SpriteIconMorph stepping\n\nSpriteIconMorph.prototype.step = function () {\n    if (this.version !== this.object.version) {\n        this.createThumbnail();\n        this.createLabel();\n        this.fixLayout();\n        this.version = this.object.version;\n        this.refresh();\n    }\n};\n\n// SpriteIconMorph layout\n\nSpriteIconMorph.prototype.fixLayout = function () {\n    if (!this.thumbnail || !this.label) {return null; }\n\n    this.bounds.setWidth(\n        this.thumbnail.width()\n            + this.outline * 2\n            + this.edge * 2\n            + this.padding * 2\n    );\n\n    this.bounds.setHeight(\n        this.thumbnail.height()\n            + this.outline * 2\n            + this.edge * 2\n            + this.padding * 3\n            + this.label.height()\n    );\n\n    this.thumbnail.setCenter(this.center());\n    this.thumbnail.setTop(\n        this.top() + this.outline + this.edge + this.padding\n    );\n\n    if (this.rotationButton) {\n        this.rotationButton.setTop(this.top());\n        this.rotationButton.setRight(this.right());\n    }\n\n    this.label.setWidth(\n        Math.min(\n            this.label.children[0].width(), // the actual text\n            this.thumbnail.width()\n        )\n    );\n    this.label.setCenter(this.center());\n    this.label.setTop(\n        this.thumbnail.bottom() + this.padding\n    );\n};\n\n// SpriteIconMorph menu\n\nSpriteIconMorph.prototype.userMenu = function () {\n    var menu = new MenuMorph(this);\n\n    if (this.object instanceof StageMorph) {\n        menu.addItem(\n            'pic...',\n            () => {\n                var ide = this.parentThatIsA(IDE_Morph);\n                ide.saveCanvasAs(\n                    this.object.fullImage(),\n                    this.object.name\n                );\n            },\n            'save a picture\\nof the stage'\n        );\n        if (this.object.trailsLog.length) {\n            menu.addItem(\n                'svg...',\n                () => this.object.exportTrailsLogAsSVG(),\n                'export pen trails\\nline segments as SVG'\n            );\n        }\n        return menu;\n    }\n    if (!(this.object instanceof SpriteMorph)) {return null; }\n    menu.addItem(\"show\", 'showSpriteOnStage');\n    menu.addLine();\n    menu.addItem(\"duplicate\", 'duplicateSprite');\n    if (StageMorph.prototype.enableInheritance) {\n        menu.addItem(\"clone\", 'instantiateSprite');\n    }\n    menu.addItem(\"delete\", 'removeSprite');\n    menu.addLine();\n    if (StageMorph.prototype.enableInheritance) {\n        /* version that hides refactoring capability unless shift-clicked\n        if (this.world().currentKey === 16) { // shift-clicked\n            menu.addItem(\n                \"parent...\",\n                'chooseExemplar',\n                null,\n                new Color(100, 0, 0)\n            );\n        }\n        */\n        menu.addItem(\"parent...\", 'chooseExemplar');\n        if (this.object.exemplar) {\n            menu.addItem(\n                \"release\",\n                'releaseSprite',\n                'make temporary and\\nhide in the sprite corral'\n            );\n        }\n    }\n    if (this.object.anchor) {\n        menu.addItem(\n            localize('detach from') + ' ' + this.object.anchor.name,\n            () => this.object.detachFromAnchor()\n        );\n    }\n    if (this.object.parts.length) {\n        menu.addItem(\n            'detach all parts',\n            () => this.object.detachAllParts()\n        );\n    }\n    menu.addItem(\"export...\", 'exportSprite');\n    return menu;\n};\n\nSpriteIconMorph.prototype.duplicateSprite = function () {\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (ide) {\n        ide.duplicateSprite(this.object);\n    }\n};\n\nSpriteIconMorph.prototype.instantiateSprite = function () {\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (ide) {\n        ide.instantiateSprite(this.object);\n    }\n};\n\nSpriteIconMorph.prototype.removeSprite = function () {\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (ide) {\n        ide.removeSprite(this.object);\n    }\n};\n\nSpriteIconMorph.prototype.exportSprite = function () {\n    this.object.exportSprite();\n};\n\nSpriteIconMorph.prototype.chooseExemplar = function () {\n    this.object.chooseExemplar();\n};\n\nSpriteIconMorph.prototype.releaseSprite = function () {\n    this.object.release();\n};\n\nSpriteIconMorph.prototype.showSpriteOnStage = function () {\n    this.object.showOnStage();\n};\n\n// SpriteIconMorph events\n\nSpriteIconMorph.prototype.mouseDoubleClick = function () {\n\tif (this.object instanceof SpriteMorph) {\n    \tthis.object.flash();\n    }\n};\n\n// SpriteIconMorph drawing\n\nSpriteIconMorph.prototype.render = function (ctx) {\n    // only draw the edges if I am selected\n    switch (this.userState) {\n    case 'highlight':\n        this.drawBackground(ctx, this.highlightColor);\n        break;\n    case 'pressed':\n        this.drawOutline(ctx);\n        this.drawBackground(ctx, this.pressColor);\n        this.drawEdges(\n            ctx,\n            this.pressColor,\n            this.pressColor.lighter(40),\n            this.pressColor.darker(40)\n        );\n        break;\n    default:\n        this.drawBackground(ctx, this.getRenderColor());\n    }\n};\n\nSpriteIconMorph.prototype.getRenderColor =\n    ScriptsMorph.prototype.getRenderColor;\n\n// SpriteIconMorph drag & drop\n\nSpriteIconMorph.prototype.prepareToBeGrabbed = function () {\n    var ide = this.parentThatIsA(IDE_Morph),\n        idx;\n    this.mouseClickLeft(); // select me\n    this.alpha = 0.85;\n    if (ide) {\n        idx = ide.sprites.asArray().indexOf(this.object);\n        ide.sprites.remove(idx + 1);\n        ide.createCorral();\n        ide.fixLayout();\n    }\n};\n\nSpriteIconMorph.prototype.justDropped = function () {\n    this.alpha = 1;\n};\n\nSpriteIconMorph.prototype.wantsDropOf = function (morph) {\n    // allow scripts & media to be copied from one sprite to another\n    // by drag & drop\n    return morph instanceof BlockMorph\n        || (morph instanceof CostumeIconMorph)\n        || (morph instanceof SoundIconMorph);\n};\n\nSpriteIconMorph.prototype.reactToDropOf = function (morph, hand) {\n    if (morph instanceof BlockMorph) {\n        this.copyStack(morph);\n    } else if (morph instanceof CostumeIconMorph) {\n        this.copyCostume(morph.object);\n    } else if (morph instanceof SoundIconMorph) {\n        this.copySound(morph.object);\n    }\n    this.world().add(morph);\n    morph.slideBackTo(hand.grabOrigin);\n};\n\nSpriteIconMorph.prototype.copyStack = function (block) {\n    var sprite = this.object,\n    \tdup = block.fullCopy(),\n        y = Math.max(\n            sprite.scripts.children.map(stack =>\n                stack.fullBounds().bottom()\n            ).concat([sprite.scripts.top()])\n        );\n\n    dup.setPosition(new Point(sprite.scripts.left() + 20, y + 20));\n    sprite.scripts.add(dup);\n    dup.allComments().forEach(comment => comment.align(dup));\n    sprite.scripts.adjustBounds();\n\n    // delete all local custom blocks (methods) that the receiver\n    // doesn't understand\n    dup.allChildren().forEach(morph => {\n\t    if (morph.isCustomBlock &&\n            !morph.isGlobal &&\n        \t\t!sprite.getMethod(morph.blockSpec)\n        ) {\n            morph.deleteBlock();\n        }\n    });\n};\n\nSpriteIconMorph.prototype.copyCostume = function (costume) {\n    var dup = costume.copy();\n    dup.name = this.object.newCostumeName(dup.name);\n    this.object.addCostume(dup);\n    this.object.wearCostume(dup);\n};\n\nSpriteIconMorph.prototype.copySound = function (sound) {\n    var dup = sound.copy();\n    this.object.addSound(dup.audio, dup.name);\n};\n\n// SpriteIconMorph flashing\n\nSpriteIconMorph.prototype.flash = function () {\n    var world = this.world(),\n        isFlat = MorphicPreferences.isFlat,\n        highlight = SpriteMorph.prototype.highlightColor,\n        previousColor = isFlat ? this.pressColor : this.outlineColor,\n        previousOutline = this.outline,\n        previousState = this.userState;\n\n    if (isFlat) {\n        this.pressColor = highlight;\n    } else {\n        this.outlineColor = highlight;\n        this.outline = 2;\n    }\n    this.userState = 'pressed';\n    this.rerender();\n\n    world.animations.push(new Animation(\n        nop,\n        nop,\n        0,\n        800,\n        nop,\n        () => {\n            if (isFlat) {\n                this.pressColor = previousColor;\n            } else {\n                this.outlineColor = previousColor;\n                this.outline = previousOutline;\n            }\n            this.userState = previousState;\n            this.rerender();\n        }\n    ));\n};\n\n\nStageMorph.prototype.wantsDropOf = function (aMorph) {\n  return aMorph instanceof SpriteMorph ||\n    aMorph instanceof WatcherMorph ||\n    aMorph instanceof ListWatcherMorph ||\n    aMorph instanceof SpriteIconMorph;\n};\n\n\n// CostumeIconMorph ////////////////////////////////////////////////////\n\n/*\n    I am a selectable element in the SpriteEditor's \"Costumes\" tab, keeping\n    a self-updating thumbnail of the costume I'm respresenting, and a\n    self-updating label of the costume's name (in case it is changed\n    elsewhere)\n*/\n\n// CostumeIconMorph inherits from ToggleButtonMorph (Widgets)\n// ... and copies methods from SpriteIconMorph\n\nCostumeIconMorph.prototype = new ToggleButtonMorph();\nCostumeIconMorph.prototype.constructor = CostumeIconMorph;\nCostumeIconMorph.uber = ToggleButtonMorph.prototype;\n\n// CostumeIconMorph settings\n\nCostumeIconMorph.prototype.thumbSize = new Point(80, 60);\nCostumeIconMorph.prototype.labelShadowOffset = null;\nCostumeIconMorph.prototype.labelShadowColor = null;\nCostumeIconMorph.prototype.labelColor = WHITE;\nCostumeIconMorph.prototype.fontSize = 9;\n\n// CostumeIconMorph instance creation:\n\nexport function CostumeIconMorph(aCostume) {\n    this.init(aCostume);\n}\n\nCostumeIconMorph.prototype.init = function (aCostume) {\n    var colors, action, query;\n\n    colors = [\n        IDE_Morph.prototype.groupColor,\n        IDE_Morph.prototype.frameColor,\n        IDE_Morph.prototype.frameColor\n    ];\n\n    action = () => {\n        // make my costume the current one\n        var ide = this.parentThatIsA(IDE_Morph),\n            wardrobe = this.parentThatIsA(WardrobeMorph);\n\n        if (ide) {\n            ide.currentSprite.wearCostume(this.object);\n        }\n        if (wardrobe) {\n            wardrobe.updateSelection();\n        }\n    };\n\n    query = () => {\n        // answer true if my costume is the current one\n        var ide = this.parentThatIsA(IDE_Morph);\n\n        if (ide) {\n            return ide.currentSprite.costume === this.object;\n        }\n        return false;\n    };\n\n    // additional properties:\n    this.object = aCostume || new Costume(); // mandatory, actually\n    this.version = this.object.version;\n    this.thumbnail = null;\n\n    // initialize inherited properties:\n    CostumeIconMorph.uber.init.call(\n        this,\n        colors, // color overrides, <array>: [normal, highlight, pressed]\n        null, // target - not needed here\n        action, // a toggle function\n        this.object.name, // label string\n        query, // predicate/selector\n        null, // environment\n        null // hint\n    );\n\n    // override defaults and build additional components\n    this.isDraggable = true;\n    this.createThumbnail();\n    this.padding = 2;\n    this.corner = 8;\n    this.fixLayout();\n    this.fps = 1;\n};\n\nCostumeIconMorph.prototype.createThumbnail = function () {\n    var txt;\n    SpriteIconMorph.prototype.createThumbnail.call(this);\n    if (this.object instanceof SVG_Costume) {\n        txt = new StringMorph(\n            'svg',\n            this.fontSize * 0.8,\n            this.fontStyle,\n            false,\n            false,\n            false,\n            this.labelShadowOffset,\n            this.labelShadowColor,\n            this.labelColor\n        );\n        txt.setBottom(this.thumbnail.bottom());\n        this.thumbnail.add(txt);\n    }\n};\n\nCostumeIconMorph.prototype.createLabel\n    = SpriteIconMorph.prototype.createLabel;\n\n// CostumeIconMorph stepping\n\nCostumeIconMorph.prototype.step\n    = SpriteIconMorph.prototype.step;\n\n// CostumeIconMorph layout\n\nCostumeIconMorph.prototype.fixLayout\n    = SpriteIconMorph.prototype.fixLayout;\n\n// CostumeIconMorph menu\n\nCostumeIconMorph.prototype.userMenu = function () {\n    var menu = new MenuMorph(this);\n    if (!(this.object instanceof Costume)) {return null; }\n    menu.addItem(\"edit\", \"editCostume\");\n    if (this.world().currentKey === 16) { // shift clicked\n        menu.addItem(\n            'edit rotation point only...',\n            'editRotationPointOnly',\n            null,\n            new Color(100, 0, 0)\n        );\n    }\n    menu.addItem(\"rename\", \"renameCostume\");\n    menu.addLine();\n    menu.addItem(\"duplicate\", \"duplicateCostume\");\n    menu.addItem(\"delete\", \"removeCostume\");\n    menu.addLine();\n    menu.addItem(\"export\", \"exportCostume\");\n    return menu;\n};\n\nCostumeIconMorph.prototype.editCostume = function () {\n    this.disinherit();\n\n    if (this.object instanceof SVG_Costume && this.object.shapes.length === 0) {\n        try {\n            this.object.parseShapes();\n        } catch (e) {\n            this.editRotationPointOnly();\n            return;\n        }\n    }\n\n    this.object.edit(\n        this.world(),\n        this.parentThatIsA(IDE_Morph),\n        false // not a new costume, retain existing rotation center\n    );\n};\n\nCostumeIconMorph.prototype.editRotationPointOnly = function () {\n    var ide = this.parentThatIsA(IDE_Morph);\n    this.object.editRotationPointOnly(this.world(), ide);\n    ide.hasChangedMedia = true;\n};\n\nCostumeIconMorph.prototype.renameCostume = function () {\n    this.disinherit();\n    var costume = this.object,\n        wardrobe = this.parentThatIsA(WardrobeMorph),\n        ide = this.parentThatIsA(IDE_Morph);\n    new DialogBoxMorph(\n        null,\n        answer => {\n            if (answer && (answer !== costume.name)) {\n                costume.name = wardrobe.sprite.newCostumeName(\n                    answer,\n                    costume\n                );\n                costume.version = Date.now();\n                ide.hasChangedMedia = true;\n            }\n        }\n    ).prompt(\n        ide.currentSprite instanceof SpriteMorph ?\n            'rename costume' : 'rename background',\n        costume.name,\n        this.world()\n    );\n};\n\nCostumeIconMorph.prototype.duplicateCostume = function () {\n    var wardrobe = this.parentThatIsA(WardrobeMorph),\n        ide = this.parentThatIsA(IDE_Morph),\n        newcos = this.object.copy();\n    newcos.name = wardrobe.sprite.newCostumeName(newcos.name);\n    wardrobe.sprite.addCostume(newcos);\n    wardrobe.updateList();\n    if (ide) {\n        ide.currentSprite.wearCostume(newcos);\n    }\n};\n\nCostumeIconMorph.prototype.removeCostume = function () {\n    var wardrobe = this.parentThatIsA(WardrobeMorph),\n        idx = this.parent.children.indexOf(this),\n        off = CamSnapshotDialogMorph.prototype.enableCamera ? 3 : 2,\n        ide = this.parentThatIsA(IDE_Morph);\n    wardrobe.removeCostumeAt(idx - off); // ignore paintbrush and camera buttons\n    if (ide.currentSprite.costume === this.object) {\n        ide.currentSprite.wearCostume(null);\n    }\n};\n\nCostumeIconMorph.prototype.exportCostume = function () {\n    var ide = this.parentThatIsA(IDE_Morph);\n    if (this.object instanceof SVG_Costume) {\n        // don't show SVG costumes in a new tab (shows text)\n        ide.saveFileAs(this.object.contents.src, 'text/svg', this.object.name);\n    } else { // rasterized Costume\n        ide.saveCanvasAs(this.object.contents, this.object.name);\n    }\n};\n\n// CostumeIconMorph drawing\n\nCostumeIconMorph.prototype.render\n    = SpriteIconMorph.prototype.render;\n\n// CostumeIconMorph inheritance\n\nCostumeIconMorph.prototype.disinherit = function () {\n    var wardrobe = this.parentThatIsA(WardrobeMorph),\n        idx = this.parent.children.indexOf(this);\n    if (wardrobe.sprite.inheritsAttribute('costumes')) {\n        wardrobe.sprite.shadowAttribute('costumes');\n        this.object = wardrobe.sprite.costumes.at(idx - 3);\n    }\n};\n\n// CostumeIconMorph drag & drop\n\nCostumeIconMorph.prototype.prepareToBeGrabbed = function () {\n    this.disinherit();\n    this.mouseClickLeft(); // select me\n    this.removeCostume();\n};\n\n// TurtleIconMorph ////////////////////////////////////////////////////\n\n/*\n    I am a selectable element in the SpriteEditor's \"Costumes\" tab, keeping\n    a thumbnail of the sprite's or stage's default \"Turtle\" costume.\n*/\n\n// TurtleIconMorph inherits from ToggleButtonMorph (Widgets)\n// ... and copies methods from SpriteIconMorph\n\nTurtleIconMorph.prototype = new ToggleButtonMorph();\nTurtleIconMorph.prototype.constructor = TurtleIconMorph;\nTurtleIconMorph.uber = ToggleButtonMorph.prototype;\n\n// TurtleIconMorph settings\n\nTurtleIconMorph.prototype.thumbSize = new Point(80, 60);\nTurtleIconMorph.prototype.labelShadowOffset = null;\nTurtleIconMorph.prototype.labelShadowColor = null;\nTurtleIconMorph.prototype.labelColor = WHITE;\nTurtleIconMorph.prototype.fontSize = 9;\n\n// TurtleIconMorph instance creation:\n\nexport function TurtleIconMorph(aSpriteOrStage) {\n    this.init(aSpriteOrStage);\n}\n\nTurtleIconMorph.prototype.init = function (aSpriteOrStage) {\n    var colors, action, query;\n\n    colors = [\n        IDE_Morph.prototype.groupColor,\n        IDE_Morph.prototype.frameColor,\n        IDE_Morph.prototype.frameColor\n    ];\n\n    action = () => {\n        // make my costume the current one\n        var ide = this.parentThatIsA(IDE_Morph),\n            wardrobe = this.parentThatIsA(WardrobeMorph);\n\n        if (ide) {\n            ide.currentSprite.wearCostume(null);\n        }\n        if (wardrobe) {\n            wardrobe.updateSelection();\n        }\n    };\n\n    query = () => {\n        // answer true if my costume is the current one\n        var ide = this.parentThatIsA(IDE_Morph);\n\n        if (ide) {\n            return ide.currentSprite.costume === null;\n        }\n        return false;\n    };\n\n    // additional properties:\n    this.object = aSpriteOrStage; // mandatory, actually\n    this.version = this.object.version;\n    this.thumbnail = null;\n\n    // initialize inherited properties:\n    TurtleIconMorph.uber.init.call(\n        this,\n        colors, // color overrides, <array>: [normal, highlight, pressed]\n        null, // target - not needed here\n        action, // a toggle function\n        'default', // label string\n        query, // predicate/selector\n        null, // environment\n        null // hint\n    );\n\n    // override defaults and build additional components\n    this.isDraggable = false;\n    this.createThumbnail();\n    this.padding = 2;\n    this.corner = 8;\n    this.fixLayout();\n};\n\nTurtleIconMorph.prototype.createThumbnail = function () {\n    var isFlat = MorphicPreferences.isFlat;\n\n    if (this.thumbnail) {\n        this.thumbnail.destroy();\n    }\n    if (this.object instanceof SpriteMorph) {\n        this.thumbnail = new SymbolMorph(\n            'turtle',\n            this.thumbSize.y,\n            this.labelColor,\n            isFlat ? null : new Point(-1, -1),\n            new Color(0, 0, 0)\n        );\n    } else {\n        this.thumbnail = new SymbolMorph(\n            'stage',\n            this.thumbSize.y,\n            this.labelColor,\n            isFlat ? null : new Point(-1, -1),\n            new Color(0, 0, 0)\n        );\n    }\n    this.add(this.thumbnail);\n};\n\nTurtleIconMorph.prototype.createLabel = function () {\n    var txt;\n\n    if (this.label) {\n        this.label.destroy();\n    }\n    txt = new StringMorph(\n        localize(\n            this.object instanceof SpriteMorph ? 'Turtle' : 'Empty'\n        ),\n        this.fontSize,\n        this.fontStyle,\n        true,\n        false,\n        false,\n        this.labelShadowOffset,\n        this.labelShadowColor,\n        this.labelColor\n    );\n\n    this.label = new FrameMorph();\n    this.label.acceptsDrops = false;\n    this.label.alpha = 0;\n    this.label.setExtent(txt.extent());\n    txt.setPosition(this.label.position());\n    this.label.add(txt);\n    this.add(this.label);\n};\n\n// TurtleIconMorph layout\n\nTurtleIconMorph.prototype.fixLayout\n    = SpriteIconMorph.prototype.fixLayout;\n\n// TurtleIconMorph drawing\n\nTurtleIconMorph.prototype.render\n    = SpriteIconMorph.prototype.render;\n\n// TurtleIconMorph user menu\n\nTurtleIconMorph.prototype.userMenu = function () {\n    var menu = new MenuMorph(this, 'pen'),\n        on = '\\u25CF',\n        off = '\\u25CB';\n    if (this.object instanceof StageMorph) {\n        return null;\n    }\n    menu.addItem(\n        (this.object.penPoint === 'tip' ? on : off) + ' ' + localize('tip'),\n        () => {\n            this.object.penPoint = 'tip';\n            this.object.changed();\n            this.object.fixLayout();\n            this.object.rerender();\n        }\n    );\n    menu.addItem(\n        (this.object.penPoint === 'middle' ? on : off) + ' ' + localize(\n            'middle'\n        ),\n        () => {\n            this.object.penPoint = 'middle';\n            this.object.changed();\n            this.object.fixLayout();\n            this.object.rerender();\n        }\n    );\n    return menu;\n};\n\n// WardrobeMorph ///////////////////////////////////////////////////////\n\n// I am a watcher on a sprite's costume list\n\n// WardrobeMorph inherits from ScrollFrameMorph\n\nWardrobeMorph.prototype = new ScrollFrameMorph();\nWardrobeMorph.prototype.constructor = WardrobeMorph;\nWardrobeMorph.uber = ScrollFrameMorph.prototype;\n\n// WardrobeMorph settings\n\n// ... to follow ...\n\n// WardrobeMorph instance creation:\n\nexport function WardrobeMorph(aSprite, sliderColor) {\n    this.init(aSprite, sliderColor);\n}\n\nWardrobeMorph.prototype.init = function (aSprite, sliderColor) {\n    // additional properties\n    this.sprite = aSprite || new SpriteMorph();\n    this.costumesVersion = null;\n    this.spriteVersion = null;\n\n    // initialize inherited properties\n    WardrobeMorph.uber.init.call(this, null, null, sliderColor);\n\n    // configure inherited properties\n    this.fps = 2;\n    this.updateList();\n};\n\n// Wardrobe updating\n\nWardrobeMorph.prototype.updateList = function () {\n    var x = this.left() + 5,\n        y = this.top() + 5,\n        padding = 4,\n        toolsPadding = 5,\n        oldPos = this.contents.position(),\n        icon,\n        txt,\n        paintbutton,\n        cambutton;\n\n    this.changed();\n\n    this.contents.destroy();\n    this.contents = new FrameMorph(this);\n    this.contents.acceptsDrops = false;\n    this.contents.reactToDropOf = (icon) => {\n        this.reactToDropOf(icon);\n    };\n    this.addBack(this.contents);\n\n    icon = new TurtleIconMorph(this.sprite);\n    icon.setPosition(new Point(x, y));\n    this.addContents(icon);\n    y = icon.bottom() + padding;\n\n    paintbutton = new PushButtonMorph(\n        this,\n        \"paintNew\",\n        new SymbolMorph(\"brush\", 15)\n    );\n    paintbutton.padding = 0;\n    paintbutton.corner = 12;\n    paintbutton.color = IDE_Morph.prototype.groupColor;\n    paintbutton.highlightColor = IDE_Morph.prototype.frameColor.darker(50);\n    paintbutton.pressColor = paintbutton.highlightColor;\n    paintbutton.labelMinExtent = new Point(36, 18);\n    paintbutton.labelShadowOffset = new Point(-1, -1);\n    paintbutton.labelShadowColor = paintbutton.highlightColor;\n    paintbutton.labelColor = TurtleIconMorph.prototype.labelColor;\n    paintbutton.contrast = this.buttonContrast;\n    paintbutton.hint = \"Paint a new costume\";\n    paintbutton.setPosition(new Point(x, y));\n    paintbutton.fixLayout();\n    paintbutton.setCenter(icon.center());\n    paintbutton.setLeft(icon.right() + padding * 4);\n\n    this.addContents(paintbutton);\n\n    if (CamSnapshotDialogMorph.prototype.enableCamera) {\n        cambutton = new PushButtonMorph(\n            this,\n            \"newFromCam\",\n            new SymbolMorph(\"camera\", 15)\n        );\n        cambutton.padding = 0;\n        cambutton.corner = 12;\n        cambutton.color = IDE_Morph.prototype.groupColor;\n        cambutton.highlightColor = IDE_Morph.prototype.frameColor.darker(50);\n        cambutton.pressColor = paintbutton.highlightColor;\n        cambutton.labelMinExtent = new Point(36, 18);\n        cambutton.labelShadowOffset = new Point(-1, -1);\n        cambutton.labelShadowColor = paintbutton.highlightColor;\n        cambutton.labelColor = TurtleIconMorph.prototype.labelColor;\n        cambutton.contrast = this.buttonContrast;\n        cambutton.hint = \"Import a new costume from your webcam\";\n        cambutton.setPosition(new Point(x, y));\n        cambutton.fixLayout();\n        cambutton.setCenter(paintbutton.center());\n        cambutton.setLeft(paintbutton.right() + toolsPadding);\n\n        this.addContents(cambutton);\n\n        if (!CamSnapshotDialogMorph.prototype.enabled) {\n            cambutton.disable();\n            cambutton.hint =\n            \tCamSnapshotDialogMorph.prototype.notSupportedMessage;\n        }\n\n        document.addEventListener(\n            'cameraDisabled',\n            () => {\n                cambutton.disable();\n                cambutton.hint =\n                    CamSnapshotDialogMorph.prototype.notSupportedMessage;\n            }\n        );\n    }\n\n    txt = new TextMorph(localize(\n        \"costumes tab help\" // look up long string in translator\n    ));\n    txt.fontSize = 9;\n    txt.setColor(SpriteMorph.prototype.paletteTextColor);\n\n    txt.setPosition(new Point(x, y));\n    this.addContents(txt);\n    y = txt.bottom() + padding;\n\n    this.sprite.costumes.asArray().forEach(costume => {\n        icon = new CostumeIconMorph(costume);\n        icon.setPosition(new Point(x, y));\n        this.addContents(icon);\n        y = icon.bottom() + padding;\n    });\n    this.costumesVersion = this.sprite.costumes.lastChanged;\n\n    this.contents.setPosition(oldPos);\n    this.adjustScrollBars();\n    this.changed();\n\n    this.updateSelection();\n};\n\nWardrobeMorph.prototype.updateSelection = function () {\n    this.contents.children.forEach(function (morph) {\n        if (morph.refresh) {morph.refresh(); }\n    });\n    this.spriteVersion = this.sprite.version;\n};\n\n// Wardrobe stepping\n\nWardrobeMorph.prototype.step = function () {\n    if (this.costumesVersion !== this.sprite.costumes.lastChanged) {\n        this.updateList();\n    }\n    if (this.spriteVersion !== this.sprite.version) {\n        this.updateSelection();\n    }\n};\n\n// Wardrobe ops\n\nWardrobeMorph.prototype.removeCostumeAt = function (idx) {\n    this.sprite.shadowAttribute('costumes');\n    this.sprite.costumes.remove(idx);\n    this.updateList();\n};\n\nWardrobeMorph.prototype.paintNew = function () {\n    var cos = new Costume(\n            newCanvas(null, true),\n            this.sprite.newCostumeName(localize('Untitled'))\n        ),\n        ide = this.parentThatIsA(IDE_Morph);\n\n    cos.edit(\n        this.world(),\n        ide,\n        true,\n        null,\n        () => {\n            this.sprite.shadowAttribute('costumes');\n            this.sprite.addCostume(cos);\n            this.updateList();\n            if (ide) {\n                ide.currentSprite.wearCostume(cos);\n            }\n        }\n    );\n};\n\nWardrobeMorph.prototype.newFromCam = function () {\n    var camDialog,\n        ide = this.parentThatIsA(IDE_Morph),\n        sprite = this.sprite;\n\n    camDialog = new CamSnapshotDialogMorph(\n        ide,\n        sprite,\n        nop,\n        costume => {\n            sprite.addCostume(costume);\n            sprite.wearCostume(costume);\n            this.updateList();\n        });\n\n    camDialog.key = 'camera';\n    camDialog.popUp(this.world());\n};\n\n// Wardrobe drag & drop\n\nWardrobeMorph.prototype.wantsDropOf = function (morph) {\n    return morph instanceof CostumeIconMorph;\n};\n\nWardrobeMorph.prototype.reactToDropOf = function (icon) {\n    var idx = 0,\n        costume = icon.object,\n        top = icon.top();\n    icon.destroy();\n    this.contents.children.forEach(item => {\n        if (item instanceof CostumeIconMorph && item.top() < top - 4) {\n            idx += 1;\n        }\n    });\n    this.sprite.shadowAttribute('costumes');\n    this.sprite.costumes.add(costume, idx + 1);\n    this.updateList();\n    icon.mouseClickLeft(); // select\n};\n\n// SoundIconMorph ///////////////////////////////////////////////////////\n\n/*\n    I am an element in the SpriteEditor's \"Sounds\" tab.\n*/\n\n// SoundIconMorph inherits from ToggleButtonMorph (Widgets)\n// ... and copies methods from SpriteIconMorph\n\nSoundIconMorph.prototype = new ToggleButtonMorph();\nSoundIconMorph.prototype.constructor = SoundIconMorph;\nSoundIconMorph.uber = ToggleButtonMorph.prototype;\n\n// SoundIconMorph settings\n\nSoundIconMorph.prototype.thumbSize = new Point(80, 60);\nSoundIconMorph.prototype.labelShadowOffset = null;\nSoundIconMorph.prototype.labelShadowColor = null;\nSoundIconMorph.prototype.labelColor = WHITE;\nSoundIconMorph.prototype.fontSize = 9;\n\n// SoundIconMorph instance creation:\n\nexport function SoundIconMorph(aSound) {\n    this.init(aSound);\n}\n\nSoundIconMorph.prototype.init = function (aSound) {\n    var colors, action, query;\n\n    colors = [\n        IDE_Morph.prototype.groupColor,\n        IDE_Morph.prototype.frameColor,\n        IDE_Morph.prototype.frameColor\n    ];\n\n    action = nop; // When I am selected (which is never the case for sounds)\n\n    query = () => false;\n\n    // additional properties:\n    this.object = aSound; // mandatory, actually\n    this.version = this.object.version;\n    this.thumbnail = null;\n\n    // initialize inherited properties:\n    SoundIconMorph.uber.init.call(\n        this,\n        colors, // color overrides, <array>: [normal, highlight, pressed]\n        null, // target - not needed here\n        action, // a toggle function\n        this.object.name, // label string\n        query, // predicate/selector\n        null, // environment\n        null // hint\n    );\n\n    // override defaults and build additional components\n    this.isDraggable = true;\n    this.createThumbnail();\n    this.padding = 2;\n    this.corner = 8;\n    this.fixLayout();\n    this.fps = 1;\n};\n\nSoundIconMorph.prototype.createThumbnail = function () {\n    var label;\n    if (this.thumbnail) {\n        this.thumbnail.destroy();\n    }\n    this.thumbnail = new Morph();\n    this.thumbnail.bounds.setExtent(this.thumbSize);\n    this.add(this.thumbnail);\n    label = new StringMorph(\n        this.createInfo(),\n        '16',\n        '',\n        true,\n        false,\n        false,\n        this.labelShadowOffset,\n        this.labelShadowColor,\n        new Color(200, 200, 200)\n    );\n    this.thumbnail.add(label);\n    label.setCenter(new Point(40, 15));\n\n    this.button = new PushButtonMorph(\n        this,\n        'toggleAudioPlaying',\n        (this.object.previewAudio ? 'Stop' : 'Play')\n    );\n    this.button.hint = 'Play sound';\n    this.button.fixLayout();\n    this.thumbnail.add(this.button);\n    this.button.setCenter(new Point(40, 40));\n};\n\nSoundIconMorph.prototype.createInfo = function () {\n    var dur = Math.round(this.object.audio.duration || 0),\n        mod = dur % 60;\n    return Math.floor(dur / 60).toString()\n            + \":\"\n            + (mod < 10 ? \"0\" : \"\")\n            + mod.toString();\n};\n\nSoundIconMorph.prototype.toggleAudioPlaying = function () {\n    if (!this.object.previewAudio) {\n        //Audio is not playing\n        this.button.labelString = 'Stop';\n        this.button.hint = 'Stop sound';\n        this.object.previewAudio = this.object.play();\n        this.object.previewAudio.addEventListener(\n            'ended',\n            () => this.audioHasEnded(),\n            false\n        );\n    } else {\n        //Audio is currently playing\n        this.button.labelString = 'Play';\n        this.button.hint = 'Play sound';\n        this.object.previewAudio.pause();\n        this.object.previewAudio.terminated = true;\n        this.object.previewAudio = null;\n    }\n    this.button.createLabel();\n};\n\nSoundIconMorph.prototype.audioHasEnded = function () {\n    this.button.trigger();\n    this.button.mouseLeave();\n};\n\nSoundIconMorph.prototype.createLabel\n    = SpriteIconMorph.prototype.createLabel;\n\n// SoundIconMorph stepping\n\n/*\nSoundIconMorph.prototype.step\n    = SpriteIconMorph.prototype.step;\n*/\n\n// SoundIconMorph layout\n\nSoundIconMorph.prototype.fixLayout\n    = SpriteIconMorph.prototype.fixLayout;\n\n// SoundIconMorph menu\n\nSoundIconMorph.prototype.userMenu = function () {\n    var menu = new MenuMorph(this);\n    if (!(this.object instanceof Sound)) { return null; }\n    menu.addItem('rename', 'renameSound');\n    menu.addItem('delete', 'removeSound');\n    menu.addLine();\n    menu.addItem('export', 'exportSound');\n    return menu;\n};\n\n\nSoundIconMorph.prototype.renameSound = function () {\n    var sound = this.object,\n        ide = this.parentThatIsA(IDE_Morph);\n    this.disinherit();\n    new DialogBoxMorph(\n        null,\n        answer => {\n            if (answer && (answer !== sound.name)) {\n                sound.name = answer;\n                sound.version = Date.now();\n                this.createLabel(); // can be omitted once I'm stepping\n                this.fixLayout(); // can be omitted once I'm stepping\n                ide.hasChangedMedia = true;\n            }\n        }\n    ).prompt(\n        'rename sound',\n        sound.name,\n        this.world()\n    );\n};\n\nSoundIconMorph.prototype.removeSound = function () {\n    var jukebox = this.parentThatIsA(JukeboxMorph),\n        idx = this.parent.children.indexOf(this) - 1;\n    jukebox.removeSound(idx);\n};\n\nSoundIconMorph.prototype.exportSound = function () {\n    var ide = this.parentThatIsA(IDE_Morph);\n    ide.saveAudioAs(this.object.audio, this.object.name);\n};\n\nSoundIconMorph.prototype.render\n    = SpriteIconMorph.prototype.render;\n\nSoundIconMorph.prototype.createLabel\n    = SpriteIconMorph.prototype.createLabel;\n\n// SoundIconMorph inheritance\n\nSoundIconMorph.prototype.disinherit = function () {\n    var jukebox = this.parentThatIsA(JukeboxMorph),\n        idx = this.parent.children.indexOf(this);\n    if (jukebox.sprite.inheritsAttribute('sounds')) {\n        jukebox.sprite.shadowAttribute('sounds');\n        this.object = jukebox.sprite.sounds.at(idx - 1);\n    }\n};\n\n// SoundIconMorph drag & drop\n\nSoundIconMorph.prototype.prepareToBeGrabbed = function () {\n    this.disinherit();\n    this.userState = 'pressed';\n    this.state = true;\n    this.rerender();\n    this.removeSound();\n};\n\n// JukeboxMorph /////////////////////////////////////////////////////\n\n/*\n    I am JukeboxMorph, like WardrobeMorph, but for sounds\n*/\n\n// JukeboxMorph instance creation\n\nJukeboxMorph.prototype = new ScrollFrameMorph();\nJukeboxMorph.prototype.constructor = JukeboxMorph;\nJukeboxMorph.uber = ScrollFrameMorph.prototype;\n\nexport function JukeboxMorph(aSprite, sliderColor) {\n    this.init(aSprite, sliderColor);\n}\n\nJukeboxMorph.prototype.init = function (aSprite, sliderColor) {\n    // additional properties\n    this.sprite = aSprite || new SpriteMorph();\n    this.soundsVersion = null;\n    this.spriteVersion = null;\n\n    // initialize inherited properties\n    JukeboxMorph.uber.init.call(this, null, null, sliderColor);\n\n    // configure inherited properties\n    this.acceptsDrops = false;\n    this.fps = 2;\n    this.updateList();\n};\n\n// Jukebox updating\n\nJukeboxMorph.prototype.updateList = function () {\n    var x = this.left() + 5,\n        y = this.top() + 5,\n        padding = 4,\n        icon,\n        txt,\n        ide = this.sprite.parentThatIsA(IDE_Morph),\n        recordButton;\n\n    this.changed();\n\n    this.contents.destroy();\n    this.contents = new FrameMorph(this);\n    this.contents.acceptsDrops = false;\n    this.contents.reactToDropOf = (icon) => this.reactToDropOf(icon);\n    this.addBack(this.contents);\n\n    txt = new TextMorph(localize(\n        'import a sound from your computer\\nby dragging it into here'\n    ));\n    txt.fontSize = 9;\n    txt.setColor(SpriteMorph.prototype.paletteTextColor);\n    txt.setPosition(new Point(x, y));\n    this.addContents(txt);\n\n    recordButton = new PushButtonMorph(\n        ide,\n        'recordNewSound',\n        new SymbolMorph('circleSolid', 15)\n    );\n    recordButton.padding = 0;\n    recordButton.corner = 12;\n    recordButton.color = IDE_Morph.prototype.groupColor;\n    recordButton.highlightColor = IDE_Morph.prototype.frameColor.darker(50);\n    recordButton.pressColor = recordButton.highlightColor;\n    recordButton.labelMinExtent = new Point(36, 18);\n    recordButton.labelShadowOffset = new Point(-1, -1);\n    recordButton.labelShadowColor = recordButton.highlightColor;\n    recordButton.labelColor = TurtleIconMorph.prototype.labelColor;\n    recordButton.contrast = this.buttonContrast;\n    recordButton.hint = 'Record a new sound';\n    recordButton.fixLayout();\n    recordButton.label.setColor(new Color(255, 20, 20));\n    recordButton.setPosition(txt.bottomLeft().add(new Point(0, padding * 2)));\n\n    this.addContents(recordButton);\n\n    y = recordButton.bottom() + padding;\n\n    this.sprite.sounds.asArray().forEach(sound => {\n        icon = new SoundIconMorph(sound);\n        icon.setPosition(new Point(x, y));\n        this.addContents(icon);\n        y = icon.bottom() + padding;\n    });\n    this.soundsVersion = this.sprite.sounds.lastChanged;\n\n    this.changed();\n    this.updateSelection();\n};\n\nJukeboxMorph.prototype.updateSelection = function () {\n    this.contents.children.forEach(morph => {\n        if (morph.refresh) {morph.refresh(); }\n    });\n    this.spriteVersion = this.sprite.version;\n};\n\n// Jukebox stepping\n\nJukeboxMorph.prototype.step = function () {\n    if (this.soundsVersion !== this.sprite.sounds.lastChanged) {\n        this.updateList();\n    }\n    if (this.spriteVersion !== this.sprite.version) {\n        this.updateSelection();\n    }\n};\n\n// Jukebox ops\n\nJukeboxMorph.prototype.removeSound = function (idx) {\n    this.sprite.sounds.remove(idx);\n    this.updateList();\n};\n\n// Jukebox drag & drop\n\nJukeboxMorph.prototype.wantsDropOf = function (morph) {\n    return morph instanceof SoundIconMorph;\n};\n\nJukeboxMorph.prototype.reactToDropOf = function (icon) {\n    var idx = 0,\n        costume = icon.object,\n        top = icon.top();\n\n    icon.destroy();\n    this.contents.children.forEach(item => {\n        if (item instanceof SoundIconMorph && item.top() < top - 4) {\n            idx += 1;\n        }\n    });\n\n    this.sprite.shadowAttribute('sounds');\n    this.sprite.sounds.add(costume, idx + 1);\n    this.updateList();\n};\n\n// StageHandleMorph ////////////////////////////////////////////////////////\n\n// I am a horizontal resizing handle for a StageMorph\n\n// StageHandleMorph inherits from Morph:\n\nStageHandleMorph.prototype = new Morph();\nStageHandleMorph.prototype.constructor = StageHandleMorph;\nStageHandleMorph.uber = Morph.prototype;\n\n// StageHandleMorph instance creation:\n\nexport function StageHandleMorph(target) {\n    this.init(target);\n}\n\nStageHandleMorph.prototype.init = function (target) {\n    this.target = target || null;\n    this.userState = 'normal'; // or 'highlight'\n    HandleMorph.uber.init.call(this);\n    this.color = MorphicPreferences.isFlat ?\n            IDE_Morph.prototype.backgroundColor : new Color(190, 190, 190);\n    this.isDraggable = false;\n    this.setExtent(new Point(12, 50));\n};\n\n// StageHandleMorph drawing:\n\nStageHandleMorph.prototype.render = function (ctx) {\n    if (this.userState === 'highlight') {\n        this.renderOn(\n            ctx,\n            MorphicPreferences.isFlat ?\n                    new Color(245, 245, 255) : new Color(100, 100, 255),\n            this.color\n        );\n    } else { // assume 'normal'\n        this.renderOn(ctx, this.color);\n    }\n};\n\nStageHandleMorph.prototype.renderOn = function (\n    ctx,\n    color,\n    shadowColor\n) {\n    var l = this.height() / 8,\n        w = this.width() / 6,\n        r = w / 2,\n        x,\n        y,\n        i;\n\n    ctx.lineWidth = w;\n    ctx.lineCap = 'round';\n    y = this.height() / 2;\n\n    ctx.strokeStyle = color.toString();\n    x = this.width() / 12;\n    for (i = 0; i < 3; i += 1) {\n        if (i > 0) {\n            ctx.beginPath();\n            ctx.moveTo(x, y - (l - r));\n            ctx.lineTo(x, y + (l - r));\n            ctx.stroke();\n        }\n        x += (w * 2);\n        l *= 2;\n    }\n    if (shadowColor) {\n        ctx.strokeStyle = shadowColor.toString();\n        x = this.width() / 12 + w;\n        l = this.height() / 8;\n        for (i = 0; i < 3; i += 1) {\n            if (i > 0) {\n                ctx.beginPath();\n                ctx.moveTo(x, y - (l - r));\n                ctx.lineTo(x, y + (l - r));\n                ctx.stroke();\n            }\n            x += (w * 2);\n            l *= 2;\n        }\n    }\n};\n\n// StageHandleMorph layout:\n\nStageHandleMorph.prototype.fixLayout = function () {\n    if (!this.target) {return; }\n    var ide = this.target.parentThatIsA(IDE_Morph);\n    this.setTop(this.target.top() + 10);\n    this.setRight(this.target.left());\n    if (ide) {ide.add(this); } // come to front\n};\n\n// StageHandleMorph stepping:\n\nStageHandleMorph.prototype.step = null;\n\nStageHandleMorph.prototype.mouseDownLeft = function (pos) {\n    var world = this.world(),\n        offset = this.right() - pos.x,\n        ide = this.target.parentThatIsA(IDE_Morph);\n\n    if (!this.target) {\n        return null;\n    }\n    ide.isSmallStage = true;\n    ide.controlBar.stageSizeButton.refresh();\n\n    this.step = function () {\n        var newPos, newWidth;\n        if (world.hand.mouseButton) {\n            newPos = world.hand.bounds.origin.x + offset;\n            newWidth = this.target.right() - newPos;\n            ide.stageRatio = newWidth / this.target.dimensions.x;\n            ide.setExtent(world.extent());\n\n        } else {\n            this.step = null;\n            ide.isSmallStage = (ide.stageRatio !== 1);\n            ide.controlBar.stageSizeButton.refresh();\n        }\n    };\n};\n\n// StageHandleMorph events:\n\nStageHandleMorph.prototype.mouseEnter = function () {\n    this.userState = 'highlight';\n    this.rerender();\n};\n\nStageHandleMorph.prototype.mouseLeave = function () {\n    this.userState = 'normal';\n    this.rerender();\n};\n\nStageHandleMorph.prototype.mouseDoubleClick = function () {\n    this.target.parentThatIsA(IDE_Morph).toggleStageSize(true, 1);\n};\n\n// PaletteHandleMorph ////////////////////////////////////////////////////////\n\n// I am a horizontal resizing handle for a blocks palette\n// I pseudo-inherit many things from StageHandleMorph\n\n// PaletteHandleMorph inherits from Morph:\n\nPaletteHandleMorph.prototype = new Morph();\nPaletteHandleMorph.prototype.constructor = PaletteHandleMorph;\nPaletteHandleMorph.uber = Morph.prototype;\n\n// PaletteHandleMorph instance creation:\n\nexport function PaletteHandleMorph(target) {\n    this.init(target);\n}\n\nPaletteHandleMorph.prototype.init = function (target) {\n    this.target = target || null;\n    this.userState = 'normal';\n    HandleMorph.uber.init.call(this);\n    this.color = MorphicPreferences.isFlat ?\n            IDE_Morph.prototype.backgroundColor : new Color(190, 190, 190);\n    this.isDraggable = false;\n    this.setExtent(new Point(12, 50));\n};\n\n// PaletteHandleMorph drawing:\n\nPaletteHandleMorph.prototype.render =\n    StageHandleMorph.prototype.render;\n\nPaletteHandleMorph.prototype.renderOn =\n    StageHandleMorph.prototype.renderOn;\n\n// PaletteHandleMorph layout:\n\nPaletteHandleMorph.prototype.fixLayout = function () {\n    if (!this.target) {return; }\n    var ide = this.target.parentThatIsA(IDE_Morph);\n    this.setTop(this.target.top() + 10);\n    this.setRight(this.target.right());\n    if (ide) {ide.add(this); } // come to front\n};\n\n// PaletteHandleMorph stepping:\n\nPaletteHandleMorph.prototype.step = null;\n\nPaletteHandleMorph.prototype.mouseDownLeft = function (pos) {\n    var world = this.world(),\n        offset = this.right() - pos.x,\n        ide = this.target.parentThatIsA(IDE_Morph);\n\n    if (!this.target) {\n        return null;\n    }\n    this.step = function () {\n        var newPos;\n        if (world.hand.mouseButton) {\n            newPos = world.hand.bounds.origin.x + offset;\n            ide.paletteWidth = Math.min(\n                Math.max(200, newPos),\n                ide.stageHandle.left() - ide.spriteBar.tabBar.width()\n            );\n            ide.setExtent(world.extent());\n\n        } else {\n            this.step = null;\n        }\n    };\n};\n\n// PaletteHandleMorph events:\n\nPaletteHandleMorph.prototype.mouseEnter\n    = StageHandleMorph.prototype.mouseEnter;\n\nPaletteHandleMorph.prototype.mouseLeave\n    = StageHandleMorph.prototype.mouseLeave;\n\nPaletteHandleMorph.prototype.mouseDoubleClick = function () {\n    this.target.parentThatIsA(IDE_Morph).setPaletteWidth(200);\n};\n\n// CamSnapshotDialogMorph ////////////////////////////////////////////////////\n\n/*\n    I am a dialog morph that lets users take a snapshot using their webcam\n    and use it as a costume for their sprites or a background for the Stage.\n\n    NOTE: Currently disabled because of issues with experimental technology\n    in Safari.\n*/\n\n// CamSnapshotDialogMorph inherits from DialogBoxMorph:\n\nCamSnapshotDialogMorph.prototype = new DialogBoxMorph();\nCamSnapshotDialogMorph.prototype.constructor = CamSnapshotDialogMorph;\nCamSnapshotDialogMorph.uber = DialogBoxMorph.prototype;\n\n// CamSnapshotDialogMorph settings\n\nCamSnapshotDialogMorph.prototype.enableCamera = true; // off while experimental\nCamSnapshotDialogMorph.prototype.enabled = true;\n\nCamSnapshotDialogMorph.prototype.notSupportedMessage =\n\t'Please make sure your web browser is up to date\\n' +\n\t'and your camera is properly configured. \\n\\n' +\n\t'Some browsers also require you to access Snap!\\n' +\n\t'through HTTPS to use the camera.\\n\\n' +\n    'Plase replace the \"http://\" part of the address\\n' +\n    'in your browser by \"https://\" and try again.';\n\n// CamSnapshotDialogMorph instance creation\n\nexport function CamSnapshotDialogMorph(ide, sprite, onCancel, onAccept) {\n    this.init(ide, sprite, onCancel, onAccept);\n}\n\nCamSnapshotDialogMorph.prototype.init = function (\n    ide,\n    sprite,\n    onCancel,\n\tonAccept\n) {\n    this.ide = ide;\n    this.sprite = sprite;\n    this.padding = 10;\n    this.oncancel = onCancel;\n    this.accept = onAccept;\n    this.videoElement = null; // an HTML5 video element\n    this.videoView = new Morph(); // a morph where we'll copy the video contents\n    this.videoView.isCachingImage = true;\n\n    CamSnapshotDialogMorph.uber.init.call(this);\n    this.labelString = 'Camera';\n    this.createLabel();\n    this.buildContents();\n};\n\nCamSnapshotDialogMorph.prototype.buildContents = function () {\n    var myself = this,\n        stage = this.sprite.parentThatIsA(StageMorph);\n\n\tfunction noCameraSupport() {\n        myself.disable();\n        myself.ide.inform(\n            'Camera not supported',\n            CamSnapshotDialogMorph.prototype.notSupportedMessage\n        );\n        if (myself.videoElement) {\n        \tmyself.videoElement.remove();\n        }\n        myself.cancel();\n\t}\n\n    this.videoElement = document.createElement('video');\n    this.videoElement.hidden = true;\n    this.videoElement.width = stage.dimensions.x;\n    this.videoElement.height = stage.dimensions.y;\n\n    document.body.appendChild(this.videoElement);\n\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n        navigator.mediaDevices.getUserMedia({ video: true })\n            .then(stream => {\n                this.videoElement.srcObject = stream;\n                this.videoElement.play().catch(noCameraSupport);\n                this.videoElement.stream = stream;\n            }).catch(noCameraSupport);\n    }\n\n    this.videoView.setExtent(stage.dimensions);\n    this.videoView.cachedImage = newCanvas(\n        stage.dimensions,\n        true, // retina, maybe overkill here\n        this.videoView.cachedImage\n    );\n\n    this.videoView.drawOn = function (ctx, rect) {\n        var videoWidth = myself.videoElement.videoWidth,\n            videoHeight = myself.videoElement.videoHeight,\n            w = stage.dimensions.x,\n            h = stage.dimensions.y,\n            clippingWidth, clippingHeight;\n\n        if (!videoWidth) { return; }\n\n        ctx.save();\n\n        // Flip the image so it looks like a mirror\n        ctx.translate(w, 0);\n        ctx.scale(-1, 1);\n\n        if (videoWidth / w > videoHeight / h) {\n            // preserve height, crop width\n            clippingWidth = w * (videoHeight / h);\n            clippingHeight = videoHeight;\n        } else {\n            // preserve width, crop height\n            clippingWidth = videoWidth;\n            clippingHeight = h * (videoWidth / w);\n        }\n\n        ctx.drawImage(\n            myself.videoElement,\n            0,\n            0,\n            clippingWidth,\n            clippingHeight,\n            this.left() * -1,\n            this.top(),\n            w,\n            h\n            );\n\n        ctx.restore();\n    };\n\n    this.videoView.step = function () {\n        this.changed();\n    };\n\n    this.addBody(new AlignmentMorph('column', this.padding / 2));\n    this.body.add(this.videoView);\n    this.body.fixLayout();\n\n    this.addButton('ok', 'Save');\n    this.addButton('cancel', 'Cancel');\n\n    this.fixLayout();\n    this.rerender();\n};\n\nCamSnapshotDialogMorph.prototype.ok = function () {\n    this.accept(\n        new Costume(\n            this.videoView.fullImage(),\n            this.sprite.newCostumeName('camera')\n        ).flipped()\n    );\n};\n\nCamSnapshotDialogMorph.prototype.disable = function () {\n    CamSnapshotDialogMorph.prototype.enabled = false;\n    document.dispatchEvent(new Event('cameraDisabled'));\n};\n\nCamSnapshotDialogMorph.prototype.destroy = function () {\n    this.oncancel.call(this);\n    this.close();\n};\n\nCamSnapshotDialogMorph.prototype.close = function () {\n    if (this.videoElement && this.videoElement.stream) {\n        this.videoElement.stream.getTracks()[0].stop();\n        this.videoElement.remove();\n    }\n    CamSnapshotDialogMorph.uber.destroy.call(this);\n};\n\n// SoundRecorderDialogMorph ////////////////////////////////////////////////////\n\n/*\n    I am a dialog morph that lets users record sound snippets for their\n    sprites or Stage.\n*/\n\n// SoundRecorderDialogMorph inherits from DialogBoxMorph:\n\nSoundRecorderDialogMorph.prototype = new DialogBoxMorph();\nSoundRecorderDialogMorph.prototype.constructor = SoundRecorderDialogMorph;\nSoundRecorderDialogMorph.uber = DialogBoxMorph.prototype;\n\n// SoundRecorderDialogMorph instance creation\n\nexport function SoundRecorderDialogMorph(onAccept) {\n    this.init(onAccept);\n}\n\nSoundRecorderDialogMorph.prototype.init = function (onAccept) {\n    var myself = this;\n    this.padding = 10;\n    this.accept = onAccept;\n\n    this.mediaRecorder = null; // an HTML5 MediaRecorder object\n    this.audioElement = document.createElement('audio');\n    this.audioElement.hidden = true;\n    this.audioElement.onended = function (event) {\n        myself.stop();\n    };\n    document.body.appendChild(this.audioElement);\n\n    this.recordButton = null;\n    this.stopButton = null;\n    this.playButton = null;\n    this.progressBar = new BoxMorph();\n\n    SoundRecorderDialogMorph.uber.init.call(this);\n    this.labelString = 'Sound Recorder';\n    this.createLabel();\n    this.buildContents();\n};\n\nSoundRecorderDialogMorph.prototype.buildContents = function () {\n    var audioChunks = [];\n\n    this.recordButton = new PushButtonMorph(\n        this,\n        'record',\n        new SymbolMorph('circleSolid', 10)\n    );\n\n    this.stopButton = new PushButtonMorph(\n        this,\n        'stop',\n        new SymbolMorph('rectangleSolid', 10)\n    );\n\n    this.playButton = new PushButtonMorph(\n        this,\n        'play',\n        new SymbolMorph('pointRight', 10)\n    );\n\n    this.buildProgressBar();\n\n    this.addBody(new AlignmentMorph('row', this.padding));\n    this.body.add(this.recordButton);\n    this.body.add(this.stopButton);\n    this.body.add(this.playButton);\n    this.body.add(this.progressBar);\n\n    this.body.fixLayout();\n\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n        navigator.mediaDevices.getUserMedia(\n            {\n                audio: {\n                    channelCount: 1 // force mono, currently only works on FF\n                }\n\n            }\n        ).then(stream => {\n            this.mediaRecorder = new MediaRecorder(stream);\n            this.mediaRecorder.ondataavailable = (event) => {\n                audioChunks.push(event.data);\n            };\n            this.mediaRecorder.onstop = (event) => {\n                var buffer = new Blob(audioChunks),\n                    reader = new window.FileReader();\n                reader.readAsDataURL(buffer);\n                reader.onloadend = () => {\n                    var base64 = reader.result;\n                    base64 = 'data:audio/ogg;base64,' +\n                        base64.split(',')[1];\n                    this.audioElement.src = base64;\n                    this.audioElement.load();\n                    audioChunks = [];\n                };\n            };\n        });\n    }\n\n    this.addButton('ok', 'Save');\n    this.addButton('cancel', 'Cancel');\n\n    this.fixLayout();\n    this.rerender();\n};\n\nSoundRecorderDialogMorph.prototype.buildProgressBar = function () {\n    var line = new Morph(),\n        myself = this;\n\n    this.progressBar.setExtent(new Point(150, 20));\n    this.progressBar.setColor(new Color(200, 200, 200));\n    this.progressBar.setBorderWidth(1);\n    this.progressBar.setBorderColor(new Color(150, 150, 150));\n\n    line.setExtent(new Point(130, 2));\n    line.setColor(new Color(50, 50, 50));\n    line.setCenter(this.progressBar.center());\n    this.progressBar.add(line);\n\n    this.progressBar.indicator = new Morph();\n    this.progressBar.indicator.setExtent(new Point(5, 15));\n    this.progressBar.indicator.setColor(new Color(50, 200, 50));\n    this.progressBar.indicator.setCenter(line.leftCenter());\n\n    this.progressBar.add(this.progressBar.indicator);\n\n    this.progressBar.setPercentage = function (percentage) {\n        this.indicator.setLeft(\n            line.left() +\n            (line.width() / 100 * percentage) -\n            this.indicator.width() / 2\n        );\n    };\n\n    this.progressBar.step = function () {\n        if (myself.audioElement.duration) {\n            this.setPercentage(\n                myself.audioElement.currentTime /\n                myself.audioElement.duration * 100);\n        } else {\n            this.setPercentage(0);\n        }\n    };\n};\n\nSoundRecorderDialogMorph.prototype.record = function () {\n    if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {\n        this.stop();\n        return;\n    }\n\n    this.mediaRecorder.start();\n    this.recordButton.label.setColor(new Color(255, 0, 0));\n    this.playButton.label.setColor(new Color(0, 0, 0));\n};\n\nSoundRecorderDialogMorph.prototype.stop = function () {\n    if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {\n        this.mediaRecorder.stop();\n    }\n\n    this.audioElement.pause();\n    this.audioElement.currentTime = 0;\n\n    this.recordButton.label.setColor(new Color(0, 0, 0));\n    this.playButton.label.setColor(new Color(0, 0, 0));\n};\n\nSoundRecorderDialogMorph.prototype.play = function () {\n    this.stop();\n    this.audioElement.oncanplaythrough = function () {\n        this.play();\n        this.oncanplaythrough = nop;\n    };\n    this.playButton.label.setColor(new Color(0, 255, 0));\n};\n\nSoundRecorderDialogMorph.prototype.ok = function () {\n    var myself = this;\n    this.stop();\n    this.audioElement.oncanplaythrough = function () {\n        if (this.duration && this.duration !== Infinity) {\n            myself.accept(this);\n            this.oncanplaythrough = nop;\n            myself.destroy();\n        } else {\n            // For some reason, we need to play the sound\n            // at least once to get its duration.\n            myself.buttons.children.forEach(button =>\n                button.disable()\n            );\n            this.play();\n        }\n    };\n\n};\n\nSoundRecorderDialogMorph.prototype.destroy = function () {\n    this.stop();\n    this.audioElement.remove();\n    if (this.mediaRecorder && this.mediaRecorder.stream) {\n        this.mediaRecorder.stream.getTracks()[0].stop();\n    }\n    SoundRecorderDialogMorph.uber.destroy.call(this);\n};\n"],"sourceRoot":""}